(self.webpackChunk=self.webpackChunk||[]).push([[761],{58235:function(e,t,i){"use strict";var s=t;s.bignum=i(4590),s.define=i(3403).define,s.base=i(84849),s.constants=i(6468),s.decoders=i(3380),s.encoders=i(72992)},3403:function(e,t,i){"use strict";var s=i(72992),r=i(3380),a=i(35717);function n(e,t){this.name=e,this.body=t,this.decoders={},this.encoders={}}t.define=function(e,t){return new n(e,t)},n.prototype._createNamed=function(e){var t=this.name;function i(e){this._initNamed(e,t)}return a(i,e),i.prototype._initNamed=function(t,i){e.call(this,t,i)},new i(this)},n.prototype._getDecoder=function(e){return e=e||"der",this.decoders.hasOwnProperty(e)||(this.decoders[e]=this._createNamed(r[e])),this.decoders[e]},n.prototype.decode=function(e,t,i){return this._getDecoder(t).decode(e,i)},n.prototype._getEncoder=function(e){return e=e||"der",this.encoders.hasOwnProperty(e)||(this.encoders[e]=this._createNamed(s[e])),this.encoders[e]},n.prototype.encode=function(e,t,i){return this._getEncoder(t).encode(e,i)}},85371:function(e,t,i){"use strict";var s=i(52677).default,r=i(35717),a=i(29874).b,n=i(2399).Buffer;function o(e,t){a.call(this,t),n.isBuffer(e)?(this.base=e,this.offset=0,this.length=e.length):this.error("Input not Buffer")}function h(e,t){if(Array.isArray(e))this.length=0,this.value=e.map((function(e){return h.isEncoderBuffer(e)||(e=new h(e,t)),this.length+=e.length,e}),this);else if("number"==typeof e){if(!(0<=e&&e<=255))return t.error("non-byte EncoderBuffer value");this.value=e,this.length=1}else if("string"==typeof e)this.value=e,this.length=n.byteLength(e);else{if(!n.isBuffer(e))return t.error("Unsupported type: "+s(e));this.value=e,this.length=e.length}}r(o,a),t.C=o,o.isDecoderBuffer=function(e){return e instanceof o||"object"===s(e)&&n.isBuffer(e.base)&&"DecoderBuffer"===e.constructor.name&&"number"==typeof e.offset&&"number"==typeof e.length&&"function"==typeof e.save&&"function"==typeof e.restore&&"function"==typeof e.isEmpty&&"function"==typeof e.readUInt8&&"function"==typeof e.skip&&"function"==typeof e.raw},o.prototype.save=function(){return{offset:this.offset,reporter:a.prototype.save.call(this)}},o.prototype.restore=function(e){var t=new o(this.base);return t.offset=e.offset,t.length=this.offset,this.offset=e.offset,a.prototype.restore.call(this,e.reporter),t},o.prototype.isEmpty=function(){return this.offset===this.length},o.prototype.readUInt8=function(e){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(e||"DecoderBuffer overrun")},o.prototype.skip=function(e,t){if(!(this.offset+e<=this.length))return this.error(t||"DecoderBuffer overrun");var i=new o(this.base);return i._reporterState=this._reporterState,i.offset=this.offset,i.length=this.offset+e,this.offset+=e,i},o.prototype.raw=function(e){return this.base.slice(e?e.offset:this.offset,this.length)},t.R=h,h.isEncoderBuffer=function(e){return e instanceof h||"object"===s(e)&&"EncoderBuffer"===e.constructor.name&&"number"==typeof e.length&&"function"==typeof e.join},h.prototype.join=function(e,t){return e||(e=n.alloc(this.length)),t||(t=0),0===this.length||(Array.isArray(this.value)?this.value.forEach((function(i){i.join(e,t),t+=i.length})):("number"==typeof this.value?e[t]=this.value:"string"==typeof this.value?e.write(this.value,t):n.isBuffer(this.value)&&this.value.copy(e,t),t+=this.length)),e}},84849:function(e,t,i){"use strict";var s=t;s.Reporter=i(29874).b,s.DecoderBuffer=i(85371).C,s.EncoderBuffer=i(85371).R,s.Node=i(81440)},81440:function(e,t,i){"use strict";var s=i(52677).default,r=i(29874).b,a=i(85371).R,n=i(85371).C,o=i(79746),h=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],d=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(h);function c(e,t,i){var s={};this._baseState=s,s.name=i,s.enc=e,s.parent=t||null,s.children=null,s.tag=null,s.args=null,s.reverseArgs=null,s.choice=null,s.optional=!1,s.any=!1,s.obj=!1,s.use=null,s.useDecoder=null,s.key=null,s.default=null,s.explicit=null,s.implicit=null,s.contains=null,s.parent||(s.children=[],this._wrap())}e.exports=c;var l=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];c.prototype.clone=function(){var e=this._baseState,t={};l.forEach((function(i){t[i]=e[i]}));var i=new this.constructor(t.parent);return i._baseState=t,i},c.prototype._wrap=function(){var e=this._baseState;d.forEach((function(t){this[t]=function(){var i=new this.constructor(this);return e.children.push(i),i[t].apply(i,arguments)}}),this)},c.prototype._init=function(e){var t=this._baseState;o(null===t.parent),e.call(this),t.children=t.children.filter((function(e){return e._baseState.parent===this}),this),o.equal(t.children.length,1,"Root node can have only one child")},c.prototype._useArgs=function(e){var t=this._baseState,i=e.filter((function(e){return e instanceof this.constructor}),this);e=e.filter((function(e){return!(e instanceof this.constructor)}),this),0!==i.length&&(o(null===t.children),t.children=i,i.forEach((function(e){e._baseState.parent=this}),this)),0!==e.length&&(o(null===t.args),t.args=e,t.reverseArgs=e.map((function(e){if("object"!==s(e)||e.constructor!==Object)return e;var t={};return Object.keys(e).forEach((function(i){i==(0|i)&&(i|=0);var s=e[i];t[s]=i})),t})))},["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"].forEach((function(e){c.prototype[e]=function(){var t=this._baseState;throw new Error(e+" not implemented for encoding: "+t.enc)}})),h.forEach((function(e){c.prototype[e]=function(){var t=this._baseState,i=Array.prototype.slice.call(arguments);return o(null===t.tag),t.tag=e,this._useArgs(i),this}})),c.prototype.use=function(e){o(e);var t=this._baseState;return o(null===t.use),t.use=e,this},c.prototype.optional=function(){return this._baseState.optional=!0,this},c.prototype.def=function(e){var t=this._baseState;return o(null===t.default),t.default=e,t.optional=!0,this},c.prototype.explicit=function(e){var t=this._baseState;return o(null===t.explicit&&null===t.implicit),t.explicit=e,this},c.prototype.implicit=function(e){var t=this._baseState;return o(null===t.explicit&&null===t.implicit),t.implicit=e,this},c.prototype.obj=function(){var e=this._baseState,t=Array.prototype.slice.call(arguments);return e.obj=!0,0!==t.length&&this._useArgs(t),this},c.prototype.key=function(e){var t=this._baseState;return o(null===t.key),t.key=e,this},c.prototype.any=function(){return this._baseState.any=!0,this},c.prototype.choice=function(e){var t=this._baseState;return o(null===t.choice),t.choice=e,this._useArgs(Object.keys(e).map((function(t){return e[t]}))),this},c.prototype.contains=function(e){var t=this._baseState;return o(null===t.use),t.contains=e,this},c.prototype._decode=function(e,t){var i=this._baseState;if(null===i.parent)return e.wrapResult(i.children[0]._decode(e,t));var s,r=i.default,a=!0,o=null;if(null!==i.key&&(o=e.enterKey(i.key)),i.optional){var h=null;if(null!==i.explicit?h=i.explicit:null!==i.implicit?h=i.implicit:null!==i.tag&&(h=i.tag),null!==h||i.any){if(a=this._peekTag(e,h,i.any),e.isError(a))return a}else{var d=e.save();try{null===i.choice?this._decodeGeneric(i.tag,e,t):this._decodeChoice(e,t),a=!0}catch(e){a=!1}e.restore(d)}}if(i.obj&&a&&(s=e.enterObject()),a){if(null!==i.explicit){var c=this._decodeTag(e,i.explicit);if(e.isError(c))return c;e=c}var l=e.offset;if(null===i.use&&null===i.choice){var u;i.any&&(u=e.save());var f=this._decodeTag(e,null!==i.implicit?i.implicit:i.tag,i.any);if(e.isError(f))return f;i.any?r=e.raw(u):e=f}if(t&&t.track&&null!==i.tag&&t.track(e.path(),l,e.length,"tagged"),t&&t.track&&null!==i.tag&&t.track(e.path(),e.offset,e.length,"content"),i.any||(r=null===i.choice?this._decodeGeneric(i.tag,e,t):this._decodeChoice(e,t)),e.isError(r))return r;if(i.any||null!==i.choice||null===i.children||i.children.forEach((function(i){i._decode(e,t)})),i.contains&&("octstr"===i.tag||"bitstr"===i.tag)){var p=new n(r);r=this._getUse(i.contains,e._reporterState.obj)._decode(p,t)}}return i.obj&&a&&(r=e.leaveObject(s)),null===i.key||null===r&&!0!==a?null!==o&&e.exitKey(o):e.leaveKey(o,i.key,r),r},c.prototype._decodeGeneric=function(e,t,i){var s=this._baseState;return"seq"===e||"set"===e?null:"seqof"===e||"setof"===e?this._decodeList(t,e,s.args[0],i):/str$/.test(e)?this._decodeStr(t,e,i):"objid"===e&&s.args?this._decodeObjid(t,s.args[0],s.args[1],i):"objid"===e?this._decodeObjid(t,null,null,i):"gentime"===e||"utctime"===e?this._decodeTime(t,e,i):"null_"===e?this._decodeNull(t,i):"bool"===e?this._decodeBool(t,i):"objDesc"===e?this._decodeStr(t,e,i):"int"===e||"enum"===e?this._decodeInt(t,s.args&&s.args[0],i):null!==s.use?this._getUse(s.use,t._reporterState.obj)._decode(t,i):t.error("unknown tag: "+e)},c.prototype._getUse=function(e,t){var i=this._baseState;return i.useDecoder=this._use(e,t),o(null===i.useDecoder._baseState.parent),i.useDecoder=i.useDecoder._baseState.children[0],i.implicit!==i.useDecoder._baseState.implicit&&(i.useDecoder=i.useDecoder.clone(),i.useDecoder._baseState.implicit=i.implicit),i.useDecoder},c.prototype._decodeChoice=function(e,t){var i=this._baseState,s=null,r=!1;return Object.keys(i.choice).some((function(a){var n=e.save(),o=i.choice[a];try{var h=o._decode(e,t);if(e.isError(h))return!1;s={type:a,value:h},r=!0}catch(t){return e.restore(n),!1}return!0}),this),r?s:e.error("Choice not matched")},c.prototype._createEncoderBuffer=function(e){return new a(e,this.reporter)},c.prototype._encode=function(e,t,i){var s=this._baseState;if(null===s.default||s.default!==e){var r=this._encodeValue(e,t,i);if(void 0!==r&&!this._skipDefault(r,t,i))return r}},c.prototype._encodeValue=function(e,t,i){var a=this._baseState;if(null===a.parent)return a.children[0]._encode(e,t||new r);var n=null;if(this.reporter=t,a.optional&&void 0===e){if(null===a.default)return;e=a.default}var o=null,h=!1;if(a.any)n=this._createEncoderBuffer(e);else if(a.choice)n=this._encodeChoice(e,t);else if(a.contains)o=this._getUse(a.contains,i)._encode(e,t),h=!0;else if(a.children)o=a.children.map((function(i){if("null_"===i._baseState.tag)return i._encode(null,t,e);if(null===i._baseState.key)return t.error("Child should have a key");var r=t.enterKey(i._baseState.key);if("object"!==s(e))return t.error("Child expected, but input is not object");var a=i._encode(e[i._baseState.key],t,e);return t.leaveKey(r),a}),this).filter((function(e){return e})),o=this._createEncoderBuffer(o);else if("seqof"===a.tag||"setof"===a.tag){if(!a.args||1!==a.args.length)return t.error("Too many args for : "+a.tag);if(!Array.isArray(e))return t.error("seqof/setof, but data is not Array");var d=this.clone();d._baseState.implicit=null,o=this._createEncoderBuffer(e.map((function(i){var s=this._baseState;return this._getUse(s.args[0],e)._encode(i,t)}),d))}else null!==a.use?n=this._getUse(a.use,i)._encode(e,t):(o=this._encodePrimitive(a.tag,e),h=!0);if(!a.any&&null===a.choice){var c=null!==a.implicit?a.implicit:a.tag,l=null===a.implicit?"universal":"context";null===c?null===a.use&&t.error("Tag could be omitted only for .use()"):null===a.use&&(n=this._encodeComposite(c,h,l,o))}return null!==a.explicit&&(n=this._encodeComposite(a.explicit,!1,"context",n)),n},c.prototype._encodeChoice=function(e,t){var i=this._baseState,s=i.choice[e.type];return s||o(!1,e.type+" not found in "+JSON.stringify(Object.keys(i.choice))),s._encode(e.value,t)},c.prototype._encodePrimitive=function(e,t){var i=this._baseState;if(/str$/.test(e))return this._encodeStr(t,e);if("objid"===e&&i.args)return this._encodeObjid(t,i.reverseArgs[0],i.args[1]);if("objid"===e)return this._encodeObjid(t,null,null);if("gentime"===e||"utctime"===e)return this._encodeTime(t,e);if("null_"===e)return this._encodeNull();if("int"===e||"enum"===e)return this._encodeInt(t,i.args&&i.reverseArgs[0]);if("bool"===e)return this._encodeBool(t);if("objDesc"===e)return this._encodeStr(t,e);throw new Error("Unsupported tag: "+e)},c.prototype._isNumstr=function(e){return/^[0-9 ]*$/.test(e)},c.prototype._isPrintstr=function(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/.test(e)}},29874:function(e,t,i){"use strict";var s=i(35717);function r(e){this._reporterState={obj:null,path:[],options:e||{},errors:[]}}function a(e,t){this.path=e,this.rethrow(t)}t.b=r,r.prototype.isError=function(e){return e instanceof a},r.prototype.save=function(){var e=this._reporterState;return{obj:e.obj,pathLen:e.path.length}},r.prototype.restore=function(e){var t=this._reporterState;t.obj=e.obj,t.path=t.path.slice(0,e.pathLen)},r.prototype.enterKey=function(e){return this._reporterState.path.push(e)},r.prototype.exitKey=function(e){var t=this._reporterState;t.path=t.path.slice(0,e-1)},r.prototype.leaveKey=function(e,t,i){var s=this._reporterState;this.exitKey(e),null!==s.obj&&(s.obj[t]=i)},r.prototype.path=function(){return this._reporterState.path.join("/")},r.prototype.enterObject=function(){var e=this._reporterState,t=e.obj;return e.obj={},t},r.prototype.leaveObject=function(e){var t=this._reporterState,i=t.obj;return t.obj=e,i},r.prototype.error=function(e){var t,i=this._reporterState,s=e instanceof a;if(t=s?e:new a(i.path.map((function(e){return"["+JSON.stringify(e)+"]"})).join(""),e.message||e,e.stack),!i.options.partial)throw t;return s||i.errors.push(t),t},r.prototype.wrapResult=function(e){var t=this._reporterState;return t.options.partial?{result:this.isError(e)?null:e,errors:t.errors}:e},s(a,Error),a.prototype.rethrow=function(e){if(this.message=e+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,a),!this.stack)try{throw new Error(this.message)}catch(e){this.stack=e.stack}return this}},1929:function(e,t){"use strict";function i(e){var t={};return Object.keys(e).forEach((function(i){(0|i)==i&&(i|=0);var s=e[i];t[s]=i})),t}t.tagClass={0:"universal",1:"application",2:"context",3:"private"},t.tagClassByName=i(t.tagClass),t.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},t.tagByName=i(t.tag)},6468:function(e,t,i){"use strict";var s=t;s._reverse=function(e){var t={};return Object.keys(e).forEach((function(i){(0|i)==i&&(i|=0);var s=e[i];t[s]=i})),t},s.der=i(1929)},98451:function(e,t,i){"use strict";var s=i(35717),r=i(4590),a=i(85371).C,n=i(81440),o=i(1929);function h(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new d,this.tree._init(e.body)}function d(e){n.call(this,"der",e)}function c(e,t){var i=e.readUInt8(t);if(e.isError(i))return i;var s=o.tagClass[i>>6],r=0==(32&i);if(31==(31&i)){var a=i;for(i=0;128==(128&a);){if(a=e.readUInt8(t),e.isError(a))return a;i<<=7,i|=127&a}}else i&=31;return{cls:s,primitive:r,tag:i,tagStr:o.tag[i]}}function l(e,t,i){var s=e.readUInt8(i);if(e.isError(s))return s;if(!t&&128===s)return null;if(0==(128&s))return s;var r=127&s;if(r>4)return e.error("length octect is too long");s=0;for(var a=0;a<r;a++){s<<=8;var n=e.readUInt8(i);if(e.isError(n))return n;s|=n}return s}e.exports=h,h.prototype.decode=function(e,t){return a.isDecoderBuffer(e)||(e=new a(e,t)),this.tree._decode(e,t)},s(d,n),d.prototype._peekTag=function(e,t,i){if(e.isEmpty())return!1;var s=e.save(),r=c(e,'Failed to peek tag: "'+t+'"');return e.isError(r)?r:(e.restore(s),r.tag===t||r.tagStr===t||r.tagStr+"of"===t||i)},d.prototype._decodeTag=function(e,t,i){var s=c(e,'Failed to decode tag of "'+t+'"');if(e.isError(s))return s;var r=l(e,s.primitive,'Failed to get length of "'+t+'"');if(e.isError(r))return r;if(!i&&s.tag!==t&&s.tagStr!==t&&s.tagStr+"of"!==t)return e.error('Failed to match tag: "'+t+'"');if(s.primitive||null!==r)return e.skip(r,'Failed to match body of: "'+t+'"');var a=e.save(),n=this._skipUntilEnd(e,'Failed to skip indefinite length body: "'+this.tag+'"');return e.isError(n)?n:(r=e.offset-a.offset,e.restore(a),e.skip(r,'Failed to match body of: "'+t+'"'))},d.prototype._skipUntilEnd=function(e,t){for(;;){var i=c(e,t);if(e.isError(i))return i;var s=l(e,i.primitive,t);if(e.isError(s))return s;var r=void 0;if(r=i.primitive||null!==s?e.skip(s):this._skipUntilEnd(e,t),e.isError(r))return r;if("end"===i.tagStr)break}},d.prototype._decodeList=function(e,t,i,s){for(var r=[];!e.isEmpty();){var a=this._peekTag(e,"end");if(e.isError(a))return a;var n=i.decode(e,"der",s);if(e.isError(n)&&a)break;r.push(n)}return r},d.prototype._decodeStr=function(e,t){if("bitstr"===t){var i=e.readUInt8();return e.isError(i)?i:{unused:i,data:e.raw()}}if("bmpstr"===t){var s=e.raw();if(s.length%2==1)return e.error("Decoding of string type: bmpstr length mismatch");for(var r="",a=0;a<s.length/2;a++)r+=String.fromCharCode(s.readUInt16BE(2*a));return r}if("numstr"===t){var n=e.raw().toString("ascii");return this._isNumstr(n)?n:e.error("Decoding of string type: numstr unsupported characters")}if("octstr"===t)return e.raw();if("objDesc"===t)return e.raw();if("printstr"===t){var o=e.raw().toString("ascii");return this._isPrintstr(o)?o:e.error("Decoding of string type: printstr unsupported characters")}return/str$/.test(t)?e.raw().toString():e.error("Decoding of string type: "+t+" unsupported")},d.prototype._decodeObjid=function(e,t,i){for(var s,r=[],a=0,n=0;!e.isEmpty();)a<<=7,a|=127&(n=e.readUInt8()),0==(128&n)&&(r.push(a),a=0);128&n&&r.push(a);var o=r[0]/40|0,h=r[0]%40;if(s=i?r:[o,h].concat(r.slice(1)),t){var d=t[s.join(" ")];void 0===d&&(d=t[s.join(".")]),void 0!==d&&(s=d)}return s},d.prototype._decodeTime=function(e,t){var i,s,r,a,n,o,h=e.raw().toString();if("gentime"===t)i=0|h.slice(0,4),s=0|h.slice(4,6),r=0|h.slice(6,8),a=0|h.slice(8,10),n=0|h.slice(10,12),o=0|h.slice(12,14);else{if("utctime"!==t)return e.error("Decoding "+t+" time is not supported yet");i=0|h.slice(0,2),s=0|h.slice(2,4),r=0|h.slice(4,6),a=0|h.slice(6,8),n=0|h.slice(8,10),o=0|h.slice(10,12),i=i<70?2e3+i:1900+i}return Date.UTC(i,s-1,r,a,n,o,0)},d.prototype._decodeNull=function(){return null},d.prototype._decodeBool=function(e){var t=e.readUInt8();return e.isError(t)?t:0!==t},d.prototype._decodeInt=function(e,t){var i=e.raw(),s=new r(i);return t&&(s=t[s.toString(10)]||s),s},d.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getDecoder("der").tree}},3380:function(e,t,i){"use strict";var s=t;s.der=i(98451),s.pem=i(51058)},51058:function(e,t,i){"use strict";var s=i(35717),r=i(2399).Buffer,a=i(98451);function n(e){a.call(this,e),this.enc="pem"}s(n,a),e.exports=n,n.prototype.decode=function(e,t){for(var i=e.toString().split(/[\r\n]+/g),s=t.label.toUpperCase(),n=/^-----(BEGIN|END) ([^-]+)-----$/,o=-1,h=-1,d=0;d<i.length;d++){var c=i[d].match(n);if(null!==c&&c[2]===s){if(-1!==o){if("END"!==c[1])break;h=d;break}if("BEGIN"!==c[1])break;o=d}}if(-1===o||-1===h)throw new Error("PEM section not found for: "+s);var l=i.slice(o+1,h).join("");l.replace(/[^a-z0-9+/=]+/gi,"");var u=r.from(l,"base64");return a.prototype.decode.call(this,u,t)}},82600:function(e,t,i){"use strict";var s=i(35717),r=i(2399).Buffer,a=i(81440),n=i(1929);function o(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new h,this.tree._init(e.body)}function h(e){a.call(this,"der",e)}function d(e){return e<10?"0"+e:e}e.exports=o,o.prototype.encode=function(e,t){return this.tree._encode(e,t).join()},s(h,a),h.prototype._encodeComposite=function(e,t,i,s){var a=function(e,t,i,s){var r;"seqof"===e?e="seq":"setof"===e&&(e="set");if(n.tagByName.hasOwnProperty(e))r=n.tagByName[e];else{if("number"!=typeof e||(0|e)!==e)return s.error("Unknown tag: "+e);r=e}if(r>=31)return s.error("Multi-octet tag encoding unsupported");t||(r|=32);return r|=n.tagClassByName[i||"universal"]<<6,r}(e,t,i,this.reporter);if(s.length<128){var o=r.alloc(2);return o[0]=a,o[1]=s.length,this._createEncoderBuffer([o,s])}for(var h=1,d=s.length;d>=256;d>>=8)h++;var c=r.alloc(2+h);c[0]=a,c[1]=128|h;for(var l=1+h,u=s.length;u>0;l--,u>>=8)c[l]=255&u;return this._createEncoderBuffer([c,s])},h.prototype._encodeStr=function(e,t){if("bitstr"===t)return this._createEncoderBuffer([0|e.unused,e.data]);if("bmpstr"===t){for(var i=r.alloc(2*e.length),s=0;s<e.length;s++)i.writeUInt16BE(e.charCodeAt(s),2*s);return this._createEncoderBuffer(i)}return"numstr"===t?this._isNumstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: numstr supports only digits and space"):"printstr"===t?this._isPrintstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(t)||"objDesc"===t?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: "+t+" unsupported")},h.prototype._encodeObjid=function(e,t,i){if("string"==typeof e){if(!t)return this.reporter.error("string objid given, but no values map found");if(!t.hasOwnProperty(e))return this.reporter.error("objid not found in values map");e=t[e].split(/[\s.]+/g);for(var s=0;s<e.length;s++)e[s]|=0}else if(Array.isArray(e)){e=e.slice();for(var a=0;a<e.length;a++)e[a]|=0}if(!Array.isArray(e))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(e));if(!i){if(e[1]>=40)return this.reporter.error("Second objid identifier OOB");e.splice(0,2,40*e[0]+e[1])}for(var n=0,o=0;o<e.length;o++){var h=e[o];for(n++;h>=128;h>>=7)n++}for(var d=r.alloc(n),c=d.length-1,l=e.length-1;l>=0;l--){var u=e[l];for(d[c--]=127&u;(u>>=7)>0;)d[c--]=128|127&u}return this._createEncoderBuffer(d)},h.prototype._encodeTime=function(e,t){var i,s=new Date(e);return"gentime"===t?i=[d(s.getUTCFullYear()),d(s.getUTCMonth()+1),d(s.getUTCDate()),d(s.getUTCHours()),d(s.getUTCMinutes()),d(s.getUTCSeconds()),"Z"].join(""):"utctime"===t?i=[d(s.getUTCFullYear()%100),d(s.getUTCMonth()+1),d(s.getUTCDate()),d(s.getUTCHours()),d(s.getUTCMinutes()),d(s.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+t+" time is not supported yet"),this._encodeStr(i,"octstr")},h.prototype._encodeNull=function(){return this._createEncoderBuffer("")},h.prototype._encodeInt=function(e,t){if("string"==typeof e){if(!t)return this.reporter.error("String int or enum given, but no values map");if(!t.hasOwnProperty(e))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(e));e=t[e]}if("number"!=typeof e&&!r.isBuffer(e)){var i=e.toArray();!e.sign&&128&i[0]&&i.unshift(0),e=r.from(i)}if(r.isBuffer(e)){var s=e.length;0===e.length&&s++;var a=r.alloc(s);return e.copy(a),0===e.length&&(a[0]=0),this._createEncoderBuffer(a)}if(e<128)return this._createEncoderBuffer(e);if(e<256)return this._createEncoderBuffer([0,e]);for(var n=1,o=e;o>=256;o>>=8)n++;for(var h=new Array(n),d=h.length-1;d>=0;d--)h[d]=255&e,e>>=8;return 128&h[0]&&h.unshift(0),this._createEncoderBuffer(r.from(h))},h.prototype._encodeBool=function(e){return this._createEncoderBuffer(e?255:0)},h.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getEncoder("der").tree},h.prototype._skipDefault=function(e,t,i){var s,r=this._baseState;if(null===r.default)return!1;var a=e.join();if(void 0===r.defaultBuffer&&(r.defaultBuffer=this._encodeValue(r.default,t,i).join()),a.length!==r.defaultBuffer.length)return!1;for(s=0;s<a.length;s++)if(a[s]!==r.defaultBuffer[s])return!1;return!0}},72992:function(e,t,i){"use strict";var s=t;s.der=i(82600),s.pem=i(12397)},12397:function(e,t,i){"use strict";var s=i(35717),r=i(82600);function a(e){r.call(this,e),this.enc="pem"}s(a,r),e.exports=a,a.prototype.encode=function(e,t){for(var i=r.prototype.encode.call(this,e).toString("base64"),s=["-----BEGIN "+t.label+"-----"],a=0;a<i.length;a+=64)s.push(i.slice(a,a+64));return s.push("-----END "+t.label+"-----"),s.join("\n")}},4590:function(e,t,i){!function(e,t){"use strict";function s(e,t){if(!e)throw new Error(t||"Assertion failed")}function r(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function a(e,t,i){if(a.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(i=t,t=10),this._init(e||0,t||10,i||"be"))}var n;"object"==typeof e?e.exports=a:t.BN=a,a.BN=a,a.wordSize=26;try{n="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i(80950).Buffer}catch(e){}function o(e,t){var i=e.charCodeAt(t);return i>=65&&i<=70?i-55:i>=97&&i<=102?i-87:i-48&15}function h(e,t,i){var s=o(e,i);return i-1>=t&&(s|=o(e,i-1)<<4),s}function d(e,t,i,s){for(var r=0,a=Math.min(e.length,i),n=t;n<a;n++){var o=e.charCodeAt(n)-48;r*=s,r+=o>=49?o-49+10:o>=17?o-17+10:o}return r}a.isBN=function(e){return e instanceof a||null!==e&&"object"==typeof e&&e.constructor.wordSize===a.wordSize&&Array.isArray(e.words)},a.max=function(e,t){return e.cmp(t)>0?e:t},a.min=function(e,t){return e.cmp(t)<0?e:t},a.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),s(t===(0|t)&&t>=2&&t<=36);var r=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(r++,this.negative=1),r<e.length&&(16===t?this._parseHex(e,r,i):(this._parseBase(e,t,r),"le"===i&&this._initArray(this.toArray(),t,i)))},a.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(s(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},a.prototype._initArray=function(e,t,i){if(s("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var a,n,o=0;if("be"===i)for(r=e.length-1,a=0;r>=0;r-=3)n=e[r]|e[r-1]<<8|e[r-2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);else if("le"===i)for(r=0,a=0;r<e.length;r+=3)n=e[r]|e[r+1]<<8|e[r+2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);return this.strip()},a.prototype._parseHex=function(e,t,i){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var r,a=0,n=0;if("be"===i)for(s=e.length-1;s>=t;s-=2)r=h(e,t,s)<<a,this.words[n]|=67108863&r,a>=18?(a-=18,n+=1,this.words[n]|=r>>>26):a+=8;else for(s=(e.length-t)%2==0?t+1:t;s<e.length;s+=2)r=h(e,t,s)<<a,this.words[n]|=67108863&r,a>=18?(a-=18,n+=1,this.words[n]|=r>>>26):a+=8;this.strip()},a.prototype._parseBase=function(e,t,i){this.words=[0],this.length=1;for(var s=0,r=1;r<=67108863;r*=t)s++;s--,r=r/t|0;for(var a=e.length-i,n=a%s,o=Math.min(a,a-n)+i,h=0,c=i;c<o;c+=s)h=d(e,c,c+s,t),this.imuln(r),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==n){var l=1;for(h=d(e,c,e.length,t),c=0;c<n;c++)l*=t;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},a.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},a.prototype.clone=function(){var e=new a(null);return this.copy(e),e},a.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},a.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},a.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},a.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],u=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,i){i.negative=t.negative^e.negative;var s=e.length+t.length|0;i.length=s,s=s-1|0;var r=0|e.words[0],a=0|t.words[0],n=r*a,o=67108863&n,h=n/67108864|0;i.words[0]=o;for(var d=1;d<s;d++){for(var c=h>>>26,l=67108863&h,u=Math.min(d,t.length-1),f=Math.max(0,d-e.length+1);f<=u;f++){var p=d-f|0;c+=(n=(r=0|e.words[p])*(a=0|t.words[f])+l)/67108864|0,l=67108863&n}i.words[d]=0|l,h=0|c}return 0!==h?i.words[d]=0|h:i.length--,i.strip()}a.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var r=0,a=0,n=0;n<this.length;n++){var o=this.words[n],h=(16777215&(o<<r|a)).toString(16);i=0!==(a=o>>>24-r&16777215)||n!==this.length-1?c[6-h.length]+h+i:h+i,(r+=2)>=26&&(r-=26,n--)}for(0!==a&&(i=a.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var d=l[e],f=u[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:c[d-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}s(!1,"Base should be between 2 and 36")},a.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&s(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},a.prototype.toJSON=function(){return this.toString(16)},a.prototype.toBuffer=function(e,t){return s(void 0!==n),this.toArrayLike(n,e,t)},a.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},a.prototype.toArrayLike=function(e,t,i){var r=this.byteLength(),a=i||Math.max(1,r);s(r<=a,"byte array longer than desired length"),s(a>0,"Requested array length <= 0"),this.strip();var n,o,h="le"===t,d=new e(a),c=this.clone();if(h){for(o=0;!c.isZero();o++)n=c.andln(255),c.iushrn(8),d[o]=n;for(;o<a;o++)d[o]=0}else{for(o=0;o<a-r;o++)d[o]=0;for(o=0;!c.isZero();o++)n=c.andln(255),c.iushrn(8),d[a-o-1]=n}return d},Math.clz32?a.prototype._countBits=function(e){return 32-Math.clz32(e)}:a.prototype._countBits=function(e){var t=e,i=0;return t>=4096&&(i+=13,t>>>=13),t>=64&&(i+=7,t>>>=7),t>=8&&(i+=4,t>>>=4),t>=2&&(i+=2,t>>>=2),i+t},a.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,i=0;return 0==(8191&t)&&(i+=13,t>>>=13),0==(127&t)&&(i+=7,t>>>=7),0==(15&t)&&(i+=4,t>>>=4),0==(3&t)&&(i+=2,t>>>=2),0==(1&t)&&i++,i},a.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},a.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var i=this._zeroBits(this.words[t]);if(e+=i,26!==i)break}return e},a.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},a.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},a.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},a.prototype.isNeg=function(){return 0!==this.negative},a.prototype.neg=function(){return this.clone().ineg()},a.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},a.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},a.prototype.ior=function(e){return s(0==(this.negative|e.negative)),this.iuor(e)},a.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},a.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},a.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var i=0;i<t.length;i++)this.words[i]=this.words[i]&e.words[i];return this.length=t.length,this.strip()},a.prototype.iand=function(e){return s(0==(this.negative|e.negative)),this.iuand(e)},a.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},a.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},a.prototype.iuxor=function(e){var t,i;this.length>e.length?(t=this,i=e):(t=e,i=this);for(var s=0;s<i.length;s++)this.words[s]=t.words[s]^i.words[s];if(this!==t)for(;s<t.length;s++)this.words[s]=t.words[s];return this.length=t.length,this.strip()},a.prototype.ixor=function(e){return s(0==(this.negative|e.negative)),this.iuxor(e)},a.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},a.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},a.prototype.inotn=function(e){s("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var r=0;r<t;r++)this.words[r]=67108863&~this.words[r];return i>0&&(this.words[r]=~this.words[r]&67108863>>26-i),this.strip()},a.prototype.notn=function(e){return this.clone().inotn(e)},a.prototype.setn=function(e,t){s("number"==typeof e&&e>=0);var i=e/26|0,r=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<r:this.words[i]&~(1<<r),this.strip()},a.prototype.iadd=function(e){var t,i,s;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(i=this,s=e):(i=e,s=this);for(var r=0,a=0;a<s.length;a++)t=(0|i.words[a])+(0|s.words[a])+r,this.words[a]=67108863&t,r=t>>>26;for(;0!==r&&a<i.length;a++)t=(0|i.words[a])+r,this.words[a]=67108863&t,r=t>>>26;if(this.length=i.length,0!==r)this.words[this.length]=r,this.length++;else if(i!==this)for(;a<i.length;a++)this.words[a]=i.words[a];return this},a.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},a.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var i,s,r=this.cmp(e);if(0===r)return this.negative=0,this.length=1,this.words[0]=0,this;r>0?(i=this,s=e):(i=e,s=this);for(var a=0,n=0;n<s.length;n++)a=(t=(0|i.words[n])-(0|s.words[n])+a)>>26,this.words[n]=67108863&t;for(;0!==a&&n<i.length;n++)a=(t=(0|i.words[n])+a)>>26,this.words[n]=67108863&t;if(0===a&&n<i.length&&i!==this)for(;n<i.length;n++)this.words[n]=i.words[n];return this.length=Math.max(this.length,n),i!==this&&(this.negative=1),this.strip()},a.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,i){var s,r,a,n=e.words,o=t.words,h=i.words,d=0,c=0|n[0],l=8191&c,u=c>>>13,f=0|n[1],p=8191&f,m=f>>>13,g=0|n[2],y=8191&g,b=g>>>13,v=0|n[3],w=8191&v,S=v>>>13,k=0|n[4],T=8191&k,_=k>>>13,O=0|n[5],M=8191&O,I=O>>>13,x=0|n[6],C=8191&x,P=x>>>13,A=0|n[7],N=8191&A,B=A>>>13,E=0|n[8],V=8191&E,L=E>>>13,R=0|n[9],D=8191&R,F=R>>>13,q=0|o[0],G=8191&q,H=q>>>13,U=0|o[1],j=8191&U,W=U>>>13,z=0|o[2],K=8191&z,X=z>>>13,Z=0|o[3],Y=8191&Z,Q=Z>>>13,J=0|o[4],$=8191&J,ee=J>>>13,te=0|o[5],ie=8191&te,se=te>>>13,re=0|o[6],ae=8191&re,ne=re>>>13,oe=0|o[7],he=8191&oe,de=oe>>>13,ce=0|o[8],le=8191&ce,ue=ce>>>13,fe=0|o[9],pe=8191&fe,me=fe>>>13;i.negative=e.negative^t.negative,i.length=19;var ge=(d+(s=Math.imul(l,G))|0)+((8191&(r=(r=Math.imul(l,H))+Math.imul(u,G)|0))<<13)|0;d=((a=Math.imul(u,H))+(r>>>13)|0)+(ge>>>26)|0,ge&=67108863,s=Math.imul(p,G),r=(r=Math.imul(p,H))+Math.imul(m,G)|0,a=Math.imul(m,H);var ye=(d+(s=s+Math.imul(l,j)|0)|0)+((8191&(r=(r=r+Math.imul(l,W)|0)+Math.imul(u,j)|0))<<13)|0;d=((a=a+Math.imul(u,W)|0)+(r>>>13)|0)+(ye>>>26)|0,ye&=67108863,s=Math.imul(y,G),r=(r=Math.imul(y,H))+Math.imul(b,G)|0,a=Math.imul(b,H),s=s+Math.imul(p,j)|0,r=(r=r+Math.imul(p,W)|0)+Math.imul(m,j)|0,a=a+Math.imul(m,W)|0;var be=(d+(s=s+Math.imul(l,K)|0)|0)+((8191&(r=(r=r+Math.imul(l,X)|0)+Math.imul(u,K)|0))<<13)|0;d=((a=a+Math.imul(u,X)|0)+(r>>>13)|0)+(be>>>26)|0,be&=67108863,s=Math.imul(w,G),r=(r=Math.imul(w,H))+Math.imul(S,G)|0,a=Math.imul(S,H),s=s+Math.imul(y,j)|0,r=(r=r+Math.imul(y,W)|0)+Math.imul(b,j)|0,a=a+Math.imul(b,W)|0,s=s+Math.imul(p,K)|0,r=(r=r+Math.imul(p,X)|0)+Math.imul(m,K)|0,a=a+Math.imul(m,X)|0;var ve=(d+(s=s+Math.imul(l,Y)|0)|0)+((8191&(r=(r=r+Math.imul(l,Q)|0)+Math.imul(u,Y)|0))<<13)|0;d=((a=a+Math.imul(u,Q)|0)+(r>>>13)|0)+(ve>>>26)|0,ve&=67108863,s=Math.imul(T,G),r=(r=Math.imul(T,H))+Math.imul(_,G)|0,a=Math.imul(_,H),s=s+Math.imul(w,j)|0,r=(r=r+Math.imul(w,W)|0)+Math.imul(S,j)|0,a=a+Math.imul(S,W)|0,s=s+Math.imul(y,K)|0,r=(r=r+Math.imul(y,X)|0)+Math.imul(b,K)|0,a=a+Math.imul(b,X)|0,s=s+Math.imul(p,Y)|0,r=(r=r+Math.imul(p,Q)|0)+Math.imul(m,Y)|0,a=a+Math.imul(m,Q)|0;var we=(d+(s=s+Math.imul(l,$)|0)|0)+((8191&(r=(r=r+Math.imul(l,ee)|0)+Math.imul(u,$)|0))<<13)|0;d=((a=a+Math.imul(u,ee)|0)+(r>>>13)|0)+(we>>>26)|0,we&=67108863,s=Math.imul(M,G),r=(r=Math.imul(M,H))+Math.imul(I,G)|0,a=Math.imul(I,H),s=s+Math.imul(T,j)|0,r=(r=r+Math.imul(T,W)|0)+Math.imul(_,j)|0,a=a+Math.imul(_,W)|0,s=s+Math.imul(w,K)|0,r=(r=r+Math.imul(w,X)|0)+Math.imul(S,K)|0,a=a+Math.imul(S,X)|0,s=s+Math.imul(y,Y)|0,r=(r=r+Math.imul(y,Q)|0)+Math.imul(b,Y)|0,a=a+Math.imul(b,Q)|0,s=s+Math.imul(p,$)|0,r=(r=r+Math.imul(p,ee)|0)+Math.imul(m,$)|0,a=a+Math.imul(m,ee)|0;var Se=(d+(s=s+Math.imul(l,ie)|0)|0)+((8191&(r=(r=r+Math.imul(l,se)|0)+Math.imul(u,ie)|0))<<13)|0;d=((a=a+Math.imul(u,se)|0)+(r>>>13)|0)+(Se>>>26)|0,Se&=67108863,s=Math.imul(C,G),r=(r=Math.imul(C,H))+Math.imul(P,G)|0,a=Math.imul(P,H),s=s+Math.imul(M,j)|0,r=(r=r+Math.imul(M,W)|0)+Math.imul(I,j)|0,a=a+Math.imul(I,W)|0,s=s+Math.imul(T,K)|0,r=(r=r+Math.imul(T,X)|0)+Math.imul(_,K)|0,a=a+Math.imul(_,X)|0,s=s+Math.imul(w,Y)|0,r=(r=r+Math.imul(w,Q)|0)+Math.imul(S,Y)|0,a=a+Math.imul(S,Q)|0,s=s+Math.imul(y,$)|0,r=(r=r+Math.imul(y,ee)|0)+Math.imul(b,$)|0,a=a+Math.imul(b,ee)|0,s=s+Math.imul(p,ie)|0,r=(r=r+Math.imul(p,se)|0)+Math.imul(m,ie)|0,a=a+Math.imul(m,se)|0;var ke=(d+(s=s+Math.imul(l,ae)|0)|0)+((8191&(r=(r=r+Math.imul(l,ne)|0)+Math.imul(u,ae)|0))<<13)|0;d=((a=a+Math.imul(u,ne)|0)+(r>>>13)|0)+(ke>>>26)|0,ke&=67108863,s=Math.imul(N,G),r=(r=Math.imul(N,H))+Math.imul(B,G)|0,a=Math.imul(B,H),s=s+Math.imul(C,j)|0,r=(r=r+Math.imul(C,W)|0)+Math.imul(P,j)|0,a=a+Math.imul(P,W)|0,s=s+Math.imul(M,K)|0,r=(r=r+Math.imul(M,X)|0)+Math.imul(I,K)|0,a=a+Math.imul(I,X)|0,s=s+Math.imul(T,Y)|0,r=(r=r+Math.imul(T,Q)|0)+Math.imul(_,Y)|0,a=a+Math.imul(_,Q)|0,s=s+Math.imul(w,$)|0,r=(r=r+Math.imul(w,ee)|0)+Math.imul(S,$)|0,a=a+Math.imul(S,ee)|0,s=s+Math.imul(y,ie)|0,r=(r=r+Math.imul(y,se)|0)+Math.imul(b,ie)|0,a=a+Math.imul(b,se)|0,s=s+Math.imul(p,ae)|0,r=(r=r+Math.imul(p,ne)|0)+Math.imul(m,ae)|0,a=a+Math.imul(m,ne)|0;var Te=(d+(s=s+Math.imul(l,he)|0)|0)+((8191&(r=(r=r+Math.imul(l,de)|0)+Math.imul(u,he)|0))<<13)|0;d=((a=a+Math.imul(u,de)|0)+(r>>>13)|0)+(Te>>>26)|0,Te&=67108863,s=Math.imul(V,G),r=(r=Math.imul(V,H))+Math.imul(L,G)|0,a=Math.imul(L,H),s=s+Math.imul(N,j)|0,r=(r=r+Math.imul(N,W)|0)+Math.imul(B,j)|0,a=a+Math.imul(B,W)|0,s=s+Math.imul(C,K)|0,r=(r=r+Math.imul(C,X)|0)+Math.imul(P,K)|0,a=a+Math.imul(P,X)|0,s=s+Math.imul(M,Y)|0,r=(r=r+Math.imul(M,Q)|0)+Math.imul(I,Y)|0,a=a+Math.imul(I,Q)|0,s=s+Math.imul(T,$)|0,r=(r=r+Math.imul(T,ee)|0)+Math.imul(_,$)|0,a=a+Math.imul(_,ee)|0,s=s+Math.imul(w,ie)|0,r=(r=r+Math.imul(w,se)|0)+Math.imul(S,ie)|0,a=a+Math.imul(S,se)|0,s=s+Math.imul(y,ae)|0,r=(r=r+Math.imul(y,ne)|0)+Math.imul(b,ae)|0,a=a+Math.imul(b,ne)|0,s=s+Math.imul(p,he)|0,r=(r=r+Math.imul(p,de)|0)+Math.imul(m,he)|0,a=a+Math.imul(m,de)|0;var _e=(d+(s=s+Math.imul(l,le)|0)|0)+((8191&(r=(r=r+Math.imul(l,ue)|0)+Math.imul(u,le)|0))<<13)|0;d=((a=a+Math.imul(u,ue)|0)+(r>>>13)|0)+(_e>>>26)|0,_e&=67108863,s=Math.imul(D,G),r=(r=Math.imul(D,H))+Math.imul(F,G)|0,a=Math.imul(F,H),s=s+Math.imul(V,j)|0,r=(r=r+Math.imul(V,W)|0)+Math.imul(L,j)|0,a=a+Math.imul(L,W)|0,s=s+Math.imul(N,K)|0,r=(r=r+Math.imul(N,X)|0)+Math.imul(B,K)|0,a=a+Math.imul(B,X)|0,s=s+Math.imul(C,Y)|0,r=(r=r+Math.imul(C,Q)|0)+Math.imul(P,Y)|0,a=a+Math.imul(P,Q)|0,s=s+Math.imul(M,$)|0,r=(r=r+Math.imul(M,ee)|0)+Math.imul(I,$)|0,a=a+Math.imul(I,ee)|0,s=s+Math.imul(T,ie)|0,r=(r=r+Math.imul(T,se)|0)+Math.imul(_,ie)|0,a=a+Math.imul(_,se)|0,s=s+Math.imul(w,ae)|0,r=(r=r+Math.imul(w,ne)|0)+Math.imul(S,ae)|0,a=a+Math.imul(S,ne)|0,s=s+Math.imul(y,he)|0,r=(r=r+Math.imul(y,de)|0)+Math.imul(b,he)|0,a=a+Math.imul(b,de)|0,s=s+Math.imul(p,le)|0,r=(r=r+Math.imul(p,ue)|0)+Math.imul(m,le)|0,a=a+Math.imul(m,ue)|0;var Oe=(d+(s=s+Math.imul(l,pe)|0)|0)+((8191&(r=(r=r+Math.imul(l,me)|0)+Math.imul(u,pe)|0))<<13)|0;d=((a=a+Math.imul(u,me)|0)+(r>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,s=Math.imul(D,j),r=(r=Math.imul(D,W))+Math.imul(F,j)|0,a=Math.imul(F,W),s=s+Math.imul(V,K)|0,r=(r=r+Math.imul(V,X)|0)+Math.imul(L,K)|0,a=a+Math.imul(L,X)|0,s=s+Math.imul(N,Y)|0,r=(r=r+Math.imul(N,Q)|0)+Math.imul(B,Y)|0,a=a+Math.imul(B,Q)|0,s=s+Math.imul(C,$)|0,r=(r=r+Math.imul(C,ee)|0)+Math.imul(P,$)|0,a=a+Math.imul(P,ee)|0,s=s+Math.imul(M,ie)|0,r=(r=r+Math.imul(M,se)|0)+Math.imul(I,ie)|0,a=a+Math.imul(I,se)|0,s=s+Math.imul(T,ae)|0,r=(r=r+Math.imul(T,ne)|0)+Math.imul(_,ae)|0,a=a+Math.imul(_,ne)|0,s=s+Math.imul(w,he)|0,r=(r=r+Math.imul(w,de)|0)+Math.imul(S,he)|0,a=a+Math.imul(S,de)|0,s=s+Math.imul(y,le)|0,r=(r=r+Math.imul(y,ue)|0)+Math.imul(b,le)|0,a=a+Math.imul(b,ue)|0;var Me=(d+(s=s+Math.imul(p,pe)|0)|0)+((8191&(r=(r=r+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;d=((a=a+Math.imul(m,me)|0)+(r>>>13)|0)+(Me>>>26)|0,Me&=67108863,s=Math.imul(D,K),r=(r=Math.imul(D,X))+Math.imul(F,K)|0,a=Math.imul(F,X),s=s+Math.imul(V,Y)|0,r=(r=r+Math.imul(V,Q)|0)+Math.imul(L,Y)|0,a=a+Math.imul(L,Q)|0,s=s+Math.imul(N,$)|0,r=(r=r+Math.imul(N,ee)|0)+Math.imul(B,$)|0,a=a+Math.imul(B,ee)|0,s=s+Math.imul(C,ie)|0,r=(r=r+Math.imul(C,se)|0)+Math.imul(P,ie)|0,a=a+Math.imul(P,se)|0,s=s+Math.imul(M,ae)|0,r=(r=r+Math.imul(M,ne)|0)+Math.imul(I,ae)|0,a=a+Math.imul(I,ne)|0,s=s+Math.imul(T,he)|0,r=(r=r+Math.imul(T,de)|0)+Math.imul(_,he)|0,a=a+Math.imul(_,de)|0,s=s+Math.imul(w,le)|0,r=(r=r+Math.imul(w,ue)|0)+Math.imul(S,le)|0,a=a+Math.imul(S,ue)|0;var Ie=(d+(s=s+Math.imul(y,pe)|0)|0)+((8191&(r=(r=r+Math.imul(y,me)|0)+Math.imul(b,pe)|0))<<13)|0;d=((a=a+Math.imul(b,me)|0)+(r>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,s=Math.imul(D,Y),r=(r=Math.imul(D,Q))+Math.imul(F,Y)|0,a=Math.imul(F,Q),s=s+Math.imul(V,$)|0,r=(r=r+Math.imul(V,ee)|0)+Math.imul(L,$)|0,a=a+Math.imul(L,ee)|0,s=s+Math.imul(N,ie)|0,r=(r=r+Math.imul(N,se)|0)+Math.imul(B,ie)|0,a=a+Math.imul(B,se)|0,s=s+Math.imul(C,ae)|0,r=(r=r+Math.imul(C,ne)|0)+Math.imul(P,ae)|0,a=a+Math.imul(P,ne)|0,s=s+Math.imul(M,he)|0,r=(r=r+Math.imul(M,de)|0)+Math.imul(I,he)|0,a=a+Math.imul(I,de)|0,s=s+Math.imul(T,le)|0,r=(r=r+Math.imul(T,ue)|0)+Math.imul(_,le)|0,a=a+Math.imul(_,ue)|0;var xe=(d+(s=s+Math.imul(w,pe)|0)|0)+((8191&(r=(r=r+Math.imul(w,me)|0)+Math.imul(S,pe)|0))<<13)|0;d=((a=a+Math.imul(S,me)|0)+(r>>>13)|0)+(xe>>>26)|0,xe&=67108863,s=Math.imul(D,$),r=(r=Math.imul(D,ee))+Math.imul(F,$)|0,a=Math.imul(F,ee),s=s+Math.imul(V,ie)|0,r=(r=r+Math.imul(V,se)|0)+Math.imul(L,ie)|0,a=a+Math.imul(L,se)|0,s=s+Math.imul(N,ae)|0,r=(r=r+Math.imul(N,ne)|0)+Math.imul(B,ae)|0,a=a+Math.imul(B,ne)|0,s=s+Math.imul(C,he)|0,r=(r=r+Math.imul(C,de)|0)+Math.imul(P,he)|0,a=a+Math.imul(P,de)|0,s=s+Math.imul(M,le)|0,r=(r=r+Math.imul(M,ue)|0)+Math.imul(I,le)|0,a=a+Math.imul(I,ue)|0;var Ce=(d+(s=s+Math.imul(T,pe)|0)|0)+((8191&(r=(r=r+Math.imul(T,me)|0)+Math.imul(_,pe)|0))<<13)|0;d=((a=a+Math.imul(_,me)|0)+(r>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,s=Math.imul(D,ie),r=(r=Math.imul(D,se))+Math.imul(F,ie)|0,a=Math.imul(F,se),s=s+Math.imul(V,ae)|0,r=(r=r+Math.imul(V,ne)|0)+Math.imul(L,ae)|0,a=a+Math.imul(L,ne)|0,s=s+Math.imul(N,he)|0,r=(r=r+Math.imul(N,de)|0)+Math.imul(B,he)|0,a=a+Math.imul(B,de)|0,s=s+Math.imul(C,le)|0,r=(r=r+Math.imul(C,ue)|0)+Math.imul(P,le)|0,a=a+Math.imul(P,ue)|0;var Pe=(d+(s=s+Math.imul(M,pe)|0)|0)+((8191&(r=(r=r+Math.imul(M,me)|0)+Math.imul(I,pe)|0))<<13)|0;d=((a=a+Math.imul(I,me)|0)+(r>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,s=Math.imul(D,ae),r=(r=Math.imul(D,ne))+Math.imul(F,ae)|0,a=Math.imul(F,ne),s=s+Math.imul(V,he)|0,r=(r=r+Math.imul(V,de)|0)+Math.imul(L,he)|0,a=a+Math.imul(L,de)|0,s=s+Math.imul(N,le)|0,r=(r=r+Math.imul(N,ue)|0)+Math.imul(B,le)|0,a=a+Math.imul(B,ue)|0;var Ae=(d+(s=s+Math.imul(C,pe)|0)|0)+((8191&(r=(r=r+Math.imul(C,me)|0)+Math.imul(P,pe)|0))<<13)|0;d=((a=a+Math.imul(P,me)|0)+(r>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,s=Math.imul(D,he),r=(r=Math.imul(D,de))+Math.imul(F,he)|0,a=Math.imul(F,de),s=s+Math.imul(V,le)|0,r=(r=r+Math.imul(V,ue)|0)+Math.imul(L,le)|0,a=a+Math.imul(L,ue)|0;var Ne=(d+(s=s+Math.imul(N,pe)|0)|0)+((8191&(r=(r=r+Math.imul(N,me)|0)+Math.imul(B,pe)|0))<<13)|0;d=((a=a+Math.imul(B,me)|0)+(r>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,s=Math.imul(D,le),r=(r=Math.imul(D,ue))+Math.imul(F,le)|0,a=Math.imul(F,ue);var Be=(d+(s=s+Math.imul(V,pe)|0)|0)+((8191&(r=(r=r+Math.imul(V,me)|0)+Math.imul(L,pe)|0))<<13)|0;d=((a=a+Math.imul(L,me)|0)+(r>>>13)|0)+(Be>>>26)|0,Be&=67108863;var Ee=(d+(s=Math.imul(D,pe))|0)+((8191&(r=(r=Math.imul(D,me))+Math.imul(F,pe)|0))<<13)|0;return d=((a=Math.imul(F,me))+(r>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,h[0]=ge,h[1]=ye,h[2]=be,h[3]=ve,h[4]=we,h[5]=Se,h[6]=ke,h[7]=Te,h[8]=_e,h[9]=Oe,h[10]=Me,h[11]=Ie,h[12]=xe,h[13]=Ce,h[14]=Pe,h[15]=Ae,h[16]=Ne,h[17]=Be,h[18]=Ee,0!==d&&(h[19]=d,i.length++),i};function m(e,t,i){return(new g).mulp(e,t,i)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=f),a.prototype.mulTo=function(e,t){var i,s=this.length+e.length;return i=10===this.length&&10===e.length?p(this,e,t):s<63?f(this,e,t):s<1024?function(e,t,i){i.negative=t.negative^e.negative,i.length=e.length+t.length;for(var s=0,r=0,a=0;a<i.length-1;a++){var n=r;r=0;for(var o=67108863&s,h=Math.min(a,t.length-1),d=Math.max(0,a-e.length+1);d<=h;d++){var c=a-d,l=(0|e.words[c])*(0|t.words[d]),u=67108863&l;o=67108863&(u=u+o|0),r+=(n=(n=n+(l/67108864|0)|0)+(u>>>26)|0)>>>26,n&=67108863}i.words[a]=o,s=n,n=r}return 0!==s?i.words[a]=s:i.length--,i.strip()}(this,e,t):m(this,e,t),i},g.prototype.makeRBT=function(e){for(var t=new Array(e),i=a.prototype._countBits(e)-1,s=0;s<e;s++)t[s]=this.revBin(s,i,e);return t},g.prototype.revBin=function(e,t,i){if(0===e||e===i-1)return e;for(var s=0,r=0;r<t;r++)s|=(1&e)<<t-r-1,e>>=1;return s},g.prototype.permute=function(e,t,i,s,r,a){for(var n=0;n<a;n++)s[n]=t[e[n]],r[n]=i[e[n]]},g.prototype.transform=function(e,t,i,s,r,a){this.permute(a,e,t,i,s,r);for(var n=1;n<r;n<<=1)for(var o=n<<1,h=Math.cos(2*Math.PI/o),d=Math.sin(2*Math.PI/o),c=0;c<r;c+=o)for(var l=h,u=d,f=0;f<n;f++){var p=i[c+f],m=s[c+f],g=i[c+f+n],y=s[c+f+n],b=l*g-u*y;y=l*y+u*g,g=b,i[c+f]=p+g,s[c+f]=m+y,i[c+f+n]=p-g,s[c+f+n]=m-y,f!==o&&(b=h*l-d*u,u=h*u+d*l,l=b)}},g.prototype.guessLen13b=function(e,t){var i=1|Math.max(t,e),s=1&i,r=0;for(i=i/2|0;i;i>>>=1)r++;return 1<<r+1+s},g.prototype.conjugate=function(e,t,i){if(!(i<=1))for(var s=0;s<i/2;s++){var r=e[s];e[s]=e[i-s-1],e[i-s-1]=r,r=t[s],t[s]=-t[i-s-1],t[i-s-1]=-r}},g.prototype.normalize13b=function(e,t){for(var i=0,s=0;s<t/2;s++){var r=8192*Math.round(e[2*s+1]/t)+Math.round(e[2*s]/t)+i;e[s]=67108863&r,i=r<67108864?0:r/67108864|0}return e},g.prototype.convert13b=function(e,t,i,r){for(var a=0,n=0;n<t;n++)a+=0|e[n],i[2*n]=8191&a,a>>>=13,i[2*n+1]=8191&a,a>>>=13;for(n=2*t;n<r;++n)i[n]=0;s(0===a),s(0==(-8192&a))},g.prototype.stub=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=0;return t},g.prototype.mulp=function(e,t,i){var s=2*this.guessLen13b(e.length,t.length),r=this.makeRBT(s),a=this.stub(s),n=new Array(s),o=new Array(s),h=new Array(s),d=new Array(s),c=new Array(s),l=new Array(s),u=i.words;u.length=s,this.convert13b(e.words,e.length,n,s),this.convert13b(t.words,t.length,d,s),this.transform(n,a,o,h,s,r),this.transform(d,a,c,l,s,r);for(var f=0;f<s;f++){var p=o[f]*c[f]-h[f]*l[f];h[f]=o[f]*l[f]+h[f]*c[f],o[f]=p}return this.conjugate(o,h,s),this.transform(o,h,u,a,s,r),this.conjugate(u,a,s),this.normalize13b(u,s),i.negative=e.negative^t.negative,i.length=e.length+t.length,i.strip()},a.prototype.mul=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},a.prototype.mulf=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),m(this,e,t)},a.prototype.imul=function(e){return this.clone().mulTo(e,this)},a.prototype.imuln=function(e){s("number"==typeof e),s(e<67108864);for(var t=0,i=0;i<this.length;i++){var r=(0|this.words[i])*e,a=(67108863&r)+(67108863&t);t>>=26,t+=r/67108864|0,t+=a>>>26,this.words[i]=67108863&a}return 0!==t&&(this.words[i]=t,this.length++),this},a.prototype.muln=function(e){return this.clone().imuln(e)},a.prototype.sqr=function(){return this.mul(this)},a.prototype.isqr=function(){return this.imul(this.clone())},a.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),i=0;i<t.length;i++){var s=i/26|0,r=i%26;t[i]=(e.words[s]&1<<r)>>>r}return t}(e);if(0===t.length)return new a(1);for(var i=this,s=0;s<t.length&&0===t[s];s++,i=i.sqr());if(++s<t.length)for(var r=i.sqr();s<t.length;s++,r=r.sqr())0!==t[s]&&(i=i.mul(r));return i},a.prototype.iushln=function(e){s("number"==typeof e&&e>=0);var t,i=e%26,r=(e-i)/26,a=67108863>>>26-i<<26-i;if(0!==i){var n=0;for(t=0;t<this.length;t++){var o=this.words[t]&a,h=(0|this.words[t])-o<<i;this.words[t]=h|n,n=o>>>26-i}n&&(this.words[t]=n,this.length++)}if(0!==r){for(t=this.length-1;t>=0;t--)this.words[t+r]=this.words[t];for(t=0;t<r;t++)this.words[t]=0;this.length+=r}return this.strip()},a.prototype.ishln=function(e){return s(0===this.negative),this.iushln(e)},a.prototype.iushrn=function(e,t,i){var r;s("number"==typeof e&&e>=0),r=t?(t-t%26)/26:0;var a=e%26,n=Math.min((e-a)/26,this.length),o=67108863^67108863>>>a<<a,h=i;if(r-=n,r=Math.max(0,r),h){for(var d=0;d<n;d++)h.words[d]=this.words[d];h.length=n}if(0===n);else if(this.length>n)for(this.length-=n,d=0;d<this.length;d++)this.words[d]=this.words[d+n];else this.words[0]=0,this.length=1;var c=0;for(d=this.length-1;d>=0&&(0!==c||d>=r);d--){var l=0|this.words[d];this.words[d]=c<<26-a|l>>>a,c=l&o}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},a.prototype.ishrn=function(e,t,i){return s(0===this.negative),this.iushrn(e,t,i)},a.prototype.shln=function(e){return this.clone().ishln(e)},a.prototype.ushln=function(e){return this.clone().iushln(e)},a.prototype.shrn=function(e){return this.clone().ishrn(e)},a.prototype.ushrn=function(e){return this.clone().iushrn(e)},a.prototype.testn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,r=1<<t;return!(this.length<=i)&&!!(this.words[i]&r)},a.prototype.imaskn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(s(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var r=67108863^67108863>>>t<<t;this.words[this.length-1]&=r}return this.strip()},a.prototype.maskn=function(e){return this.clone().imaskn(e)},a.prototype.iaddn=function(e){return s("number"==typeof e),s(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},a.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},a.prototype.isubn=function(e){if(s("number"==typeof e),s(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},a.prototype.addn=function(e){return this.clone().iaddn(e)},a.prototype.subn=function(e){return this.clone().isubn(e)},a.prototype.iabs=function(){return this.negative=0,this},a.prototype.abs=function(){return this.clone().iabs()},a.prototype._ishlnsubmul=function(e,t,i){var r,a,n=e.length+i;this._expand(n);var o=0;for(r=0;r<e.length;r++){a=(0|this.words[r+i])+o;var h=(0|e.words[r])*t;o=((a-=67108863&h)>>26)-(h/67108864|0),this.words[r+i]=67108863&a}for(;r<this.length-i;r++)o=(a=(0|this.words[r+i])+o)>>26,this.words[r+i]=67108863&a;if(0===o)return this.strip();for(s(-1===o),o=0,r=0;r<this.length;r++)o=(a=-(0|this.words[r])+o)>>26,this.words[r]=67108863&a;return this.negative=1,this.strip()},a.prototype._wordDiv=function(e,t){var i=(this.length,e.length),s=this.clone(),r=e,n=0|r.words[r.length-1];0!==(i=26-this._countBits(n))&&(r=r.ushln(i),s.iushln(i),n=0|r.words[r.length-1]);var o,h=s.length-r.length;if("mod"!==t){(o=new a(null)).length=h+1,o.words=new Array(o.length);for(var d=0;d<o.length;d++)o.words[d]=0}var c=s.clone()._ishlnsubmul(r,1,h);0===c.negative&&(s=c,o&&(o.words[h]=1));for(var l=h-1;l>=0;l--){var u=67108864*(0|s.words[r.length+l])+(0|s.words[r.length+l-1]);for(u=Math.min(u/n|0,67108863),s._ishlnsubmul(r,u,l);0!==s.negative;)u--,s.negative=0,s._ishlnsubmul(r,1,l),s.isZero()||(s.negative^=1);o&&(o.words[l]=u)}return o&&o.strip(),s.strip(),"div"!==t&&0!==i&&s.iushrn(i),{div:o||null,mod:s}},a.prototype.divmod=function(e,t,i){return s(!e.isZero()),this.isZero()?{div:new a(0),mod:new a(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(r=o.div.neg()),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.iadd(e)),{div:r,mod:n}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(r=o.div.neg()),{div:r,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.isub(e)),{div:o.div,mod:n}):e.length>this.length||this.cmp(e)<0?{div:new a(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new a(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new a(this.modn(e.words[0]))}:this._wordDiv(e,t);var r,n,o},a.prototype.div=function(e){return this.divmod(e,"div",!1).div},a.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},a.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},a.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var i=0!==t.div.negative?t.mod.isub(e):t.mod,s=e.ushrn(1),r=e.andln(1),a=i.cmp(s);return a<0||1===r&&0===a?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},a.prototype.modn=function(e){s(e<=67108863);for(var t=(1<<26)%e,i=0,r=this.length-1;r>=0;r--)i=(t*i+(0|this.words[r]))%e;return i},a.prototype.idivn=function(e){s(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var r=(0|this.words[i])+67108864*t;this.words[i]=r/e|0,t=r%e}return this.strip()},a.prototype.divn=function(e){return this.clone().idivn(e)},a.prototype.egcd=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r=new a(1),n=new a(0),o=new a(0),h=new a(1),d=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++d;for(var c=i.clone(),l=t.clone();!t.isZero();){for(var u=0,f=1;0==(t.words[0]&f)&&u<26;++u,f<<=1);if(u>0)for(t.iushrn(u);u-- >0;)(r.isOdd()||n.isOdd())&&(r.iadd(c),n.isub(l)),r.iushrn(1),n.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(o.isOdd()||h.isOdd())&&(o.iadd(c),h.isub(l)),o.iushrn(1),h.iushrn(1);t.cmp(i)>=0?(t.isub(i),r.isub(o),n.isub(h)):(i.isub(t),o.isub(r),h.isub(n))}return{a:o,b:h,gcd:i.iushln(d)}},a.prototype._invmp=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r,n=new a(1),o=new a(0),h=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var d=0,c=1;0==(t.words[0]&c)&&d<26;++d,c<<=1);if(d>0)for(t.iushrn(d);d-- >0;)n.isOdd()&&n.iadd(h),n.iushrn(1);for(var l=0,u=1;0==(i.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(i.iushrn(l);l-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(o)):(i.isub(t),o.isub(n))}return(r=0===t.cmpn(1)?n:o).cmpn(0)<0&&r.iadd(e),r},a.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),i=e.clone();t.negative=0,i.negative=0;for(var s=0;t.isEven()&&i.isEven();s++)t.iushrn(1),i.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;i.isEven();)i.iushrn(1);var r=t.cmp(i);if(r<0){var a=t;t=i,i=a}else if(0===r||0===i.cmpn(1))break;t.isub(i)}return i.iushln(s)},a.prototype.invm=function(e){return this.egcd(e).a.umod(e)},a.prototype.isEven=function(){return 0==(1&this.words[0])},a.prototype.isOdd=function(){return 1==(1&this.words[0])},a.prototype.andln=function(e){return this.words[0]&e},a.prototype.bincn=function(e){s("number"==typeof e);var t=e%26,i=(e-t)/26,r=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=r,this;for(var a=r,n=i;0!==a&&n<this.length;n++){var o=0|this.words[n];a=(o+=a)>>>26,o&=67108863,this.words[n]=o}return 0!==a&&(this.words[n]=a,this.length++),this},a.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},a.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)t=1;else{i&&(e=-e),s(e<=67108863,"Number is too big");var r=0|this.words[0];t=r===e?0:r<e?-1:1}return 0!==this.negative?0|-t:t},a.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},a.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,i=this.length-1;i>=0;i--){var s=0|this.words[i],r=0|e.words[i];if(s!==r){s<r?t=-1:s>r&&(t=1);break}}return t},a.prototype.gtn=function(e){return 1===this.cmpn(e)},a.prototype.gt=function(e){return 1===this.cmp(e)},a.prototype.gten=function(e){return this.cmpn(e)>=0},a.prototype.gte=function(e){return this.cmp(e)>=0},a.prototype.ltn=function(e){return-1===this.cmpn(e)},a.prototype.lt=function(e){return-1===this.cmp(e)},a.prototype.lten=function(e){return this.cmpn(e)<=0},a.prototype.lte=function(e){return this.cmp(e)<=0},a.prototype.eqn=function(e){return 0===this.cmpn(e)},a.prototype.eq=function(e){return 0===this.cmp(e)},a.red=function(e){return new T(e)},a.prototype.toRed=function(e){return s(!this.red,"Already a number in reduction context"),s(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},a.prototype.fromRed=function(){return s(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},a.prototype._forceRed=function(e){return this.red=e,this},a.prototype.forceRed=function(e){return s(!this.red,"Already a number in reduction context"),this._forceRed(e)},a.prototype.redAdd=function(e){return s(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},a.prototype.redIAdd=function(e){return s(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},a.prototype.redSub=function(e){return s(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},a.prototype.redISub=function(e){return s(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},a.prototype.redShl=function(e){return s(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},a.prototype.redMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},a.prototype.redIMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},a.prototype.redSqr=function(){return s(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},a.prototype.redISqr=function(){return s(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},a.prototype.redSqrt=function(){return s(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},a.prototype.redInvm=function(){return s(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},a.prototype.redNeg=function(){return s(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},a.prototype.redPow=function(e){return s(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var y={k256:null,p224:null,p192:null,p25519:null};function b(e,t){this.name=e,this.p=new a(t,16),this.n=this.p.bitLength(),this.k=new a(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){b.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){b.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function S(){b.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function k(){b.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function T(e){if("string"==typeof e){var t=a._prime(e);this.m=t.p,this.prime=t}else s(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function _(e){T.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new a(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}b.prototype._tmp=function(){var e=new a(null);return e.words=new Array(Math.ceil(this.n/13)),e},b.prototype.ireduce=function(e){var t,i=e;do{this.split(i,this.tmp),t=(i=(i=this.imulK(i)).iadd(this.tmp)).bitLength()}while(t>this.n);var s=t<this.n?-1:i.ucmp(this.p);return 0===s?(i.words[0]=0,i.length=1):s>0?i.isub(this.p):void 0!==i.strip?i.strip():i._strip(),i},b.prototype.split=function(e,t){e.iushrn(this.n,0,t)},b.prototype.imulK=function(e){return e.imul(this.k)},r(v,b),v.prototype.split=function(e,t){for(var i=4194303,s=Math.min(e.length,9),r=0;r<s;r++)t.words[r]=e.words[r];if(t.length=s,e.length<=9)return e.words[0]=0,void(e.length=1);var a=e.words[9];for(t.words[t.length++]=a&i,r=10;r<e.length;r++){var n=0|e.words[r];e.words[r-10]=(n&i)<<4|a>>>22,a=n}a>>>=22,e.words[r-10]=a,0===a&&e.length>10?e.length-=10:e.length-=9},v.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,i=0;i<e.length;i++){var s=0|e.words[i];t+=977*s,e.words[i]=67108863&t,t=64*s+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},r(w,b),r(S,b),r(k,b),k.prototype.imulK=function(e){for(var t=0,i=0;i<e.length;i++){var s=19*(0|e.words[i])+t,r=67108863&s;s>>>=26,e.words[i]=r,t=s}return 0!==t&&(e.words[e.length++]=t),e},a._prime=function(e){if(y[e])return y[e];var t;if("k256"===e)t=new v;else if("p224"===e)t=new w;else if("p192"===e)t=new S;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new k}return y[e]=t,t},T.prototype._verify1=function(e){s(0===e.negative,"red works only with positives"),s(e.red,"red works only with red numbers")},T.prototype._verify2=function(e,t){s(0==(e.negative|t.negative),"red works only with positives"),s(e.red&&e.red===t.red,"red works only with red numbers")},T.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},T.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},T.prototype.add=function(e,t){this._verify2(e,t);var i=e.add(t);return i.cmp(this.m)>=0&&i.isub(this.m),i._forceRed(this)},T.prototype.iadd=function(e,t){this._verify2(e,t);var i=e.iadd(t);return i.cmp(this.m)>=0&&i.isub(this.m),i},T.prototype.sub=function(e,t){this._verify2(e,t);var i=e.sub(t);return i.cmpn(0)<0&&i.iadd(this.m),i._forceRed(this)},T.prototype.isub=function(e,t){this._verify2(e,t);var i=e.isub(t);return i.cmpn(0)<0&&i.iadd(this.m),i},T.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},T.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},T.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},T.prototype.isqr=function(e){return this.imul(e,e.clone())},T.prototype.sqr=function(e){return this.mul(e,e)},T.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(s(t%2==1),3===t){var i=this.m.add(new a(1)).iushrn(2);return this.pow(e,i)}for(var r=this.m.subn(1),n=0;!r.isZero()&&0===r.andln(1);)n++,r.iushrn(1);s(!r.isZero());var o=new a(1).toRed(this),h=o.redNeg(),d=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new a(2*c*c).toRed(this);0!==this.pow(c,d).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,r),u=this.pow(e,r.addn(1).iushrn(1)),f=this.pow(e,r),p=n;0!==f.cmp(o);){for(var m=f,g=0;0!==m.cmp(o);g++)m=m.redSqr();s(g<p);var y=this.pow(l,new a(1).iushln(p-g-1));u=u.redMul(y),l=y.redSqr(),f=f.redMul(l),p=g}return u},T.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},T.prototype.pow=function(e,t){if(t.isZero())return new a(1).toRed(this);if(0===t.cmpn(1))return e.clone();var i=new Array(16);i[0]=new a(1).toRed(this),i[1]=e;for(var s=2;s<i.length;s++)i[s]=this.mul(i[s-1],e);var r=i[0],n=0,o=0,h=t.bitLength()%26;for(0===h&&(h=26),s=t.length-1;s>=0;s--){for(var d=t.words[s],c=h-1;c>=0;c--){var l=d>>c&1;r!==i[0]&&(r=this.sqr(r)),0!==l||0!==n?(n<<=1,n|=l,(4===++o||0===s&&0===c)&&(r=this.mul(r,i[n]),o=0,n=0)):o=0}h=26}return r},T.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},T.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},a.mont=function(e){return new _(e)},r(_,T),_.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},_.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},_.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var i=e.imul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),a=r;return r.cmp(this.m)>=0?a=r.isub(this.m):r.cmpn(0)<0&&(a=r.iadd(this.m)),a._forceRed(this)},_.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new a(0)._forceRed(this);var i=e.mul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),n=r;return r.cmp(this.m)>=0?n=r.isub(this.m):r.cmpn(0)<0&&(n=r.iadd(this.m)),n._forceRed(this)},_.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=i.nmd(e),this)},48583:function(e,t,i){"use strict";var s=i(27418);function r(e,t){if(e===t)return 0;for(var i=e.length,s=t.length,r=0,a=Math.min(i,s);r<a;++r)if(e[r]!==t[r]){i=e[r],s=t[r];break}return i<s?-1:s<i?1:0}function a(e){return i.g.Buffer&&"function"==typeof i.g.Buffer.isBuffer?i.g.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}var n=i(30069),o=Object.prototype.hasOwnProperty,h=Array.prototype.slice,d="foo"===function(){}.name;function c(e){return Object.prototype.toString.call(e)}function l(e){return!a(e)&&("function"==typeof i.g.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}var u=e.exports=b,f=/\s*function\s+([^\(\s]*)\s*/;function p(e){if(n.isFunction(e)){if(d)return e.name;var t=e.toString().match(f);return t&&t[1]}}function m(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function g(e){if(d||!n.isFunction(e))return n.inspect(e);var t=p(e);return"[Function"+(t?": "+t:"")+"]"}function y(e,t,i,s,r){throw new u.AssertionError({message:i,actual:e,expected:t,operator:s,stackStartFunction:r})}function b(e,t){e||y(e,!0,t,"==",u.ok)}function v(e,t,i,s){if(e===t)return!0;if(a(e)&&a(t))return 0===r(e,t);if(n.isDate(e)&&n.isDate(t))return e.getTime()===t.getTime();if(n.isRegExp(e)&&n.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(l(e)&&l(t)&&c(e)===c(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===r(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(a(e)!==a(t))return!1;var o=(s=s||{actual:[],expected:[]}).actual.indexOf(e);return-1!==o&&o===s.expected.indexOf(t)||(s.actual.push(e),s.expected.push(t),function(e,t,i,s){if(null==e||null==t)return!1;if(n.isPrimitive(e)||n.isPrimitive(t))return e===t;if(i&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var r=w(e),a=w(t);if(r&&!a||!r&&a)return!1;if(r)return v(e=h.call(e),t=h.call(t),i);var o,d,c=T(e),l=T(t);if(c.length!==l.length)return!1;for(c.sort(),l.sort(),d=c.length-1;d>=0;d--)if(c[d]!==l[d])return!1;for(d=c.length-1;d>=0;d--)if(!v(e[o=c[d]],t[o],i,s))return!1;return!0}(e,t,i,s))}return i?e===t:e==t}function w(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function S(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&!0===t.call({},e)}function k(e,t,i,s){var r;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof i&&(s=i,i=null),r=function(e){var t;try{e()}catch(e){t=e}return t}(t),s=(i&&i.name?" ("+i.name+").":".")+(s?" "+s:"."),e&&!r&&y(r,i,"Missing expected exception"+s);var a="string"==typeof s,o=!e&&r&&!i;if((!e&&n.isError(r)&&a&&S(r,i)||o)&&y(r,i,"Got unwanted exception"+s),e&&r&&i&&!S(r,i)||!e&&r)throw r}u.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=function(e){return m(g(e.actual),128)+" "+e.operator+" "+m(g(e.expected),128)}(this),this.generatedMessage=!0);var t=e.stackStartFunction||y;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var i=new Error;if(i.stack){var s=i.stack,r=p(t),a=s.indexOf("\n"+r);if(a>=0){var n=s.indexOf("\n",a+1);s=s.substring(n+1)}this.stack=s}}},n.inherits(u.AssertionError,Error),u.fail=y,u.ok=b,u.equal=function(e,t,i){e!=t&&y(e,t,i,"==",u.equal)},u.notEqual=function(e,t,i){e==t&&y(e,t,i,"!=",u.notEqual)},u.deepEqual=function(e,t,i){v(e,t,!1)||y(e,t,i,"deepEqual",u.deepEqual)},u.deepStrictEqual=function(e,t,i){v(e,t,!0)||y(e,t,i,"deepStrictEqual",u.deepStrictEqual)},u.notDeepEqual=function(e,t,i){v(e,t,!1)&&y(e,t,i,"notDeepEqual",u.notDeepEqual)},u.notDeepStrictEqual=function e(t,i,s){v(t,i,!0)&&y(t,i,s,"notDeepStrictEqual",e)},u.strictEqual=function(e,t,i){e!==t&&y(e,t,i,"===",u.strictEqual)},u.notStrictEqual=function(e,t,i){e===t&&y(e,t,i,"!==",u.notStrictEqual)},u.throws=function(e,t,i){k(!0,e,t,i)},u.doesNotThrow=function(e,t,i){k(!1,e,t,i)},u.ifError=function(e){if(e)throw e},u.strict=s((function e(t,i){t||y(t,!0,i,"==",e)}),u,{equal:u.strictEqual,deepEqual:u.deepStrictEqual,notEqual:u.notStrictEqual,notDeepEqual:u.notDeepStrictEqual}),u.strict.strict=u.strict;var T=Object.keys||function(e){var t=[];for(var i in e)o.call(e,i)&&t.push(i);return t}},16076:function(e){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},52014:function(e){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},30069:function(e,t,i){var s=i(34155),r=/%[sdj%]/g;t.format=function(e){if(!y(e)){for(var t=[],i=0;i<arguments.length;i++)t.push(o(arguments[i]));return t.join(" ")}i=1;for(var s=arguments,a=s.length,n=String(e).replace(r,(function(e){if("%%"===e)return"%";if(i>=a)return e;switch(e){case"%s":return String(s[i++]);case"%d":return Number(s[i++]);case"%j":try{return JSON.stringify(s[i++])}catch(e){return"[Circular]"}default:return e}})),h=s[i];i<a;h=s[++i])m(h)||!w(h)?n+=" "+h:n+=" "+o(h);return n},t.deprecate=function(e,r){if(b(i.g.process))return function(){return t.deprecate(e,r).apply(this,arguments)};if(!0===s.noDeprecation)return e;var a=!1;return function(){if(!a){if(s.throwDeprecation)throw new Error(r);s.traceDeprecation?console.trace(r):console.error(r),a=!0}return e.apply(this,arguments)}};var a,n={};function o(e,i){var s={seen:[],stylize:d};return arguments.length>=3&&(s.depth=arguments[2]),arguments.length>=4&&(s.colors=arguments[3]),p(i)?s.showHidden=i:i&&t._extend(s,i),b(s.showHidden)&&(s.showHidden=!1),b(s.depth)&&(s.depth=2),b(s.colors)&&(s.colors=!1),b(s.customInspect)&&(s.customInspect=!0),s.colors&&(s.stylize=h),c(s,e,s.depth)}function h(e,t){var i=o.styles[t];return i?"["+o.colors[i][0]+"m"+e+"["+o.colors[i][1]+"m":e}function d(e,t){return e}function c(e,i,s){if(e.customInspect&&i&&T(i.inspect)&&i.inspect!==t.inspect&&(!i.constructor||i.constructor.prototype!==i)){var r=i.inspect(s,e);return y(r)||(r=c(e,r,s)),r}var a=function(e,t){if(b(t))return e.stylize("undefined","undefined");if(y(t)){var i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(i,"string")}if(g(t))return e.stylize(""+t,"number");if(p(t))return e.stylize(""+t,"boolean");if(m(t))return e.stylize("null","null")}(e,i);if(a)return a;var n=Object.keys(i),o=function(e){var t={};return e.forEach((function(e,i){t[e]=!0})),t}(n);if(e.showHidden&&(n=Object.getOwnPropertyNames(i)),k(i)&&(n.indexOf("message")>=0||n.indexOf("description")>=0))return l(i);if(0===n.length){if(T(i)){var h=i.name?": "+i.name:"";return e.stylize("[Function"+h+"]","special")}if(v(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(S(i))return e.stylize(Date.prototype.toString.call(i),"date");if(k(i))return l(i)}var d,w="",_=!1,O=["{","}"];(f(i)&&(_=!0,O=["[","]"]),T(i))&&(w=" [Function"+(i.name?": "+i.name:"")+"]");return v(i)&&(w=" "+RegExp.prototype.toString.call(i)),S(i)&&(w=" "+Date.prototype.toUTCString.call(i)),k(i)&&(w=" "+l(i)),0!==n.length||_&&0!=i.length?s<0?v(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special"):(e.seen.push(i),d=_?function(e,t,i,s,r){for(var a=[],n=0,o=t.length;n<o;++n)x(t,String(n))?a.push(u(e,t,i,s,String(n),!0)):a.push("");return r.forEach((function(r){r.match(/^\d+$/)||a.push(u(e,t,i,s,r,!0))})),a}(e,i,s,o,n):n.map((function(t){return u(e,i,s,o,t,_)})),e.seen.pop(),function(e,t,i){var s=e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);if(s>60)return i[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+i[1];return i[0]+t+" "+e.join(", ")+" "+i[1]}(d,w,O)):O[0]+w+O[1]}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function u(e,t,i,s,r,a){var n,o,h;if((h=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?o=h.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):h.set&&(o=e.stylize("[Setter]","special")),x(s,r)||(n="["+r+"]"),o||(e.seen.indexOf(h.value)<0?(o=m(i)?c(e,h.value,null):c(e,h.value,i-1)).indexOf("\n")>-1&&(o=a?o.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+o.split("\n").map((function(e){return"   "+e})).join("\n")):o=e.stylize("[Circular]","special")),b(n)){if(a&&r.match(/^\d+$/))return o;(n=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(n=n.substr(1,n.length-2),n=e.stylize(n,"name")):(n=n.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),n=e.stylize(n,"string"))}return n+": "+o}function f(e){return Array.isArray(e)}function p(e){return"boolean"==typeof e}function m(e){return null===e}function g(e){return"number"==typeof e}function y(e){return"string"==typeof e}function b(e){return void 0===e}function v(e){return w(e)&&"[object RegExp]"===_(e)}function w(e){return"object"==typeof e&&null!==e}function S(e){return w(e)&&"[object Date]"===_(e)}function k(e){return w(e)&&("[object Error]"===_(e)||e instanceof Error)}function T(e){return"function"==typeof e}function _(e){return Object.prototype.toString.call(e)}function O(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(b(a)&&(a={NODE_ENV:"production",PUBLIC_PATH:"./"}.NODE_DEBUG||""),e=e.toUpperCase(),!n[e])if(new RegExp("\\b"+e+"\\b","i").test(a)){var i=s.pid;n[e]=function(){var s=t.format.apply(t,arguments);console.error("%s %d: %s",e,i,s)}}else n[e]=function(){};return n[e]},t.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=p,t.isNull=m,t.isNullOrUndefined=function(e){return null==e},t.isNumber=g,t.isString=y,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=b,t.isRegExp=v,t.isObject=w,t.isDate=S,t.isError=k,t.isFunction=T,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=i(52014);var M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function I(){var e=new Date,t=[O(e.getHours()),O(e.getMinutes()),O(e.getSeconds())].join(":");return[e.getDate(),M[e.getMonth()],t].join(" ")}function x(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",I(),t.format.apply(t,arguments))},t.inherits=i(16076),t._extend=function(e,t){if(!t||!w(t))return e;for(var i=Object.keys(t),s=i.length;s--;)e[i[s]]=t[i[s]];return e}},29931:function(e,t,i){var s;function r(e){this.rand=e}if(e.exports=function(e){return s||(s=new r(null)),s.generate(e)},e.exports.Rand=r,r.prototype.generate=function(e){return this._rand(e)},r.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),i=0;i<t.length;i++)t[i]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?r.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?r.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(r.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var a=i(69948);if("function"!=typeof a.randomBytes)throw new Error("Not supported");r.prototype._rand=function(e){return a.randomBytes(e)}}catch(e){}},74497:function(e,t,i){var s=i(89509).Buffer;function r(e){s.isBuffer(e)||(e=s.from(e));for(var t=e.length/4|0,i=new Array(t),r=0;r<t;r++)i[r]=e.readUInt32BE(4*r);return i}function a(e){for(;0<e.length;e++)e[0]=0}function n(e,t,i,s,r){for(var a,n,o,h,d=i[0],c=i[1],l=i[2],u=i[3],f=e[0]^t[0],p=e[1]^t[1],m=e[2]^t[2],g=e[3]^t[3],y=4,b=1;b<r;b++)a=d[f>>>24]^c[p>>>16&255]^l[m>>>8&255]^u[255&g]^t[y++],n=d[p>>>24]^c[m>>>16&255]^l[g>>>8&255]^u[255&f]^t[y++],o=d[m>>>24]^c[g>>>16&255]^l[f>>>8&255]^u[255&p]^t[y++],h=d[g>>>24]^c[f>>>16&255]^l[p>>>8&255]^u[255&m]^t[y++],f=a,p=n,m=o,g=h;return a=(s[f>>>24]<<24|s[p>>>16&255]<<16|s[m>>>8&255]<<8|s[255&g])^t[y++],n=(s[p>>>24]<<24|s[m>>>16&255]<<16|s[g>>>8&255]<<8|s[255&f])^t[y++],o=(s[m>>>24]<<24|s[g>>>16&255]<<16|s[f>>>8&255]<<8|s[255&p])^t[y++],h=(s[g>>>24]<<24|s[f>>>16&255]<<16|s[p>>>8&255]<<8|s[255&m])^t[y++],[a>>>=0,n>>>=0,o>>>=0,h>>>=0]}var o=[0,1,2,4,8,16,32,64,128,27,54],h=function(){for(var e=new Array(256),t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;for(var i=[],s=[],r=[[],[],[],[]],a=[[],[],[],[]],n=0,o=0,h=0;h<256;++h){var d=o^o<<1^o<<2^o<<3^o<<4;d=d>>>8^255&d^99,i[n]=d,s[d]=n;var c=e[n],l=e[c],u=e[l],f=257*e[d]^16843008*d;r[0][n]=f<<24|f>>>8,r[1][n]=f<<16|f>>>16,r[2][n]=f<<8|f>>>24,r[3][n]=f,f=16843009*u^65537*l^257*c^16843008*n,a[0][d]=f<<24|f>>>8,a[1][d]=f<<16|f>>>16,a[2][d]=f<<8|f>>>24,a[3][d]=f,0===n?n=o=1:(n=c^e[e[e[u^c]]],o^=e[e[o]])}return{SBOX:i,INV_SBOX:s,SUB_MIX:r,INV_SUB_MIX:a}}();function d(e){this._key=r(e),this._reset()}d.blockSize=16,d.keySize=32,d.prototype.blockSize=d.blockSize,d.prototype.keySize=d.keySize,d.prototype._reset=function(){for(var e=this._key,t=e.length,i=t+6,s=4*(i+1),r=[],a=0;a<t;a++)r[a]=e[a];for(a=t;a<s;a++){var n=r[a-1];a%t==0?(n=n<<8|n>>>24,n=h.SBOX[n>>>24]<<24|h.SBOX[n>>>16&255]<<16|h.SBOX[n>>>8&255]<<8|h.SBOX[255&n],n^=o[a/t|0]<<24):t>6&&a%t==4&&(n=h.SBOX[n>>>24]<<24|h.SBOX[n>>>16&255]<<16|h.SBOX[n>>>8&255]<<8|h.SBOX[255&n]),r[a]=r[a-t]^n}for(var d=[],c=0;c<s;c++){var l=s-c,u=r[l-(c%4?0:4)];d[c]=c<4||l<=4?u:h.INV_SUB_MIX[0][h.SBOX[u>>>24]]^h.INV_SUB_MIX[1][h.SBOX[u>>>16&255]]^h.INV_SUB_MIX[2][h.SBOX[u>>>8&255]]^h.INV_SUB_MIX[3][h.SBOX[255&u]]}this._nRounds=i,this._keySchedule=r,this._invKeySchedule=d},d.prototype.encryptBlockRaw=function(e){return n(e=r(e),this._keySchedule,h.SUB_MIX,h.SBOX,this._nRounds)},d.prototype.encryptBlock=function(e){var t=this.encryptBlockRaw(e),i=s.allocUnsafe(16);return i.writeUInt32BE(t[0],0),i.writeUInt32BE(t[1],4),i.writeUInt32BE(t[2],8),i.writeUInt32BE(t[3],12),i},d.prototype.decryptBlock=function(e){var t=(e=r(e))[1];e[1]=e[3],e[3]=t;var i=n(e,this._invKeySchedule,h.INV_SUB_MIX,h.INV_SBOX,this._nRounds),a=s.allocUnsafe(16);return a.writeUInt32BE(i[0],0),a.writeUInt32BE(i[3],4),a.writeUInt32BE(i[2],8),a.writeUInt32BE(i[1],12),a},d.prototype.scrub=function(){a(this._keySchedule),a(this._invKeySchedule),a(this._key)},e.exports.AES=d},62422:function(e,t,i){var s=i(74497),r=i(89509).Buffer,a=i(71027),n=i(35717),o=i(83288),h=i(67295),d=i(20685);function c(e,t,i,n){a.call(this);var h=r.alloc(4,0);this._cipher=new s.AES(t);var c=this._cipher.encryptBlock(h);this._ghash=new o(c),i=function(e,t,i){if(12===t.length)return e._finID=r.concat([t,r.from([0,0,0,1])]),r.concat([t,r.from([0,0,0,2])]);var s=new o(i),a=t.length,n=a%16;s.update(t),n&&(n=16-n,s.update(r.alloc(n,0))),s.update(r.alloc(8,0));var h=8*a,c=r.alloc(8);c.writeUIntBE(h,0,8),s.update(c),e._finID=s.state;var l=r.from(e._finID);return d(l),l}(this,i,c),this._prev=r.from(i),this._cache=r.allocUnsafe(0),this._secCache=r.allocUnsafe(0),this._decrypt=n,this._alen=0,this._len=0,this._mode=e,this._authTag=null,this._called=!1}n(c,a),c.prototype._update=function(e){if(!this._called&&this._alen){var t=16-this._alen%16;t<16&&(t=r.alloc(t,0),this._ghash.update(t))}this._called=!0;var i=this._mode.encrypt(this,e);return this._decrypt?this._ghash.update(e):this._ghash.update(i),this._len+=e.length,i},c.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var e=h(this._ghash.final(8*this._alen,8*this._len),this._cipher.encryptBlock(this._finID));if(this._decrypt&&function(e,t){var i=0;e.length!==t.length&&i++;for(var s=Math.min(e.length,t.length),r=0;r<s;++r)i+=e[r]^t[r];return i}(e,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=e,this._cipher.scrub()},c.prototype.getAuthTag=function(){if(this._decrypt||!r.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},c.prototype.setAuthTag=function(e){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=e},c.prototype.setAAD=function(e){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(e),this._alen+=e.length},e.exports=c},44696:function(e,t,i){var s=i(71494),r=i(66193),a=i(44946);t.createCipher=t.Cipher=s.createCipher,t.createCipheriv=t.Cipheriv=s.createCipheriv,t.createDecipher=t.Decipher=r.createDecipher,t.createDecipheriv=t.Decipheriv=r.createDecipheriv,t.listCiphers=t.getCiphers=function(){return Object.keys(a)}},66193:function(e,t,i){var s=i(62422),r=i(89509).Buffer,a=i(45),n=i(25969),o=i(71027),h=i(74497),d=i(13048);function c(e,t,i){o.call(this),this._cache=new l,this._last=void 0,this._cipher=new h.AES(t),this._prev=r.from(i),this._mode=e,this._autopadding=!0}function l(){this.cache=r.allocUnsafe(0)}function u(e,t,i){var o=a[e.toLowerCase()];if(!o)throw new TypeError("invalid suite type");if("string"==typeof i&&(i=r.from(i)),"GCM"!==o.mode&&i.length!==o.iv)throw new TypeError("invalid iv length "+i.length);if("string"==typeof t&&(t=r.from(t)),t.length!==o.key/8)throw new TypeError("invalid key length "+t.length);return"stream"===o.type?new n(o.module,t,i,!0):"auth"===o.type?new s(o.module,t,i,!0):new c(o.module,t,i)}i(35717)(c,o),c.prototype._update=function(e){var t,i;this._cache.add(e);for(var s=[];t=this._cache.get(this._autopadding);)i=this._mode.decrypt(this,t),s.push(i);return r.concat(s)},c.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return function(e){var t=e[15];if(t<1||t>16)throw new Error("unable to decrypt data");var i=-1;for(;++i<t;)if(e[i+(16-t)]!==t)throw new Error("unable to decrypt data");if(16===t)return;return e.slice(0,16-t)}(this._mode.decrypt(this,e));if(e)throw new Error("data not multiple of block length")},c.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},l.prototype.add=function(e){this.cache=r.concat([this.cache,e])},l.prototype.get=function(e){var t;if(e){if(this.cache.length>16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t}else if(this.cache.length>=16)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t;return null},l.prototype.flush=function(){if(this.cache.length)return this.cache},t.createDecipher=function(e,t){var i=a[e.toLowerCase()];if(!i)throw new TypeError("invalid suite type");var s=d(t,!1,i.key,i.iv);return u(e,s.key,s.iv)},t.createDecipheriv=u},71494:function(e,t,i){var s=i(45),r=i(62422),a=i(89509).Buffer,n=i(25969),o=i(71027),h=i(74497),d=i(13048);function c(e,t,i){o.call(this),this._cache=new u,this._cipher=new h.AES(t),this._prev=a.from(i),this._mode=e,this._autopadding=!0}i(35717)(c,o),c.prototype._update=function(e){var t,i;this._cache.add(e);for(var s=[];t=this._cache.get();)i=this._mode.encrypt(this,t),s.push(i);return a.concat(s)};var l=a.alloc(16,16);function u(){this.cache=a.allocUnsafe(0)}function f(e,t,i){var o=s[e.toLowerCase()];if(!o)throw new TypeError("invalid suite type");if("string"==typeof t&&(t=a.from(t)),t.length!==o.key/8)throw new TypeError("invalid key length "+t.length);if("string"==typeof i&&(i=a.from(i)),"GCM"!==o.mode&&i.length!==o.iv)throw new TypeError("invalid iv length "+i.length);return"stream"===o.type?new n(o.module,t,i):"auth"===o.type?new r(o.module,t,i):new c(o.module,t,i)}c.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return e=this._mode.encrypt(this,e),this._cipher.scrub(),e;if(!e.equals(l))throw this._cipher.scrub(),new Error("data not multiple of block length")},c.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},u.prototype.add=function(e){this.cache=a.concat([this.cache,e])},u.prototype.get=function(){if(this.cache.length>15){var e=this.cache.slice(0,16);return this.cache=this.cache.slice(16),e}return null},u.prototype.flush=function(){for(var e=16-this.cache.length,t=a.allocUnsafe(e),i=-1;++i<e;)t.writeUInt8(e,i);return a.concat([this.cache,t])},t.createCipheriv=f,t.createCipher=function(e,t){var i=s[e.toLowerCase()];if(!i)throw new TypeError("invalid suite type");var r=d(t,!1,i.key,i.iv);return f(e,r.key,r.iv)}},83288:function(e,t,i){var s=i(89509).Buffer,r=s.alloc(16,0);function a(e){var t=s.allocUnsafe(16);return t.writeUInt32BE(e[0]>>>0,0),t.writeUInt32BE(e[1]>>>0,4),t.writeUInt32BE(e[2]>>>0,8),t.writeUInt32BE(e[3]>>>0,12),t}function n(e){this.h=e,this.state=s.alloc(16,0),this.cache=s.allocUnsafe(0)}n.prototype.ghash=function(e){for(var t=-1;++t<e.length;)this.state[t]^=e[t];this._multiply()},n.prototype._multiply=function(){for(var e,t,i,s=[(e=this.h).readUInt32BE(0),e.readUInt32BE(4),e.readUInt32BE(8),e.readUInt32BE(12)],r=[0,0,0,0],n=-1;++n<128;){for(0!=(this.state[~~(n/8)]&1<<7-n%8)&&(r[0]^=s[0],r[1]^=s[1],r[2]^=s[2],r[3]^=s[3]),i=0!=(1&s[3]),t=3;t>0;t--)s[t]=s[t]>>>1|(1&s[t-1])<<31;s[0]=s[0]>>>1,i&&(s[0]=s[0]^225<<24)}this.state=a(r)},n.prototype.update=function(e){var t;for(this.cache=s.concat([this.cache,e]);this.cache.length>=16;)t=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(t)},n.prototype.final=function(e,t){return this.cache.length&&this.ghash(s.concat([this.cache,r],16)),this.ghash(a([0,e,0,t])),this.state},e.exports=n},20685:function(e){e.exports=function(e){for(var t,i=e.length;i--;){if(255!==(t=e.readUInt8(i))){t++,e.writeUInt8(t,i);break}e.writeUInt8(0,i)}}},25292:function(e,t,i){var s=i(67295);t.encrypt=function(e,t){var i=s(t,e._prev);return e._prev=e._cipher.encryptBlock(i),e._prev},t.decrypt=function(e,t){var i=e._prev;e._prev=t;var r=e._cipher.decryptBlock(t);return s(r,i)}},86311:function(e,t,i){var s=i(89509).Buffer,r=i(67295);function a(e,t,i){var a=t.length,n=r(t,e._cache);return e._cache=e._cache.slice(a),e._prev=s.concat([e._prev,i?t:n]),n}t.encrypt=function(e,t,i){for(var r,n=s.allocUnsafe(0);t.length;){if(0===e._cache.length&&(e._cache=e._cipher.encryptBlock(e._prev),e._prev=s.allocUnsafe(0)),!(e._cache.length<=t.length)){n=s.concat([n,a(e,t,i)]);break}r=e._cache.length,n=s.concat([n,a(e,t.slice(0,r),i)]),t=t.slice(r)}return n}},21510:function(e,t,i){var s=i(89509).Buffer;function r(e,t,i){for(var s,r,n=-1,o=0;++n<8;)s=t&1<<7-n?128:0,o+=(128&(r=e._cipher.encryptBlock(e._prev)[0]^s))>>n%8,e._prev=a(e._prev,i?s:r);return o}function a(e,t){var i=e.length,r=-1,a=s.allocUnsafe(e.length);for(e=s.concat([e,s.from([t])]);++r<i;)a[r]=e[r]<<1|e[r+1]>>7;return a}t.encrypt=function(e,t,i){for(var a=t.length,n=s.allocUnsafe(a),o=-1;++o<a;)n[o]=r(e,t[o],i);return n}},71964:function(e,t,i){var s=i(89509).Buffer;function r(e,t,i){var r=e._cipher.encryptBlock(e._prev)[0]^t;return e._prev=s.concat([e._prev.slice(1),s.from([i?t:r])]),r}t.encrypt=function(e,t,i){for(var a=t.length,n=s.allocUnsafe(a),o=-1;++o<a;)n[o]=r(e,t[o],i);return n}},96009:function(e,t,i){var s=i(67295),r=i(89509).Buffer,a=i(20685);function n(e){var t=e._cipher.encryptBlockRaw(e._prev);return a(e._prev),t}t.encrypt=function(e,t){var i=Math.ceil(t.length/16),a=e._cache.length;e._cache=r.concat([e._cache,r.allocUnsafe(16*i)]);for(var o=0;o<i;o++){var h=n(e),d=a+16*o;e._cache.writeUInt32BE(h[0],d+0),e._cache.writeUInt32BE(h[1],d+4),e._cache.writeUInt32BE(h[2],d+8),e._cache.writeUInt32BE(h[3],d+12)}var c=e._cache.slice(0,t.length);return e._cache=e._cache.slice(t.length),s(t,c)}},11084:function(e,t){t.encrypt=function(e,t){return e._cipher.encryptBlock(t)},t.decrypt=function(e,t){return e._cipher.decryptBlock(t)}},45:function(e,t,i){var s={ECB:i(11084),CBC:i(25292),CFB:i(86311),CFB8:i(71964),CFB1:i(21510),OFB:i(18861),CTR:i(96009),GCM:i(96009)},r=i(44946);for(var a in r)r[a].module=s[r[a].mode];e.exports=r},18861:function(e,t,i){var s=i(48764).Buffer,r=i(67295);function a(e){return e._prev=e._cipher.encryptBlock(e._prev),e._prev}t.encrypt=function(e,t){for(;e._cache.length<t.length;)e._cache=s.concat([e._cache,a(e)]);var i=e._cache.slice(0,t.length);return e._cache=e._cache.slice(t.length),r(t,i)}},25969:function(e,t,i){var s=i(74497),r=i(89509).Buffer,a=i(71027);function n(e,t,i,n){a.call(this),this._cipher=new s.AES(t),this._prev=r.from(i),this._cache=r.allocUnsafe(0),this._secCache=r.allocUnsafe(0),this._decrypt=n,this._mode=e}i(35717)(n,a),n.prototype._update=function(e){return this._mode.encrypt(this,e,this._decrypt)},n.prototype._final=function(){this._cipher.scrub()},e.exports=n},53614:function(e,t,i){var s=i(47667),r=i(44696),a=i(45),n=i(99715),o=i(13048);function h(e,t,i){if(e=e.toLowerCase(),a[e])return r.createCipheriv(e,t,i);if(n[e])return new s({key:t,iv:i,mode:e});throw new TypeError("invalid suite type")}function d(e,t,i){if(e=e.toLowerCase(),a[e])return r.createDecipheriv(e,t,i);if(n[e])return new s({key:t,iv:i,mode:e,decrypt:!0});throw new TypeError("invalid suite type")}t.createCipher=t.Cipher=function(e,t){var i,s;if(e=e.toLowerCase(),a[e])i=a[e].key,s=a[e].iv;else{if(!n[e])throw new TypeError("invalid suite type");i=8*n[e].key,s=n[e].iv}var r=o(t,!1,i,s);return h(e,r.key,r.iv)},t.createCipheriv=t.Cipheriv=h,t.createDecipher=t.Decipher=function(e,t){var i,s;if(e=e.toLowerCase(),a[e])i=a[e].key,s=a[e].iv;else{if(!n[e])throw new TypeError("invalid suite type");i=8*n[e].key,s=n[e].iv}var r=o(t,!1,i,s);return d(e,r.key,r.iv)},t.createDecipheriv=t.Decipheriv=d,t.listCiphers=t.getCiphers=function(){return Object.keys(n).concat(r.getCiphers())}},47667:function(e,t,i){var s=i(71027),r=i(15251),a=i(35717),n=i(89509).Buffer,o={"des-ede3-cbc":r.CBC.instantiate(r.EDE),"des-ede3":r.EDE,"des-ede-cbc":r.CBC.instantiate(r.EDE),"des-ede":r.EDE,"des-cbc":r.CBC.instantiate(r.DES),"des-ecb":r.DES};function h(e){s.call(this);var t,i=e.mode.toLowerCase(),r=o[i];t=e.decrypt?"decrypt":"encrypt";var a=e.key;n.isBuffer(a)||(a=n.from(a)),"des-ede"!==i&&"des-ede-cbc"!==i||(a=n.concat([a,a.slice(0,8)]));var h=e.iv;n.isBuffer(h)||(h=n.from(h)),this._des=r.create({key:a,iv:h,type:t})}o.des=o["des-cbc"],o.des3=o["des-ede3-cbc"],e.exports=h,a(h,s),h.prototype._update=function(e){return n.from(this._des.update(e))},h.prototype._final=function(){return n.from(this._des.final())}},99715:function(e,t){t["des-ecb"]={key:8,iv:0},t["des-cbc"]=t.des={key:8,iv:8},t["des-ede3-cbc"]=t.des3={key:24,iv:8},t["des-ede3"]={key:24,iv:0},t["des-ede-cbc"]={key:16,iv:8},t["des-ede"]={key:16,iv:0}},23663:function(e,t,i){var s=i(48764).Buffer,r=i(13550),a=i(61798);function n(e){var t,i=e.modulus.byteLength();do{t=new r(a(i))}while(t.cmp(e.modulus)>=0||!t.umod(e.prime1)||!t.umod(e.prime2));return t}function o(e,t){var i=function(e){var t=n(e);return{blinder:t.toRed(r.mont(e.modulus)).redPow(new r(e.publicExponent)).fromRed(),unblinder:t.invm(e.modulus)}}(t),a=t.modulus.byteLength(),o=new r(e).mul(i.blinder).umod(t.modulus),h=o.toRed(r.mont(t.prime1)),d=o.toRed(r.mont(t.prime2)),c=t.coefficient,l=t.prime1,u=t.prime2,f=h.redPow(t.exponent1).fromRed(),p=d.redPow(t.exponent2).fromRed(),m=f.isub(p).imul(c).umod(l).imul(u);return p.iadd(m).imul(i.unblinder).umod(t.modulus).toArrayLike(s,"be",a)}o.getr=n,e.exports=o},56042:function(e,t,i){e.exports=i(75207)},64743:function(e,t,i){var s=i(89509).Buffer,r=i(23482),a=i(23872),n=i(35717),o=i(82957),h=i(47753),d=i(75207);function c(e){a.Writable.call(this);var t=d[e];if(!t)throw new Error("Unknown message digest");this._hashType=t.hash,this._hash=r(t.hash),this._tag=t.id,this._signType=t.sign}function l(e){a.Writable.call(this);var t=d[e];if(!t)throw new Error("Unknown message digest");this._hash=r(t.hash),this._tag=t.id,this._signType=t.sign}function u(e){return new c(e)}function f(e){return new l(e)}Object.keys(d).forEach((function(e){d[e].id=s.from(d[e].id,"hex"),d[e.toLowerCase()]=d[e]})),n(c,a.Writable),c.prototype._write=function(e,t,i){this._hash.update(e),i()},c.prototype.update=function(e,t){return"string"==typeof e&&(e=s.from(e,t)),this._hash.update(e),this},c.prototype.sign=function(e,t){this.end();var i=this._hash.digest(),s=o(i,e,this._hashType,this._signType,this._tag);return t?s.toString(t):s},n(l,a.Writable),l.prototype._write=function(e,t,i){this._hash.update(e),i()},l.prototype.update=function(e,t){return"string"==typeof e&&(e=s.from(e,t)),this._hash.update(e),this},l.prototype.verify=function(e,t,i){"string"==typeof t&&(t=s.from(t,i)),this.end();var r=this._hash.digest();return h(t,r,e,this._signType,this._tag)},e.exports={Sign:u,Verify:f,createSign:u,createVerify:f}},82957:function(e,t,i){var s=i(89509).Buffer,r=i(58355),a=i(23663),n=i(86266).ec,o=i(13550),h=i(70980),d=i(1308);function c(e,t,i,a){if((e=s.from(e.toArray())).length<t.byteLength()){var n=s.alloc(t.byteLength()-e.length);e=s.concat([n,e])}var o=i.length,h=function(e,t){e=l(e,t),e=e.mod(t);var i=s.from(e.toArray());if(i.length<t.byteLength()){var r=s.alloc(t.byteLength()-i.length);i=s.concat([r,i])}return i}(i,t),d=s.alloc(o);d.fill(1);var c=s.alloc(o);return c=r(a,c).update(d).update(s.from([0])).update(e).update(h).digest(),d=r(a,c).update(d).digest(),{k:c=r(a,c).update(d).update(s.from([1])).update(e).update(h).digest(),v:d=r(a,c).update(d).digest()}}function l(e,t){var i=new o(e),s=(e.length<<3)-t.bitLength();return s>0&&i.ishrn(s),i}function u(e,t,i){var a,n;do{for(a=s.alloc(0);8*a.length<e.bitLength();)t.v=r(i,t.k).update(t.v).digest(),a=s.concat([a,t.v]);n=l(a,e),t.k=r(i,t.k).update(t.v).update(s.from([0])).digest(),t.v=r(i,t.k).update(t.v).digest()}while(-1!==n.cmp(e));return n}function f(e,t,i,s){return e.toRed(o.mont(i)).redPow(t).fromRed().mod(s)}e.exports=function(e,t,i,r,p){var m=h(t);if(m.curve){if("ecdsa"!==r&&"ecdsa/rsa"!==r)throw new Error("wrong private key type");return function(e,t){var i=d[t.curve.join(".")];if(!i)throw new Error("unknown curve "+t.curve.join("."));var r=new n(i).keyFromPrivate(t.privateKey),a=r.sign(e);return s.from(a.toDER())}(e,m)}if("dsa"===m.type){if("dsa"!==r)throw new Error("wrong private key type");return function(e,t,i){var r,a=t.params.priv_key,n=t.params.p,h=t.params.q,d=t.params.g,p=new o(0),m=l(e,h).mod(h),g=!1,y=c(a,h,e,i);for(;!1===g;)p=f(d,r=u(h,y,i),n,h),0===(g=r.invm(h).imul(m.add(a.mul(p))).mod(h)).cmpn(0)&&(g=!1,p=new o(0));return function(e,t){e=e.toArray(),t=t.toArray(),128&e[0]&&(e=[0].concat(e));128&t[0]&&(t=[0].concat(t));var i=e.length+t.length+4,r=[48,i,2,e.length];return r=r.concat(e,[2,t.length],t),s.from(r)}(p,g)}(e,m,i)}if("rsa"!==r&&"ecdsa/rsa"!==r)throw new Error("wrong private key type");e=s.concat([p,e]);for(var g=m.modulus.byteLength(),y=[0,1];e.length+y.length+1<g;)y.push(255);y.push(0);for(var b=-1;++b<e.length;)y.push(e[b]);return a(y,m)},e.exports.getKey=c,e.exports.makeKey=u},47753:function(e,t,i){var s=i(89509).Buffer,r=i(13550),a=i(86266).ec,n=i(70980),o=i(1308);function h(e,t){if(e.cmpn(0)<=0)throw new Error("invalid sig");if(e.cmp(t)>=t)throw new Error("invalid sig")}e.exports=function(e,t,i,d,c){var l=n(i);if("ec"===l.type){if("ecdsa"!==d&&"ecdsa/rsa"!==d)throw new Error("wrong public key type");return function(e,t,i){var s=o[i.data.algorithm.curve.join(".")];if(!s)throw new Error("unknown curve "+i.data.algorithm.curve.join("."));var r=new a(s),n=i.data.subjectPrivateKey.data;return r.verify(t,e,n)}(e,t,l)}if("dsa"===l.type){if("dsa"!==d)throw new Error("wrong public key type");return function(e,t,i){var s=i.data.p,a=i.data.q,o=i.data.g,d=i.data.pub_key,c=n.signature.decode(e,"der"),l=c.s,u=c.r;h(l,a),h(u,a);var f=r.mont(s),p=l.invm(a),m=o.toRed(f).redPow(new r(t).mul(p).mod(a)).fromRed().mul(d.toRed(f).redPow(u.mul(p).mod(a)).fromRed()).mod(s).mod(a);return 0===m.cmp(u)}(e,t,l)}if("rsa"!==d&&"ecdsa/rsa"!==d)throw new Error("wrong public key type");t=s.concat([c,t]);for(var u=l.modulus.byteLength(),f=[1],p=0;t.length+f.length+2<u;)f.push(255),p++;f.push(0);for(var m=-1;++m<t.length;)f.push(t[m]);f=s.from(f);var g=r.mont(l.modulus);e=(e=new r(e).toRed(g)).redPow(new r(l.publicExponent)),e=s.from(e.fromRed().toArray());var y=p<8?1:0;for(u=Math.min(e.length,f.length),e.length!==f.length&&(y=1),m=-1;++m<u;)y|=e[m]^f[m];return 0===y}},84419:function(e){"use strict";var t={};function i(e,i,s){s||(s=Error);var r=function(e){var t,s;function r(t,s,r){return e.call(this,function(e,t,s){return"string"==typeof i?i:i(e,t,s)}(t,s,r))||this}return s=e,(t=r).prototype=Object.create(s.prototype),t.prototype.constructor=t,t.__proto__=s,r}(s);r.prototype.name=s.name,r.prototype.code=e,t[e]=r}function s(e,t){if(Array.isArray(e)){var i=e.length;return e=e.map((function(e){return String(e)})),i>2?"one of ".concat(t," ").concat(e.slice(0,i-1).join(", "),", or ")+e[i-1]:2===i?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}i("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),i("ERR_INVALID_ARG_TYPE",(function(e,t,i){var r,a,n,o;if("string"==typeof t&&(a="not ",t.substr(!n||n<0?0:+n,a.length)===a)?(r="must not be",t=t.replace(/^not /,"")):r="must be",function(e,t,i){return(void 0===i||i>e.length)&&(i=e.length),e.substring(i-t.length,i)===t}(e," argument"))o="The ".concat(e," ").concat(r," ").concat(s(t,"type"));else{var h=function(e,t,i){return"number"!=typeof i&&(i=0),!(i+t.length>e.length)&&-1!==e.indexOf(t,i)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(h," ").concat(r," ").concat(s(t,"type"))}return o+=". Received type ".concat(typeof i)}),TypeError),i("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),i("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),i("ERR_STREAM_PREMATURE_CLOSE","Premature close"),i("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),i("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),i("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),i("ERR_STREAM_WRITE_AFTER_END","write after end"),i("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),i("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),i("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},34390:function(e,t,i){"use strict";var s=i(34155),r=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t};e.exports=c;var a=i(44960),n=i(92010);i(35717)(c,a);for(var o=r(n.prototype),h=0;h<o.length;h++){var d=o[h];c.prototype[d]||(c.prototype[d]=n.prototype[d])}function c(e){if(!(this instanceof c))return new c(e);a.call(this,e),n.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",l)))}function l(){this._writableState.ended||s.nextTick(u,this)}function u(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},41294:function(e,t,i){"use strict";e.exports=r;var s=i(3912);function r(e){if(!(this instanceof r))return new r(e);s.call(this,e)}i(35717)(r,s),r.prototype._transform=function(e,t,i){i(null,e)}},44960:function(e,t,i){"use strict";var s,r=i(34155);e.exports=O,O.ReadableState=_;i(17187).EventEmitter;var a=function(e,t){return e.listeners(t).length},n=i(59819),o=i(48764).Buffer,h=i.g.Uint8Array||function(){};var d,c=i(56353);d=c&&c.debuglog?c.debuglog("stream"):function(){};var l,u,f,p=i(76633),m=i(75997),g=i(898).getHighWaterMark,y=i(84419).q,b=y.ERR_INVALID_ARG_TYPE,v=y.ERR_STREAM_PUSH_AFTER_EOF,w=y.ERR_METHOD_NOT_IMPLEMENTED,S=y.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;i(35717)(O,n);var k=m.errorOrDestroy,T=["error","close","destroy","pause","resume"];function _(e,t,r){s=s||i(34390),e=e||{},"boolean"!=typeof r&&(r=t instanceof s),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=g(this,e,"readableHighWaterMark",r),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(l||(l=i(32553).s),this.decoder=new l(e.encoding),this.encoding=e.encoding)}function O(e){if(s=s||i(34390),!(this instanceof O))return new O(e);var t=this instanceof s;this._readableState=new _(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),n.call(this)}function M(e,t,i,s,r){d("readableAddChunk",t);var a,n=e._readableState;if(null===t)n.reading=!1,function(e,t){if(d("onEofChunk"),t.ended)return;if(t.decoder){var i=t.decoder.end();i&&i.length&&(t.buffer.push(i),t.length+=t.objectMode?1:i.length)}t.ended=!0,t.sync?P(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,A(e)))}(e,n);else if(r||(a=function(e,t){var i;s=t,o.isBuffer(s)||s instanceof h||"string"==typeof t||void 0===t||e.objectMode||(i=new b("chunk",["string","Buffer","Uint8Array"],t));var s;return i}(n,t)),a)k(e,a);else if(n.objectMode||t&&t.length>0)if("string"==typeof t||n.objectMode||Object.getPrototypeOf(t)===o.prototype||(t=function(e){return o.from(e)}(t)),s)n.endEmitted?k(e,new S):I(e,n,t,!0);else if(n.ended)k(e,new v);else{if(n.destroyed)return!1;n.reading=!1,n.decoder&&!i?(t=n.decoder.write(t),n.objectMode||0!==t.length?I(e,n,t,!1):N(e,n)):I(e,n,t,!1)}else s||(n.reading=!1,N(e,n));return!n.ended&&(n.length<n.highWaterMark||0===n.length)}function I(e,t,i,s){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",i)):(t.length+=t.objectMode?1:i.length,s?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&P(e)),N(e,t)}Object.defineProperty(O.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),O.prototype.destroy=m.destroy,O.prototype._undestroy=m.undestroy,O.prototype._destroy=function(e,t){t(e)},O.prototype.push=function(e,t){var i,s=this._readableState;return s.objectMode?i=!0:"string"==typeof e&&((t=t||s.defaultEncoding)!==s.encoding&&(e=o.from(e,t),t=""),i=!0),M(this,e,t,!1,i)},O.prototype.unshift=function(e){return M(this,e,null,!0,!1)},O.prototype.isPaused=function(){return!1===this._readableState.flowing},O.prototype.setEncoding=function(e){l||(l=i(32553).s);var t=new l(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var s=this._readableState.buffer.head,r="";null!==s;)r+=t.write(s.data),s=s.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var x=1073741824;function C(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=x?e=x:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function P(e){var t=e._readableState;d("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(d("emitReadable",t.flowing),t.emittedReadable=!0,r.nextTick(A,e))}function A(e){var t=e._readableState;d("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,R(e)}function N(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(B,e,t))}function B(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var i=t.length;if(d("maybeReadMore read 0"),e.read(0),i===t.length)break}t.readingMore=!1}function E(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function V(e){d("readable nexttick read 0"),e.read(0)}function L(e,t){d("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),R(e),t.flowing&&!t.reading&&e.read(0)}function R(e){var t=e._readableState;for(d("flow",t.flowing);t.flowing&&null!==e.read(););}function D(e,t){return 0===t.length?null:(t.objectMode?i=t.buffer.shift():!e||e>=t.length?(i=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):i=t.buffer.consume(e,t.decoder),i);var i}function F(e){var t=e._readableState;d("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,r.nextTick(q,t,e))}function q(e,t){if(d("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var i=t._writableState;(!i||i.autoDestroy&&i.finished)&&t.destroy()}}function G(e,t){for(var i=0,s=e.length;i<s;i++)if(e[i]===t)return i;return-1}O.prototype.read=function(e){d("read",e),e=parseInt(e,10);var t=this._readableState,i=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return d("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?F(this):P(this),null;if(0===(e=C(e,t))&&t.ended)return 0===t.length&&F(this),null;var s,r=t.needReadable;return d("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&d("length less than watermark",r=!0),t.ended||t.reading?d("reading or ended",r=!1):r&&(d("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=C(i,t))),null===(s=e>0?D(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),i!==e&&t.ended&&F(this)),null!==s&&this.emit("data",s),s},O.prototype._read=function(e){k(this,new w("_read()"))},O.prototype.pipe=function(e,t){var i=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1,d("pipe count=%d opts=%j",s.pipesCount,t);var n=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?h:g;function o(t,r){d("onunpipe"),t===i&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,d("cleanup"),e.removeListener("close",p),e.removeListener("finish",m),e.removeListener("drain",c),e.removeListener("error",f),e.removeListener("unpipe",o),i.removeListener("end",h),i.removeListener("end",g),i.removeListener("data",u),l=!0,!s.awaitDrain||e._writableState&&!e._writableState.needDrain||c())}function h(){d("onend"),e.end()}s.endEmitted?r.nextTick(n):i.once("end",n),e.on("unpipe",o);var c=function(e){return function(){var t=e._readableState;d("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,R(e))}}(i);e.on("drain",c);var l=!1;function u(t){d("ondata");var r=e.write(t);d("dest.write",r),!1===r&&((1===s.pipesCount&&s.pipes===e||s.pipesCount>1&&-1!==G(s.pipes,e))&&!l&&(d("false write response, pause",s.awaitDrain),s.awaitDrain++),i.pause())}function f(t){d("onerror",t),g(),e.removeListener("error",f),0===a(e,"error")&&k(e,t)}function p(){e.removeListener("finish",m),g()}function m(){d("onfinish"),e.removeListener("close",p),g()}function g(){d("unpipe"),i.unpipe(e)}return i.on("data",u),function(e,t,i){if("function"==typeof e.prependListener)return e.prependListener(t,i);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(i):e._events[t]=[i,e._events[t]]:e.on(t,i)}(e,"error",f),e.once("close",p),e.once("finish",m),e.emit("pipe",i),s.flowing||(d("pipe resume"),i.resume()),e},O.prototype.unpipe=function(e){var t=this._readableState,i={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,i)),this;if(!e){var s=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<r;a++)s[a].emit("unpipe",this,{hasUnpiped:!1});return this}var n=G(t.pipes,e);return-1===n||(t.pipes.splice(n,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,i)),this},O.prototype.on=function(e,t){var i=n.prototype.on.call(this,e,t),s=this._readableState;return"data"===e?(s.readableListening=this.listenerCount("readable")>0,!1!==s.flowing&&this.resume()):"readable"===e&&(s.endEmitted||s.readableListening||(s.readableListening=s.needReadable=!0,s.flowing=!1,s.emittedReadable=!1,d("on readable",s.length,s.reading),s.length?P(this):s.reading||r.nextTick(V,this))),i},O.prototype.addListener=O.prototype.on,O.prototype.removeListener=function(e,t){var i=n.prototype.removeListener.call(this,e,t);return"readable"===e&&r.nextTick(E,this),i},O.prototype.removeAllListeners=function(e){var t=n.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||r.nextTick(E,this),t},O.prototype.resume=function(){var e=this._readableState;return e.flowing||(d("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(L,e,t))}(this,e)),e.paused=!1,this},O.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},O.prototype.wrap=function(e){var t=this,i=this._readableState,s=!1;for(var r in e.on("end",(function(){if(d("wrapped end"),i.decoder&&!i.ended){var e=i.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(r){(d("wrapped data"),i.decoder&&(r=i.decoder.write(r)),i.objectMode&&null==r)||(i.objectMode||r&&r.length)&&(t.push(r)||(s=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var a=0;a<T.length;a++)e.on(T[a],this.emit.bind(this,T[a]));return this._read=function(t){d("wrapped _read",t),s&&(s=!1,e.resume())},this},"function"==typeof Symbol&&(O.prototype[Symbol.asyncIterator]=function(){return void 0===u&&(u=i(54887)),u(this)}),Object.defineProperty(O.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(O.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(O.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),O._fromList=D,Object.defineProperty(O.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(O.from=function(e,t){return void 0===f&&(f=i(98859)),f(O,e,t)})},3912:function(e,t,i){"use strict";e.exports=c;var s=i(84419).q,r=s.ERR_METHOD_NOT_IMPLEMENTED,a=s.ERR_MULTIPLE_CALLBACK,n=s.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=s.ERR_TRANSFORM_WITH_LENGTH_0,h=i(34390);function d(e,t){var i=this._transformState;i.transforming=!1;var s=i.writecb;if(null===s)return this.emit("error",new a);i.writechunk=null,i.writecb=null,null!=t&&this.push(t),s(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function c(e){if(!(this instanceof c))return new c(e);h.call(this,e),this._transformState={afterTransform:d.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",l)}function l(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?u(this,null,null):this._flush((function(t,i){u(e,t,i)}))}function u(e,t,i){if(t)return e.emit("error",t);if(null!=i&&e.push(i),e._writableState.length)throw new o;if(e._transformState.transforming)throw new n;return e.push(null)}i(35717)(c,h),c.prototype.push=function(e,t){return this._transformState.needTransform=!1,h.prototype.push.call(this,e,t)},c.prototype._transform=function(e,t,i){i(new r("_transform()"))},c.prototype._write=function(e,t,i){var s=this._transformState;if(s.writecb=i,s.writechunk=e,s.writeencoding=t,!s.transforming){var r=this._readableState;(s.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},c.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},c.prototype._destroy=function(e,t){h.prototype._destroy.call(this,e,(function(e){t(e)}))}},92010:function(e,t,i){"use strict";var s,r=i(34155);function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,i){var s=e.entry;e.entry=null;for(;s;){var r=s.callback;t.pendingcb--,r(i),s=s.next}t.corkedRequestsFree.next=e}(t,e)}}e.exports=O,O.WritableState=_;var n={deprecate:i(94927)},o=i(59819),h=i(48764).Buffer,d=i.g.Uint8Array||function(){};var c,l=i(75997),u=i(898).getHighWaterMark,f=i(84419).q,p=f.ERR_INVALID_ARG_TYPE,m=f.ERR_METHOD_NOT_IMPLEMENTED,g=f.ERR_MULTIPLE_CALLBACK,y=f.ERR_STREAM_CANNOT_PIPE,b=f.ERR_STREAM_DESTROYED,v=f.ERR_STREAM_NULL_VALUES,w=f.ERR_STREAM_WRITE_AFTER_END,S=f.ERR_UNKNOWN_ENCODING,k=l.errorOrDestroy;function T(){}function _(e,t,n){s=s||i(34390),e=e||{},"boolean"!=typeof n&&(n=t instanceof s),this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=u(this,e,"writableHighWaterMark",n),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===e.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var i=e._writableState,s=i.sync,a=i.writecb;if("function"!=typeof a)throw new g;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(i),t)!function(e,t,i,s,a){--t.pendingcb,i?(r.nextTick(a,s),r.nextTick(A,e,t),e._writableState.errorEmitted=!0,k(e,s)):(a(s),e._writableState.errorEmitted=!0,k(e,s),A(e,t))}(e,i,s,t,a);else{var n=C(i)||e.destroyed;n||i.corked||i.bufferProcessing||!i.bufferedRequest||x(e,i),s?r.nextTick(I,e,i,n,a):I(e,i,n,a)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function O(e){var t=this instanceof(s=s||i(34390));if(!t&&!c.call(O,this))return new O(e);this._writableState=new _(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),o.call(this)}function M(e,t,i,s,r,a,n){t.writelen=s,t.writecb=n,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new b("write")):i?e._writev(r,t.onwrite):e._write(r,a,t.onwrite),t.sync=!1}function I(e,t,i,s){i||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,s(),A(e,t)}function x(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){var s=t.bufferedRequestCount,r=new Array(s),n=t.corkedRequestsFree;n.entry=i;for(var o=0,h=!0;i;)r[o]=i,i.isBuf||(h=!1),i=i.next,o+=1;r.allBuffers=h,M(e,t,!0,t.length,r,"",n.finish),t.pendingcb++,t.lastBufferedRequest=null,n.next?(t.corkedRequestsFree=n.next,n.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;i;){var d=i.chunk,c=i.encoding,l=i.callback;if(M(e,t,!1,t.objectMode?1:d.length,d,c,l),i=i.next,t.bufferedRequestCount--,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequest=i,t.bufferProcessing=!1}function C(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function P(e,t){e._final((function(i){t.pendingcb--,i&&k(e,i),t.prefinished=!0,e.emit("prefinish"),A(e,t)}))}function A(e,t){var i=C(t);if(i&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,r.nextTick(P,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var s=e._readableState;(!s||s.autoDestroy&&s.endEmitted)&&e.destroy()}return i}i(35717)(O,o),_.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(_.prototype,"buffer",{get:n.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(O,Symbol.hasInstance,{value:function(e){return!!c.call(this,e)||this===O&&(e&&e._writableState instanceof _)}})):c=function(e){return e instanceof this},O.prototype.pipe=function(){k(this,new y)},O.prototype.write=function(e,t,i){var s,a=this._writableState,n=!1,o=!a.objectMode&&(s=e,h.isBuffer(s)||s instanceof d);return o&&!h.isBuffer(e)&&(e=function(e){return h.from(e)}(e)),"function"==typeof t&&(i=t,t=null),o?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof i&&(i=T),a.ending?function(e,t){var i=new w;k(e,i),r.nextTick(t,i)}(this,i):(o||function(e,t,i,s){var a;return null===i?a=new v:"string"==typeof i||t.objectMode||(a=new p("chunk",["string","Buffer"],i)),!a||(k(e,a),r.nextTick(s,a),!1)}(this,a,e,i))&&(a.pendingcb++,n=function(e,t,i,s,r,a){if(!i){var n=function(e,t,i){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=h.from(t,i));return t}(t,s,r);s!==n&&(i=!0,r="buffer",s=n)}var o=t.objectMode?1:s.length;t.length+=o;var d=t.length<t.highWaterMark;d||(t.needDrain=!0);if(t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:s,encoding:r,isBuf:i,callback:a,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else M(e,t,!1,o,s,r,a);return d}(this,a,o,e,t,i)),n},O.prototype.cork=function(){this._writableState.corked++},O.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||x(this,e))},O.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new S(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(O.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(O.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),O.prototype._write=function(e,t,i){i(new m("_write()"))},O.prototype._writev=null,O.prototype.end=function(e,t,i){var s=this._writableState;return"function"==typeof e?(i=e,e=null,t=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),s.corked&&(s.corked=1,this.uncork()),s.ending||function(e,t,i){t.ending=!0,A(e,t),i&&(t.finished?r.nextTick(i):e.once("finish",i));t.ended=!0,e.writable=!1}(this,s,i),this},Object.defineProperty(O.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(O.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),O.prototype.destroy=l.destroy,O.prototype._undestroy=l.undestroy,O.prototype._destroy=function(e,t){t(e)}},54887:function(e,t,i){"use strict";var s,r=i(34155);function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var n=i(5800),o=Symbol("lastResolve"),h=Symbol("lastReject"),d=Symbol("error"),c=Symbol("ended"),l=Symbol("lastPromise"),u=Symbol("handlePromise"),f=Symbol("stream");function p(e,t){return{value:e,done:t}}function m(e){var t=e[o];if(null!==t){var i=e[f].read();null!==i&&(e[l]=null,e[o]=null,e[h]=null,t(p(i,!1)))}}function g(e){r.nextTick(m,e)}var y=Object.getPrototypeOf((function(){})),b=Object.setPrototypeOf((a(s={get stream(){return this[f]},next:function(){var e=this,t=this[d];if(null!==t)return Promise.reject(t);if(this[c])return Promise.resolve(p(void 0,!0));if(this[f].destroyed)return new Promise((function(t,i){r.nextTick((function(){e[d]?i(e[d]):t(p(void 0,!0))}))}));var i,s=this[l];if(s)i=new Promise(function(e,t){return function(i,s){e.then((function(){t[c]?i(p(void 0,!0)):t[u](i,s)}),s)}}(s,this));else{var a=this[f].read();if(null!==a)return Promise.resolve(p(a,!1));i=new Promise(this[u])}return this[l]=i,i}},Symbol.asyncIterator,(function(){return this})),a(s,"return",(function(){var e=this;return new Promise((function(t,i){e[f].destroy(null,(function(e){e?i(e):t(p(void 0,!0))}))}))})),s),y);e.exports=function(e){var t,i=Object.create(b,(a(t={},f,{value:e,writable:!0}),a(t,o,{value:null,writable:!0}),a(t,h,{value:null,writable:!0}),a(t,d,{value:null,writable:!0}),a(t,c,{value:e._readableState.endEmitted,writable:!0}),a(t,u,{value:function(e,t){var s=i[f].read();s?(i[l]=null,i[o]=null,i[h]=null,e(p(s,!1))):(i[o]=e,i[h]=t)},writable:!0}),t));return i[l]=null,n(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=i[h];return null!==t&&(i[l]=null,i[o]=null,i[h]=null,t(e)),void(i[d]=e)}var s=i[o];null!==s&&(i[l]=null,i[o]=null,i[h]=null,s(p(void 0,!0))),i[c]=!0})),e.on("readable",g.bind(null,i)),i}},76633:function(e,t,i){"use strict";function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var n=i(48764).Buffer,o=i(96419).inspect,h=o&&o.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,i,d;return t=e,i=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i}},{key:"concat",value:function(e){if(0===this.length)return n.alloc(0);for(var t,i,s,r=n.allocUnsafe(e>>>0),a=this.head,o=0;a;)t=a.data,i=r,s=o,n.prototype.copy.call(t,i,s),o+=a.data.length,a=a.next;return r}},{key:"consume",value:function(e,t){var i;return e<this.head.data.length?(i=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):i=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,i=1,s=t.data;for(e-=s.length;t=t.next;){var r=t.data,a=e>r.length?r.length:e;if(a===r.length?s+=r:s+=r.slice(0,e),0==(e-=a)){a===r.length?(++i,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=r.slice(a));break}++i}return this.length-=i,s}},{key:"_getBuffer",value:function(e){var t=n.allocUnsafe(e),i=this.head,s=1;for(i.data.copy(t),e-=i.data.length;i=i.next;){var r=i.data,a=e>r.length?r.length:e;if(r.copy(t,t.length-e,0,a),0==(e-=a)){a===r.length?(++s,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=r.slice(a));break}++s}return this.length-=s,t}},{key:h,value:function(e,t){return o(this,function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],i&&a(t.prototype,i),d&&a(t,d),e}()},75997:function(e,t,i){"use strict";var s=i(34155);function r(e,t){n(e,t),a(e)}function a(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function n(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var i=this,o=this._readableState&&this._readableState.destroyed,h=this._writableState&&this._writableState.destroyed;return o||h?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,s.nextTick(n,this,e)):s.nextTick(n,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?i._writableState?i._writableState.errorEmitted?s.nextTick(a,i):(i._writableState.errorEmitted=!0,s.nextTick(r,i,e)):s.nextTick(r,i,e):t?(s.nextTick(a,i),t(e)):s.nextTick(a,i)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var i=e._readableState,s=e._writableState;i&&i.autoDestroy||s&&s.autoDestroy?e.destroy(t):e.emit("error",t)}}},5800:function(e,t,i){"use strict";var s=i(84419).q.ERR_STREAM_PREMATURE_CLOSE;function r(){}e.exports=function e(t,i,a){if("function"==typeof i)return e(t,null,i);i||(i={}),a=function(e){var t=!1;return function(){if(!t){t=!0;for(var i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];e.apply(this,s)}}}(a||r);var n=i.readable||!1!==i.readable&&t.readable,o=i.writable||!1!==i.writable&&t.writable,h=function(){t.writable||c()},d=t._writableState&&t._writableState.finished,c=function(){o=!1,d=!0,n||a.call(t)},l=t._readableState&&t._readableState.endEmitted,u=function(){n=!1,l=!0,o||a.call(t)},f=function(e){a.call(t,e)},p=function(){var e;return n&&!l?(t._readableState&&t._readableState.ended||(e=new s),a.call(t,e)):o&&!d?(t._writableState&&t._writableState.ended||(e=new s),a.call(t,e)):void 0},m=function(){t.req.on("finish",c)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?o&&!t._writableState&&(t.on("end",h),t.on("close",h)):(t.on("complete",c),t.on("abort",p),t.req?m():t.on("request",m)),t.on("end",u),t.on("finish",c),!1!==i.error&&t.on("error",f),t.on("close",p),function(){t.removeListener("complete",c),t.removeListener("abort",p),t.removeListener("request",m),t.req&&t.req.removeListener("finish",c),t.removeListener("end",h),t.removeListener("close",h),t.removeListener("finish",c),t.removeListener("end",u),t.removeListener("error",f),t.removeListener("close",p)}}},98859:function(e){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},37065:function(e,t,i){"use strict";var s;var r=i(84419).q,a=r.ERR_MISSING_ARGS,n=r.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function h(e,t,r,a){a=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(a);var o=!1;e.on("close",(function(){o=!0})),void 0===s&&(s=i(5800)),s(e,{readable:t,writable:r},(function(e){if(e)return a(e);o=!0,a()}));var h=!1;return function(t){if(!o&&!h)return h=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void a(t||new n("pipe"))}}function d(e){e()}function c(e,t){return e.pipe(t)}function l(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}e.exports=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var s,r=l(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new a("streams");var n=t.map((function(e,i){var a=i<t.length-1;return h(e,a,i>0,(function(e){s||(s=e),e&&n.forEach(d),a||(n.forEach(d),r(s))}))}));return t.reduce(c)}},898:function(e,t,i){"use strict";var s=i(84419).q.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,i,r){var a=function(e,t,i){return null!=e.highWaterMark?e.highWaterMark:t?e[i]:null}(t,r,i);if(null!=a){if(!isFinite(a)||Math.floor(a)!==a||a<0)throw new s(r?i:"highWaterMark",a);return Math.floor(a)}return e.objectMode?16:16384}}},59819:function(e,t,i){e.exports=i(17187).EventEmitter},23872:function(e,t,i){(t=e.exports=i(44960)).Stream=t,t.Readable=t,t.Writable=i(92010),t.Duplex=i(34390),t.Transform=i(3912),t.PassThrough=i(41294),t.finished=i(5800),t.pipeline=i(37065)},74505:function(e,t,i){"use strict";var s=i(48764).Buffer,r=i(34155),a=i(48583),n=i(54860),o=i(42233),h=i(23001),d=i(77162);for(var c in d)t[c]=d[c];t.NONE=0,t.DEFLATE=1,t.INFLATE=2,t.GZIP=3,t.GUNZIP=4,t.DEFLATERAW=5,t.INFLATERAW=6,t.UNZIP=7;function l(e){if("number"!=typeof e||e<t.DEFLATE||e>t.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=e,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}l.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,a(this.init_done,"close before init"),a(this.mode<=t.UNZIP),this.mode===t.DEFLATE||this.mode===t.GZIP||this.mode===t.DEFLATERAW?o.deflateEnd(this.strm):this.mode!==t.INFLATE&&this.mode!==t.GUNZIP&&this.mode!==t.INFLATERAW&&this.mode!==t.UNZIP||h.inflateEnd(this.strm),this.mode=t.NONE,this.dictionary=null)},l.prototype.write=function(e,t,i,s,r,a,n){return this._write(!0,e,t,i,s,r,a,n)},l.prototype.writeSync=function(e,t,i,s,r,a,n){return this._write(!1,e,t,i,s,r,a,n)},l.prototype._write=function(e,i,n,o,h,d,c,l){if(a.equal(arguments.length,8),a(this.init_done,"write before init"),a(this.mode!==t.NONE,"already finalized"),a.equal(!1,this.write_in_progress,"write already in progress"),a.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,a.equal(!1,void 0===i,"must provide flush value"),this.write_in_progress=!0,i!==t.Z_NO_FLUSH&&i!==t.Z_PARTIAL_FLUSH&&i!==t.Z_SYNC_FLUSH&&i!==t.Z_FULL_FLUSH&&i!==t.Z_FINISH&&i!==t.Z_BLOCK)throw new Error("Invalid flush value");if(null==n&&(n=s.alloc(0),h=0,o=0),this.strm.avail_in=h,this.strm.input=n,this.strm.next_in=o,this.strm.avail_out=l,this.strm.output=d,this.strm.next_out=c,this.flush=i,!e)return this._process(),this._checkError()?this._afterSync():void 0;var u=this;return r.nextTick((function(){u._process(),u._after()})),this},l.prototype._afterSync=function(){var e=this.strm.avail_out,t=this.strm.avail_in;return this.write_in_progress=!1,[t,e]},l.prototype._process=function(){var e=null;switch(this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflate(this.strm,this.flush);break;case t.UNZIP:switch(this.strm.avail_in>0&&(e=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===e)break;if(31!==this.strm.input[e]){this.mode=t.INFLATE;break}if(this.gzip_id_bytes_read=1,e++,1===this.strm.avail_in)break;case 1:if(null===e)break;139===this.strm.input[e]?(this.gzip_id_bytes_read=2,this.mode=t.GUNZIP):this.mode=t.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:for(this.err=h.inflate(this.strm,this.flush),this.err===t.Z_NEED_DICT&&this.dictionary&&(this.err=h.inflateSetDictionary(this.strm,this.dictionary),this.err===t.Z_OK?this.err=h.inflate(this.strm,this.flush):this.err===t.Z_DATA_ERROR&&(this.err=t.Z_NEED_DICT));this.strm.avail_in>0&&this.mode===t.GUNZIP&&this.err===t.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=h.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},l.prototype._checkError=function(){switch(this.err){case t.Z_OK:case t.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===t.Z_FINISH)return this._error("unexpected end of file"),!1;break;case t.Z_STREAM_END:break;case t.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},l.prototype._after=function(){if(this._checkError()){var e=this.strm.avail_out,t=this.strm.avail_in;this.write_in_progress=!1,this.callback(t,e),this.pending_close&&this.close()}},l.prototype._error=function(e){this.strm.msg&&(e=this.strm.msg),this.onerror(e,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},l.prototype.init=function(e,i,s,r,n){a(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),a(e>=8&&e<=15,"invalid windowBits"),a(i>=-1&&i<=9,"invalid compression level"),a(s>=1&&s<=9,"invalid memlevel"),a(r===t.Z_FILTERED||r===t.Z_HUFFMAN_ONLY||r===t.Z_RLE||r===t.Z_FIXED||r===t.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(i,e,s,r,n),this._setDictionary()},l.prototype.params=function(){throw new Error("deflateParams Not supported")},l.prototype.reset=function(){this._reset(),this._setDictionary()},l.prototype._init=function(e,i,s,r,a){switch(this.level=e,this.windowBits=i,this.memLevel=s,this.strategy=r,this.flush=t.Z_NO_FLUSH,this.err=t.Z_OK,this.mode!==t.GZIP&&this.mode!==t.GUNZIP||(this.windowBits+=16),this.mode===t.UNZIP&&(this.windowBits+=32),this.mode!==t.DEFLATERAW&&this.mode!==t.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new n,this.mode){case t.DEFLATE:case t.GZIP:case t.DEFLATERAW:this.err=o.deflateInit2(this.strm,this.level,t.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case t.INFLATE:case t.GUNZIP:case t.INFLATERAW:case t.UNZIP:this.err=h.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==t.Z_OK&&this._error("Init error"),this.dictionary=a,this.write_in_progress=!1,this.init_done=!0},l.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:this.err=o.deflateSetDictionary(this.strm,this.dictionary)}this.err!==t.Z_OK&&this._error("Failed to set dictionary")}},l.prototype._reset=function(){switch(this.err=t.Z_OK,this.mode){case t.DEFLATE:case t.DEFLATERAW:case t.GZIP:this.err=o.deflateReset(this.strm);break;case t.INFLATE:case t.INFLATERAW:case t.GUNZIP:this.err=h.inflateReset(this.strm)}this.err!==t.Z_OK&&this._error("Failed to reset stream")},t.Zlib=l},42635:function(e,t,i){"use strict";var s=i(34155),r=i(48764).Buffer,a=i(42830).Transform,n=i(74505),o=i(89539),h=i(48583).ok,d=i(48764).kMaxLength,c="Cannot create final Buffer. It would be larger than 0x"+d.toString(16)+" bytes";n.Z_MIN_WINDOWBITS=8,n.Z_MAX_WINDOWBITS=15,n.Z_DEFAULT_WINDOWBITS=15,n.Z_MIN_CHUNK=64,n.Z_MAX_CHUNK=1/0,n.Z_DEFAULT_CHUNK=16384,n.Z_MIN_MEMLEVEL=1,n.Z_MAX_MEMLEVEL=9,n.Z_DEFAULT_MEMLEVEL=8,n.Z_MIN_LEVEL=-1,n.Z_MAX_LEVEL=9,n.Z_DEFAULT_LEVEL=n.Z_DEFAULT_COMPRESSION;for(var l=Object.keys(n),u=0;u<l.length;u++){var f=l[u];f.match(/^Z/)&&Object.defineProperty(t,f,{enumerable:!0,value:n[f],writable:!1})}for(var p={Z_OK:n.Z_OK,Z_STREAM_END:n.Z_STREAM_END,Z_NEED_DICT:n.Z_NEED_DICT,Z_ERRNO:n.Z_ERRNO,Z_STREAM_ERROR:n.Z_STREAM_ERROR,Z_DATA_ERROR:n.Z_DATA_ERROR,Z_MEM_ERROR:n.Z_MEM_ERROR,Z_BUF_ERROR:n.Z_BUF_ERROR,Z_VERSION_ERROR:n.Z_VERSION_ERROR},m=Object.keys(p),g=0;g<m.length;g++){var y=m[g];p[p[y]]=y}function b(e,t,i){var s=[],a=0;function n(){for(var t;null!==(t=e.read());)s.push(t),a+=t.length;e.once("readable",n)}function o(){var t,n=null;a>=d?n=new RangeError(c):t=r.concat(s,a),s=[],e.close(),i(n,t)}e.on("error",(function(t){e.removeListener("end",o),e.removeListener("readable",n),i(t)})),e.on("end",o),e.end(t),n()}function v(e,t){if("string"==typeof t&&(t=r.from(t)),!r.isBuffer(t))throw new TypeError("Not a string or buffer");var i=e._finishFlushFlag;return e._processChunk(t,i)}function w(e){if(!(this instanceof w))return new w(e);x.call(this,e,n.DEFLATE)}function S(e){if(!(this instanceof S))return new S(e);x.call(this,e,n.INFLATE)}function k(e){if(!(this instanceof k))return new k(e);x.call(this,e,n.GZIP)}function T(e){if(!(this instanceof T))return new T(e);x.call(this,e,n.GUNZIP)}function _(e){if(!(this instanceof _))return new _(e);x.call(this,e,n.DEFLATERAW)}function O(e){if(!(this instanceof O))return new O(e);x.call(this,e,n.INFLATERAW)}function M(e){if(!(this instanceof M))return new M(e);x.call(this,e,n.UNZIP)}function I(e){return e===n.Z_NO_FLUSH||e===n.Z_PARTIAL_FLUSH||e===n.Z_SYNC_FLUSH||e===n.Z_FULL_FLUSH||e===n.Z_FINISH||e===n.Z_BLOCK}function x(e,i){var s=this;if(this._opts=e=e||{},this._chunkSize=e.chunkSize||t.Z_DEFAULT_CHUNK,a.call(this,e),e.flush&&!I(e.flush))throw new Error("Invalid flush flag: "+e.flush);if(e.finishFlush&&!I(e.finishFlush))throw new Error("Invalid flush flag: "+e.finishFlush);if(this._flushFlag=e.flush||n.Z_NO_FLUSH,this._finishFlushFlag=void 0!==e.finishFlush?e.finishFlush:n.Z_FINISH,e.chunkSize&&(e.chunkSize<t.Z_MIN_CHUNK||e.chunkSize>t.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<t.Z_MIN_WINDOWBITS||e.windowBits>t.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<t.Z_MIN_LEVEL||e.level>t.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<t.Z_MIN_MEMLEVEL||e.memLevel>t.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=t.Z_FILTERED&&e.strategy!=t.Z_HUFFMAN_ONLY&&e.strategy!=t.Z_RLE&&e.strategy!=t.Z_FIXED&&e.strategy!=t.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!r.isBuffer(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new n.Zlib(i);var o=this;this._hadError=!1,this._handle.onerror=function(e,i){C(o),o._hadError=!0;var s=new Error(e);s.errno=i,s.code=t.codes[i],o.emit("error",s)};var h=t.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(h=e.level);var d=t.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(d=e.strategy),this._handle.init(e.windowBits||t.Z_DEFAULT_WINDOWBITS,h,e.memLevel||t.Z_DEFAULT_MEMLEVEL,d,e.dictionary),this._buffer=r.allocUnsafe(this._chunkSize),this._offset=0,this._level=h,this._strategy=d,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!s._handle},configurable:!0,enumerable:!0})}function C(e,t){t&&s.nextTick(t),e._handle&&(e._handle.close(),e._handle=null)}function P(e){e.emit("close")}Object.defineProperty(t,"codes",{enumerable:!0,value:Object.freeze(p),writable:!1}),t.Deflate=w,t.Inflate=S,t.Gzip=k,t.Gunzip=T,t.DeflateRaw=_,t.InflateRaw=O,t.Unzip=M,t.createDeflate=function(e){return new w(e)},t.createInflate=function(e){return new S(e)},t.createDeflateRaw=function(e){return new _(e)},t.createInflateRaw=function(e){return new O(e)},t.createGzip=function(e){return new k(e)},t.createGunzip=function(e){return new T(e)},t.createUnzip=function(e){return new M(e)},t.deflate=function(e,t,i){return"function"==typeof t&&(i=t,t={}),b(new w(t),e,i)},t.deflateSync=function(e,t){return v(new w(t),e)},t.gzip=function(e,t,i){return"function"==typeof t&&(i=t,t={}),b(new k(t),e,i)},t.gzipSync=function(e,t){return v(new k(t),e)},t.deflateRaw=function(e,t,i){return"function"==typeof t&&(i=t,t={}),b(new _(t),e,i)},t.deflateRawSync=function(e,t){return v(new _(t),e)},t.unzip=function(e,t,i){return"function"==typeof t&&(i=t,t={}),b(new M(t),e,i)},t.unzipSync=function(e,t){return v(new M(t),e)},t.inflate=function(e,t,i){return"function"==typeof t&&(i=t,t={}),b(new S(t),e,i)},t.inflateSync=function(e,t){return v(new S(t),e)},t.gunzip=function(e,t,i){return"function"==typeof t&&(i=t,t={}),b(new T(t),e,i)},t.gunzipSync=function(e,t){return v(new T(t),e)},t.inflateRaw=function(e,t,i){return"function"==typeof t&&(i=t,t={}),b(new O(t),e,i)},t.inflateRawSync=function(e,t){return v(new O(t),e)},o.inherits(x,a),x.prototype.params=function(e,i,r){if(e<t.Z_MIN_LEVEL||e>t.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e);if(i!=t.Z_FILTERED&&i!=t.Z_HUFFMAN_ONLY&&i!=t.Z_RLE&&i!=t.Z_FIXED&&i!=t.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+i);if(this._level!==e||this._strategy!==i){var a=this;this.flush(n.Z_SYNC_FLUSH,(function(){h(a._handle,"zlib binding closed"),a._handle.params(e,i),a._hadError||(a._level=e,a._strategy=i,r&&r())}))}else s.nextTick(r)},x.prototype.reset=function(){return h(this._handle,"zlib binding closed"),this._handle.reset()},x.prototype._flush=function(e){this._transform(r.alloc(0),"",e)},x.prototype.flush=function(e,t){var i=this,a=this._writableState;("function"==typeof e||void 0===e&&!t)&&(t=e,e=n.Z_FULL_FLUSH),a.ended?t&&s.nextTick(t):a.ending?t&&this.once("end",t):a.needDrain?t&&this.once("drain",(function(){return i.flush(e,t)})):(this._flushFlag=e,this.write(r.alloc(0),"",t))},x.prototype.close=function(e){C(this,e),s.nextTick(P,this)},x.prototype._transform=function(e,t,i){var s,a=this._writableState,o=(a.ending||a.ended)&&(!e||a.length===e.length);return null===e||r.isBuffer(e)?this._handle?(o?s=this._finishFlushFlag:(s=this._flushFlag,e.length>=a.length&&(this._flushFlag=this._opts.flush||n.Z_NO_FLUSH)),void this._processChunk(e,s,i)):i(new Error("zlib binding closed")):i(new Error("invalid input"))},x.prototype._processChunk=function(e,t,i){var s=e&&e.length,a=this._chunkSize-this._offset,n=0,o=this,l="function"==typeof i;if(!l){var u,f=[],p=0;this.on("error",(function(e){u=e})),h(this._handle,"zlib binding closed");do{var m=this._handle.writeSync(t,e,n,s,this._buffer,this._offset,a)}while(!this._hadError&&b(m[0],m[1]));if(this._hadError)throw u;if(p>=d)throw C(this),new RangeError(c);var g=r.concat(f,p);return C(this),g}h(this._handle,"zlib binding closed");var y=this._handle.write(t,e,n,s,this._buffer,this._offset,a);function b(d,c){if(this&&(this.buffer=null,this.callback=null),!o._hadError){var u=a-c;if(h(u>=0,"have should not go down"),u>0){var m=o._buffer.slice(o._offset,o._offset+u);o._offset+=u,l?o.push(m):(f.push(m),p+=m.length)}if((0===c||o._offset>=o._chunkSize)&&(a=o._chunkSize,o._offset=0,o._buffer=r.allocUnsafe(o._chunkSize)),0===c){if(n+=s-d,s=d,!l)return!0;var g=o._handle.write(t,e,n,s,o._buffer,o._offset,o._chunkSize);return g.callback=b,void(g.buffer=e)}if(!l)return!1;i()}}y.buffer=e,y.callback=b},o.inherits(w,x),o.inherits(S,x),o.inherits(k,x),o.inherits(T,x),o.inherits(_,x),o.inherits(O,x),o.inherits(M,x)},6907:function(e,t){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function s(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var r in i)s(i,r)&&(e[r]=i[r])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,i,s,r){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+s),r);else for(var a=0;a<s;a++)e[r+a]=t[i+a]},flattenChunks:function(e){var t,i,s,r,a,n;for(s=0,t=0,i=e.length;t<i;t++)s+=e[t].length;for(n=new Uint8Array(s),r=0,t=0,i=e.length;t<i;t++)a=e[t],n.set(a,r),r+=a.length;return n}},a={arraySet:function(e,t,i,s,r){for(var a=0;a<s;a++)e[r+a]=t[i+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,r)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(i)},47575:function(e){"use strict";e.exports=function(e,t,i,s){for(var r=65535&e|0,a=e>>>16&65535|0,n=0;0!==i;){i-=n=i>2e3?2e3:i;do{a=a+(r=r+t[s++]|0)|0}while(--n);r%=65521,a%=65521}return r|a<<16|0}},77162:function(e){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},13415:function(e){"use strict";var t=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();e.exports=function(e,i,s,r){var a=t,n=r+s;e^=-1;for(var o=r;o<n;o++)e=e>>>8^a[255&(e^i[o])];return-1^e}},42233:function(e,t,i){"use strict";var s,r=i(6907),a=i(81339),n=i(47575),o=i(13415),h=i(89364),d=-2,c=258,l=262,u=103,f=113,p=666;function m(e,t){return e.msg=h[t],t}function g(e){return(e<<1)-(e>4?9:0)}function y(e){for(var t=e.length;--t>=0;)e[t]=0}function b(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(r.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function v(e,t){a._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,b(e.strm)}function w(e,t){e.pending_buf[e.pending++]=t}function S(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function k(e,t){var i,s,r=e.max_chain_length,a=e.strstart,n=e.prev_length,o=e.nice_match,h=e.strstart>e.w_size-l?e.strstart-(e.w_size-l):0,d=e.window,u=e.w_mask,f=e.prev,p=e.strstart+c,m=d[a+n-1],g=d[a+n];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do{if(d[(i=t)+n]===g&&d[i+n-1]===m&&d[i]===d[a]&&d[++i]===d[a+1]){a+=2,i++;do{}while(d[++a]===d[++i]&&d[++a]===d[++i]&&d[++a]===d[++i]&&d[++a]===d[++i]&&d[++a]===d[++i]&&d[++a]===d[++i]&&d[++a]===d[++i]&&d[++a]===d[++i]&&a<p);if(s=c-(p-a),a=p-c,s>n){if(e.match_start=t,n=s,s>=o)break;m=d[a+n-1],g=d[a+n]}}}while((t=f[t&u])>h&&0!=--r);return n<=e.lookahead?n:e.lookahead}function T(e){var t,i,s,a,h,d,c,u,f,p,m=e.w_size;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=m+(m-l)){r.arraySet(e.window,e.window,m,m,0),e.match_start-=m,e.strstart-=m,e.block_start-=m,t=i=e.hash_size;do{s=e.head[--t],e.head[t]=s>=m?s-m:0}while(--i);t=i=m;do{s=e.prev[--t],e.prev[t]=s>=m?s-m:0}while(--i);a+=m}if(0===e.strm.avail_in)break;if(d=e.strm,c=e.window,u=e.strstart+e.lookahead,f=a,p=void 0,(p=d.avail_in)>f&&(p=f),i=0===p?0:(d.avail_in-=p,r.arraySet(c,d.input,d.next_in,p,u),1===d.state.wrap?d.adler=n(d.adler,c,p,u):2===d.state.wrap&&(d.adler=o(d.adler,c,p,u)),d.next_in+=p,d.total_in+=p,p),e.lookahead+=i,e.lookahead+e.insert>=3)for(h=e.strstart-e.insert,e.ins_h=e.window[h],e.ins_h=(e.ins_h<<e.hash_shift^e.window[h+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[h+3-1])&e.hash_mask,e.prev[h&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=h,h++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<l&&0!==e.strm.avail_in)}function _(e,t){for(var i,s;;){if(e.lookahead<l){if(T(e),e.lookahead<l&&0===t)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-l&&(e.match_length=k(e,i)),e.match_length>=3)if(s=a._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else s=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(v(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(v(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(v(e,!1),0===e.strm.avail_out)?1:2}function O(e,t){for(var i,s,r;;){if(e.lookahead<l){if(T(e),e.lookahead<l&&0===t)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-l&&(e.match_length=k(e,i),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,s=a._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(v(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((s=a._tr_tally(e,0,e.window[e.strstart-1]))&&v(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=a._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(v(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(v(e,!1),0===e.strm.avail_out)?1:2}function M(e,t,i,s,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=s,this.func=r}function I(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),y(this.dyn_ltree),y(this.dyn_dtree),y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function x(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:f,e.adler=2===t.wrap?0:1,t.last_flush=0,a._tr_init(t),0):m(e,d)}function C(e){var t,i=x(e);return 0===i&&((t=e.state).window_size=2*t.w_size,y(t.head),t.max_lazy_match=s[t.level].max_lazy,t.good_match=s[t.level].good_length,t.nice_match=s[t.level].nice_length,t.max_chain_length=s[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),i}function P(e,t,i,s,a,n){if(!e)return d;var o=1;if(-1===t&&(t=6),s<0?(o=0,s=-s):s>15&&(o=2,s-=16),a<1||a>9||8!==i||s<8||s>15||t<0||t>9||n<0||n>4)return m(e,d);8===s&&(s=9);var h=new I;return e.state=h,h.strm=e,h.wrap=o,h.gzhead=null,h.w_bits=s,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=a+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new r.Buf8(2*h.w_size),h.head=new r.Buf16(h.hash_size),h.prev=new r.Buf16(h.w_size),h.lit_bufsize=1<<a+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new r.Buf8(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=t,h.strategy=n,h.method=i,C(e)}s=[new M(0,0,0,0,(function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(T(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var s=e.block_start+i;if((0===e.strstart||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,v(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-l&&(v(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(v(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(v(e,!1),e.strm.avail_out),1)})),new M(4,4,8,4,_),new M(4,5,16,8,_),new M(4,6,32,32,_),new M(4,4,16,16,O),new M(8,16,32,32,O),new M(8,16,128,128,O),new M(8,32,128,256,O),new M(32,128,258,1024,O),new M(32,258,258,4096,O)],t.deflateInit=function(e,t){return P(e,t,8,15,8,0)},t.deflateInit2=P,t.deflateReset=C,t.deflateResetKeep=x,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?d:(e.state.gzhead=t,0):d},t.deflate=function(e,t){var i,r,n,h;if(!e||!e.state||t>5||t<0)return e?m(e,d):d;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===p&&4!==t)return m(e,0===e.avail_out?-5:d);if(r.strm=e,i=r.last_flush,r.last_flush=t,42===r.status)if(2===r.wrap)e.adler=0,w(r,31),w(r,139),w(r,8),r.gzhead?(w(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),w(r,255&r.gzhead.time),w(r,r.gzhead.time>>8&255),w(r,r.gzhead.time>>16&255),w(r,r.gzhead.time>>24&255),w(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),w(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(w(r,255&r.gzhead.extra.length),w(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=o(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(w(r,0),w(r,0),w(r,0),w(r,0),w(r,0),w(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),w(r,3),r.status=f);else{var l=8+(r.w_bits-8<<4)<<8;l|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(l|=32),l+=31-l%31,r.status=f,S(r,l),0!==r.strstart&&(S(r,e.adler>>>16),S(r,65535&e.adler)),e.adler=1}if(69===r.status)if(r.gzhead.extra){for(n=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>n&&(e.adler=o(e.adler,r.pending_buf,r.pending-n,n)),b(e),n=r.pending,r.pending!==r.pending_buf_size));)w(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>n&&(e.adler=o(e.adler,r.pending_buf,r.pending-n,n)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(e.adler=o(e.adler,r.pending_buf,r.pending-n,n)),b(e),n=r.pending,r.pending===r.pending_buf_size)){h=1;break}h=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,w(r,h)}while(0!==h);r.gzhead.hcrc&&r.pending>n&&(e.adler=o(e.adler,r.pending_buf,r.pending-n,n)),0===h&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(e.adler=o(e.adler,r.pending_buf,r.pending-n,n)),b(e),n=r.pending,r.pending===r.pending_buf_size)){h=1;break}h=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,w(r,h)}while(0!==h);r.gzhead.hcrc&&r.pending>n&&(e.adler=o(e.adler,r.pending_buf,r.pending-n,n)),0===h&&(r.status=u)}else r.status=u;if(r.status===u&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&b(e),r.pending+2<=r.pending_buf_size&&(w(r,255&e.adler),w(r,e.adler>>8&255),e.adler=0,r.status=f)):r.status=f),0!==r.pending){if(b(e),0===e.avail_out)return r.last_flush=-1,0}else if(0===e.avail_in&&g(t)<=g(i)&&4!==t)return m(e,-5);if(r.status===p&&0!==e.avail_in)return m(e,-5);if(0!==e.avail_in||0!==r.lookahead||0!==t&&r.status!==p){var k=2===r.strategy?function(e,t){for(var i;;){if(0===e.lookahead&&(T(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,i=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(v(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(v(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(v(e,!1),0===e.strm.avail_out)?1:2}(r,t):3===r.strategy?function(e,t){for(var i,s,r,n,o=e.window;;){if(e.lookahead<=c){if(T(e),e.lookahead<=c&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=o[r=e.strstart-1])===o[++r]&&s===o[++r]&&s===o[++r]){n=e.strstart+c;do{}while(s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&s===o[++r]&&r<n);e.match_length=c-(n-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=a._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=a._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(v(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(v(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(v(e,!1),0===e.strm.avail_out)?1:2}(r,t):s[r.level].func(r,t);if(3!==k&&4!==k||(r.status=p),1===k||3===k)return 0===e.avail_out&&(r.last_flush=-1),0;if(2===k&&(1===t?a._tr_align(r):5!==t&&(a._tr_stored_block(r,0,0,!1),3===t&&(y(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),b(e),0===e.avail_out))return r.last_flush=-1,0}return 4!==t?0:r.wrap<=0?1:(2===r.wrap?(w(r,255&e.adler),w(r,e.adler>>8&255),w(r,e.adler>>16&255),w(r,e.adler>>24&255),w(r,255&e.total_in),w(r,e.total_in>>8&255),w(r,e.total_in>>16&255),w(r,e.total_in>>24&255)):(S(r,e.adler>>>16),S(r,65535&e.adler)),b(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},t.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==u&&t!==f&&t!==p?m(e,d):(e.state=null,t===f?m(e,-3):0):d},t.deflateSetDictionary=function(e,t){var i,s,a,o,h,c,l,u,f=t.length;if(!e||!e.state)return d;if(2===(o=(i=e.state).wrap)||1===o&&42!==i.status||i.lookahead)return d;for(1===o&&(e.adler=n(e.adler,t,f,0)),i.wrap=0,f>=i.w_size&&(0===o&&(y(i.head),i.strstart=0,i.block_start=0,i.insert=0),u=new r.Buf8(i.w_size),r.arraySet(u,t,f-i.w_size,i.w_size,0),t=u,f=i.w_size),h=e.avail_in,c=e.next_in,l=e.input,e.avail_in=f,e.next_in=0,e.input=t,T(i);i.lookahead>=3;){s=i.strstart,a=i.lookahead-2;do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[s+3-1])&i.hash_mask,i.prev[s&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=s,s++}while(--a);i.strstart=s,i.lookahead=2,T(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=c,e.input=l,e.avail_in=h,i.wrap=o,0},t.deflateInfo="pako deflate (from Nodeca project)"},76438:function(e){"use strict";e.exports=function(e,t){var i,s,r,a,n,o,h,d,c,l,u,f,p,m,g,y,b,v,w,S,k,T,_,O,M;i=e.state,s=e.next_in,O=e.input,r=s+(e.avail_in-5),a=e.next_out,M=e.output,n=a-(t-e.avail_out),o=a+(e.avail_out-257),h=i.dmax,d=i.wsize,c=i.whave,l=i.wnext,u=i.window,f=i.hold,p=i.bits,m=i.lencode,g=i.distcode,y=(1<<i.lenbits)-1,b=(1<<i.distbits)-1;e:do{p<15&&(f+=O[s++]<<p,p+=8,f+=O[s++]<<p,p+=8),v=m[f&y];t:for(;;){if(f>>>=w=v>>>24,p-=w,0===(w=v>>>16&255))M[a++]=65535&v;else{if(!(16&w)){if(0==(64&w)){v=m[(65535&v)+(f&(1<<w)-1)];continue t}if(32&w){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}S=65535&v,(w&=15)&&(p<w&&(f+=O[s++]<<p,p+=8),S+=f&(1<<w)-1,f>>>=w,p-=w),p<15&&(f+=O[s++]<<p,p+=8,f+=O[s++]<<p,p+=8),v=g[f&b];i:for(;;){if(f>>>=w=v>>>24,p-=w,!(16&(w=v>>>16&255))){if(0==(64&w)){v=g[(65535&v)+(f&(1<<w)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(k=65535&v,p<(w&=15)&&(f+=O[s++]<<p,(p+=8)<w&&(f+=O[s++]<<p,p+=8)),(k+=f&(1<<w)-1)>h){e.msg="invalid distance too far back",i.mode=30;break e}if(f>>>=w,p-=w,k>(w=a-n)){if((w=k-w)>c&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(T=0,_=u,0===l){if(T+=d-w,w<S){S-=w;do{M[a++]=u[T++]}while(--w);T=a-k,_=M}}else if(l<w){if(T+=d+l-w,(w-=l)<S){S-=w;do{M[a++]=u[T++]}while(--w);if(T=0,l<S){S-=w=l;do{M[a++]=u[T++]}while(--w);T=a-k,_=M}}}else if(T+=l-w,w<S){S-=w;do{M[a++]=u[T++]}while(--w);T=a-k,_=M}for(;S>2;)M[a++]=_[T++],M[a++]=_[T++],M[a++]=_[T++],S-=3;S&&(M[a++]=_[T++],S>1&&(M[a++]=_[T++]))}else{T=a-k;do{M[a++]=M[T++],M[a++]=M[T++],M[a++]=M[T++],S-=3}while(S>2);S&&(M[a++]=M[T++],S>1&&(M[a++]=M[T++]))}break}}break}}while(s<r&&a<o);s-=S=p>>3,f&=(1<<(p-=S<<3))-1,e.next_in=s,e.next_out=a,e.avail_in=s<r?r-s+5:5-(s-r),e.avail_out=a<o?o-a+257:257-(a-o),i.hold=f,i.bits=p}},23001:function(e,t,i){"use strict";var s=i(6907),r=i(47575),a=i(13415),n=i(76438),o=i(11375),h=-2,d=12,c=30;function l(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function u(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new s.Buf16(320),this.work=new s.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function f(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new s.Buf32(852),t.distcode=t.distdyn=new s.Buf32(592),t.sane=1,t.back=-1,0):h}function p(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,f(e)):h}function m(e,t){var i,s;return e&&e.state?(s=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?h:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=i,s.wbits=t,p(e))):h}function g(e,t){var i,s;return e?(s=new u,e.state=s,s.window=null,0!==(i=m(e,t))&&(e.state=null),i):h}var y,b,v=!0;function w(e){if(v){var t;for(y=new s.Buf32(512),b=new s.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(o(1,e.lens,0,288,y,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;o(2,e.lens,0,32,b,0,e.work,{bits:5}),v=!1}e.lencode=y,e.lenbits=9,e.distcode=b,e.distbits=5}function S(e,t,i,r){var a,n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new s.Buf8(n.wsize)),r>=n.wsize?(s.arraySet(n.window,t,i-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):((a=n.wsize-n.wnext)>r&&(a=r),s.arraySet(n.window,t,i-r,a,n.wnext),(r-=a)?(s.arraySet(n.window,t,i-r,r,0),n.wnext=r,n.whave=n.wsize):(n.wnext+=a,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=a))),0}t.inflateReset=p,t.inflateReset2=m,t.inflateResetKeep=f,t.inflateInit=function(e){return g(e,15)},t.inflateInit2=g,t.inflate=function(e,t){var i,u,f,p,m,g,y,b,v,k,T,_,O,M,I,x,C,P,A,N,B,E,V,L,R=0,D=new s.Buf8(4),F=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return h;(i=e.state).mode===d&&(i.mode=13),m=e.next_out,f=e.output,y=e.avail_out,p=e.next_in,u=e.input,g=e.avail_in,b=i.hold,v=i.bits,k=g,T=y,E=0;e:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;v<16;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}if(2&i.wrap&&35615===b){i.check=0,D[0]=255&b,D[1]=b>>>8&255,i.check=a(i.check,D,2,0),b=0,v=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&b)<<8)+(b>>8))%31){e.msg="incorrect header check",i.mode=c;break}if(8!=(15&b)){e.msg="unknown compression method",i.mode=c;break}if(v-=4,B=8+(15&(b>>>=4)),0===i.wbits)i.wbits=B;else if(B>i.wbits){e.msg="invalid window size",i.mode=c;break}i.dmax=1<<B,e.adler=i.check=1,i.mode=512&b?10:d,b=0,v=0;break;case 2:for(;v<16;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}if(i.flags=b,8!=(255&i.flags)){e.msg="unknown compression method",i.mode=c;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=c;break}i.head&&(i.head.text=b>>8&1),512&i.flags&&(D[0]=255&b,D[1]=b>>>8&255,i.check=a(i.check,D,2,0)),b=0,v=0,i.mode=3;case 3:for(;v<32;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}i.head&&(i.head.time=b),512&i.flags&&(D[0]=255&b,D[1]=b>>>8&255,D[2]=b>>>16&255,D[3]=b>>>24&255,i.check=a(i.check,D,4,0)),b=0,v=0,i.mode=4;case 4:for(;v<16;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}i.head&&(i.head.xflags=255&b,i.head.os=b>>8),512&i.flags&&(D[0]=255&b,D[1]=b>>>8&255,i.check=a(i.check,D,2,0)),b=0,v=0,i.mode=5;case 5:if(1024&i.flags){for(;v<16;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}i.length=b,i.head&&(i.head.extra_len=b),512&i.flags&&(D[0]=255&b,D[1]=b>>>8&255,i.check=a(i.check,D,2,0)),b=0,v=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((_=i.length)>g&&(_=g),_&&(i.head&&(B=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),s.arraySet(i.head.extra,u,p,_,B)),512&i.flags&&(i.check=a(i.check,u,_,p)),g-=_,p+=_,i.length-=_),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===g)break e;_=0;do{B=u[p+_++],i.head&&B&&i.length<65536&&(i.head.name+=String.fromCharCode(B))}while(B&&_<g);if(512&i.flags&&(i.check=a(i.check,u,_,p)),g-=_,p+=_,B)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===g)break e;_=0;do{B=u[p+_++],i.head&&B&&i.length<65536&&(i.head.comment+=String.fromCharCode(B))}while(B&&_<g);if(512&i.flags&&(i.check=a(i.check,u,_,p)),g-=_,p+=_,B)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;v<16;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}if(b!==(65535&i.check)){e.msg="header crc mismatch",i.mode=c;break}b=0,v=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=d;break;case 10:for(;v<32;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}e.adler=i.check=l(b),b=0,v=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=m,e.avail_out=y,e.next_in=p,e.avail_in=g,i.hold=b,i.bits=v,2;e.adler=i.check=1,i.mode=d;case d:if(5===t||6===t)break e;case 13:if(i.last){b>>>=7&v,v-=7&v,i.mode=27;break}for(;v<3;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}switch(i.last=1&b,v-=1,3&(b>>>=1)){case 0:i.mode=14;break;case 1:if(w(i),i.mode=20,6===t){b>>>=2,v-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=c}b>>>=2,v-=2;break;case 14:for(b>>>=7&v,v-=7&v;v<32;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}if((65535&b)!=(b>>>16^65535)){e.msg="invalid stored block lengths",i.mode=c;break}if(i.length=65535&b,b=0,v=0,i.mode=15,6===t)break e;case 15:i.mode=16;case 16:if(_=i.length){if(_>g&&(_=g),_>y&&(_=y),0===_)break e;s.arraySet(f,u,p,_,m),g-=_,p+=_,y-=_,m+=_,i.length-=_;break}i.mode=d;break;case 17:for(;v<14;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}if(i.nlen=257+(31&b),b>>>=5,v-=5,i.ndist=1+(31&b),b>>>=5,v-=5,i.ncode=4+(15&b),b>>>=4,v-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=c;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;v<3;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}i.lens[F[i.have++]]=7&b,b>>>=3,v-=3}for(;i.have<19;)i.lens[F[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,V={bits:i.lenbits},E=o(0,i.lens,0,19,i.lencode,0,i.work,V),i.lenbits=V.bits,E){e.msg="invalid code lengths set",i.mode=c;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;x=(R=i.lencode[b&(1<<i.lenbits)-1])>>>16&255,C=65535&R,!((I=R>>>24)<=v);){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}if(C<16)b>>>=I,v-=I,i.lens[i.have++]=C;else{if(16===C){for(L=I+2;v<L;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}if(b>>>=I,v-=I,0===i.have){e.msg="invalid bit length repeat",i.mode=c;break}B=i.lens[i.have-1],_=3+(3&b),b>>>=2,v-=2}else if(17===C){for(L=I+3;v<L;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}v-=I,B=0,_=3+(7&(b>>>=I)),b>>>=3,v-=3}else{for(L=I+7;v<L;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}v-=I,B=0,_=11+(127&(b>>>=I)),b>>>=7,v-=7}if(i.have+_>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=c;break}for(;_--;)i.lens[i.have++]=B}}if(i.mode===c)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=c;break}if(i.lenbits=9,V={bits:i.lenbits},E=o(1,i.lens,0,i.nlen,i.lencode,0,i.work,V),i.lenbits=V.bits,E){e.msg="invalid literal/lengths set",i.mode=c;break}if(i.distbits=6,i.distcode=i.distdyn,V={bits:i.distbits},E=o(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,V),i.distbits=V.bits,E){e.msg="invalid distances set",i.mode=c;break}if(i.mode=20,6===t)break e;case 20:i.mode=21;case 21:if(g>=6&&y>=258){e.next_out=m,e.avail_out=y,e.next_in=p,e.avail_in=g,i.hold=b,i.bits=v,n(e,T),m=e.next_out,f=e.output,y=e.avail_out,p=e.next_in,u=e.input,g=e.avail_in,b=i.hold,v=i.bits,i.mode===d&&(i.back=-1);break}for(i.back=0;x=(R=i.lencode[b&(1<<i.lenbits)-1])>>>16&255,C=65535&R,!((I=R>>>24)<=v);){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}if(x&&0==(240&x)){for(P=I,A=x,N=C;x=(R=i.lencode[N+((b&(1<<P+A)-1)>>P)])>>>16&255,C=65535&R,!(P+(I=R>>>24)<=v);){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}b>>>=P,v-=P,i.back+=P}if(b>>>=I,v-=I,i.back+=I,i.length=C,0===x){i.mode=26;break}if(32&x){i.back=-1,i.mode=d;break}if(64&x){e.msg="invalid literal/length code",i.mode=c;break}i.extra=15&x,i.mode=22;case 22:if(i.extra){for(L=i.extra;v<L;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}i.length+=b&(1<<i.extra)-1,b>>>=i.extra,v-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;x=(R=i.distcode[b&(1<<i.distbits)-1])>>>16&255,C=65535&R,!((I=R>>>24)<=v);){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}if(0==(240&x)){for(P=I,A=x,N=C;x=(R=i.distcode[N+((b&(1<<P+A)-1)>>P)])>>>16&255,C=65535&R,!(P+(I=R>>>24)<=v);){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}b>>>=P,v-=P,i.back+=P}if(b>>>=I,v-=I,i.back+=I,64&x){e.msg="invalid distance code",i.mode=c;break}i.offset=C,i.extra=15&x,i.mode=24;case 24:if(i.extra){for(L=i.extra;v<L;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}i.offset+=b&(1<<i.extra)-1,b>>>=i.extra,v-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=c;break}i.mode=25;case 25:if(0===y)break e;if(_=T-y,i.offset>_){if((_=i.offset-_)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=c;break}_>i.wnext?(_-=i.wnext,O=i.wsize-_):O=i.wnext-_,_>i.length&&(_=i.length),M=i.window}else M=f,O=m-i.offset,_=i.length;_>y&&(_=y),y-=_,i.length-=_;do{f[m++]=M[O++]}while(--_);0===i.length&&(i.mode=21);break;case 26:if(0===y)break e;f[m++]=i.length,y--,i.mode=21;break;case 27:if(i.wrap){for(;v<32;){if(0===g)break e;g--,b|=u[p++]<<v,v+=8}if(T-=y,e.total_out+=T,i.total+=T,T&&(e.adler=i.check=i.flags?a(i.check,f,T,m-T):r(i.check,f,T,m-T)),T=y,(i.flags?b:l(b))!==i.check){e.msg="incorrect data check",i.mode=c;break}b=0,v=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;v<32;){if(0===g)break e;g--,b+=u[p++]<<v,v+=8}if(b!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=c;break}b=0,v=0}i.mode=29;case 29:E=1;break e;case c:E=-3;break e;case 31:return-4;default:return h}return e.next_out=m,e.avail_out=y,e.next_in=p,e.avail_in=g,i.hold=b,i.bits=v,(i.wsize||T!==e.avail_out&&i.mode<c&&(i.mode<27||4!==t))&&S(e,e.output,e.next_out,T-e.avail_out)?(i.mode=31,-4):(k-=e.avail_in,T-=e.avail_out,e.total_in+=k,e.total_out+=T,i.total+=T,i.wrap&&T&&(e.adler=i.check=i.flags?a(i.check,f,T,e.next_out-T):r(i.check,f,T,e.next_out-T)),e.data_type=i.bits+(i.last?64:0)+(i.mode===d?128:0)+(20===i.mode||15===i.mode?256:0),(0===k&&0===T||4===t)&&0===E&&(E=-5),E)},t.inflateEnd=function(e){if(!e||!e.state)return h;var t=e.state;return t.window&&(t.window=null),e.state=null,0},t.inflateGetHeader=function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?h:(i.head=t,t.done=!1,0):h},t.inflateSetDictionary=function(e,t){var i,s=t.length;return e&&e.state?0!==(i=e.state).wrap&&11!==i.mode?h:11===i.mode&&r(1,t,s,0)!==i.check?-3:S(e,t,s,s)?(i.mode=31,-4):(i.havedict=1,0):h},t.inflateInfo="pako inflate (from Nodeca project)"},11375:function(e,t,i){"use strict";var s=i(6907),r=15,a=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],o=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,i,d,c,l,u,f){var p,m,g,y,b,v,w,S,k,T=f.bits,_=0,O=0,M=0,I=0,x=0,C=0,P=0,A=0,N=0,B=0,E=null,V=0,L=new s.Buf16(16),R=new s.Buf16(16),D=null,F=0;for(_=0;_<=r;_++)L[_]=0;for(O=0;O<d;O++)L[t[i+O]]++;for(x=T,I=r;I>=1&&0===L[I];I--);if(x>I&&(x=I),0===I)return c[l++]=20971520,c[l++]=20971520,f.bits=1,0;for(M=1;M<I&&0===L[M];M++);for(x<M&&(x=M),A=1,_=1;_<=r;_++)if(A<<=1,(A-=L[_])<0)return-1;if(A>0&&(0===e||1!==I))return-1;for(R[1]=0,_=1;_<r;_++)R[_+1]=R[_]+L[_];for(O=0;O<d;O++)0!==t[i+O]&&(u[R[t[i+O]]++]=O);if(0===e?(E=D=u,v=19):1===e?(E=a,V-=257,D=n,F-=257,v=256):(E=o,D=h,v=-1),B=0,O=0,_=M,b=l,C=x,P=0,g=-1,y=(N=1<<x)-1,1===e&&N>852||2===e&&N>592)return 1;for(;;){w=_-P,u[O]<v?(S=0,k=u[O]):u[O]>v?(S=D[F+u[O]],k=E[V+u[O]]):(S=96,k=0),p=1<<_-P,M=m=1<<C;do{c[b+(B>>P)+(m-=p)]=w<<24|S<<16|k|0}while(0!==m);for(p=1<<_-1;B&p;)p>>=1;if(0!==p?(B&=p-1,B+=p):B=0,O++,0==--L[_]){if(_===I)break;_=t[i+u[O]]}if(_>x&&(B&y)!==g){for(0===P&&(P=x),b+=M,A=1<<(C=_-P);C+P<I&&!((A-=L[C+P])<=0);)C++,A<<=1;if(N+=1<<C,1===e&&N>852||2===e&&N>592)return 1;c[g=B&y]=x<<24|C<<16|b-l|0}}return 0!==B&&(c[b+B]=_-P<<24|64<<16|0),f.bits=x,0}},89364:function(e){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},81339:function(e,t,i){"use strict";var s=i(6907);function r(e){for(var t=e.length;--t>=0;)e[t]=0}var a=256,n=286,o=30,h=15,d=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],c=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],f=new Array(576);r(f);var p=new Array(60);r(p);var m=new Array(512);r(m);var g=new Array(256);r(g);var y=new Array(29);r(y);var b,v,w,S=new Array(o);function k(e,t,i,s,r){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=s,this.max_length=r,this.has_stree=e&&e.length}function T(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function _(e){return e<256?m[e]:m[256+(e>>>7)]}function O(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function M(e,t,i){e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,O(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function I(e,t,i){M(e,i[2*t],i[2*t+1])}function x(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1}function C(e,t,i){var s,r,a=new Array(16),n=0;for(s=1;s<=h;s++)a[s]=n=n+i[s-1]<<1;for(r=0;r<=t;r++){var o=e[2*r+1];0!==o&&(e[2*r]=x(a[o]++,o))}}function P(e){var t;for(t=0;t<n;t++)e.dyn_ltree[2*t]=0;for(t=0;t<o;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function A(e){e.bi_valid>8?O(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function N(e,t,i,s){var r=2*t,a=2*i;return e[r]<e[a]||e[r]===e[a]&&s[t]<=s[i]}function B(e,t,i){for(var s=e.heap[i],r=i<<1;r<=e.heap_len&&(r<e.heap_len&&N(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!N(t,s,e.heap[r],e.depth));)e.heap[i]=e.heap[r],i=r,r<<=1;e.heap[i]=s}function E(e,t,i){var s,r,n,o,h=0;if(0!==e.last_lit)do{s=e.pending_buf[e.d_buf+2*h]<<8|e.pending_buf[e.d_buf+2*h+1],r=e.pending_buf[e.l_buf+h],h++,0===s?I(e,r,t):(I(e,(n=g[r])+a+1,t),0!==(o=d[n])&&M(e,r-=y[n],o),I(e,n=_(--s),i),0!==(o=c[n])&&M(e,s-=S[n],o))}while(h<e.last_lit);I(e,256,t)}function V(e,t){var i,s,r,a=t.dyn_tree,n=t.stat_desc.static_tree,o=t.stat_desc.has_stree,d=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,i=0;i<d;i++)0!==a[2*i]?(e.heap[++e.heap_len]=c=i,e.depth[i]=0):a[2*i+1]=0;for(;e.heap_len<2;)a[2*(r=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[r]=0,e.opt_len--,o&&(e.static_len-=n[2*r+1]);for(t.max_code=c,i=e.heap_len>>1;i>=1;i--)B(e,a,i);r=d;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],B(e,a,1),s=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=s,a[2*r]=a[2*i]+a[2*s],e.depth[r]=(e.depth[i]>=e.depth[s]?e.depth[i]:e.depth[s])+1,a[2*i+1]=a[2*s+1]=r,e.heap[1]=r++,B(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,s,r,a,n,o,d=t.dyn_tree,c=t.max_code,l=t.stat_desc.static_tree,u=t.stat_desc.has_stree,f=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,m=t.stat_desc.max_length,g=0;for(a=0;a<=h;a++)e.bl_count[a]=0;for(d[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<573;i++)(a=d[2*d[2*(s=e.heap[i])+1]+1]+1)>m&&(a=m,g++),d[2*s+1]=a,s>c||(e.bl_count[a]++,n=0,s>=p&&(n=f[s-p]),o=d[2*s],e.opt_len+=o*(a+n),u&&(e.static_len+=o*(l[2*s+1]+n)));if(0!==g){do{for(a=m-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[m]--,g-=2}while(g>0);for(a=m;0!==a;a--)for(s=e.bl_count[a];0!==s;)(r=e.heap[--i])>c||(d[2*r+1]!==a&&(e.opt_len+=(a-d[2*r+1])*d[2*r],d[2*r+1]=a),s--)}}(e,t),C(a,c,e.bl_count)}function L(e,t,i){var s,r,a=-1,n=t[1],o=0,h=7,d=4;for(0===n&&(h=138,d=3),t[2*(i+1)+1]=65535,s=0;s<=i;s++)r=n,n=t[2*(s+1)+1],++o<h&&r===n||(o<d?e.bl_tree[2*r]+=o:0!==r?(r!==a&&e.bl_tree[2*r]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,a=r,0===n?(h=138,d=3):r===n?(h=6,d=3):(h=7,d=4))}function R(e,t,i){var s,r,a=-1,n=t[1],o=0,h=7,d=4;for(0===n&&(h=138,d=3),s=0;s<=i;s++)if(r=n,n=t[2*(s+1)+1],!(++o<h&&r===n)){if(o<d)do{I(e,r,e.bl_tree)}while(0!=--o);else 0!==r?(r!==a&&(I(e,r,e.bl_tree),o--),I(e,16,e.bl_tree),M(e,o-3,2)):o<=10?(I(e,17,e.bl_tree),M(e,o-3,3)):(I(e,18,e.bl_tree),M(e,o-11,7));o=0,a=r,0===n?(h=138,d=3):r===n?(h=6,d=3):(h=7,d=4)}}r(S);var D=!1;function F(e,t,i,r){M(e,0+(r?1:0),3),function(e,t,i,r){A(e),r&&(O(e,i),O(e,~i)),s.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}(e,t,i,!0)}t._tr_init=function(e){D||(!function(){var e,t,i,s,r,a=new Array(16);for(i=0,s=0;s<28;s++)for(y[s]=i,e=0;e<1<<d[s];e++)g[i++]=s;for(g[i-1]=s,r=0,s=0;s<16;s++)for(S[s]=r,e=0;e<1<<c[s];e++)m[r++]=s;for(r>>=7;s<o;s++)for(S[s]=r<<7,e=0;e<1<<c[s]-7;e++)m[256+r++]=s;for(t=0;t<=h;t++)a[t]=0;for(e=0;e<=143;)f[2*e+1]=8,e++,a[8]++;for(;e<=255;)f[2*e+1]=9,e++,a[9]++;for(;e<=279;)f[2*e+1]=7,e++,a[7]++;for(;e<=287;)f[2*e+1]=8,e++,a[8]++;for(C(f,287,a),e=0;e<o;e++)p[2*e+1]=5,p[2*e]=x(e,5);b=new k(f,d,257,n,h),v=new k(p,c,0,o,h),w=new k(new Array(0),l,0,19,7)}(),D=!0),e.l_desc=new T(e.dyn_ltree,b),e.d_desc=new T(e.dyn_dtree,v),e.bl_desc=new T(e.bl_tree,w),e.bi_buf=0,e.bi_valid=0,P(e)},t._tr_stored_block=F,t._tr_flush_block=function(e,t,i,s){var r,n,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<a;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),V(e,e.l_desc),V(e,e.d_desc),o=function(e){var t;for(L(e,e.dyn_ltree,e.l_desc.max_code),L(e,e.dyn_dtree,e.d_desc.max_code),V(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*u[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),r=e.opt_len+3+7>>>3,(n=e.static_len+3+7>>>3)<=r&&(r=n)):r=n=i+5,i+4<=r&&-1!==t?F(e,t,i,s):4===e.strategy||n===r?(M(e,2+(s?1:0),3),E(e,f,p)):(M(e,4+(s?1:0),3),function(e,t,i,s){var r;for(M(e,t-257,5),M(e,i-1,5),M(e,s-4,4),r=0;r<s;r++)M(e,e.bl_tree[2*u[r]+1],3);R(e,e.dyn_ltree,t-1),R(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),E(e,e.dyn_ltree,e.dyn_dtree)),P(e),s&&A(e)},t._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(g[i]+a+1)]++,e.dyn_dtree[2*_(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){M(e,2,3),I(e,256,f),function(e){16===e.bi_valid?(O(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},54860:function(e){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},67295:function(e,t,i){var s=i(48764).Buffer;e.exports=function(e,t){for(var i=Math.min(e.length,t.length),r=new s(i),a=0;a<i;++a)r[a]=e[a]^t[a];return r}},11853:function(e,t,i){"use strict";const s=i(48819),r=i(73901),a=i(6832),n=i(85806),o=i(73449),h="2.7.89";s.ccxtVersion=h;const d={ace:i(14837),alpaca:i(61454),ascendex:i(32300),bequant:i(21366),bigone:i(64400),binance:i(96056),binancecoinm:i(42483),binanceus:i(3393),binanceusdm:i(12137),bit2c:i(12455),bitbank:i(99703),bitbay:i(93528),bitbns:i(98875),bitcoincom:i(23334),bitfinex:i(17965),bitfinex2:i(5328),bitflyer:i(85421),bitforex:i(52519),bitget:i(20829),bithumb:i(29202),bitmart:i(69102),bitmex:i(87763),bitopro:i(84070),bitpanda:i(93223),bitrue:i(68120),bitso:i(25686),bitstamp:i(7653),bitstamp1:i(12554),bittrex:i(9461),bitvavo:i(54253),bkex:i(5510),bl3p:i(85480),blockchaincom:i(60167),btcalpha:i(66492),btcbox:i(6142),btcex:i(40212),btcmarkets:i(69284),btctradeua:i(20233),btcturk:i(51899),buda:i(64875),bybit:i(73803),cex:i(74228),coinbase:i(62939),coinbaseprime:i(18806),coinbasepro:i(51241),coincheck:i(51770),coinex:i(78427),coinfalcon:i(56810),coinmate:i(70948),coinone:i(69261),coinspot:i(98974),cryptocom:i(10073),currencycom:i(49610),delta:i(34237),deribit:i(41680),digifinex:i(6755),exmo:i(74101),flowbtc:i(63513),fmfwio:i(98161),gate:i(53927),gateio:i(94663),gemini:i(23094),hitbtc:i(28267),hitbtc3:i(22683),hollaex:i(94693),huobi:i(68639),huobijp:i(54072),huobipro:i(53775),idex:i(22574),independentreserve:i(73585),indodax:i(14535),itbit:i(21431),kraken:i(66594),kucoin:i(6987),kucoinfutures:i(70514),kuna:i(14400),latoken:i(22444),lbank:i(31524),lbank2:i(11044),luno:i(85439),lykke:i(25591),mercado:i(47551),mexc:i(10085),mexc3:i(67737),ndax:i(61985),novadax:i(11541),oceanex:i(7426),okcoin:i(21384),okex:i(58579),okex5:i(62597),okx:i(89352),paymium:i(30757),phemex:i(50788),poloniex:i(67497),poloniexfutures:i(8908),probit:i(96818),ripio:i(2041),stex:i(80842),therock:i(9269),tidex:i(46974),timex:i(41378),tokocrypto:i(9655),upbit:i(7705),wavesexchange:i(86091),wazirx:i(79741),whitebit:i(70390),woo:i(17630),yobit:i(65927),zaif:i(34422),zb:i(90927),zonda:i(79264)},c={alpaca:i(87882),ascendex:i(70425),bequant:i(25134),binance:i(77934),binancecoinm:i(96019),binanceus:i(77752),binanceusdm:i(88390),bitcoincom:i(12294),bitfinex:i(8129),bitfinex2:i(43501),bitget:i(96085),bitmart:i(72410),bitmex:i(62052),bitopro:i(87823),bitrue:i(86169),bitstamp:i(96604),bittrex:i(31579),bitvavo:i(5089),btcex:i(39441),bybit:i(5520),cex:i(782),coinbaseprime:i(96451),coinbasepro:i(57385),coinex:i(31094),cryptocom:i(19300),currencycom:i(55537),deribit:i(74844),exmo:i(8140),gate:i(59017),gateio:i(64581),gemini:i(28005),hitbtc:i(59306),hollaex:i(33622),huobi:i(85225),huobijp:i(90396),huobipro:i(50483),idex:i(94436),kraken:i(75905),kucoin:i(37416),kucoinfutures:i(87685),luno:i(48375),mexc:i(46632),ndax:i(19994),okcoin:i(65577),okex:i(73885),okx:i(80613),phemex:i(36053),ripio:i(12955),upbit:i(24377),wazirx:i(55905),whitebit:i(89997),woo:i(71354),zb:i(80922)};for(const e in c){const t=d[e];"Exchange"===Object.getPrototypeOf(t).name&&(Object.setPrototypeOf(t,r),Object.setPrototypeOf(t.prototype,r.prototype))}c.version=h,c.exchanges=Object.keys(c),c.Exchange=r,e.exports=Object.assign({version:h,Exchange:s,Precise:a,exchanges:Object.keys(d),pro:c},d,n,o)},14837:function(e,t,i){"use strict";const s=i(48819),{ArgumentsRequired:r,BadRequest:a,AuthenticationError:n,InsufficientFunds:o,InvalidOrder:h}=i(73449),{TICK_SIZE:d}=i(62115),c=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"ace",name:"ACE",countries:["TW"],version:"v2",rateLimit:100,pro:!1,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,cancelAllOrders:!1,cancelOrder:!0,cancelOrders:!1,createOrder:!0,editOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchClosedOrders:!1,fetchCurrencies:!1,fetchDepositAddress:!1,fetchDeposits:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchOrderTrades:!0,fetchPositionMode:!1,fetchPositions:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!1,fetchTrades:!1,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransactionFees:!1,fetchTransactions:!1,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!1,fetchWithdrawals:!1,setLeverage:!1,setMarginMode:!1,transfer:!1,withdraw:!1},timeframes:{"1m":1,"5m":5,"10m":10,"30m":10,"1h":60,"2h":120,"4h":240,"8h":480,"12h":720,"1d":24,"1w":70,"1M":31},urls:{logo:"https://user-images.githubusercontent.com/1294454/216908003-fb314cf6-e66e-471c-b91d-1d86e4baaa90.jpg",api:{public:"https://ace.io/polarisex",private:"https://ace.io/polarisex/open"},www:"https://ace.io/",doc:["https://github.com/ace-exchange/ace-offical-api-docs"],fees:"https://helpcenter.ace.io/hc/zh-tw/articles/360018609132-%E8%B2%BB%E7%8E%87%E8%AA%AA%E6%98%8E"},requiredCredentials:{apiKey:!0,secret:!0},api:{public:{get:["oapi/v2/list/tradePrice","oapi/v2/list/marketPair","open/v2/public/getOrderBook"]},private:{post:["v2/coin/customerAccount","v2/kline/getKline","v2/order/order","v2/order/cancel","v2/order/getOrderList","v2/order/showOrderStatus","v2/order/showOrderHistory","v2/order/getTradeList"]}},fees:{trading:{percentage:!0,maker:this.parseNumber("0.0005"),taker:this.parseNumber("0.001")}},options:{brokerId:"ccxt"},precisionMode:d,exceptions:{exact:{2003:h,2004:h,2005:h,2021:o,2036:h,2039:h,2053:h,2061:a,2063:h,9996:a,10012:n,20182:n,20183:h},broad:{}},commonCurrencies:{}})}async fetchMarkets(e={}){const t=await this.publicGetOapiV2ListMarketPair(),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"base"),a=this.safeCurrencyCode(r),n=this.safeString(s,"quote"),o=this.safeCurrencyCode(n),h=r+"/"+n;i.push({id:this.safeString(s,"symbol"),uppercaseId:void 0,symbol:h,base:a,baseId:this.safeInteger(s,"baseCurrencyId"),quote:o,quoteId:this.safeInteger(s,"quoteCurrencyId"),settle:void 0,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,derivative:!1,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,limits:{amount:{min:this.safeNumber(s,"minLimitBaseAmount"),max:this.safeNumber(s,"maxLimitBaseAmount")},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0},leverage:{min:void 0,max:void 0}},precision:{price:this.parseNumber(this.parsePrecision(this.safeString(s,"quotePrecision"))),amount:this.parseNumber(this.parsePrecision(this.safeString(s,"basePrecision")))},active:void 0,info:s})}return i}parseTicker(e,t){const i=this.safeString(e,"id"),s=this.safeSymbol(i,t);return this.safeTicker({symbol:s,timestamp:void 0,datetime:void 0,high:void 0,low:void 0,bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:void 0,close:this.safeString(e,"last_price"),last:this.safeString(e,"last_price"),previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"base_volume"),quoteVolume:this.safeString(e,"quote_volume"),info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s=await this.publicGetOapiV2ListTradePrice(t),r=i.id,a=this.safeValue(s,r,{});return this.parseTicker(a,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetOapiV2ListTradePrice(),s=[],r=Object.keys(i);for(let e=0;e<r.length;e++){const t=r[e],a=this.safeMarket(t),n=this.safeValue(i,t),o=this.parseTicker(n,a);s.push(o)}return this.filterByArray(s,"symbol",e)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={quoteCurrencyId:s.quoteId,baseCurrencyId:s.baseId};void 0!==t&&(r.depth=t);const a=await this.publicGetOpenV2PublicGetOrderBook(this.extend(r,i)),n=this.safeValue(a,"attachment");return this.parseOrderBook(n,s.symbol,void 0,"bids","asks")}parseOHLCV(e,t){const i=this.safeString(e,"createTime");let s=this.parse8601(i);return void 0!==s&&(s-=288e5),[s,this.safeNumber(e,"openPrice"),this.safeNumber(e,"highPrice"),this.safeNumber(e,"lowPrice"),this.safeNumber(e,"closePrice"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={duration:this.timeframes[t],quoteCurrencyId:a.quoteId,baseCurrencyId:a.baseId};void 0!==s&&(n.limit=s),void 0!==i&&(n.startTime=i);const o=await this.privatePostV2KlineGetKline(this.extend(n,r)),h=this.safeValue(o,"attachment",[]);return this.parseOHLCVs(h,a,t,i,s)}parseOrderStatus(e){return this.safeString({0:"open",1:"open",2:"closed",4:"canceled",5:"canceled"},e,void 0)}parseOrder(e,t){let i,s,r,a,n,o,h,d,c,l,u;if("string"==typeof e)i=e;else{if(i=this.safeString(e,"orderNo"),s=this.safeInteger(e,"orderTimeStamp"),void 0===s){const t=this.safeString(e,"orderTime");void 0!==t&&(s=this.parse8601(t),s-=288e5)}const t=this.safeNumber(e,"buyOrSell");void 0!==t&&(o=1===t?"buy":"sell"),n=this.safeString(e,"num"),a=this.safeString(e,"price");const f=this.safeString(e,"quoteCurrencyName"),p=this.safeString(e,"baseCurrencyName");void 0!==f&&void 0!==p&&(r=p+"/"+f);const m=this.safeNumber(e,"type");void 0!==m&&(h=1===m?"limit":"market"),c=this.safeString(e,"tradeNum"),l=this.safeString(e,"remainNum"),d=this.parseOrderStatus(this.safeString(e,"status")),u=this.safeString(e,"averagePrice")}return this.safeOrder({id:i,clientOrderId:void 0,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:void 0,symbol:r,type:h,timeInForce:void 0,postOnly:void 0,side:o,price:a,stopPrice:void 0,amount:n,cost:void 0,average:u,filled:c,remaining:l,status:d,fee:void 0,trades:void 0,info:e},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=t.toUpperCase(),h=i.toUpperCase(),d={baseCurrencyId:n.baseId,quoteCurrencyId:n.quoteId,type:"LIMIT"===o?1:2,buyOrSell:"BUY"===h?1:2,num:this.amountToPrecision(e,s)};"limit"===t&&(d.price=this.priceToPrecision(e,r));const c=await this.privatePostV2OrderOrder(this.extend(d,a),a),l=this.safeValue(c,"attachment");return this.parseOrder(l,n)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={orderNo:e};return await this.privatePostV2OrderCancel(this.extend(s,i))}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={orderNo:e},r=await this.privatePostV2OrderShowOrderStatus(this.extend(s,i)),a=this.safeValue(r,"attachment");return this.parseOrder(a,void 0)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new r(this.id+" fetchOpenOrders() requires the symbol argument");await this.loadMarkets();const a=this.market(e),n={quoteCurrencyId:a.quoteId,baseCurrencyId:a.baseId};void 0!==i&&(n.size=i);const o=await this.privatePostV2OrderGetOrderList(this.extend(n,s),s),h=this.safeValue(o,"attachment");return this.parseOrders(h,a,t,i)}parseTrade(e,t){const i=this.safeString(e,"tradeNo"),s=this.safeString(e,"price"),r=this.safeString(e,"num");let a=this.safeInteger(e,"tradeTimestamp");if(void 0===a){const t=this.safeString2(e,"time","tradeTime");a=this.parse8601(t),a-=288e5}let n=t.symbol;const o=this.safeString(e,"quoteCurrencyName"),h=this.safeString(e,"baseCurrencyName");let d;void 0!==o&&void 0!==h&&(n=h+"/"+o);const l=this.safeNumber(e,"buyOrSell");void 0!==l&&(d=1===l?"buy":"sell");const u=this.safeString(e,"fee");let f;if(void 0!==u){const t=this.safeString(e,"feeSave");f={cost:c.stringSub(u,t),currency:o}}return this.safeTrade({info:e,id:i,order:this.safeString(e,"orderNo"),symbol:n,side:d,type:void 0,takerOrMaker:void 0,price:s,amount:r,cost:void 0,fee:f,timestamp:a,datetime:this.iso8601(a)},t)}async fetchOrderTrades(e,t,i,s,r={}){await this.loadMarkets();const a=this.safeMarket(t),n={orderNo:e},o=await this.privatePostV2OrderShowOrderHistory(this.extend(n,r)),h=this.safeValue(o,"attachment"),d=this.safeValue(h,"trades");return void 0===d?d:await this.parseTrades(d,a,i,s)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r=this.safeMarket(e),a={};void 0!==r.id&&(a.quoteCurrencyId=r.quoteId,a.baseCurrencyId=r.baseId),void 0!==i&&(a.size=i);const n=await this.privatePostV2OrderGetTradeList(this.extend(a,s)),o=this.safeValue(n,"attachment",[]);return this.parseTrades(o,r,t,i)}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currencyName"),a=this.safeCurrencyCode(r),n=this.safeString(s,"amount"),o={free:this.safeString(s,"cashAmount"),total:n};t[a]=o}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostV2CoinCustomerAccount(e),i=this.safeValue(t,"attachment",[]);return this.parseBalance(i)}sign(e,t="public",i="GET",s={},r,a){let n="/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if(void 0===r&&(r={}),"private"===t){this.checkRequiredCredentials();const e=this.milliseconds();let t="ACE_SIGN"+this.secret;const n=this.extend({apiKey:this.apiKey,timeStamp:e},s),o=Object.keys(n),h=this.sortBy(o,0);for(let e=0;e<h.length;e++){const i=h[e];t+=this.safeString(n,i)}const d=this.hash(this.encode(t),"sha256","hex");if(n.signKey=d,r={"Content-Type":"application/x-www-form-urlencoded"},"POST"===i){const e=this.safeString(this.options,"brokerId");void 0!==e&&(r.Referer=e)}a=this.urlencode(n)}else"public"===t&&"GET"===i&&Object.keys(o).length&&(n+="?"+this.urlencode(o));return n=this.urls.api[t]+n,{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,n,o,h){if(void 0===n)return;const d=this.id+" "+a,c=this.safeNumber(n,"status",200);c>200&&(this.throwExactlyMatchedException(this.exceptions.exact,c,d),this.throwBroadlyMatchedException(this.exceptions.broad,c,d))}}},61454:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,BadRequest:a,PermissionDenied:n,BadSymbol:o,NotSupported:h,InsufficientFunds:d,InvalidOrder:c}=i(73449),{TICK_SIZE:l}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"alpaca",name:"Alpaca",countries:["US"],rateLimit:333,hostname:"alpaca.markets",pro:!0,urls:{logo:"https://user-images.githubusercontent.com/1294454/187234005-b864db3d-f1e3-447a-aaf9-a9fc7b955d07.jpg",www:"https://alpaca.markets",api:{public:"https://api.{hostname}/{version}",private:"https://api.{hostname}/{version}",cryptoPublic:"https://data.{hostname}/{version}",markets:"https://api.{hostname}/{version}"},test:{public:"https://paper-api.{hostname}/{version}",private:"https://paper-api.{hostname}/{version}",cryptoPublic:"https://data.{hostname}/{version}",markets:"https://api.{hostname}/{version}"},doc:"https://alpaca.markets/docs/",fees:"https://alpaca.markets/support/what-are-the-fees-associated-with-crypto-trading/"},has:{CORS:!1,spot:!0,margin:!1,swap:!1,future:!1,option:!1,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,fetchBalance:!0,fetchBidsAsks:!1,fetchClosedOrders:!1,fetchCurrencies:!1,fetchDepositAddress:!1,fetchDepositAddressesByNetwork:!1,fetchDeposits:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRates:!1,fetchL1OrderBook:!0,fetchL2OrderBook:!1,fetchMarkets:!0,fetchMyTrades:!1,fetchOHLCV:!0,fetchOpenOrder:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchPositions:!1,fetchStatus:!1,fetchTicker:!1,fetchTickers:!1,fetchTime:!1,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransactionFees:!1,fetchTransactions:!1,fetchTransfers:!1,fetchWithdrawals:!1,setLeverage:!1,setMarginMode:!1,transfer:!1,withdraw:!1},api:{markets:{get:["assets/public/beta"]},private:{get:["account","orders","orders/{order_id}","positions","positions/{symbol}","account/activities/{activity_type}"],post:["orders"],delete:["orders","orders/{order_id}"]},cryptoPublic:{get:["crypto/latest/orderbooks","crypto/trades","crypto/quotes","crypto/latest/quotes","crypto/bars","crypto/snapshots"]}},timeframes:{"1m":"1min","3m":"3min","5m":"5min","15m":"15min","30m":"30min","1h":"1H","2h":"2H","4h":"4H","6h":"6H","8h":"8H","12h":"12H","1d":"1D","3d":"3D","1w":"1W","1M":"1M"},precisionMode:l,requiredCredentials:{apiKey:!0,secret:!0},fees:{trading:{tierBased:!0,percentage:!0,maker:this.parseNumber("0.003"),taker:this.parseNumber("0.003"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.003")],[this.parseNumber("500000"),this.parseNumber("0.0028")],[this.parseNumber("1000000"),this.parseNumber("0.0025")],[this.parseNumber("5000000"),this.parseNumber("0.002")],[this.parseNumber("10000000"),this.parseNumber("0.0018")],[this.parseNumber("25000000"),this.parseNumber("0.0015")],[this.parseNumber("50000000"),this.parseNumber("0.00125")],[this.parseNumber("100000000"),this.parseNumber("0.001")]],maker:[[this.parseNumber("0"),this.parseNumber("0.003")],[this.parseNumber("500000"),this.parseNumber("0.0028")],[this.parseNumber("1000000"),this.parseNumber("0.0025")],[this.parseNumber("5000000"),this.parseNumber("0.002")],[this.parseNumber("10000000"),this.parseNumber("0.0018")],[this.parseNumber("25000000"),this.parseNumber("0.0015")],[this.parseNumber("50000000"),this.parseNumber("0.00125")],[this.parseNumber("100000000"),this.parseNumber("0.001")]]}}},headers:{"APCA-PARTNER-ID":"ccxt"},options:{fetchTradesMethod:"cryptoPublicGetCryptoTrades",fetchOHLCVMethod:"cryptoPublicGetCryptoBars",versions:{public:"v2",private:"v2",cryptoPublic:"v1beta2",markets:"v2"},defaultExchange:"CBSE",exchanges:["CBSE","FTX","GNSS","ERSX"],defaultTimeInForce:"gtc",clientOrderId:"ccxt_{id}"},exceptions:{exact:{"forbidden.":n,4041e4:c,40010001:a,4011e4:n,4031e4:d},broad:{"Invalid format for parameter":a,"Invalid symbol":o}}})}async fetchMarkets(e={}){const t=await this.marketsGetAssetsPublicBeta(this.extend({asset_class:"crypto",tradeable:!0},e)),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"symbol"),a=r.split("/"),n=this.safeString(a,0),o=this.safeString(a,1),h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o),c=h+"/"+d,l="active"===this.safeString(s,"status"),u=this.safeNumber(s,"min_order_size"),f=this.safeNumber(s,"min_trade_increment"),p=this.safeNumber(s,"price_increment");i.push({id:r,symbol:c,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:void 0,swap:!1,future:!1,option:!1,active:l,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:f,price:p},limits:{leverage:{min:void 0,max:void 0},amount:{min:u,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:s})}return i}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbols:r.id};void 0!==t&&(a.start=this.iso8601(t)),void 0!==i&&(a.limit=parseInt(i));const n=this.safeString(this.options,"fetchTradesMethod","cryptoPublicGetCryptoTrades"),o=await this[n](this.extend(a,s)),h=this.safeValue(o,"trades",{}),d=this.safeValue(h,r.id,{});return this.parseTrades(d,r,t,i)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r=s.id,a={symbols:r},n=await this.cryptoPublicGetCryptoLatestOrderbooks(this.extend(a,i)),o=this.safeValue(n,"orderbooks",{}),h=this.safeValue(o,r,{}),d=this.parse8601(this.safeString(h,"t"));return this.parseOrderBook(h,s.symbol,d,"b","a","p","s")}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbols:a.id,timeframe:this.safeString(this.timeframes,t,t)};void 0!==s&&(n.limit=s),void 0!==i&&(n.start=this.yyyymmdd(i));const o=this.safeString(this.options,"fetchOHLCVMethod","cryptoPublicGetCryptoBars"),h=await this[o](this.extend(n,r)),d=this.safeValue(h,"bars",{}),c=this.safeValue(d,a.id,{});return this.parseOHLCVs(c,a,t,i,s)}parseOHLCV(e,t){const i=this.safeString(e,"t");return[this.parse8601(i),this.safeNumber(e,"o"),this.safeNumber(e,"h"),this.safeNumber(e,"l"),this.safeNumber(e,"c"),this.safeNumber(e,"v")]}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={symbol:n.id,qty:this.amountToPrecision(e,s),side:i,type:t},d=this.safeStringN(a,["triggerPrice","stop_price"]);if(void 0!==d){let i;if(!(t.indexOf("limit")>=0))throw new h(this.id+" createOrder() does not support stop orders for "+t+" orders, only stop_limit orders are supported");i="stop_limit",o.stop_price=this.priceToPrecision(e,d),o.type=i}t.indexOf("limit")>=0&&(o.limit_price=this.priceToPrecision(e,r));const c=this.safeString(this.options,"defaultTimeInForce");o.time_in_force=this.safeString(a,"timeInForce",c),a=this.omit(a,["timeInForce","triggerPrice"]);const l=this.safeString(this.options,"clientOrderId"),u=this.uuid().split("-").join(""),f=this.implodeParams(l,{id:u}),p=this.safeString(a,"clientOrderId",f);o.client_order_id=p,a=this.omit(a,["clientOrderId"]);const m=await this.privatePostOrders(this.extend(o,a));return this.parseOrder(m,n)}async cancelOrder(e,t,i={}){const s={order_id:e},r=await this.privateDeleteOrdersOrderId(this.extend(s,i));return this.safeValue(r,"message",{})}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={order_id:e},r=await this.privateGetOrdersOrderId(this.extend(s,i)),a=this.safeString(r,"symbol"),n=this.safeMarket(a);return this.parseOrder(r,n)}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e));const a=await this.privateGetOrders(s);return this.parseOrders(a,r,t,i)}parseOrder(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeString(e,"status"),a=this.parseOrderStatus(r),n=this.safeString(e,"commission");let o;void 0!==n&&(o={cost:n,currency:"USD"});let h=this.safeString(e,"order_type");h.indexOf("limit")>=0&&(h="limit");const d=this.safeString(e,"submitted_at"),c=this.parse8601(d);return this.safeOrder({id:this.safeString(e,"id"),clientOrderId:this.safeString(e,"client_order_id"),timestamp:c,datetime:d,lastTradeTimeStamp:void 0,status:a,symbol:s,type:h,timeInForce:this.parseTimeInForce(this.safeString(e,"time_in_force")),postOnly:void 0,side:this.safeString(e,"side"),price:this.safeNumber(e,"limit_price"),stopPrice:this.safeNumber(e,"stop_price"),triggerPrice:this.safeNumber(e,"stop_price"),cost:void 0,average:this.safeNumber(e,"filled_avg_price"),amount:this.safeNumber(e,"qty"),filled:this.safeNumber(e,"filled_qty"),remaining:void 0,trades:void 0,fee:o,info:e},t)}parseOrderStatus(e){return this.safeString({pending_new:"open",accepted:"open",new:"open",partially_filled:"open",activated:"open",filled:"closed"},e,e)}parseTimeInForce(e){return this.safeString({day:"Day"},e,e)}parseTrade(e,t){const i=this.safeString(e,"S"),s=this.safeSymbol(i,t),r=this.safeString(e,"t"),a=this.parse8601(r),n=this.safeString(e,"tks");let o;"B"===n?o="buy":"S"===n&&(o="sell");const h=this.safeString(e,"p"),d=this.safeString(e,"s");return this.safeTrade({info:e,id:this.safeString(e,"i"),timestamp:a,datetime:this.iso8601(a),symbol:s,order:void 0,type:void 0,side:o,takerOrMaker:"taker",price:h,amount:d,cost:void 0,fee:void 0},t)}sign(e,t="public",i="GET",s={},r,a){const n=this.safeValue(this.options,"versions"),o=this.safeString(n,t);let h="/"+this.implodeParams(e,s),d=this.implodeParams(this.urls.api[t],{version:o});d=this.implodeHostname(d),r=void 0!==r?r:{},"private"===t&&(r["APCA-API-KEY-ID"]=this.apiKey,r["APCA-API-SECRET-KEY"]=this.secret);const c=this.omit(s,this.extractParams(e));return Object.keys(c).length&&("GET"===i||"DELETE"===i?h+="?"+this.urlencode(c):(a=this.json(c),r["Content-Type"]="application/json")),d+=h,{url:d,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;const c=this.id+" "+n,l=this.safeString(o,"code");void 0!==e&&this.throwExactlyMatchedException(this.exceptions.exact,l,c);const u=this.safeValue(o,"message",void 0);if(void 0!==u)throw this.throwExactlyMatchedException(this.exceptions.exact,u,c),this.throwBroadlyMatchedException(this.exceptions.broad,u,c),new r(c)}}},32300:function(e,t,i){"use strict";const s=i(48819),{ArgumentsRequired:r,AuthenticationError:a,ExchangeError:n,InsufficientFunds:o,InvalidOrder:h,BadSymbol:d,PermissionDenied:c,BadRequest:l}=i(73449),{TICK_SIZE:u}=i(62115),f=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"ascendex",name:"AscendEX",countries:["SG"],rateLimit:400,certified:!1,pro:!0,has:{CORS:void 0,spot:!0,margin:!0,swap:!0,future:!0,option:!1,addMargin:!0,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,createPostOnlyOrder:!0,createReduceOnlyOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchAccounts:!0,fetchBalance:!0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDepositAddressesByNetwork:!1,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:"emulated",fetchFundingRateHistory:!1,fetchFundingRates:!0,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!0,fetchMarginMode:!1,fetchMarketLeverageTiers:"emulated",fetchMarkets:!0,fetchMarkOHLCV:!1,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!0,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactionFee:!1,fetchTransactionFees:!1,fetchTransactions:!0,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!1,fetchWithdrawals:!0,reduceMargin:!0,setLeverage:!0,setMarginMode:!0,setPositionMode:!1,transfer:!0},timeframes:{"1m":"1","5m":"5","15m":"15","30m":"30","1h":"60","2h":"120","4h":"240","6h":"360","12h":"720","1d":"1d","1w":"1w","1M":"1m"},version:"v2",urls:{logo:"https://user-images.githubusercontent.com/1294454/112027508-47984600-8b48-11eb-9e17-d26459cc36c6.jpg",api:{rest:"https://ascendex.com"},test:{rest:"https://api-test.ascendex-sandbox.com"},www:"https://ascendex.com",doc:["https://ascendex.github.io/ascendex-pro-api/#ascendex-pro-api-documentation"],fees:"https://ascendex.com/en/feerate/transactionfee-traderate",referral:{url:"https://ascendex.com/en-us/register?inviteCode=EL6BXBQM",discount:.25}},api:{v1:{public:{get:{assets:1,products:1,ticker:1,"barhist/info":1,barhist:1,depth:1,trades:1,"cash/assets":1,"cash/products":1,"margin/assets":1,"margin/products":1,"futures/collateral":1,"futures/contracts":1,"futures/ref-px":1,"futures/market-data":1,"futures/funding-rates":1,"risk-limit-info":1,"exchange-info":1}},private:{get:{info:1,"wallet/transactions":1,"wallet/deposit/address":1,"data/balance/snapshot":1,"data/balance/history":1},accountCategory:{get:{balance:1,"order/open":1,"order/status":1,"order/hist/current":1,risk:1},post:{order:1,"order/batch":1},delete:{order:1,"order/all":1,"order/batch":1}},accountGroup:{get:{"cash/balance":1,"margin/balance":1,"margin/risk":1,"futures/collateral-balance":1,"futures/position":1,"futures/risk":1,"futures/funding-payments":1,"order/hist":1,"spot/fee":1},post:{transfer:1,"futures/transfer/deposit":1,"futures/transfer/withdraw":1}}}},v2:{public:{get:{assets:1,"futures/contract":1,"futures/collateral":1,"futures/pricing-data":1,"futures/ticker":1}},private:{get:{"account/info":1},accountGroup:{get:{"order/hist":1,"futures/position":1,"futures/free-margin":1,"futures/order/hist/current":1,"futures/order/open":1,"futures/order/status":1},post:{"futures/isolated-position-margin":1,"futures/margin-type":1,"futures/leverage":1,"futures/transfer/deposit":1,"futures/transfer/withdraw":1,"futures/order":1,"futures/order/batch":1,"futures/order/open":1,"subuser/subuser-transfer":1,"subuser/subuser-transfer-hist":1},delete:{"futures/order":1,"futures/order/batch":1,"futures/order/all":1}}}}},fees:{trading:{feeSide:"get",tierBased:!0,percentage:!0,taker:this.parseNumber("0.002"),maker:this.parseNumber("0.002")}},precisionMode:u,options:{"account-category":"cash","account-group":void 0,fetchClosedOrders:{method:"v1PrivateAccountGroupGetOrderHist"},defaultType:"spot",accountsByType:{spot:"cash",swap:"futures",future:"futures",margin:"margin"},transfer:{fillResponseFromRequest:!0}},exceptions:{exact:{1900:l,2100:a,5002:d,6001:d,6010:o,60060:h,600503:h,100001:l,100002:l,100003:l,100004:l,100005:l,100006:l,100007:l,100008:d,100009:a,100010:l,100011:l,100012:l,100013:l,100101:n,150001:l,200001:a,200002:n,200003:n,200004:n,200005:n,200006:n,200007:n,200008:n,200009:n,200010:a,200011:n,200012:n,200013:n,200014:c,200015:c,300001:h,300002:h,300003:h,300004:h,300005:h,300006:h,300007:h,300008:h,300009:h,300011:o,300012:d,300013:h,300014:h,300020:h,300021:h,300031:h,310001:o,310002:h,310003:h,310004:d,310005:h,510001:n,900001:n},broad:{}},commonCurrencies:{BOND:"BONDED",BTCBEAR:"BEAR",BTCBULL:"BULL",BYN:"BeyondFi",PLN:"Pollen"}})}getAccount(e={}){const t=this.safeValue(e,"account",this.options.account).toLowerCase();return this.capitalize(t)}async fetchCurrencies(e={}){const t=await this.v1PublicGetAssets(e),i=await this.v1PublicGetMarginAssets(e),s=await this.v1PublicGetCashAssets(e),r=this.safeValue(t,"data",[]),a=this.safeValue(i,"data",[]),n=this.safeValue(s,"data",[]),o=this.indexBy(r,"assetCode"),h=this.indexBy(a,"assetCode"),d=this.indexBy(n,"assetCode"),c=this.deepExtend(o,h,d),l=Object.keys(c),u={};for(let e=0;e<l.length;e++){const t=l[e],i=c[t],s=this.safeCurrencyCode(t),r=this.safeString2(i,"precisionScale","nativeScale"),a=this.parseNumber(this.parsePrecision(r)),n=this.safeNumber2(i,"withdrawFee","withdrawalFee"),o="Normal"===this.safeString2(i,"status","statusCode"),h="borrowAssetCode"in i;u[s]={id:t,code:s,info:i,type:void 0,margin:h,name:this.safeString(i,"assetName"),active:o,deposit:void 0,withdraw:void 0,fee:n,precision:a,limits:{amount:{min:a,max:void 0},withdraw:{min:this.safeNumber(i,"minWithdrawalAmt"),max:void 0}}}}return u}async fetchMarkets(e={}){const t=await this.v1PublicGetProducts(e),i=await this.v1PublicGetCashProducts(e),s=await this.v2PublicGetFuturesContract(e),r=this.safeValue(t,"data",[]),a=this.indexBy(r,"symbol"),n=this.safeValue(i,"data",[]),o=this.safeValue(s,"data",[]),h=this.arrayConcat(n,o),d=this.indexBy(h,"symbol"),c=this.deepExtend(a,d),l=Object.keys(c),u=[];for(let e=0;e<l.length;e++){const t=l[e],i=c[t],s=this.safeValue(i,"settlementAsset"),r=this.safeCurrencyCode(s),a=this.safeString(i,"status"),n=this.safeString(i,"domain");let o=!1;"Normal"!==a&&"InternalTrading"!==a||"LeveragedETF"===n||(o=!0);const h=void 0===r,d=!h,f=!!d||void 0;let p,m=this.safeNumber(i,"minQty"),g=this.safeNumber(i,"maxQty"),y=this.safeNumber(i,"tickSize");const b=this.safeString2(i,"underlying","symbol").split("/"),v=this.safeString(b,0),w=this.safeString(b,1),S=this.safeCurrencyCode(v),k=this.safeCurrencyCode(w);let T=S+"/"+k;if(d){const e=this.safeValue(i,"lotSizeFilter");m=this.safeNumber(e,"minQty"),g=this.safeNumber(e,"maxQty");const t=this.safeValue(i,"priceFilter");y=this.safeNumber(t,"minPrice"),p=this.safeNumber(t,"maxPrice"),T=S+"/"+k+":"+r}const _=this.safeNumber(i,"commissionReserveRate"),O=this.safeValue(i,"marginTradable",!1);u.push({id:t,symbol:T,base:S,quote:k,settle:r,baseId:v,quoteId:w,settleId:s,type:d?"swap":"spot",spot:h,margin:h?O:void 0,swap:d,future:!1,option:!1,active:o,contract:d,linear:f,inverse:d?!f:void 0,taker:_,maker:_,contractSize:d?this.parseNumber("1"):void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(i,"lotSize"),price:this.safeNumber(i,"tickSize")},limits:{leverage:{min:void 0,max:void 0},amount:{min:m,max:g},price:{min:y,max:p},cost:{min:this.safeNumber(i,"minNotional"),max:this.safeNumber(i,"maxNotional")}},info:i})}return u}async fetchTime(e={}){const t={requestTime:this.milliseconds()},i=await this.v1PublicGetExchangeInfo(this.extend(t,e)),s=this.safeValue(i,"data");return this.safeInteger(s,"requestReceiveAt")}async fetchAccounts(e={}){let t,i=this.safeString(this.options,"account-group");if(void 0===i){t=await this.v1PrivateGetInfo(e);const s=this.safeValue(t,"data",{});i=this.safeString(s,"accountGroup"),this.options["account-group"]=i}return[{id:i,type:void 0,currency:void 0,info:t}]}parseBalance(e){const t=this.milliseconds(),i={info:e,timestamp:t,datetime:this.iso8601(t)},s=this.safeValue(e,"data",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeCurrencyCode(this.safeString(t,"asset")),a=this.account();a.free=this.safeString(t,"availableBalance"),a.total=this.safeString(t,"totalBalance"),i[r]=a}return this.safeBalance(i)}parseMarginBalance(e){const t=this.milliseconds(),i={info:e,timestamp:t,datetime:this.iso8601(t)},s=this.safeValue(e,"data",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeCurrencyCode(this.safeString(t,"asset")),a=this.account();a.free=this.safeString(t,"availableBalance"),a.total=this.safeString(t,"totalBalance");const n=this.safeString(t,"borrowed"),o=this.safeString(t,"interest");a.debt=f.stringAdd(n,o),i[r]=a}return this.safeBalance(i)}parseSwapBalance(e){const t=this.milliseconds(),i={info:e,timestamp:t,datetime:this.iso8601(t)},s=this.safeValue(e,"data",{}),r=this.safeValue(s,"collaterals",[]);for(let e=0;e<r.length;e++){const t=r[e],s=this.safeCurrencyCode(this.safeString(t,"asset")),a=this.account();a.total=this.safeString(t,"balance"),i[s]=a}return this.safeBalance(i)}async fetchBalance(e={}){let t,i;await this.loadMarkets(),await this.loadAccounts(),[i,t]=this.handleMarketTypeAndParams("fetchBalance",void 0,e);i=this.safeValue(e,"margin",!1)?"margin":i,e=this.omit(e,"margin");const s=this.safeValue(this.options,"fetchBalance",{}),r=this.safeValue(this.options,"accountsByType",{}),a=this.safeString(r,i,"cash"),n=this.safeValue(this.accounts,0,{}),o={"account-group":this.safeString(n,"id")},h=this.safeString(s,"method","v1PrivateAccountCategoryGetBalance"),d=this.getSupportedMapping(i,{spot:h,margin:h,swap:"v2PrivateAccountGroupGetFuturesPosition"});"cash"!==a&&"margin"!==a||(o["account-category"]=a);const c=await this[d](this.extend(o,t));return"swap"===i?this.parseSwapBalance(c):"margin"===i?this.parseMarginBalance(c):this.parseBalance(c)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={symbol:this.market(e).id},r=await this.v1PublicGetDepth(this.extend(s,i)),a=this.safeValue(r,"data",{}),n=this.safeValue(a,"data",{}),o=this.safeInteger(n,"ts"),h=this.parseOrderBook(n,e,o);return h.nonce=this.safeInteger(n,"seqnum"),h}parseTicker(e,t){const i=this.safeString(e,"symbol"),s="spot"===this.safeString(e,"type")?"/":void 0,r=this.safeSymbol(i,t,s),a=this.safeString(e,"close"),n=this.safeValue(e,"bid",[]),o=this.safeValue(e,"ask",[]),h=this.safeString(e,"open");return this.safeTicker({symbol:r,timestamp:undefined,datetime:void 0,high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(n,0),bidVolume:this.safeString(n,1),ask:this.safeString(o,0),askVolume:this.safeString(o,1),vwap:void 0,open:h,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"volume"),quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.v1PublicGetTicker(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseTicker(a,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i={};let s,r,a;if(void 0!==e){const t=this.safeValue(e,0);s=this.market(t);const r=this.marketIds(e);i.symbol=r.join(",")}[r,t]=this.handleMarketTypeAndParams("fetchTickers",s,t),a="spot"===r?await this.v1PublicGetTicker(this.extend(i,t)):await this.v2PublicGetFuturesTicker(this.extend(i,t));const n=this.safeValue(a,"data",[]);return Array.isArray(n)?this.parseTickers(n,e):this.parseTickers([n],e)}parseOHLCV(e,t){const i=this.safeValue(e,"data",{});return[this.safeInteger(i,"ts"),this.safeNumber(i,"o"),this.safeNumber(i,"h"),this.safeNumber(i,"l"),this.safeNumber(i,"c"),this.safeNumber(i,"v")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,interval:this.safeString(this.timeframes,t,t)},o=this.parseTimeframe(t),h=this.safeValue(this.options,"fetchOHLCV",{}),d=this.safeInteger(h,"limit",500);void 0!==i?(n.from=i,s=void 0===s?d:Math.min(s,d),n.to=this.sum(i,s*o*1e3,1)):void 0!==s&&(n.n=s);const c=await this.v1PublicGetBarhist(this.extend(n,r)),l=this.safeValue(c,"data",[]);return this.parseOHLCVs(l,a,t,i,s)}parseTrade(e,t){const i=this.safeInteger(e,"ts"),s=this.safeString2(e,"price","p"),r=this.safeString(e,"q"),a=this.safeValue(e,"bm",!1)?"sell":"buy";return t=this.safeMarket(void 0,t),this.safeTrade({info:e,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,id:void 0,order:void 0,type:void 0,takerOrMaker:void 0,side:a,price:s,amount:r,cost:void 0,fee:void 0},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.n=i);const n=await this.v1PublicGetTrades(this.extend(a,s)),o=this.safeValue(n,"data",[]),h=this.safeValue(o,"data",[]);return this.parseTrades(h,r,t,i)}parseOrderStatus(e){return this.safeString({PendingNew:"open",New:"open",PartiallyFilled:"open",Filled:"closed",Canceled:"canceled",Rejected:"rejected"},e,e)}parseOrder(e,t){const i=this.parseOrderStatus(this.safeString(e,"status")),s=this.safeString(e,"symbol"),r=this.safeSymbol(s,t,"/");let a=this.safeInteger2(e,"timestamp","sendingTime");const n=this.safeInteger(e,"lastExecTime");void 0===a&&(a=n);const o=this.safeString(e,"price"),h=this.safeString(e,"orderQty"),d=this.safeString(e,"avgPx"),c=this.safeString2(e,"cumFilledQty","cumQty"),l=this.safeString(e,"orderId");let u=this.safeString(e,"id");void 0!==u&&u.length<1&&(u=void 0);const f=this.safeStringLower(e,"orderType");let p=f;void 0!==f&&("stoplimit"===f&&(p="limit"),"stopmarket"===f&&(p="market"));const m=this.safeStringLower(e,"side"),g=this.safeNumber(e,"cumFee");let y;if(void 0!==g){const t=this.safeString(e,"feeAsset");y={cost:g,currency:this.safeCurrencyCode(t)}}const b=this.safeNumber(e,"stopPrice");let v;const w=this.safeString(e,"execInst");let S;return"reduceOnly"===w&&(v=!0),"Post"===w&&(S=!0),this.safeOrder({info:e,id:l,clientOrderId:u,timestamp:a,datetime:this.iso8601(a),lastTradeTimestamp:n,symbol:r,type:p,timeInForce:void 0,postOnly:S,reduceOnly:v,side:m,price:o,stopPrice:b,triggerPrice:b,amount:h,cost:void 0,average:d,filled:c,remaining:void 0,status:i,fee:y,trades:void 0},t)}async fetchTradingFees(e={}){await this.loadMarkets(),await this.loadAccounts();const t=this.safeValue(this.accounts,0,{}),i={"account-group":this.safeString(t,"id")},s=await this.v1PrivateAccountGroupGetSpotFee(this.extend(i,e)),r=this.safeValue(s,"data",{}),a=this.safeValue(r,"fees",[]),n={};for(let e=0;e<a.length;e++){const t=a[e],i=this.safeString(t,"symbol"),s=this.safeSymbol(i,void 0,"/"),r=this.safeValue(t,"fee",{});n[s]={info:t,symbol:s,maker:this.safeNumber(r,"maker"),taker:this.safeNumber(r,"taker")}}return n}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets(),await this.loadAccounts();const n=this.market(e);let o;[o,a]=this.handleMarketTypeAndParams("createOrder",n,a);const d=this.safeValue(this.options,"createOrder",{}),c=this.safeValue(this.options,"accountsByType",{}),l=this.safeString(c,o,"cash"),u=this.safeValue(this.accounts,0,{}),f=this.safeValue(u,"id"),p=this.safeString2(a,"clientOrderId","id"),m={"account-group":f,"account-category":l,symbol:n.id,time:this.milliseconds(),orderQty:this.amountToPrecision(e,s),orderType:t,side:i},g="market"===t||"stop_market"===t,y="limit"===t||"stop_limit"===t,b=this.safeString(a,"timeInForce"),v=this.isPostOnly(g,!1,a),w=this.safeValue(a,"reduceOnly",!1),S=this.safeValue2(a,"triggerPrice","stopPrice");if(a=this.omit(a,["timeInForce","postOnly","reduceOnly","stopPrice","triggerPrice"]),w){if("swap"!==o)throw new h(this.id+" createOrder() does not support reduceOnly for "+o+" orders, reduceOnly orders are supported for perpetuals only");m.execInst="ReduceOnly"}y&&(m.orderPrice=this.priceToPrecision(e,r)),"IOC"===b&&(m.timeInForce="IOC"),"FOK"===b&&(m.timeInForce="FOK"),v&&(m.postOnly=!0),void 0!==S&&(m.stopPrice=this.priceToPrecision(e,S),y?m.orderType="stop_limit":g&&(m.orderType="stop_market")),void 0!==p&&(m.id=p);const k=this.safeString(d,"method","v1PrivateAccountCategoryPostOrder"),T=this.getSupportedMapping(o,{spot:k,margin:k,swap:"v2PrivateAccountGroupPostFuturesOrder"});"v1PrivateAccountCategoryPostOrder"===T?void 0!==l&&(m.category=l):m["account-category"]=l;const _=await this[T](this.extend(m,a)),O=this.safeValue(_,"data",{}),M=this.safeValue2(O,"order","info",{});return this.parseOrder(M,n)}async fetchOrder(e,t,i={}){let s;await this.loadMarkets(),await this.loadAccounts(),void 0!==t&&(s=this.market(t));const[r,a]=this.handleMarketTypeAndParams("fetchOrder",s,i),n=this.safeValue(this.options,"fetchOrder",{}),o=this.safeValue(this.options,"accountsByType",{}),h=this.safeString(o,r,"cash"),d=this.safeValue(this.accounts,0,{}),c={"account-group":this.safeValue(d,"id"),"account-category":h,orderId:e},l=this.safeString(n,"method","v1PrivateAccountCategoryGetOrderStatus"),u=this.getSupportedMapping(r,{spot:l,margin:l,swap:"v2PrivateAccountGroupGetFuturesOrderStatus"});"v1PrivateAccountCategoryGetOrderStatus"===u?void 0!==h&&(c.category=h):c["account-category"]=h;const f=await this[u](this.extend(c,a)),p=this.safeValue(f,"data",{});return this.parseOrder(p,s)}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets(),await this.loadAccounts(),void 0!==e&&(r=this.market(e),e=r.symbol);const a=this.safeValue(this.accounts,0,{}),n=this.safeValue(a,"id"),[o,h]=this.handleMarketTypeAndParams("fetchOpenOrders",r,s),d=this.safeValue(this.options,"accountsByType",{}),c=this.safeString(d,o,"cash"),l={"account-group":n,"account-category":c},u=this.safeValue(this.options,"fetchOpenOrders",{}),f=this.safeString(u,"method","v1PrivateAccountCategoryGetOrderOpen"),p=this.getSupportedMapping(o,{spot:f,margin:f,swap:"v2PrivateAccountGroupGetFuturesOrderOpen"});"v1PrivateAccountCategoryGetOrderOpen"===p?void 0!==c&&(l.category=c):l["account-category"]=c;const m=await this[p](this.extend(l,h)),g=this.safeValue(m,"data",[]);if("futures"===c)return this.parseOrders(g,r,t,i);const y=[];for(let e=0;e<g.length;e++){const t=this.parseOrder(g[e],r);y.push(t)}return this.filterBySymbolSinceLimit(y,e,t,i)}async fetchClosedOrders(e,t,i,s={}){await this.loadMarkets(),await this.loadAccounts();const r=this.safeValue(this.accounts,0,{}),a={"account-group":this.safeValue(r,"id")};let n;void 0!==e&&(n=this.market(e),a.symbol=n.id);const[o,h]=this.handleMarketTypeAndParams("fetchClosedOrders",n,s),d=this.safeValue(this.options,"fetchClosedOrders",{}),c=this.safeString(d,"method","v1PrivateAccountGroupGetOrderHist"),l=this.getSupportedMapping(o,{spot:c,margin:c,swap:"v2PrivateAccountGroupGetFuturesOrderHistCurrent"}),u=this.safeValue(this.options,"accountsByType",{}),f=this.safeString(u,o,"cash");"v1PrivateAccountGroupGetOrderHist"===l?void 0!==f&&(a.category=f):a["account-category"]=f,void 0!==t&&(a.startTime=t),void 0!==i&&(a.pageSize=i);const p=await this[l](this.extend(a,h));let m=this.safeValue(p,"data");return Array.isArray(m)||(m=this.safeValue(m,"data",[])),this.parseOrders(m,n,t,i)}async cancelOrder(e,t,i={}){if(void 0===t)throw new r(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets(),await this.loadAccounts();const s=this.market(t),[a,n]=this.handleMarketTypeAndParams("cancelOrder",s,i),o=this.safeValue(this.options,"cancelOrder",{}),h=this.safeValue(this.options,"accountsByType",{}),d=this.safeString(h,a,"cash"),c=this.safeValue(this.accounts,0,{}),l={"account-group":this.safeValue(c,"id"),"account-category":d,symbol:s.id,time:this.milliseconds(),id:"foobar"},u=this.safeString(o,"method","v1PrivateAccountCategoryDeleteOrder"),f=this.getSupportedMapping(a,{spot:u,margin:u,swap:"v2PrivateAccountGroupDeleteFuturesOrder"});"v1PrivateAccountCategoryDeleteOrder"===f?void 0!==d&&(l.category=d):l["account-category"]=d;const p=this.safeString2(i,"clientOrderId","id");void 0===p?l.orderId=e:(l.id=p,i=this.omit(i,["clientOrderId","id"]));const m=await this[f](this.extend(l,n)),g=this.safeValue(m,"data",{}),y=this.safeValue2(g,"order","info",{});return this.parseOrder(y,s)}async cancelAllOrders(e,t={}){let i;await this.loadMarkets(),await this.loadAccounts(),void 0!==e&&(i=this.market(e));const[s,r]=this.handleMarketTypeAndParams("cancelAllOrders",i,t),a=this.safeValue(this.options,"cancelAllOrders",{}),n=this.safeValue(this.options,"accountsByType",{}),o=this.safeString(n,s,"cash"),h=this.safeValue(this.accounts,0,{}),d={"account-group":this.safeValue(h,"id"),"account-category":o,time:this.milliseconds()};void 0!==e&&(d.symbol=i.id);const c=this.safeString(a,"method","v1PrivateAccountCategoryDeleteOrderAll"),l=this.getSupportedMapping(s,{spot:c,margin:c,swap:"v2PrivateAccountGroupDeleteFuturesOrderAll"});"v1PrivateAccountCategoryDeleteOrderAll"===l?void 0!==o&&(d.category=o):d["account-category"]=o;return await this[l](this.extend(d,r))}parseDepositAddress(e,t){const i=this.safeString(e,"address"),s=this.safeString(e,"tagId"),r=this.safeString(e,s);this.checkAddress(i);const a=void 0===t?void 0:t.code,n=this.safeString(e,"chainName");return{currency:a,address:i,tag:r,network:this.safeNetwork(n),info:e}}safeNetwork(e){return this.safeString({TRC20:"TRC20",ERC20:"ERC20",GO20:"GO20",BEP2:"BEP2","BEP20 (BSC)":"BEP20",Bitcoin:"BTC","Bitcoin ABC":"BCH",Litecoin:"LTC","Matic Network":"MATIC",Solana:"SOL",xDai:"STAKE",Akash:"AKT"},e,e)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s=this.safeString(t,"chainName");t=this.omit(t,"chainName");const a={asset:i.id},n=await this.v1PrivateGetWalletDepositAddress(this.extend(a,t)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"address",[]);let d;if(h.length>1){const e=this.indexBy(h,"chainName");if(void 0===s){const t=Object.keys(e).join(", ");throw new r(this.id+" fetchDepositAddress() returned more than one address, a chainName parameter is required, one of "+t)}d=this.safeValue(e,s,{})}else d=this.safeValue(h,0,{});const c=this.parseDepositAddress(d,i);return this.extend(c,{info:n})}async fetchDeposits(e,t,i,s={}){return await this.fetchTransactions(e,t,i,this.extend({txType:"deposit"},s))}async fetchWithdrawals(e,t,i,s={}){return await this.fetchTransactions(e,t,i,this.extend({txType:"withdrawal"},s))}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.asset=a.id),void 0!==t&&(r.startTs=t),void 0!==i&&(r.pageSize=i);const n=await this.v1PrivateGetWalletTransactions(this.extend(r,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"data",[]);return this.parseTransactions(h,a,t,i)}parseTransactionStatus(e){return this.safeString({reviewing:"pending",pending:"pending",confirmed:"ok",rejected:"rejected"},e,e)}parseTransaction(e,t){const i=this.safeValue(e,"destAddress",{}),s=this.safeString(i,"address"),r=this.safeString(i,"destTag"),a=this.safeInteger(e,"time"),n=this.safeString(e,"asset"),o=this.safeCurrencyCode(n,t);return{info:e,id:this.safeString(e,"requestId"),txid:this.safeString(e,"networkTransactionId"),type:this.safeString(e,"transactionType"),currency:o,network:void 0,amount:this.safeNumber(e,"amount"),status:this.parseTransactionStatus(this.safeString(e,"status")),timestamp:a,datetime:this.iso8601(a),address:s,addressFrom:void 0,addressTo:s,tag:r,tagFrom:void 0,tagTo:r,updated:void 0,comment:void 0,fee:{currency:o,cost:this.safeNumber(e,"commission"),rate:void 0}}}async fetchPositions(e,t={}){await this.loadMarkets(),await this.loadAccounts();const i=this.safeValue(this.accounts,0,{}),s={"account-group":this.safeString(i,"id")},r=await this.v2PrivateAccountGroupGetFuturesPosition(this.extend(s,t)),a=this.safeValue(r,"data",{}),n=this.safeValue(a,"contracts",[]),o=[];for(let e=0;e<n.length;e++)o.push(this.parsePosition(n[e]));return e=this.marketSymbols(e),this.filterByArray(o,"symbol",e,!1)}parsePosition(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t);let s=this.safeNumber(e,"buyOpenOrderNotional");0===s&&(s=this.safeNumber(e,"sellOpenOrderNotional"));const r=this.safeString(e,"marginType");let a;return"isolated"===r&&(a=this.safeNumber(e,"isolatedMargin")),{info:e,id:void 0,symbol:t.symbol,notional:s,marginMode:r,liquidationPrice:void 0,entryPrice:this.safeNumber(e,"avgOpenPrice"),unrealizedPnl:this.safeNumber(e,"unrealizedPnl"),percentage:void 0,contracts:this.safeNumber(e,"position"),contractSize:this.safeNumber(t,"contractSize"),markPrice:this.safeNumber(e,"markPrice"),side:this.safeStringLower(e,"side"),hedged:void 0,timestamp:void 0,datetime:void 0,maintenanceMargin:void 0,maintenanceMarginPercentage:void 0,collateral:a,initialMargin:void 0,initialMarginPercentage:void 0,leverage:this.safeInteger(e,"leverage"),marginRatio:void 0}}parseFundingRate(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t),r=this.safeInteger(e,"time"),a=this.safeNumber(e,"fundingRate"),n=this.safeInteger(e,"nextFundingTime");return{info:e,symbol:s,markPrice:this.safeNumber(e,"markPrice"),indexPrice:this.safeNumber(e,"indexPrice"),interestRate:this.parseNumber("0"),estimatedSettlePrice:void 0,timestamp:r,datetime:this.iso8601(r),previousFundingRate:void 0,nextFundingRate:void 0,previousFundingTimestamp:void 0,nextFundingTimestamp:void 0,previousFundingDatetime:void 0,nextFundingDatetime:void 0,fundingRate:a,fundingTimestamp:n,fundingDatetime:this.iso8601(n)}}async fetchFundingRates(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.v2PublicGetFuturesPricingData(t),s=this.safeValue(i,"data",{}),r=this.safeValue(s,"contracts",[]),a=this.parseFundingRates(r);return this.filterByArray(a,"symbol",e)}async modifyMarginHelper(e,t,i,s={}){await this.loadMarkets(),await this.loadAccounts();const r=this.market(e),a=this.safeValue(this.accounts,0,{}),n=this.safeString(a,"id");t=this.amountToPrecision(e,t);const o={"account-group":n,symbol:r.id,amount:t},h=await this.v2PrivateAccountGroupPostFuturesIsolatedPositionMargin(this.extend(o,s));return"reduce"===i&&(t=f.stringAbs(t)),this.extend(this.parseMarginModification(h,r),{amount:this.parseNumber(t),type:i})}parseMarginModification(e,t){const i="0"===this.safeString(e,"code")?"ok":"failed";return{info:e,type:void 0,amount:void 0,code:t.quote,symbol:t.symbol,status:i}}async reduceMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,"reduce",i)}async addMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,"add",i)}async setLeverage(e,t,i={}){if(void 0===t)throw new r(this.id+" setLeverage() requires a symbol argument");if(e<1||e>100)throw new l(this.id+" leverage should be between 1 and 100");await this.loadMarkets(),await this.loadAccounts();const s=this.market(t);if("future"!==s.type)throw new d(this.id+" setLeverage() supports futures contracts only");const a=this.safeValue(this.accounts,0,{}),n={"account-group":this.safeString(a,"id"),symbol:s.id,leverage:e};return await this.v2PrivateAccountGroupPostFuturesLeverage(this.extend(n,i))}async setMarginMode(e,t,i={}){if("cross"===(e=e.toLowerCase())&&(e="crossed"),"isolated"!==e&&"crossed"!==e)throw new l(this.id+" setMarginMode() marginMode argument should be isolated or cross");await this.loadMarkets(),await this.loadAccounts();const s=this.market(t),r=this.safeValue(this.accounts,0,{}),a={"account-group":this.safeString(r,"id"),symbol:s.id,marginMode:e};if("future"!==s.type)throw new d(this.id+" setMarginMode() supports futures contracts only");return await this.v2PrivateAccountGroupPostFuturesMarginType(this.extend(a,i))}async fetchLeverageTiers(e,t={}){await this.loadMarkets();const i=await this.v2PublicGetFuturesContract(t),s=this.safeValue(i,"data");return e=this.marketSymbols(e),this.parseLeverageTiers(s,e,"symbol")}parseMarketLeverageTiers(e,t){const i=this.safeValue(e,"marginRequirements",[]),s=this.safeString(e,"symbol");t=this.safeMarket(s,t);const r=[];for(let e=0;e<i.length;e++){const s=i[e],a=this.safeString(s,"initialMarginRate");r.push({tier:this.sum(e,1),currency:t.quote,minNotional:this.safeNumber(s,"positionNotionalLowerBound"),maxNotional:this.safeNumber(s,"positionNotionalUpperBound"),maintenanceMarginRate:this.safeNumber(s,"maintenanceMarginRate"),maxLeverage:this.parseNumber(f.stringDiv("1",a)),info:s})}return r}async transfer(e,t,i,s,r={}){await this.loadMarkets(),await this.loadAccounts();const a=this.safeValue(this.accounts,0,{}),o=this.safeString(a,"id"),h=this.currency(e);t=this.currencyToPrecision(e,t);const d=this.safeValue(this.options,"accountsByType",{}),c=this.safeString(d,i,i),l=this.safeString(d,s,s);if("cash"!==c&&"cash"!==l)throw new n(this.id+" transfer() only supports direct balance transfer between spot and future, spot and margin");const u={"account-group":o,amount:t,asset:h.id,fromAccount:c,toAccount:l},f=await this.v1PrivateAccountGroupPostTransfer(this.extend(u,r)),p=this.safeValue(this.options,"transfer",{}),m=this.safeValue(p,"fillResponseFromRequest",!0),g=this.parseTransfer(f,h);return m&&(g.fromAccount=i,g.toAccount=s,g.amount=t,g.currency=e),g}parseTransfer(e,t){const i=this.safeInteger(e,"code"),s=this.safeCurrencyCode(void 0,t),r=this.milliseconds();return{info:e,id:void 0,timestamp:r,datetime:this.iso8601(r),currency:s,amount:void 0,fromAccount:void 0,toAccount:void 0,status:this.parseTransferStatus(i)}}parseTransferStatus(e){return 0===e?"ok":"failed"}sign(e,t="public",i="GET",s={},r,a){const n=t[0],o=t[1],h=this.safeString(t,2);let d="";const c="accountCategory"===h;(c||"accountGroup"===h)&&(d+=this.implodeParams("/{account-group}",s),s=this.omit(s,"account-group"));let l=this.implodeParams(e,s);if(d+="/api/pro/","v2"===n?l=n+"/"+l:d+=n+"/",c&&(d+=this.implodeParams("{account-category}/",s)),s=this.omit(s,"account-category"),d+=l,("v1"===n&&"cash/balance"===l||"margin/balance"===l)&&(l="balance"),"v1"===n&&"spot/fee"===l&&(l="fee"),l.indexOf("subuser")>=0){const e=l.split("/");l=e[2]}if(s=this.omit(s,this.extractParams(e)),"public"===o)Object.keys(s).length&&(d+="?"+this.urlencode(s));else{this.checkRequiredCredentials();const e=this.milliseconds().toString(),t=e+"+"+l,n=this.hmac(this.encode(t),this.encode(this.secret),"sha256","base64");r={"x-auth-key":this.apiKey,"x-auth-timestamp":e,"x-auth-signature":n},"GET"===i?Object.keys(s).length&&(d+="?"+this.urlencode(s)):(r["Content-Type"]="application/json",a=this.json(s))}return d=this.urls.api.rest+d,{url:d,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,o,h,d){if(void 0===o)return;const c=this.safeString(o,"code"),l=this.safeString(o,"message");if(void 0!==c&&"0"!==c||void 0!==l){const e=this.id+" "+a;throw this.throwExactlyMatchedException(this.exceptions.exact,c,e),this.throwExactlyMatchedException(this.exceptions.exact,l,e),this.throwBroadlyMatchedException(this.exceptions.broad,l,e),new n(e)}}}},48819:function(e,t,i){"use strict";const s=i(85806),{isNode:r,clone:a,unCamelCase:n,throttle:o,timeout:h,TimedOut:d,defaultFetch:c}=s,{ExchangeError:l,BadSymbol:u,NullResponse:f,InvalidAddress:p,InvalidOrder:m,NotSupported:g,AuthenticationError:y,DDoSProtection:b,RequestTimeout:v,ExchangeNotAvailable:w,RateLimitExceeded:S,ArgumentsRequired:k}=i(73449),{TRUNCATE:T,ROUND:_,DECIMAL_PLACES:O,NO_PADDING:M,TICK_SIZE:I}=s.precisionConstants,x=(i(35060),i(6832));e.exports=class e{describe(){return{id:void 0,name:void 0,countries:void 0,enableRateLimit:!0,rateLimit:2e3,certified:!1,pro:!1,alias:!1,has:{publicAPI:!0,privateAPI:!0,CORS:void 0,spot:void 0,margin:void 0,swap:void 0,future:void 0,option:void 0,addMargin:void 0,cancelAllOrders:void 0,cancelOrder:!0,cancelOrders:void 0,createDepositAddress:void 0,createLimitOrder:!0,createMarketOrder:!0,createOrder:!0,createPostOnlyOrder:void 0,createReduceOnlyOrder:void 0,createStopOrder:void 0,createStopLimitOrder:void 0,createStopMarketOrder:void 0,editOrder:"emulated",fetchAccounts:void 0,fetchBalance:!0,fetchBidsAsks:void 0,fetchBorrowInterest:void 0,fetchBorrowRate:void 0,fetchBorrowRateHistory:void 0,fetchBorrowRatesPerSymbol:void 0,fetchBorrowRates:void 0,fetchCanceledOrders:void 0,fetchClosedOrder:void 0,fetchClosedOrders:void 0,fetchCurrencies:"emulated",fetchDeposit:void 0,fetchDepositAddress:void 0,fetchDepositAddresses:void 0,fetchDepositAddressesByNetwork:void 0,fetchDeposits:void 0,fetchTransactionFee:void 0,fetchTransactionFees:void 0,fetchFundingHistory:void 0,fetchFundingRate:void 0,fetchFundingRateHistory:void 0,fetchFundingRates:void 0,fetchIndexOHLCV:void 0,fetchL2OrderBook:!0,fetchLedger:void 0,fetchLedgerEntry:void 0,fetchLeverageTiers:void 0,fetchMarketLeverageTiers:void 0,fetchMarkets:!0,fetchMarkOHLCV:void 0,fetchMyTrades:void 0,fetchOHLCV:"emulated",fetchOpenInterest:void 0,fetchOpenInterestHistory:void 0,fetchOpenOrder:void 0,fetchOpenOrders:void 0,fetchOrder:void 0,fetchOrderBook:!0,fetchOrderBooks:void 0,fetchOrders:void 0,fetchOrderTrades:void 0,fetchPermissions:void 0,fetchPosition:void 0,fetchPositions:void 0,fetchPositionsRisk:void 0,fetchPremiumIndexOHLCV:void 0,fetchStatus:"emulated",fetchTicker:!0,fetchTickers:void 0,fetchTime:void 0,fetchTrades:!0,fetchTradingFee:void 0,fetchTradingFees:void 0,fetchTradingLimits:void 0,fetchTransactions:void 0,fetchTransfers:void 0,fetchWithdrawAddresses:void 0,fetchWithdrawal:void 0,fetchWithdrawals:void 0,reduceMargin:void 0,setLeverage:void 0,setMargin:void 0,setMarginMode:void 0,setPositionMode:void 0,signIn:void 0,transfer:void 0,withdraw:void 0},urls:{logo:void 0,api:void 0,www:void 0,doc:void 0,fees:void 0},api:void 0,requiredCredentials:{apiKey:!0,secret:!0,uid:!1,login:!1,password:!1,twofa:!1,privateKey:!1,walletAddress:!1,token:!1},markets:void 0,currencies:{},timeframes:void 0,fees:{trading:{tierBased:void 0,percentage:void 0,taker:void 0,maker:void 0},funding:{tierBased:void 0,percentage:void 0,withdraw:{},deposit:{}}},status:{status:"ok",updated:void 0,eta:void 0,url:void 0},exceptions:void 0,httpExceptions:{422:l,418:b,429:S,404:w,409:w,410:w,451:w,500:w,501:w,502:w,520:w,521:w,522:w,525:w,526:w,400:w,403:w,405:w,503:w,530:w,408:v,504:v,401:y,407:y,511:y},commonCurrencies:{XBT:"BTC",BCC:"BCH",BCHABC:"BCH",BCHSV:"BSV"},precisionMode:O,paddingMode:M,limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}}}}constructor(e={}){Object.assign(this,s),this.options=this.getDefaultOptions(),this.fetchOptions={},this.userAgents={chrome:"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36",chrome39:"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.71 Safari/537.36",chrome100:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/100.0.4896.75 Safari/537.36"},this.headers={},this.proxy="",this.origin="*",this.minFundingAddressLength=1,this.substituteCommonCurrencyCodes=!0,this.quoteJsonNumbers=!0,this.number=Number,this.handleContentTypeApplicationZip=!1,this.reduceFees=!0,this.fetchImplementation=c,this.validateServerSsl=!0,this.validateClientSsl=!1,this.timeout=1e4,this.verbose=!1,this.debug=!1,this.userAgent=void 0,this.twofa=void 0,this.apiKey=void 0,this.secret=void 0,this.uid=void 0,this.login=void 0,this.password=void 0,this.privateKey=void 0,this.walletAddress=void 0,this.token=void 0,this.balance={},this.orderbooks={},this.tickers={},this.orders=void 0,this.trades={},this.transactions={},this.ohlcvs={},this.myTrades=void 0,this.positions={},this.requiresWeb3=!1,this.requiresEddsa=!1,this.precision={},this.lastRestRequestTimestamp=0,this.enableLastJsonResponse=!0,this.enableLastHttpResponse=!0,this.enableLastResponseHeaders=!0,this.last_http_response=void 0,this.last_json_response=void 0,this.last_response_headers=void 0;const t=(e=this)=>{if(null!==e){const i=Object.getOwnPropertyNames(e);for(let e=0;e<i.length;e++){const t=i[e];this[n(t)]=this[t]}t(Object.getPrototypeOf(e))}};t();const i=Object.entries(this.describe()).concat(Object.entries(e));for(let e=0;e<i.length;e++){const[t,s]=i[e];s&&Object.getPrototypeOf(s)===Object.prototype?this[t]=this.deepExtend(this[t],s):this[t]=s}const a={keepAlive:!0};this.validateServerSsl||(a.rejectUnauthorized=!1),!this.httpAgent&&c.http&&r&&(this.httpAgent=new c.http.Agent(a)),!this.httpsAgent&&c.https&&r&&(this.httpsAgent=new c.https.Agent(a));const o=Object.keys(this.has);for(let e=0;e<o.length;e++){const t=o[e];this["has"+this.capitalize(t)]=!!this.has[t]}this.api&&this.defineRestApi(this.api,"request"),this.initRestRateLimiter(),this.markets&&this.setMarkets(this.markets)}encodeURIComponent(...e){return encodeURIComponent(...e)}checkRequiredVersion(t,i=!0){let s=!0;const[r,a,n]=t.split("."),[o,h,d]=e.ccxtVersion.split("."),c=parseInt(r),l=parseInt(a),u=parseInt(n),f=parseInt(o),p=parseInt(h),m=parseInt(d);if(c>f&&(s=!1),c===f&&(l>p||l===p&&u>m)&&(s=!1),!s){if(i)throw new g("Your current version of CCXT is "+e.ccxtVersion+", a newer version "+t+" is required, please, upgrade your version of CCXT");return i}return s}checkAddress(e){if(void 0===e)throw new p(this.id+" address is undefined");if(1===this.unique(e).length||e.length<this.minFundingAddressLength||e.includes(" "))throw new p(this.id+" address is invalid or has less than "+this.minFundingAddressLength.toString()+' characters: "'+this.json(e)+'"');return e}initRestRateLimiter(){if(void 0===this.rateLimit)throw new Error(this.id+".rateLimit property is not configured");this.tokenBucket=this.extend({delay:.001,capacity:1,cost:1,maxCapacity:1e3,refillRate:this.rateLimit>0?1/this.rateLimit:Number.MAX_VALUE},this.tokenBucket),this.throttle=o(this.tokenBucket),this.executeRestRequest=(e,t="GET",i,s)=>{const a=this.fetchImplementation,n={method:t,headers:i,body:s,timeout:this.timeout};this.agent?n.agent=this.agent:this.httpAgent&&0===e.indexOf("http://")?n.agent=this.httpAgent:this.httpsAgent&&0===e.indexOf("https://")&&(n.agent=this.httpsAgent);const o=a(e,this.extend(n,this.fetchOptions)).catch((i=>{if(r)throw new w([this.id,t,e,i.type,i.message].join(" "));throw i})).then((r=>this.handleRestResponse(r,e,t,i,s)));return h(this.timeout,o).catch((i=>{if(i instanceof d)throw new v(this.id+" "+t+" "+e+" request timed out ("+this.timeout+" ms)");throw i}))}}setSandboxMode(e){if(e){if(!("test"in this.urls))throw new g(this.id+" does not have a sandbox URL");"string"==typeof this.urls.api?(this.urls.apiBackup=this.urls.api,this.urls.api=this.urls.test):(this.urls.apiBackup=a(this.urls.api),this.urls.api=a(this.urls.test))}else"apiBackup"in this.urls&&("string"==typeof this.urls.api?this.urls.api=this.urls.apiBackup:this.urls.api=a(this.urls.apiBackup))}defineRestApiEndpoint(e,t,i,s,r,a,n={}){const o=r.split(/[^a-zA-Z0-9]/),h=o.map(this.capitalize).join(""),d=o.map((e=>e.trim().toLowerCase())).filter((e=>e.length>0)).join("_"),c=[a[0]].concat(a.slice(1).map(this.capitalize)).join(""),l=[a[0]].concat(a.slice(1).map((e=>e.trim())).filter((e=>e.length>0))).join("_"),u=c+s+this.capitalize(h),f=l+"_"+i+"_"+d,p=a.length>1?a:a[0],m=async(i={},s={})=>this[e](r,p,t,i,void 0,void 0,n,s);this[u]=m,this[f]=m}defineRestApi(e,t,i=[]){const s=Object.keys(e);for(let r=0;r<s.length;r++){const a=s[r],n=e[a],o=a.toUpperCase(),h=a.toLowerCase(),d=this.capitalize(h);if(Array.isArray(n))for(let e=0;e<n.length;e++){const s=n[e].trim();this.defineRestApiEndpoint(t,o,h,d,s,i)}else if(a.match(/^(?:get|post|put|delete|head|patch)$/i)){const e=Object.keys(n);for(let s=0;s<e.length;s++){const r=e[s],a=r.trim(),c=n[r];if("object"==typeof c)this.defineRestApiEndpoint(t,o,h,d,a,i,c);else{if("number"!=typeof c)throw new g(this.id+" defineRestApi() API format is not supported, API leafs must strings, objects or numbers");this.defineRestApiEndpoint(t,o,h,d,a,i,{cost:c})}}}else this.defineRestApi(n,t,i.concat([a]))}}log(...e){console.log(...e)}fetch(e,t="GET",i,s){return r&&this.userAgent&&("string"==typeof this.userAgent?i=this.extend({"User-Agent":this.userAgent},i):"object"==typeof this.userAgent&&"User-Agent"in this.userAgent&&(i=this.extend(this.userAgent,i))),"function"==typeof this.proxy?(e=this.proxy(e),r&&(i=this.extend({Origin:this.origin},i))):"string"==typeof this.proxy&&(this.proxy.length&&r&&(i=this.extend({Origin:this.origin},i)),e=this.proxy+e),i=this.extend(this.headers,i),i=this.setHeaders(i),this.verbose&&this.log("fetch Request:\n",this.id,t,e,"\nRequestHeaders:\n",i,"\nRequestBody:\n",s,"\n"),this.executeRestRequest(e,t,i,s)}parseJson(e){try{if(this.isJsonEncodedObject(e))return JSON.parse(this.onJsonResponse(e))}catch(e){return}}getResponseHeaders(e){const t={};return e.headers.forEach(((e,i)=>{i=i.split("-").map((e=>this.capitalize(e))).join("-"),t[i]=e})),t}handleRestResponse(e,t,i="GET",s,r){const a=this.getResponseHeaders(e);if(this.handleContentTypeApplicationZip&&"application/zip"===a["Content-Type"]){const s=e.buffer();return this.enableLastResponseHeaders&&(this.last_response_headers=a),this.enableLastHttpResponse&&(this.last_http_response=s),this.verbose&&this.log("handleRestResponse:\n",this.id,i,t,e.status,e.statusText,"\nResponseHeaders:\n",a,"ZIP redacted","\n"),s}return e.text().then((n=>{const o=this.onRestResponse(e.status,e.statusText,t,i,a,n,s,r),h=this.parseJson(o);this.enableLastResponseHeaders&&(this.last_response_headers=a),this.enableLastHttpResponse&&(this.last_http_response=n),this.enableLastJsonResponse&&(this.last_json_response=h),this.verbose&&this.log("handleRestResponse:\n",this.id,i,t,e.status,e.statusText,"\nResponseHeaders:\n",a,"\nResponseBody:\n",n,"\n");return this.handleErrors(e.status,e.statusText,t,i,a,n,h,s,r)||this.handleHttpStatusCode(e.status,e.statusText,t,i,n),h||n}))}onRestResponse(e,t,i,s,r,a,n,o){return a.trim()}onJsonResponse(e){return this.quoteJsonNumbers?e.replace(/":([+.0-9eE-]+)([,}])/g,'":"$1"$2'):e}async loadMarketsHelper(e=!1,t={}){if(!e&&this.markets)return this.markets_by_id?this.markets:this.setMarkets(this.markets);let i;!0===this.has.fetchCurrencies&&(i=await this.fetchCurrencies());const s=await this.fetchMarkets(t);return this.setMarkets(s,i)}loadMarkets(e=!1,t={}){return(e&&!this.reloadingMarkets||!this.marketsLoading)&&(this.reloadingMarkets=!0,this.marketsLoading=this.loadMarketsHelper(e,t).then((e=>(this.reloadingMarkets=!1,e)),(e=>{throw this.reloadingMarkets=!1,e}))),this.marketsLoading}fetchCurrencies(e={}){return new Promise(((e,t)=>e(this.currencies)))}fetchMarkets(e={}){return new Promise(((e,t)=>e(Object.values(this.markets))))}filterBySinceLimit(e,t,i,s="timestamp",r=!1){return null!=t&&(e=e.filter((e=>e[s]>=t))),null!=i&&(e=r?e.slice(-i):e.slice(0,i)),e}filterByValueSinceLimit(e,t,i,s,r,a="timestamp",n=!1){const o=null!=i,h=null!=s;return(o||h)&&(e=e.filter((e=>(!o||e[t]===i)&&(!h||e[a]>=s)))),null!=r&&(e=n?e.slice(-r):e.slice(0,r)),e}checkRequiredDependencies(){}remove0xPrefix(e){return"0x"===e.slice(0,2)?e.slice(2):e}hashMessage(e){const t=this.base16ToBinary(this.remove0xPrefix(e)),i=this.stringToBinary("Ethereum Signed Message:\n"+t.sigBytes);return"0x"+this.hash(this.binaryConcat(i,t),"keccak","hex")}signHash(e,t){const i=this.ecdsa(e.slice(-64),t.slice(-64),"secp256k1",void 0);return{r:"0x"+i.r,s:"0x"+i.s,v:27+i.v}}signMessage(e,t){return this.signHash(this.hashMessage(e),t.slice(-64))}signMessageString(e,t){const i=this.signMessage(e,t);return i.r+this.remove0xPrefix(i.s)+this.binaryToBase16(this.numberToBE(i.v))}parseNumber(e,t){if(void 0===e)return t;try{return this.number(e)}catch(e){return t}}checkOrderArguments(e,t,i,s,r,a){if(void 0===r&&"limit"===t)throw new k(this.id+" createOrder() requires a price argument for a limit order");if(s<=0)throw new k(this.id+" createOrder() amount should be above 0")}handleHttpStatusCode(e,t,i,s,r){const a=e.toString();if(a in this.httpExceptions){throw new(0,this.httpExceptions[a])(this.id+" "+s+" "+i+" "+a+" "+t+" "+r)}}getDefaultOptions(){return{defaultNetworkCodeReplacements:{ETH:{ERC20:"ETH"},TRX:{TRC20:"TRX"},CRO:{CRC20:"CRONOS"}}}}safeLedgerEntry(e,t){t=this.safeCurrency(void 0,t);let i=this.safeString(e,"direction"),s=this.safeString(e,"before"),r=this.safeString(e,"after");const a=this.safeString(e,"amount");void 0!==a&&(void 0===s&&void 0!==r?s=x.stringSub(r,a):void 0!==s&&void 0===r&&(r=x.stringAdd(s,a))),void 0!==s&&void 0!==r&&void 0===i&&(x.stringGt(s,r)&&(i="out"),x.stringGt(r,s)&&(i="in"));const n=this.safeValue(e,"fee");void 0!==n&&(n.cost=this.safeNumber(n,"cost"));const o=this.safeInteger(e,"timestamp");return{id:this.safeString(e,"id"),timestamp:o,datetime:this.iso8601(o),direction:i,account:this.safeString(e,"account"),referenceId:this.safeString(e,"referenceId"),referenceAccount:this.safeString(e,"referenceAccount"),type:this.safeString(e,"type"),currency:t.code,amount:this.parseNumber(a),before:this.parseNumber(s),after:this.parseNumber(r),status:this.safeString(e,"status"),fee:n,info:e}}setMarkets(e,t){const i=[];this.markets_by_id={};const s=this.sortBy(this.toArray(e),"spot",!0);for(let e=0;e<s.length;e++){const t=s[e];t.id in this.markets_by_id?this.markets_by_id[t.id].push(t):this.markets_by_id[t.id]=[t];const r=this.deepExtend(this.safeMarket(),{precision:this.precision,limits:this.limits},this.fees.trading,t);i.push(r)}this.markets=this.indexBy(i,"symbol");const r=this.keysort(this.markets),a=this.keysort(this.markets_by_id);if(this.symbols=Object.keys(r),this.ids=Object.keys(a),void 0!==t)this.currencies=this.deepExtend(this.currencies,t);else{let e=[],t=[];for(let s=0;s<i.length;s++){const r=i[s],a=this.precisionMode===O?8:this.parseNumber("1e-8"),n=this.safeValue(r,"precision",{});if("base"in r){const t=this.safeValue2(n,"base","amount",a),i={id:this.safeString2(r,"baseId","base"),numericId:this.safeString(r,"baseNumericId"),code:this.safeString(r,"base"),precision:t};e.push(i)}if("quote"in r){const e=this.safeValue2(n,"quote","price",a),i={id:this.safeString2(r,"quoteId","quote"),numericId:this.safeString(r,"quoteNumericId"),code:this.safeString(r,"quote"),precision:e};t.push(i)}}e=this.sortBy(e,"code"),t=this.sortBy(t,"code"),this.baseCurrencies=this.indexBy(e,"code"),this.quoteCurrencies=this.indexBy(t,"code");const s=this.arrayConcat(e,t),r=this.groupBy(s,"code"),a=Object.keys(r),n=[];for(let e=0;e<a.length;e++){const t=a[e],i=this.safeValue(r,t,[]);let s=this.safeValue(i,0);for(let e=1;e<i.length;e++){const t=i[e];s=this.precisionMode===I?t.precision<s.precision?t:s:t.precision>s.precision?t:s}n.push(s)}const o=this.sortBy(n,"code");this.currencies=this.deepExtend(this.currencies,this.indexBy(o,"code"))}this.currencies_by_id=this.indexBy(this.currencies,"id");const n=this.keysort(this.currencies);return this.codes=Object.keys(n),this.markets}safeBalance(e){const t=this.omit(e,["info","timestamp","datetime","free","used","total"]),i=Object.keys(t);e.free={},e.used={},e.total={};const s={};for(let t=0;t<i.length;t++){const r=i[t];let a=this.safeString(e[r],"total"),n=this.safeString(e[r],"free"),o=this.safeString(e[r],"used");const h=this.safeString(e[r],"debt");void 0===a&&void 0!==n&&void 0!==o&&(a=x.stringAdd(n,o)),void 0===n&&void 0!==a&&void 0!==o&&(n=x.stringSub(a,o)),void 0===o&&void 0!==a&&void 0!==n&&(o=x.stringSub(a,n)),e[r].free=this.parseNumber(n),e[r].used=this.parseNumber(o),e[r].total=this.parseNumber(a),e.free[r]=e[r].free,e.used[r]=e[r].used,e.total[r]=e[r].total,void 0!==h&&(e[r].debt=this.parseNumber(h),s[r]=e[r].debt)}return Object.keys(s).length&&(e.debt=s),e}safeOrder(e,t){let i=this.omitZero(this.safeString(e,"amount")),s=this.safeString(e,"remaining"),r=this.safeString(e,"filled"),a=this.safeString(e,"cost"),n=this.omitZero(this.safeString(e,"average")),o=this.omitZero(this.safeString(e,"price")),h=this.safeInteger(e,"lastTradeTimestamp"),d=this.safeString(e,"symbol"),c=this.safeString(e,"side");const l=void 0===r,u=void 0===a,f=void 0===h,p=this.safeValue(e,"fee"),m=void 0===p,g=void 0===this.safeValue(e,"fees"),y=void 0===d,b=void 0===c,v=m||g,w=this.safeValue(e,"fees",[]);let S=[];if(l||u||v){const i=this.safeValue(e,"trades",S),s=this.number;this.number=String,S=this.parseTrades(i,t),this.number=s;let n=0;const o=Array.isArray(S);if(o&&(n=S.length),o&&n>0){void 0===e.symbol&&(e.symbol=S[0].symbol),void 0===e.side&&(e.side=S[0].side),void 0===e.type&&(e.type=S[0].type),void 0===e.id&&(e.id=S[0].order),l&&(r="0"),u&&(a="0");for(let e=0;e<S.length;e++){const t=S[e],i=this.safeString(t,"amount");l&&void 0!==i&&(r=x.stringAdd(r,i));const s=this.safeString(t,"cost");u&&void 0!==s&&(a=x.stringAdd(a,s)),y&&(d=this.safeString(t,"symbol")),b&&(c=this.safeString(t,"side"));const n=this.safeValue(t,"timestamp");if(f&&void 0!==n&&(h=void 0===h?n:Math.max(h,n)),v){const e=this.safeValue(t,"fees");if(void 0!==e)for(let t=0;t<e.length;t++){const i=e[t];w.push(this.extend({},i))}else{const e=this.safeValue(t,"fee");void 0!==e&&w.push(this.extend({},e))}}}}}if(v){const t=this.reduceFees?this.reduceFeesByCurrency(w):w,i=t.length;for(let e=0;e<i;e++)t[e].cost=this.safeNumber(t[e],"cost"),"rate"in t[e]&&(t[e].rate=this.safeNumber(t[e],"rate"));m||0!==i||(p.cost=this.safeNumber(p,"cost"),"rate"in p&&(p.rate=this.safeNumber(p,"rate")),t.push(p)),e.fees=t,m&&1===i&&(e.fee=t[0])}void 0===i&&(void 0!==r&&void 0!==s?i=x.stringAdd(r,s):"closed"===this.safeString(e,"status")&&(i=r)),void 0===r&&void 0!==i&&void 0!==s&&(r=x.stringSub(i,s)),void 0===s&&void 0!==i&&void 0!==r&&(s=x.stringSub(i,r));const k=this.safeValue(t,"inverse",!1),T=this.numberToString(this.safeValue(t,"contractSize",1));if(void 0===n&&void 0!==r&&void 0!==a&&x.stringGt(r,"0")){const e=x.stringMul(r,T);n=k?x.stringDiv(e,a):x.stringDiv(a,e)}if(u&&void 0!==r&&(void 0!==n||void 0!==o)){let e;e=void 0===n?o:n;const t=x.stringMul(r,T);a=k?x.stringDiv(t,e):x.stringMul(t,e)}const _=this.safeValue(e,"type");(void 0===o||x.stringEquals(o,"0"))&&"market"===_&&(o=n);for(let e=0;e<S.length;e++){const t=S[e];t.amount=this.safeNumber(t,"amount"),t.price=this.safeNumber(t,"price"),t.cost=this.safeNumber(t,"cost");const i=this.safeValue(t,"fee",{});i.cost=this.safeNumber(i,"cost"),"rate"in i&&(i.rate=this.safeNumber(i,"rate")),t.fee=i}let O=this.safeString(e,"timeInForce"),M=this.safeValue(e,"postOnly");void 0===O?("market"===this.safeString(e,"type")&&(O="IOC"),M&&(O="PO")):void 0===M&&(M="PO"===O);let I=this.safeInteger(e,"timestamp"),C=this.safeString(e,"datetime");void 0===I&&(I=this.parse8601(I)),void 0===C&&(C=this.iso8601(I));const P=this.parseNumber(this.safeString2(e,"triggerPrice","stopPrice"));return this.extend(e,{id:this.safeString(e,"id"),clientOrderId:this.safeString(e,"clientOrderId"),timestamp:I,datetime:C,symbol:d,type:this.safeString(e,"type"),side:c,lastTradeTimestamp:h,price:this.parseNumber(o),amount:this.parseNumber(i),cost:this.parseNumber(a),average:this.parseNumber(n),filled:this.parseNumber(r),remaining:this.parseNumber(s),timeInForce:O,postOnly:M,trades:S,reduceOnly:this.safeValue(e,"reduceOnly"),stopPrice:P,triggerPrice:P,status:this.safeString(e,"status"),fee:this.safeValue(e,"fee")})}parseOrders(e,t,i,s,r={}){let a=[];if(Array.isArray(e))for(let i=0;i<e.length;i++){const s=this.extend(this.parseOrder(e[i],t),r);a.push(s)}else{const i=Object.keys(e);for(let s=0;s<i.length;s++){const n=i[s],o=this.extend(this.parseOrder(this.extend({id:n},e[n]),t),r);a.push(o)}}a=this.sortBy(a,"timestamp");const n=void 0!==t?t.symbol:void 0,o=void 0===i;return this.filterBySymbolSinceLimit(a,n,i,s,o)}calculateFee(e,t,i,s,r,a="taker",n={}){if("market"===t&&"maker"===a)throw new k(this.id+' calculateFee() - you have provided incompatible arguments - "market" type order can not be "maker". Change either the "type" or the "takerOrMaker" argument to calculate the fee.');const o=this.markets[e],h=this.safeString(o,"feeSide","quote");let d,c="quote";const l=this.numberToString(s),u=this.numberToString(r);"quote"===h?d=x.stringMul(l,u):"base"===h?d=l:"get"===h?(d=l,"sell"===i?d=x.stringMul(d,u):c="base"):"give"===h&&(d=l,"buy"===i?d=x.stringMul(d,u):c="base"),o.spot||(c="settle"),"market"===t&&(a="taker");const f=this.safeString(o,a);return void 0!==d&&(d=x.stringMul(d,f)),{type:a,currency:o[c],rate:this.parseNumber(f),cost:this.parseNumber(d)}}safeTrade(e,t){const i=this.safeString(e,"amount"),s=this.safeString(e,"price");let r=this.safeString(e,"cost");if(void 0===r){const e=this.safeString(t,"contractSize");let a=s;if(void 0!==e){this.safeValue(t,"inverse",!1)&&(a=x.stringDiv("1",s)),a=x.stringMul(a,e)}r=x.stringMul(a,i)}const a=void 0===this.safeValue(e,"fee"),n=void 0===this.safeValue(e,"fees"),o=a||n,h=[],d=this.safeValue(e,"fee");if(o){const t=this.reduceFees?this.reduceFeesByCurrency(h):h,i=t.length;for(let e=0;e<i;e++)t[e].cost=this.safeNumber(t[e],"cost"),"rate"in t[e]&&(t[e].rate=this.safeNumber(t[e],"rate"));a||0!==i||(d.cost=this.safeNumber(d,"cost"),"rate"in d&&(d.rate=this.safeNumber(d,"rate")),t.push(d)),n&&(e.fees=t),a&&1===i&&(e.fee=t[0]);const s=this.safeValue(e,"fee");void 0!==s&&(s.cost=this.safeNumber(s,"cost"),"rate"in s&&(s.rate=this.safeNumber(s,"rate")),e.fee=s)}return e.amount=this.parseNumber(i),e.price=this.parseNumber(s),e.cost=this.parseNumber(r),e}reduceFeesByCurrency(e){const t={};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currency");if(void 0!==r){const e=this.safeString(s,"rate"),i=this.safeValue(s,"cost");if(x.stringEq(i,"0"))continue;r in t||(t[r]={});const a=void 0===e?"":e;a in t[r]?t[r][a].cost=x.stringAdd(t[r][a].cost,i):(t[r][a]={currency:r,cost:i},void 0!==e&&(t[r][a].rate=e))}}let i=[];const s=Object.values(t);for(let e=0;e<s.length;e++){const t=Object.values(s[e]);i=this.arrayConcat(i,t)}return i}safeTicker(e,t){let i=this.safeValue(e,"open"),s=this.safeValue(e,"close"),r=this.safeValue(e,"last"),a=this.safeValue(e,"change"),n=this.safeValue(e,"percentage"),o=this.safeValue(e,"average"),h=this.safeValue(e,"vwap");const d=this.safeValue(e,"baseVolume"),c=this.safeValue(e,"quoteVolume");return void 0===h&&(h=x.stringDiv(c,d)),void 0!==r&&void 0===s?s=r:void 0===r&&void 0!==s&&(r=s),void 0!==r&&void 0!==i&&(void 0===a&&(a=x.stringSub(r,i)),void 0===o&&(o=x.stringDiv(x.stringAdd(r,i),"2"))),void 0===n&&void 0!==a&&void 0!==i&&x.stringGt(i,"0")&&(n=x.stringMul(x.stringDiv(a,i),"100")),void 0===a&&void 0!==n&&void 0!==i&&(a=x.stringDiv(x.stringMul(n,i),"100")),void 0===i&&void 0!==r&&void 0!==a&&(i=x.stringSub(r,a)),this.extend(e,{bid:this.safeNumber(e,"bid"),bidVolume:this.safeNumber(e,"bidVolume"),ask:this.safeNumber(e,"ask"),askVolume:this.safeNumber(e,"askVolume"),high:this.safeNumber(e,"high"),low:this.safeNumber(e,"low"),open:this.parseNumber(i),close:this.parseNumber(s),last:this.parseNumber(r),change:this.parseNumber(a),percentage:this.parseNumber(n),average:this.parseNumber(o),vwap:this.parseNumber(h),baseVolume:this.parseNumber(d),quoteVolume:this.parseNumber(c),previousClose:this.safeNumber(e,"previousClose")})}async fetchOHLCV(e,t="1m",i,s,r={}){if(!this.has.fetchTrades)throw new g(this.id+" fetchOHLCV() is not supported yet");await this.loadMarkets();const a=await this.fetchTrades(e,i,s,r),n=this.buildOHLCVC(a,t,i,s),o=[];for(let e=0;e<n.length;e++)o.push([this.safeInteger(n[e],0),this.safeNumber(n[e],1),this.safeNumber(n[e],2),this.safeNumber(n[e],3),this.safeNumber(n[e],4),this.safeNumber(n[e],5)]);return o}convertTradingViewToOHLCV(e,t="t",i="o",s="h",r="l",a="c",n="v",o=!1){const h=[],d=this.safeValue(e,t,[]),c=this.safeValue(e,i,[]),l=this.safeValue(e,s,[]),u=this.safeValue(e,r,[]),f=this.safeValue(e,a,[]),p=this.safeValue(e,n,[]);for(let e=0;e<d.length;e++)h.push([o?this.safeInteger(d,e):this.safeTimestamp(d,e),this.safeValue(c,e),this.safeValue(l,e),this.safeValue(u,e),this.safeValue(f,e),this.safeValue(p,e)]);return h}convertOHLCVToTradingView(e,t="t",i="o",s="h",r="l",a="c",n="v",o=!1){const h={};h[t]=[],h[i]=[],h[s]=[],h[r]=[],h[a]=[],h[n]=[];for(let d=0;d<e.length;d++){const c=o?e[d][0]:parseInt(e[d][0]/1e3);h[t].push(c),h[i].push(e[d][1]),h[s].push(e[d][2]),h[r].push(e[d][3]),h[a].push(e[d][4]),h[n].push(e[d][5])}return h}marketIds(e){if(void 0===e)return e;const t=[];for(let i=0;i<e.length;i++)t.push(this.marketId(e[i]));return t}marketSymbols(e){if(void 0===e)return e;const t=[];for(let i=0;i<e.length;i++)t.push(this.symbol(e[i]));return t}marketCodes(e){if(void 0===e)return e;const t=[];for(let i=0;i<e.length;i++)t.push(this.commonCurrencyCode(e[i]));return t}parseBidsAsks(e,t=0,i=1){e=this.toArray(e);const s=[];for(let r=0;r<e.length;r++)s.push(this.parseBidAsk(e[r],t,i));return s}async fetchL2OrderBook(e,t,i={}){const s=await this.fetchOrderBook(e,t,i);return this.extend(s,{asks:this.sortBy(this.aggregate(s.asks),0),bids:this.sortBy(this.aggregate(s.bids),0,!0)})}filterBySymbol(e,t){if(void 0===t)return e;const i=[];for(let s=0;s<e.length;s++){this.safeString(e[s],"symbol")===t&&i.push(e[s])}return i}parseOHLCV(e,t){return Array.isArray(e)?[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]:e}getNetwork(e,t){const i={ETHEREUM:"ETH",ETHER:"ETH",ERC20:"ETH",ETH:"ETH",TRC20:"TRX",TRON:"TRX",TRX:"TRX",BEP20:"BSC",BSC:"BSC",HRC20:"HT",HECO:"HT",SPL:"SOL",SOL:"SOL",TERRA:"LUNA",LUNA:"LUNA",POLYGON:"MATIC",MATIC:"MATIC",EOS:"EOS",WAVES:"WAVES",AVALANCHE:"AVAX",AVAX:"AVAX",QTUM:"QTUM",CHZ:"CHZ",NEO:"NEO",ONT:"ONT",RON:"RON"};if((e=e.toUpperCase())===t)return e;if(e in i)return i[e];throw new g(this.id+" network "+e+" is not yet supported")}networkCodeToId(e,t){const i=this.safeValue(this.options,"networks",{});let s=this.safeString(i,e);if(void 0===s)if(void 0===t)s=e;else{const r=this.safeValue(this.options,"defaultNetworkCodeReplacements",{});if(t in r){const a=r[t],n=Object.keys(a);for(let t=0;t<n.length;t++){const r=n[t];if(a[r]===e){s=this.safeString(i,r);break}}}void 0===s&&(s=e)}return s}networkIdToCode(e,t){const i=this.safeValue(this.options,"networksById",{});let s=this.safeString(i,e,e);if(void 0!==t){const e=this.safeValue(this.options,"defaultNetworkCodeReplacements",{});if(t in e){const i=this.safeValue(e,t,{});s=this.safeString(i,s,s)}}return s}networkCodesToIds(e){if(void 0===e)return;const t=[];for(let i=0;i<e.length;i++){const s=e[i];t.push(this.networkCodeToId(s))}return t}handleNetworkCodeAndParams(e){const t=this.safeString2(e,"networkCode","network");return void 0!==t&&(e=this.omit(e,["networkCode","network"])),[t,e]}defaultNetworkCode(e){let t;const i=this.safeValue(this.options,"defaultNetworks",{});if(e in i)t=i[e];else{const e=this.safeValue(this.options,"defaultNetwork");void 0!==e&&(t=e)}return t}selectNetworkCodeFromUnifiedNetworks(e,t,i){return this.selectNetworkKeyFromNetworks(e,t,i,!0)}selectNetworkIdFromRawNetworks(e,t,i){return this.selectNetworkKeyFromNetworks(e,t,i,!1)}selectNetworkKeyFromNetworks(e,t,i,s=!1){let r;const a=Object.keys(i),n=a.length;if(void 0!==t){if(0===n)throw new g(this.id+" - "+t+" network did not return any result for "+e);{const n=s?t:this.networkCodeToId(t,e);if(!(n in i))throw new g(this.id+" - "+n+" network was not found for "+e+", use one of "+a.join(", "));r=n}}else{if(0===n)throw new g(this.id+" - no networks were returned for "+e);{const t=this.defaultNetworkCode(e),n=s?t:this.networkCodeToId(t,e);r=n in i?n:a[0]}}return r}safeNumber2(e,t,i,s){const r=this.safeString2(e,t,i);return this.parseNumber(r,s)}parseOrderBook(e,t,i,s="bids",r="asks",a=0,n=1){const o=this.parseBidsAsks(this.safeValue(e,s,[]),a,n),h=this.parseBidsAsks(this.safeValue(e,r,[]),a,n);return{symbol:t,bids:this.sortBy(o,0,!0),asks:this.sortBy(h,0),timestamp:i,datetime:this.iso8601(i),nonce:void 0}}parseOHLCVs(e,t,i="1m",s,r){const a=[];for(let i=0;i<e.length;i++)a.push(this.parseOHLCV(e[i],t));const n=this.sortBy(a,0),o=void 0===s;return this.filterBySinceLimit(n,s,r,0,o)}parseLeverageTiers(e,t,i){t=this.marketSymbols(t);const s={};for(let r=0;r<e.length;r++){const a=e[r],n=this.safeString(a,i),o=this.safeMarket(n,void 0,void 0,this.safeString(this.options,"defaultType")),h=o.symbol;this.safeValue(o,"contract",!1)&&(void 0===t||this.inArray(h,t))&&(s[h]=this.parseMarketLeverageTiers(a,o))}return s}async loadTradingLimits(e,t=!1,i={}){if(this.has.fetchTradingLimits&&(t||!("limitsLoaded"in this.options))){const t=await this.fetchTradingLimits(e);for(let i=0;i<e.length;i++){const s=e[i];this.markets[s]=this.deepExtend(this.markets[s],t[s])}this.options.limitsLoaded=this.milliseconds()}return this.markets}parsePositions(e,t,i={}){t=this.marketSymbols(t),e=this.toArray(e);const s=[];for(let t=0;t<e.length;t++){const r=this.extend(this.parsePosition(e[t],void 0),i);s.push(r)}return this.filterByArray(s,"symbol",t,!1)}parseAccounts(e,t={}){e=this.toArray(e);const i=[];for(let s=0;s<e.length;s++){const r=this.extend(this.parseAccount(e[s]),t);i.push(r)}return i}parseTrades(e,t,i,s,r={}){e=this.toArray(e);let a=[];for(let i=0;i<e.length;i++){const s=this.extend(this.parseTrade(e[i],t),r);a.push(s)}a=this.sortBy2(a,"timestamp","id");const n=void 0!==t?t.symbol:void 0,o=void 0===i;return this.filterBySymbolSinceLimit(a,n,i,s,o)}parseTransactions(e,t,i,s,r={}){e=this.toArray(e);let a=[];for(let i=0;i<e.length;i++){const s=this.extend(this.parseTransaction(e[i],t),r);a.push(s)}a=this.sortBy(a,"timestamp");const n=void 0!==t?t.code:void 0,o=void 0===i;return this.filterByCurrencySinceLimit(a,n,i,s,o)}parseTransfers(e,t,i,s,r={}){e=this.toArray(e);let a=[];for(let i=0;i<e.length;i++){const s=this.extend(this.parseTransfer(e[i],t),r);a.push(s)}a=this.sortBy(a,"timestamp");const n=void 0!==t?t.code:void 0,o=void 0===i;return this.filterByCurrencySinceLimit(a,n,i,s,o)}parseLedger(e,t,i,s,r={}){let a=[];const n=this.toArray(e);for(let e=0;e<n.length;e++){const i=this.parseLedgerEntry(n[e],t);if(Array.isArray(i))for(let e=0;e<i.length;e++)a.push(this.extend(i[e],r));else a.push(this.extend(i,r))}a=this.sortBy(a,"timestamp");const o=void 0!==t?t.code:void 0,h=void 0===i;return this.filterByCurrencySinceLimit(a,o,i,s,h)}nonce(){return this.seconds()}setHeaders(e){return e}marketId(e){const t=this.market(e);return void 0!==t?t.id:e}symbol(e){const t=this.market(e);return this.safeString(t,"symbol",e)}resolvePath(e,t){return[this.implodeParams(e,t),this.omit(t,this.extractParams(e))]}filterByArray(e,t,i,s=!0){if(e=this.toArray(e),void 0===i||!i)return s?this.indexBy(e,t):e;const r=[];for(let s=0;s<e.length;s++)this.inArray(e[s][t],i)&&r.push(e[s]);return s?this.indexBy(r,t):r}async fetch2(e,t="public",i="GET",s={},r,a,n={},o={}){if(this.enableRateLimit){const r=this.calculateRateLimiterCost(t,i,e,s,n,o);await this.throttle(r)}this.lastRestRequestTimestamp=this.milliseconds();const h=this.sign(e,t,i,s,r,a);return await this.fetch(h.url,h.method,h.headers,h.body)}async request(e,t="public",i="GET",s={},r,a,n={},o={}){return await this.fetch2(e,t,i,s,r,a,n,o)}async loadAccounts(e=!1,t={}){if(e)this.accounts=await this.fetchAccounts(t);else{if(this.accounts)return this.accounts;this.accounts=await this.fetchAccounts(t)}return this.accountsById=this.indexBy(this.accounts,"id"),this.accounts}async fetchTrades(e,t,i,s={}){throw new g(this.id+" fetchTrades() is not supported yet")}async fetchOHLCVC(e,t="1m",i,s,r={}){if(!this.has.fetchTrades)throw new g(this.id+" fetchOHLCV() is not supported yet");await this.loadMarkets();const a=await this.fetchTrades(e,i,s,r);return this.buildOHLCVC(a,t,i,s)}parseTradingViewOHLCV(e,t,i="1m",s,r){const a=this.convertTradingViewToOHLCV(e);return this.parseOHLCVs(a,t,i,s,r)}async editLimitBuyOrder(e,t,i,s,r={}){return await this.editLimitOrder(e,t,"buy",i,s,r)}async editLimitSellOrder(e,t,i,s,r={}){return await this.editLimitOrder(e,t,"sell",i,s,r)}async editLimitOrder(e,t,i,s,r,a={}){return await this.editOrder(e,t,"limit",i,s,r,a)}async editOrder(e,t,i,s,r,a,n={}){return await this.cancelOrder(e,t),await this.createOrder(t,i,s,r,a,n)}async fetchPermissions(e={}){throw new g(this.id+" fetchPermissions() is not supported yet")}async fetchPosition(e,t={}){throw new g(this.id+" fetchPosition() is not supported yet")}async fetchPositions(e,t={}){throw new g(this.id+" fetchPositions() is not supported yet")}async fetchPositionsRisk(e,t={}){throw new g(this.id+" fetchPositionsRisk() is not supported yet")}async fetchBidsAsks(e,t={}){throw new g(this.id+" fetchBidsAsks() is not supported yet")}parseBidAsk(e,t=0,i=1){return[this.safeNumber(e,t),this.safeNumber(e,i)]}safeCurrency(e,t){if(void 0===e&&void 0!==t)return t;if(void 0!==this.currencies_by_id&&e in this.currencies_by_id&&void 0!==this.currencies_by_id[e])return this.currencies_by_id[e];let i=e;return void 0!==e&&(i=this.commonCurrencyCode(e.toUpperCase())),{id:e,code:i}}safeMarket(e,t,i,s){const r={id:e,symbol:e,base:void 0,quote:void 0,baseId:void 0,quoteId:void 0,active:void 0,type:void 0,linear:void 0,inverse:void 0,spot:!1,swap:!1,future:!1,option:!1,margin:!1,contract:!1,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,optionType:void 0,strike:void 0,settle:void 0,settleId:void 0,precision:{amount:void 0,price:void 0},limits:{amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:void 0};if(void 0!==e)if(void 0!==this.markets_by_id&&e in this.markets_by_id){const t=this.markets_by_id[e];if(1===t.length)return t[0];if(void 0===s)throw new k(this.id+" safeMarket() requires a fourth argument for "+e+" to disambiguate between different markets with the same market id");for(let e=0;e<t.length;e++){const i=t[e];if(i[s])return i}}else if(void 0!==i){const t=e.split(i);return 2===t.length?(r.baseId=this.safeString(t,0),r.quoteId=this.safeString(t,1),r.base=this.safeCurrencyCode(r.baseId),r.quote=this.safeCurrencyCode(r.quoteId),r.symbol=r.base+"/"+r.quote,r):r}return void 0!==t?t:r}checkRequiredCredentials(e=!0){const t=Object.keys(this.requiredCredentials);for(let i=0;i<t.length;i++){const s=t[i];if(this.requiredCredentials[s]&&!this[s]){if(e)throw new y(this.id+' requires "'+s+'" credential');return!1}}return!0}oath(){if(void 0!==this.twofa)return this.totp(this.twofa);throw new l(this.id+" exchange.twofa has not been set for 2FA Two-Factor Authentication")}async fetchBalance(e={}){throw new g(this.id+" fetchBalance() is not supported yet")}async fetchPartialBalance(e,t={}){return(await this.fetchBalance(t))[e]}async fetchFreeBalance(e={}){return await this.fetchPartialBalance("free",e)}async fetchUsedBalance(e={}){return await this.fetchPartialBalance("used",e)}async fetchTotalBalance(e={}){return await this.fetchPartialBalance("total",e)}async fetchStatus(e={}){if(this.has.fetchTime){const t=await this.fetchTime(e);this.status=this.extend(this.status,{updated:t})}return this.status}async fetchFundingFee(e,t={}){if(this.safeValue(this.options,"warnOnFetchFundingFee",!0))throw new g(this.id+' fetchFundingFee() method is deprecated, it will be removed in July 2022, please, use fetchTransactionFee() or set exchange.options["warnOnFetchFundingFee"] = false to suppress this warning');return await this.fetchTransactionFee(e,t)}async fetchFundingFees(e,t={}){if(this.safeValue(this.options,"warnOnFetchFundingFees",!0))throw new g(this.id+' fetchFundingFees() method is deprecated, it will be removed in July 2022. Please, use fetchTransactionFees() or set exchange.options["warnOnFetchFundingFees"] = false to suppress this warning');return await this.fetchTransactionFees(e,t)}async fetchTransactionFee(e,t={}){if(!this.has.fetchTransactionFees)throw new g(this.id+" fetchTransactionFee() is not supported yet");return await this.fetchTransactionFees([e],t)}async fetchTransactionFees(e,t={}){throw new g(this.id+" fetchTransactionFees() is not supported yet")}async fetchDepositWithdrawFee(e,t={}){if(!this.has.fetchDepositWithdrawFees)throw new g(this.id+" fetchDepositWithdrawFee() is not supported yet");const i=await this.fetchDepositWithdrawFees([e],t);return this.safeValue(i,e)}getSupportedMapping(e,t={}){if(e in t)return t[e];throw new g(this.id+" "+e+" does not have a value in mapping")}async fetchBorrowRate(e,t={}){if(await this.loadMarkets(),!this.has.fetchBorrowRates)throw new g(this.id+" fetchBorrowRate() is not supported yet");const i=await this.fetchBorrowRates(t),s=this.safeValue(i,e);if(void 0===s)throw new l(this.id+" fetchBorrowRate() could not find the borrow rate for currency code "+e);return s}handleOptionAndParams(e,t,i,s){const r="default"+this.capitalize(i);let a=this.safeValue2(e,i,r);if(void 0!==a)e=this.omit(e,[i,r]);else{const e=this.safeValue(this.options,t);void 0!==e&&(a=this.safeValue2(e,i,r)),void 0===a&&(a=this.safeValue2(this.options,i,r)),a=void 0!==a?a:s}return[a,e]}handleOption(e,t,i){const[s,r]=this.handleOptionAndParams({},e,t,i);return s}handleMarketTypeAndParams(e,t,i={}){const s=this.safeString2(this.options,"defaultType","type","spot"),r=this.safeValue(this.options,e);let a=s;void 0!==r&&(a="string"==typeof r?r:this.safeString2(r,"defaultType","type",a));const n=void 0===t?a:t.type;return[this.safeString2(i,"defaultType","type",n),i=this.omit(i,["defaultType","type"])]}handleSubTypeAndParams(e,t,i={},s){let r;const a=this.safeString2(i,"subType","defaultSubType");if(void 0!==a)r=a,i=this.omit(i,["subType","defaultSubType"]);else if(void 0!==t&&(t.linear?r="linear":t.inverse&&(r="inverse")),void 0===r){r=this.handleOptionAndParams(void 0,e,"subType",s)[0]}return[r,i]}handleMarginModeAndParams(e,t={},i){return this.handleOptionAndParams(t,e,"marginMode",i)}throwExactlyMatchedException(e,t,i){if(t in e)throw new e[t](i)}throwBroadlyMatchedException(e,t,i){const s=this.findBroadlyMatchedKey(e,t);if(void 0!==s)throw new e[s](i)}findBroadlyMatchedKey(e,t){const i=Object.keys(e);for(let e=0;e<i.length;e++){const s=i[e];if(void 0!==t&&t.indexOf(s)>=0)return s}}handleErrors(e,t,i,s,r,a,n,o,h){}calculateRateLimiterCost(e,t,i,s,r={},a={}){return this.safeValue(r,"cost",1)}async fetchTicker(e,t={}){if(this.has.fetchTickers){const i=await this.fetchTickers([e],t),s=this.safeValue(i,e);if(void 0===s)throw new f(this.id+" fetchTickers() could not find a ticker for "+e);return s}throw new g(this.id+" fetchTicker() is not supported yet")}async fetchTickers(e,t={}){throw new g(this.id+" fetchTickers() is not supported yet")}async fetchOrder(e,t,i={}){throw new g(this.id+" fetchOrder() is not supported yet")}async fetchOrderStatus(e,t,i={}){return(await this.fetchOrder(e,t,i)).status}async fetchUnifiedOrder(e,t={}){return await this.fetchOrder(this.safeValue(e,"id"),this.safeValue(e,"symbol"),t)}async createOrder(e,t,i,s,r,a={}){throw new g(this.id+" createOrder() is not supported yet")}async cancelOrder(e,t,i={}){throw new g(this.id+" cancelOrder() is not supported yet")}async cancelUnifiedOrder(e,t={}){return this.cancelOrder(this.safeValue(e,"id"),this.safeValue(e,"symbol"),t)}async fetchOrders(e,t,i,s={}){throw new g(this.id+" fetchOrders() is not supported yet")}async fetchOpenOrders(e,t,i,s={}){throw new g(this.id+" fetchOpenOrders() is not supported yet")}async fetchClosedOrders(e,t,i,s={}){throw new g(this.id+" fetchClosedOrders() is not supported yet")}async fetchMyTrades(e,t,i,s={}){throw new g(this.id+" fetchMyTrades() is not supported yet")}async fetchTransactions(e,t,i,s={}){throw new g(this.id+" fetchTransactions() is not supported yet")}async fetchDeposits(e,t,i,s={}){throw new g(this.id+" fetchDeposits() is not supported yet")}async fetchWithdrawals(e,t,i,s={}){throw new g(this.id+" fetchWithdrawals() is not supported yet")}async fetchDepositAddress(e,t={}){if(this.has.fetchDepositAddresses){const i=await this.fetchDepositAddresses([e],t),s=this.safeValue(i,e);if(void 0===s)throw new p(this.id+" fetchDepositAddress() could not find a deposit address for "+e+", make sure you have created a corresponding deposit address in your wallet on the exchange website");return s}throw new g(this.id+" fetchDepositAddress() is not supported yet")}account(){return{free:void 0,used:void 0,total:void 0}}commonCurrencyCode(e){return this.substituteCommonCurrencyCodes?this.safeString(this.commonCurrencies,e,e):e}currency(e){if(void 0===this.currencies)throw new l(this.id+" currencies not loaded");if("string"==typeof e){if(e in this.currencies)return this.currencies[e];if(e in this.currencies_by_id)return this.currencies_by_id[e]}throw new l(this.id+" does not have currency code "+e)}market(e){if(void 0===this.markets)throw new l(this.id+" markets not loaded");if("string"==typeof e){if(e in this.markets)return this.markets[e];if(e in this.markets_by_id){const t=this.markets_by_id[e],i=this.safeString2(this.options,"defaultType","defaultSubType","spot");for(let e=0;e<t.length;e++){const s=t[e];if(s[i])return s}return t[0]}}throw new u(this.id+" does not have market symbol "+e)}handleWithdrawTagAndParams(e,t){return"object"==typeof e&&(t=this.extend(e,t),e=void 0),void 0===e&&void 0!==(e=this.safeString(t,"tag"))&&(t=this.omit(t,"tag")),[e,t]}async createLimitOrder(e,t,i,s,r={}){return await this.createOrder(e,"limit",t,i,s,r)}async createMarketOrder(e,t,i,s,r={}){return await this.createOrder(e,"market",t,i,s,r)}async createLimitBuyOrder(e,t,i,s={}){return await this.createOrder(e,"limit","buy",t,i,s)}async createLimitSellOrder(e,t,i,s={}){return await this.createOrder(e,"limit","sell",t,i,s)}async createMarketBuyOrder(e,t,i={}){return await this.createOrder(e,"market","buy",t,void 0,i)}async createMarketSellOrder(e,t,i={}){return await this.createOrder(e,"market","sell",t,void 0,i)}costToPrecision(e,t){const i=this.market(e);return this.decimalToPrecision(t,T,i.precision.price,this.precisionMode,this.paddingMode)}priceToPrecision(e,t){const i=this.market(e),s=this.decimalToPrecision(t,_,i.precision.price,this.precisionMode,this.paddingMode);if("0"===s)throw new k(this.id+" price of "+i.symbol+" must be greater than minimum price precision of "+this.numberToString(i.precision.price));return s}amountToPrecision(e,t){const i=this.market(e),s=this.decimalToPrecision(t,T,i.precision.amount,this.precisionMode,this.paddingMode);if("0"===s)throw new k(this.id+" amount of "+i.symbol+" must be greater than minimum amount precision of "+this.numberToString(i.precision.amount));return s}feeToPrecision(e,t){const i=this.market(e);return this.decimalToPrecision(t,_,i.precision.price,this.precisionMode,this.paddingMode)}currencyToPrecision(e,t,i){const s=this.currencies[e];let r=this.safeValue(s,"precision");if(void 0!==i){const e=this.safeValue(s,"networks",{}),t=this.safeValue(e,i,{});r=this.safeValue(t,"precision",r)}return void 0===r?t:this.decimalToPrecision(t,_,r,this.precisionMode,this.paddingMode)}safeNumber(e,t,i){const s=this.safeString(e,t);return this.parseNumber(s,i)}safeNumberN(e,t,i){const s=this.safeStringN(e,t);return this.parseNumber(s,i)}parsePrecision(e){if(void 0!==e)return"1e"+x.stringNeg(e)}async loadTimeDifference(e={}){const t=await this.fetchTime(e),i=this.milliseconds();return this.options.timeDifference=i-t,this.options.timeDifference}implodeHostname(e){return this.implodeParams(e,{hostname:this.hostname})}async fetchMarketLeverageTiers(e,t={}){if(this.has.fetchLeverageTiers){if(!(await this.market(e)).contract)throw new u(this.id+" fetchMarketLeverageTiers() supports contract markets only");const t=await this.fetchLeverageTiers([e]);return this.safeValue(t,e)}throw new g(this.id+" fetchMarketLeverageTiers() is not supported yet")}async createPostOnlyOrder(e,t,i,s,r,a={}){if(!this.has.createPostOnlyOrder)throw new g(this.id+"createPostOnlyOrder() is not supported yet");const n=this.extend(a,{postOnly:!0});return await this.createOrder(e,t,i,s,r,n)}async createReduceOnlyOrder(e,t,i,s,r,a={}){if(!this.has.createReduceOnlyOrder)throw new g(this.id+"createReduceOnlyOrder() is not supported yet");const n=this.extend(a,{reduceOnly:!0});return await this.createOrder(e,t,i,s,r,n)}async createStopOrder(e,t,i,s,r,a,n={}){if(!this.has.createStopOrder)throw new g(this.id+" createStopOrder() is not supported yet");if(void 0===a)throw new k(this.id+" create_stop_order() requires a stopPrice argument");const o=this.extend(n,{stopPrice:a});return await this.createOrder(e,t,i,s,r,o)}async createStopLimitOrder(e,t,i,s,r,a={}){if(!this.has.createStopLimitOrder)throw new g(this.id+" createStopLimitOrder() is not supported yet");const n=this.extend(a,{stopPrice:r});return await this.createOrder(e,"limit",t,i,s,n)}async createStopMarketOrder(e,t,i,s,r={}){if(!this.has.createStopMarketOrder)throw new g(this.id+" createStopMarketOrder() is not supported yet");const a=this.extend(r,{stopPrice:s});return await this.createOrder(e,"market",t,i,void 0,a)}safeCurrencyCode(e,t){return(t=this.safeCurrency(e,t)).code}filterBySymbolSinceLimit(e,t,i,s,r=!1){return this.filterByValueSinceLimit(e,"symbol",t,i,s,"timestamp",r)}filterByCurrencySinceLimit(e,t,i,s,r=!1){return this.filterByValueSinceLimit(e,"currency",t,i,s,"timestamp",r)}parseTickers(e,t,i={}){const s=[];if(Array.isArray(e))for(let t=0;t<e.length;t++){const r=this.extend(this.parseTicker(e[t]),i);s.push(r)}else{const t=Object.keys(e);for(let r=0;r<t.length;r++){const a=t[r],n=this.safeMarket(a),o=this.extend(this.parseTicker(e[a],n),i);s.push(o)}}return t=this.marketSymbols(t),this.filterByArray(s,"symbol",t)}parseDepositAddresses(e,t,i=!0,s={}){let r=[];for(let t=0;t<e.length;t++){const i=this.extend(this.parseDepositAddress(e[t]),s);r.push(i)}return void 0!==t&&(r=this.filterByArray(r,"currency",t,!1)),r=i?this.indexBy(r,"currency"):r,r}parseBorrowInterests(e,t){const i=[];for(let s=0;s<e.length;s++){const r=e[s];i.push(this.parseBorrowInterest(r,t))}return i}parseFundingRateHistories(e,t,i,s){const r=[];for(let i=0;i<e.length;i++){const s=e[i];r.push(this.parseFundingRateHistory(s,t))}const a=this.sortBy(r,"timestamp"),n=void 0===t?void 0:t.symbol;return this.filterBySymbolSinceLimit(a,n,i,s)}safeSymbol(e,t,i,s){return(t=this.safeMarket(e,t,i,s)).symbol}parseFundingRate(e,t){throw new g(this.id+" parseFundingRate() is not supported yet")}parseFundingRates(e,t){const i={};for(let s=0;s<e.length;s++){const r=this.parseFundingRate(e[s],t);i[r.symbol]=r}return i}isTriggerOrder(e){const t=this.safeValue2(e,"trigger","stop");return t&&(e=this.omit(e,["trigger","stop"])),[t,e]}isPostOnly(e,t,i={}){const s=this.safeStringUpper(i,"timeInForce");let r=this.safeValue2(i,"postOnly","post_only",!1);if(r=r||"PO"===s||t,r){if("IOC"===s||"FOK"===s)throw new m(this.id+" postOnly orders cannot have timeInForce equal to "+s);if(e)throw new m(this.id+" market orders cannot be postOnly");return!0}return!1}async fetchTradingFees(e={}){throw new g(this.id+" fetchTradingFees() is not supported yet")}async fetchTradingFee(e,t={}){if(!this.has.fetchTradingFees)throw new g(this.id+" fetchTradingFee() is not supported yet");return await this.fetchTradingFees(t)}parseOpenInterest(e,t){throw new g(this.id+" parseOpenInterest () is not supported yet")}parseOpenInterests(e,t,i,s){const r=[];for(let i=0;i<e.length;i++){const s=e[i],a=this.parseOpenInterest(s,t);r.push(a)}const a=this.sortBy(r,"timestamp"),n=this.safeString(t,"symbol");return this.filterBySymbolSinceLimit(a,n,i,s)}async fetchFundingRate(e,t={}){if(this.has.fetchFundingRates){await this.loadMarkets();if(!this.market(e).contract)throw new u(this.id+" fetchFundingRate() supports contract markets only");const i=await this.fetchFundingRates([e],t),s=this.safeValue(i,e);if(void 0===s)throw new f(this.id+" fetchFundingRate () returned no data for "+e);return s}throw new g(this.id+" fetchFundingRate () is not supported yet")}async fetchMarkOHLCV(e,t="1m",i,s,r={}){if(this.has.fetchMarkOHLCV){const a={price:"mark"};return await this.fetchOHLCV(e,t,i,s,this.extend(a,r))}throw new g(this.id+" fetchMarkOHLCV () is not supported yet")}async fetchIndexOHLCV(e,t="1m",i,s,r={}){if(this.has.fetchIndexOHLCV){const a={price:"index"};return await this.fetchOHLCV(e,t,i,s,this.extend(a,r))}throw new g(this.id+" fetchIndexOHLCV () is not supported yet")}async fetchPremiumIndexOHLCV(e,t="1m",i,s,r={}){if(this.has.fetchPremiumIndexOHLCV){const a={price:"premiumIndex"};return await this.fetchOHLCV(e,t,i,s,this.extend(a,r))}throw new g(this.id+" fetchPremiumIndexOHLCV () is not supported yet")}handleTimeInForce(e={}){const t=this.safeStringUpper(e,"timeInForce");if(void 0!==t){const e=this.safeString(this.options.timeInForce,t);if(void 0===e)throw new l(this.id+' does not support timeInForce "'+t+'"');return e}}convertTypeToAccount(e){const t=this.safeValue(this.options,"accountsByType",{}),i=e.toLowerCase();if(i in t)return t[i];if(e in this.markets||e in this.markets_by_id){return this.market(e).id}return e}checkRequiredArgument(e,t,i,s=[]){const r=s.length;if(void 0===t||r>0&&!this.inArray(t,s)){const t=s.join(", ");let r=this.id+" "+e+"() requires a "+i+" argument";throw""!==t&&(r+=", one of ("+t+")"),new k(r)}}checkRequiredMarginArgument(e,t,i){if("isolated"===i&&void 0===t)throw new k(this.id+" "+e+"() requires a symbol argument for isolated margin");if("cross"===i&&void 0!==t)throw new k(this.id+" "+e+"() cannot have a symbol argument for cross margin")}checkRequiredSymbol(e,t){this.checkRequiredArgument(e,t,"symbol")}parseDepositWithdrawFees(e,t,i){const s={};t=this.marketCodes(t);const r=Array.isArray(e);let a=e;r||(a=Object.keys(e));for(let n=0;n<a.length;n++){const o=a[n],h=r?o:e[o],d=r?this.safeString(h,i):o,c=this.safeValue(this.currencies_by_id,d),l=this.safeString(c,"code",d);(void 0===t||this.inArray(l,t))&&(s[l]=this.parseDepositWithdrawFee(h,c))}return s}depositWithdrawFee(e){return{info:e,withdraw:{fee:void 0,percentage:void 0},deposit:{fee:void 0,percentage:void 0},networks:{}}}assignDefaultDepositWithdrawFees(e,t){const i=Object.keys(e.networks),s=i.length;if(1===s)return e.withdraw=e.networks[i[0]].withdraw,e.deposit=e.networks[i[0]].deposit,e;const r=this.safeString(t,"code");for(let t=0;t<s;t++){i[t]===r&&(e.withdraw=e.networks[i[t]].withdraw,e.deposit=e.networks[i[t]].deposit)}return e}parseIncomes(e,t,i,s){const r=[];for(let i=0;i<e.length;i++){const s=e[i],a=this.parseIncome(s,t);r.push(a)}const a=this.sortBy(r,"timestamp");return this.filterBySinceLimit(a,i,s)}}},6832:function(e){"use strict";const t=BigInt(0),i=BigInt(-1),s=BigInt(10);class r{constructor(e,t){if(void 0===t){let t=0;(e=e.toLowerCase()).indexOf("e")>-1&&([e,t]=e.split("e"),t=parseInt(t));const i=e.indexOf(".");this.decimals=i>-1?e.length-i-1:0;const s=e.replace(".","");this.integer=BigInt(s),this.decimals=this.decimals-t}else this.integer=e,this.decimals=t}mul(e){const t=this.integer*e.integer;return new r(t,this.decimals+e.decimals)}div(e,t=18){const i=t-this.decimals+e.decimals;let a;if(0===i)a=this.integer;else if(i<0){const e=s**BigInt(-i);a=this.integer/e}else{const e=s**BigInt(i);a=this.integer*e}const n=a/e.integer;return new r(n,t)}add(e){if(this.decimals===e.decimals){const t=this.integer+e.integer;return new r(t,this.decimals)}{const[t,i]=this.decimals>e.decimals?[e,this]:[this,e],a=i.decimals-t.decimals,n=t.integer*s**BigInt(a)+i.integer;return new r(n,i.decimals)}}mod(e){const t=Math.max(-this.decimals+e.decimals,0),i=this.integer*s**BigInt(t),a=Math.max(-e.decimals+this.decimals,0),n=e.integer*s**BigInt(a);return new r(i%n,a+e.decimals)}sub(e){const t=new r(-e.integer,e.decimals);return this.add(t)}abs(){return new r(this.integer<0?this.integer*i:this.integer,this.decimals)}neg(){return new r(-this.integer,this.decimals)}min(e){return this.lt(e)?this:e}max(e){return this.gt(e)?this:e}gt(e){return this.sub(e).integer>0}ge(e){return this.sub(e).integer>=0}lt(e){return e.gt(this)}le(e){return e.ge(this)}reduce(){const e=this.integer.toString(),t=e.length-1;if(0===t)return"0"===e&&(this.decimals=0),this;let i;for(i=t;i>=0&&"0"===e.charAt(i);i--);const s=t-i;if(0===s)return this;this.decimals-=s,this.integer=BigInt(e.slice(0,i+1))}equals(e){return this.reduce(),e.reduce(),this.decimals===e.decimals&&this.integer===e.integer}toString(){let e,t;this.reduce(),this.integer<0?(e="-",t=-this.integer):(e="",t=this.integer);const i=Array.from(t.toString(Number(s)).padStart(this.decimals,"0")),r=i.length-this.decimals;let a;return a=0===r?"0.":this.decimals<0?"0".repeat(-this.decimals):0===this.decimals?"":".",i.splice(r,0,a),e+i.join("")}static stringMul(e,t){if(void 0!==e&&void 0!==t)return new r(e).mul(new r(t)).toString()}static stringDiv(e,i,s=18){if(void 0===e||void 0===i)return;const a=new r(i);return a.integer!==t?new r(e).div(a,s).toString():void 0}static stringAdd(e,t){if(void 0!==e||void 0!==t)return void 0===e?t:void 0===t?e:new r(e).add(new r(t)).toString()}static stringSub(e,t){if(void 0!==e&&void 0!==t)return new r(e).sub(new r(t)).toString()}static stringAbs(e){if(void 0!==e)return new r(e).abs().toString()}static stringNeg(e){if(void 0!==e)return new r(e).neg().toString()}static stringMod(e,t){if(void 0!==e&&void 0!==t)return new r(e).mod(new r(t)).toString()}static stringEquals(e,t){if(void 0!==e&&void 0!==t)return new r(e).equals(new r(t))}static stringEq(e,t){if(void 0!==e&&void 0!==t)return new r(e).equals(new r(t))}static stringMin(e,t){if(void 0!==e&&void 0!==t)return new r(e).min(new r(t)).toString()}static stringMax(e,t){if(void 0!==e&&void 0!==t)return new r(e).max(new r(t)).toString()}static stringGt(e,t){if(void 0!==e&&void 0!==t)return new r(e).gt(new r(t))}static stringGe(e,t){if(void 0!==e&&void 0!==t)return new r(e).ge(new r(t))}static stringLt(e,t){if(void 0!==e&&void 0!==t)return new r(e).lt(new r(t))}static stringLe(e,t){if(void 0!==e&&void 0!==t)return new r(e).le(new r(t))}}e.exports=r},66667:function(e){"use strict";e.exports={BaseError:{ExchangeError:{AuthenticationError:{PermissionDenied:{AccountNotEnabled:{}},AccountSuspended:{}},ArgumentsRequired:{},BadRequest:{BadSymbol:{},MarginModeAlreadySet:{}},BadResponse:{NullResponse:{}},InsufficientFunds:{},InvalidAddress:{AddressPending:{}},InvalidOrder:{OrderNotFound:{},OrderNotCached:{},CancelPending:{},OrderImmediatelyFillable:{},OrderNotFillable:{},DuplicateOrderId:{}},NotSupported:{}},NetworkError:{DDoSProtection:{RateLimitExceeded:{}},ExchangeNotAvailable:{OnMaintenance:{}},InvalidNonce:{},RequestTimeout:{}}}}},73449:function(e,t,i){"use strict";const s=i(66667);e.exports=function e(t,i,s={}){for(const[r,a]of Object.entries(i)){const i=Object.assign(s,{[r]:class extends t{constructor(e){super(e),this.constructor=i,this.__proto__=i.prototype,this.name=r,this.message=e,Object.setPrototypeOf(this,i.prototype)}}})[r];e(i,a,s)}return s}(Error,s)},85806:function(e,t,i){"use strict";const{unCamelCase:s}=i(69579);e.exports=(e=>{for(const t in e)e[s(t)]=e[t];return e})(Object.assign({},i(90182),i(65206),i(69579),i(11799),i(62115),i(80651),i(35691),i(39764),i(3186),i(26558)))},35691:function(e,t,i){"use strict";const s=i(27295),{capitalize:r}=i(69579),{stringToBase64:a,urlencodeBase64:n}=i(80651),o=i(21286),{binaryToBase58:h,byteArrayToWordArray:d}=i(80651),c=i(73150),l=c.ec,u=c.eddsa,{ArgumentsRequired:f}=i(73449),p=i(35060),m=(e,t="md5",i="hex")=>{const a={};"keccak"===t&&(t="SHA3",a.outputLength=256);const n=s[t.toUpperCase()](e,a);return"binary"===i?n:n.toString(s.enc[r(i)])},g=(e,t,i="sha256",a="hex")=>{const n=s["Hmac"+i.toUpperCase()](e,t);if(a){const e="binary"===a?"Latin1":r(a);return n.toString(s.enc[r(e)])}return n};function y(e,t,i="RS256"){const s={RS256:"pkcs1-sha256",RS512:"pkcs1-sha512"};if(!(i in s))throw new ExchangeError(i+" is not a supported rsa signing algorithm.");return new o(t,{environment:"browser",signingScheme:s[i]}).sign(e,"base64","binary")}e.exports={hash:m,hmac:g,jwt:function(e,t,i="HS256"){const s=[n(a(JSON.stringify({alg:i,typ:"JWT"}))),n(a(JSON.stringify(e)))].join("."),r=i.slice(0,2);let o;return"HS"===r?o=n(g(s,t,{HS256:"sha256",HS384:"sha384",HS512:"sha512"}[i],"base64")):"RS"===r&&(o=n(y(s,t,i))),[s,o].join(".")},totp:e=>{const t=e=>parseInt(e,16),i=(e,t)=>(t+e).slice(-t.length);return(e=>{e=e.replace(" ","");let r=Math.round((new Date).getTime()/1e3),a=i(((n=Math.floor(r/30))<15.5?"0":"")+Math.round(n).toString(16),"0000000000000000");var n;let o=g(s.enc.Hex.parse(a),s.enc.Hex.parse((e=>{let t="",s="";for(let s=0;s<e.length;s++){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".indexOf(e.charAt(s).toUpperCase());t+=i(r.toString(2),"00000")}for(let e=0;e+4<=t.length;e+=4){let i=t.substr(e,4);s+=parseInt(i,2).toString(16)}return s})(e)),"sha1","hex"),h=t(o.substring(o.length-1)),d=(t(o.substr(2*h,8))&t("7fffffff"))+"";return d=d.substr(d.length-6,6),d})(e)},rsa:y,ecdsa:function(e,t,i="p256",s,r=!1){let a=e;void 0!==s&&(a=m(e,s,"hex"));const n=new l(i);let o=n.sign(a,t,"hex",{canonical:!0}),h=new p("0");const d=new p("1").shln(248).sub(new p("1"));for(;r&&(o.r.gt(n.nh)||o.r.lte(d)||o.s.lte(d));)o=n.sign(a,t,"hex",{canonical:!0,extraEntropy:h.toArray("le",32)}),h=h.add(new p("1"));return{r:o.r.toString(16).padStart(64,"0"),s:o.s.toString(16).padStart(64,"0"),v:o.recoveryParam}},eddsa:function(e,t,i="ed25519"){const s=new u(i).signModified(e,t);return h(d(s.toBytes()))},crc32:function e(t,i=!1){void 0===e.table&&(e.table="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D".split(" ").map((e=>parseInt(e,16))));let s=-1;for(let i=0;i<t.length;i++)s=s>>>8^e.table[255&(s^t.charCodeAt(i))];const r=(-1^s)>>>0;return i&&r>=2147483648?r-4294967296:r}}},80651:function(e,t,i){"use strict";const s=i(27295),r=i(84106),a=i(35060),n="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";let o=null,h=null;function d(e){const t=[];for(let i=0;i<e.length;i++)t[i/4|0]|=e[i]<<24-8*i;return s.lib.WordArray.create(t,e.length)}e.exports={json:(e,t)=>JSON.stringify(e),isJsonEncodedObject:e=>"string"==typeof e&&e.length>=2&&("{"===e[0]||"["===e[0]),stringToBinary:e=>s.enc.Latin1.parse(e),stringToBase64:e=>s.enc.Latin1.parse(e).toString(s.enc.Base64),base64ToBinary:e=>s.enc.Base64.parse(e),base64ToString:e=>s.enc.Base64.parse(e).toString(s.enc.Utf8),binaryToBase64:e=>e.toString(s.enc.Base64),base16ToBinary:e=>s.enc.Hex.parse(e),binaryToBase16:e=>e.toString(s.enc.Hex),binaryConcat:(...e)=>e.reduce(((e,t)=>e.concat(t))),binaryConcatArray:e=>e.reduce(((e,t)=>e.concat(t))),urlencode:e=>r.stringify(e),urlencodeNested:e=>r.stringify(e),urlencodeWithArrayRepeat:e=>r.stringify(e,{arrayFormat:"repeat"}),rawencode:e=>r.stringify(e,{encode:!1}),encode:e=>e,decode:e=>e,urlencodeBase64:e=>e.replace(/[=]+$/,"").replace(/\+/g,"-").replace(/\//g,"_"),numberToLE:(e,t)=>d(new a(e).toArray("le",t)),numberToBE:(e,t)=>d(new a(e).toArray("be",t)),base58ToBinary:e=>{if(!o){o={},h={};for(let e=0;e<58;e++){const t=n[e],i=new a(e);o[t]=i,h[i]=t}}let t=new a(0);const i=new a(58);for(let s=0;s<e.length;s++){const r=e[s];t.imul(i),t.iadd(o[r])}return d(t.toArray("be"))},binaryToBase58:e=>{if(!h){o={},h={};for(let e=0;e<58;e++){const t=n[e],i=new a(e);o[t]=i,h[i]=t}}const t=new a(58),i=e.toString(s.enc.Hex);let r=new a(i,16),d=[];for(;!r.isZero();){const{div:e,mod:i}=r.divmod(t);r=e,d.push(h[i])}return d.reverse().join("")}},e.exports.byteArrayToWordArray=d},65206:function(e,t,i){"use strict";const{isNumber:s,isDictionary:r,isArray:a}=i(11799),n=Object.keys,o=e=>a(e)?e:Object.values(e),h=e=>new Set(o(e)),d=(...e)=>Object.assign({},...e),c=e=>a(e)?Array.from(e):d(e);e.exports={keys:n,values:o,extend:d,clone:c,index:h,ordered:e=>e,unique:e=>Array.from(h(e)),arrayConcat:(e,t)=>e.concat(t),inArray(e,t){return t.includes(e)},toArray(e){return Object.values(e)},isEmpty(e){return!e||(Array.isArray(e)?e:Object.keys(e)).length<1},keysort(e,t={}){for(const i of n(e).sort())t[i]=e[i];return t},indexBy(e,t,i={}){for(const s of o(e))t in s&&(i[s[t]]=s);return i},groupBy(e,t,i={}){for(const s of o(e))if(t in s){const e=s[t];i[e]=i[e]||[],i[e].push(s)}return i},filterBy(e,t,i,s=[]){for(const r of o(e))r[t]===i&&s.push(r);return s},sortBy:(e,t,i=!1,s=(i?-1:1))=>e.sort(((e,i)=>e[t]<i[t]?-s:e[t]>i[t]?s:0)),sortBy2:(e,t,i,s=!1,r=(s?-1:1))=>e.sort(((e,s)=>e[t]<s[t]?-r:e[t]>s[t]?r:e[i]<s[i]?-r:e[i]>s[i]?r:0)),flatten:function e(t,i=[]){for(const s of t)a(s)?e(s,i):i.push(s);return i},pluck:(e,t)=>o(e).filter((e=>t in e)).map((e=>e[t])),omit(e,...t){if(!Array.isArray(e)){const i=c(e);for(const e of t)if(a(e))for(const t of e)delete i[t];else delete i[e];return i}return e},sum(...e){const t=e.filter(s);return t.length>0?t.reduce(((e,t)=>e+t),0):void 0},deepExtend:function e(...t){let i;for(const s of t)if(r(s)){r(i)||(i={});for(const t in s)i[t]=e(i[t],s[t])}else i=s;return i}}},26558:function(e,t,i){"use strict";const{ROUND_UP:s,ROUND_DOWN:r}=i(62115),{NotSupported:a}=i(73449),n=e=>{const t=e.slice(0,-1),i=e.slice(-1);let s;if("y"===i)s=31536e3;else if("M"===i)s=2592e3;else if("w"===i)s=604800;else if("d"===i)s=86400;else if("h"===i)s=3600;else if("m"===i)s=60;else{if("s"!==i)throw new a("timeframe unit "+i+" is not supported");s=1}return t*s};e.exports={aggregate(e){const t={};for(let i=0;i<e.length;i++){const[s,r]=e[i];r>0&&(t[s]=(t[s]||0)+r)}return Object.keys(t).map((e=>[parseFloat(e),parseFloat(t[e])]))},parseTimeframe:n,roundTimeframe:(e,t,i=r)=>{const a=1e3*n(e);return t-t%a+(i===s?a:0)},buildOHLCVC:(e,t="1m",i=-1/0,s=1/0)=>{const r=1e3*n(t),a=[],[o,,h,d,c,l,u]=[0,1,2,3,4,5,6],f=Math.min(e.length-1,s);for(let t=0;t<=f;t++){const s=e[t];if(s.timestamp<i)continue;const n=Math.floor(s.timestamp/r)*r,f=a.length-1;-1===f||n>=a[f][o]+r?a.push([n,s.price,s.price,s.price,s.price,s.amount,1]):(a[f][h]=Math.max(a[f][h],s.price),a[f][d]=Math.min(a[f][d],s.price),a[f][c]=s.price,a[f][l]+=s.amount,a[f][u]++)}return a},ROUND_UP:s,ROUND_DOWN:r,implodeParams:(e,t)=>{if(!Array.isArray(t)){const i=Object.keys(t);for(let s=0;s<i.length;s++){const r=i[s];Array.isArray(t[r])||(e=e.replace("{"+r+"}",t[r]))}}return e},extractParams:e=>{const t=/{([\w-]+)}/g,i=[];let s=t.exec(e);for(;s;)i.push(s[1]),s=t.exec(e);return i},vwap:function(e,t){return void 0!==e&&void 0!==t&&e>0?t/e:void 0}}},62115:function(e){"use strict";const t={ROUND:0,TRUNCATE:1,ROUND_UP:2,ROUND_DOWN:3,DECIMAL_PLACES:0,SIGNIFICANT_DIGITS:1,TICK_SIZE:2,NO_PADDING:0,PAD_WITH_ZERO:1};function i(e){if(void 0===e)return;if("number"!=typeof e)return e.toString();const t=e.toString();if(Math.abs(e)<1){const i=t.split("e-"),s=i[0].replace(".",""),r=parseInt(i[1]),a="-"===t[0];if(r)return e=(a?"-":"")+"0."+new Array(r).join("0")+s.substring(a)}else{const e=t.split("e");if(e[1]){let t=parseInt(e[1]);const i=e[0].split(".");let s="";return i[1]&&(t-=i[1].length,s=i[1]),i[0]+s+new Array(t+1).join("0")}}return t}const s=[],r=(e,t=0)=>{if(e=i(e),t>0){const i=s[t]||(s[t]=new RegExp("([-]*\\d+\\.\\d{"+t+"})(\\d)")),[,r]=e.toString().match(i)||[null,e];return r.toString()}return parseInt(e).toString()};function a(e){if(e.indexOf("e")>-1){const t=e.replace(/\de/,"");return-1*parseInt(t)}const t=e.replace(/0+$/g,"").split(".");return t.length>1?t[1].length:0}const n=(e,t,s,r=0,o=0)=>{if(2===r&&s<=0)throw new Error("TICK_SIZE cant be used with negative or zero numPrecisionDigits");if(s<0){const i=Math.pow(10,-s);if(0===t)return(i*n(e/i,t,0,r,o)).toString();if(1===t)return(e-e%i).toString()}if(2===r){const i=a(n(s,0,22,0,0));let r=e%s;r=Number(n(r,0,8,0,0));return 0!==a(n(r/s,0,Math.max(i,8),0,0))&&(0===t?e>0?r>=s/2?e=e-r+s:e-=r:e=r>=s/2?Number(e)-r:Number(e)-r-s:1===t&&(e-=r)),n(e,0,i,0,o)}const h=i(e),d="-"===h[0],c=d?1:0,l=h.length;for(var u=0;u<l&&"."!==h[u];u++);const f=u<h.length,p=48,m=new Uint8Array(l-c+(f?0:1));m[0]=p;let g=m.length,y=-1,b=-1;for(var v=1,w=c;w<l;w++,v++){const e=h.charCodeAt(w);if(46===e)g=v--;else{if(e<p||e>57)throw new Error(`${h}: invalid number (contains an illegal character '${h[v-1]}')`);m[v]=e,e!==p&&y<0&&(y=v)}}y<0&&(y=1);let S=0===r?g:y,k=S+s;b=-1;let T=!0,_=d;for(let e=m.length-1,i=0;e>=0;e--){let r=m[e];if(0!==e){if(r+=i,e>=S+s){r=0===t&&r>=53&&!(53===r&&i)?58:p}r>57?(r=p,i=1):i=0}else i&&(r=49);m[e]=r,r!==p&&(T=!1,y=e,b=b<0?e+1:b)}1===r&&(S=y,k=S+s),T&&(_=!1);const O=y>=g||T?g-1:y,M=b<g?g:b,I=_?1:0,x=I+(g-O),C=Math.max(M-g,0),P=M-O,A=0===o?P:k-O,N=Math.max(A-P,0),B=x+1+C,E=B+N,V=C+N===0,L=new Uint8Array(x+(V?0:1)+C+N);for(_&&(L[0]=45),v=I,w=O;v<x;v++,w++)L[v]=m[w];for(V||(L[x]=46),v=x+1,w=g;v<B;v++,w++)L[v]=m[w];for(v=B;v<E;v++)L[v]=p;return String.fromCharCode(...L)};e.exports={numberToString:i,precisionFromString:a,decimalToPrecision:n,truncate_to_string:r,truncate:(e,t=0)=>parseFloat(r(e,t)),omitZero:function(e){if(void 0!==e&&""!==e&&0!==parseFloat(e))return e},precisionConstants:t,ROUND:0,TRUNCATE:1,ROUND_UP:2,ROUND_DOWN:3,DECIMAL_PLACES:0,SIGNIFICANT_DIGITS:1,TICK_SIZE:2,NO_PADDING:0,PAD_WITH_ZERO:1}},90182:function(e,t,i){"use strict";var s=i(34155);const r="undefined"!=typeof window,a=void 0!==s&&void 0!==s.versions&&void 0!==s.versions.electron,n="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,o=void 0!==s&&"win32"===s.platform,h=!(r||n),d=h?i(79323)().fetch:fetch;e.exports={isBrowser:r,isElectron:a,isWebWorker:n,isNode:h,isWindows:o,defaultFetch:d}},69579:function(e){"use strict";const t=e=>e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t),i=e=>e?(e^16*Math.random()>>e/4).toString(16):([1e5]+100+400+8e3).replace(/[018]/g,i),s=e=>e?(e^16*Math.random()>>e/4).toString(16):([1e7]+1e3+4e3+8e5).replace(/[018]/g,s);e.exports={uuid:t,uuid16:i,uuid22:s,unCamelCase:e=>e.match(/[A-Z]/)?e.replace(/[a-z0-9][A-Z]/g,(e=>e[0]+"_"+e[1])).replace(/[A-Z0-9][A-Z0-9][a-z][^$]/g,(e=>e[0]+"_"+e[1]+e[2]+e[3])).replace(/[a-z][0-9]$/g,(e=>e[0]+"_"+e[1])).toLowerCase():e,capitalize:e=>e.length?e.charAt(0).toUpperCase()+e.slice(1):e,strip:e=>e.replace(/^\s+|\s+$/g,"")}},3186:function(e,t,i){"use strict";const{now:s,sleep:r}=i(39764);class a{constructor(e){this.config={refillRate:1,delay:.001,capacity:1,maxCapacity:2e3,tokens:0,cost:1},Object.assign(this.config,e),this.queue=[],this.running=!1}async loop(){let e=s();for(;this.running;){const{resolver:t,cost:i}=this.queue[0];if(this.config.tokens>=0)this.config.tokens-=i,t(),this.queue.shift(),await Promise.resolve(),0===this.queue.length&&(this.running=!1);else{await r(1e3*this.config.delay);const t=s(),i=t-e;e=t;const a=this.config.tokens+this.config.refillRate*i;this.config.tokens=Math.min(a,this.config.capacity)}}}}e.exports={throttle:function(e){const t=new a(e),i=function(e){let t;const i=new Promise(((e,i)=>{t=e}));if(this.queue.length>this.config.maxCapacity)throw new Error("throttle queue is over maxCapacity ("+this.config.maxCapacity.toString()+"), see https://github.com/ccxt/ccxt/issues/11645#issuecomment-1195695526");return e=void 0===e?this.config.cost:e,this.queue.push({resolver:t,cost:e}),this.running||(this.running=!0,this.loop()),i}.bind(t);return i.config=t.config,i.queue=t.queue,i}}},39764:function(e){"use strict";const t=Date.now,i=()=>1e3*t(),s=t,r=setTimeout,a=(e,i,s=r,n=t()+i)=>{if(i>=2147483647)throw new Error("setTimeout() function was called with unrealistic value of "+i.toString());let o=()=>{},h=!0;const d=s((()=>{h=!0;const i=n-t();i>0?o=a(e,i,s,n):e()}),i);return function(){h&&(h=!1,clearTimeout(d)),o()}};class n extends Error{constructor(){const e="timed out";super(e),this.constructor=n,this.__proto__=n.prototype,this.message=e}}const o=e=>{if("string"==typeof e&&e&&!e.match(/^[0-9]+$/)&&!(e.indexOf("-")<0||e.indexOf(":")<0))try{const t=Date.parse(e.indexOf("+")>=0||"Z"===e.slice(-1)?e:(e+"Z").replace(/\s(\d\d):/,"T$1:"));if(Number.isNaN(t))return;return t}catch(e){return}},h=(e,t,i=!0)=>{t=t||"";const s=new Date(e),r=s.getUTCFullYear(),a=(i?r:r-2e3).toString();let n=s.getUTCMonth()+1,o=s.getUTCDate();return n=n<10?"0"+n:n.toString(),o=o<10?"0"+o:o.toString(),a+t+n+t+o};e.exports={now:t,microseconds:i,milliseconds:s,seconds:()=>Math.floor(t()/1e3),iso8601:e=>{let t;if(t="number"==typeof e?Math.floor(e):parseInt(e,10),!(Number.isNaN(t)||t<0))try{return new Date(t).toISOString()}catch(e){return}},parse8601:o,rfc2616:e=>new Date(e).toUTCString(),uuidv1:()=>{const e=(10*i()+122192928e9).toString(16);return e.slice(7,15)+e.slice(3,7)+"1"+e.slice(0,3)+"9696"+"ff".repeat(6)},parseDate:e=>{if("string"==typeof e&&e){if(e.indexOf("GMT")>=0)try{return Date.parse(e)}catch(e){return}return o(e)}},mdy:(e,t="-")=>{t=t||"";const i=new Date(e),s=i.getUTCFullYear().toString();let r=i.getUTCMonth()+1,a=i.getUTCDate();return r=r<10?"0"+r:r.toString(),a=a<10?"0"+a:a.toString(),r+t+a+t+s},ymd:h,yymmdd:(e,t="")=>h(e,t,!1),yyyymmdd:(e,t="-")=>h(e,t,!0),ymdhms:(e,t=" ")=>{const i=new Date(e),s=i.getUTCFullYear();let r=i.getUTCMonth()+1,a=i.getUTCDate(),n=i.getUTCHours(),o=i.getUTCMinutes(),h=i.getUTCSeconds();return r=r<10?"0"+r:r,a=a<10?"0"+a:a,n=n<10?"0"+n:n,o=o<10?"0"+o:o,h=h<10?"0"+h:h,s+"-"+r+"-"+a+t+n+":"+o+":"+h},setTimeout_safe:a,sleep:e=>new Promise((t=>a(t,e))),TimedOut:n,timeout:async(e,t)=>{let i=()=>{};const s=new Promise((t=>i=a(t,e)));try{return await Promise.race([t,s.then((()=>{throw new n}))])}finally{i()}}}},11799:function(e){"use strict";const t=Number.isFinite,i=Number.isInteger,s=Array.isArray,r=e=>null!=e,a=e=>"string"==typeof e,n=e=>null!==e&&"object"==typeof e,o=e=>r(e)&&e.toString||t(e),h=(e,t)=>n(e)&&""!==e[t]&&null!==e[t]?e[t]:void 0,d=(e,t,i)=>n(e)?void 0!==e[t]&&""!==e[t]&&null!==e[t]?e[t]:""!==e[i]&&null!==e[i]?e[i]:void 0:void 0,c=(e,t)=>e[t.find((t=>void 0!==h(e,t)))],l=e=>t(e)||a(e)&&0!==e.length?parseFloat(e):NaN,u=e=>t(e)||a(e)&&0!==e.length?Math.trunc(Number(e)):NaN;e.exports={isNumber:t,isInteger:i,isArray:s,isObject:n,isString:a,isStringCoercible:o,isDictionary:e=>n(e)&&Object.getPrototypeOf(e)===Object.prototype&&!s(e)&&!(e=>e instanceof RegExp)(e),hasProps:r,prop:h,asFloat:l,asInteger:u,safeFloat:(e,i,s,r=l(h(e,i)))=>t(r)?r:s,safeInteger:(e,i,s,r=u(h(e,i)))=>t(r)?r:s,safeIntegerProduct:(e,i,s,r,a=u(h(e,i)))=>t(a)?parseInt(a*s):r,safeTimestamp:(e,i,s,r=l(h(e,i)))=>t(r)?parseInt(1e3*r):s,safeValue:(e,t,i,s=h(e,t))=>r(s)?s:i,safeString:(e,t,i,s=h(e,t))=>o(s)?String(s):i,safeStringLower:(e,t,i,s=h(e,t))=>o(s)?String(s).toLowerCase():i?i.toLowerCase():i,safeStringUpper:(e,t,i,s=h(e,t))=>o(s)?String(s).toUpperCase():i?i.toUpperCase():i,safeFloat2:(e,i,s,r,a=l(d(e,i,s)))=>t(a)?a:r,safeInteger2:(e,i,s,r,a=u(d(e,i,s)))=>t(a)?a:r,safeIntegerProduct2:(e,i,s,r,a,n=u(d(e,i,s)))=>t(n)?parseInt(n*r):a,safeTimestamp2:(e,i,s,r,a=l(d(e,i,s)))=>t(a)?parseInt(1e3*a):r,safeValue2:(e,t,i,s,a=d(e,t,i))=>r(a)?a:s,safeString2:(e,t,i,s,r=d(e,t,i))=>o(r)?String(r):s,safeStringLower2:(e,t,i,s,r=d(e,t,i))=>o(r)?String(r).toLowerCase():s?s.toLowerCase():s,safeStringUpper2:(e,t,i,s,r=d(e,t,i))=>o(r)?String(r).toUpperCase():s?s.toUpperCase():s,safeFloatN:(e,i,s,r=l(c(e,i)))=>t(r)?r:s,safeIntegerN:(e,i,s,r=u(c(e,i)))=>t(r)?r:s,safeIntegerProductN:(e,i,s,r,a=u(c(e,i)))=>t(a)?parseInt(a*s):r,safeTimestampN:(e,i,s,r=l(c(e,i)))=>t(r)?parseInt(1e3*r):s,safeValueN:(e,t,i,s=c(e,t))=>r(s)?s:i,safeStringN:(e,t,i,s=c(e,t))=>o(s)?String(s):i,safeStringLowerN:(e,t,i,s=c(e,t))=>o(s)?String(s).toLowerCase():i?i.toLowerCase():i,safeStringUpperN:(e,t,i,s=c(e,t))=>o(s)?String(s).toUpperCase():i?i.toUpperCase():i}},21366:function(e,t,i){"use strict";const s=i(28267);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bequant",name:"Bequant",countries:["MT"],pro:!0,urls:{logo:"https://user-images.githubusercontent.com/1294454/55248342-a75dfe00-525a-11e9-8aa2-05e9dca943c6.jpg",api:{public:"https://api.bequant.io",private:"https://api.bequant.io"},www:"https://bequant.io",doc:["https://api.bequant.io/"],fees:["https://bequant.io/fees-and-limits"],referral:"https://bequant.io"}})}}},64400:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,AuthenticationError:n,InsufficientFunds:o,PermissionDenied:h,BadRequest:d,BadSymbol:c,RateLimitExceeded:l,InvalidOrder:u}=i(73449),{TICK_SIZE:f}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bigone",name:"BigONE",countries:["CN"],version:"v3",rateLimit:1200,has:{CORS:void 0,spot:!0,margin:void 0,swap:void 0,future:void 0,option:void 0,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchBalance:!0,fetchClosedOrders:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchMarkets:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransactionFees:!1,fetchWithdrawals:!0,transfer:!0,withdraw:!0},timeframes:{"1m":"min1","5m":"min5","15m":"min15","30m":"min30","1h":"hour1","3h":"hour3","4h":"hour4","6h":"hour6","12h":"hour12","1d":"day1","1w":"week1","1M":"month1"},hostname:"big.one",urls:{logo:"https://user-images.githubusercontent.com/1294454/69354403-1d532180-0c91-11ea-88ed-44c06cefdf87.jpg",api:{public:"https://{hostname}/api/v3",private:"https://{hostname}/api/v3/viewer"},www:"https://big.one",doc:"https://open.big.one/docs/api.html",fees:"https://bigone.zendesk.com/hc/en-us/articles/115001933374-BigONE-Fee-Policy",referral:"https://b1.run/users/new?code=D3LLBVFT"},api:{public:{get:["ping","asset_pairs","asset_pairs/{asset_pair_name}/depth","asset_pairs/{asset_pair_name}/trades","asset_pairs/{asset_pair_name}/ticker","asset_pairs/{asset_pair_name}/candles","asset_pairs/tickers"]},private:{get:["accounts","fund/accounts","assets/{asset_symbol}/address","orders","orders/{id}","orders/multi","trades","withdrawals","deposits"],post:["orders","orders/{id}/cancel","orders/cancel","withdrawals","transfer"]}},fees:{trading:{maker:this.parseNumber("0.001"),taker:this.parseNumber("0.001")},funding:{withdraw:{}}},options:{accountsByType:{spot:"SPOT",funding:"FUND",future:"CONTRACT",swap:"CONTRACT"},transfer:{fillResponseFromRequest:!0},exchangeMillisecondsCorrection:-100},precisionMode:f,exceptions:{exact:{10001:d,10005:r,"Amount's scale must greater than AssetPair's base scale":u,"Price mulit with amount should larger than AssetPair's min_quote_value":u,10007:d,10011:r,10013:c,10014:o,10403:h,10429:l,40004:n,40103:n,40104:n,40301:h,40302:r,40601:r,40602:r,40603:o,40604:u,40605:u,40120:u,40121:u,60100:c},broad:{}},commonCurrencies:{CRE:"Cybereits",FXT:"FXTTOKEN",FREE:"FreeRossDAO",MBN:"Mobilian Coin",ONE:"BigONE Token"}})}async fetchMarkets(e={}){const t=await this.publicGetAssetPairs(e),i=this.safeValue(t,"data",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"name"),a=this.safeString(t,"id"),n=this.safeValue(t,"base_asset",{}),o=this.safeValue(t,"quote_asset",{}),h=this.safeString(n,"symbol"),d=this.safeString(o,"symbol"),c=this.safeCurrencyCode(h),l=this.safeCurrencyCode(d),u={id:r,uuid:a,symbol:c+"/"+l,base:c,quote:l,settle:void 0,baseId:h,quoteId:d,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:!0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"base_scale"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"quote_scale")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"min_quote_value"),max:this.safeNumber(t,"max_quote_value")}},info:t};s.push(u)}return s}async loadMarkets(e=!1,t={}){const i=await super.loadMarkets(e,t);let s=this.safeValue(this.options,"marketsByUuid");if(void 0===s||e){s={};for(let e=0;e<this.symbols.length;e++){const t=this.symbols[e],i=this.markets[t];s[this.safeString(i,"uuid")]=i}this.options.marketsByUuid=s}return i}parseTicker(e,t){const i=this.safeString(e,"asset_pair_name"),s=this.safeSymbol(i,t,"-"),r=void 0,a=this.safeString(e,"close"),n=this.safeValue(e,"bid",{}),o=this.safeValue(e,"ask",{});return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(n,"price"),bidVolume:this.safeString(n,"quantity"),ask:this.safeString(o,"price"),askVolume:this.safeString(o,"quantity"),vwap:void 0,open:this.safeString(e,"open"),close:a,last:a,previousClose:void 0,change:this.safeString(e,"daily_change"),percentage:void 0,average:void 0,baseVolume:this.safeString(e,"volume"),quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={asset_pair_name:i.id},r=await this.publicGetAssetPairsAssetPairNameTicker(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseTicker(a,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i={};if(void 0!==(e=this.marketSymbols(e))){const t=this.marketIds(e);i.pair_names=t.join(",")}const s=await this.publicGetAssetPairsTickers(this.extend(i,t)),r=this.safeValue(s,"data",[]),a={};for(let e=0;e<r.length;e++){const t=this.parseTicker(r[e]);a[t.symbol]=t}return this.filterByArray(a,"symbol",e)}async fetchTime(e={}){const t=await this.publicGetPing(e),i=this.safeValue(t,"data",{}),s=this.safeInteger(i,"timestamp");return parseInt(s/1e6)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={asset_pair_name:s.id};void 0!==t&&(r.limit=t);const a=await this.publicGetAssetPairsAssetPairNameDepth(this.extend(r,i)),n=this.safeValue(a,"data",{});return this.parseOrderBook(n,s.symbol,void 0,"bids","asks","price","quantity")}parseTrade(e,t){const i=this.parse8601(this.safeString2(e,"created_at","inserted_at")),s=this.safeString(e,"price"),r=this.safeString(e,"amount"),a=this.safeString(e,"asset_pair_name");t=this.safeMarket(a,t,"-");let n=this.safeString(e,"side");const o=this.safeString(e,"taker_side");let h;void 0!==o&&void 0!==n&&"SELF_TRADING"!==n&&(h=o===n?"taker":"maker"),void 0===n?n="ASK"===o?"sell":"buy":"BID"===n?n="buy":"ASK"===n&&(n="sell");const d=this.safeString(e,"maker_order_id"),c=this.safeString(e,"taker_order_id");let l;void 0!==d?l=void 0!==c?[d,c]:d:void 0!==c&&(l=c);const u={id:this.safeString(e,"id"),timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,order:l,type:"limit",side:n,takerOrMaker:h,price:s,amount:r,cost:void 0,info:e};let f,p;void 0!==h?"buy"===n?"maker"===h?(f=t.base,p=t.quote):(f=t.quote,p=t.base):"maker"===h?(f=t.quote,p=t.base):(f=t.base,p=t.quote):"SELF_TRADING"===n&&("BID"===o?(f=t.quote,p=t.base):"ASK"===o&&(f=t.base,p=t.quote));const m=this.safeString(e,"maker_fee"),g=this.safeString(e,"taker_fee");return void 0!==m?void 0!==g?u.fees=[{cost:m,currency:f},{cost:g,currency:p}]:u.fee={cost:m,currency:f}:u.fee=void 0!==g?{cost:g,currency:p}:void 0,this.safeTrade(u,t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={asset_pair_name:r.id},n=await this.publicGetAssetPairsAssetPairNameTrades(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}parseOHLCV(e,t){return[this.parse8601(this.safeString(e,"time")),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);void 0===s&&(s=100);const n={asset_pair_name:a.id,period:this.safeString(this.timeframes,t,t),limit:s};if(void 0!==i){const e=this.parseTimeframe(t),r=this.sum(i,s*e*1e3);n.time=this.iso8601(r)}const o=await this.publicGetAssetPairsAssetPairNameCandles(this.extend(n,r)),h=this.safeValue(o,"data",[]);return this.parseOHLCVs(h,a,t,i,s)}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0},i=this.safeValue(e,"data",[]);for(let e=0;e<i.length;e++){const s=i[e],r=this.safeString(s,"asset_symbol"),a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(s,"balance"),n.used=this.safeString(s,"locked_balance"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=this.safeString(e,"type","");e=this.omit(e,"type");const i="privateGet"+this.capitalize(t)+"Accounts",s=await this[i](e);return this.parseBalance(s)}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"asset_pair_name"),r=this.safeSymbol(s,t,"-"),a=this.parse8601(this.safeString(e,"created_at")),n=this.safeString(e,"price"),o=this.safeString(e,"amount"),h=this.safeString(e,"avg_deal_price"),d=this.safeString(e,"filled_amount"),c=this.parseOrderStatus(this.safeString(e,"state"));let l=this.safeString(e,"side");l="BID"===l?"buy":"sell";const u=this.parse8601(this.safeString(e,"updated_at"));return this.safeOrder({info:e,id:i,clientOrderId:void 0,timestamp:a,datetime:this.iso8601(a),lastTradeTimestamp:u,symbol:r,type:void 0,timeInForce:void 0,postOnly:void 0,side:l,price:n,stopPrice:void 0,triggerPrice:void 0,amount:o,cost:void 0,average:h,filled:d,remaining:void 0,status:c,fee:void 0,trades:void 0},t)}async createOrder(e,t,i,s,r,n={}){await this.loadMarkets();const o=this.market(e);i="buy"===i?"BID":"ASK";const h=t.toUpperCase(),d={asset_pair_name:o.id,side:i,amount:this.amountToPrecision(e,s),type:h};if("LIMIT"===h)d.price=this.priceToPrecision(e,r);else{const t="STOP_LIMIT"===h;if(t||"STOP_MARKET"===h){const t=this.safeNumber2(n,"stop_price","stopPrice");if(void 0===t)throw new a(this.id+" createOrder() requires a stop_price parameter");d.stop_price=this.priceToPrecision(e,t),n=this.omit(n,["stop_price","stopPrice"])}t&&(d.price=this.priceToPrecision(e,r))}const c=await this.privatePostOrders(this.extend(d,n)),l=this.safeValue(c,"data");return this.parseOrder(l,o)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privatePostOrdersIdCancel(this.extend(s,i)),a=this.safeValue(r,"data");return this.parseOrder(a)}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={asset_pair_name:this.market(e).id};return await this.privatePostOrdersCancel(this.extend(i,t))}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privateGetOrdersId(this.extend(s,i)),a=this.safeValue(r,"data",{});return this.parseOrder(a)}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={asset_pair_name:r.id};void 0!==i&&(n.limit=i);const o=await this.privateGetOrders(this.extend(n,s)),h=this.safeValue(o,"data",[]);return this.parseOrders(h,r,t,i)}async fetchMyTrades(e,t,i,s={}){if(await this.loadMarkets(),void 0===e)throw new a(this.id+" fetchMyTrades() requires a symbol argument");const r=this.market(e),n={asset_pair_name:r.id};void 0!==i&&(n.limit=i);const o=await this.privateGetTrades(this.extend(n,s)),h=this.safeValue(o,"data",[]);return this.parseTrades(h,r,t,i)}parseOrderStatus(e){return this.safeString({PENDING:"open",FILLED:"closed",CANCELLED:"canceled"},e)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({state:"PENDING"},s))}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({state:"FILLED"},s))}nonce(){const e=1e6*this.safeInteger(this.options,"exchangeMillisecondsCorrection",0);return 1e3*this.microseconds()+e}sign(e,t="public",i="GET",s={},r,a){const n=this.omit(s,this.extractParams(e));let o=this.implodeHostname(this.urls.api[t])+"/"+this.implodeParams(e,s);if(r={},"public"===t)Object.keys(n).length&&(o+="?"+this.urlencode(n));else{this.checkRequiredCredentials();const e=this.nonce().toString(),t={type:"OpenAPIV2",sub:this.apiKey,nonce:e},s=this.jwt(t,this.encode(this.secret));r.Authorization="Bearer "+s,"GET"===i?Object.keys(n).length&&(o+="?"+this.urlencode(n)):"POST"===i&&(r["Content-Type"]="application/json",a=this.json(n))}return r["User-Agent"]="ccxt/"+this.id+"-"+this.version,{url:o,method:i,body:a,headers:r}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={asset_symbol:this.currency(e).id},s=await this.privateGetAssetsAssetSymbolAddress(this.extend(i,t)),a=this.safeValue(s,"data",[]);if(a.length<1)throw new r(this.id+" fetchDepositAddress() returned empty address response");const n=a[0],o=this.safeString(n,"value"),h=this.safeString(n,"memo");return this.checkAddress(o),{currency:e,address:o,tag:h,network:void 0,info:s}}parseTransactionStatus(e){return this.safeString({WITHHOLD:"ok",UNCONFIRMED:"pending",CONFIRMED:"ok",COMPLETED:"ok",PENDING:"pending"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"asset_symbol"),s=this.safeCurrencyCode(i),r=this.safeInteger(e,"id"),a=this.safeNumber(e,"amount"),n=this.parseTransactionStatus(this.safeString(e,"state")),o=this.parse8601(this.safeString(e,"inserted_at")),h=this.parse8601(this.safeString2(e,"updated_at","completed_at")),d=this.safeString(e,"txid"),c=this.safeString(e,"target_address"),l=this.safeString(e,"memo"),u="customer_id"in e?"deposit":"withdrawal";return{info:e,id:r,txid:d,timestamp:o,datetime:this.iso8601(o),network:void 0,addressFrom:void 0,address:void 0,addressTo:c,tagFrom:void 0,tag:l,tagTo:void 0,type:u,amount:a,currency:s,status:n,updated:h,fee:void 0}}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.asset_symbol=a.id),void 0!==i&&(r.limit=i);const n=await this.privateGetDeposits(this.extend(r,s)),o=this.safeValue(n,"data",[]);return this.parseTransactions(o,a,t,i)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.asset_symbol=a.id),void 0!==i&&(r.limit=i);const n=await this.privateGetWithdrawals(this.extend(r,s)),o=this.safeValue(n,"data",[]);return this.parseTransactions(o,a,t,i)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n=this.safeValue(this.options,"accountsByType",{}),o=this.safeString(n,i,i),h=this.safeString(n,s,s),d=this.safeString(r,"guid",this.uuid()),c={symbol:a.id,amount:this.currencyToPrecision(e,t),from:o,to:h,guid:d},l=await this.privatePostTransfer(this.extend(c,r)),u=this.parseTransfer(l,a),f=this.safeValue(this.options,"transfer",{});return this.safeValue(f,"fillResponseFromRequest",!0)&&(u.fromAccount=i,u.toAccount=s,u.amount=t,u.id=d),u}parseTransfer(e,t){const i=this.safeNumber(e,"code");return{info:e,id:void 0,timestamp:void 0,datetime:void 0,currency:i,amount:void 0,fromAccount:void 0,toAccount:void 0,status:this.parseTransferStatus(i)}}parseTransferStatus(e){return this.safeString({0:"ok"},e,"failed")}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets();const a=this.currency(e),n={symbol:a.id,target_address:i,amount:this.currencyToPrecision(e,t)};void 0!==s&&(n.memo=s);const o=await this.privatePostWithdrawals(this.extend(n,r)),h=this.safeValue(o,"data",{});return this.parseTransaction(h,a)}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;const c=this.safeString(o,"code"),l=this.safeString(o,"message");if("0"!==c){const e=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,l,e),this.throwExactlyMatchedException(this.exceptions.exact,c,e),this.throwBroadlyMatchedException(this.exceptions.broad,l,e),new r(e)}}}},96056:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,ExchangeNotAvailable:n,InsufficientFunds:o,OrderNotFound:h,InvalidOrder:d,DDoSProtection:c,InvalidNonce:l,AuthenticationError:u,RateLimitExceeded:f,PermissionDenied:p,NotSupported:m,BadRequest:g,BadSymbol:y,AccountSuspended:b,OrderImmediatelyFillable:v,OnMaintenance:w,BadResponse:S,RequestTimeout:k,OrderNotFillable:T,MarginModeAlreadySet:_}=i(73449),{TRUNCATE:O,DECIMAL_PLACES:M}=i(62115),I=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"binance",name:"Binance",countries:["JP","MT"],rateLimit:50,certified:!0,pro:!0,has:{CORS:void 0,spot:!0,margin:!0,swap:!0,future:!0,option:void 0,addMargin:!0,borrowMargin:!0,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:void 0,createDepositAddress:!1,createOrder:!0,createPostOnlyOrder:!0,createReduceOnlyOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!1,createStopOrder:!0,editOrder:!0,fetchAccounts:void 0,fetchBalance:!0,fetchBidsAsks:!0,fetchBorrowInterest:!0,fetchBorrowRate:!0,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!0,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchCanceledOrders:!1,fetchClosedOrder:!1,fetchClosedOrders:"emulated",fetchCurrencies:!0,fetchDeposit:!1,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDepositAddressesByNetwork:!1,fetchDeposits:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:!0,fetchFundingRate:!0,fetchFundingRateHistory:!0,fetchFundingRates:!0,fetchIndexOHLCV:!0,fetchL3OrderBook:!1,fetchLedger:void 0,fetchLeverage:!1,fetchLeverageTiers:!0,fetchMarketLeverageTiers:"emulated",fetchMarkets:!0,fetchMarkOHLCV:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!0,fetchOpenOrder:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderBooks:!1,fetchOrders:!0,fetchOrderTrades:!0,fetchPosition:void 0,fetchPositions:!0,fetchPositionsRisk:!0,fetchPremiumIndexOHLCV:!1,fetchStatus:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!0,fetchTradingLimits:void 0,fetchTransactionFee:void 0,fetchTransactionFees:!0,fetchTransactions:!1,fetchTransfers:!0,fetchWithdrawal:!1,fetchWithdrawals:!0,fetchWithdrawalWhitelist:!1,reduceMargin:!0,repayMargin:!0,setLeverage:!0,setMargin:!1,setMarginMode:!0,setPositionMode:!0,signIn:!1,transfer:!0,withdraw:!0},timeframes:{"1s":"1s","1m":"1m","3m":"3m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","2h":"2h","4h":"4h","6h":"6h","8h":"8h","12h":"12h","1d":"1d","3d":"3d","1w":"1w","1M":"1M"},urls:{logo:"https://user-images.githubusercontent.com/1294454/29604020-d5483cdc-87ee-11e7-94c7-d1a8d9169293.jpg",test:{dapiPublic:"https://testnet.binancefuture.com/dapi/v1",dapiPrivate:"https://testnet.binancefuture.com/dapi/v1",dapiPrivateV2:"https://testnet.binancefuture.com/dapi/v2",eapiPublic:"https://testnet.binanceops.com/eapi/v1",eapiPrivate:"https://testnet.binanceops.com/eapi/v1",fapiPublic:"https://testnet.binancefuture.com/fapi/v1",fapiPrivate:"https://testnet.binancefuture.com/fapi/v1",fapiPrivateV2:"https://testnet.binancefuture.com/fapi/v2",public:"https://testnet.binance.vision/api/v3",private:"https://testnet.binance.vision/api/v3",v1:"https://testnet.binance.vision/api/v1"},api:{wapi:"https://api.binance.com/wapi/v3",sapi:"https://api.binance.com/sapi/v1",sapiV2:"https://api.binance.com/sapi/v2",sapiV3:"https://api.binance.com/sapi/v3",dapiPublic:"https://dapi.binance.com/dapi/v1",dapiPrivate:"https://dapi.binance.com/dapi/v1",eapiPublic:"https://eapi.binance.com/eapi/v1",eapiPrivate:"https://eapi.binance.com/eapi/v1",dapiPrivateV2:"https://dapi.binance.com/dapi/v2",dapiData:"https://dapi.binance.com/futures/data",fapiPublic:"https://fapi.binance.com/fapi/v1",fapiPrivate:"https://fapi.binance.com/fapi/v1",fapiData:"https://fapi.binance.com/futures/data",fapiPrivateV2:"https://fapi.binance.com/fapi/v2",public:"https://api.binance.com/api/v3",private:"https://api.binance.com/api/v3",v1:"https://api.binance.com/api/v1"},www:"https://www.binance.com",referral:{url:"https://accounts.binance.com/en/register?ref=D7YA7CLY",discount:.1},doc:["https://binance-docs.github.io/apidocs/spot/en"],api_management:"https://www.binance.com/en/usercenter/settings/api-management",fees:"https://www.binance.com/en/fee/schedule"},api:{sapi:{get:{"system/status":.1,accountSnapshot:240,"margin/asset":1,"margin/pair":1,"margin/allAssets":.1,"margin/allPairs":.1,"margin/priceIndex":1,"asset/assetDividend":1,"asset/dribblet":.1,"asset/transfer":.1,"asset/assetDetail":.1,"asset/tradeFee":.1,"asset/ledger-transfer/cloud-mining/queryByPage":4,"margin/loan":1,"margin/repay":1,"margin/account":1,"margin/transfer":.1,"margin/interestHistory":.1,"margin/forceLiquidationRec":.1,"margin/order":1,"margin/openOrders":1,"margin/allOrders":20,"margin/myTrades":1,"margin/maxBorrowable":5,"margin/maxTransferable":5,"margin/tradeCoeff":1,"margin/isolated/transfer":.1,"margin/isolated/account":1,"margin/isolated/pair":1,"margin/isolated/allPairs":1,"margin/isolated/accountLimit":.1,"margin/interestRateHistory":.1,"margin/orderList":1,"margin/allOrderList":20,"margin/openOrderList":1,"margin/crossMarginData":{cost:.1,noCoin:.5},"margin/isolatedMarginData":{cost:.1,noCoin:1},"margin/isolatedMarginTier":.1,"margin/rateLimit/order":2,"margin/dribblet":.1,"margin/crossMarginCollateralRatio":10,"margin/exchange-small-liability":.6667,"margin/exchange-small-liability-history":.6667,"loan/income":40,"loan/ongoing/orders":40,"loan/ltv/adjustment/history":40,"loan/borrow/history":40,"loan/repay/history":40,"loan/loanable/data":40,"loan/collateral/data":40,"loan/repay/collateral/rate":600,"loan/vip/ongoing/orders":40,"loan/vip/repay/history":40,"loan/vip/collateral/account":600,"fiat/orders":600.03,"fiat/payments":.1,"futures/transfer":1,"futures/loan/borrow/history":1,"futures/loan/repay/history":1,"futures/loan/wallet":1,"futures/loan/adjustCollateral/history":1,"futures/loan/liquidationHistory":1,"rebate/taxQuery":20.001,"capital/config/getall":1,"capital/deposit/address":1,"capital/deposit/hisrec":.1,"capital/deposit/subAddress":.1,"capital/deposit/subHisrec":.1,"capital/withdraw/history":.1,"capital/contract/convertible-coins":4.0002,"convert/tradeFlow":.6667,"convert/exchangeInfo":50,"convert/assetInfo":10,"convert/orderStatus":.6667,"account/status":.1,"account/apiTradingStatus":.1,"account/apiRestrictions/ipRestriction":.1,bnbBurn:.1,"sub-account/futures/account":1,"sub-account/futures/accountSummary":.1,"sub-account/futures/positionRisk":1,"sub-account/futures/internalTransfer":.1,"sub-account/list":.1,"sub-account/margin/account":1,"sub-account/margin/accountSummary":1,"sub-account/spotSummary":.1,"sub-account/status":1,"sub-account/sub/transfer/history":.1,"sub-account/transfer/subUserHistory":.1,"sub-account/universalTransfer":.1,"sub-account/apiRestrictions/ipRestriction/thirdPartyList":1,"managed-subaccount/asset":.1,"managed-subaccount/accountSnapshot":240,"managed-subaccount/queryTransLogForInvestor":.1,"managed-subaccount/queryTransLogForTradeParent":.1,"managed-subaccount/fetch-future-asset":.1,"managed-subaccount/marginAsset":.1,"lending/daily/product/list":.1,"lending/daily/userLeftQuota":.1,"lending/daily/userRedemptionQuota":.1,"lending/daily/token/position":.1,"lending/union/account":.1,"lending/union/purchaseRecord":.1,"lending/union/redemptionRecord":.1,"lending/union/interestHistory":.1,"lending/project/list":.1,"lending/project/position/list":.1,"mining/pub/algoList":.1,"mining/pub/coinList":.1,"mining/worker/detail":.5,"mining/worker/list":.5,"mining/payment/list":.5,"mining/statistics/user/status":.5,"mining/statistics/user/list":.5,"mining/payment/uid":.5,"bswap/pools":.1,"bswap/liquidity":{cost:.1,noPoolId:1},"bswap/liquidityOps":20.001,"bswap/quote":1.00005,"bswap/swap":20.001,"bswap/poolConfigure":1.00005,"bswap/addLiquidityPreview":1.00005,"bswap/removeLiquidityPreview":1.00005,"bswap/unclaimedRewards":6.667,"bswap/claimedHistory":6.667,"blvt/tokenInfo":.1,"blvt/subscribe/record":.1,"blvt/redeem/record":.1,"blvt/userLimit":.1,"apiReferral/ifNewUser":1,"apiReferral/customization":1,"apiReferral/userCustomization":1,"apiReferral/rebate/recentRecord":1,"apiReferral/rebate/historicalRecord":1,"apiReferral/kickback/recentRecord":1,"apiReferral/kickback/historicalRecord":1,"broker/subAccountApi":1,"broker/subAccount":1,"broker/subAccountApi/commission/futures":1,"broker/subAccountApi/commission/coinFutures":1,"broker/info":1,"broker/transfer":1,"broker/transfer/futures":1,"broker/rebate/recentRecord":1,"broker/rebate/historicalRecord":1,"broker/subAccount/bnbBurn/status":1,"broker/subAccount/depositHist":1,"broker/subAccount/spotSummary":1,"broker/subAccount/marginSummary":1,"broker/subAccount/futuresSummary":1,"broker/rebate/futures/recentRecord":1,"broker/subAccountApi/ipRestriction":1,"broker/universalTransfer":1,"account/apiRestrictions":.1,"c2c/orderMatch/listUserOrderHistory":.1,"nft/history/transactions":20.001,"nft/history/deposit":20.001,"nft/history/withdraw":20.001,"nft/user/getAsset":20.001,"pay/transactions":20.001,"giftcard/verify":.1,"giftcard/cryptography/rsa-public-key":.1,"giftcard/buyCode/token-limit":.1,"algo/futures/openOrders":.1,"algo/futures/historicalOrders":.1,"algo/futures/subOrders":.1,"portfolio/account":.1,"portfolio/collateralRate":5,"portfolio/pmLoan":3.3335,"staking/productList":.1,"staking/position":.1,"staking/stakingRecord":.1,"staking/personalLeftQuota":.1},post:{"asset/dust":1,"asset/dust-btc":.1,"asset/transfer":.1,"asset/get-funding-asset":.1,"asset/convert-transfer":.033335,"asset/convert-transfer/queryByPage":.033335,"account/disableFastWithdrawSwitch":.1,"account/enableFastWithdrawSwitch":.1,"capital/withdraw/apply":4.0002,"capital/contract/convertible-coins":4.0002,"margin/transfer":1,"margin/loan":20.001,"margin/repay":20.001,"margin/order":.040002,"margin/order/oco":.040002,"margin/exchange-small-liability":20.001,"margin/isolated/transfer":4.0002,"margin/isolated/account":2.0001,bnbBurn:.1,"sub-account/virtualSubAccount":.1,"sub-account/margin/transfer":4.0002,"sub-account/margin/enable":.1,"sub-account/futures/enable":.1,"sub-account/futures/transfer":.1,"sub-account/futures/internalTransfer":.1,"sub-account/transfer/subToSub":.1,"sub-account/transfer/subToMaster":.1,"sub-account/universalTransfer":.1,"managed-subaccount/deposit":.1,"managed-subaccount/withdraw":.1,userDataStream:.1,"userDataStream/isolated":.1,"futures/transfer":.1,"lending/customizedFixed/purchase":.1,"lending/daily/purchase":.1,"lending/daily/redeem":.1,"bswap/liquidityAdd":60,"bswap/liquidityRemove":60,"bswap/swap":60,"bswap/claimRewards":6.667,"blvt/subscribe":.1,"blvt/redeem":.1,"apiReferral/customization":1,"apiReferral/userCustomization":1,"apiReferral/rebate/historicalRecord":1,"apiReferral/kickback/historicalRecord":1,"broker/subAccount":1,"broker/subAccount/margin":1,"broker/subAccount/futures":1,"broker/subAccountApi":1,"broker/subAccountApi/permission":1,"broker/subAccountApi/commission":1,"broker/subAccountApi/commission/futures":1,"broker/subAccountApi/commission/coinFutures":1,"broker/transfer":1,"broker/transfer/futures":1,"broker/rebate/historicalRecord":1,"broker/subAccount/bnbBurn/spot":1,"broker/subAccount/bnbBurn/marginInterest":1,"broker/subAccount/blvt":1,"broker/subAccountApi/ipRestriction":1,"broker/subAccountApi/ipRestriction/ipList":1,"broker/universalTransfer":1,"broker/subAccountApi/permission/universalTransfer":1,"broker/subAccountApi/permission/vanillaOptions":1,"giftcard/createCode":.1,"giftcard/redeemCode":.1,"giftcard/buyCode":.1,"algo/futures/newOrderVp":20.001,"algo/futures/newOrderTwap":20.001,"staking/purchase":.1,"staking/redeem":.1,"staking/setAutoStaking":.1,"portfolio/repay":20.001,"loan/borrow":40,"loan/repay":40,"loan/adjust/ltv":40,"loan/customize/margin_call":40,"loan/vip/repay":40,"convert/getQuote":20.001,"convert/acceptQuote":3.3335},put:{userDataStream:.1,"userDataStream/isolated":.1},delete:{"margin/openOrders":.1,"margin/order":.0066667,"margin/orderList":.0066667,"margin/isolated/account":2.0001,userDataStream:.1,"userDataStream/isolated":.1,"broker/subAccountApi":1,"broker/subAccountApi/ipRestriction/ipList":1,"algo/futures/order":.1}},sapiV2:{get:{"sub-account/futures/account":.1,"sub-account/futures/positionRisk":.1}},sapiV3:{get:{"sub-account/assets":1},post:{"asset/getUserAsset":.5}},wapi:{post:{withdraw:1,"sub-account/transfer":1},get:{depositHistory:1,withdrawHistory:1,depositAddress:1,accountStatus:1,systemStatus:1,apiTradingStatus:1,userAssetDribbletLog:1,tradeFee:1,assetDetail:1,"sub-account/list":1,"sub-account/transfer/history":1,"sub-account/assets":1}},dapiPublic:{get:{ping:1,time:1,exchangeInfo:1,depth:{cost:2,byLimit:[[50,2],[100,5],[500,10],[1e3,20]]},trades:5,historicalTrades:20,aggTrades:20,premiumIndex:10,fundingRate:1,klines:{cost:1,byLimit:[[99,1],[499,2],[1e3,5],[1e4,10]]},continuousKlines:{cost:1,byLimit:[[99,1],[499,2],[1e3,5],[1e4,10]]},indexPriceKlines:{cost:1,byLimit:[[99,1],[499,2],[1e3,5],[1e4,10]]},markPriceKlines:{cost:1,byLimit:[[99,1],[499,2],[1e3,5],[1e4,10]]},"ticker/24hr":{cost:1,noSymbol:40},"ticker/price":{cost:1,noSymbol:2},"ticker/bookTicker":{cost:1,noSymbol:2},openInterest:1,pmExchangeInfo:1}},dapiData:{get:{openInterestHist:1,topLongShortAccountRatio:1,topLongShortPositionRatio:1,globalLongShortAccountRatio:1,takerBuySellVol:1,basis:1}},dapiPrivate:{get:{"positionSide/dual":30,order:1,openOrder:1,openOrders:{cost:1,noSymbol:5},allOrders:{cost:20,noSymbol:40},balance:1,account:5,"positionMargin/history":1,positionRisk:1,userTrades:{cost:20,noSymbol:40},income:20,leverageBracket:1,forceOrders:{cost:20,noSymbol:50},adlQuantile:5,orderAmendment:1,pmAccountInfo:5},post:{"positionSide/dual":1,order:4,batchOrders:5,countdownCancelAll:10,leverage:1,marginType:1,positionMargin:1,listenKey:1},put:{listenKey:1,order:1,batchOrders:5},delete:{order:1,allOpenOrders:1,batchOrders:5,listenKey:1}},dapiPrivateV2:{get:{leverageBracket:1}},fapiPublic:{get:{ping:1,time:1,exchangeInfo:1,depth:{cost:2,byLimit:[[50,2],[100,5],[500,10],[1e3,20]]},trades:5,historicalTrades:20,aggTrades:20,klines:{cost:1,byLimit:[[99,1],[499,2],[1e3,5],[1e4,10]]},continuousKlines:{cost:1,byLimit:[[99,1],[499,2],[1e3,5],[1e4,10]]},markPriceKlines:{cost:1,byLimit:[[99,1],[499,2],[1e3,5],[1e4,10]]},indexPriceKlines:{cost:1,byLimit:[[99,1],[499,2],[1e3,5],[1e4,10]]},fundingRate:1,premiumIndex:1,"ticker/24hr":{cost:1,noSymbol:40},"ticker/price":{cost:1,noSymbol:2},"ticker/bookTicker":{cost:1,noSymbol:2},openInterest:1,indexInfo:1,apiTradingStatus:{cost:1,noSymbol:10},lvtKlines:1,pmExchangeInfo:1}},fapiData:{get:{openInterestHist:1,topLongShortAccountRatio:1,topLongShortPositionRatio:1,globalLongShortAccountRatio:1,takerlongshortRatio:1}},fapiPrivate:{get:{forceOrders:{cost:20,noSymbol:50},allOrders:5,openOrder:1,openOrders:1,order:1,account:5,balance:5,leverageBracket:1,"positionMargin/history":1,positionRisk:5,"positionSide/dual":30,userTrades:5,income:30,commissionRate:20,apiTradingStatus:1,multiAssetsMargin:30,"apiReferral/ifNewUser":1,"apiReferral/customization":1,"apiReferral/userCustomization":1,"apiReferral/traderNum":1,"apiReferral/overview":1,"apiReferral/tradeVol":1,"apiReferral/rebateVol":1,"apiReferral/traderSummary":1,adlQuantile:5,pmAccountInfo:5},post:{batchOrders:5,"positionSide/dual":1,positionMargin:1,marginType:1,order:4,leverage:1,listenKey:1,countdownCancelAll:10,multiAssetsMargin:1,"apiReferral/customization":1,"apiReferral/userCustomization":1},put:{listenKey:1},delete:{batchOrders:1,order:1,allOpenOrders:1,listenKey:1}},fapiPrivateV2:{get:{account:1,balance:1,positionRisk:1}},eapiPublic:{get:{ping:1,time:1,exchangeInfo:1,index:1,ticker:5,mark:5,depth:1,klines:1,trades:5,historicalTrades:20,exerciseHistory:3,openInterest:3}},eapiPrivate:{get:{account:3,position:5,openOrders:{cost:1,noSymbol:40},historyOrders:3,userTrades:5,exerciseRecord:5,bill:1,marginAccount:3,mmp:1,countdownCancelAll:1,order:1},post:{order:1,batchOrders:5,listenKey:1,mmpSet:1,mmpReset:1,countdownCancelAll:1,countdownCancelAllHeartBeat:10},put:{listenKey:1},delete:{order:1,batchOrders:1,allOpenOrders:1,allOpenOrdersByUnderlying:1,listenKey:1}},public:{get:{ping:1,time:1,depth:{cost:1,byLimit:[[100,1],[500,5],[1e3,10],[5e3,50]]},trades:1,aggTrades:1,historicalTrades:5,klines:1,"ticker/24hr":{cost:1,noSymbol:40},"ticker/price":{cost:1,noSymbol:2},"ticker/bookTicker":{cost:1,noSymbol:2},exchangeInfo:10},put:{userDataStream:1},post:{userDataStream:1},delete:{userDataStream:1}},private:{get:{allOrderList:10,openOrderList:3,orderList:2,order:2,openOrders:{cost:3,noSymbol:40},allOrders:10,account:10,myTrades:10,"rateLimit/order":20,myPreventedMatches:1},post:{"order/oco":1,order:1,"order/cancelReplace":1,"order/test":1},delete:{openOrders:1,orderList:1,order:1}}},fees:{trading:{feeSide:"get",tierBased:!1,percentage:!0,taker:this.parseNumber("0.001"),maker:this.parseNumber("0.001")},linear:{trading:{feeSide:"quote",tierBased:!0,percentage:!0,taker:this.parseNumber("0.000400"),maker:this.parseNumber("0.000200"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.000400")],[this.parseNumber("250"),this.parseNumber("0.000400")],[this.parseNumber("2500"),this.parseNumber("0.000350")],[this.parseNumber("7500"),this.parseNumber("0.000320")],[this.parseNumber("22500"),this.parseNumber("0.000300")],[this.parseNumber("50000"),this.parseNumber("0.000270")],[this.parseNumber("100000"),this.parseNumber("0.000250")],[this.parseNumber("200000"),this.parseNumber("0.000220")],[this.parseNumber("400000"),this.parseNumber("0.000200")],[this.parseNumber("750000"),this.parseNumber("0.000170")]],maker:[[this.parseNumber("0"),this.parseNumber("0.000200")],[this.parseNumber("250"),this.parseNumber("0.000160")],[this.parseNumber("2500"),this.parseNumber("0.000140")],[this.parseNumber("7500"),this.parseNumber("0.000120")],[this.parseNumber("22500"),this.parseNumber("0.000100")],[this.parseNumber("50000"),this.parseNumber("0.000080")],[this.parseNumber("100000"),this.parseNumber("0.000060")],[this.parseNumber("200000"),this.parseNumber("0.000040")],[this.parseNumber("400000"),this.parseNumber("0.000020")],[this.parseNumber("750000"),this.parseNumber("0")]]}}},inverse:{trading:{feeSide:"base",tierBased:!0,percentage:!0,taker:this.parseNumber("0.000500"),maker:this.parseNumber("0.000100"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.000500")],[this.parseNumber("250"),this.parseNumber("0.000450")],[this.parseNumber("2500"),this.parseNumber("0.000400")],[this.parseNumber("7500"),this.parseNumber("0.000300")],[this.parseNumber("22500"),this.parseNumber("0.000250")],[this.parseNumber("50000"),this.parseNumber("0.000240")],[this.parseNumber("100000"),this.parseNumber("0.000240")],[this.parseNumber("200000"),this.parseNumber("0.000240")],[this.parseNumber("400000"),this.parseNumber("0.000240")],[this.parseNumber("750000"),this.parseNumber("0.000240")]],maker:[[this.parseNumber("0"),this.parseNumber("0.000100")],[this.parseNumber("250"),this.parseNumber("0.000080")],[this.parseNumber("2500"),this.parseNumber("0.000050")],[this.parseNumber("7500"),this.parseNumber("0.0000030")],[this.parseNumber("22500"),this.parseNumber("0")],[this.parseNumber("50000"),this.parseNumber("-0.000050")],[this.parseNumber("100000"),this.parseNumber("-0.000060")],[this.parseNumber("200000"),this.parseNumber("-0.000070")],[this.parseNumber("400000"),this.parseNumber("-0.000080")],[this.parseNumber("750000"),this.parseNumber("-0.000090")]]}}},option:{}},commonCurrencies:{BCC:"BCC",YOYO:"YOYOW"},precisionMode:M,options:{fetchMarkets:["spot","linear","inverse","option"],fetchCurrencies:!0,defaultTimeInForce:"GTC",defaultType:"spot",defaultSubType:void 0,hasAlreadyAuthenticatedSuccessfully:!1,warnOnFetchOpenOrdersWithoutSymbol:!0,throwMarginModeAlreadySet:!1,fetchPositions:"positionRisk",recvWindow:1e4,timeDifference:0,adjustForTimeDifference:!1,newOrderRespType:{market:"FULL",limit:"FULL"},quoteOrderQty:!0,broker:{spot:"x-R4BD3S82",margin:"x-R4BD3S82",future:"x-xcKtGhcu",delivery:"x-xcKtGhcu"},accountsByType:{main:"MAIN",spot:"MAIN",funding:"FUNDING",margin:"MARGIN",cross:"MARGIN",future:"UMFUTURE",delivery:"CMFUTURE",linear:"UMFUTURE",inverse:"CMFUTURE"},accountsById:{MAIN:"spot",FUNDING:"funding",MARGIN:"margin",UMFUTURE:"linear",CMFUTURE:"inverse"},networks:{ERC20:"ETH",TRC20:"TRX",BEP2:"BNB",BEP20:"BSC",OMNI:"OMNI",EOS:"EOS",SPL:"SOL"},reverseNetworks:{"tronscan.org":"TRC20","etherscan.io":"ERC20","bscscan.com":"BSC","explorer.binance.org":"BEP2","bithomp.com":"XRP","bloks.io":"EOS","stellar.expert":"XLM","blockchair.com/bitcoin":"BTC","blockchair.com/bitcoin-cash":"BCH","blockchair.com/ecash":"XEC","explorer.litecoin.net":"LTC","explorer.avax.network":"AVAX","solscan.io":"SOL","polkadot.subscan.io":"DOT","dashboard.internetcomputer.org":"ICP","explorer.chiliz.com":"CHZ","cardanoscan.io":"ADA","mainnet.theoan.com":"AION","algoexplorer.io":"ALGO","explorer.ambrosus.com":"AMB","viewblock.io/zilliqa":"ZIL","viewblock.io/arweave":"AR","explorer.ark.io":"ARK","atomscan.com":"ATOM","www.mintscan.io":"CTK","explorer.bitcoindiamond.org":"BCD","btgexplorer.com":"BTG","bts.ai":"BTS","explorer.celo.org":"CELO","explorer.nervos.org":"CKB","cerebro.cortexlabs.ai":"CTXC","chainz.cryptoid.info":"VIA","explorer.dcrdata.org":"DCR","digiexplorer.info":"DGB","dock.subscan.io":"DOCK","dogechain.info":"DOGE","explorer.elrond.com":"EGLD","blockscout.com":"ETC","explore-fetchhub.fetch.ai":"FET","filfox.info":"FIL","fio.bloks.io":"FIO","explorer.firo.org":"FIRO","neoscan.io":"NEO","ftmscan.com":"FTM","explorer.gochain.io":"GO","block.gxb.io":"GXS","hash-hash.info":"HBAR","www.hiveblockexplorer.com":"HIVE","explorer.helium.com":"HNT","tracker.icon.foundation":"ICX","www.iostabc.com":"IOST","explorer.iota.org":"IOTA","iotexscan.io":"IOTX","irishub.iobscan.io":"IRIS","kava.mintscan.io":"KAVA","scope.klaytn.com":"KLAY","kmdexplorer.io":"KMD","kusama.subscan.io":"KSM","explorer.lto.network":"LTO","polygonscan.com":"POLYGON","explorer.ont.io":"ONT","minaexplorer.com":"MINA","nanolooker.com":"NANO","explorer.nebulas.io":"NAS","explorer.nbs.plus":"NBS","explorer.nebl.io":"NEBL","nulscan.io":"NULS","nxscan.com":"NXS","explorer.harmony.one":"ONE","explorer.poa.network":"POA","qtum.info":"QTUM","explorer.rsk.co":"RSK","www.oasisscan.com":"ROSE","ravencoin.network":"RVN","sc.tokenview.com":"SC","secretnodes.com":"SCRT","explorer.skycoin.com":"SKY","steemscan.com":"STEEM","explorer.stacks.co":"STX","www.thetascan.io":"THETA","scan.tomochain.com":"TOMO","explore.vechain.org":"VET","explorer.vite.net":"VITE","www.wanscan.org":"WAN","wavesexplorer.com":"WAVES","wax.eosx.io":"WAXP","waltonchain.pro":"WTC","chain.nem.ninja":"XEM","verge-blockchain.info":"XVG","explorer.yoyow.org":"YOYOW","explorer.zcha.in":"ZEC","explorer.zensystem.io":"ZEN"},networksById:{"tronscan.org":"TRC20","etherscan.io":"ERC20","bscscan.com":"BSC","explorer.binance.org":"BEP2","bithomp.com":"XRP","bloks.io":"EOS","stellar.expert":"XLM","blockchair.com/bitcoin":"BTC","blockchair.com/bitcoin-cash":"BCH","blockchair.com/ecash":"XEC","explorer.litecoin.net":"LTC","explorer.avax.network":"AVAX","solscan.io":"SOL","polkadot.subscan.io":"DOT","dashboard.internetcomputer.org":"ICP","explorer.chiliz.com":"CHZ","cardanoscan.io":"ADA","mainnet.theoan.com":"AION","algoexplorer.io":"ALGO","explorer.ambrosus.com":"AMB","viewblock.io/zilliqa":"ZIL","viewblock.io/arweave":"AR","explorer.ark.io":"ARK","atomscan.com":"ATOM","www.mintscan.io":"CTK","explorer.bitcoindiamond.org":"BCD","btgexplorer.com":"BTG","bts.ai":"BTS","explorer.celo.org":"CELO","explorer.nervos.org":"CKB","cerebro.cortexlabs.ai":"CTXC","chainz.cryptoid.info":"VIA","explorer.dcrdata.org":"DCR","digiexplorer.info":"DGB","dock.subscan.io":"DOCK","dogechain.info":"DOGE","explorer.elrond.com":"EGLD","blockscout.com":"ETC","explore-fetchhub.fetch.ai":"FET","filfox.info":"FIL","fio.bloks.io":"FIO","explorer.firo.org":"FIRO","neoscan.io":"NEO","ftmscan.com":"FTM","explorer.gochain.io":"GO","block.gxb.io":"GXS","hash-hash.info":"HBAR","www.hiveblockexplorer.com":"HIVE","explorer.helium.com":"HNT","tracker.icon.foundation":"ICX","www.iostabc.com":"IOST","explorer.iota.org":"IOTA","iotexscan.io":"IOTX","irishub.iobscan.io":"IRIS","kava.mintscan.io":"KAVA","scope.klaytn.com":"KLAY","kmdexplorer.io":"KMD","kusama.subscan.io":"KSM","explorer.lto.network":"LTO","polygonscan.com":"POLYGON","explorer.ont.io":"ONT","minaexplorer.com":"MINA","nanolooker.com":"NANO","explorer.nebulas.io":"NAS","explorer.nbs.plus":"NBS","explorer.nebl.io":"NEBL","nulscan.io":"NULS","nxscan.com":"NXS","explorer.harmony.one":"ONE","explorer.poa.network":"POA","qtum.info":"QTUM","explorer.rsk.co":"RSK","www.oasisscan.com":"ROSE","ravencoin.network":"RVN","sc.tokenview.com":"SC","secretnodes.com":"SCRT","explorer.skycoin.com":"SKY","steemscan.com":"STEEM","explorer.stacks.co":"STX","www.thetascan.io":"THETA","scan.tomochain.com":"TOMO","explore.vechain.org":"VET","explorer.vite.net":"VITE","www.wanscan.org":"WAN","wavesexplorer.com":"WAVES","wax.eosx.io":"WAXP","waltonchain.pro":"WTC","chain.nem.ninja":"XEM","verge-blockchain.info":"XVG","explorer.yoyow.org":"YOYOW","explorer.zcha.in":"ZEC","explorer.zensystem.io":"ZEN"},impliedNetworks:{ETH:{ERC20:"ETH"},TRX:{TRC20:"TRX"}},legalMoney:{MXN:!0,UGX:!0,SEK:!0,CHF:!0,VND:!0,AED:!0,DKK:!0,KZT:!0,HUF:!0,PEN:!0,PHP:!0,USD:!0,TRY:!0,EUR:!0,NGN:!0,PLN:!0,BRL:!0,ZAR:!0,KES:!0,ARS:!0,RUB:!0,AUD:!0,NOK:!0,CZK:!0,GBP:!0,UAH:!0,GHS:!0,HKD:!0,CAD:!0,INR:!0,JPY:!0,NZD:!0},legalMoneyCurrenciesById:{BUSD:"USD"}},exceptions:{exact:{"System is under maintenance.":w,"System abnormality":r,"You are not authorized to execute this request.":p,"API key does not exist":u,"Order would trigger immediately.":v,"Stop price would trigger immediately.":v,"Order would immediately match and take.":v,"Account has insufficient balance for requested action.":o,"Rest API trading is not enabled.":n,"You don't have permission.":p,"Market is closed.":n,"Too many requests. Please try again later.":c,"This action is disabled on this account.":b,"This type of sub-account exceeds the maximum number limit":g,"This symbol is not permitted for this account.":p,"-1000":n,"-1001":n,"-1002":u,"-1003":f,"-1004":c,"-1005":p,"-1006":S,"-1007":k,"-1010":S,"-1011":p,"-1013":d,"-1014":d,"-1015":f,"-1016":n,"-1020":g,"-1021":l,"-1022":u,"-1023":g,"-1099":u,"-1100":g,"-1101":g,"-1102":g,"-1103":g,"-1104":g,"-1105":g,"-1106":g,"-1108":g,"-1109":u,"-1110":g,"-1111":g,"-1112":d,"-1113":g,"-1114":g,"-1115":g,"-1116":g,"-1117":g,"-1118":g,"-1119":g,"-1120":g,"-1121":y,"-1125":u,"-1127":g,"-1128":g,"-1130":g,"-1131":g,"-1135":g,"-1136":g,"-2008":u,"-2010":r,"-2011":h,"-2013":h,"-2014":u,"-2015":u,"-2016":g,"-2018":o,"-2019":o,"-2020":T,"-2021":v,"-2022":d,"-2023":o,"-2024":o,"-2025":d,"-2026":d,"-2027":d,"-2028":o,"-3000":r,"-3001":u,"-3002":y,"-3003":g,"-3004":r,"-3005":o,"-3006":o,"-3007":r,"-3008":o,"-3009":g,"-3010":g,"-3011":g,"-3012":o,"-3013":g,"-3014":b,"-3015":g,"-3016":g,"-3017":r,"-3018":b,"-3019":b,"-3020":o,"-3021":g,"-3022":b,"-3023":g,"-3024":r,"-3025":g,"-3026":g,"-3027":y,"-3028":y,"-3029":r,"-3036":b,"-3037":r,"-3038":g,"-3041":o,"-3042":g,"-3043":g,"-3044":c,"-3045":r,"-3999":r,"-4001":g,"-4002":g,"-4003":g,"-4004":u,"-4005":f,"-4006":g,"-4007":g,"-4008":g,"-4010":g,"-4011":g,"-4012":g,"-4013":u,"-4014":p,"-4015":r,"-4016":p,"-4017":p,"-4018":y,"-4019":y,"-4021":g,"-4022":g,"-4023":r,"-4024":o,"-4025":o,"-4026":o,"-4027":r,"-4028":g,"-4029":g,"-4030":r,"-4031":r,"-4032":r,"-4033":g,"-4034":r,"-4035":p,"-4036":g,"-4037":r,"-4038":r,"-4039":g,"-4040":g,"-4041":r,"-4042":r,"-4043":g,"-4044":g,"-4045":r,"-4046":u,"-4047":g,"-5001":g,"-5002":o,"-5003":o,"-5004":g,"-5005":o,"-5006":g,"-5007":g,"-5008":o,"-5009":g,"-5010":r,"-5011":g,"-5012":r,"-5013":o,"-5021":g,"-6001":g,"-6003":g,"-6004":r,"-6005":d,"-6006":g,"-6007":g,"-6008":g,"-6009":f,"-6011":g,"-6012":o,"-6013":r,"-6014":g,"-6015":g,"-6016":g,"-6017":g,"-6018":g,"-6019":u,"-6020":g,"-7001":g,"-7002":g,"-9000":o,"-10017":g,"-11008":o,"-12014":f,"-13000":g,"-13001":g,"-13002":g,"-13003":g,"-13004":g,"-13005":g,"-13006":d,"-13007":u,"-21001":g,"-21002":g,"-21003":g,100001003:u,200003903:u},broad:{"has no operation privilege":p,MAX_POSITION:d}}})}isInverse(e,t){return void 0===t?"delivery"===e:"inverse"===t}isLinear(e,t){return void 0===t?"future"===e||"swap"===e:"linear"===t}market(e){if(void 0===this.markets)throw new r(this.id+" markets not loaded");let t=this.safeString(this.options,"defaultType");const i=this.safeString(this.options,"defaultSubType"),s="future"===t,a="delivery"===t,n=s||a;if("string"==typeof e)if(e in this.markets){const t=this.markets[e];if(!n||!t.spot)return t;{const i=e+":"+(s?t.quote:t.base);if(i in this.markets)return this.markets[i]}}else{if(e in this.markets_by_id){const r=this.markets_by_id[e];s?t="linear":a?t="inverse":void 0===t&&(t=i);for(let e=0;e<r.length;e++){const i=r[e];if(i[t])return i}return r[0]}if(e.indexOf("/")>-1&&e.indexOf(":")<0){const[t,i]=e.split("/"),s=e+":"+("USD"===i?t:i);if(s in this.markets)return this.markets[s]}}throw new y(this.id+" does not have market symbol "+e)}costToPrecision(e,t){return this.decimalToPrecision(t,O,this.markets[e].precision.quote,this.precisionMode,this.paddingMode)}currencyToPrecision(e,t,i){return void 0!==this.safeValue(this.currencies[e],"precision")?this.decimalToPrecision(t,O,this.currencies[e].precision,this.precisionMode,this.paddingMode):this.numberToString(t)}nonce(){return this.milliseconds()-this.options.timeDifference}async fetchTime(e={}){const t=this.safeString2(this.options,"fetchTime","defaultType","spot"),i=this.safeString(e,"type",t),s=this.omit(e,"type");let r;[r,e]=this.handleSubTypeAndParams("fetchTime",void 0,e);let a="publicGetTime";this.isLinear(i,r)?a="fapiPublicGetTime":this.isInverse(i,r)&&(a="dapiPublicGetTime");const n=await this[a](s);return this.safeInteger(n,"serverTime")}async fetchCurrencies(e={}){if(!this.safeValue(this.options,"fetchCurrencies"))return;if(!this.checkRequiredCredentials(!1))return;if(void 0!==this.safeString(this.urls,"apiBackup"))return;const t=await this.sapiGetCapitalConfigGetall(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"coin"),a=this.safeString(s,"name"),n=this.safeCurrencyCode(r);let o,h=!0,d=!0;const c=this.safeValue(s,"networkList",[]),l={};let u;for(let e=0;e<c.length;e++){const t=c[e],i=this.safeString(t,"network"),s=this.safeNumber(t,"withdrawFee"),r=this.safeValue(t,"depositEnable"),a=this.safeValue(t,"withdrawEnable");d=d||r,h=h||a,l[i]=s;(this.safeValue(t,"isDefault")||void 0===u)&&(u=s);const n=this.safeString(t,"withdrawIntegerMultiple");I.stringEq(n,"0")||(o=void 0===o?n:I.stringMin(o,n))}const f=this.safeValue(s,"trading"),p=h&&d&&f;let m;void 0!==o&&(m=parseInt(this.numberToString(this.precisionFromString(o)))),i[n]={id:r,name:a,code:n,precision:m,info:s,active:p,deposit:d,withdraw:h,networks:c,fee:u,fees:l,limits:this.limits}}return i}async fetchMarkets(e={}){let t=[];const i=this.safeValue(this.options,"fetchMarkets",["spot","linear","inverse","option"]);for(let s=0;s<i.length;s++){const a=i[s];if("spot"===a)t.push(this.publicGetExchangeInfo(e));else if("linear"===a)t.push(this.fapiPublicGetExchangeInfo(e));else if("inverse"===a)t.push(this.dapiPublicGetExchangeInfo(e));else{if("option"!==a)throw new r(this.id+' fetchMarkets() this.options fetchMarkets "'+a+'" is not a supported market type');t.push(this.eapiPublicGetExchangeInfo(e))}}t=await Promise.all(t);const s=this.safeValue(this.safeValue(t,0),"symbols",[]),a=this.safeValue(this.safeValue(t,1),"symbols",[]),n=this.safeValue(this.safeValue(t,2),"symbols",[]),o=this.safeValue(this.safeValue(t,3),"optionSymbols",[]);let h=s;h=this.arrayConcat(h,a),h=this.arrayConcat(h,n),h=this.arrayConcat(h,o),this.options.adjustForTimeDifference&&await this.loadTimeDifference();const d=[];for(let e=0;e<h.length;e++)d.push(this.parseMarket(h[e]));return d}parseMarket(e){let t=!1,i=!1,s=!1;const r=this.safeString(e,"underlying"),a=this.safeString(e,"symbol"),n=a.split("-"),o=this.safeString(n,0),h=this.safeStringLower(e,"symbol"),d=this.safeString(e,"baseAsset",o),c=this.safeString(e,"quoteAsset"),l=this.safeString(e,"marginAsset","USDT"),u=this.safeCurrencyCode(d),f=this.safeCurrencyCode(c),p=this.safeCurrencyCode(l),m=this.safeString(e,"contractType");let g="contractType"in e,y=this.safeInteger2(e,"deliveryDate","expiryDate");"PERPETUAL"===m||41334048e5===y?(y=void 0,t=!0):void 0!==r?(g=!0,s=!0):i=!0;const b=!g,v=this.safeValue(e,"filters",[]),w=this.indexBy(v,"filterType"),S=this.safeString2(e,"status","contractStatus");let k,T,_,O=this.fees;const M=this.safeInteger(e,"strikePrice");let I=u+"/"+f;if(g){t?I=I+":"+p:i?I=I+":"+p+"-"+this.yymmdd(y):s&&(I=I+":"+p+"-"+this.yymmdd(y)+"-"+this.numberToString(M)+"-"+this.safeString(n,3)),k=this.safeNumber2(e,"contractSize","unit",this.parseNumber("1")),T=p===f,_=p===u;const r=T?"linear":"inverse";O=this.safeValue(this.fees,r,{})}let x="TRADING"===S;if(b){const t=this.safeValue(e,"permissions",[]);for(let e=0;e<t.length;e++)if("TRD_GRP_003"===t[e]){x=!1;break}}const C=this.safeValue(e,"isMarginTradingAllowed",!1);let P;b?P="spot":t?P="swap":i?P="future":s&&(P="option",x=void 0);const A={id:a,lowercaseId:h,symbol:I,base:u,quote:f,settle:p,baseId:d,quoteId:c,settleId:l,type:P,spot:b,margin:b&&C,swap:t,future:i,option:s,active:x,contract:g,linear:T,inverse:_,taker:O.trading.taker,maker:O.trading.maker,contractSize:k,expiry:y,expiryDatetime:this.iso8601(y),strike:M,optionType:this.safeStringLower(e,"side"),precision:{amount:this.safeInteger2(e,"quantityPrecision","quantityScale"),price:this.safeInteger2(e,"pricePrecision","priceScale"),base:this.safeInteger(e,"baseAssetPrecision"),quote:this.safeInteger(e,"quotePrecision")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(e,"minQty"),max:this.safeNumber(e,"maxQty")},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:e};if("PRICE_FILTER"in w){const e=this.safeValue(w,"PRICE_FILTER",{});A.limits.price={min:this.safeNumber(e,"minPrice"),max:this.safeNumber(e,"maxPrice")},A.precision.price=this.precisionFromString(e.tickSize)}if("LOT_SIZE"in w){const e=this.safeValue(w,"LOT_SIZE",{}),t=this.safeString(e,"stepSize");A.precision.amount=this.precisionFromString(t),A.limits.amount={min:this.safeNumber(e,"minQty"),max:this.safeNumber(e,"maxQty")}}if("MARKET_LOT_SIZE"in w){const e=this.safeValue(w,"MARKET_LOT_SIZE",{});A.limits.market={min:this.safeNumber(e,"minQty"),max:this.safeNumber(e,"maxQty")}}if("MIN_NOTIONAL"in w){const e=this.safeValue(w,"MIN_NOTIONAL",{});A.limits.cost.min=this.safeNumber2(e,"minNotional","notional")}return A}parseBalanceHelper(e){const t=this.account();t.used=this.safeString(e,"locked"),t.free=this.safeString(e,"free");const i=this.safeString(e,"interest"),s=this.safeString(e,"borrowed");return t.debt=I.stringAdd(s,i),t}parseBalance(e,t,i){const s={info:e};let r;const a="isolated"===i,n="margin"===t||"cross"===i;if(a||"spot"!==t&&!n)if(a){const t=this.safeValue(e,"assets");for(let e=0;e<t.length;e++){const i=t[e],r=this.safeValue(i,"symbol"),a=this.safeSymbol(r,void 0,void 0,"spot"),n=this.safeValue(i,"baseAsset",{}),o=this.safeValue(i,"quoteAsset",{}),h=this.safeCurrencyCode(this.safeString(n,"asset")),d=this.safeCurrencyCode(this.safeString(o,"asset")),c={};c[h]=this.parseBalanceHelper(n),c[d]=this.parseBalanceHelper(o),s[a]=this.safeBalance(c)}}else if("savings"===t){const t=this.safeValue(e,"positionAmountVos",[]);for(let e=0;e<t.length;e++){const i=t[e],r=this.safeString(i,"asset"),a=this.safeCurrencyCode(r),n=this.account(),o=this.safeString(i,"amount");n.total=o,n.used=o,s[a]=n}}else if("funding"===t)for(let t=0;t<e.length;t++){const i=e[t],r=this.account(),a=this.safeString(i,"asset"),n=this.safeCurrencyCode(a);r.free=this.safeString(i,"free");const o=this.safeString(i,"freeze"),h=this.safeString(i,"withdrawing"),d=this.safeString(i,"locked");r.used=I.stringAdd(o,I.stringAdd(d,h)),s[n]=r}else{let t=e;Array.isArray(e)||(t=this.safeValue(e,"assets",[]));for(let e=0;e<t.length;e++){const i=t[e],r=this.safeString(i,"asset"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(i,"availableBalance"),n.used=this.safeString(i,"initialMargin"),n.total=this.safeString2(i,"marginBalance","balance"),s[a]=n}}else{r=this.safeInteger(e,"updateTime");const t=this.safeValue2(e,"balances","userAssets",[]);for(let e=0;e<t.length;e++){const i=t[e],r=this.safeString(i,"asset"),a=this.safeCurrencyCode(r),o=this.account();if(o.free=this.safeString(i,"free"),o.used=this.safeString(i,"locked"),n){const e=this.safeString(i,"borrowed"),t=this.safeString(i,"interest");o.debt=I.stringAdd(e,t)}s[a]=o}}return s.timestamp=r,s.datetime=this.iso8601(r),a?s:this.safeBalance(s)}async fetchBalance(e={}){await this.loadMarkets();const t=this.safeString2(this.options,"fetchBalance","defaultType","spot");let i,s=this.safeString(e,"type",t);[i,e]=this.handleSubTypeAndParams("fetchBalance",void 0,e);const[r,a]=this.handleMarginModeAndParams("fetchBalance",e);let n="privateGetAccount";const o={};if(this.isLinear(s,i)){const e=this.safeValue(this.options,s,{}),t=this.safeValue(e,"fetchBalance",{});n=this.safeString(t,"method","fapiPrivateV2GetAccount"),s="linear"}else if(this.isInverse(s,i)){const e=this.safeValue(this.options,s,{}),t=this.safeValue(e,"fetchBalance",{});n=this.safeString(t,"method","dapiPrivateGetAccount"),s="inverse"}else if("isolated"===r){n="sapiGetMarginIsolatedAccount";const t=this.safeValue(e,"symbols");if(void 0!==t){let e="";if(Array.isArray(t)){e=this.marketId(t[0]);for(let i=1;i<t.length;i++){const s=t[i];e+=","+this.marketId(s)}}else e=t;o.symbols=e}}else"margin"===s||"cross"===r?n="sapiGetMarginAccount":"savings"===s?n="sapiGetLendingUnionAccount":"funding"===s&&(n="sapiPostAssetGetFundingAsset");const h=this.omit(a,["type","symbols"]),d=await this[n](this.extend(o,h));return this.parseBalance(d,s,r)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};void 0!==t&&(r.limit=t);let a="publicGetDepth";s.linear?a="fapiPublicGetDepth":s.inverse&&(a="dapiPublicGetDepth");const n=await this[a](this.extend(r,i)),o=this.safeInteger(n,"T"),h=this.parseOrderBook(n,e,o);return h.nonce=this.safeInteger(n,"lastUpdateId"),h}parseTicker(e,t){const i=this.safeInteger(e,"closeTime");let s;"time"in e&&(s="contract"),void 0===s&&(s="bidQty"in e?"spot":"contract");const r=this.safeString(e,"symbol"),a=this.safeSymbol(r,t,void 0,s),n=this.safeString(e,"lastPrice");let o,h;return"baseVolume"in e?(o=this.safeString(e,"baseVolume"),h=this.safeString(e,"volume")):(o=this.safeString(e,"volume"),h=this.safeString(e,"quoteVolume")),this.safeTicker({symbol:a,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"highPrice"),low:this.safeString(e,"lowPrice"),bid:this.safeString(e,"bidPrice"),bidVolume:this.safeString(e,"bidQty"),ask:this.safeString(e,"askPrice"),askVolume:this.safeString(e,"askQty"),vwap:this.safeString(e,"weightedAvgPrice"),open:this.safeString(e,"openPrice"),close:n,last:n,previousClose:this.safeString(e,"prevClosePrice"),change:this.safeString(e,"priceChange"),percentage:this.safeString(e,"priceChangePercent"),average:void 0,baseVolume:o,quoteVolume:h,info:e},t)}async fetchStatus(e={}){const t=await this.sapiGetSystemStatus(e),i=this.safeString(t,"status");return{status:this.safeString({0:"ok",1:"maintenance"},i,i),updated:void 0,eta:void 0,url:void 0,info:t}}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id};let r="publicGetTicker24hr";i.linear?r="fapiPublicGetTicker24hr":i.inverse&&(r="dapiPublicGetTicker24hr");const a=await this[r](this.extend(s,t));if(Array.isArray(a)){const e=this.safeValue(a,0,{});return this.parseTicker(e,i)}return this.parseTicker(a,i)}async fetchBidsAsks(e,t={}){let i,s,r,a;if(await this.loadMarkets(),void 0!==(e=this.marketSymbols(e))){const t=this.safeString(e,0);i=this.market(t)}[r,t]=this.handleSubTypeAndParams("fetchBidsAsks",i,t),[s,t]=this.handleMarketTypeAndParams("fetchBidsAsks",i,t),a=this.isLinear(s,r)?"fapiPublicGetTickerBookTicker":this.isInverse(s,r)?"dapiPublicGetTickerBookTicker":"publicGetTickerBookTicker";const n=await this[a](t);return this.parseTickers(n,e)}async fetchTickers(e,t={}){await this.loadMarkets();const i=this.safeString2(this.options,"fetchTickers","defaultType","spot"),s=this.safeString(t,"type",i);let r;[r,t]=this.handleSubTypeAndParams("fetchTickers",void 0,t);const a=this.omit(t,"type");let n;n=this.isLinear(s,r)?"fapiPublicGetTicker24hr":this.isInverse(s,r)?"dapiPublicGetTicker24hr":"publicGetTicker24hr";const o=this.safeString(this.options,"fetchTickersMethod",n),h=await this[o](a);return this.parseTickers(h,e)}parseOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.safeString(r,"price"),o=this.safeInteger(r,"until");r=this.omit(r,["price","until"]),s=void 0===s?500:Math.min(s,1500);const h={interval:this.safeString(this.timeframes,t,t),limit:s};if("index"===n?h.pair=a.id:h.symbol=a.id,void 0!==i&&(h.startTime=i,a.inverse&&i>0)){const e=this.parseTimeframe(t),r=this.sum(i,s*e*1e3-1),a=this.milliseconds();h.endTime=Math.min(a,r)}void 0!==o&&(h.endTime=o);let d="publicGetKlines";"mark"===n?d=a.inverse?"dapiPublicGetMarkPriceKlines":"fapiPublicGetMarkPriceKlines":"index"===n?d=a.inverse?"dapiPublicGetIndexPriceKlines":"fapiPublicGetIndexPriceKlines":a.linear?d="fapiPublicGetKlines":a.inverse&&(d="dapiPublicGetKlines");const c=await this[d](this.extend(h,r));return this.parseOHLCVs(c,a,t,i,s)}parseTrade(e,t){if("isDustTrade"in e)return this.parseDustTrade(e,t);const i=this.safeInteger2(e,"T","time"),s=this.safeString2(e,"p","price"),r=this.safeString2(e,"q","qty"),a=this.safeString2(e,"quoteQty","baseQty"),n=this.safeString(e,"symbol"),o="M"in e||"orderListId"in e?"spot":"contract",h=this.safeSymbol(n,t,void 0,o);let d,c=this.safeString2(e,"t","a");c=this.safeString2(e,"id","tradeId",c);const l=this.safeString(e,"orderId"),u=this.safeValue2(e,"m","isBuyerMaker");let f,p;return void 0!==u?d=u?"sell":"buy":"side"in e?d=this.safeStringLower(e,"side"):"isBuyer"in e&&(d=e.isBuyer?"buy":"sell"),"commission"in e&&(p={cost:this.safeString(e,"commission"),currency:this.safeCurrencyCode(this.safeString(e,"commissionAsset"))}),"isMaker"in e&&(f=e.isMaker?"maker":"taker"),"maker"in e&&(f=e.maker?"maker":"taker"),this.safeTrade({info:e,timestamp:i,datetime:this.iso8601(i),symbol:h,id:c,order:l,type:void 0,side:d,takerOrMaker:f,price:s,amount:r,cost:a,fee:p},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};let n;n=r.linear?"fapiPublicGetAggTrades":r.inverse?"dapiPublicGetAggTrades":"publicGetAggTrades";let o=this.safeString(this.options,"fetchTradesMethod",n);"publicGetAggTrades"===o?r.linear?o="fapiPublicGetAggTrades":r.inverse&&(o="dapiPublicGetAggTrades"):"publicGetHistoricalTrades"===o&&(r.linear?o="fapiPublicGetHistoricalTrades":r.inverse&&(o="dapiPublicGetHistoricalTrades")),void 0!==t&&(a.startTime=t,a.endTime=this.sum(t,36e5)),void 0!==i&&(a.limit=i);const h=await this[o](this.extend(a,s));return this.parseTrades(h,r,t,i)}async editOrder(e,t,i,s,r,a,n={}){await this.loadMarkets();const o=this.market(t);if(!o.spot)throw new m(this.id+" editOrder() does not support "+o.type+" orders, only spot orders are accepted");const h={symbol:o.id,side:s.toUpperCase(),cancelOrderId:e,cancelReplaceMode:"STOP_ON_FAILURE"},c=this.safeString2(n,"newClientOrderId","clientOrderId"),l=i.toUpperCase();let u=l;this.isPostOnly("MARKET"===l,"LIMIT_MAKER"===l,n)&&(u="LIMIT_MAKER"),h.type=u;const f=this.safeNumber(n,"stopPrice");void 0!==f&&("MARKET"===u?u="STOP_LOSS":"LIMIT"===u&&(u="STOP_LOSS_LIMIT"));const p=this.safeValue(o.info,"orderTypes");if(!this.inArray(u,p))throw new d(l!==u?this.id+" stopPrice parameter is not allowed for "+t+" "+i+" orders":this.id+" "+i+" is not a valid order type for the "+t+" market");if(void 0===c){const e=this.safeValue(this.options,"broker");if(void 0!==e){const t=this.safeString(e,"spot");void 0!==t&&(h.newClientOrderId=t+this.uuid22())}}else h.newClientOrderId=c;h.newOrderRespType=this.safeValue(this.options.newOrderRespType,i,"RESULT");let g=!1,y=!1,b=!1,v=!1;if("MARKET"===u){if(this.safeValue(this.options,"quoteOrderQty",!0)){const e=this.safeValue2(n,"quoteOrderQty","cost"),t=o.precision.price;if(void 0!==e)h.quoteOrderQty=this.decimalToPrecision(e,O,t,this.precisionMode);else if(void 0!==a){const e=this.numberToString(r),i=this.numberToString(a),s=I.stringMul(e,i);h.quoteOrderQty=this.decimalToPrecision(s,O,t,this.precisionMode)}else v=!0}else v=!0}else"LIMIT"===u?(y=!0,g=!0,v=!0):"STOP_LOSS"===u||"TAKE_PROFIT"===u?(b=!0,v=!0):"STOP_LOSS_LIMIT"===u||"TAKE_PROFIT_LIMIT"===u?(v=!0,b=!0,y=!0,g=!0):"LIMIT_MAKER"===u&&(y=!0,v=!0);if(v&&(h.quantity=this.amountToPrecision(t,r)),y){if(void 0===a)throw new d(this.id+" editOrder() requires a price argument for a "+i+" order");h.price=this.priceToPrecision(t,a)}if(g&&(h.timeInForce=this.options.defaultTimeInForce),b){if(void 0===f)throw new d(this.id+" editOrder() requires a stopPrice extra param for a "+i+" order");h.stopPrice=this.priceToPrecision(t,f)}const w=this.omit(n,["quoteOrderQty","cost","stopPrice","newClientOrderId","clientOrderId","postOnly"]),S=await this.privatePostOrderCancelReplace(this.extend(h,w)),k=this.safeValue(S,"newOrderResponse");return this.parseOrder(k,o)}parseOrderStatus(e){return this.safeString({NEW:"open",PARTIALLY_FILLED:"open",FILLED:"closed",CANCELED:"canceled",PENDING_CANCEL:"canceling",REJECTED:"rejected",EXPIRED:"expired",EXPIRED_IN_MATCH:"expired"},e,e)}parseOrder(e,t){const i=this.parseOrderStatus(this.safeString(e,"status")),s=this.safeString(e,"symbol"),r="closePosition"in e?"contract":"spot",a=this.safeSymbol(s,t,void 0,r),n=this.safeString(e,"executedQty","0");let o,h;"time"in e?o=this.safeInteger(e,"time"):"workingTime"in e?(h=this.safeInteger(e,"transactTime"),o=this.safeInteger(e,"workingTime")):"transactTime"in e?(h=this.safeInteger(e,"transactTime"),o=this.safeInteger(e,"transactTime")):"updateTime"in e&&"open"===i&&(I.stringGt(n,"0")?h=this.safeInteger(e,"updateTime"):o=this.safeInteger(e,"updateTime"));const d=this.safeString(e,"avgPrice"),c=this.safeString(e,"price"),l=this.safeString(e,"origQty");let u=this.safeString2(e,"cummulativeQuoteQty","cumQuote");u=this.safeString(e,"cumBase",u);const f=this.safeString(e,"orderId");let p=this.safeStringLower(e,"type");const m=this.safeStringLower(e,"side"),g=this.safeValue(e,"fills",[]),y=this.safeString(e,"clientOrderId");let b=this.safeString(e,"timeInForce");"GTX"===b&&(b="PO");const v="limit_maker"===p||"PO"===b;"limit_maker"===p&&(p="limit");const w=this.safeString(e,"stopPrice"),S=this.parseNumber(this.omitZero(w));return this.safeOrder({info:e,id:f,clientOrderId:y,timestamp:o,datetime:this.iso8601(o),lastTradeTimestamp:h,symbol:a,type:p,timeInForce:b,postOnly:v,reduceOnly:this.safeValue(e,"reduceOnly"),side:m,price:c,triggerPrice:S,amount:l,cost:u,average:d,filled:n,remaining:void 0,status:i,fee:void 0,trades:g},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=this.safeString(a,"type",n.type),h=this.safeString2(a,"newClientOrderId","clientOrderId"),c=t.toUpperCase(),l="MARKET"===c,u="LIMIT"===c,f=this.isPostOnly(l,"LIMIT_MAKER"===c,a),p=this.safeValue2(a,"triggerPrice","stopPrice"),m=this.safeValue(a,"stopLossPrice",p),g=this.safeValue(a,"takeProfitPrice"),y=void 0!==m,b=void 0!==g;a=this.omit(a,["type","newClientOrderId","clientOrderId","postOnly","stopLossPrice","takeProfitPrice","stopPrice","triggerPrice"]);const[v,w]=this.handleMarginModeAndParams("createOrder",a),S={symbol:n.id,side:i.toUpperCase()};let k="privatePostOrder";if(n.linear)k="fapiPrivatePostOrder";else if(n.inverse)k="dapiPrivatePostOrder";else if("margin"===o||void 0!==v){k="sapiPostMarginOrder";this.safeValue(a,"reduceOnly")&&(S.sideEffectType="AUTO_REPAY",a=this.omit(a,"reduceOnly"))}if(n.spot||"margin"===o){this.safeValue(w,"test",!1)&&(k+="Test"),f&&(t="LIMIT_MAKER")}let T,_=t.toUpperCase();y?(T=m,l?_=n.contract?"STOP_MARKET":"STOP_LOSS":u&&(_=n.contract?"STOP":"STOP_LOSS_LIMIT")):b&&(T=g,l?_=n.contract?"TAKE_PROFIT_MARKET":"TAKE_PROFIT":u&&(_=n.contract?"TAKE_PROFIT":"TAKE_PROFIT_LIMIT"));const M=this.safeValue(n.info,"orderTypes");if(!this.inArray(_,M))throw new d(c!==_?this.id+" stopPrice parameter is not allowed for "+e+" "+t+" orders":this.id+" "+t+" is not a valid order type for the "+e+" market");if("isolated"===v&&(S.isIsolated=!0),void 0===h){const e=this.safeValue(this.options,"broker");if(void 0!==e){const t=this.safeString(e,o);void 0!==t&&(S.newClientOrderId=t+this.uuid22())}}else S.newClientOrderId=h;S.newOrderRespType="spot"===o||"margin"===o?this.safeValue(this.options.newOrderRespType,t,"RESULT"):"RESULT",S.type=_;let x=!1,C=!1,P=!1,A=!1;if("MARKET"===_)if(n.spot){if(this.safeValue(this.options,"quoteOrderQty",!0)){const e=this.safeValue2(w,"quoteOrderQty","cost"),t=n.precision.price;if(void 0!==e)S.quoteOrderQty=this.decimalToPrecision(e,O,t,this.precisionMode);else if(void 0!==r){const e=this.numberToString(s),i=this.numberToString(r),a=I.stringMul(e,i);S.quoteOrderQty=this.decimalToPrecision(a,O,t,this.precisionMode)}else A=!0}else A=!0}else A=!0;else if("LIMIT"===_)C=!0,x=!0,A=!0;else if("STOP_LOSS"===_||"TAKE_PROFIT"===_)P=!0,A=!0,(n.linear||n.inverse)&&(C=!0);else if("STOP_LOSS_LIMIT"===_||"TAKE_PROFIT_LIMIT"===_)A=!0,P=!0,C=!0,x=!0;else if("LIMIT_MAKER"===_)C=!0,A=!0;else if("STOP"===_)A=!0,P=!0,C=!0;else if("STOP_MARKET"===_||"TAKE_PROFIT_MARKET"===_){void 0===this.safeValue(w,"closePosition")&&(A=!0),P=!0}else if("TRAILING_STOP_MARKET"===_){A=!0;if(void 0===this.safeNumber(w,"callbackRate"))throw new d(this.id+" createOrder() requires a callbackRate extra param for a "+t+" order")}if(A&&(S.quantity=this.amountToPrecision(e,s)),C){if(void 0===r)throw new d(this.id+" createOrder() requires a price argument for a "+t+" order");S.price=this.priceToPrecision(e,r)}if(x&&(S.timeInForce=this.options.defaultTimeInForce),n.contract&&f&&(S.timeInForce="GTX"),P){if(n.contract){if(void 0===T)throw new d(this.id+" createOrder() requires a stopPrice extra param for a "+t+" order")}else{if(void 0===this.safeValue(a,"trailingDelta")&&void 0===T)throw new d(this.id+" createOrder() requires a stopPrice or trailingDelta param for a "+t+" order")}void 0!==T&&(S.stopPrice=this.priceToPrecision(e,T))}const N=this.omit(a,["quoteOrderQty","cost","stopPrice","test","type","newClientOrderId","clientOrderId","postOnly"]),B=await this[k](this.extend(S,N));return this.parseOrder(B,n)}async fetchOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r=this.safeString2(this.options,"fetchOrder","defaultType","spot"),n=this.safeString(i,"type",r),[o,h]=this.handleMarginModeAndParams("fetchOrder",i),d={symbol:s.id};let c="privateGetOrder";s.linear?c="fapiPrivateGetOrder":s.inverse?c="dapiPrivateGetOrder":"margin"!==n&&void 0===o||(c="sapiGetMarginOrder","isolated"===o&&(d.isIsolated=!0));const l=this.safeValue2(i,"origClientOrderId","clientOrderId");void 0!==l?d.origClientOrderId=l:d.orderId=e;const u=this.omit(h,["type","clientOrderId","origClientOrderId"]),f=await this[c](this.extend(d,u));return this.parseOrder(f,s)}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n=this.safeString2(this.options,"fetchOrders","defaultType","spot"),o=this.safeString(s,"type",n),[h,d]=this.handleMarginModeAndParams("fetchOrders",s),c={symbol:r.id};let l="privateGetAllOrders";r.linear?l="fapiPrivateGetAllOrders":r.inverse?l="dapiPrivateGetAllOrders":"margin"!==o&&void 0===h||(l="sapiGetMarginAllOrders","isolated"===h&&(c.isIsolated=!0)),void 0!==t&&(c.startTime=t),void 0!==i&&(c.limit=i);const u=await this[l](this.extend(c,d));return this.parseOrders(u,r,t,i)}async fetchOpenOrders(e,t,i,s={}){let n,o;await this.loadMarkets();const h={};let d,c,l;if([d,c]=this.handleMarginModeAndParams("fetchOpenOrders",s),void 0!==e){n=this.market(e),h.symbol=n.id;const t=this.safeString2(this.options,"fetchOpenOrders","defaultType","spot"),i="type"in n?n.type:t;o=this.safeString(c,"type",i)}else{if(this.options.warnOnFetchOpenOrdersWithoutSymbol){const e=this.symbols.length,t=parseInt(e/2);throw new r(this.id+" fetchOpenOrders() WARNING: fetching open orders without specifying a symbol is rate-limited to one call per "+t.toString()+" seconds. Do not call this method frequently to avoid ban. Set "+this.id+'.options["warnOnFetchOpenOrdersWithoutSymbol"] = false to suppress this warning message.')}{const e=this.safeString2(this.options,"fetchOpenOrders","defaultType","spot");o=this.safeString(c,"type",e)}}[l,c]=this.handleSubTypeAndParams("fetchOpenOrders",n,s);const u=this.omit(c,"type");let f="privateGetOpenOrders";if(this.isLinear(o,l))f="fapiPrivateGetOpenOrders";else if(this.isInverse(o,l))f="dapiPrivateGetOpenOrders";else if(("margin"===o||void 0!==d)&&(f="sapiGetMarginOpenOrders","isolated"===d&&(h.isIsolated=!0,void 0===e)))throw new a(this.id+" fetchOpenOrders() requires a symbol argument for isolated markets");const p=await this[f](this.extend(h,u));return this.parseOrders(p,n,t,i)}async fetchClosedOrders(e,t,i,s={}){const r=await this.fetchOrders(e,t,i,s);return this.filterBy(r,"status","closed")}async cancelOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r=this.safeString2(this.options,"cancelOrder","defaultType","spot"),n=this.safeString(i,"type",r),o=this.safeValue2(i,"origClientOrderId","clientOrderId"),[h,d]=this.handleMarginModeAndParams("cancelOrder",i),c={symbol:s.id};void 0===o?c.orderId=e:c.origClientOrderId=o;let l="privateDeleteOrder";s.linear?l="fapiPrivateDeleteOrder":s.inverse?l="dapiPrivateDeleteOrder":"margin"!==n&&void 0===h||(l="sapiDeleteMarginOrder","isolated"===h&&(c.isIsolated=!0));const u=this.omit(d,["type","origClientOrderId","clientOrderId"]),f=await this[l](this.extend(c,u));return this.parseOrder(f,s)}async cancelAllOrders(e,t={}){if(void 0===e)throw new a(this.id+" cancelAllOrders () requires a symbol argument");await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=this.safeString(t,"type",i.type);t=this.omit(t,["type"]);const[n,o]=this.handleMarginModeAndParams("cancelAllOrders",t);let h="privateDeleteOpenOrders";i.linear?h="fapiPrivateDeleteAllOpenOrders":i.inverse?h="dapiPrivateDeleteAllOpenOrders":"margin"!==r&&void 0===n||(h="sapiDeleteMarginOpenOrders","isolated"===n&&(s.isIsolated=!0));const d=await this[h](this.extend(s,o));return Array.isArray(d)?this.parseOrders(d,i):d}async fetchOrderTrades(e,t,i,s,r={}){if(void 0===t)throw new a(this.id+" fetchOrderTrades() requires a symbol argument");await this.loadMarkets();const n=this.market(t),o=this.safeString(r,"type",n.type);if(r=this.omit(r,"type"),"spot"!==o)throw new m(this.id+" fetchOrderTrades() supports spot markets only");const h={orderId:e};return await this.fetchMyTrades(t,i,s,this.extend(h,r))}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={symbol:r.id},o=this.safeString(s,"type",r.type);let h,d;s=this.omit(s,"type"),[d,s]=this.handleMarginModeAndParams("fetchMyTrades",s),"spot"===o||"margin"===o?(h="privateGetMyTrades","margin"!==o&&void 0===d||(h="sapiGetMarginMyTrades","isolated"===d&&(n.isIsolated=!0))):r.linear?h="fapiPrivateGetUserTrades":r.inverse&&(h="dapiPrivateGetUserTrades");let c=this.safeInteger2(s,"until","endTime");if(void 0!==t){const e=parseInt(t);n.startTime=e;const i=this.milliseconds(),s=6048e5;i-e>=s&&void 0===c&&r.linear&&(c=this.sum(e,s),c=Math.min(c,i))}void 0!==c&&(n.endTime=c,s=this.omit(s,["endTime","until"])),void 0!==i&&(r.contract&&(i=Math.min(i,1e3)),n.limit=i);const l=await this[h](this.extend(n,s));return this.parseTrades(l,r,t,i)}async fetchMyDustTrades(e,t,i,s={}){await this.loadMarkets();const r={};void 0!==t&&(r.startTime=t,r.endTime=this.sum(t,7776e6));const a=await this.sapiGetAssetDribblet(this.extend(r,s)),n=this.safeValue(a,"userAssetDribblets",[]),o=this.safeInteger(a,"total",0),h=[];for(let e=0;e<o;e++){const t=this.safeValue(n[e],"userAssetDribbletDetails",[]);for(let e=0;e<t.length;e++)t[e].isDustTrade=!0,h.push(t[e])}const d=this.parseTrades(h,void 0,t,i);return this.filterBySinceLimit(d,t,i)}parseDustTrade(e,t){const i=this.safeString(e,"transId"),s=this.safeInteger(e,"operateTime"),r=this.safeString(e,"fromAsset"),a=this.safeCurrencyCode(r),n=this.currency("BNB").code,o=n+"/"+a;let h=!1;o in this.markets&&(h=!0);const d=this.safeString(e,"serviceChargeAmount"),c={currency:n,cost:this.parseNumber(d)};let l,u,f,p,m;h?(l=o,u=this.safeString(e,"transferedAmount"),f=this.safeString(e,"amount"),p="buy"):(l=a+"/"+n,u=this.safeString(e,"amount"),f=this.safeString(e,"transferedAmount"),p="sell"),void 0!==f&&u&&(m=I.stringDiv(f,u));const g=this.parseNumber(u),y=this.parseNumber(m),b=this.parseNumber(f);return{id:undefined,timestamp:s,datetime:this.iso8601(s),symbol:l,order:i,type:undefined,takerOrMaker:undefined,side:p,amount:g,price:y,cost:b,fee:c,info:e}}async fetchDeposits(e,t,i,s={}){let r,a;await this.loadMarkets();const n={},o=this.safeValue(this.options,"legalMoney",{}),h=this.safeValue(s,"fiat",!1);s=this.omit(s,"fiatOnly");const d=this.safeInteger(s,"until");if(h||e in o){void 0!==e&&(r=this.currency(e)),n.transactionType=0,void 0!==t&&(n.beginTime=t),void 0!==d&&(n.endTime=d);const i=await this.sapiGetFiatOrders(this.extend(n,s));a=this.safeValue(i,"data")}else{if(void 0!==e&&(r=this.currency(e),n.coin=r.id),void 0!==t){n.startTime=t;let e=this.sum(t,7776e6);void 0!==d&&(e=Math.min(e,d)),n.endTime=e}void 0!==i&&(n.limit=i),a=await this.sapiGetCapitalDepositHisrec(this.extend(n,s))}return this.parseTransactions(a,r,t,i)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r=this.safeValue(this.options,"legalMoney",{}),a=this.safeValue(s,"fiat",!1);s=this.omit(s,"fiatOnly");const n={};let o,h;if(a||e in r){void 0!==e&&(h=this.currency(e)),n.transactionType=1,void 0!==t&&(n.beginTime=t);const i=await this.sapiGetFiatOrders(this.extend(n,s));o=this.safeValue(i,"data")}else void 0!==e&&(h=this.currency(e),n.coin=h.id),void 0!==t&&(n.startTime=t,n.endTime=this.sum(t,7776e6)),void 0!==i&&(n.limit=i),o=await this.sapiGetCapitalWithdrawHistory(this.extend(n,s));return this.parseTransactions(o,h,t,i)}parseTransactionStatusByType(e,t){const i=this.safeValue({deposit:{0:"pending",1:"ok",6:"ok",Processing:"pending",Failed:"failed",Successful:"ok",Refunding:"canceled",Refunded:"canceled","Refund Failed":"failed"},withdrawal:{0:"pending",1:"canceled",2:"pending",3:"failed",4:"pending",5:"failed",6:"ok",Processing:"pending",Failed:"failed",Successful:"ok",Refunding:"canceled",Refunded:"canceled","Refund Failed":"failed"}},t,{});return this.safeString(i,e,e)}parseTransaction(e,t){const i=this.safeString2(e,"id","orderNo"),s=this.safeString(e,"address");let r=this.safeString(e,"addressTag");void 0!==r&&r.length<1&&(r=void 0);let a=this.safeString(e,"txId");void 0!==a&&a.indexOf("Internal transfer ")>=0&&(a=a.slice(18));const n=this.safeString2(e,"coin","fiatCurrency");let o,h=this.safeCurrencyCode(n,t);o=this.safeInteger2(e,"insertTime","createTime"),void 0===o&&(o=this.parse8601(this.safeString(e,"applyTime")));const d=this.safeInteger2(e,"successTime","updateTime");let c=this.safeString(e,"type");if(void 0===c){const t=this.safeString(e,"transactionType");void 0!==t&&(c="0"===t?"deposit":"withdrawal");const i=this.safeValue(this.options,"legalMoneyCurrenciesById");h=this.safeString(i,h,h)}const l=this.parseTransactionStatusByType(this.safeString(e,"status"),c),u=this.safeNumber(e,"amount"),f=this.safeNumber2(e,"transactionFee","totalFee");let p;void 0!==f&&(p={currency:h,cost:f});let m=this.safeInteger(e,"transferType");void 0!==m&&(m=!!m);const g=this.safeString(e,"network");return{info:e,id:i,txid:a,timestamp:o,datetime:this.iso8601(o),network:g,address:s,addressTo:s,addressFrom:void 0,tag:r,tagTo:r,tagFrom:void 0,type:c,amount:u,currency:h,status:l,updated:d,internal:m,fee:p}}parseTransferStatus(e){return this.safeString({CONFIRMED:"ok"},e,e)}parseTransfer(e,t){const i=this.safeString(e,"tranId"),s=this.safeString(e,"asset"),r=this.safeCurrencyCode(s,t),a=this.safeNumber(e,"amount"),n=this.safeString(e,"type");let o,h;const d=this.safeValue(this.options,"accountsById",{});if(void 0!==n){const e=n.split("_");o=this.safeValue(e,0),h=this.safeValue(e,1),o=this.safeString(d,o,o),h=this.safeString(d,h,h)}const c=this.safeInteger(e,"timestamp"),l=this.parseTransferStatus(this.safeString(e,"status"));return{info:e,id:i,timestamp:c,datetime:this.iso8601(c),currency:r,amount:a,fromAccount:o,toAccount:h,status:l}}parseIncome(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t,void 0,"swap"),r=this.safeNumber(e,"income"),a=this.safeString(e,"asset"),n=this.safeCurrencyCode(a),o=this.safeString(e,"tranId"),h=this.safeInteger(e,"time");return{info:e,symbol:s,code:n,timestamp:h,datetime:this.iso8601(h),id:o,amount:r}}async transfer(e,t,i,s,r={}){await this.loadMarkets();const n=this.currency(e),o={asset:n.id,amount:this.currencyToPrecision(e,t)};o.type=this.safeString(r,"type");let h="sapiPostAssetTransfer";if(void 0===o.type){const e=this.safeString(r,"symbol");void 0!==e&&(r=this.omit(r,"symbol"));let t=this.convertTypeToAccount(i).toUpperCase(),n=this.convertTypeToAccount(s).toUpperCase();if("ISOLATED"===t){if(void 0===e)throw new a(this.id+' transfer () requires params["symbol"] when fromAccount is '+i);t=this.marketId(e)}if("ISOLATED"===n){if(void 0===e)throw new a(this.id+' transfer () requires params["symbol"] when toAccount is '+s);n=this.marketId(e)}const d=this.safeValue(this.options,"accountsById",{}),c=!(t in d),l=!(n in d);if(c||l){const e="MAIN"===t,r="MAIN"===n;if((c||l)&&("UMFUTURE"===t||"CMFUTURE"===t||("UMFUTURE"===n||"CMFUTURE"===n)||("MINING"===t||"MINING"===n)||("FUNDING"===t||"FUNDING"===n)))throw new g(this.id+" transfer () does not allow transfers between "+i+" and "+s);r&&c?(h="sapiPostMarginIsolatedTransfer",o.transFrom="ISOLATED_MARGIN",o.transTo="SPOT",o.symbol=t):e&&l?(h="sapiPostMarginIsolatedTransfer",o.transFrom="SPOT",o.transTo="ISOLATED_MARGIN",o.symbol=n):(c&&(o.fromSymbol=t,t="ISOLATEDMARGIN"),l&&(o.toSymbol=n,n="ISOLATEDMARGIN"),o.type=t+"_"+n)}else o.type=t+"_"+n}r=this.omit(r,"type");const d=await this[h](this.extend(o,r));return this.parseTransfer(d,n)}async fetchTransfers(e,t,i,s={}){let a;await this.loadMarkets(),void 0!==e&&(a=this.currency(e));const n=this.safeString2(this.options,"fetchTransfers","defaultType","spot"),o=this.safeString(s,"fromAccount",n),h="future"===o?"spot":"future",d=this.safeString(s,"toAccount",h);let c=this.safeString(s,"type");const l=this.safeValue(this.options,"accountsByType",{}),u=this.safeString(l,o),f=this.safeString(l,d);if(void 0===c){if(void 0===u){const e=Object.keys(l);throw new r(this.id+" fromAccount parameter must be one of "+e.join(", "))}if(void 0===f){const e=Object.keys(l);throw new r(this.id+" toAccount parameter must be one of "+e.join(", "))}c=u+"_"+f}const p={type:c};void 0!==t&&(p.startTime=t),void 0!==i&&(p.size=i);const m=await this.sapiGetAssetTransfer(this.extend(p,s)),g=this.safeValue(m,"rows",[]);return this.parseTransfers(g,a,t,i)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={coin:this.currency(e).id},s=this.safeValue(this.options,"networks",{});let r=this.safeStringUpper(t,"network");r=this.safeString(s,r,r),void 0!==r&&(i.network=r,t=this.omit(t,"network"));const a=await this.sapiGetCapitalDepositAddress(this.extend(i,t)),n=this.safeString(a,"address"),o=this.safeString(a,"url");let h;if(void 0!==o){const t=this.safeValue(this.options,"reverseNetworks",{}),i=o.split("/");let s=this.safeString(i,2);if("blockchair.com"===s||"viewblock.io"===s){const e=this.safeString(i,3);void 0!==e&&(s=s+"/"+e)}h=this.safeString(t,s);const r=this.safeValue(this.options,"impliedNetworks",{ETH:{ERC20:"ETH"},TRX:{TRC20:"TRX"}});if(e in r){const t=this.safeValue(r,e,{});h=this.safeString(t,h,h)}}let d=this.safeString(a,"tag","");return 0===d.length&&(d=void 0),this.checkAddress(n),{currency:e,address:n,tag:d,network:h,info:a}}async fetchTransactionFees(e,t={}){await this.loadMarkets();const i=await this.sapiGetCapitalConfigGetall(t),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"coin"),a=this.safeCurrencyCode(r),n=this.safeValue(t,"networkList",[]);s[a]={};for(let e=0;e<n.length;e++){const t=n[e],i=this.safeString(t,"network"),r=this.safeCurrencyCode(i),o=this.safeNumber(t,"withdrawFee");s[a][r]=o}}return{withdraw:s,deposit:{},info:i}}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.sapiGetCapitalConfigGetall(t);return this.parseDepositWithdrawFees(i,e,"coin")}parseDepositWithdrawFee(e,t){const i=this.safeValue(e,"networkList",[]),s=this.depositWithdrawFee(e);for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"network"),a=this.networkIdToCode(r),n=this.safeNumber(t,"withdrawFee");!0===this.safeValue(t,"isDefault")&&(s.withdraw={fee:n,percentage:void 0}),s.networks[a]={withdraw:{fee:n,percentage:void 0},deposit:{fee:void 0,percentage:void 0}}}return s}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={coin:a.id,address:i,amount:t};void 0!==s&&(n.addressTag=s);const o=this.safeValue(this.options,"networks",{});let h=this.safeStringUpper(r,"network");h=this.safeString(o,h,h),void 0!==h&&(n.network=h,r=this.omit(r,"network"));const d=await this.sapiPostCapitalWithdrawApply(this.extend(n,r));return this.parseTransaction(d,a)}parseTradingFee(e,t){const i=this.safeString(e,"symbol");return{info:e,symbol:this.safeSymbol(i,t,void 0,"spot"),maker:this.safeNumber(e,"makerCommission"),taker:this.safeNumber(e,"takerCommission")}}async fetchTradingFee(e,t={}){await this.loadMarkets();const i={symbol:this.market(e).id},s=await this.sapiGetAssetTradeFee(this.extend(i,t)),r=this.safeValue(s,0,{});return this.parseTradingFee(r)}async fetchTradingFees(e={}){let t;await this.loadMarkets();const i=this.safeString2(this.options,"fetchTradingFees","defaultType","linear"),s=this.safeString(e,"type",i);let r;e=this.omit(e,"type"),[r,e]=this.handleSubTypeAndParams("fetchTradingFees",void 0,e);const a="spot"===s||"margin"===s,n=this.isLinear(s,r),o=this.isInverse(s,r);a?t="sapiGetAssetTradeFee":n?t="fapiPrivateGetAccount":o&&(t="dapiPrivateGetAccount");const h=await this[t](e);if(a){const e={};for(let t=0;t<h.length;t++){const i=this.parseTradingFee(h[t]);e[i.symbol]=i}return e}if(n){const e=Object.keys(this.markets),t={},i=this.safeInteger(h,"feeTier"),s=this.fees.linear.trading.tiers,r=s.maker[i][1],a=s.taker[i][1];for(let s=0;s<e.length;s++){const n=e[s];this.markets[n].linear&&(t[n]={info:{feeTier:i},symbol:n,maker:r,taker:a})}return t}if(o){const e=Object.keys(this.markets),t={},i=this.safeInteger(h,"feeTier"),s=this.fees.inverse.trading.tiers,r=s.maker[i][1],a=s.taker[i][1];for(let s=0;s<e.length;s++){const n=e[s];this.markets[n].inverse&&(t[n]={info:{feeTier:i},symbol:n,maker:r,taker:a})}return t}}async futuresTransfer(e,t,i,s={}){if(i<1||i>4)throw new a(this.id+" type must be between 1 and 4");await this.loadMarkets();const r=this.currency(e),n={asset:r.id,amount:t,type:i},o=await this.sapiPostFuturesTransfer(this.extend(n,s));return this.parseTransfer(o,r)}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id};let r;if(i.linear)r="fapiPublicGetPremiumIndex";else{if(!i.inverse)throw new m(this.id+" fetchFundingRate() supports linear and inverse contracts only");r="dapiPublicGetPremiumIndex"}let a=await this[r](this.extend(s,t));return i.inverse&&(a=a[0]),this.parseFundingRate(a,i)}async fetchFundingRateHistory(e,t,i,s={}){await this.loadMarkets();const r={};let a;const n=this.safeString2(this.options,"fetchFundingRateHistory","defaultType","future"),o=this.safeString(s,"type",n);let h,d;if(void 0!==e&&(h=this.market(e),e=h.symbol,r.symbol=h.id),[d,s]=this.handleSubTypeAndParams("fetchFundingRateHistory",h,s,"linear"),s=this.omit(s,"type"),this.isLinear(o,d)?a="fapiPublicGetFundingRate":this.isInverse(o,d)&&(a="dapiPublicGetFundingRate"),void 0===a)throw new m(this.id+" fetchFundingRateHistory() is not supported for "+o+" markets");void 0!==t&&(r.startTime=t);const c=this.safeInteger2(s,"until","till"),l=this.safeInteger(s,"endTime",c);s=this.omit(s,["endTime","till","until"]),void 0!==l&&(r.endTime=l),void 0!==i&&(r.limit=i);const u=await this[a](this.extend(r,s)),f=[];for(let e=0;e<u.length;e++){const t=u[e],i=this.safeInteger(t,"fundingTime");f.push({info:t,symbol:this.safeSymbol(this.safeString(t,"symbol"),void 0,void 0,"swap"),fundingRate:this.safeNumber(t,"fundingRate"),timestamp:i,datetime:this.iso8601(i)})}const p=this.sortBy(f,"timestamp");return this.filterBySymbolSinceLimit(p,e,t,i)}async fetchFundingRates(e,t={}){let i;await this.loadMarkets(),e=this.marketSymbols(e);const s=this.safeString2(this.options,"fetchFundingRates","defaultType","future"),r=this.safeString(t,"type",s);let a;[a,t]=this.handleSubTypeAndParams("fetchFundingRates",void 0,t,"linear");const n=this.omit(t,"type");if(this.isLinear(r,a))i="fapiPublicGetPremiumIndex";else{if(!this.isInverse(r,a))throw new m(this.id+" fetchFundingRates() supports linear and inverse contracts only");i="dapiPublicGetPremiumIndex"}const o=await this[i](n),h=[];for(let e=0;e<o.length;e++){const t=o[e],i=this.parseFundingRate(t);h.push(i)}return this.filterByArray(h,"symbol",e)}parseFundingRate(e,t){const i=this.safeInteger(e,"time"),s=this.safeString(e,"symbol"),r=this.safeSymbol(s,t,void 0,"contract"),a=this.safeNumber(e,"markPrice"),n=this.safeNumber(e,"indexPrice"),o=this.safeNumber(e,"interestRate"),h=this.safeNumber(e,"estimatedSettlePrice"),d=this.safeNumber(e,"lastFundingRate"),c=this.safeInteger(e,"nextFundingTime");return{info:e,symbol:r,markPrice:a,indexPrice:n,interestRate:o,estimatedSettlePrice:h,timestamp:i,datetime:this.iso8601(i),fundingRate:d,fundingTimestamp:c,fundingDatetime:this.iso8601(c),nextFundingRate:void 0,nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}parseAccountPositions(e){const t=this.safeValue(e,"positions"),i=this.safeValue(e,"assets",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"asset"),a=this.safeCurrencyCode(r),n=this.safeString(t,"crossWalletBalance"),o=this.safeString(t,"crossUnPnl");s[a]={crossMargin:I.stringAdd(n,o),crossWalletBalance:n}}const r=[];for(let e=0;e<t.length;e++){const i=t[e],a=this.safeString(i,"symbol"),n=this.safeMarket(a,void 0,void 0,"contract"),o=n.linear?n.quote:n.base;if(o in s){const e=this.parseAccountPosition(this.extend(i,{crossMargin:s[o].crossMargin,crossWalletBalance:s[o].crossWalletBalance}),n);r.push(e)}}return r}parseAccountPosition(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t,void 0,"contract");const s=this.safeString(t,"symbol"),r=this.safeString(e,"leverage"),a=parseInt(r),n=this.safeString(e,"initialMargin"),o=this.parseNumber(n);let h=I.stringDiv("1",r,8);1e3%a==0||(h=I.stringDiv(I.stringAdd(h,"1e-8"),"1",8));const d="notional"in e,c=this.safeString(e,"maintMargin"),l=this.parseNumber(c),u=this.safeString(e,"entryPrice");let f=this.parseNumber(u);const p=this.safeString2(e,"notional","notionalValue"),m=I.stringAbs(p),g=this.parseNumber(m);let y=this.safeString(e,"positionAmt"),b=I.stringAbs(y);if(void 0===y){const e=I.stringMul(I.stringMul(r,n),u),i=this.safeString(t,"contractSize");y=I.stringDiv(e,i),b=I.stringDiv(I.stringAdd(y,"0.5"),"1",0)}const v=this.parseNumber(b),w=this.safeValue(this.options,"leverageBrackets",{}),S=this.safeValue(w,s,[]);let k;for(let e=0;e<S.length;e++){const t=S[e];if(I.stringLt(m,t[0]))break;k=t[1]}const T=this.parseNumber(k),_=this.safeString(e,"unrealizedProfit"),O=this.parseNumber(_);let M=this.safeInteger(e,"updateTime");0===M&&(M=void 0);let x,C,P;this.safeValue(e,"isolated")?(x="isolated",P=this.safeString(e,"isolatedWallet"),C=I.stringAdd(P,_)):(x="cross",P=this.safeString(e,"crossWalletBalance"),C=this.safeString(e,"crossMargin"));const A=this.parseNumber(C);let N,B,E,V,L;const R=this.safeValue(t,"contractSize"),D=this.numberToString(R);if(I.stringEquals(p,"0"))f=void 0;else{if(B=I.stringLt(p,"0")?"short":"long",N=this.parseNumber(I.stringDiv(I.stringAdd(I.stringDiv(c,C),"5e-5"),"1",4)),E=this.parseNumber(I.stringMul(I.stringDiv(_,n,4),"100")),d){let e,t=u;"short"===B?e=I.stringAdd("1",k):(e=I.stringAdd("-1",k),t=I.stringMul("-1",t));const i=I.stringDiv(P,I.stringMul(b,e)),s=I.stringDiv(t,e);V=I.stringAdd(i,s)}else{let e,t=u;"short"===B?e=I.stringSub("1",k):(e=I.stringSub("-1",k),t=I.stringMul("-1",t));const i=I.stringMul(b,D),s=I.stringMul(i,e),r=I.stringSub(I.stringMul(I.stringDiv("1",t),i),P);V=I.stringDiv(s,r)}const e=t.precision.price,i=(e+1).toString(),s=new I("5e-"+i).toString(),r=I.stringAdd(s,V);let a=I.stringDiv(r,"1",e);"-"===a[0]&&(a=void 0),L=this.parseNumber(a)}const F="BOTH"!==this.safeString(e,"positionSide");return{info:e,id:void 0,symbol:s,timestamp:M,datetime:this.iso8601(M),initialMargin:o,initialMarginPercentage:this.parseNumber(h),maintenanceMargin:l,maintenanceMarginPercentage:T,entryPrice:f,notional:g,leverage:this.parseNumber(r),unrealizedPnl:O,contracts:v,contractSize:R,marginRatio:N,liquidationPrice:L,markPrice:void 0,collateral:A,marginMode:x,side:B,hedged:F,percentage:E}}parsePositionRisk(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t,void 0,"contract");const s=this.safeString(t,"symbol"),r=this.safeValue(this.options,"leverageBrackets",{}),a=this.safeValue(r,s,[]),n=this.safeString2(e,"notional","notionalValue"),o=I.stringAbs(n);let h;for(let e=0;e<a.length;e++){const t=a[e];if(I.stringLt(o,t[0]))break;h=t[1]}const d=this.parseNumber(o),c=I.stringAbs(this.safeString(e,"positionAmt")),l=this.parseNumber(c),u=this.safeString(e,"unRealizedProfit"),f=this.parseNumber(u),p=this.safeString(e,"leverage"),m=parseInt(p),g=this.omitZero(this.safeString(e,"liquidationPrice")),y=this.parseNumber(g);let b;const v=this.safeString(e,"marginType");let w;I.stringGt(n,"0")?w="long":I.stringLt(n,"0")&&(w="short");const S=this.safeString(e,"entryPrice"),k=this.parseNumber(S),T=this.safeValue(t,"contractSize"),_=this.numberToString(T),O="notional"in e;if("cross"===v){const e=this.safeValue(t,"precision",{});if(O){let t,i=S;"short"===w?(t=I.stringAdd("1",h),i=I.stringMul("-1",i)):t=I.stringAdd("-1",h);const s=I.stringMul(g,t),r=I.stringAdd(s,i),a=this.safeInteger(e,"price"),n=this.safeInteger(e,"quote",a);void 0!==n&&(b=I.stringDiv(I.stringMul(r,c),"1",n))}else{let t,i=S;"short"===w?t=I.stringSub("1",h):(t=I.stringSub("-1",h),i=I.stringMul("-1",i));const s=I.stringMul(c,_),r=I.stringSub(I.stringDiv("1",i),I.stringDiv(t,g)),a=this.safeInteger(e,"base");void 0!==a&&(b=I.stringDiv(I.stringMul(s,r),"1",a))}}else b=this.safeString(e,"isolatedMargin");b=void 0===b?"0":b;const M=this.parseNumber(b),x=this.parseNumber(this.omitZero(this.safeString(e,"markPrice")));let C=this.safeInteger(e,"updateTime");0===C&&(C=void 0);const P=this.parseNumber(h),A=I.stringMul(h,o),N=this.parseNumber(A);let B=I.stringDiv("1",p,8);1e3%m==0||(B=I.stringAdd(B,"1e-8"));const E=I.stringDiv(I.stringMul(o,B),"1",8),V=this.parseNumber(E);let L,R;I.stringEquals(b,"0")||(L=this.parseNumber(I.stringDiv(I.stringAdd(I.stringDiv(A,b),"5e-5"),"1",4)),R=this.parseNumber(I.stringMul(I.stringDiv(u,E,4),"100")));const D="BOTH"!==this.safeString(e,"positionSide");return{info:e,id:void 0,symbol:s,contracts:l,contractSize:T,unrealizedPnl:f,leverage:this.parseNumber(p),liquidationPrice:y,collateral:M,notional:d,markPrice:x,entryPrice:k,timestamp:C,initialMargin:V,initialMarginPercentage:this.parseNumber(B),maintenanceMargin:N,maintenanceMarginPercentage:P,marginRatio:L,datetime:this.iso8601(C),marginMode:v,marginType:v,side:w,hedged:D,percentage:R}}async loadLeverageBrackets(e=!1,t={}){await this.loadMarkets();if(void 0===this.safeValue(this.options,"leverageBrackets")||e){let e;const i=this.safeString(this.options,"defaultType","future"),s=this.safeString(t,"type",i),r=this.omit(t,"type");let a;if([a,t]=this.handleSubTypeAndParams("loadLeverageBrackets",void 0,t,"linear"),this.isLinear(s,a))e="fapiPrivateGetLeverageBracket";else{if(!this.isInverse(s,a))throw new m(this.id+" loadLeverageBrackets() supports linear and inverse contracts only");e="dapiPrivateV2GetLeverageBracket"}const n=await this[e](r);this.options.leverageBrackets={};for(let e=0;e<n.length;e++){const t=n[e],i=this.safeString(t,"symbol"),s=this.safeSymbol(i,void 0,void 0,"contract"),r=this.safeValue(t,"brackets",[]),a=[];for(let e=0;e<r.length;e++){const t=r[e],i=this.safeString2(t,"notionalFloor","qtyFloor"),s=this.safeString(t,"maintMarginRatio");a.push([i,s])}this.options.leverageBrackets[s]=a}}return this.options.leverageBrackets}async fetchLeverageTiers(e,t={}){await this.loadMarkets();const[i,s]=this.handleMarketTypeAndParams("fetchLeverageTiers",void 0,t);let r,a;if([r,t]=this.handleSubTypeAndParams("fetchLeverageTiers",void 0,t,"linear"),this.isLinear(i,r))a="fapiPrivateGetLeverageBracket";else{if(!this.isInverse(i,r))throw new m(this.id+" fetchLeverageTiers() supports linear and inverse contracts only");a="dapiPrivateV2GetLeverageBracket"}const n=await this[a](s);return this.parseLeverageTiers(n,e,"symbol")}parseMarketLeverageTiers(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t,void 0,"contract");const s=this.safeValue(e,"brackets",[]),r=[];for(let e=0;e<s.length;e++){const i=s[e];r.push({tier:this.safeNumber(i,"bracket"),currency:t.quote,minNotional:this.safeNumber2(i,"notionalFloor","qtyFloor"),maxNotional:this.safeNumber2(i,"notionalCap","qtyCap"),maintenanceMarginRate:this.safeNumber(i,"maintMarginRatio"),maxLeverage:this.safeNumber(i,"initialLeverage"),info:i})}return r}async fetchPositions(e,t={}){const i=this.safeString(this.options,"fetchPositions","positionRisk");if("positionRisk"===i)return await this.fetchPositionsRisk(e,t);if("account"===i)return await this.fetchAccountPositions(e,t);throw new m(this.id+'.options["fetchPositions"] = "'+i+'" is invalid, please choose between "account" and "positionRisk"')}async fetchAccountPositions(e,t={}){if(void 0!==e&&!Array.isArray(e))throw new a(this.id+" fetchPositions() requires an array argument for symbols");let i;await this.loadMarkets(),await this.loadLeverageBrackets(!1,t);const s=this.safeString(this.options,"defaultType","future"),r=this.safeString(t,"type",s);let n,o=this.omit(t,"type");if([n,o]=this.handleSubTypeAndParams("fetchAccountPositions",void 0,t,"linear"),this.isLinear(r,n))i="fapiPrivateGetAccount";else{if(!this.isInverse(r,n))throw new m(this.id+" fetchPositions() supports linear and inverse contracts only");i="dapiPrivateGetAccount"}const h=await this[i](o),d=this.parseAccountPositions(h);return e=this.marketSymbols(e),this.filterByArray(d,"symbol",e,!1)}async fetchPositionsRisk(e,t={}){if(void 0!==e&&!Array.isArray(e))throw new a(this.id+" fetchPositionsRisk() requires an array argument for symbols");await this.loadMarkets(),await this.loadLeverageBrackets(!1,t);let i,s="future";s=this.safeString(this.options,"defaultType",s);const r=this.safeString(t,"type",s);let n;if([n,t]=this.handleSubTypeAndParams("fetchPositionsRisk",void 0,t,"linear"),t=this.omit(t,"type"),this.isLinear(r,n))i="fapiPrivateGetPositionRisk";else{if(!this.isInverse(r,n))throw new m(this.id+" fetchPositionsRisk() supports linear and inverse contracts only");i="dapiPrivateGetPositionRisk"}const o=await this[i](this.extend({},t)),h=[];for(let e=0;e<o.length;e++){const t=this.parsePositionRisk(o[e]);h.push(t)}return e=this.marketSymbols(e),this.filterByArray(h,"symbol",e,!1)}async fetchFundingHistory(e,t,i,s={}){let r,a;await this.loadMarkets();const n={incomeType:"FUNDING_FEE"};if(void 0!==e&&(r=this.market(e),n.symbol=r.id,!r.swap))throw new m(this.id+" fetchFundingHistory() supports swap contracts only");let o;[o,s]=this.handleSubTypeAndParams("fetchFundingHistory",r,s,"linear"),void 0!==t&&(n.startTime=t),void 0!==i&&(n.limit=i);const h=this.safeString2(this.options,"fetchFundingHistory","defaultType","future"),d=this.safeString(s,"type",h);if(s=this.omit(s,"type"),this.isLinear(d,o))a="fapiPrivateGetIncome";else{if(!this.isInverse(d,o))throw new m(this.id+" fetchFundingHistory() supports linear and inverse contracts only");a="dapiPrivateGetIncome"}const c=await this[a](this.extend(n,s));return this.parseIncomes(c,r,t,i)}async setLeverage(e,t,i={}){if(void 0===t)throw new a(this.id+" setLeverage() requires a symbol argument");if(e<1||e>125)throw new g(this.id+" leverage should be between 1 and 125");await this.loadMarkets();const s=this.market(t);let r;if(s.linear)r="fapiPrivatePostLeverage";else{if(!s.inverse)throw new m(this.id+" setLeverage() supports linear and inverse contracts only");r="dapiPrivatePostLeverage"}const n={symbol:s.id,leverage:e};return await this[r](this.extend(n,i))}async setMarginMode(e,t,i={}){if(void 0===t)throw new a(this.id+" setMarginMode() requires a symbol argument");if("CROSS"===(e=e.toUpperCase())&&(e="CROSSED"),"ISOLATED"!==e&&"CROSSED"!==e)throw new g(this.id+" marginMode must be either isolated or cross");await this.loadMarkets();const s=this.market(t);let r;if(s.linear)r="fapiPrivatePostMarginType";else{if(!s.inverse)throw new m(this.id+" setMarginMode() supports linear and inverse contracts only");r="dapiPrivatePostMarginType"}const n={symbol:s.id,marginType:e};let o;try{o=await this[r](this.extend(n,i))}catch(e){if(e instanceof _){if(this.safeValue(this.options,"throwMarginModeAlreadySet",!1))throw e;o={code:-4046,msg:"No need to change margin type."}}}return o}async setPositionMode(e,t,i={}){const s=this.safeString(this.options,"defaultType","future"),r=this.safeString(i,"type",s);let a;i=this.omit(i,["type"]),a=e?"true":"false";const n={dualSidePosition:a};let o;return o=this.isInverse(r)?"dapiPrivatePostPositionSideDual":"fapiPrivatePostPositionSideDual",await this[o](this.extend(n,i))}sign(e,t="public",i="GET",s={},r,a){if(!(t in this.urls.api))throw new m(this.id+" does not have a testnet/sandbox URL for "+t+" endpoints");let n=this.urls.api[t];if(n+="/"+e,"wapi"===t&&(n+=".html"),"historicalTrades"===e){if(!this.apiKey)throw new u(this.id+" historicalTrades endpoint requires `apiKey` credential");r={"X-MBX-APIKEY":this.apiKey}}if("userDataStream"===e||"listenKey"===e){if(!this.apiKey)throw new u(this.id+" userDataStream endpoint requires `apiKey` credential");r={"X-MBX-APIKEY":this.apiKey,"Content-Type":"application/x-www-form-urlencoded"},"GET"!==i&&(a=this.urlencode(s))}else if("private"===t||"eapiPrivate"===t||"sapi"===t&&"system/status"!==e||"sapiV2"===t||"sapiV3"===t||"wapi"===t&&"systemStatus"!==e||"dapiPrivate"===t||"dapiPrivateV2"===t||"fapiPrivate"===t||"fapiPrivateV2"===t){let o;this.checkRequiredCredentials();const h=this.safeInteger(this.options,"recvWindow"),d=this.extend({timestamp:this.nonce()},s);void 0!==h&&(d.recvWindow=h);const c=this.safeInteger(s,"recvWindow");let l;void 0!==c&&(d.recvWindow=c),o="sapi"===t&&"asset/dust"===e?this.urlencodeWithArrayRepeat(d):"batchOrders"===e||e.indexOf("sub-account")>=0||"capital/withdraw/apply"===e||e.indexOf("staking")>=0?this.rawencode(d):this.urlencode(d),l=this.secret.indexOf("PRIVATE KEY")>-1?this.encodeURIComponent(this.rsa(o,this.secret)):this.hmac(this.encode(o),this.encode(this.secret)),o+="&signature="+l,r={"X-MBX-APIKEY":this.apiKey},"GET"===i||"DELETE"===i||"wapi"===t?n+="?"+o:(a=o,r["Content-Type"]="application/x-www-form-urlencoded")}else Object.keys(s).length&&(n+="?"+this.urlencode(s));return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,l){if(418===e||429===e)throw new c(this.id+" "+e.toString()+" "+t+" "+n);if(e>=400){if(n.indexOf("Price * QTY is zero or less")>=0)throw new d(this.id+" order cost = amount * price is zero or less "+n);if(n.indexOf("LOT_SIZE")>=0)throw new d(this.id+" order amount should be evenly divisible by lot size "+n);if(n.indexOf("PRICE_FILTER")>=0)throw new d(this.id+" order price is invalid, i.e. exceeds allowed price precision, exceeds min price or max price limits or is invalid value in general, use this.priceToPrecision (symbol, amount) "+n)}if(void 0===o)return;const u=this.safeValue(o,"success",!0);if(!u){const e=this.safeString(o,"msg");let t;if(void 0!==e){try{t=JSON.parse(e)}catch(e){t=void 0}void 0!==t&&(o=t)}}const f=this.safeString(o,"msg");void 0!==f&&(this.throwExactlyMatchedException(this.exceptions.exact,f,this.id+" "+f),this.throwBroadlyMatchedException(this.exceptions.broad,f,this.id+" "+f));const p=this.safeString(o,"code");if(void 0!==p){if("200"===p||I.stringEquals(p,"0"))return;if("-2015"===p&&this.options.hasAlreadyAuthenticatedSuccessfully)throw new c(this.id+" "+n);const e=this.id+" "+n;if("No need to change margin type."===f)throw new _(e);throw this.throwExactlyMatchedException(this.exceptions.exact,p,e),new r(e)}if(!u)throw new r(this.id+" "+n)}calculateRateLimiterCost(e,t,i,s,r={},a={}){if("noCoin"in r&&!("coin"in s))return r.noCoin;if("noSymbol"in r&&!("symbol"in s))return r.noSymbol;if("noPoolId"in r&&!("poolId"in s))return r.noPoolId;if("byLimit"in r&&"limit"in s){const e=s.limit,t=r.byLimit;for(let i=0;i<t.length;i++){const s=t[i];if(e<=s[0])return s[1]}}return this.safeValue(r,"cost",1)}async request(e,t="public",i="GET",s={},r,a,n={},o={}){const h=await this.fetch2(e,t,i,s,r,a,n,o);return"private"!==t&&"wapi"!==t||(this.options.hasAlreadyAuthenticatedSuccessfully=!0),h}async modifyMarginHelper(e,t,i,s={}){let r=this.safeString(this.options,"defaultType","future");"spot"===r&&(r="future");const a=this.safeString(s,"type",r);if("margin"===a||"spot"===a)throw new m(this.id+" add / reduce margin only supported with type future or delivery");await this.loadMarkets();const n=this.market(e);t=this.amountToPrecision(e,t);const o={type:i,symbol:n.id,amount:t};let h,d;n.linear?(h="fapiPrivatePostPositionMargin",d=n.quote):(h="dapiPrivatePostPositionMargin",d=n.base);const c=await this[h](this.extend(o,s));return this.extend(this.parseMarginModification(c,n),{code:d})}parseMarginModification(e,t){const i=1===this.safeInteger(e,"type")?"add":"reduce",s=this.safeNumber(e,"amount"),r="200"===this.safeString(e,"code")?"ok":"failed";return{info:e,type:i,amount:s,code:void 0,symbol:t.symbol,status:r}}async reduceMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,2,i)}async addMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,1,i)}async fetchBorrowRate(e,t={}){await this.loadMarkets();const i={asset:this.currency(e).id},s=await this.sapiGetMarginInterestRateHistory(this.extend(i,t)),r=this.safeValue(s,0);return this.parseBorrowRate(r)}async fetchBorrowRateHistory(e,t,i,s={}){if(await this.loadMarkets(),void 0===i)i=93;else if(i>93)throw new g(this.id+" fetchBorrowRateHistory() limit parameter cannot exceed 92");const r={asset:this.currency(e).id,limit:i};if(void 0!==t){r.startTime=t;const e=this.sum(t,864e5*i)-1,s=this.milliseconds();r.endTime=Math.min(e,s)}const a=await this.sapiGetMarginInterestRateHistory(this.extend(r,s));return this.parseBorrowRateHistory(a,e,t,i)}parseBorrowRateHistory(e,t,i,s){const r=[];for(let t=0;t<e.length;t++){const i=e[t],s=this.parseBorrowRate(i);r.push(s)}const a=this.sortBy(r,"timestamp");return this.filterByCurrencySinceLimit(a,t,i,s)}parseBorrowRate(e,t){const i=this.safeNumber(e,"timestamp");return t=this.safeString(e,"asset"),{currency:this.safeCurrencyCode(t),rate:this.safeNumber(e,"dailyInterestRate"),period:864e5,timestamp:i,datetime:this.iso8601(i),info:e}}async createGiftCode(e,t,i={}){await this.loadMarkets();const s={token:this.currency(e).id,amount:t},r=await this.sapiPostGiftcardCreateCode(this.extend(s,i)),a=this.safeValue(r,"data"),n=this.safeString(a,"code");return{info:r,id:this.safeString(a,"referenceNo"),code:n,currency:e,amount:t}}async redeemGiftCode(e,t={}){const i={code:e};return await this.sapiPostGiftcardRedeemCode(this.extend(i,t))}async verifyGiftCode(e,t={}){const i={referenceNo:e};return await this.sapiGetGiftcardVerify(this.extend(i,t))}async fetchBorrowInterest(e,t,i,s,r={}){await this.loadMarkets();const a={};let n;if(void 0!==e){const t=this.currency(e);a.asset=t.id}void 0!==i&&(a.startTime=i),void 0!==s&&(a.size=s),void 0!==t&&(n=this.market(t),a.isolatedSymbol=n.id);const o=await this.sapiGetMarginInterestHistory(this.extend(a,r)),h=this.safeValue(o,"rows"),d=this.parseBorrowInterests(h,n);return this.filterByCurrencySinceLimit(d,e,i,s)}parseBorrowInterest(e,t){const i=this.safeString(e,"isolatedSymbol"),s=this.safeNumber(e,"interestAccuredTime");return{account:void 0===i?"cross":i,symbol:i,marginMode:void 0===i?"cross":"isolated",currency:this.safeCurrencyCode(this.safeString(e,"asset")),interest:this.safeNumber(e,"interest"),interestRate:this.safeNumber(e,"interestRate"),amountBorrowed:this.safeNumber(e,"principal"),timestamp:s,datetime:this.iso8601(s),info:e}}async repayMargin(e,t,i,s={}){const[r,a]=this.handleMarginModeAndParams("repayMargin",s);this.checkRequiredMarginArgument("repayMargin",i,r),await this.loadMarkets();const n=this.currency(e),o={asset:n.id,amount:this.currencyToPrecision(e,t)};if(void 0!==i){const e=this.market(i);o.symbol=e.id,o.isIsolated="TRUE"}const h=await this.sapiPostMarginRepay(this.extend(o,a));return this.parseMarginLoan(h,n)}async borrowMargin(e,t,i,s={}){const[r,a]=this.handleMarginModeAndParams("borrowMargin",s);this.checkRequiredMarginArgument("borrowMargin",i,r),await this.loadMarkets();const n=this.currency(e),o={asset:n.id,amount:this.currencyToPrecision(e,t)};if(void 0!==i){const e=this.market(i);o.symbol=e.id,o.isIsolated="TRUE"}const h=await this.sapiPostMarginLoan(this.extend(o,a));return this.parseMarginLoan(h,n)}parseMarginLoan(e,t){return{id:this.safeInteger(e,"tranId"),currency:this.safeCurrencyCode(void 0,t),amount:void 0,symbol:void 0,timestamp:void 0,datetime:void 0,info:e}}async fetchOpenInterestHistory(e,t="5m",i,s,r={}){if("1m"===t)throw new g(this.id+"fetchOpenInterestHistory cannot use the 1m timeframe");await this.loadMarkets();const a=this.market(e),n={period:this.safeString(this.timeframes,t,t)};void 0!==s&&(n.limit=s);n[a.linear?"symbol":"pair"]=a.id,a.inverse&&(n.contractType=this.safeString(r,"contractType","CURRENT_QUARTER")),void 0!==i&&(n.startTime=i);const o=this.safeInteger2(r,"until","till"),h=this.safeInteger(r,"endTime",o);if(r=this.omit(r,["endTime","until","till"]),h)n.endTime=h;else if(i){void 0===s&&(s=30);const e=this.parseTimeframe(t);n.endTime=this.sum(i,e*s*1e3)}let d="fapiDataGetOpenInterestHist";a.inverse&&(d="dapiDataGetOpenInterestHist");const c=await this[d](this.extend(n,r));return this.parseOpenInterests(c,e,i,s)}parseOpenInterest(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeString(e,"symbol"),r=this.safeNumber(e,"sumOpenInterest"),a=this.safeNumber(e,"sumOpenInterestValue");return{symbol:this.safeSymbol(s,void 0,void 0,"contract"),baseVolume:r,quoteVolume:a,openInterestAmount:r,openInterestValue:a,timestamp:i,datetime:this.iso8601(i),info:e}}}},42483:function(e,t,i){"use strict";const s=i(96056);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"binancecoinm",name:"Binance COIN-M",urls:{logo:"https://user-images.githubusercontent.com/1294454/117738721-668c8d80-b205-11eb-8c49-3fad84c4a07f.jpg",doc:["https://binance-docs.github.io/apidocs/delivery/en/","https://binance-docs.github.io/apidocs/spot/en"]},has:{CORS:void 0,spot:!1,margin:!1,swap:!0,future:!0,option:void 0,createStopMarketOrder:!0},options:{fetchMarkets:["inverse"],defaultSubType:"inverse",leverageBrackets:void 0}})}async transferIn(e,t,i={}){return await this.futuresTransfer(e,t,3,i)}async transferOut(e,t,i={}){return await this.futuresTransfer(e,t,4,i)}}},3393:function(e,t,i){"use strict";const s=i(96056);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"binanceus",name:"Binance US",countries:["US"],certified:!1,pro:!0,urls:{logo:"https://user-images.githubusercontent.com/1294454/65177307-217b7c80-da5f-11e9-876e-0b748ba0a358.jpg",api:{web:"https://www.binance.us",sapi:"https://api.binance.us/sapi/v1",wapi:"https://api.binance.us/wapi/v3",public:"https://api.binance.us/api/v3",private:"https://api.binance.us/api/v3"},www:"https://www.binance.us",referral:"https://www.binance.us/?ref=35005074",doc:"https://github.com/binance-us/binance-official-api-docs",fees:"https://www.binance.us/en/fee/schedule"},fees:{trading:{tierBased:!0,percentage:!0,taker:this.parseNumber("0.001"),maker:this.parseNumber("0.001")}},options:{fetchMarkets:["spot"],defaultType:"spot",quoteOrderQty:!1},has:{CORS:void 0,spot:!0,margin:void 0,swap:void 0,future:void 0,option:void 0}})}}},12137:function(e,t,i){"use strict";const s=i(96056);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"binanceusdm",name:"Binance USDⓈ-M",urls:{logo:"https://user-images.githubusercontent.com/1294454/117738721-668c8d80-b205-11eb-8c49-3fad84c4a07f.jpg",doc:["https://binance-docs.github.io/apidocs/futures/en/","https://binance-docs.github.io/apidocs/spot/en"]},has:{CORS:void 0,spot:!1,margin:!1,swap:!0,future:!0,option:void 0,createStopMarketOrder:!0},options:{fetchMarkets:["linear"],defaultSubType:"linear",leverageBrackets:void 0,marginTypes:{},marginModes:{}}})}async transferIn(e,t,i={}){return await this.futuresTransfer(e,t,1,i)}async transferOut(e,t,i={}){return await this.futuresTransfer(e,t,2,i)}}},12455:function(e,t,i){"use strict";const s=i(48819),{ArgumentsRequired:r,ExchangeError:a,InvalidNonce:n,AuthenticationError:o,PermissionDenied:h,NotSupported:d,OrderNotFound:c}=i(73449),{TICK_SIZE:l}=i(62115),u=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bit2c",name:"Bit2C",countries:["IL"],rateLimit:3e3,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchDepositAddress:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransfer:!1,fetchTransfers:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1},urls:{logo:"https://user-images.githubusercontent.com/1294454/27766119-3593220e-5ece-11e7-8b3a-5a041f6bcc3f.jpg",api:{rest:"https://bit2c.co.il"},www:"https://www.bit2c.co.il",referral:"https://bit2c.co.il/Aff/63bfed10-e359-420c-ab5a-ad368dab0baf",doc:["https://www.bit2c.co.il/home/api","https://github.com/OferE/bit2c"]},api:{public:{get:["Exchanges/{pair}/Ticker","Exchanges/{pair}/orderbook","Exchanges/{pair}/trades","Exchanges/{pair}/lasttrades"]},private:{post:["Merchant/CreateCheckout","Funds/AddCoinFundsRequest","Order/AddFund","Order/AddOrder","Order/GetById","Order/AddOrderMarketPriceBuy","Order/AddOrderMarketPriceSell","Order/CancelOrder","Order/AddCoinFundsRequest","Order/AddStopOrder","Payment/GetMyId","Payment/Send","Payment/Pay"],get:["Account/Balance","Account/Balance/v2","Order/MyOrders","Order/GetById","Order/AccountHistory","Order/OrderHistory"]}},markets:{"BTC/NIS":{id:"BtcNis",symbol:"BTC/NIS",base:"BTC",quote:"NIS",baseId:"Btc",quoteId:"Nis",type:"spot",spot:!0},"ETH/NIS":{id:"EthNis",symbol:"ETH/NIS",base:"ETH",quote:"NIS",baseId:"Eth",quoteId:"Nis",type:"spot",spot:!0},"LTC/NIS":{id:"LtcNis",symbol:"LTC/NIS",base:"LTC",quote:"NIS",baseId:"Ltc",quoteId:"Nis",type:"spot",spot:!0},"USDC/NIS":{id:"UsdcNis",symbol:"USDC/NIS",base:"USDC",quote:"NIS",baseId:"Usdc",quoteId:"Nis",type:"spot",spot:!0}},fees:{trading:{tierBased:!0,percentage:!0,maker:this.parseNumber("0.025"),taker:this.parseNumber("0.03"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.03")],[this.parseNumber("20000"),this.parseNumber("0.0275")],[this.parseNumber("50000"),this.parseNumber("0.025")],[this.parseNumber("75000"),this.parseNumber("0.0225")],[this.parseNumber("100000"),this.parseNumber("0.02")],[this.parseNumber("250000"),this.parseNumber("0.015")],[this.parseNumber("500000"),this.parseNumber("0.0125")],[this.parseNumber("750000"),this.parseNumber("0.01")],[this.parseNumber("1000000"),this.parseNumber("0.008")],[this.parseNumber("2000000"),this.parseNumber("0.006")],[this.parseNumber("3000000"),this.parseNumber("0.004")],[this.parseNumber("4000000"),this.parseNumber("0.002")]],maker:[[this.parseNumber("0"),this.parseNumber("0.025")],[this.parseNumber("20000"),this.parseNumber("0.0225")],[this.parseNumber("50000"),this.parseNumber("0.02")],[this.parseNumber("75000"),this.parseNumber("0.0175")],[this.parseNumber("100000"),this.parseNumber("0.015")],[this.parseNumber("250000"),this.parseNumber("0.01")],[this.parseNumber("500000"),this.parseNumber("0.0075")],[this.parseNumber("750000"),this.parseNumber("0.005")],[this.parseNumber("1000000"),this.parseNumber("0.004")],[this.parseNumber("2000000"),this.parseNumber("0.003")],[this.parseNumber("3000000"),this.parseNumber("0.002")],[this.parseNumber("4000000"),this.parseNumber("0.001")]]}}},options:{fetchTradesMethod:"public_get_exchanges_pair_trades"},precisionMode:l,exceptions:{exact:{"Please provide valid APIkey":o,"No order found.":c},broad:{"Please provide valid nonce":n,"please approve new terms of use on site":h}}})}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0},i=Object.keys(this.currencies);for(let s=0;s<i.length;s++){const r=i[s],a=this.account(),n=this.currency(r).id.toUpperCase();n in e&&(a.free=this.safeString(e,"AVAILABLE_"+n),a.total=this.safeString(e,n)),t[r]=a}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetAccountBalanceV2(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={pair:s.id},a=await this.publicGetExchangesPairOrderbook(this.extend(r,i));return this.parseOrderBook(a,s.symbol)}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.milliseconds(),r=this.safeString(e,"av"),a=this.safeString(e,"a"),n=this.safeString(e,"ll");return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:void 0,low:void 0,bid:this.safeString(e,"h"),bidVolume:void 0,ask:this.safeString(e,"l"),askVolume:void 0,vwap:void 0,open:void 0,close:n,last:n,previousClose:void 0,change:void 0,percentage:void 0,average:r,baseVolume:a,quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={pair:i.id},r=await this.publicGetExchangesPairTicker(this.extend(s,t));return this.parseTicker(r,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),n=this.options.fetchTradesMethod,o={pair:r.id};void 0!==t&&(o.date=parseInt(t)),void 0!==i&&(o.limit=i);const h=await this[n](this.extend(o,s));if("string"==typeof h)throw new a(h);return this.parseTrades(h,r,t,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privateGetAccountBalance(e),i=this.safeValue(t,"Fees",{}),s=Object.keys(i),r={};for(let e=0;e<s.length;e++){const t=s[e],a=this.safeSymbol(t),n=this.safeValue(i,t),o=this.safeString(n,"FeeMaker"),h=this.safeString(n,"FeeTaker"),d=this.parseNumber(u.stringDiv(o,"100")),c=this.parseNumber(u.stringDiv(h,"100"));r[a]={info:n,symbol:a,taker:c,maker:d,percentage:!0,tierBased:!0}}return r}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();let n="privatePostOrderAddOrder";const o=this.market(e),h={Amount:s,Pair:o.id};"market"===t?n+="MarketPrice"+this.capitalize(i):(h.Price=r,h.Total=s*r,h.IsBid="buy"===i);const d=await this[n](this.extend(h,a));return this.parseOrder(d,o)}async cancelOrder(e,t,i={}){const s={id:e};return await this.privatePostOrderCancelOrder(this.extend(s,i))}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new r(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const a=this.market(e),n={pair:a.id},o=await this.privateGetOrderMyOrders(this.extend(n,s)),h=this.safeValue(o,a.id,{}),d=this.safeValue(h,"ask",[]),c=this.safeValue(h,"bid",[]);return this.parseOrders(this.arrayConcat(d,c),a,t,i)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s=this.market(t),r={id:e},a=await this.privateGetOrderGetById(this.extend(r,i));return this.parseOrder(a,s)}parseOrder(e,t){let i,s=!1;"NewOrder"in e?(i=e.NewOrder,s=!0):i=e;const r=this.safeString(i,"id"),a=this.safeSymbol(void 0,t),n=this.safeIntegerProduct(i,"created",1e3);let o;if(s){const e=this.safeInteger(i,"status_type");0===e||1===e?o="open":5===e&&(o="closed")}else{const e=this.safeString(i,"status");"New"===e||"Open"===e?o="open":"Completed"===e&&(o="closed")}let h=this.safeInteger(i,"order_type");0===h?h="limit":1===h&&(h="market");let d=this.safeInteger(i,"type");0===d?d="buy":1===d&&(d="sell");const c=this.safeString(i,"price");let l,u;return s?(l=this.safeString(i,"amount"),u=this.safeString(i,"amount")):(l=this.safeString(i,"initialAmount"),u=this.safeString(i,"amount")),this.safeOrder({id:r,clientOrderId:void 0,timestamp:n,datetime:this.iso8601(n),lastTradeTimestamp:void 0,status:o,symbol:a,type:h,timeInForce:void 0,postOnly:void 0,side:d,price:c,stopPrice:void 0,triggerPrice:void 0,amount:l,filled:void 0,remaining:u,cost:void 0,trades:void 0,fee:void 0,info:e,average:void 0},t)}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==i&&(a.take=i),a.take=i,void 0!==t&&(a.toTime=this.yyyymmdd(this.milliseconds(),"."),a.fromTime=this.yyyymmdd(t,".")),void 0!==e&&(r=this.market(e),a.pair=r.id);const n=await this.privateGetOrderOrderHistory(this.extend(a,s));return this.parseTrades(n,r,t,i)}removeCommaFromValue(e){let t="";const i=e.split(",");for(let e=0;e<i.length;e++)t+=i[e];return t}parseTrade(e,t){let i,s,r,a,n,o,h,d;const c=this.safeString(e,"reference");if(void 0!==c){s=c,i=this.safeTimestamp(e,"ticks"),r=this.safeString(e,"price"),r=this.removeCommaFromValue(r),a=this.safeString(e,"firstAmount");const l=c.split("|"),u=this.safeString(e,"pair");t=this.safeMarket(u,t),t=this.safeMarket(l[0],t);const f=this.safeValue(e,"isMaker");d=f?"maker":"taker",n=f?l[2]:l[1],h=this.safeInteger(e,"action"),0===h?h="buy":1===h&&(h="sell");const p=this.safeString(e,"feeAmount");void 0!==p&&(o={cost:p,currency:"NIS"})}else i=this.safeTimestamp(e,"date"),s=this.safeString(e,"tid"),r=this.safeString(e,"price"),a=this.safeString(e,"amount"),h=this.safeValue(e,"isBid"),void 0!==h&&(h=h?"buy":"sell");return t=this.safeMarket(void 0,t),this.safeTrade({info:e,id:s,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,order:n,type:void 0,side:h,takerOrMaker:d,price:r,amount:a,cost:void 0,fee:o},t)}isFiat(e){return"NIS"===e}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e);if(this.isFiat(e))throw new d(this.id+" fetchDepositAddress() does not support fiat currencies");const s={Coin:i.id},r=await this.privatePostFundsAddCoinFundsRequest(this.extend(s,t));return this.parseDepositAddress(r,i)}parseDepositAddress(e,t){const i=this.safeString(e,"address");this.checkAddress(i);return{currency:this.safeCurrencyCode(void 0,t),network:void 0,address:i,tag:void 0,info:e}}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+this.implodeParams(e,s);if("public"===t)n+=".json";else{this.checkRequiredCredentials();const e=this.nonce(),t=this.extend({nonce:e},s),o=this.urlencode(t);"GET"===i?Object.keys(t).length&&(n+="?"+o):a=o;const h=this.hmac(this.encode(o),this.encode(this.secret),"sha512","base64");r={"Content-Type":"application/x-www-form-urlencoded",key:this.apiKey,sign:h}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,n,o,h,d){if(void 0===o)return;let c=this.safeString(o,"error");if(void 0===c&&(c=this.safeString(o,"Error")),void 0!==c){const e=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,c,e),this.throwBroadlyMatchedException(this.exceptions.broad,c,e),new a(e)}}}},99703:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,AuthenticationError:a,InvalidNonce:n,InsufficientFunds:o,InvalidOrder:h,OrderNotFound:d,PermissionDenied:c}=i(73449),{TICK_SIZE:l}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitbank",name:"bitbank",countries:["JP"],version:"v1",has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchDepositAddress:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransfer:!1,fetchTransfers:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!0},timeframes:{"1m":"1min","5m":"5min","15m":"15min","30m":"30min","1h":"1hour","4h":"4hour","8h":"8hour","12h":"12hour","1d":"1day","1w":"1week"},hostname:"bitbank.cc",urls:{logo:"https://user-images.githubusercontent.com/1294454/37808081-b87f2d9c-2e59-11e8-894d-c1900b7584fe.jpg",api:{public:"https://public.{hostname}",private:"https://api.{hostname}",markets:"https://api.{hostname}"},www:"https://bitbank.cc/",doc:"https://docs.bitbank.cc/",fees:"https://bitbank.cc/docs/fees/"},api:{public:{get:["{pair}/ticker","{pair}/depth","{pair}/transactions","{pair}/transactions/{yyyymmdd}","{pair}/candlestick/{candletype}/{yyyymmdd}"]},private:{get:["user/assets","user/spot/order","user/spot/active_orders","user/spot/trade_history","user/withdrawal_account"],post:["user/spot/order","user/spot/cancel_order","user/spot/cancel_orders","user/spot/orders_info","user/request_withdrawal"]},markets:{get:["spot/pairs"]}},precisionMode:l,exceptions:{20001:a,20002:a,20003:a,20005:a,20004:n,40020:h,40021:h,40025:r,40013:d,40014:d,50008:c,50009:d,50010:d,60001:o,60005:h}})}async fetchMarkets(e={}){const t=await this.marketsGetSpotPairs(e),i=this.safeValue(t,"data"),s=this.safeValue(i,"pairs",[]),r=[];for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"name"),a=this.safeString(t,"base_asset"),n=this.safeString(t,"quote_asset"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n);r.push({id:i,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:this.safeValue(t,"is_enabled"),contract:!1,linear:void 0,inverse:void 0,taker:this.safeNumber(t,"taker_fee_rate_quote"),maker:this.safeNumber(t,"maker_fee_rate_quote"),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"amount_digits"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"price_digits")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"unit_amount"),max:this.safeNumber(t,"limit_max_amount")},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return r}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.safeInteger(e,"timestamp"),r=this.safeString(e,"last");return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"buy"),bidVolume:void 0,ask:this.safeString(e,"sell"),askVolume:void 0,vwap:void 0,open:void 0,close:r,last:r,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"vol"),quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={pair:i.id},r=await this.publicGetPairTicker(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseTicker(a,i)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={pair:s.id},a=await this.publicGetPairDepth(this.extend(r,i)),n=this.safeValue(a,"data",{}),o=this.safeInteger(n,"timestamp");return this.parseOrderBook(n,s.symbol,o)}parseTrade(e,t){const i=this.safeInteger(e,"executed_at");t=this.safeMarket(void 0,t);const s=this.safeString(e,"price"),r=this.safeString(e,"amount"),a=this.safeString2(e,"transaction_id","trade_id"),n=this.safeString(e,"maker_taker");let o;const h=this.safeString(e,"fee_amount_quote");void 0!==h&&(o={currency:t.quote,cost:h});const d=this.safeString(e,"order_id"),c=this.safeString(e,"type"),l=this.safeString(e,"side");return this.safeTrade({timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,id:a,order:d,type:c,side:l,takerOrMaker:n,price:s,amount:r,cost:void 0,fee:o,info:e},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pair:r.id},n=await this.publicGetPairTransactions(this.extend(a,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"transactions",[]);return this.parseTrades(h,r,t,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.marketsGetSpotPairs(e),i=this.safeValue(t,"data",{}),s=this.safeValue(i,"pairs",[]),r={};for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"name"),a=this.safeMarket(i).symbol;r[a]={info:t,symbol:a,maker:this.safeNumber(t,"maker_fee_rate_quote"),taker:this.safeNumber(t,"taker_fee_rate_quote"),percentage:!0,tierBased:!1}}return r}parseOHLCV(e,t){return[this.safeInteger(e,5),this.safeNumber(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4)]}async fetchOHLCV(e,t="1m",i,s,r={}){if(void 0===i){void 0===s&&(s=1e3);const e=this.parseTimeframe(t);i=this.milliseconds()-1e3*e*s}await this.loadMarkets();const a=this.market(e),n={pair:a.id,candletype:this.safeString(this.timeframes,t,t),yyyymmdd:this.yyyymmdd(i,"")},o=await this.publicGetPairCandlestickCandletypeYyyymmdd(this.extend(n,r)),h=this.safeValue(o,"data",{}),d=this.safeValue(h,"candlestick",[]),c=this.safeValue(d,0,{}),l=this.safeValue(c,"ohlcv",[]);return this.parseOHLCVs(l,a,t,i,s)}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0},i=this.safeValue(e,"data",{}),s=this.safeValue(i,"assets",[]);for(let e=0;e<s.length;e++){const i=s[e],r=this.safeString(i,"asset"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(i,"free_amount"),n.used=this.safeString(i,"locked_amount"),n.total=this.safeString(i,"onhand_amount"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetUserAssets(e);return this.parseBalance(t)}parseOrderStatus(e){return this.safeString({UNFILLED:"open",PARTIALLY_FILLED:"open",FULLY_FILLED:"closed",CANCELED_UNFILLED:"canceled",CANCELED_PARTIALLY_FILLED:"canceled"},e,e)}parseOrder(e,t){const i=this.safeString(e,"order_id"),s=this.safeString(e,"pair");t=this.safeMarket(s,t);const r=this.safeInteger(e,"ordered_at"),a=this.safeString(e,"price"),n=this.safeString(e,"start_amount"),o=this.safeString(e,"executed_amount"),h=this.safeString(e,"remaining_amount"),d=this.safeString(e,"average_price"),c=this.parseOrderStatus(this.safeString(e,"status")),l=this.safeStringLower(e,"type"),u=this.safeStringLower(e,"side");return this.safeOrder({id:i,clientOrderId:void 0,datetime:this.iso8601(r),timestamp:r,lastTradeTimestamp:void 0,status:c,symbol:t.symbol,type:l,timeInForce:void 0,postOnly:void 0,side:u,price:a,stopPrice:void 0,triggerPrice:void 0,cost:void 0,average:d,amount:n,filled:o,remaining:h,trades:void 0,fee:void 0,info:e},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={pair:n.id,amount:this.amountToPrecision(e,s),side:i,type:t};"limit"===t&&(o.price=this.priceToPrecision(e,r));const h=await this.privatePostUserSpotOrder(this.extend(o,a)),d=this.safeValue(h,"data");return this.parseOrder(d,n)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={order_id:e,pair:this.market(t).id},r=await this.privatePostUserSpotCancelOrder(this.extend(s,i));return this.safeValue(r,"data")}async fetchOrder(e,t,i={}){await this.loadMarkets();const s=this.market(t),r={order_id:e,pair:s.id},a=await this.privateGetUserSpotOrder(this.extend(r,i)),n=this.safeValue(a,"data");return this.parseOrder(n,s)}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pair:r.id};void 0!==i&&(a.count=i),void 0!==t&&(a.since=parseInt(t/1e3));const n=await this.privateGetUserSpotActiveOrders(this.extend(a,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"orders",[]);return this.parseOrders(h,r,t,i)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.pair=a.id),void 0!==i&&(r.count=i),void 0!==t&&(r.since=parseInt(t/1e3));const n=await this.privateGetUserSpotTradeHistory(this.extend(r,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"trades",[]);return this.parseTrades(h,a,t,i)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={asset:i.id},r=await this.privateGetUserWithdrawalAccount(this.extend(s,t)),a=this.safeValue(r,"data",{}),n=this.safeValue(a,"accounts",[]),o=this.safeValue(n,0,{});return{currency:i,address:this.safeString(o,"address"),tag:void 0,network:void 0,info:r}}async withdraw(e,t,i,s,a={}){if([s,a]=this.handleWithdrawTagAndParams(s,a),!("uuid"in a))throw new r(this.id+" uuid is required for withdrawal");await this.loadMarkets();const n=this.currency(e),o={asset:n.id,amount:t},h=await this.privatePostUserRequestWithdrawal(this.extend(o,a)),d=this.safeValue(h,"data",{});return this.parseTransaction(d,n)}parseTransaction(e,t){const i=this.safeString(e,"txid");return{id:i,txid:i,timestamp:void 0,datetime:void 0,network:void 0,addressFrom:void 0,address:void 0,addressTo:void 0,amount:void 0,type:void 0,currency:(t=this.safeCurrency(void 0,t)).code,status:void 0,updated:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,comment:void 0,fee:void 0,info:e}}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.omit(s,this.extractParams(e)),o=this.implodeHostname(this.urls.api[t])+"/";if("public"===t||"markets"===t)o+=this.implodeParams(e,s),Object.keys(n).length&&(o+="?"+this.urlencode(n));else{this.checkRequiredCredentials();const t=this.nonce().toString();let h=t;o+=this.version+"/"+this.implodeParams(e,s),"POST"===i?h+=a=this.json(n):(h+="/"+this.version+"/"+e,Object.keys(n).length&&(n=this.urlencode(n),o+="?"+n,h+="?"+n)),r={"Content-Type":"application/json","ACCESS-KEY":this.apiKey,"ACCESS-NONCE":t,"ACCESS-SIGNATURE":this.hmac(this.encode(h),this.encode(this.secret))}}return{url:o,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;const c=this.safeInteger(o,"success"),l=this.safeValue(o,"data");if(!c||!l){const e={1e4:"URL does not exist",10001:"A system error occurred. Please contact support",10002:"Invalid JSON format. Please check the contents of transmission",10003:"A system error occurred. Please contact support",10005:"A timeout error occurred. Please wait for a while and try again",20001:"API authentication failed",20002:"Illegal API key",20003:"API key does not exist",20004:"API Nonce does not exist",20005:"API signature does not exist",20011:"Two-step verification failed",20014:"SMS authentication failed",30001:"Please specify the order quantity",30006:"Please specify the order ID",30007:"Please specify the order ID array",30009:"Please specify the stock",30012:"Please specify the order price",30013:"Trade Please specify either",30015:"Please specify the order type",30016:"Please specify asset name",30019:"Please specify uuid",30039:"Please specify the amount to be withdrawn",40001:"The order quantity is invalid",40006:"Count value is invalid",40007:"End time is invalid",40008:"end_id Value is invalid",40009:"The from_id value is invalid",40013:"The order ID is invalid",40014:"The order ID array is invalid",40015:"Too many specified orders",40017:"Incorrect issue name",40020:"The order price is invalid",40021:"The trading classification is invalid",40022:"Start date is invalid",40024:"The order type is invalid",40025:"Incorrect asset name",40028:"uuid is invalid",40048:"The amount of withdrawal is illegal",50003:"Currently, this account is in a state where you can not perform the operation you specified. Please contact support",50004:"Currently, this account is temporarily registered. Please try again after registering your account",50005:"Currently, this account is locked. Please contact support",50006:"Currently, this account is locked. Please contact support",50008:"User identification has not been completed",50009:"Your order does not exist",50010:"Can not cancel specified order",50011:"API not found",60001:"The number of possessions is insufficient",60002:"It exceeds the quantity upper limit of the tender buying order",60003:"The specified quantity exceeds the limit",60004:"The specified quantity is below the threshold",60005:"The specified price is above the limit",60006:"The specified price is below the lower limit",70001:"A system error occurred. Please contact support",70002:"A system error occurred. Please contact support",70003:"A system error occurred. Please contact support",70004:"We are unable to accept orders as the transaction is currently suspended",70005:"Order can not be accepted because purchase order is currently suspended",70006:"We can not accept orders because we are currently unsubscribed ",70009:"We are currently temporarily restricting orders to be carried out. Please use the limit order.",70010:"We are temporarily raising the minimum order quantity as the system load is now rising."},t=this.exceptions,i=this.safeString(l,"code"),s=this.safeString(e,i,"Error"),a=this.safeValue(t,i);throw void 0!==a?new a(s):new r(this.id+" "+this.json(o))}}}},93528:function(e,t,i){"use strict";const s=i(79264);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitbay",alias:!0})}}},98875:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,InsufficientFunds:n,OrderNotFound:o,BadRequest:h,BadSymbol:d}=i(73449),{TICK_SIZE:c}=i(62115),l=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitbns",name:"Bitbns",countries:["IN"],rateLimit:1e3,certified:!1,pro:!1,version:"v2",has:{CORS:void 0,spot:!0,margin:void 0,swap:!1,future:!1,option:void 0,cancelOrder:!0,createOrder:!0,fetchBalance:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPositionMode:!1,fetchPremiumIndexOHLCV:!1,fetchStatus:!0,fetchTicker:"emulated",fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!1,fetchWithdrawals:!0,transfer:!1,withdraw:!1},hostname:"bitbns.com",urls:{logo:"https://user-images.githubusercontent.com/1294454/117201933-e7a6e780-adf5-11eb-9d80-98fc2a21c3d6.jpg",api:{www:"https://{hostname}",v1:"https://api.{hostname}/api/trade/v1",v2:"https://api.{hostname}/api/trade/v2"},www:"https://bitbns.com",referral:"https://ref.bitbns.com/1090961",doc:["https://bitbns.com/trade/#/api-trading/"],fees:"https://bitbns.com/fees"},api:{www:{get:["order/fetchMarkets","order/fetchTickers","order/fetchOrderbook","order/getTickerWithVolume","exchangeData/ohlc","exchangeData/orderBook","exchangeData/tradedetails"]},v1:{get:["platform/status","tickers","orderbook/sell/{symbol}","orderbook/buy/{symbol}"],post:["currentCoinBalance/EVERYTHING","getApiUsageStatus/USAGE","getOrderSocketToken/USAGE","currentCoinBalance/{symbol}","orderStatus/{symbol}","depositHistory/{symbol}","withdrawHistory/{symbol}","withdrawHistoryAll/{symbol}","depositHistoryAll/{symbol}","listOpenOrders/{symbol}","listOpenStopOrders/{symbol}","getCoinAddress/{symbol}","placeSellOrder/{symbol}","placeBuyOrder/{symbol}","buyStopLoss/{symbol}","sellStopLoss/{symbol}","placeSellOrder/{symbol}","cancelOrder/{symbol}","cancelStopLossOrder/{symbol}","listExecutedOrders/{symbol}","placeMarketOrder/{symbol}","placeMarketOrderQnty/{symbol}"]},v2:{post:["orders","cancel","getordersnew","marginOrders"]}},fees:{trading:{feeSide:"quote",tierBased:!1,percentage:!0,taker:this.parseNumber("0.0025"),maker:this.parseNumber("0.0025")}},precisionMode:c,exceptions:{exact:{400:h,409:d,416:n,417:o},broad:{}}})}async fetchStatus(e={}){const t=await this.v1GetPlatformStatus(e),i=this.safeString(t,"status");return{status:this.safeString({1:"ok"},i,i),updated:void 0,eta:void 0,url:void 0,info:t}}async fetchMarkets(e={}){const t=await this.wwwGetOrderFetchMarkets(e),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"id"),a=this.safeString(s,"base"),n=this.safeString(s,"quote"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=this.safeValue(s,"precision",{}),c=this.safeValue(s,"limits",{}),l=this.safeValue(c,"amount",{}),u=this.safeValue(c,"price",{}),f=this.safeValue(c,"cost",{}),p="USDT"===n?a+"_"+n:a;i.push({id:r,uppercaseId:p,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(d,"amount"))),price:this.parseNumber(this.parsePrecision(this.safeString(d,"price")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(l,"min"),max:this.safeNumber(l,"max")},price:{min:this.safeNumber(u,"min"),max:this.safeNumber(u,"max")},cost:{min:this.safeNumber(f,"min"),max:this.safeNumber(f,"max")}},info:s})}return i}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};void 0!==t&&(r.limit=t);const a=await this.wwwGetOrderFetchOrderbook(this.extend(r,i)),n=this.safeInteger(a,"timestamp");return this.parseOrderBook(a,s.symbol,n)}parseTicker(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeString(e,"symbol"),r=this.safeSymbol(s,t),a=this.safeString(e,"last");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:this.safeString(e,"bidVolume"),ask:this.safeString(e,"ask"),askVolume:this.safeString(e,"askVolume"),vwap:this.safeString(e,"vwap"),open:this.safeString(e,"open"),close:a,last:a,previousClose:this.safeString(e,"previousClose"),change:this.safeString(e,"change"),percentage:this.safeString(e,"percentage"),average:this.safeString(e,"average"),baseVolume:this.safeString(e,"baseVolume"),quoteVolume:this.safeString(e,"quoteVolume"),info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.wwwGetOrderFetchTickers(t);return this.parseTickers(i,e)}parseBalance(e){const t=void 0,i={info:e,timestamp:t,datetime:this.iso8601(t)},s=this.safeValue(e,"data",{}),r=Object.keys(s);for(let e=0;e<r.length;e++){const t=r[e],a=t.split("availableorder");if(a.length>1){let e=this.safeString(a,1);"Money"===e&&(e="INR");const r=this.safeCurrencyCode(e),n=this.account();n.free=this.safeString(s,t),n.used=this.safeString(s,"inorder"+e),i[r]=n}}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.v1PostCurrentCoinBalanceEVERYTHING(e);return this.parseBalance(t)}parseOrderStatus(e){return this.safeString({0:"open"},e,e)}parseOrder(e,t){const i=this.safeString2(e,"id","entry_id"),s=this.safeString(e,"symbol"),r=this.safeSymbol(s,t),a=this.parse8601(this.safeString(e,"time")),n=this.safeString(e,"rate"),o=this.safeString2(e,"amount","btc"),h=this.safeString(e,"filled"),d=this.safeString(e,"remaining"),c=this.safeString(e,"avg_cost"),l=this.safeString(e,"cost");let u=this.safeStringLower(e,"type");"0"===u&&(u="limit");const f=this.parseOrderStatus(this.safeString(e,"status")),p=this.safeStringLower(e,"side"),m=this.safeNumber(e,"fee");let g;if(void 0!==m){g={cost:m,currency:void 0}}return this.safeOrder({info:e,id:i,clientOrderId:void 0,timestamp:a,datetime:this.iso8601(a),lastTradeTimestamp:void 0,symbol:r,type:u,timeInForce:void 0,postOnly:void 0,side:p,price:n,stopPrice:void 0,triggerPrice:void 0,amount:o,cost:l,average:c,filled:h,remaining:d,status:f,fee:g,trades:void 0},t)}async createOrder(e,t,i,s,a,n={}){if("limit"!==t&&"market"!==t)throw new r(this.id+" allows limit and market orders only");await this.loadMarkets();const o=this.market(e),h={side:i.toUpperCase(),symbol:o.uppercaseId,quantity:this.amountToPrecision(e,s)};let d="v2PostOrders";if("limit"===t)h.rate=this.priceToPrecision(e,a);else{if("market"!==t)throw new r(this.id+" allows limit and market orders only");d="v1PostPlaceMarketOrderQntySymbol",h.market=o.quoteId}const c=await this[d](this.extend(h,n));return this.parseOrder(c,o)}async cancelOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r="USDT"===s.quoteId?"usdtcancelOrder":"cancelOrder",n={entry_id:e,symbol:s.uppercaseId,side:r},o=await this.v2PostCancel(this.extend(n,i));return this.parseOrder(o,s)}async fetchOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={symbol:s.id,entry_id:e},n=await this.v1PostOrderStatusSymbol(this.extend(r,i)),o=this.safeValue(n,"data",[]),h=this.safeValue(o,0);return this.parseOrder(h,s)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n="USDT"===r.quoteId?"usdtListOpenOrders":"listOpenOrders",o={symbol:r.uppercaseId,side:n,page:0},h=await this.v2PostGetordersnew(this.extend(o,s)),d=this.safeValue(h,"data",[]);return this.parseOrders(d,r,t,i)}parseTrade(e,t){t=this.safeMarket(void 0,t);const i=this.safeString2(e,"id","tradeId");let s=this.parse8601(this.safeString(e,"date"));s=this.safeInteger(e,"timestamp",s);const r=this.safeString2(e,"rate","price");let a=this.safeString(e,"amount"),n=this.safeStringLower(e,"type");void 0!==n&&(n.indexOf("buy")>=0?n="buy":n.indexOf("sell")>=0&&(n="sell"));const o=this.safeString(e,"factor");let h;void 0!==o?a=l.stringDiv(a,o):(a=this.safeString(e,"base_volume"),h=this.safeString(e,"quote_volume"));const d=t.symbol;let c;const u=this.safeString(e,"fee");if(void 0!==u){c={cost:u,currency:t.quote}}return this.safeTrade({info:e,timestamp:s,datetime:this.iso8601(s),symbol:d,id:i,order:i,type:void 0,side:n,takerOrMaker:void 0,price:r,amount:a,cost:h,fee:c},t)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={symbol:r.id,page:0};void 0!==t&&(n.since=this.iso8601(t));const o=await this.v1PostListExecutedOrdersSymbol(this.extend(n,s)),h=this.safeValue(o,"data",[]);return this.parseTrades(h,r,t,i)}async fetchTrades(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={coin:r.baseId,market:r.quoteId},o=await this.wwwGetExchangeDataTradedetails(this.extend(n,s));return this.parseTrades(o,r,t,i)}async fetchDeposits(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchDeposits() requires a currency code argument");await this.loadMarkets();const r=this.currency(e),n={symbol:r.id,page:0},o=await this.v1PostDepositHistorySymbol(this.extend(n,s)),h=this.safeValue(o,"data",[]);return this.parseTransactions(h,r,t,i)}async fetchWithdrawals(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchWithdrawals() requires a currency code argument");await this.loadMarkets();const r=this.currency(e),n={symbol:r.id,page:0},o=await this.v1PostWithdrawHistorySymbol(this.extend(n,s)),h=this.safeValue(o,"data",[]);return this.parseTransactions(h,r,t,i)}parseTransactionStatusByType(e,t){const i=this.safeValue({deposit:{0:"pending",1:"ok"},withdrawal:{0:"pending",1:"canceled",2:"pending",3:"failed",4:"pending",5:"failed",6:"ok"}},t,{});return this.safeString(i,e,e)}parseTransaction(e,t){const i=this.safeString(e,"unit"),s=this.safeCurrencyCode(i,t),r=this.parse8601(this.safeString2(e,"date","timestamp"));let a=this.safeString(e,"type");const n=this.safeString(e,"expTime","");let o;void 0!==a&&(a.indexOf("deposit")>=0?(a="deposit",o="ok"):(a.indexOf("withdraw")>=0||n.indexOf("withdraw")>=0)&&(a="withdrawal"));const h=this.safeNumber(e,"amount"),d=this.safeNumber(e,"fee");let c;return void 0!==d&&(c={currency:s,cost:d}),{info:e,id:void 0,txid:void 0,timestamp:r,datetime:this.iso8601(r),network:void 0,address:void 0,addressTo:void 0,addressFrom:void 0,tag:void 0,tagTo:void 0,tagFrom:void 0,type:a,amount:h,currency:s,status:o,updated:void 0,internal:void 0,fee:c}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={symbol:this.currency(e).id},s=await this.v1PostGetCoinAddressSymbol(this.extend(i,t)),r=this.safeValue(s,"data",{}),a=this.safeString(r,"token"),n=this.safeString(r,"tag");return this.checkAddress(a),{currency:e,address:a,tag:n,network:void 0,info:s}}nonce(){return this.milliseconds()}sign(e,t="www",i="GET",s={},a,n){if(!(t in this.urls.api))throw new r(this.id+" does not have a testnet/sandbox URL for "+t+" endpoints");"www"!==t&&(this.checkRequiredCredentials(),a={"X-BITBNS-APIKEY":this.apiKey});let o=this.implodeHostname(this.urls.api[t])+"/"+this.implodeParams(e,s);const h=this.omit(s,this.extractParams(e)),d=this.nonce().toString();if("GET"===i)Object.keys(h).length&&(o+="?"+this.urlencode(h));else if("POST"===i){const e={timeStamp_nonce:d,body:n=Object.keys(h).length?this.json(h):"{}"},t=this.stringToBase64(this.json(e)),i=this.hmac(t,this.encode(this.secret),"sha512");a["X-BITBNS-PAYLOAD"]=this.decode(t),a["X-BITBNS-SIGNATURE"]=i,a["Content-Type"]="application/x-www-form-urlencoded"}return{url:o,method:i,body:n,headers:a}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;const c=this.safeString(o,"code"),l=this.safeString(o,"msg");if(void 0!==c&&"200"!==c&&"204"!==c||void 0!==l){const e=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,c,e),this.throwExactlyMatchedException(this.exceptions.exact,l,e),this.throwBroadlyMatchedException(this.exceptions.broad,l,e),new r(e)}}}},23334:function(e,t,i){"use strict";const s=i(98161);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitcoincom",alias:!0})}}},17965:function(e,t,i){"use strict";const s=i(48819),{NotSupported:r,RateLimitExceeded:a,AuthenticationError:n,PermissionDenied:o,ArgumentsRequired:h,ExchangeError:d,ExchangeNotAvailable:c,InsufficientFunds:l,InvalidOrder:u,OrderNotFound:f,InvalidNonce:p,BadSymbol:m}=i(73449),{SIGNIFICANT_DIGITS:g,DECIMAL_PLACES:y,TRUNCATE:b,ROUND:v}=i(62115),w=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitfinex",name:"Bitfinex",countries:["VG"],version:"v1",rateLimit:666.666,pro:!0,has:{CORS:void 0,spot:!0,margin:void 0,swap:void 0,future:void 0,option:void 0,cancelAllOrders:!0,cancelOrder:!0,createDepositAddress:!0,createOrder:!0,editOrder:!0,fetchBalance:!0,fetchClosedOrders:!0,fetchDepositAddress:!0,fetchDeposits:!1,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchIndexOHLCV:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPositionMode:!1,fetchPositions:!0,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!1,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactionFees:!0,fetchTransactions:!0,fetchWithdrawals:!1,transfer:!0,withdraw:!0},timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","3h":"3h","4h":"4h","6h":"6h","12h":"12h","1d":"1D","1w":"7D","2w":"14D","1M":"1M"},urls:{logo:"https://user-images.githubusercontent.com/1294454/27766244-e328a50c-5ed2-11e7-947b-041416579bb3.jpg",api:{v2:"https://api-pub.bitfinex.com",public:"https://api.bitfinex.com",private:"https://api.bitfinex.com"},www:"https://www.bitfinex.com",referral:"https://www.bitfinex.com/?refcode=P61eYxFL",doc:["https://docs.bitfinex.com/v1/docs","https://github.com/bitfinexcom/bitfinex-api-node"]},api:{v2:{get:{"platform/status":3,tickers:1,"ticker/{symbol}":1,"tickers/hist":1,"trades/{symbol}/hist":1,"book/{symbol}/{precision}":.375,"book/{symbol}/P0":.375,"book/{symbol}/P1":.375,"book/{symbol}/P2":.375,"book/{symbol}/P3":.375,"book/{symbol}/R0":.375,"stats1/{key}:{size}:{symbol}:{side}/{section}":1,"stats1/{key}:{size}:{symbol}/{section}":1,"stats1/{key}:{size}:{symbol}:long/last":1,"stats1/{key}:{size}:{symbol}:long/hist":1,"stats1/{key}:{size}:{symbol}:short/last":1,"stats1/{key}:{size}:{symbol}:short/hist":1,"candles/trade:{timeframe}:{symbol}/{section}":1,"candles/trade:{timeframe}:{symbol}/last":1,"candles/trade:{timeframe}:{symbol}/hist":1}},public:{get:{"book/{symbol}":1,"lendbook/{currency}":6,"lends/{currency}":3,"pubticker/{symbol}":3,"stats/{symbol}":6,symbols:18,symbols_details:18,tickers:1,"trades/{symbol}":3}},private:{post:{account_fees:18,account_infos:6,balances:9.036,basket_manage:6,credits:6,"deposit/new":18,"funding/close":6,history:6,"history/movements":6,key_info:6,margin_infos:3,mytrades:3,mytrades_funding:6,"offer/cancel":6,"offer/new":6,"offer/status":6,offers:6,"offers/hist":90.03,"order/cancel":.2,"order/cancel/all":.2,"order/cancel/multi":.2,"order/cancel/replace":.2,"order/new":.2,"order/new/multi":.2,"order/status":.2,orders:.2,"orders/hist":90.03,"position/claim":18,"position/close":18,positions:18,summary:18,taken_funds:6,total_taken_funds:6,transfer:18,unused_taken_funds:6,withdraw:18}}},fees:{trading:{feeSide:"get",tierBased:!0,percentage:!0,maker:this.parseNumber("0.001"),taker:this.parseNumber("0.002"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.002")],[this.parseNumber("500000"),this.parseNumber("0.002")],[this.parseNumber("1000000"),this.parseNumber("0.002")],[this.parseNumber("2500000"),this.parseNumber("0.002")],[this.parseNumber("5000000"),this.parseNumber("0.002")],[this.parseNumber("7500000"),this.parseNumber("0.002")],[this.parseNumber("10000000"),this.parseNumber("0.0018")],[this.parseNumber("15000000"),this.parseNumber("0.0016")],[this.parseNumber("20000000"),this.parseNumber("0.0014")],[this.parseNumber("25000000"),this.parseNumber("0.0012")],[this.parseNumber("30000000"),this.parseNumber("0.001")]],maker:[[this.parseNumber("0"),this.parseNumber("0.001")],[this.parseNumber("500000"),this.parseNumber("0.0008")],[this.parseNumber("1000000"),this.parseNumber("0.0006")],[this.parseNumber("2500000"),this.parseNumber("0.0004")],[this.parseNumber("5000000"),this.parseNumber("0.0002")],[this.parseNumber("7500000"),this.parseNumber("0")],[this.parseNumber("10000000"),this.parseNumber("0")],[this.parseNumber("15000000"),this.parseNumber("0")],[this.parseNumber("20000000"),this.parseNumber("0")],[this.parseNumber("25000000"),this.parseNumber("0")],[this.parseNumber("30000000"),this.parseNumber("0")]]}},funding:{tierBased:!1,percentage:!1,deposit:{},withdraw:{}}},commonCurrencies:{ALG:"ALGO",AMP:"AMPL",ATO:"ATOM",BCHABC:"XEC",BCHN:"BCH",DAT:"DATA",DOG:"MDOGE",DSH:"DASH",EDO:"PNT",EUS:"EURS",EUT:"EURT",IDX:"ID",IOT:"IOTA",IQX:"IQ",LUNA:"LUNC",LUNA2:"LUNA",MNA:"MANA",ORS:"ORS Group",PAS:"PASS",QSH:"QASH",QTM:"QTUM",RBT:"RBTC",SNG:"SNGLS",STJ:"STORJ",TERRAUST:"USTC",TSD:"TUSD",YGG:"YEED",YYW:"YOYOW",UDC:"USDC",UST:"USDT",VSY:"VSYS",WAX:"WAXP",XCH:"XCHF",ZBT:"ZB"},exceptions:{exact:{temporarily_unavailable:c,"Order could not be cancelled.":f,"No such order found.":f,"Order price must be positive.":u,"Could not find a key matching the given X-BFX-APIKEY.":n,'Key price should be a decimal number, e.g. "123.456"':u,'Key amount should be a decimal number, e.g. "123.456"':u,ERR_RATE_LIMIT:a,Ratelimit:a,"Nonce is too small.":p,"No summary found.":d,"Cannot evaluate your available balance, please try again":c,"Unknown symbol":m,"Cannot complete transfer. Exchange balance insufficient.":l,"Momentary balance check. Please wait few seconds and try the transfer again.":d},broad:{"Invalid X-BFX-SIGNATURE":n,"This API key does not have permission":o,"not enough exchange balance for ":l,"minimum size for ":u,"Invalid order":u,"The available balance is only":l}},precisionMode:g,options:{currencyNames:{AGI:"agi",AID:"aid",AIO:"aio",ANT:"ant",AVT:"aventus",BAT:"bat",BCH:"bab",BCI:"bci",BFT:"bft",BSV:"bsv",BTC:"bitcoin",BTG:"bgold",CFI:"cfi",COMP:"comp",DAI:"dai",DADI:"dad",DASH:"dash",DATA:"datacoin",DTH:"dth",EDO:"eidoo",ELF:"elf",EOS:"eos",ETC:"ethereumc",ETH:"ethereum",ETP:"metaverse",FUN:"fun",GNT:"golem",IOST:"ios",IOTA:"iota",LEO:"let",LINK:"link",LRC:"lrc",LTC:"litecoin",LYM:"lym",MANA:"mna",MIT:"mit",MKR:"mkr",MTN:"mtn",NEO:"neo",ODE:"ode",OMG:"omisego",OMNI:"mastercoin",QASH:"qash",QTUM:"qtum",RCN:"rcn",RDN:"rdn",REP:"rep",REQ:"req",RLC:"rlc",SAN:"santiment",SNGLS:"sng",SNT:"status",SPANK:"spk",STORJ:"stj",TNB:"tnb",TRX:"trx",TUSD:"tsd",USD:"wire",USDC:"udc",UTK:"utk",USDT:"tetheruso",VEE:"vee",WAX:"wax",XLM:"xlm",XMR:"monero",XRP:"ripple",XVG:"xvg",YOYOW:"yoyow",ZEC:"zcash",ZRX:"zrx",XTZ:"xtz"},orderTypes:{limit:"exchange limit",market:"exchange market"},fiat:{USD:"USD",EUR:"EUR",JPY:"JPY",GBP:"GBP",CNH:"CNH"},accountsByType:{spot:"exchange",margin:"trading",funding:"deposit",swap:"trading"}}})}async fetchTransactionFees(e,t={}){await this.loadMarkets();const i={},s=await this.privatePostAccountFees(t),r=this.safeValue(s,"withdraw"),a=Object.keys(r);for(let t=0;t<a.length;t++){const s=a[t],n=this.safeCurrencyCode(s);(void 0===e||this.inArray(n,e))&&(i[n]={withdraw:this.safeNumber(r,s),deposit:{},info:this.safeNumber(r,s)})}return i}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.privatePostAccountFees(t),s=this.safeValue(i,"withdraw");return this.parseDepositWithdrawFees(s,e)}parseDepositWithdrawFee(e,t){return{withdraw:{fee:this.parseNumber(e),percentage:void 0},deposit:{fee:void 0,percentage:void 0},networks:{},info:e}}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privatePostSummary(e),i={},s=this.safeValue(this.options,"fiat",{}),r=this.safeNumber(t,"maker_fee"),a=this.safeNumber(t,"taker_fee"),n=this.safeNumber(t,"maker_fee_2fiat"),o=this.safeNumber(t,"taker_fee_2fiat"),h=this.safeNumber(t,"maker_fee_2deriv"),d=this.safeNumber(t,"taker_fee_2deriv");for(let e=0;e<this.symbols.length;e++){const c=this.symbols[e],l=this.market(c),u={info:t,symbol:c,percentage:!0,tierBased:!0};l.quote in s?(u.maker=n,u.taker=o):l.contract?(u.maker=h,u.taker=d):(u.maker=r,u.taker=a),i[c]=u}return i}async fetchMarkets(e={}){const t=await this.publicGetSymbols(),i=await this.publicGetSymbolsDetails(),s=[];for(let e=0;e<i.length;e++){const r=i[e];let a,n,o=this.safeString(r,"pair");if(!this.inArray(o,t))continue;if(o=o.toUpperCase(),o.indexOf(":")>=0){const e=o.split(":");a=e[0],n=e[1]}else a=o.slice(0,3),n=o.slice(3,6);const h=this.safeCurrencyCode(a),d=this.safeCurrencyCode(n),c=h+"/"+d;let l="spot";o.indexOf("F0")>-1&&(l="swap"),s.push({id:o,symbol:c,base:h,quote:d,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:l,spot:"spot"===l,margin:this.safeValue(r,"margin"),swap:"swap"===l,future:!1,option:!1,active:!0,contract:"swap"===l,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:parseInt("8"),price:this.safeInteger(r,"price_precision")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(r,"minimum_order_size"),max:this.safeNumber(r,"maximum_order_size")},price:{min:this.parseNumber("1e-8"),max:void 0},cost:{min:void 0,max:void 0}},info:r})}return s}amountToPrecision(e,t){return e=this.safeSymbol(e),this.decimalToPrecision(t,b,this.markets[e].precision.amount,y)}priceToPrecision(e,t){return e=this.safeSymbol(e),t=this.decimalToPrecision(t,v,this.markets[e].precision.price,this.precisionMode),this.decimalToPrecision(t,b,8,y)}async fetchBalance(e={}){await this.loadMarkets();const t=this.safeValue(this.options,"accountsByType",{}),i=this.safeString(e,"type","exchange"),s=this.safeString(t,i,i);if(void 0===s){const e=Object.keys(t);throw new d(this.id+" fetchBalance() type parameter must be one of "+e.join(", "))}const r=this.omit(e,"type"),a=await this.privatePostBalances(r),n={info:a},o="derivatives"===i;for(let e=0;e<a.length;e++){const t=a[e],i=this.safeString(t,"type"),r=this.safeStringLower(t,"currency",""),h=r.length-2,d="f0"===r.slice(h);if(s===i&&(!o||d)){const e=this.safeCurrencyCode(r);if(!(e in n)){const i=this.account();i.free=this.safeString(t,"available"),i.total=this.safeString(t,"amount"),n[e]=i}}}return this.safeBalance(n)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.safeValue(this.options,"accountsByType",{}),n=this.safeString(a,i,i),o=this.safeString(a,s,s),h=this.currency(e),c=this.convertDerivativesId(h.id,i),l=this.convertDerivativesId(h.id,s),u=this.currencyToPrecision(e,t),f={amount:u,currency:c,currency_to:l,walletfrom:n,walletto:o},p=await this.privatePostTransfer(this.extend(f,r)),m=this.safeValue(p,0);if(void 0===this.safeString(m,"message"))throw new d(this.id+" transfer failed");return this.extend(this.parseTransfer(m,h),{fromAccount:i,toAccount:s,amount:this.parseNumber(u)})}parseTransfer(e,t){const i=this.milliseconds();return{info:e,id:void 0,timestamp:i,datetime:this.iso8601(i),currency:this.safeCurrencyCode(void 0,t),amount:void 0,fromAccount:void 0,toAccount:void 0,status:this.parseTransferStatus(this.safeString(e,"status"))}}parseTransferStatus(e){return this.safeString({SUCCESS:"ok"},e,e)}convertDerivativesId(e,t){const i=e.length-2,s="F0"===e.slice(i);return"derivatives"!==t&&"trading"!==t&&"margin"!==t&&s?e=e.slice(0,i):"derivatives"!==t||s||(e+="F0"),e}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};void 0!==t&&(r.limit_bids=t,r.limit_asks=t);const a=await this.publicGetBookSymbol(this.extend(r,i));return this.parseOrderBook(a,s.symbol,void 0,"bids","asks","price","amount")}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetTickers(t),s={};for(let e=0;e<i.length;e++){const t=this.parseTicker(i[e]);s[t.symbol]=t}return this.filterByArray(s,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetPubtickerSymbol(this.extend(s,t));return this.parseTicker(r,i)}parseTicker(e,t){const i=this.safeTimestamp(e,"timestamp"),s=this.safeString(t,"pair"),r=(t=this.safeMarket(s,t)).symbol,a=this.safeString(e,"last_price");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:void 0,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:this.safeString(e,"mid"),baseVolume:this.safeString(e,"volume"),quoteVolume:void 0,info:e},t)}parseTrade(e,t){const i=this.safeString(e,"tid"),s=this.safeTimestamp(e,"timestamp"),r=this.safeStringLower(e,"type"),a=this.safeString(e,"order_id"),n=this.safeString(e,"price"),o=this.safeString(e,"amount");let h;if("fee_amount"in e){const t=w.stringNeg(this.safeString(e,"fee_amount")),i=this.safeString(e,"fee_currency");h={cost:t,currency:this.safeCurrencyCode(i)}}return this.safeTrade({id:i,info:e,timestamp:s,datetime:this.iso8601(s),symbol:t.symbol,type:undefined,order:a,side:r,takerOrMaker:void 0,price:n,amount:o,cost:void 0,fee:h},t)}async fetchTrades(e,t,i=50,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id,limit_trades:i};void 0!==t&&(a.timestamp=parseInt(t/1e3));const n=await this.publicGetTradesSymbol(this.extend(a,s));return this.parseTrades(n,r,t,i)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new h(this.id+" fetchMyTrades() requires a `symbol` argument");await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.limit_trades=i),void 0!==t&&(a.timestamp=parseInt(t/1e3));const n=await this.privatePostMytrades(this.extend(a,s));return this.parseTrades(n,r,t,i)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=this.safeValue(a,"postOnly",!1);t=t.toLowerCase(),a=this.omit(a,["postOnly"]),n.spot&&(t=this.safeStringLower(this.options.orderTypes,t,t));const h={symbol:n.id,side:i,amount:this.amountToPrecision(e,s),type:t,ocoorder:!1,buy_price_oco:0,sell_price_oco:0};t.indexOf("market")>-1?h.price=this.nonce().toString():h.price=this.priceToPrecision(e,r),o&&(h.is_postonly=!0);const d=await this.privatePostOrderNew(this.extend(h,a));return this.parseOrder(d,n)}async editOrder(e,t,i,s,r,a,n={}){await this.loadMarkets();const o={order_id:parseInt(e)};void 0!==a&&(o.price=this.priceToPrecision(t,a)),void 0!==r&&(o.amount=this.numberToString(r)),void 0!==t&&(o.symbol=this.marketId(t)),void 0!==s&&(o.side=s),void 0!==i&&(o.type=this.safeString(this.options.orderTypes,i,i));const h=await this.privatePostOrderCancelReplace(this.extend(o,n));return this.parseOrder(h)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={order_id:parseInt(e)};return await this.privatePostOrderCancel(this.extend(s,i))}async cancelAllOrders(e,t={}){return await this.privatePostOrderCancelAll(t)}parseOrder(e,t){const i=this.safeString(e,"side"),s=this.safeValue(e,"is_live"),r=this.safeValue(e,"is_cancelled");let a;a=s?"open":r?"canceled":"closed";const n=this.safeStringUpper(e,"symbol"),o=this.safeSymbol(n,t);let h=this.safeString(e,"type","");if(h.indexOf("exchange ")>=0){h=e.type.split(" ")[1]}const d=this.safeTimestamp(e,"timestamp"),c=this.safeString(e,"id");return this.safeOrder({info:e,id:c,clientOrderId:void 0,timestamp:d,datetime:this.iso8601(d),lastTradeTimestamp:void 0,symbol:o,type:h,timeInForce:void 0,postOnly:void 0,side:i,price:this.safeString(e,"price"),stopPrice:void 0,triggerPrice:void 0,average:this.safeString(e,"avg_execution_price"),amount:this.safeString(e,"original_amount"),remaining:this.safeString(e,"remaining_amount"),filled:this.safeString(e,"executed_amount"),status:a,fee:void 0,cost:void 0,trades:void 0},t)}async fetchOpenOrders(e,t,i,s={}){if(await this.loadMarkets(),void 0!==e&&!(e in this.markets))throw new d(this.id+" has no symbol "+e);const r=await this.privatePostOrders(s);let a=this.parseOrders(r,void 0,t,i);return void 0!==e&&(a=this.filterBy(a,"symbol",e)),a}async fetchClosedOrders(e,t,i,s={}){await this.loadMarkets(),e=this.symbol(e);const r={};void 0!==i&&(r.limit=i);const a=await this.privatePostOrdersHist(this.extend(r,s));let n=this.parseOrders(a,void 0,t,i);return void 0!==e&&(n=this.filterBy(n,"symbol",e)),n=this.filterByArray(n,"status",["closed","canceled"],!1),n}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={order_id:parseInt(e)},r=await this.privatePostOrderStatus(this.extend(s,i));return this.parseOrder(r)}parseOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,2),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets(),void 0===s&&(s=100);const a=this.market(e),n={symbol:"t"+a.id,timeframe:this.safeString(this.timeframes,t,t),sort:1,limit:s};void 0!==i&&(n.start=i);const o=await this.v2GetCandlesTradeTimeframeSymbolHist(this.extend(n,r));return this.parseOHLCVs(o,a,t,i,s)}getCurrencyName(e){if(e in this.options.currencyNames)return this.options.currencyNames[e];throw new r(this.id+" "+e+" not supported for withdrawal")}async createDepositAddress(e,t={}){await this.loadMarkets();return await this.fetchDepositAddress(e,this.extend({renew:1},t))}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={method:this.getCurrencyName(e),wallet_name:"exchange",renew:0},s=await this.privatePostDepositNew(this.extend(i,t));let r,a=this.safeValue(s,"address");return"address_pool"in s&&(r=a,a=s.address_pool),this.checkAddress(a),{currency:e,address:a,tag:r,network:void 0,info:s}}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();let r=this.safeString(s,"currency");const a=this.omit(s,"currency");let n;if(void 0===r){if(void 0===e)throw new h(this.id+" fetchTransactions() requires a currency `code` argument or a `currency` parameter");n=this.currency(e),r=n.id}a.currency=r,void 0!==t&&(a.since=parseInt(t/1e3));const o=await this.privatePostHistoryMovements(this.extend(a,s));return this.parseTransactions(o,n,t,i)}parseTransaction(e,t){const i=this.safeTimestamp(e,"timestamp_created"),s=this.safeString(e,"currency"),r=this.safeCurrencyCode(s,t);let a=this.safeString(e,"fee");return void 0!==a&&(a=w.stringAbs(a)),{info:e,id:this.safeString2(e,"id","withdrawal_id"),txid:this.safeString(e,"txid"),type:this.safeStringLower(e,"type"),currency:r,network:void 0,amount:this.safeNumber(e,"amount"),status:this.parseTransactionStatus(this.safeString(e,"status")),timestamp:i,datetime:this.iso8601(i),address:this.safeString(e,"address"),addressFrom:void 0,addressTo:void 0,tag:this.safeString(e,"description"),tagFrom:void 0,tagTo:void 0,updated:this.safeTimestamp(e,"timestamp"),comment:void 0,fee:{currency:r,cost:this.parseNumber(a),rate:void 0}}}parseTransactionStatus(e){return this.safeString({SENDING:"pending",CANCELED:"canceled",ZEROCONFIRMED:"failed",COMPLETED:"ok"},e,e)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.getCurrencyName(e),n=this.currency(e),o={withdraw_type:a,walletselected:"exchange",amount:this.numberToString(t),address:i};void 0!==s&&(o.payment_id=s);const h=await this.privatePostWithdraw(this.extend(o,r)),c=this.safeValue(h,0,{}),l=this.safeNumber(c,"withdrawal_id"),u=this.safeString(c,"message"),f=this.findBroadlyMatchedKey(this.exceptions.broad,u);if(0===l){if(void 0!==f){throw new(0,this.exceptions.broad[f])(this.id+" "+u)}throw new d(this.id+" withdraw returned an id of zero: "+this.json(c))}return this.parseTransaction(c,n)}async fetchPositions(e,t={}){await this.loadMarkets();return await this.privatePostPositions(t)}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n="/"+this.implodeParams(e,s);n="v2"===t?"/"+t+n:"/"+this.version+n;let o=this.omit(s,this.extractParams(e)),h=this.urls.api[t]+n;if(("public"===t||e.indexOf("/hist")>=0)&&Object.keys(o).length){const e="?"+this.urlencode(o);h+=e,n+=e}if("private"===t){this.checkRequiredCredentials();const e=this.nonce();o=this.extend({nonce:e.toString(),request:n},o),a=this.json(o);const t=this.stringToBase64(a),i=this.encode(this.secret),s=this.hmac(t,i,"sha384");r={"X-BFX-APIKEY":this.apiKey,"X-BFX-PAYLOAD":this.decode(t),"X-BFX-SIGNATURE":s,"Content-Type":"application/json"}}return{url:h,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,n,o,h){if(void 0===n)return;let c=!1;if(e>=400)"{"===a[0]&&(c=!0);else{const e=this.safeValue(n,0,{});"error"===this.safeString(e,"status","")&&(c=!0)}if(c){const e=this.id+" "+a,t=this.safeString2(n,"message","error");throw this.throwExactlyMatchedException(this.exceptions.exact,t,e),this.throwBroadlyMatchedException(this.exceptions.broad,t,e),new d(e)}}}},5328:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,InvalidAddress:a,ArgumentsRequired:n,InsufficientFunds:o,AuthenticationError:h,OrderNotFound:d,InvalidOrder:c,BadRequest:l,InvalidNonce:u,BadSymbol:f,OnMaintenance:p,NotSupported:m,PermissionDenied:g,ExchangeNotAvailable:y}=i(73449),b=i(6832),{SIGNIFICANT_DIGITS:v,DECIMAL_PLACES:w,TRUNCATE:S,ROUND:k}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitfinex2",name:"Bitfinex",countries:["VG"],version:"v2",certified:!1,pro:!1,has:{CORS:void 0,spot:!0,margin:void 0,swap:void 0,future:void 0,option:void 0,cancelAllOrders:!0,cancelOrder:!0,createDepositAddress:!0,createLimitOrder:!0,createMarketOrder:!0,createOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,editOrder:!1,fetchBalance:!0,fetchClosedOrder:!0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchIndexOHLCV:!1,fetchLedger:!0,fetchMarginMode:!1,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrder:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderTrades:!0,fetchPositionMode:!1,fetchStatus:!0,fetchTickers:!0,fetchTime:!1,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactionFees:void 0,fetchTransactions:!0,withdraw:!0},timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","3h":"3h","4h":"4h","6h":"6h","12h":"12h","1d":"1D","1w":"7D","2w":"14D","1M":"1M"},rateLimit:250,urls:{logo:"https://user-images.githubusercontent.com/1294454/27766244-e328a50c-5ed2-11e7-947b-041416579bb3.jpg",api:{v1:"https://api.bitfinex.com",public:"https://api-pub.bitfinex.com",private:"https://api.bitfinex.com"},www:"https://www.bitfinex.com",doc:["https://docs.bitfinex.com/v2/docs/","https://github.com/bitfinexcom/bitfinex-api-node"],fees:"https://www.bitfinex.com/fees"},api:{public:{get:{"conf/{config}":2.66,"conf/pub:{action}:{object}":2.66,"conf/pub:{action}:{object}:{detail}":2.66,"conf/pub:map:{object}":2.66,"conf/pub:map:{object}:{detail}":2.66,"conf/pub:map:currency:{detail}":2.66,"conf/pub:map:currency:sym":2.66,"conf/pub:map:currency:label":2.66,"conf/pub:map:currency:unit":2.66,"conf/pub:map:currency:undl":2.66,"conf/pub:map:currency:pool":2.66,"conf/pub:map:currency:explorer":2.66,"conf/pub:map:currency:tx:fee":2.66,"conf/pub:map:tx:method":2.66,"conf/pub:list:{object}":2.66,"conf/pub:list:{object}:{detail}":2.66,"conf/pub:list:currency":2.66,"conf/pub:list:pair:exchange":2.66,"conf/pub:list:pair:margin":2.66,"conf/pub:list:pair:futures":2.66,"conf/pub:list:competitions":2.66,"conf/pub:info:{object}":2.66,"conf/pub:info:{object}:{detail}":2.66,"conf/pub:info:pair":2.66,"conf/pub:info:pair:futures":2.66,"conf/pub:info:tx:status":2.66,"conf/pub:fees":2.66,"platform/status":8,tickers:2.66,"ticker/{symbol}":2.66,"tickers/hist":2.66,"trades/{symbol}/hist":2.66,"book/{symbol}/{precision}":1,"book/{symbol}/P0":1,"book/{symbol}/P1":1,"book/{symbol}/P2":1,"book/{symbol}/P3":1,"book/{symbol}/R0":1,"stats1/{key}:{size}:{symbol}:{side}/{section}":2.66,"stats1/{key}:{size}:{symbol}:{side}/last":2.66,"stats1/{key}:{size}:{symbol}:{side}/hist":2.66,"stats1/{key}:{size}:{symbol}/{section}":2.66,"stats1/{key}:{size}:{symbol}/last":2.66,"stats1/{key}:{size}:{symbol}/hist":2.66,"stats1/{key}:{size}:{symbol}:long/last":2.66,"stats1/{key}:{size}:{symbol}:long/hist":2.66,"stats1/{key}:{size}:{symbol}:short/last":2.66,"stats1/{key}:{size}:{symbol}:short/hist":2.66,"candles/trade:{timeframe}:{symbol}:{period}/{section}":2.66,"candles/trade:{timeframe}:{symbol}/{section}":2.66,"candles/trade:{timeframe}:{symbol}/last":2.66,"candles/trade:{timeframe}:{symbol}/hist":2.66,"status/{type}":2.66,"status/deriv":2.66,"liquidations/hist":80,"rankings/{key}:{timeframe}:{symbol}/{section}":2.66,"rankings/{key}:{timeframe}:{symbol}/hist":2.66,"pulse/hist":2.66,"pulse/profile/{nickname}":2.66,"funding/stats/{symbol}/hist":10},post:{"calc/trade/avg":2.66,"calc/fx":2.66}},private:{post:{"auth/r/wallets":2.66,"auth/r/wallets/hist":2.66,"auth/r/orders":2.66,"auth/r/orders/{symbol}":2.66,"auth/w/order/submit":2.66,"auth/w/order/update":2.66,"auth/w/order/cancel":2.66,"auth/w/order/multi":2.66,"auth/w/order/cancel/multi":2.66,"auth/r/orders/{symbol}/hist":2.66,"auth/r/orders/hist":2.66,"auth/r/order/{symbol}:{id}/trades":2.66,"auth/r/trades/{symbol}/hist":2.66,"auth/r/trades/hist":2.66,"auth/r/ledgers/{currency}/hist":2.66,"auth/r/ledgers/hist":2.66,"auth/r/info/margin/{key}":2.66,"auth/r/info/margin/base":2.66,"auth/r/info/margin/sym_all":2.66,"auth/r/positions":2.66,"auth/w/position/claim":2.66,"auth/w/position/increase:":2.66,"auth/r/position/increase/info":2.66,"auth/r/positions/hist":2.66,"auth/r/positions/audit":2.66,"auth/r/positions/snap":2.66,"auth/w/deriv/collateral/set":2.66,"auth/w/deriv/collateral/limits":2.66,"auth/r/funding/offers":2.66,"auth/r/funding/offers/{symbol}":2.66,"auth/w/funding/offer/submit":2.66,"auth/w/funding/offer/cancel":2.66,"auth/w/funding/offer/cancel/all":2.66,"auth/w/funding/close":2.66,"auth/w/funding/auto":2.66,"auth/w/funding/keep":2.66,"auth/r/funding/offers/{symbol}/hist":2.66,"auth/r/funding/offers/hist":2.66,"auth/r/funding/loans":2.66,"auth/r/funding/loans/hist":2.66,"auth/r/funding/loans/{symbol}":2.66,"auth/r/funding/loans/{symbol}/hist":2.66,"auth/r/funding/credits":2.66,"auth/r/funding/credits/hist":2.66,"auth/r/funding/credits/{symbol}":2.66,"auth/r/funding/credits/{symbol}/hist":2.66,"auth/r/funding/trades/{symbol}/hist":2.66,"auth/r/funding/trades/hist":2.66,"auth/r/info/funding/{key}":2.66,"auth/r/info/user":2.66,"auth/r/summary":2.66,"auth/r/logins/hist":2.66,"auth/r/permissions":2.66,"auth/w/token":2.66,"auth/r/audit/hist":2.66,"auth/w/transfer":2.66,"auth/w/deposit/address":24,"auth/w/deposit/invoice":24,"auth/w/withdraw":24,"auth/r/movements/{currency}/hist":2.66,"auth/r/movements/hist":2.66,"auth/r/alerts":5.33,"auth/w/alert/set":2.66,"auth/w/alert/price:{symbol}:{price}/del":2.66,"auth/w/alert/{type}:{symbol}:{price}/del":2.66,"auth/calc/order/avail":2.66,"auth/w/settings/set":2.66,"auth/r/settings":2.66,"auth/w/settings/del":2.66,"auth/r/pulse/hist":2.66,"auth/w/pulse/add":16,"auth/w/pulse/del":2.66}}},fees:{trading:{feeSide:"get",percentage:!0,tierBased:!0,maker:this.parseNumber("0.001"),taker:this.parseNumber("0.002"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.002")],[this.parseNumber("500000"),this.parseNumber("0.002")],[this.parseNumber("1000000"),this.parseNumber("0.002")],[this.parseNumber("2500000"),this.parseNumber("0.002")],[this.parseNumber("5000000"),this.parseNumber("0.002")],[this.parseNumber("7500000"),this.parseNumber("0.002")],[this.parseNumber("10000000"),this.parseNumber("0.0018")],[this.parseNumber("15000000"),this.parseNumber("0.0016")],[this.parseNumber("20000000"),this.parseNumber("0.0014")],[this.parseNumber("25000000"),this.parseNumber("0.0012")],[this.parseNumber("30000000"),this.parseNumber("0.001")]],maker:[[this.parseNumber("0"),this.parseNumber("0.001")],[this.parseNumber("500000"),this.parseNumber("0.0008")],[this.parseNumber("1000000"),this.parseNumber("0.0006")],[this.parseNumber("2500000"),this.parseNumber("0.0004")],[this.parseNumber("5000000"),this.parseNumber("0.0002")],[this.parseNumber("7500000"),this.parseNumber("0")],[this.parseNumber("10000000"),this.parseNumber("0")],[this.parseNumber("15000000"),this.parseNumber("0")],[this.parseNumber("20000000"),this.parseNumber("0")],[this.parseNumber("25000000"),this.parseNumber("0")],[this.parseNumber("30000000"),this.parseNumber("0")]]}},funding:{withdraw:{}}},precisionMode:v,options:{precision:"R0",exchangeTypes:{"EXCHANGE MARKET":"market","EXCHANGE LIMIT":"limit","EXCHANGE STOP":"market","EXCHANGE FOK":"limit","EXCHANGE STOP LIMIT":"limit","EXCHANGE IOC":"limit"},orderTypes:{market:"EXCHANGE MARKET",limit:"EXCHANGE LIMIT"},fiat:{USD:"USD",EUR:"EUR",JPY:"JPY",GBP:"GBP",CHN:"CHN"},v2AccountsByType:{spot:"exchange",exchange:"exchange",funding:"funding",margin:"margin",derivatives:"margin",future:"margin"}},exceptions:{exact:{10001:g,10020:l,10100:h,10114:u,20060:p,temporarily_unavailable:y},broad:{address:a,"available balance is only":o,"not enough exchange balance":o,"Order not found":d,"symbol: invalid":f,"Invalid order":c}},commonCurrencies:{UST:"USDT",EUTF0:"EURT",USTF0:"USDT",ALG:"ALGO",AMP:"AMPL",ATO:"ATOM",BCHABC:"XEC",BCHN:"BCH",DAT:"DATA",DOG:"MDOGE",DSH:"DASH",EDO:"PNT",EUS:"EURS",EUT:"EURT",IDX:"ID",IOT:"IOTA",IQX:"IQ",LUNA:"LUNC",LUNA2:"LUNA",MNA:"MANA",ORS:"ORS Group",PAS:"PASS",QSH:"QASH",QTM:"QTUM",RBT:"RBTC",SNG:"SNGLS",STJ:"STORJ",TERRAUST:"USTC",TSD:"TUSD",YGG:"YEED",YYW:"YOYOW",UDC:"USDC",VSY:"VSYS",WAX:"WAXP",XCH:"XCHF",ZBT:"ZB"}})}isFiat(e){return e in this.options.fiat}getCurrencyId(e){return"f"+e}getCurrencyName(e){if(e in this.options.currencyNames)return this.options.currencyNames[e];throw new m(this.id+" "+e+" not supported for withdrawal")}amountToPrecision(e,t){return e=this.safeSymbol(e),this.decimalToPrecision(t,S,this.markets[e].precision.amount,w)}priceToPrecision(e,t){return e=this.safeSymbol(e),t=this.decimalToPrecision(t,k,this.markets[e].precision.price,this.precisionMode),this.decimalToPrecision(t,S,8,w)}async fetchStatus(e={}){const t=await this.publicGetPlatformStatus(e),i=this.safeString(t,0);return{status:this.safeString({0:"maintenance",1:"ok"},i,i),updated:void 0,eta:void 0,url:void 0,info:t}}async fetchMarkets(e={}){let t=await this.publicGetConfPubInfoPair(e),i=await this.publicGetConfPubInfoPairFutures(e);t=this.safeValue(t,0,[]),i=this.safeValue(i,0,[]);const s=this.arrayConcat(t,i);let r=await this.publicGetConfPubListPairMargin(e);r=this.safeValue(r,0,[]);const a=[];for(let e=0;e<s.length;e++){const t=s[e],i=this.safeStringUpper(t,0),n=this.safeValue(t,1,{});let o=!0;i.indexOf("F0")>=0&&(o=!1);const h=!o;let d,c;if(i.indexOf(":")>=0){const e=i.split(":");d=e[0],c=e[1]}else d=i.slice(0,3),c=i.slice(3,6);let l=this.safeCurrencyCode(d),u=this.safeCurrencyCode(c);const f=l.split("F0"),p=u.split("F0");l=this.safeString(f,0),u=this.safeString(p,0);let m,g=l+"/"+u;d=this.getCurrencyId(d),c=this.getCurrencyId(c),h&&(m=u,g=g+":"+m);const y=this.safeString(n,3),b=this.safeString(n,4);let v=!1;this.inArray(i,r)&&(v=!0),a.push({id:"t"+i,symbol:g,base:l,quote:u,settle:m,baseId:d,quoteId:c,settleId:c,type:o?"spot":"swap",spot:o,margin:v,swap:h,future:!1,option:!1,active:!0,contract:h,linear:!!h||void 0,inverse:!h&&void 0,contractSize:h?this.parseNumber("1"):void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:parseInt("8"),price:parseInt("5")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.parseNumber(y),max:this.parseNumber(b)},price:{min:this.parseNumber("1e-8"),max:void 0},cost:{min:void 0,max:void 0}},info:n})}return a}async fetchCurrencies(e={}){const t={config:["pub:list:currency","pub:map:currency:sym","pub:map:currency:label","pub:map:currency:unit","pub:map:currency:undl","pub:map:currency:pool","pub:map:currency:explorer","pub:map:currency:tx:fee","pub:map:tx:method"].join(",")},i=await this.publicGetConfConfig(this.extend(t,e)),s={sym:this.indexBy(this.safeValue(i,1,[]),0),label:this.indexBy(this.safeValue(i,2,[]),0),unit:this.indexBy(this.safeValue(i,3,[]),0),undl:this.indexBy(this.safeValue(i,4,[]),0),pool:this.indexBy(this.safeValue(i,5,[]),0),explorer:this.indexBy(this.safeValue(i,6,[]),0),fees:this.indexBy(this.safeValue(i,7,[]),0)},r=this.safeValue(i,0,[]),a={};for(let e=0;e<r.length;e++){const t=r[e];if(t.indexOf("F0")>=0)continue;const n=this.safeCurrencyCode(t),o=this.safeValue(s.label,t,[]),h=this.safeString(o,1),d=this.safeValue(s.pool,t,[]),c=this.safeString(d,1),l=this.safeValue(s.fees,t,[]),u=this.safeValue(l,1,[]),f=this.safeNumber(u,1),p=this.safeValue(s.undl,t,[]),m="8",g="f"+t;a[n]={id:g,uppercaseId:t,code:n,info:[t,o,d,l,p],type:c,name:h,active:!0,deposit:void 0,withdraw:void 0,fee:f,precision:parseInt(m),limits:{amount:{min:this.parseNumber(this.parsePrecision(m)),max:void 0},withdraw:{min:f,max:void 0}}};const y={},b=this.safeValue(i,8,[]),v=t.replace("F0","");for(let e=0;e<b.length;e++){const t=b[e],i=this.safeString(t,0);if(this.safeString(this.safeValue(t,1,[]),0)===v){y[this.safeNetwork(i)]={info:i,id:i.toLowerCase(),network:i,active:void 0,deposit:void 0,withdraw:void 0,fee:void 0,precision:void 0,limits:{withdraw:{min:void 0,max:void 0}}}}}Object.keys(y).length>0&&(a[n].networks=y)}return a}safeNetwork(e){return this.safeString({BITCOIN:"BTC",LITECOIN:"LTC",ETHEREUM:"ERC20",TETHERUSE:"ERC20",TETHERUSO:"OMNI",TETHERUSL:"LIQUID",TETHERUSX:"TRC20",TETHERUSS:"EOS",TETHERUSDTAVAX:"AVAX",TETHERUSDTSOL:"SOL",TETHERUSDTALG:"ALGO",TETHERUSDTBCH:"BCH",TETHERUSDTKSM:"KSM",TETHERUSDTDVF:"DVF",TETHERUSDTOMG:"OMG"},e,e)}async fetchBalance(e={}){await this.loadMarkets();const t=this.safeValue(this.options,"v2AccountsByType",{}),i=this.safeString(e,"type","exchange"),s=this.safeString(t,i,i);if(void 0===s){const e=Object.keys(t);throw new r(this.id+" fetchBalance() type parameter must be one of "+e.join(", "))}const a="derivatives"===i,n=this.omit(e,"type"),o=await this.privatePostAuthRWallets(n),h={info:o};for(let e=0;e<o.length;e++){const t=o[e],i=this.safeString(t,0),r=this.safeStringLower(t,1,""),n=r.length-2,d="f0"===r.slice(n);if(s===i&&(!a||d)){const e=this.safeCurrencyCode(r),i=this.account();i.total=this.safeString(t,2),i.free=this.safeString(t,4),h[e]=i}}return this.safeBalance(h)}async transfer(e,t,i,s,a={}){await this.loadMarkets();const o=this.safeValue(this.options,"v2AccountsByType",{}),h=this.safeString(o,i);if(void 0===h){const e=Object.keys(o);throw new n(this.id+" transfer() fromAccount must be one of "+e.join(", "))}const d=this.safeString(o,s);if(void 0===d){const e=Object.keys(o);throw new n(this.id+" transfer() toAccount must be one of "+e.join(", "))}const c=this.currency(e),l=this.convertDerivativesId(c,i),u=this.convertDerivativesId(c,s),f={amount:this.currencyToPrecision(e,t),currency:l,currency_to:u,from:h,to:d},p=await this.privatePostAuthWTransfer(this.extend(f,a));if("error"===this.safeString(p,0)){const e=this.safeString(p,2,"");throw this.throwExactlyMatchedException(this.exceptions.exact,e,this.id+" "+e),new r(this.id+" "+e)}return this.parseTransfer(p,c)}parseTransfer(e,t){const i=this.safeInteger(e,0),s=this.safeValue(e,4),r=this.safeString(s,1),a=this.safeString(s,2),n=this.safeString(s,5),o=this.safeString(e,6);return{id:void 0,timestamp:i,datetime:this.iso8601(i),status:this.parseTransferStatus(o),amount:this.safeNumber(s,7),currency:this.safeCurrencyCode(n,t),fromAccount:r,toAccount:a,info:e}}parseTransferStatus(e){return this.safeString({SUCCESS:"ok",ERROR:"failed",FAILURE:"failed"},e,e)}convertDerivativesId(e,t){const i=this.safeValue(e,"info"),s=this.safeString(i,0),r=this.safeValue(i,4,[]);let a;if("derivatives"===t){a=this.safeString(r,0,s);const e=a.length-2;"F0"===a.slice(e)||(a+="F0")}else a="margin"!==t?this.safeString(r,1,s):s;return a}async fetchOrder(e,t,i={}){throw new m(this.id+" fetchOrder() is not supported yet. Consider using fetchOpenOrder() or fetchClosedOrder() instead.")}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.safeValue(this.options,"precision","R0"),r=this.market(e),a={symbol:r.id,precision:s};void 0!==t&&(a.len=t);const n=this.extend(a,i),o=await this.publicGetBookSymbolPrecision(n),h=this.milliseconds(),d={symbol:r.symbol,bids:[],asks:[],timestamp:h,datetime:this.iso8601(h),nonce:void 0},c="R0"===n.precision?1:0;for(let e=0;e<o.length;e++){const t=o[e],i=this.safeNumber(t,c),s=this.safeString(t,2),r=b.stringAbs(s);d[b.stringGt(s,"0")?"bids":"asks"].push([i,this.parseNumber(r)])}return d.bids=this.sortBy(d.bids,0,!0),d.asks=this.sortBy(d.asks,0),d}parseTicker(e,t){const i=this.milliseconds(),s=this.safeSymbol(void 0,t),r=e.length,a=this.safeString(e,r-4),n=this.safeString(e,r-5);return this.safeTicker({symbol:s,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,r-2),low:this.safeString(e,r-1),bid:this.safeString(e,r-10),bidVolume:void 0,ask:this.safeString(e,r-8),askVolume:void 0,vwap:void 0,open:void 0,close:a,last:a,previousClose:void 0,change:this.safeString(e,r-6),percentage:b.stringMul(n,"100"),average:void 0,baseVolume:this.safeString(e,r-3),quoteVolume:void 0,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets();const i={};if(void 0!==(e=this.marketSymbols(e))){const t=this.marketIds(e);i.symbols=t.join(",")}else i.symbols="ALL";const s=await this.publicGetTickers(this.extend(i,t)),r={};for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,0),a=this.safeMarket(i);r[a.symbol]=this.parseTicker(t,a)}return this.filterByArray(r,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetTickerSymbol(this.extend(s,t));return this.parseTicker(r,i)}parseTrade(e,t){const i=e.length>5,s=this.safeString(e,0),r=i?4:2;let a,n=this.safeString(e,r);const o=i?5:3,h=this.safeString(e,o);let d,c,l,u,f;"-"===n[0]?(a="sell",n=b.stringAbs(n)):a="buy";const p=i?2:1,m=this.safeInteger(e,p);if(i){const t=e[1];f=this.safeSymbol(t),d=this.safeString(e,3);c=1===this.safeInteger(e,8)?"maker":"taker";let i=this.safeString(e,9);i=b.stringNeg(i);const s=this.safeString(e,10);u={cost:i,currency:this.safeCurrencyCode(s)};const r=e[6];l=this.safeString(this.options.exchangeTypes,r)}return this.safeTrade({id:s,timestamp:m,datetime:this.iso8601(m),symbol:f,order:d,side:a,type:l,takerOrMaker:c,price:h,amount:n,cost:void 0,fee:u,info:e},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);let a="-1";const n={symbol:r.id};void 0!==t&&(n.start=t,a="1"),void 0!==i&&(n.limit=i),n.sort=a;const o=await this.publicGetTradesSymbolHist(this.extend(n,s)),h=this.sortBy(o,1);return this.parseTrades(h,r,void 0,i)}async fetchOHLCV(e,t="1m",i,s=100,r={}){await this.loadMarkets();const a=this.market(e);if(void 0===s&&(s=100),void 0===i){const e=this.parseTimeframe(t);i=this.milliseconds()-e*s*1e3}const n={symbol:a.id,timeframe:this.safeString(this.timeframes,t,t),sort:1,start:i,limit:s},o=await this.publicGetCandlesTradeTimeframeSymbolHist(this.extend(n,r));return this.parseOHLCVs(o,a,t,i,s)}parseOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,2),this.safeNumber(e,5)]}parseOrderStatus(e){if(void 0===e)return e;const t=e.split(" "),i=this.safeString(t,0);return this.safeString({ACTIVE:"open",PARTIALLY:"open",EXECUTED:"closed",CANCELED:"canceled",INSUFFICIENT:"canceled","POSTONLY CANCELED":"canceled",RSN_DUST:"rejected",RSN_PAUSE:"rejected","IOC CANCELED":"canceled","FILLORKILL CANCELED":"canceled"},i,e)}parseOrderFlags(e){return this.safeValue({1024:["reduceOnly"],4096:["postOnly"],5120:["reduceOnly","postOnly"]},e,void 0)}parseTimeInForce(e){return this.safeString({"EXCHANGE IOC":"IOC","EXCHANGE FOK":"FOK",IOC:"IOC",FOK:"FOK"},e,"GTC")}parseOrder(e,t){const i=this.safeString(e,0),s=this.safeString(e,3),r=this.safeSymbol(s),a=this.safeInteger(e,5),n=b.stringAbs(this.safeString(e,6)),o=this.safeString(e,7),h=b.stringAbs(o),d=b.stringLt(o,"0")?"sell":"buy",c=this.safeString(e,8),l=this.safeString(this.safeValue(this.options,"exchangeTypes"),c),u=this.parseTimeInForce(c),f=this.safeString(e,12),p=this.parseOrderFlags(f);let m=!1;if(void 0!==p)for(let e=0;e<p.length;e++)"postOnly"===p[e]&&(m=!0);let g,y,v=this.safeString(e,16);"EXCHANGE STOP"!==c&&"EXCHANGE STOP LIMIT"!==c||(v=void 0,g=this.safeNumber(e,16),"EXCHANGE STOP LIMIT"===c&&(v=this.safeString(e,19)));const w=this.safeString(e,13);if(void 0!==w){const e=w.split(" @ ");y=this.parseOrderStatus(this.safeString(e,0))}const S=this.safeString(e,17),k=this.safeString(e,2);return this.safeOrder({info:e,id:i,clientOrderId:k,timestamp:a,datetime:this.iso8601(a),lastTradeTimestamp:void 0,symbol:r,type:l,timeInForce:u,postOnly:m,side:d,price:v,stopPrice:g,triggerPrice:g,amount:h,cost:void 0,average:S,filled:void 0,remaining:n,status:y,fee:void 0,trades:void 0},t)}async createOrder(e,t,i,s,a,n={}){await this.loadMarkets();const o=this.market(e),h=this.safeValue(this.options,"orderTypes",{});let d=t.toUpperCase();o.spot&&(d=this.safeStringUpper(h,t,t));const l=this.safeString2(n,"stopPrice","triggerPrice"),u=this.safeString(n,"timeInForce"),f=this.safeValue(n,"postOnly",!1),p=this.safeValue(n,"reduceOnly",!1),m=this.safeValue2(n,"cid","clientOrderId");n=this.omit(n,["triggerPrice","stopPrice","timeInForce","postOnly","reduceOnly","price_aux_limit"]);let g=this.amountToPrecision(e,s);g="buy"===i?g:b.stringNeg(g);const y={type:d,symbol:o.id,amount:g},v="EXCHANGE STOP LIMIT"===d||"EXCHANGE LIMIT"===d&&void 0!==l,w="EXCHANGE STOP"===d,S="EXCHANGE MARKET"===d,k=w||S&&void 0!==l,T="EXCHANGE IOC"===d||"IOC"===u,_="EXCHANGE FOK"===d||"FOK"===u,O=f||"PO"===u;if((T||_)&&void 0===a)throw new c(this.id+" createOrder() requires a price argument with IOC and FOK orders");if((T||_)&&S)throw new c(this.id+" createOrder() does not allow market IOC and FOK orders");"MARKET"===d||S||w||(y.price=this.priceToPrecision(e,a)),(v||k)&&(y.price=this.priceToPrecision(e,l),k?y.type="EXCHANGE STOP":v&&(y.type="EXCHANGE STOP LIMIT",y.price_aux_limit=this.priceToPrecision(e,a))),T?y.type="EXCHANGE IOC":_&&(y.type="EXCHANGE FOK");let M=0;O&&(M=this.sum(M,4096)),p&&(M=this.sum(M,1024)),0!==M&&(y.flags=M),void 0!==m&&(y.cid=m,n=this.omit(n,["cid","clientOrderId"]));const I=await this.privatePostAuthWOrderSubmit(this.extend(y,n));if("SUCCESS"!==this.safeString(I,6)){const e=I[5],t=I[7];throw new r(this.id+" "+I[6]+": "+t+" (#"+e+")")}const x=this.safeValue(I,4,[]),C=this.safeValue(x,0);return this.parseOrder(C,o)}async cancelAllOrders(e,t={}){const i=await this.privatePostAuthWOrderCancelMulti(this.extend({all:1},t)),s=this.safeValue(i,4,[]);return this.parseOrders(s)}async cancelOrder(e,t,i={}){const s=this.safeValue2(i,"cid","clientOrderId");let r;if(void 0!==s){const e=this.safeValue(i,"cidDate");if(void 0===e)throw new c(this.id+" canceling an order by clientOrderId ('cid') requires both 'cid' and 'cid_date' ('YYYY-MM-DD')");r={cid:s,cid_date:e},i=this.omit(i,["cid","clientOrderId"])}else r={id:parseInt(e)};const a=await this.privatePostAuthWOrderCancel(this.extend(r,i)),n=this.safeValue(a,4);return this.parseOrder(n)}async fetchOpenOrder(e,t,i={}){const s={id:[parseInt(e)]},r=await this.fetchOpenOrders(t,void 0,void 0,this.extend(s,i)),a=this.safeValue(r,0);if(void 0===a)throw new d(this.id+" order "+e+" not found");return a}async fetchClosedOrder(e,t,i={}){const s={id:[parseInt(e)]},r=await this.fetchClosedOrders(t,void 0,void 0,this.extend(s,i)),a=this.safeValue(r,0);if(void 0===a)throw new d(this.id+" order "+e+" not found");return a}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a,n;return void 0===e?n=await this.privatePostAuthROrders(this.extend(r,s)):(a=this.market(e),r.symbol=a.id,n=await this.privatePostAuthROrdersSymbol(this.extend(r,s))),this.parseOrders(n,a,t,i)}async fetchClosedOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a,n;return void 0!==t&&(r.start=t),void 0!==i&&(r.limit=i),void 0===e?n=await this.privatePostAuthROrdersHist(this.extend(r,s)):(a=this.market(e),r.symbol=a.id,n=await this.privatePostAuthROrdersSymbolHist(this.extend(r,s))),this.parseOrders(n,a,t,i)}async fetchOrderTrades(e,t,i,s,r={}){if(void 0===t)throw new n(this.id+" fetchOrderTrades() requires a symbol argument");await this.loadMarkets();const a=this.market(t),o={id:parseInt(e),symbol:a.id},h=await this.privatePostAuthROrderSymbolIdTrades(this.extend(o,r));return this.parseTrades(h,a,i,s)}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets();const a={end:this.milliseconds()};void 0!==t&&(a.start=t),void 0!==i&&(a.limit=i);let n="privatePostAuthRTradesHist";void 0!==e&&(r=this.market(e),a.symbol=r.id,n="privatePostAuthRTradesSymbolHist");const o=await this[n](this.extend(a,s));return this.parseTrades(o,r,t,i)}async createDepositAddress(e,t={}){await this.loadMarkets();return await this.fetchDepositAddress(e,this.extend({op_renew:1},t))}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s=this.safeString(t,"network",e),r=this.safeValue(i,"networks",{}),a=this.safeValue(r,s),o=this.safeString(a,"id");if(void 0===o)throw new n(this.id+" fetchDepositAddress() could not find a network for '"+e+"'. You can specify it by providing the 'network' value inside params");const h=this.safeString(t,"wallet","exchange");t=this.omit(t,"network","wallet");const d={method:o,wallet:h,op_renew:0},c=await this.privatePostAuthWDepositAddress(this.extend(d,t)),l=this.safeValue(c,4,[]),u=this.safeString(l,5),f=void 0===u?this.safeString(l,4):u,p=void 0===u?void 0:this.safeString(l,4);return this.checkAddress(f),{currency:e,address:f,tag:p,network:void 0,info:c}}parseTransactionStatus(e){return this.safeString({SUCCESS:"ok",ERROR:"failed",FAILURE:"failed",CANCELED:"canceled",COMPLETED:"ok"},e,e)}parseTransaction(e,t){const i=e.length;let s,r,a,n,o,h,d,c,l,u,f,p,m;if(8===i){const i=this.safeValue(e,4,[]);s=this.safeInteger(e,0),void 0!==t&&(a=t.code),l=this.safeString(i,8),void 0!==l&&(l=b.stringAbs(l)),n=this.safeNumber(i,5),o=this.safeValue(i,0),h="ok",0===o&&(o=void 0,h="failed"),d=this.safeString(i,3),c="withdrawal"}else if(22===i){o=this.safeString(e,0);const i=this.safeString(e,1);a=this.safeCurrencyCode(i,t);const d=this.safeString(e,2);p=this.safeNetwork(d),s=this.safeInteger(e,5),r=this.safeInteger(e,6),h=this.parseTransactionStatus(this.safeString(e,9));const g=this.safeString(e,12);n=b.stringAbs(g),void 0!==g&&(c=b.stringLt(g,"0")?"withdrawal":"deposit"),l=this.safeString(e,13),void 0!==l&&(l=b.stringAbs(l)),f=this.safeString(e,16),u=this.safeString(e,20),m=this.safeString(e,21)}return{info:e,id:o,txid:u,type:c,currency:a,network:p,amount:this.parseNumber(n),status:h,timestamp:s,datetime:this.iso8601(s),address:f,addressFrom:void 0,addressTo:f,tag:d,tagFrom:void 0,tagTo:d,updated:r,comment:m,fee:{currency:a,cost:this.parseNumber(l),rate:void 0}}}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privatePostAuthRSummary(e),i={},s=this.safeValue(this.options,"fiat",{}),r=this.safeValue(t,4,[]),a=this.safeValue(r,0,[]),n=this.safeValue(r,1,[]),o=this.safeNumber(a,0),h=this.safeNumber(a,2),d=this.safeNumber(a,5),c=this.safeNumber(n,0),l=this.safeNumber(n,2),u=this.safeNumber(n,5);for(let e=0;e<this.symbols.length;e++){const r=this.symbols[e],a=this.market(r),n={info:t,symbol:r,percentage:!0,tierBased:!0};a.quote in s?(n.maker=h,n.taker=l):a.contract?(n.maker=d,n.taker=u):(n.maker=o,n.taker=c),i[r]=n}return i}async fetchTransactions(e,t,i,s={}){let r;await this.loadMarkets();const a={};let n="privatePostAuthRMovementsHist";void 0!==e&&(r=this.currency(e),a.currency=r.uppercaseId,n="privatePostAuthRMovementsCurrencyHist"),void 0!==t&&(a.start=t),void 0!==i&&(a.limit=i);const o=await this[n](this.extend(a,s));return this.parseTransactions(o,r,t,i)}async withdraw(e,t,i,s,a={}){this.checkAddress(i),await this.loadMarkets();const o=this.currency(e),h=this.safeString(a,"network",e);a=this.omit(a,"network");const d=this.safeValue(o,"networks",{}),c=this.safeValue(d,h),l=this.safeString(c,"id");if(void 0===l)throw new n(this.id+" fetchDepositAddress() could not find a network for '"+e+"'. You can specify it by providing the 'network' value inside params");const u=this.safeString(a,"wallet","exchange");a=this.omit(a,"network","wallet");const f={method:l,wallet:u,amount:this.numberToString(t),address:i};void 0!==s&&(f.payment_id=s);const p=await this.privatePostAuthWWithdraw(this.extend(f,a));if("error"===this.safeString(p,0)){const e=this.id+" "+p,t=this.safeString(p,2,"");throw this.throwExactlyMatchedException(this.exceptions.exact,t,e),this.throwBroadlyMatchedException(this.exceptions.broad,t,e),new r(e)}const m=this.safeString(p,7);"success"!==m&&this.throwBroadlyMatchedException(this.exceptions.broad,m,m);const g=this.parseTransaction(p,o);return this.extend(g,{address:i})}async fetchPositions(e,t={}){await this.loadMarkets();return await this.privatePostAuthRPositions(t)}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n="/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));n="v1"===t?t+n:this.version+n;let h=this.urls.api[t]+"/"+n;if("public"===t&&Object.keys(o).length&&(h+="?"+this.urlencode(o)),"private"===t){this.checkRequiredCredentials();const e=this.nonce().toString(),t="/api/"+n+e+(a=this.json(o)),i=this.hmac(this.encode(t),this.encode(this.secret),"sha384");r={"bfx-nonce":e,"bfx-apikey":this.apiKey,"bfx-signature":i,"Content-Type":"application/json"}}return{url:h,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0!==o){if(!Array.isArray(o)){const e=this.safeString2(o,"message","error"),t=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,e,t),this.throwBroadlyMatchedException(this.exceptions.broad,e,t),new r(this.id+" "+n)}}else if(""===o)throw new r(this.id+" returned empty response");if(500===e){const e=this.numberToString(o[1]),t=o[2],i=this.id+" "+t;throw this.throwBroadlyMatchedException(this.exceptions.broad,t,i),this.throwExactlyMatchedException(this.exceptions.exact,e,i),this.throwExactlyMatchedException(this.exceptions.exact,t,i),new r(this.id+" "+t+" (#"+e+")")}return o}parseLedgerEntryType(e){return void 0===e?void 0:e.indexOf("fee")>=0||e.indexOf("charged")>=0?"fee":e.indexOf("exchange")>=0||e.indexOf("position")>=0?"trade":e.indexOf("rebate")>=0?"rebate":e.indexOf("deposit")>=0||e.indexOf("withdrawal")>=0?"transaction":e.indexOf("transfer")>=0?"transfer":e.indexOf("payment")>=0?"payout":e}parseLedgerEntry(e,t){let i;const s=this.safeString(e,0),r=this.safeString(e,1),a=this.safeCurrencyCode(r,t),n=this.safeInteger(e,3),o=this.safeNumber(e,5),h=this.safeNumber(e,6),d=this.safeString(e,8);if(void 0!==d){const e=d.split(" @ "),t=this.safeStringLower(e,0);i=this.parseLedgerEntryType(t)}return{id:s,direction:void 0,account:void 0,referenceId:s,referenceAccount:void 0,type:i,currency:a,amount:o,timestamp:n,datetime:this.iso8601(n),before:void 0,after:h,status:void 0,fee:void 0,info:e}}async fetchLedger(e,t,i,s={}){let r;await this.loadMarkets(),await this.loadMarkets();const a={};let n="privatePostAuthRLedgersHist";void 0!==e&&(r=this.currency(e),a.currency=r.uppercaseId,n="privatePostAuthRLedgersCurrencyHist"),void 0!==t&&(a.start=t),void 0!==i&&(a.limit=i);const o=await this[n](this.extend(a,s));return this.parseLedger(o,r,t,i)}}},85421:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,OrderNotFound:n}=i(73449),{TICK_SIZE:o}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitflyer",name:"bitFlyer",countries:["JP"],version:"v1",rateLimit:1e3,hostname:"bitflyer.com",has:{CORS:void 0,spot:!0,margin:!1,swap:void 0,future:void 0,option:!1,cancelOrder:!0,createOrder:!0,fetchBalance:!0,fetchClosedOrders:"emulated",fetchDeposits:!0,fetchMarginMode:!1,fetchMarkets:!0,fetchMyTrades:!0,fetchOpenOrders:"emulated",fetchOrder:"emulated",fetchOrderBook:!0,fetchOrders:!0,fetchPositionMode:!1,fetchPositions:!0,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!1,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawals:!0,transfer:!1,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/28051642-56154182-660e-11e7-9b0d-6042d1e6edd8.jpg",api:{rest:"https://api.{hostname}"},www:"https://bitflyer.com",doc:"https://lightning.bitflyer.com/docs?lang=en"},api:{public:{get:["getmarkets/usa","getmarkets/eu","getmarkets","getboard","getticker","getexecutions","gethealth","getboardstate","getchats"]},private:{get:["getpermissions","getbalance","getbalancehistory","getcollateral","getcollateralhistory","getcollateralaccounts","getaddresses","getcoinins","getcoinouts","getbankaccounts","getdeposits","getwithdrawals","getchildorders","getparentorders","getparentorder","getexecutions","getpositions","gettradingcommission"],post:["sendcoin","withdraw","sendchildorder","cancelchildorder","sendparentorder","cancelparentorder","cancelallchildorders"]}},fees:{trading:{maker:this.parseNumber("0.002"),taker:this.parseNumber("0.002")}},precisionMode:o})}parseExpiryDate(e){const t=e.slice(0,2),i=e.slice(2,5),s=e.slice(5,9),r=this.safeString({JAN:"01",FEB:"02",MAR:"03",APR:"04",MAY:"05",JUN:"06",JUL:"07",AUG:"08",SEP:"09",OCT:"10",NOV:"11",DEC:"12"},i);return this.parse8601(s+"-"+r+"-"+t+"T00:00:00Z")}async fetchMarkets(e={}){const t=await this.publicGetGetmarkets(e),i=await this.publicGetGetmarketsUsa(e),s=await this.publicGetGetmarketsEu(e);let r=this.arrayConcat(t,i);r=this.arrayConcat(r,s);const a=[];for(let e=0;e<r.length;e++){const t=r[e],i=this.safeString(t,"product_code"),s=i.split("_"),n=this.safeString(t,"market_type"),o="FX"===n,h="Futures"===n,d=!o&&!h;let c,l,u,f,p="spot";if(d)l=this.safeString(s,0),u=this.safeString(s,1);else if(o)p="swap",l=this.safeString(s,1),u=this.safeString(s,2);else if(h){const e=this.safeString(t,"alias");if(void 0===e){l=i.slice(0,3),u=i.slice(3,6);const e=i.slice(-9);f=this.parseExpiryDate(e)}else{const t=e.split("_"),s=this.safeString(t,0);l=s.slice(0,-3),u=s.slice(-3);const r=i.split(s),a=this.safeString(r,1);f=this.parseExpiryDate(a)}p="future"}const m=this.safeCurrencyCode(l),g=this.safeCurrencyCode(u);let y=m+"/"+g,b=this.fees.trading.taker,v=this.fees.trading.maker;const w=o||h;w&&(v=0,b=0,c="JPY",y=y+":"+c,h&&(y=y+"-"+this.yymmdd(f))),a.push({id:i,symbol:y,base:m,quote:g,settle:c,baseId:l,quoteId:u,settleId:void 0,type:p,spot:d,margin:!1,swap:o,future:h,option:!1,active:!0,contract:w,linear:!d||void 0,inverse:!!d&&void 0,taker:b,maker:v,contractSize:void 0,expiry:f,expiryDatetime:this.iso8601(f),strike:void 0,optionType:void 0,precision:{amount:void 0,price:void 0},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return a}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currency_code"),a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(s,"amount"),n.free=this.safeString(s,"available"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetGetbalance(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={product_code:s.id},a=await this.publicGetGetboard(this.extend(r,i));return this.parseOrderBook(a,s.symbol,void 0,"bids","asks","price","size")}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.parse8601(this.safeString(e,"timestamp")),r=this.safeString(e,"ltp");return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:void 0,low:void 0,bid:this.safeString(e,"best_bid"),bidVolume:void 0,ask:this.safeString(e,"best_ask"),askVolume:void 0,vwap:void 0,open:void 0,close:r,last:r,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"volume_by_product"),quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={product_code:i.id},r=await this.publicGetGetticker(this.extend(s,t));return this.parseTicker(r,i)}parseTrade(e,t){let i,s=this.safeStringLower(e,"side");if(void 0!==s&&s.length<1&&(s=void 0),void 0!==s){const t=s+"_child_order_acceptance_id";t in e&&(i=e[t])}void 0===i&&(i=this.safeString(e,"child_order_acceptance_id"));const r=this.parse8601(this.safeString(e,"exec_date")),a=this.safeString(e,"price"),n=this.safeString(e,"size"),o=this.safeString(e,"id");return t=this.safeMarket(void 0,t),this.safeTrade({id:o,info:e,timestamp:r,datetime:this.iso8601(r),symbol:t.symbol,order:i,type:void 0,side:s,takerOrMaker:void 0,price:a,amount:n,cost:void 0,fee:void 0},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={product_code:r.id};void 0!==i&&(a.count=i);const n=await this.publicGetGetexecutions(this.extend(a,s));return this.parseTrades(n,r,t,i)}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={product_code:i.id},r=await this.privateGetGettradingcommission(this.extend(s,t)),a=this.safeNumber(r,"commission_rate");return{info:r,symbol:i.symbol,maker:a,taker:a}}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n={product_code:this.marketId(e),child_order_type:t.toUpperCase(),side:i.toUpperCase(),price:r,size:s},o=await this.privatePostSendchildorder(this.extend(n,a));return{info:o,id:this.safeString(o,"child_order_acceptance_id")}}async cancelOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" cancelOrder() requires a `symbol` argument");await this.loadMarkets();const s={product_code:this.marketId(t),child_order_acceptance_id:e};return await this.privatePostCancelchildorder(this.extend(s,i))}parseOrderStatus(e){return this.safeString({ACTIVE:"open",COMPLETED:"closed",CANCELED:"canceled",EXPIRED:"canceled",REJECTED:"canceled"},e,e)}parseOrder(e,t){const i=this.parse8601(this.safeString(e,"child_order_date")),s=this.safeString(e,"price"),r=this.safeString(e,"size"),a=this.safeString(e,"executed_size"),n=this.safeString(e,"outstanding_size"),o=this.parseOrderStatus(this.safeString(e,"child_order_state")),h=this.safeStringLower(e,"child_order_type"),d=this.safeStringLower(e,"side"),c=this.safeString(e,"product_code"),l=this.safeSymbol(c,t);let u;const f=this.safeNumber(e,"total_commission");void 0!==f&&(u={cost:f,currency:void 0,rate:void 0});const p=this.safeString(e,"child_order_acceptance_id");return this.safeOrder({id:p,clientOrderId:void 0,info:e,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:void 0,status:o,symbol:l,type:h,timeInForce:void 0,postOnly:void 0,side:d,price:s,stopPrice:void 0,triggerPrice:void 0,cost:void 0,amount:r,filled:a,remaining:n,fee:u,average:void 0,trades:void 0},t)}async fetchOrders(e,t,i=100,s={}){if(void 0===e)throw new a(this.id+" fetchOrders() requires a `symbol` argument");await this.loadMarkets();const r=this.market(e),n={product_code:r.id,count:i},o=await this.privateGetGetchildorders(this.extend(n,s));let h=this.parseOrders(o,r,t,i);return void 0!==e&&(h=this.filterBy(h,"symbol",e)),h}async fetchOpenOrders(e,t,i=100,s={}){return await this.fetchOrders(e,t,i,this.extend({child_order_state:"ACTIVE"},s))}async fetchClosedOrders(e,t,i=100,s={}){return await this.fetchOrders(e,t,i,this.extend({child_order_state:"COMPLETED"},s))}async fetchOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" fetchOrder() requires a `symbol` argument");const s=await this.fetchOrders(t),r=this.indexBy(s,"id");if(e in r)return r[e];throw new n(this.id+" No order found with id "+e)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a `symbol` argument");await this.loadMarkets();const r=this.market(e),n={product_code:r.id};void 0!==i&&(n.count=i);const o=await this.privateGetGetexecutions(this.extend(n,s));return this.parseTrades(o,r,t,i)}async fetchPositions(e,t={}){if(void 0===e)throw new a(this.id+" fetchPositions() requires a `symbols` argument, exactly one symbol in an array");await this.loadMarkets();const i={product_code:this.marketIds(e)};return await this.privateGetpositions(this.extend(i,t))}async withdraw(e,t,i,s,a={}){if(this.checkAddress(i),await this.loadMarkets(),"JPY"!==e&&"USD"!==e&&"EUR"!==e)throw new r(this.id+" allows withdrawing JPY, USD, EUR only, "+e+" is not supported");const n=this.currency(e),o={currency_code:n.id,amount:t},h=await this.privatePostWithdraw(this.extend(o,a));return this.parseTransaction(h,n)}async fetchDeposits(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.currency(e)),void 0!==i&&(a.count=i);const n=await this.privateGetGetcoinins(this.extend(a,s));return this.parseTransactions(n,r,t,i)}async fetchWithdrawals(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.currency(e)),void 0!==i&&(a.count=i);const n=await this.privateGetGetcoinouts(this.extend(a,s));return this.parseTransactions(n,r,t,i)}parseDepositStatus(e){return this.safeString({PENDING:"pending",COMPLETED:"ok"},e,e)}parseWithdrawalStatus(e){return this.safeString({PENDING:"pending",COMPLETED:"ok"},e,e)}parseTransaction(e,t){const i=this.safeString2(e,"id","message_id"),s=this.safeString(e,"address"),r=this.safeString(e,"currency_code"),a=this.safeCurrencyCode(r,t),n=this.parse8601(this.safeString(e,"event_date")),o=this.safeNumber(e,"amount"),h=this.safeString(e,"tx_hash"),d=this.safeString(e,"status");let c,l,u;if("fee"in e){c="withdrawal",l=this.parseWithdrawalStatus(d);u={currency:a,cost:this.safeNumber(e,"fee")+this.safeNumber(e,"additional_fee")}}else c="deposit",l=this.parseDepositStatus(d);return{info:e,id:i,txid:h,timestamp:n,datetime:this.iso8601(n),network:void 0,address:s,addressTo:s,addressFrom:void 0,tag:void 0,tagTo:void 0,tagFrom:void 0,type:c,amount:o,currency:a,status:l,updated:void 0,internal:void 0,fee:u}}sign(e,t="public",i="GET",s={},r,a){let n="/"+this.version+"/";"private"===t&&(n+="me/"),n+=e,"GET"===i&&Object.keys(s).length&&(n+="?"+this.urlencode(s));const o=this.implodeHostname(this.urls.api.rest)+n;if("private"===t){this.checkRequiredCredentials();const e=this.nonce().toString();let t=[e,i,n].join("");Object.keys(s).length&&"GET"!==i&&(t+=a=this.json(s)),r={"ACCESS-KEY":this.apiKey,"ACCESS-TIMESTAMP":e,"ACCESS-SIGN":this.hmac(this.encode(t),this.encode(this.secret)),"Content-Type":"application/json"}}return{url:o,method:i,body:a,headers:r}}}},52519:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,AuthenticationError:n,OrderNotFound:o,InsufficientFunds:h,DDoSProtection:d,PermissionDenied:c,BadSymbol:l,InvalidOrder:u}=i(73449),{TICK_SIZE:f}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitforex",name:"Bitforex",countries:["CN"],rateLimit:500,version:"v1",has:{CORS:void 0,spot:!0,margin:!1,swap:void 0,future:!1,option:!1,cancelOrder:!0,createOrder:!0,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchMarginMode:!1,fetchMarkets:!0,fetchMyTrades:!1,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPositionMode:!1,fetchTicker:!0,fetchTickers:!1,fetchTrades:!0,fetchTransactionFees:!1,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!1,fetchWithdrawals:!1,transfer:!1,withdraw:!1},timeframes:{"1m":"1min","5m":"5min","15m":"15min","30m":"30min","1h":"1hour","2h":"2hour","4h":"4hour","12h":"12hour","1d":"1day","1w":"1week","1M":"1month"},urls:{logo:"https://user-images.githubusercontent.com/51840849/87295553-1160ec00-c50e-11ea-8ea0-df79276a9646.jpg",api:{rest:"https://api.bitforex.com"},www:"https://www.bitforex.com",doc:"https://github.com/githubdev2020/API_Doc_en/wiki",fees:"https://help.bitforex.com/en_us/?cat=13",referral:"https://www.bitforex.com/en/invitationRegister?inviterId=1867438"},api:{public:{get:{"api/v1/market/symbols":20,"api/v1/market/ticker":4,"api/v1/market/ticker-all":4,"api/v1/market/depth":4,"api/v1/market/depth-all":4,"api/v1/market/trades":20,"api/v1/market/kline":20}},private:{post:{"api/v1/fund/mainAccount":1,"api/v1/fund/allAccount":30,"api/v1/trade/placeOrder":1,"api/v1/trade/placeMultiOrder":10,"api/v1/trade/cancelOrder":1,"api/v1/trade/cancelMultiOrder":20,"api/v1/trade/cancelAllOrder":20,"api/v1/trade/orderInfo":1,"api/v1/trade/multiOrderInfo":10,"api/v1/trade/orderInfos":20}}},fees:{trading:{tierBased:!1,percentage:!0,maker:this.parseNumber("0.001"),taker:this.parseNumber("0.001")},funding:{tierBased:!1,percentage:!0,deposit:{},withdraw:{}}},commonCurrencies:{BKC:"Bank Coin",CAPP:"Crypto Application Token",CREDIT:"TerraCredit",CTC:"Culture Ticket Chain",EWT:"EcoWatt Token",IQ:"IQ.Cash",MIR:"MIR COIN",NOIA:"METANOIA",TON:"To The Moon"},precisionMode:f,exceptions:{1e3:o,1003:l,1013:n,1016:n,1017:c,1019:l,3002:h,4002:u,4003:u,4004:o,10204:d}})}async fetchMarkets(e={}){const t=(await this.publicGetApiV1MarketSymbols(e)).data,i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"symbol"),a=r.split("-"),n=a[2],o=a[1],h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o);i.push({id:r,symbol:h+"/"+d,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:!0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDateTime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(s,"amountPrecision"))),price:this.parseNumber(this.parsePrecision(this.safeString(s,"pricePrecision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(s,"minOrderAmount"),max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:s})}return i}parseTrade(e,t){t=this.safeMarket(void 0,t);const i=this.safeInteger(e,"time"),s=this.safeString(e,"tid"),r=this.safeString(e,"price"),a=this.safeString(e,"amount"),n=this.safeInteger(e,"direction"),o=this.parseSide(n);return this.safeTrade({info:e,id:s,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,type:void 0,side:o,price:r,amount:a,cost:void 0,order:undefined,fee:void 0,takerOrMaker:void 0},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r={symbol:this.marketId(e)};void 0!==i&&(r.size=i);const a=this.market(e),n=await this.publicGetApiV1MarketTrades(this.extend(r,s));return this.parseTrades(n.data,a,t,i)}parseBalance(e){const t=e.data,i={info:e};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.used=this.safeString(s,"frozen"),n.free=this.safeString(s,"active"),n.total=this.safeString(s,"fix"),i[a]=n}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostApiV1FundAllAccount(e);return this.parseBalance(t)}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.safeInteger(e,"date");return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"buy"),bidVolume:void 0,ask:this.safeString(e,"sell"),askVolume:void 0,vwap:void 0,open:void 0,close:this.safeString(e,"last"),last:this.safeString(e,"last"),previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"vol"),quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.markets[e],s={symbol:i.id},r=await this.publicGetApiV1MarketTickerAll(this.extend(s,t)),a=this.safeValue(r,"data");return this.parseTicker(a,i)}parseOHLCV(e,t){return[this.safeInteger(e,"time"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"vol")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,ktype:this.safeString(this.timeframes,t,t)};void 0!==s&&(n.size=s);const o=await this.publicGetApiV1MarketKline(this.extend(n,r)),h=this.safeValue(o,"data",[]);return this.parseOHLCVs(h,a,t,i,s)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};void 0!==t&&(r.size=t);const a=await this.publicGetApiV1MarketDepthAll(this.extend(r,i)),n=this.safeValue(a,"data"),o=this.safeInteger(a,"time");return this.parseOrderBook(n,s.symbol,o,"bids","asks","price","amount")}parseOrderStatus(e){const t={0:"open",1:"open",2:"closed",3:"canceled",4:"canceled"};return e in t?t[e]:e}parseSide(e){return 1===e?"buy":2===e?"sell":void 0}parseOrder(e,t){const i=this.safeString(e,"orderId"),s=this.safeNumber(e,"createTime"),r=this.safeNumber(e,"lastTime"),a=t.symbol,n=this.safeInteger(e,"tradeType"),o=this.parseSide(n),h=this.safeString(e,"orderPrice"),d=this.safeString(e,"avgPrice"),c=this.safeString(e,"orderAmount"),l=this.safeString(e,"dealAmount"),u=this.parseOrderStatus(this.safeString(e,"orderState")),f=t["buy"===o?"base":"quote"],p={cost:this.safeNumber(e,"tradeFee"),currency:f};return this.safeOrder({info:e,id:i,clientOrderId:void 0,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:r,symbol:a,type:undefined,timeInForce:void 0,postOnly:void 0,side:o,price:h,stopPrice:void 0,triggerPrice:void 0,cost:void 0,average:d,amount:c,filled:l,remaining:void 0,status:u,fee:p,trades:void 0},t)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s=this.market(t),r={symbol:this.marketId(t),orderId:e},a=await this.privatePostApiV1TradeOrderInfo(this.extend(r,i));return this.parseOrder(a.data,s)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={symbol:this.marketId(e),state:0},o=await this.privatePostApiV1TradeOrderInfos(this.extend(n,s));return this.parseOrders(o.data,r,t,i)}async fetchClosedOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={symbol:this.marketId(e),state:1},o=await this.privatePostApiV1TradeOrderInfos(this.extend(n,s));return this.parseOrders(o.data,r,t,i)}async createOrder(e,t,i,s,r,a={}){let n;await this.loadMarkets(),"buy"===i?n=1:"sell"===i&&(n=2);const o={symbol:this.market(e).id,price:r,amount:s,tradeType:n},h=await this.privatePostApiV1TradePlaceOrder(this.extend(o,a)),d=h.data;return{info:h,id:this.safeString(d,"orderId")}}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={orderId:e};void 0!==t&&(s.symbol=this.marketId(t));const r=await this.privatePostApiV1TradeCancelOrder(this.extend(s,i));return{info:r,success:r.success}}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if("public"===t)Object.keys(o).length&&(n+="?"+this.urlencode(o));else{this.checkRequiredCredentials();let t=this.urlencode({accessKey:this.apiKey});o.nonce=this.milliseconds(),Object.keys(o).length&&(t+="&"+this.urlencode(this.keysort(o)));const i="/"+e+"?"+t;a=t+"&signData="+this.hmac(this.encode(i),this.encode(this.secret)),r={"Content-Type":"application/x-www-form-urlencoded"}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if("string"==typeof n&&("{"===n[0]||"["===n[0])){const e=this.id+" "+n,t=this.safeValue(o,"success");if(void 0!==t&&!t){const t=this.safeString(o,"code");throw this.throwExactlyMatchedException(this.exceptions,t,e),new r(e)}}}}},20829:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ExchangeNotAvailable:a,NotSupported:n,OnMaintenance:o,ArgumentsRequired:h,BadRequest:d,AccountSuspended:c,InvalidAddress:l,PermissionDenied:u,DDoSProtection:f,InsufficientFunds:p,InvalidNonce:m,CancelPending:g,InvalidOrder:y,OrderNotFound:b,AuthenticationError:v,RequestTimeout:w,BadSymbol:S,RateLimitExceeded:k}=i(73449),{TICK_SIZE:T}=i(62115),_=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitget",name:"Bitget",countries:["SG"],version:"v1",rateLimit:50,certified:!0,pro:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:!0,future:!0,option:!1,addMargin:!0,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:!0,createOrder:!0,createReduceOnlyOrder:!1,editOrder:!0,fetchAccounts:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchCanceledOrders:!0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDeposits:!0,fetchFundingHistory:!0,fetchFundingRate:!0,fetchFundingRateHistory:!0,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLedger:!0,fetchLeverage:!0,fetchLeverageTiers:!1,fetchMarginMode:void 0,fetchMarketLeverageTiers:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterest:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchOrderTrades:!0,fetchPosition:!0,fetchPositionMode:!1,fetchPositions:!0,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!0,fetchTransfer:!1,fetchTransfers:!0,fetchWithdrawal:!1,fetchWithdrawals:!0,reduceMargin:!0,setLeverage:!0,setMarginMode:!0,setPositionMode:!0,transfer:!0,withdraw:!1},timeframes:{"1m":"1m","3m":"3m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","2h":"2h","4h":"4h","6h":"6h","12h":"12h","1d":"1d","3d":"3d","1w":"1w","1M":"1M"},hostname:"bitget.com",urls:{logo:"https://user-images.githubusercontent.com/1294454/195989417-4253ddb0-afbe-4a1c-9dea-9dbcd121fa5d.jpg",api:{spot:"https://api.{hostname}",mix:"https://api.{hostname}"},www:"https://www.bitget.com",doc:["https://bitgetlimited.github.io/apidoc/en/mix","https://bitgetlimited.github.io/apidoc/en/spot","https://bitgetlimited.github.io/apidoc/en/broker"],fees:"https://www.bitget.cc/zh-CN/rate?tab=1",referral:"https://www.bitget.com/expressly?languageType=0&channelCode=ccxt&vipCode=tg9j"},api:{public:{spot:{get:{"public/time":1,"public/currencies":1,"public/products":1,"public/product":1,"market/ticker":1,"market/tickers":1,"market/fills":1,"market/candles":1,"market/depth":1}},mix:{get:{"market/contracts":1,"market/depth":1,"market/ticker":1,"market/tickers":1,"market/fills":1,"market/candles":1,"market/index":1,"market/funding-time":1,"market/history-fundRate":1,"market/current-fundRate":1,"market/open-interest":1,"market/mark-price":1,"market/symbol-leverage":1}}},private:{spot:{get:{"account/getInfo":20,"account/assets":2,"account/transferRecords":4,"wallet/deposit-address":4,"wallet/withdrawal-inner":4,"wallet/withdrawal-list":1,"wallet/deposit-list":1},post:{"account/bills":2,"account/sub-account-spot-assets":200,"trade/orders":2,"trade/batch-orders":4,"trade/cancel-order":2,"trade/cancel-batch-orders":4,"trade/orderInfo":1,"trade/open-orders":1,"trade/history":1,"trade/fills":1,"wallet/transfer":4,"wallet/withdrawal":4,"wallet/subTransfer":10,"plan/placePlan":1,"plan/modifyPlan":1,"plan/cancelPlan":1,"plan/currentPlan":1,"plan/historyPlan":1}},mix:{get:{"account/account":2,"account/accounts":2,"account/accountBill":2,"account/accountBusinessBill":4,"account/open-count":1,"order/current":2,"order/history":2,"order/detail":2,"order/fills":2,"order/historyProductType":8,"order/allFills":2,"plan/currentPlan":2,"plan/historyPlan":2,"position/singlePosition":2,"position/allPosition":2,"trace/currentTrack":2,"trace/followerOrder":2,"trace/historyTrack":2,"trace/summary":2,"trace/profitSettleTokenIdGroup":2,"trace/profitDateGroupList":2,"trade/profitDateList":2,"trace/waitProfitDateList":2,"trace/traderSymbols":2,"order/marginCoinCurrent":2},post:{"account/setLeverage":8,"account/setMargin":8,"account/setMarginMode":8,"account/setPositionMode":8,"order/placeOrder":2,"order/batch-orders":2,"order/cancel-order":2,"order/cancel-all-orders":2,"order/cancel-batch-orders":2,"plan/placePlan":2,"plan/modifyPlan":2,"plan/modifyPlanPreset":2,"plan/placeTPSL":2,"plan/placeTrailStop":2,"plan/placePositionsTPSL":2,"plan/modifyTPSLPlan":2,"plan/cancelPlan":2,"plan/cancelAllPlan":2,"trace/closeTrackOrder":2,"trace/setUpCopySymbols":2}}}},fees:{spot:{taker:this.parseNumber("0.002"),maker:this.parseNumber("0.002")},swap:{taker:this.parseNumber("0.0006"),maker:this.parseNumber("0.0004")}},requiredCredentials:{apiKey:!0,secret:!0,password:!0},exceptions:{exact:{1:r,"failure to get a peer from the ring-balancer":a,4010:u,4001:r,4002:r,30001:v,30002:v,30003:v,30004:v,30005:m,30006:v,30007:d,30008:w,30009:r,30010:v,30011:u,30012:v,30013:v,30014:f,30015:v,30016:r,30017:r,30018:r,30019:a,30020:d,30021:d,30022:u,30023:d,30024:S,30025:d,30026:f,30027:v,30028:u,30029:c,30030:r,30031:d,30032:S,30033:d,30034:r,30035:r,30036:r,30037:a,30038:o,32001:c,32002:u,32003:g,32004:r,32005:y,32006:y,32007:y,32008:y,32009:y,32010:r,32011:r,32012:r,32013:r,32014:r,32015:r,32016:r,32017:r,32018:r,32019:r,32020:r,32021:r,32022:r,32023:r,32024:r,32025:r,32026:r,32027:r,32028:c,32029:r,32030:y,32031:h,32038:v,32040:r,32044:r,32045:r,32046:r,32047:r,32048:y,32049:r,32050:y,32051:y,32052:r,32053:r,32057:r,32054:r,32055:y,32056:r,32058:r,32059:y,32060:y,32061:y,32062:y,32063:y,32064:r,32065:r,32066:r,32067:r,32068:r,32069:r,32070:r,32071:r,32072:r,32073:r,32074:r,32075:r,32076:r,32077:r,32078:r,32079:r,32080:r,32083:r,33001:u,33002:c,33003:p,33004:r,33005:r,33006:r,33007:r,33008:p,33009:r,33010:r,33011:r,33012:r,33013:y,33014:b,33015:y,33016:r,33017:p,33018:r,33020:r,33021:d,33022:y,33023:r,33024:y,33025:y,33026:r,33027:y,33028:y,33029:y,33034:r,33035:r,33036:r,33037:r,33038:r,33039:r,33040:r,33041:r,33042:r,33043:r,33044:r,33045:r,33046:r,33047:r,33048:r,33049:r,33050:r,33051:r,33059:d,33060:d,33061:r,33062:r,33063:r,33064:r,33065:r,21009:r,34001:u,34002:l,34003:r,34004:r,34005:r,34006:r,34007:r,34008:p,34009:r,34010:r,34011:r,34012:r,34013:r,34014:r,34015:r,34016:u,34017:c,34018:v,34019:u,34020:u,34021:l,34022:r,34023:u,34026:r,34036:r,34037:r,34038:r,34039:r,35001:r,35002:r,35003:r,35004:r,35005:v,35008:y,35010:y,35012:y,35014:y,35015:y,35017:r,35019:y,35020:y,35021:y,35022:r,35024:r,35025:p,35026:r,35029:b,35030:y,35031:y,35032:r,35037:r,35039:r,35040:y,35044:r,35046:p,35047:p,35048:r,35049:y,35050:y,35052:p,35053:r,35055:p,35057:r,35058:r,35059:d,35060:d,35061:d,35062:y,35063:y,35064:y,35066:y,35067:y,35068:y,35069:y,35070:y,35071:y,35072:y,35073:y,35074:y,35075:y,35076:y,35077:y,35078:y,35079:y,35080:y,35081:y,35082:y,35083:y,35084:y,35085:y,35086:y,35087:y,35088:y,35089:y,35090:r,35091:r,35092:r,35093:r,35094:r,35095:d,35096:r,35097:r,35098:r,35099:r,36001:d,36002:d,36005:r,36101:v,36102:u,36103:c,36104:u,36105:u,36106:c,36107:u,36108:p,36109:u,36201:u,36202:u,36203:y,36204:r,36205:d,36206:d,36207:y,36208:y,36209:y,36210:y,36211:y,36212:y,36213:y,36214:r,36216:b,36217:y,36218:y,36219:y,36220:y,36221:y,36222:y,36223:y,36224:y,36225:y,36226:y,36227:y,36228:y,36229:y,36230:y,400:d,401:v,403:u,404:d,405:d,415:d,429:f,500:a,1001:k,1002:r,1003:r,40001:v,40002:v,40003:v,40004:m,40005:m,40006:v,40007:d,40008:m,40009:v,40010:v,40011:v,40012:v,40013:r,40014:u,40015:r,40016:u,40017:r,40018:u,40102:d,40103:d,40104:r,40105:r,40106:r,40107:r,40108:y,40109:b,40200:o,40201:y,40202:r,40203:d,40204:d,40205:d,40206:d,40207:d,40208:d,40209:d,40300:r,40301:u,40302:d,40303:d,40304:d,40305:d,40306:r,40308:o,40309:S,40400:r,40401:r,40402:d,40403:d,40404:d,40405:d,40406:d,40407:r,40408:r,40409:r,40500:y,40501:r,40502:r,40503:r,40504:r,40505:r,40506:v,40507:v,40508:r,40509:r,40600:r,40601:r,40602:r,40603:r,40604:a,40605:r,40606:r,40607:r,40608:r,40609:r,40700:d,40701:r,40702:r,40703:r,40704:r,40705:d,40706:y,40707:d,40708:d,40709:r,40710:r,40711:p,40712:p,40713:r,40714:r,43011:y,43025:y,45110:y,"invalid sign":v,"invalid currency":S,"invalid symbol":S,"invalid period":d,"invalid user":r,"invalid amount":y,"invalid type":y,"invalid orderId":y,"invalid record":r,"invalid accountId":d,"invalid address":d,"accesskey not null":v,"illegal accesskey":v,"sign not null":v,"req_time is too much difference from server time":m,"permissions not right":u,"illegal sign invalid":v,"user locked":c,"Request Frequency Is Too High":k,"more than a daily rate of cash":d,"more than the maximum daily withdrawal amount":d,"need to bind email or mobile":r,"user forbid":u,"User Prohibited Cash Withdrawal":u,"Cash Withdrawal Is Less Than The Minimum Value":d,"Cash Withdrawal Is More Than The Maximum Value":d,"the account with in 24 hours ban coin":u,"order cancel fail":d,"base symbol error":S,"base date error":r,"api signature not valid":v,"gateway internal error":r,"audit failed":r,"order queryorder invalid":d,"market no need price":y,"limit need price":y,"userid not equal to account_id":r,"your balance is low":p,"address invalid cointype":r,"system exception":r,50003:r,50004:S,50006:u,50007:u,50008:w,50009:k,50010:r,50014:y,50015:y,50016:y,50017:y,50018:y,50019:y,50020:p,50021:y,50026:y,"invalid order query time":r,"invalid start time":d,"invalid end time":d,20003:r,"01001":r,43111:u},broad:{"invalid size, valid range":r}},precisionMode:T,commonCurrencies:{JADE:"Jade Protocol"},options:{timeframes:{spot:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","4h":"4h","6h":"6Hutc","12h":"12Hutc","1d":"1Dutc","3d":"3Dutc","1w":"1Wutc","1M":"1Mutc"},swap:{"1m":"1m","3m":"3m","5m":"5m","15m":"15m","30m":"30m","1h":"1H","2h":"2H","4h":"4H","6h":"6Hutc","12h":"12Hutc","1d":"1Dutc","3d":"3Dutc","1w":"1Wutc","1M":"1Mutc"}},fetchMarkets:["spot","swap"],defaultType:"spot",defaultSubType:"linear",createMarketBuyOrderRequiresPrice:!0,broker:"p4sve",withdraw:{fillResponseFromRequest:!0},accountsByType:{main:"EXCHANGE",spot:"EXCHANGE",future:"USDT_MIX",contract:"CONTRACT",mix:"USD_MIX"},accountsById:{EXCHANGE:"spot",USDT_MIX:"future",CONTRACT:"swap",USD_MIX:"swap"},sandboxMode:!1}})}setSandboxMode(e){this.options.sandboxMode=e}async fetchTime(e={}){const t=await this.publicSpotGetPublicTime(e);return this.safeInteger(t,"data")}async fetchMarkets(e={}){const t=this.safeValue(this.options,"sandboxMode",!1);let i=this.safeValue(this.options,"fetchMarkets",["spot","swap"]);t&&(i=["swap"]);let s=[];for(let r=0;r<i.length;r++){const a=i[r];if("swap"===a){let i;i=t?["sumcbl","sdmcbl","scmcbl"]:["umcbl","dmcbl","cmcbl"];for(let t=0;t<i.length;t++)s.push(this.fetchMarketsByType(a,this.extend(e,{productType:i[t]})))}else s.push(this.fetchMarketsByType(i[r],e))}s=await Promise.all(s);let r=s[0];for(let e=1;e<s.length;e++)r=this.arrayConcat(r,s[e]);return r}parseMarkets(e){const t=[];for(let i=0;i<e.length;i++)t.push(this.parseMarket(e[i]));return t}parseMarket(e){const t=this.safeString(e,"symbol"),i=this.safeString(e,"quoteCoin"),s=this.safeString(e,"baseCoin"),r=this.safeCurrencyCode(i),a=this.safeCurrencyCode(s),n=this.safeValue(e,"supportMarginCoins",[]),o=this.safeString(n,0),h=this.safeCurrencyCode(o);let d=a+"/"+r;const c=t.split("_"),l=this.safeString(c,1);let u,f,p,m,g,y,b,v=!1,w=!1,S=!1,k=!1;if("SPBL"===l)u="spot",w=!0,f=this.parseNumber(this.parsePrecision(this.safeString(e,"priceScale"))),p=this.parseNumber(this.parsePrecision(this.safeString(e,"quantityScale")));else{const t=this.safeString(c,2);if(void 0!==t){b="20"+t.slice(0,2)+"-"+t.slice(2,4)+"-"+t.slice(4,6)+"T00:00:00Z",y=this.parse8601(b),u="future",S=!0,d=d+":"+h+"-"+t}else u="swap",v=!0,d=d+":"+h;k=!0,m="UMCBL"===l||"CMCBL"===l||"SUMCBL"===l||"SCMCBL"===l,g=!m;const i=this.safeInteger(e,"pricePlace"),s=this.safeInteger(e,"volumePlace"),r=this.safeString(e,"priceEndStep"),a=this.safeString(e,"minTradeNum"),n=new _(r);n.decimals=Math.max(n.decimals,i),n.reduce();const o=n.toString();f=this.parseNumber(o);const w=new _(a);w.decimals=Math.max(w.decimals,s),w.reduce();const T=w.toString();p=this.parseNumber(T)}const T=this.safeString2(e,"status","symbolStatus");let O,M;return void 0!==T&&(O="online"===T||"normal"===T),"USDT"===r&&(M=this.safeNumber(e,"minTradeUSDT")),{id:t,symbol:d,base:a,quote:r,settle:h,baseId:s,quoteId:i,settleId:o,type:u,spot:w,margin:!1,swap:v,future:S,option:!1,active:O,contract:k,linear:m,inverse:g,taker:this.safeNumber(e,"takerFeeRate"),maker:this.safeNumber(e,"makerFeeRate"),contractSize:this.safeNumber(e,"sizeMultiplier"),expiry:y,expiryDatetime:b,strike:void 0,optionType:void 0,precision:{amount:p,price:f},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber2(e,"minTradeNum","minTradeAmount"),max:this.safeNumber(e,"maxTradeAmount")},price:{min:void 0,max:void 0},cost:{min:M,max:void 0}},info:e}}async fetchMarketsByType(e,t={}){const i=this.getSupportedMapping(e,{spot:"publicSpotGetPublicProducts",swap:"publicMixGetMarketContracts"}),s=await this[i](t),r=this.safeValue(s,"data",[]);return this.parseMarkets(r)}async fetchCurrencies(e={}){const t=await this.publicSpotGetPublicCurrencies(e),i={},s=this.safeValue(t,"data",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"coinId"),a=this.safeCurrencyCode(this.safeString(t,"coinName")),n=this.safeValue(t,"chains",[]),o={};for(let e=0;e<n.length;e++){const t=n[e],i=this.safeString(t,"chain"),s=this.safeCurrencyCode(i),r=this.safeString(t,"withdrawable"),a=this.safeString(t,"rechargeable");o[s]={info:t,id:i,network:s,limits:{withdraw:{min:this.safeNumber(t,"minWithdrawAmount"),max:void 0},deposit:{min:this.safeNumber(t,"minDepositAmount"),max:void 0}},active:void 0,withdraw:"true"===r,deposit:"true"===a,fee:this.safeNumber(t,"withdrawFee"),precision:void 0}}i[a]={info:t,id:r,code:a,networks:o,type:void 0,name:void 0,active:void 0,deposit:void 0,withdraw:void 0,fee:void 0,precision:void 0,limits:{amount:{min:void 0,max:void 0},withdraw:{min:void 0,max:void 0}}}}return i}async fetchDeposits(e,t,i,s={}){if(await this.loadMarkets(),void 0===e)throw new h(this.id+" fetchDeposits() requires a `code` argument");const r=this.currency(e);void 0===t&&(t=this.milliseconds()-31556952e3);const a={coin:r.code,startTime:t,endTime:this.milliseconds()};void 0!==i&&(a.pageSize=i);const n=await this.privateSpotGetWalletDepositList(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTransactions(o,r,t,i)}async withdraw(e,t,i,s,r={}){this.checkAddress(i);const a=this.safeString(r,"chain");if(void 0===a)throw new h(this.id+" withdraw() requires a chain parameter");await this.loadMarkets();const n={coin:this.currency(e).code,address:i,chain:a,amount:t};void 0!==s&&(n.tag=s);const o=await this.privateSpotPostWalletWithdrawal(this.extend(n,r)),d={id:this.safeString(o,"data"),info:o,txid:void 0,timestamp:void 0,datetime:void 0,network:void 0,addressFrom:void 0,address:void 0,addressTo:void 0,amount:void 0,type:"withdrawal",currency:void 0,status:void 0,updated:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,comment:void 0,fee:void 0},c=this.safeValue(this.options,"withdraw",{});return this.safeValue(c,"fillResponseFromRequest",!0)&&(d.currency=e,d.timestamp=this.milliseconds(),d.datetime=this.iso8601(this.milliseconds()),d.amount=t,d.tag=s,d.address=i,d.addressTo=i,d.network=a),d}async fetchWithdrawals(e,t,i,s={}){if(await this.loadMarkets(),void 0===e)throw new h(this.id+" fetchWithdrawals() requires a `code` argument");const r=this.currency(e);void 0===t&&(t=this.milliseconds()-31556952e3);const a={coin:r.code,startTime:t,endTime:this.milliseconds()};void 0!==i&&(a.pageSize=i);const n=await this.privateSpotGetWalletWithdrawalList(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTransactions(o,r,t,i)}parseTransaction(e,t){const i=this.safeInteger(e,"cTime"),s=this.safeString(e,"chain"),r=this.safeString(e,"coin"),a=this.safeString(e,"status");return{id:this.safeString(e,"id"),info:e,txid:this.safeString(e,"txId"),timestamp:i,datetime:this.iso8601(i),network:s,addressFrom:void 0,address:this.safeString(e,"toAddress"),addressTo:this.safeString(e,"toAddress"),amount:this.safeNumber(e,"amount"),type:this.safeString(e,"type"),currency:this.safeCurrencyCode(r),status:this.parseTransactionStatus(a),updated:this.safeNumber(e,"uTime"),tagFrom:void 0,tag:void 0,tagTo:void 0,comment:void 0,fee:void 0}}parseTransactionStatus(e){return this.safeString({success:"ok",Pending:"pending",pending_review:"pending",pending_review_fail:"failed",reject:"failed"},e,e)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={coin:i.code},r=await this.privateSpotGetWalletDepositAddress(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseDepositAddress(a,i)}parseDepositAddress(e,t){const i=this.safeString(e,"coin"),s=this.safeString(e,"chain");return{currency:this.safeCurrencyCode(i,t),address:this.safeString(e,"address"),tag:this.safeString(e,"tag"),network:s,info:e}}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),[r,a]=this.handleMarketTypeAndParams("fetchOrderBook",s,i),n=this.getSupportedMapping(r,{spot:"publicSpotGetMarketDepth",swap:"publicMixGetMarketDepth"}),o={symbol:s.id};void 0!==t&&(o.limit=t);const h=await this[n](this.extend(o,a)),d=this.safeValue(h,"data"),c=this.safeInteger(d,"timestamp");return this.parseOrderBook(d,e,c)}parseTicker(e,t){let i=this.safeString(e,"symbol");void 0===t&&void 0!==i&&-1===i.indexOf("_")&&(i+="_SPBL");const s=this.safeSymbol(i,t),r=this.safeString(e,"high24h"),a=this.safeString(e,"low24h"),n=this.safeString2(e,"close","last"),o=this.safeString2(e,"quoteVol","quoteVolume"),h=this.safeString2(e,"baseVol","baseVolume"),d=this.safeInteger2(e,"ts","timestamp"),c=this.iso8601(d),l=this.safeString2(e,"buyOne","bestBid"),u=this.safeString2(e,"sellOne","bestAsk"),f=_.stringMul(this.safeString(e,"priceChangePercent"),"100");return this.safeTicker({symbol:s,timestamp:d,datetime:c,high:r,low:a,bid:l,bidVolume:void 0,ask:u,askVolume:void 0,vwap:void 0,open:void 0,close:n,last:void 0,previousClose:void 0,change:void 0,percentage:f,average:void 0,baseVolume:h,quoteVolume:o,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},[r,a]=this.handleMarketTypeAndParams("fetchTicker",i,t),n=this.getSupportedMapping(r,{spot:"publicSpotGetMarketTicker",swap:"publicMixGetMarketTicker"}),o=await this[n](this.extend(s,a)),h=this.safeValue(o,"data");return this.parseTicker(h,i)}async fetchTickers(e,t={}){let i,s;if(await this.loadMarkets(),void 0!==e){const t=this.safeValue(e,0);s=this.market(t)}[i,t]=this.handleMarketTypeAndParams("fetchTickers",s,t);const r=this.getSupportedMapping(i,{spot:"publicSpotGetMarketTickers",swap:"publicMixGetMarketTickers"}),a={};if("publicMixGetMarketTickers"===r){const e=this.safeString(this.options,"defaultSubType");a.productType="linear"===e?"UMCBL":"DMCBL"}const n=await this[r](this.extend(a,t)),o=this.safeValue(n,"data");return this.parseTickers(o,e)}parseTrade(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t),r=this.safeString2(e,"tradeId","fillId"),a=this.safeString(e,"orderId"),n=this.safeString(e,"side"),o=this.safeString2(e,"fillPrice","price");let h=this.safeString2(e,"fillQuantity","size");h=this.safeString(e,"sizeQty",h);let d,c=this.safeInteger2(e,"fillTime","timestamp");c=this.safeInteger(e,"cTime",c);const l=this.safeString(e,"fees"),u=this.safeString(e,"orderType");if(void 0!==l){const t=this.safeCurrencyCode(this.safeString(e,"feeCcy"));d={code:t,currency:t,cost:l}}const f=this.iso8601(c);return this.safeTrade({info:e,id:r,order:a,symbol:s,side:n,type:u,takerOrMaker:void 0,price:o,amount:h,cost:void 0,fee:d,timestamp:c,datetime:f},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==t&&(a.limit=t);const[n,o]=this.handleMarketTypeAndParams("fetchTrades",r,s),h=this.getSupportedMapping(n,{spot:"publicSpotGetMarketFills",swap:"publicMixGetMarketFills"}),d=await this[h](this.extend(a,o)),c=this.safeValue(d,"data",[]);return this.parseTrades(c,r,i,t)}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicSpotGetPublicProduct(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseTradingFee(a,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.publicSpotGetPublicProducts(e),i=this.safeValue(t,"data",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.parseTradingFee(t);s[r.symbol]=r}return s}parseTradingFee(e,t){const i=this.safeString(e,"symbol");return{info:e,symbol:this.safeSymbol(i,t),maker:this.safeNumber(e,"makerFeeRate"),taker:this.safeNumber(e,"takerFeeRate")}}parseOHLCV(e,t,i="1m"){return[this.safeInteger2(e,0,"ts"),this.safeNumber2(e,1,"open"),this.safeNumber2(e,2,"high"),this.safeNumber2(e,3,"low"),this.safeNumber2(e,4,"close"),this.safeNumber2(e,5,"baseVol")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id},[o,h]=this.handleMarketTypeAndParams("fetchOHLCV",a,r),d=this.getSupportedMapping(o,{spot:"publicSpotGetMarketCandles",swap:"publicMixGetMarketCandles"}),c=this.safeInteger2(h,"until","till");if(void 0===s&&(s=100),"spot"===a.type){const e=this.options.timeframes.spot;if(n.period=this.safeString(e,t,t),n.limit=s,void 0!==i&&(n.after=i,void 0===c)){const e=1e3*this.options.timeframes.swap[t];n.before=this.sum(i,e*s)}void 0!==c&&(n.before=c)}else if("swap"===a.type){const e=this.options.timeframes.swap;n.granularity=this.safeString(e,t,t);const r=this.parseTimeframe(t),a=this.milliseconds();void 0===i?(n.startTime=a-1e3*r*(s-1),n.endTime=a):(n.startTime=this.sum(i,1e3*r),n.endTime=void 0!==c?c:this.sum(i,s*r*1e3))}const l=this.omit(h,["until","till"]),u=await this[d](this.extend(n,l)),f=this.safeValue(u,"data",u);return this.parseOHLCVs(f,a,t,i,s)}async fetchBalance(e={}){await this.loadMarkets();const[t,i]=this.handleMarketTypeAndParams("fetchBalance",void 0,e),s=this.getSupportedMapping(t,{spot:"privateSpotGetAccountAssets",swap:"privateMixGetAccountAccounts"}),r={};if("swap"===t){const e=this.safeString(this.options,"defaultSubType");r.productType="linear"===e?"UMCBL":"DMCBL"}const a=await this[s](this.extend(r,i)),n=this.safeValue(a,"data");return this.parseBalance(n)}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString2(s,"coinName","marginCoin"),a=this.safeCurrencyCode(r),n=this.account(),o=this.safeString(s,"frozen"),h=this.safeString2(s,"lock","locked");n.used=_.stringAdd(o,h),n.free=this.safeString(s,"available"),t[a]=n}return this.safeBalance(t)}parseOrderStatus(e){return this.safeString({new:"open",init:"open",not_trigger:"open",triggered:"closed",full_fill:"closed",filled:"closed",fail_trigger:"canceled",cancel:"canceled",cancelled:"canceled",canceled:"canceled"},e,e)}parseOrder(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeString(e,"orderId"),a=this.safeString2(e,"price","executePrice"),n=this.safeString2(e,"quantity","size"),o=this.safeString2(e,"fillQuantity","filledQty"),h=this.safeString2(e,"fillTotalAmount","filledAmount"),d=this.safeString2(e,"fillPrice","priceAvg"),c=this.safeString(e,"orderType"),l=this.safeInteger(e,"cTime");let u=this.safeString2(e,"side","posSide");"open_long"===u||"close_short"===u?u="buy":"close_long"!==u&&"open_short"!==u||(u="sell");const f=this.safeString2(e,"clientOrderId","clientOid"),p=this.safeString2(e,"status","state"),m=this.parseOrderStatus(p),g=this.safeInteger(e,"uTime");return this.safeOrder({info:e,id:r,clientOrderId:f,timestamp:l,datetime:this.iso8601(l),lastTradeTimestamp:g,symbol:s,type:c,timeInForce:void 0,postOnly:void 0,side:u,price:a,stopPrice:this.safeNumber(e,"triggerPrice"),triggerPrice:this.safeNumber(e,"triggerPrice"),average:d,cost:h,amount:n,filled:o,remaining:void 0,status:m,fee:undefined,trades:void 0},t)}async createOrder(e,t,i,s,a,n={}){await this.loadMarkets();const o=this.market(e),[h,d]=this.handleMarketTypeAndParams("createOrder",o,n),c={symbol:o.id,orderType:t},l="market"===t,u=this.safeValue2(n,"stopPrice","triggerPrice"),f=void 0!==u,p=this.safeValue(n,"stopLossPrice"),m=void 0!==p,g=this.safeValue(n,"takeProfitPrice"),b=void 0!==g,v=m||b;if(this.sum(f,m,b)>1)throw new r(this.id+" createOrder() params can only contain one of triggerPrice, stopLossPrice, takeProfitPrice");"limit"===t&&void 0===u&&(c.price=this.priceToPrecision(e,a));const w=this.safeString2(n,"clientOid","clientOrderId");let S=this.getSupportedMapping(h,{spot:"privateSpotPostTradeOrders",swap:"privateMixPostOrderPlaceOrder"});const k=this.safeString2(n,"force","timeInForceValue"),T=this.isPostOnly(l,"post_only"===k,n);if("spot"===h){if(v)throw new y(this.id+" createOrder() does not support stop loss/take profit orders on spot markets, only swap markets");let t,r="force",o="quantity";if(this.safeValue(this.options,"createMarketBuyOrderRequiresPrice",!0)&&l&&"buy"===i){if(void 0===a)throw new y(this.id+" createOrder() requires price argument for market buy orders on spot markets to calculate the total amount to spend (amount * price), alternatively set the createMarketBuyOrderRequiresPrice option to false and pass in the cost to spend into the amount parameter");{const i=this.numberToString(s),r=this.numberToString(a),n=this.parseNumber(_.stringMul(i,r));t=this.priceToPrecision(e,n)}}else t=this.amountToPrecision(e,s);if(void 0!==w&&(c.clientOrderId=w),c.side=i,void 0!==u){o="size",r="timeInForceValue";const t=this.safeString(n,"triggerType","market_price");c.triggerType=t,c.triggerPrice=this.priceToPrecision(e,u),c.executePrice=this.priceToPrecision(e,a),S="privateSpotPostPlanPlacePlan"}void 0!==t&&(c[o]=t),c[r]=T?"post_only":"normal"}else{void 0!==w&&(c.clientOid=w),c.size=this.amountToPrecision(e,s),T&&(c.timeInForceValue="post_only");const t=this.safeValue(n,"reduceOnly",!1);if(void 0!==u){const t=this.safeString(n,"triggerType","market_price");c.triggerType=t,c.triggerPrice=this.priceToPrecision(e,u),void 0!==a&&(c.executePrice=this.priceToPrecision(e,a)),S="privateMixPostPlanPlacePlan"}if(v){if(!l)throw new r(this.id+" createOrder() bitget stopLoss or takeProfit orders must be market orders");m?(c.triggerPrice=this.priceToPrecision(e,p),c.planType="loss_plan"):b&&(c.triggerPrice=this.priceToPrecision(e,g),c.planType="profit_plan"),c.holdSide="buy"===i?"long":"short",S="privateMixPostPlanPlaceTPSL"}else c.side=t?"buy"===i?"close_short":"close_long":"buy"===i?"open_long":"open_short";c.marginCoin=o.settleId}const O=this.omit(d,["stopPrice","triggerType","stopLossPrice","takeProfitPrice","postOnly"]),M=await this[S](this.extend(c,O)),I=this.safeValue(M,"data");return this.parseOrder(I,o)}async editOrder(e,t,i,s,a,n,o={}){await this.loadMarkets();const h=this.market(t),[d,c]=this.handleMarketTypeAndParams("editOrder",h,o),l={orderId:e,orderType:i},u="market"===i,f=this.safeValue2(o,"stopPrice","triggerPrice"),p=void 0!==f,m=this.safeValue(o,"stopLossPrice"),g=void 0!==m,b=this.safeValue(o,"takeProfitPrice"),v=void 0!==b,w=g||v;if(this.sum(p,g,v)>1)throw new r(this.id+" editOrder() params can only contain one of triggerPrice, stopLossPrice, takeProfitPrice");if(!w&&!p)throw new y(this.id+" editOrder() only support plan orders");let S=this.getSupportedMapping(d,{spot:"privateSpotPostPlanModifyPlan",swap:"privateMixPostPlanModifyPlan"});if(void 0!==f){const e=this.safeString(o,"triggerType","market_price");l.triggerType=e,l.triggerPrice=this.priceToPrecision(t,f),l.executePrice=this.priceToPrecision(t,n)}if("spot"===d){if(w)throw new y(this.id+" editOrder() does not support stop orders on spot markets, only swap markets");if(this.safeValue(this.options,"editMarketBuyOrderRequiresPrice",!0)&&u&&"buy"===s){if(void 0===n)throw new y(this.id+" editOrder() requires price argument for market buy orders on spot markets to calculate the total amount to spend (amount * price), alternatively set the editMarketBuyOrderRequiresPrice option to false and pass in the cost to spend into the amount parameter");{const e=this.numberToString(a),i=this.numberToString(n),s=this.parseNumber(_.stringMul(e,i));l.size=this.priceToPrecision(t,s)}}else l.size=this.amountToPrecision(t,a)}else{if(l.symbol=h.id,l.size=this.amountToPrecision(t,a),w){if(!u)throw new r(this.id+" editOrder() bitget stopLoss or takeProfit orders must be market orders");g?(l.triggerPrice=this.priceToPrecision(t,m),l.planType="loss_plan"):v&&(l.triggerPrice=this.priceToPrecision(t,b),l.planType="profit_plan"),S="privateMixPostPlanModifyTPSLPlan"}l.marginCoin=h.settleId}const k=this.omit(c,["stopPrice","triggerType","stopLossPrice","takeProfitPrice"]),T=await this[S](this.extend(l,k)),O=this.safeValue(T,"data");return this.parseOrder(O,h)}async cancelOrder(e,t,i={}){this.checkRequiredSymbol("cancelOrder",t),await this.loadMarkets();const s=this.market(t),[r,a]=this.handleMarketTypeAndParams("cancelOrder",s,i);let n=this.getSupportedMapping(r,{spot:"privateSpotPostTradeCancelOrder",swap:"privateMixPostOrderCancelOrder"});const o={symbol:s.id,orderId:e};if(this.safeValue(a,"stop"))if("spot"===r)n="privateSpotPostPlanCancelPlan";else{const e=this.safeString(i,"planType");if(void 0===e)throw new h(this.id+" cancelOrder() requires a planType parameter for stop orders, either normal_plan, profit_plan or loss_plan");o.planType=e,n="privateMixPostPlanCancelPlan"}"swap"===r&&(o.marginCoin=s.settleId);const d=this.omit(a,["stop","planType"]),c=await this[n](this.extend(o,d));return this.parseOrder(c,s)}async cancelOrders(e,t,i={}){this.checkRequiredSymbol("cancelOrders",t),await this.loadMarkets();const s=this.market(t),r=this.safeString(i,"type",s.type);if(void 0===r)throw new h(this.id+" cancelOrders() requires a type parameter (one of 'spot', 'swap').");i=this.omit(i,"type");const a={};let n;if("spot"===r){n="apiPostOrderOrdersBatchcancel",a.method="batchcancel";const t=this.json(e).split('"');a.order_ids=t.join("")}else"swap"===r&&(n="privateMixPostOrderCancelBatchOrders",a.symbol=s.id,a.marginCoin=s.quote,a.orderIds=e);return await this[n](this.extend(a,i))}async cancelAllOrders(e,t={}){let i;await this.loadMarkets();let s=this.safeString(this.options,"defaultSubType");void 0!==e&&(i=this.market(e),s=i.linear?"linear":"inverse");const r="linear"===s?"UMCBL":"DMCBL",[a,o]=this.handleMarketTypeAndParams("cancelAllOrders",i,t);if("spot"===a)throw new n(this.id+" cancelAllOrders () does not support spot markets");const d={productType:r};let c;const l=this.safeValue(o,"stop"),u=this.safeString(o,"planType");if(void 0!==l||void 0!==u){if(void 0===u)throw new h(this.id+" cancelOrder() requires a planType parameter for stop orders, either normal_plan, profit_plan, loss_plan, pos_profit, pos_loss, moving_plan or track_plan");c="privateMixPostPlanCancelAllPlan"}else{const e=this.safeString2(t,"code","marginCoin");if(void 0===e)throw new h(this.id+" cancelAllOrders () requires a code argument [marginCoin] in the params");const i=this.currency(e);d.marginCoin=this.safeCurrencyCode(e,i),c="privateMixPostOrderCancelAllOrders"}const f=this.omit(o,["stop","code","marginCoin"]);return await this[c](this.extend(d,f))}async fetchOrder(e,t,i={}){this.checkRequiredSymbol("fetchOrder",t),await this.loadMarkets();const s=this.market(t),[r,a]=this.handleMarketTypeAndParams("fetchOrder",s,i),n=this.getSupportedMapping(r,{spot:"privateSpotPostTradeOrderInfo",swap:"privateMixGetOrderDetail"}),o={symbol:s.id,orderId:e},h=await this[n](this.extend(o,a)),d=this.safeValue(h,"data"),c=this.safeValue(d,0,d);return this.parseOrder(c,s)}async fetchOpenOrders(e,t,i,s={}){this.checkRequiredSymbol("fetchOpenOrders",e),await this.loadMarkets();const r=this.market(e);let a,n;[a,n]=this.handleMarketTypeAndParams("fetchOpenOrders",r,s);const o={symbol:r.id};let h=this.getSupportedMapping(a,{spot:"privateSpotPostTradeOpenOrders",swap:"privateMixGetOrderCurrent"});this.safeValue(n,"stop")&&("spot"===a?(h="privateSpotPostPlanCurrentPlan",void 0!==i&&(o.pageSize=i)):h="privateMixGetPlanCurrentPlan",n=this.omit(n,"stop"));const d=await this[h](this.extend(o,n));let c=this.safeValue(d,"data",[]);return Array.isArray(c)||(c=this.safeValue(c,"orderList",[])),this.parseOrders(c,r,t,i)}async fetchClosedOrders(e,t,i,s={}){await this.loadMarkets(),this.checkRequiredSymbol("fetchClosedOrders",e);const r=this.market(e),a=await this.fetchCanceledAndClosedOrders(e,t,i,s),n=[];for(let e=0;e<a.length;e++){const t=a[e];"closed"===this.parseOrderStatus(this.safeString2(t,"state","status"))&&n.push(t)}return this.parseOrders(n,r,t,i)}async fetchCanceledOrders(e,t,i,s={}){await this.loadMarkets(),this.checkRequiredSymbol("fetchCanceledOrders",e);const r=this.market(e),a=await this.fetchCanceledAndClosedOrders(e,t,i,s),n=[];for(let e=0;e<a.length;e++){const t=a[e];"canceled"===this.parseOrderStatus(this.safeString2(t,"state","status"))&&n.push(t)}return this.parseOrders(n,r,t,i)}async fetchCanceledAndClosedOrders(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);let a;[a,s]=this.handleMarketTypeAndParams("fetchCanceledAndClosedOrders",r,s);const n={symbol:r.id};let o=this.getSupportedMapping(a,{spot:"privateSpotPostTradeHistory",swap:"privateMixGetOrderHistory"});const h=this.safeValue(s,"stop");h&&(o="spot"===a?"privateSpotPostPlanHistoryPlan":"privateMixGetPlanHistoryPlan",s=this.omit(s,"stop")),("swap"===a||h)&&(void 0===i&&(i=100),n.pageSize=i,void 0===t&&(t=0),n.startTime=t,n.endTime=this.milliseconds());const d=await this[o](this.extend(n,s)),c=this.safeValue(d,"data");return this.safeValue(c,"orderList",c)}async fetchLedger(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.currency(e),a.coinId=r.id);const n=await this.privateSpotPostAccountBills(this.extend(a,s)),o=this.safeValue(n,"data");return this.parseLedger(o,r,t,i)}parseLedgerEntry(e,t){const i=this.safeString(e,"billId"),s=this.safeString(e,"coinId"),r=this.safeCurrencyCode(s),a=this.parseNumber(_.stringAbs(this.safeString(e,"quantity"))),n=this.safeInteger(e,"cTime"),o=this.safeString(e,"bizType");let h;if(void 0!==o&&o.indexOf("-")>=0){h=o.split("-")[1]}const d=this.safeString(e,"groupType"),c=this.safeNumber(e,"fees"),l=this.safeNumber(e,"balance");return{info:e,id:i,timestamp:n,datetime:this.iso8601(n),direction:h,account:void 0,referenceId:void 0,referenceAccount:void 0,type:d,currency:r,amount:a,before:void 0,after:l,status:void 0,fee:c}}async fetchMyTrades(e,t,i,s={}){this.checkRequiredSymbol("fetchMyTrades",e),await this.loadMarkets();const r=this.market(e);if(r.swap)throw new S(this.id+" fetchMyTrades() only supports spot markets");const a={symbol:r.id};void 0!==i&&(a.limit=i);const n=await this.privateSpotPostTradeFills(this.extend(a,s)),o=this.safeValue(n,"data");return this.parseTrades(o,r,t,i)}async fetchOrderTrades(e,t,i,s,r={}){this.checkRequiredSymbol("fetchOrderTrades",t),await this.loadMarkets();const a=this.market(t),[n,o]=this.handleMarketTypeAndParams("fetchOrderTrades",a,r),h=this.getSupportedMapping(n,{spot:"privateSpotPostTradeFills",swap:"privateMixGetOrderFills"}),d={symbol:a.id,orderId:e},c=await this[h](this.extend(d,o)),l=this.safeValue(c,"data");return await this.parseTrades(l,a,i,s)}async fetchPosition(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id,marginCoin:i.settleId},r=await this.privateMixGetPositionSinglePosition(this.extend(s,t)),a=this.safeValue(r,"data",[]);return this.parsePositions(a)}async fetchPositions(e,t={}){let i;if(await this.loadMarkets(),void 0!==e){const t=this.safeString(e,0);i=this.market(t)}const s=this.safeValue(this.options,"sandboxMode",!1);let r,a;[r,t]=this.handleSubTypeAndParams("fetchPositions",i,t),a="linear"===r?"UMCBL":"DMCBL",s&&(a="S"+a);const n={productType:a},o=await this.privateMixGetPositionAllPosition(this.extend(n,t)),h=this.safeValue(o,"data",[]),d=[];for(let e=0;e<h.length;e++)d.push(this.parsePosition(h[e]));return e=this.marketSymbols(e),this.filterByArray(d,"symbol",e,!1)}parsePosition(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeInteger(e,"cTime");let a,n,o=this.safeString(e,"marginMode");const h=this.safeString(e,"unrealizedPL"),d=this.safeString(e,"margin");"fixed"===o?(o="isolated",a=_.stringAdd(d,h)):"crossed"===o&&(o="cross",n=d);const c=this.safeString(e,"holdMode");let l;"double_hold"===c?l=!0:"single_hold"===c&&(l=!1);const u=this.safeString(e,"holdSide"),f=this.safeString(e,"leverage"),p=this.safeValue(t,"contractSize"),m=this.numberToString(p),g=this.safeString(e,"total"),y=this.safeString(e,"averageOpenPrice"),b=this.safeString(e,"keepMarginRate"),v=_.stringMul(y,g);void 0===n&&(n=_.stringDiv(v,f));const w=this.parseNumber(_.stringDiv(g,m)),S=this.safeString(e,"marketPrice"),k=_.stringMul(g,S),T=_.stringDiv(n,k);let O=this.parseNumber(this.omitZero(this.safeString(e,"liquidationPrice")));const M="0.9994";if(void 0===O&&"isolated"===o&&_.stringGt(g,"0")){let e=_.stringDiv(d,g),t=b;"short"===u&&(e=_.stringNeg(e),t=_.stringNeg(t));let i=_.stringSub("1",t),s=_.stringSub(y,e);"long"===u?i=_.stringMul(i,M):s=_.stringMul(s,M),O=_.stringDiv(s,i)}const I=_.stringMul(k,"0.0006"),x=_.stringAdd(_.stringMul(b,k),I),C=_.stringDiv(x,a),P=_.stringMul(_.stringDiv(h,n,4),"100");return{info:e,id:void 0,symbol:s,notional:this.parseNumber(k),marginMode:o,liquidationPrice:this.parseNumber(O),entryPrice:this.parseNumber(y),unrealizedPnl:this.parseNumber(h),percentage:this.parseNumber(P),contracts:w,contractSize:p,markPrice:this.parseNumber(S),side:u,hedged:l,timestamp:r,datetime:this.iso8601(r),maintenanceMargin:this.parseNumber(x),maintenanceMarginPercentage:this.parseNumber(b),collateral:this.parseNumber(a),initialMargin:this.parseNumber(n),initialMarginPercentage:this.parseNumber(T),leverage:this.parseNumber(f),marginRatio:this.parseNumber(C)}}async fetchFundingRateHistory(e,t,i,s={}){this.checkRequiredSymbol("fetchFundingRateHistory",e),await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.pageSize=i);const n=await this.publicMixGetMarketHistoryFundRate(this.extend(a,s)),o=this.safeValue(n,"data",[]),h=[];for(let e=0;e<o.length;e++){const t=o[e],i=this.safeString(t,"symbol"),s=this.safeSymbol(i,r),a=this.safeInteger(t,"settleTime");h.push({info:t,symbol:s,fundingRate:this.safeString(t,"fundingRate"),timestamp:a,datetime:this.iso8601(a)})}const d=this.sortBy(h,"timestamp");return this.filterBySymbolSinceLimit(d,r.symbol,t,i)}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.swap)throw new S(this.id+" fetchFundingRate() supports swap contracts only");const s={symbol:i.id},r=await this.publicMixGetMarketCurrentFundRate(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseFundingRate(a,i)}parseFundingRate(e,t){const i=this.safeString(e,"symbol");return{info:e,symbol:this.safeSymbol(i,t),markPrice:void 0,indexPrice:void 0,interestRate:void 0,estimatedSettlePrice:void 0,timestamp:void 0,datetime:void 0,fundingRate:this.safeNumber(e,"fundingRate"),fundingTimestamp:void 0,fundingDatetime:void 0,nextFundingRate:void 0,nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async fetchFundingHistory(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);if(!r.swap)throw new S(this.id+" fetchFundingHistory() supports swap contracts only");void 0===t&&(t=this.milliseconds()-31556952e3);const a={symbol:r.id,marginCoin:r.quoteId,startTime:t,endTime:this.milliseconds()};void 0!==i&&(a.pageSize=i);const n=await this.privateMixGetAccountAccountBill(this.extend(a,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"result",[]);return this.parseFundingHistories(h,r,t,i)}parseFundingHistory(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t,void 0,"swap"),r=this.safeString(e,"marginCoin"),a=this.safeCurrencyCode(r),n=this.safeNumber(e,"amount"),o=this.safeInteger(e,"cTime"),h=this.safeString(e,"id");return{info:e,symbol:s,timestamp:o,datetime:this.iso8601(o),code:a,amount:n,id:h}}parseFundingHistories(e,t,i,s){const r=[];for(let i=0;i<e.length;i++){const s=e[i];"contract_settle_fee"===this.safeString(s,"business")&&r.push(this.parseFundingHistory(s,t))}const a=this.sortBy(r,"timestamp");return this.filterBySinceLimit(a,i,s)}async modifyMarginHelper(e,t,i,s={}){await this.loadMarkets();const r=this.safeString(s,"holdSide"),a=this.market(e),n=a.linear?a.quote:a.base,o={symbol:a.id,marginCoin:n,amount:this.amountToPrecision(e,t),holdSide:r};s=this.omit(s,"holdSide");const h=await this.privateMixPostAccountSetMargin(this.extend(o,s));return this.extend(this.parseMarginModification(h,a),{amount:this.parseNumber(t),type:i})}parseMarginModification(e,t){const i="00000"===this.safeString(e,"code")?"ok":"failed";return{info:e,type:void 0,amount:void 0,code:t.linear?t.quote:t.base,symbol:t.symbol,status:i}}async reduceMargin(e,t,i={}){if(t>0)throw new d(this.id+" reduceMargin() amount parameter must be a negative value");if(void 0===this.safeString(i,"holdSide"))throw new h(this.id+" reduceMargin() requires a holdSide parameter, either long or short");return await this.modifyMarginHelper(e,t,"reduce",i)}async addMargin(e,t,i={}){if(void 0===this.safeString(i,"holdSide"))throw new h(this.id+" addMargin() requires a holdSide parameter, either long or short");return await this.modifyMarginHelper(e,t,"add",i)}async fetchLeverage(e,t={}){await this.loadMarkets();const i={symbol:this.market(e).id};return await this.publicMixGetMarketSymbolLeverage(this.extend(i,t))}async setLeverage(e,t,i={}){this.checkRequiredSymbol("setLeverage",t),await this.loadMarkets();const s=this.market(t),r={symbol:s.id,marginCoin:s.settleId,leverage:e};return await this.privateMixPostAccountSetLeverage(this.extend(r,i))}async setMarginMode(e,t,i={}){if(this.checkRequiredSymbol("setMarginMode",t),"fixed"!==(e=e.toLowerCase())&&"crossed"!==e)throw new h(this.id+' setMarginMode() marginMode must be "fixed" or "crossed"');await this.loadMarkets();const s=this.market(t),r={symbol:s.id,marginCoin:s.settleId,marginMode:e};return await this.privateMixPostAccountSetMarginMode(this.extend(r,i))}async setPositionMode(e,t,i={}){if(void 0===this.safeString(i,"productType")&&void 0===t)throw new h(this.id+" setPositionMode() requires a symbol or the productType parameter");await this.loadMarkets();const s={holdMode:e?"double_hold":"single_hold"};if(void 0!==t){const e=this.market(t);s.productType=e.linear?"umcbl":"dmcbl"}return await this.privateMixPostAccountSetPositionMode(this.extend(s,i))}async fetchOpenInterest(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.contract)throw new d(this.id+" fetchOpenInterest() supports contract markets only");const s={symbol:i.id},r=await this.publicMixGetMarketOpenInterest(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseOpenInterest(a,i)}async fetchTransfers(e,t,i,s={}){let r;await this.loadMarkets(),[r,s]=this.handleMarketTypeAndParams("fetchTransfers",void 0,s);const a=this.safeString(s,"fromAccount",r);s=this.omit(s,"fromAccount");const n=this.safeValue(this.options,"accountsByType",{});r=this.safeString(n,a);const o={fromType:r};let h;void 0!==e&&(h=this.currency(e),o.coinId=h.id),void 0!==t&&(o.before=t),void 0!==i&&(o.limit=i);const d=await this.privateSpotGetAccountTransferRecords(this.extend(o,s)),c=this.safeValue(d,"data",[]);return this.parseTransfers(c,h,t,i)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n="swap"===i,o="swap"===s,h="USDT"===a.code;n?i=h?"mix_usdt":"mix_usd":o&&(s=h?"mix_usdt":"mix_usd");const d={fromType:i,toType:s,amount:t,coin:a.info.coinName},c=await this.privateSpotPostWalletTransfer(this.extend(d,r));return this.parseTransfer(c,a)}parseTransfer(e,t){let i=this.safeInteger2(e,"requestTime","tradeTime");void 0===i&&(i=this.safeTimestamp(e,"cTime"));const s=this.safeStringLowerN(e,["msg","status"]);let r=this.safeString2(e,"code","coinName");"00000"===r&&(r=void 0);const a=this.safeString(e,"fromType"),n=this.safeValue(this.options,"accountsById",{}),o=this.safeString(n,a,a),h=this.safeString(e,"toType"),d=this.safeString(n,h,h);return{info:e,id:this.safeString2(e,"id","billId"),timestamp:i,datetime:this.iso8601(i),currency:this.safeCurrencyCode(r),amount:this.safeNumberN(e,["size","quantity","amount"]),fromAccount:o,toAccount:d,status:this.parseTransferStatus(s)}}parseTransferStatus(e){return this.safeString({success:"ok",successful:"ok"},e,e)}parseOpenInterest(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeString(e,"symbol");return{symbol:this.safeSymbol(s,t),openInterestAmount:this.safeNumber(e,"amount"),openInterestValue:void 0,timestamp:i,datetime:this.iso8601(i),info:e}}handleErrors(e,t,i,s,a,n,o,h,d){if(!o)return;const c=this.safeString(o,"err_msg"),l=this.safeString2(o,"code","err_code"),u=this.id+" "+n,f=void 0!==c&&""!==c;f&&(this.throwExactlyMatchedException(this.exceptions.exact,c,u),this.throwBroadlyMatchedException(this.exceptions.broad,c,u));const p=void 0!==l&&"00000"!==l;if(p&&this.throwExactlyMatchedException(this.exceptions.exact,l,u),p||f)throw new r(u)}sign(e,t=[],i="GET",s={},r,a){const n="private"===t[0],o=t[1],h=("spot"===o?"/api/spot/v1":"/api/mix/v1")+("/"+this.implodeParams(e,s));let d=this.implodeHostname(this.urls.api[o])+h;const c=this.omit(s,this.extractParams(e));if(!n&&"GET"===i){Object.keys(c).length>0&&(d=d+"?"+this.urlencode(c))}if(n){this.checkRequiredCredentials();const e=this.milliseconds().toString();let t=e+i+h;if("POST"===i)t+=a=this.json(s);else if(Object.keys(s).length){const e="?"+this.urlencode(this.keysort(s));d+=e,t+=e}const n=this.hmac(this.encode(t),this.encode(this.secret),"sha256","base64"),o=this.safeString(this.options,"broker");r={"ACCESS-KEY":this.apiKey,"ACCESS-SIGN":n,"ACCESS-TIMESTAMP":e,"ACCESS-PASSPHRASE":this.password,"X-CHANNEL-API-CODE":o},"POST"===i&&(r["Content-Type"]="application/json")}return{url:d,method:i,body:a,headers:r}}}},29202:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ExchangeNotAvailable:a,AuthenticationError:n,BadRequest:o,PermissionDenied:h,InvalidAddress:d,ArgumentsRequired:c,InvalidOrder:l}=i(73449),{DECIMAL_PLACES:u,SIGNIFICANT_DIGITS:f,TRUNCATE:p}=i(62115),m=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bithumb",name:"Bithumb",countries:["KR"],rateLimit:500,has:{CORS:!0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createMarketOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPosition:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTransfer:!1,fetchTransfers:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!0},hostname:"bithumb.com",urls:{logo:"https://user-images.githubusercontent.com/1294454/30597177-ea800172-9d5e-11e7-804c-b9d4fa9b56b0.jpg",api:{public:"https://api.{hostname}/public",private:"https://api.{hostname}"},www:"https://www.bithumb.com",doc:"https://apidocs.bithumb.com",fees:"https://en.bithumb.com/customer_support/info_fee"},api:{public:{get:["ticker/{currency}","ticker/all","ticker/ALL_BTC","ticker/ALL_KRW","orderbook/{currency}","orderbook/all","transaction_history/{currency}","transaction_history/all","candlestick/{currency}/{interval}"]},private:{post:["info/account","info/balance","info/wallet_address","info/ticker","info/orders","info/user_transactions","info/order_detail","trade/place","trade/cancel","trade/btc_withdrawal","trade/krw_deposit","trade/krw_withdrawal","trade/market_buy","trade/market_sell"]}},fees:{trading:{maker:this.parseNumber("0.0025"),taker:this.parseNumber("0.0025")}},precisionMode:f,exceptions:{"Bad Request(SSL)":o,"Bad Request(Bad Method)":o,"Bad Request.(Auth Data)":n,"Not Member":n,"Invalid Apikey":n,"Method Not Allowed.(Access IP)":h,"Method Not Allowed.(BTC Adress)":d,"Method Not Allowed.(Access)":h,"Database Fail":a,"Invalid Parameter":o,5600:r,"Unknown Error":r,"After May 23th, recent_transactions is no longer, hence users will not be able to connect to recent_transactions":r},timeframes:{"1m":"1m","3m":"3m","5m":"5m","10m":"10m","30m":"30m","1h":"1h","6h":"6h","12h":"12h","1d":"24h"},options:{quoteCurrencies:{BTC:{limits:{cost:{min:2e-4,max:100}}},KRW:{limits:{cost:{min:500,max:5e9}}}}},commonCurrencies:{FTC:"FTC2",SOC:"Soda Coin"}})}safeMarket(e,t,i,s){return super.safeMarket(e,t,i,"spot")}amountToPrecision(e,t){return this.decimalToPrecision(t,p,this.markets[e].precision.amount,u)}async fetchMarkets(e={}){const t=[],i=this.safeValue(this.options,"quoteCurrencies",{}),s=Object.keys(i);for(let r=0;r<s.length;r++){const a=s[r],n=a,o=this.safeValue(i,a,{}),h="publicGetTickerALL"+a,d=await this[h](e),c=this.safeValue(d,"data"),l=Object.keys(c);for(let e=0;e<l.length;e++){const i=l[e];if("date"===i)continue;const s=c[i],r=this.safeCurrencyCode(i);let h=!0;if(Array.isArray(s)){0===s.length&&(h=!1)}const d=this.deepExtend({id:i,symbol:r+"/"+a,base:r,quote:a,settle:void 0,baseId:i,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:h,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDateTime:void 0,strike:void 0,optionType:void 0,precision:{amount:parseInt("4"),price:parseInt("4")},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{}},info:s},o);t.push(d)}}return t}parseBalance(e){const t={info:e},i=this.safeValue(e,"data"),s=Object.keys(this.currencies);for(let e=0;e<s.length;e++){const r=s[e],a=this.account(),n=this.currency(r),o=this.safeStringLower(n,"id");a.total=this.safeString(i,"total_"+o),a.used=this.safeString(i,"in_use_"+o),a.free=this.safeString(i,"available_"+o),t[r]=a}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostInfoBalance(this.extend({currency:"ALL"},e));return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={currency:s.base+"_"+s.quote};void 0!==t&&(r.count=t);const a=await this.publicGetOrderbookCurrency(this.extend(r,i)),n=this.safeValue(a,"data",{}),o=this.safeInteger(n,"timestamp");return this.parseOrderBook(n,e,o,"bids","asks","price","quantity")}parseTicker(e,t){const i=this.safeInteger(e,"date"),s=this.safeSymbol(void 0,t),r=this.safeString(e,"opening_price"),a=this.safeString(e,"closing_price"),n=this.safeString(e,"units_traded_24H"),o=this.safeString(e,"acc_trade_value_24H");return this.safeTicker({symbol:s,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"max_price"),low:this.safeString(e,"min_price"),bid:this.safeString(e,"buy_price"),bidVolume:void 0,ask:this.safeString(e,"sell_price"),askVolume:void 0,vwap:void 0,open:r,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:n,quoteVolume:o,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetTickerAll(t),s={},r=this.safeValue(i,"data",{}),a=this.safeInteger(r,"date"),n=this.omit(r,"date"),o=Object.keys(n);for(let e=0;e<o.length;e++){const t=o[e],i=this.safeMarket(t),r=i.symbol,h=n[t];Array.isArray(h)||(h.date=a,s[r]=this.parseTicker(h,i))}return this.filterByArray(s,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={currency:i.base},r=await this.publicGetTickerCurrency(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseTicker(a,i)}parseOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,2),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={currency:a.base,interval:this.safeString(this.timeframes,t,t)},o=await this.publicGetCandlestickCurrencyInterval(this.extend(n,r)),h=this.safeValue(o,"data",[]);return this.parseOHLCVs(h,a,t,i,s)}parseTrade(e,t){let i;const s=this.safeString(e,"transaction_date");if(void 0!==s){const t=s.split(" ");if(t.length>1){const e=t[0];let s=t[1];s.length<8&&(s="0"+s),i=this.parse8601(e+" "+s)}else i=this.safeIntegerProduct(e,"transaction_date",.001)}void 0!==i&&(i-=324e5);let r=this.safeString(e,"type");r="ask"===r?"sell":"buy";const a=this.safeString(e,"cont_no");t=this.safeMarket(void 0,t);const n=this.safeString(e,"price"),o=this.fixCommaNumber(this.safeString2(e,"units_traded","units")),h=this.safeString(e,"total");let d;const c=this.safeString(e,"fee");if(void 0!==c){const t=this.safeString(e,"fee_currency");d={cost:c,currency:this.commonCurrencyCode(t)}}return this.safeTrade({id:a,info:e,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,order:void 0,type:undefined,side:r,takerOrMaker:void 0,price:n,amount:o,cost:h,fee:d},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={currency:r.base};void 0!==i&&(a.count=i);const n=await this.publicGetTransactionHistoryCurrency(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={order_currency:n.id,payment_currency:n.quote,units:s};let h="privatePostTradePlace";"limit"===t?(o.price=r,o.type="buy"===i?"bid":"ask"):h="privatePostTradeMarket"+this.capitalize(i);const d=await this[h](this.extend(o,a)),c=this.safeString(d,"order_id");if(void 0===c)throw new l(this.id+" createOrder() did not return an order id");return{info:d,symbol:e,type:t,side:i,id:c}}async fetchOrder(e,t,i={}){if(void 0===t)throw new c(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={order_id:e,count:1,order_currency:s.base,payment_currency:s.quote},a=await this.privatePostInfoOrderDetail(this.extend(r,i)),n=this.safeValue(a,"data");return this.parseOrder(this.extend(n,{order_id:e}),s)}parseOrderStatus(e){return this.safeString({Pending:"open",Completed:"closed",Cancel:"canceled"},e,e)}parseOrder(e,t){const i=this.safeIntegerProduct(e,"order_date",.001),s="bid"===this.safeValue2(e,"type","side")?"buy":"sell",r=this.parseOrderStatus(this.safeString(e,"order_status")),a=this.safeString2(e,"order_price","price");let n="limit";m.stringEquals(a,"0")&&(n="market");const o=this.fixCommaNumber(this.safeString2(e,"order_qty","units"));let h,d=this.fixCommaNumber(this.safeString(e,"units_remaining"));void 0===d&&("closed"===r?d="0":"canceled"!==r&&(d=o));const c=this.safeString(e,"order_currency"),l=this.safeString(e,"payment_currency"),u=this.safeCurrencyCode(c),f=this.safeCurrencyCode(l);void 0!==u&&void 0!==f&&(h=u+"/"+f),void 0===h&&(h=(t=this.safeMarket(void 0,t)).symbol);const p=this.safeString(e,"order_id"),g=this.safeValue(e,"contract",[]);return this.safeOrder({info:e,id:p,clientOrderId:void 0,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:void 0,symbol:h,type:n,timeInForce:void 0,postOnly:void 0,side:s,price:a,stopPrice:void 0,triggerPrice:void 0,amount:o,cost:void 0,average:void 0,filled:void 0,remaining:d,status:r,fee:void 0,trades:g},t)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new c(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e);void 0===i&&(i=100);const a={count:i,order_currency:r.base,payment_currency:r.quote};void 0!==t&&(a.after=t);const n=await this.privatePostInfoOrders(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseOrders(o,r,t,i)}async cancelOrder(e,t,i={}){if(!("side"in i))throw new c(this.id+" cancelOrder() requires a `side` parameter (sell or buy)");if(void 0===t)throw new c(this.id+" cancelOrder() requires a `symbol` argument");const s=this.market(t),r="buy"===i.side?"bid":"ask";i=this.omit(i,["side","currency"]);const a={order_id:e,type:r,order_currency:s.base,payment_currency:s.quote};return await this.privatePostTradeCancel(this.extend(a,i))}cancelUnifiedOrder(e,t={}){const i={side:e.side};return this.cancelOrder(e.id,e.symbol,this.extend(i,t))}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={units:t,address:i,currency:a.id};if("XRP"===a||"XMR"===a||"EOS"===a||"STEEM"===a){const t=this.safeString(r,"destination");if(void 0===s&&void 0===t)throw new c(this.id+" "+e+" withdraw() requires a tag argument or an extra destination param");void 0!==s&&(n.destination=s)}const o=await this.privatePostTradeBtcWithdrawal(this.extend(n,r));return this.parseTransaction(o,a)}parseTransaction(e,t){return{id:void 0,txid:void 0,timestamp:void 0,datetime:void 0,network:void 0,addressFrom:void 0,address:void 0,addressTo:void 0,amount:void 0,type:void 0,currency:(t=this.safeCurrency(void 0,t)).code,status:void 0,updated:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,comment:void 0,fee:void 0,info:e}}fixCommaNumber(e){if(void 0===e)return;let t=e;for(;t.indexOf(",")>-1;)t=t.replace(",","");return t}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){const n="/"+this.implodeParams(e,s);let o=this.implodeHostname(this.urls.api[t])+n;const h=this.omit(s,this.extractParams(e));if("public"===t)Object.keys(h).length&&(o+="?"+this.urlencode(h));else{this.checkRequiredCredentials(),a=this.urlencode(this.extend({endpoint:n},h));const e=this.nonce().toString(),t=n+"\0"+a+"\0"+e,i=this.hmac(this.encode(t),this.encode(this.secret),"sha512"),s=this.decode(this.stringToBase64(i));r={Accept:"application/json","Content-Type":"application/x-www-form-urlencoded","Api-Key":this.apiKey,"Api-Sign":s,"Api-Nonce":e}}return{url:o,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0!==o&&"status"in o){const e=this.safeString(o,"status"),t=this.safeString(o,"message");if(void 0!==e){if("0000"===e)return;if("거래 진행중인 내역이 존재하지 않습니다"===t)return;const i=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions,e,i),this.throwExactlyMatchedException(this.exceptions,t,i),new r(i)}}}}},69102:function(e,t,i){"use strict";const s=i(48819),{AuthenticationError:r,ExchangeNotAvailable:a,AccountSuspended:n,PermissionDenied:o,RateLimitExceeded:h,InvalidNonce:d,InvalidAddress:c,ArgumentsRequired:l,ExchangeError:u,InvalidOrder:f,InsufficientFunds:p,BadRequest:m,OrderNotFound:g,BadSymbol:y,NotSupported:b}=i(73449),{TICK_SIZE:v,TRUNCATE:w}=i(62115),S=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitmart",name:"BitMart",countries:["US","CN","HK","KR"],rateLimit:33.34,version:"v2",certified:!0,pro:!0,has:{CORS:void 0,spot:!0,margin:!0,swap:void 0,future:!1,option:void 0,borrowMargin:!0,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:!1,createOrder:!0,createPostOnlyOrder:!0,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowInterest:!0,fetchBorrowRate:!0,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!0,fetchCanceledOrders:!0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposit:!0,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDepositAddressesByNetwork:!1,fetchDeposits:!0,fetchDepositWithdrawFee:!0,fetchDepositWithdrawFees:!1,fetchFundingHistory:void 0,fetchMarginMode:!1,fetchMarkets:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchOrderTrades:!0,fetchPositionMode:!1,fetchStatus:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!1,fetchTransactionFee:!0,fetchTransactionFees:!1,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawAddressesByNetwork:!1,fetchWithdrawal:!0,fetchWithdrawals:!0,reduceMargin:!1,repayMargin:!0,setLeverage:!1,setMarginMode:!1,transfer:!0,withdraw:!0},hostname:"bitmart.com",urls:{logo:"https://user-images.githubusercontent.com/1294454/129991357-8f47464b-d0f4-41d6-8a82-34122f0d1398.jpg",api:{rest:"https://api-cloud.{hostname}"},www:"https://www.bitmart.com/",doc:"https://developer-pro.bitmart.com/",referral:{url:"http://www.bitmart.com/?r=rQCFLh",discount:.3},fees:"https://www.bitmart.com/fee/en"},requiredCredentials:{apiKey:!0,secret:!0,uid:!0},api:{public:{get:{"system/time":3,"system/service":3,"spot/v1/currencies":7.5,"spot/v1/symbols":7.5,"spot/v1/symbols/details":5,"spot/v1/ticker":5,"spot/v2/ticker":5,"spot/v1/steps":30,"spot/v1/symbols/kline":5,"spot/v1/symbols/book":5,"spot/v1/symbols/trades":5,"contract/v1/tickers":15,"contract/public/details":5,"contract/public/depth":5,"contract/public/open-interest":30,"contract/public/funding-rate":30,"contract/public/kline":5}},private:{get:{"account/sub-account/v1/transfer-list":7.5,"account/sub-account/v1/transfer-history":7.5,"account/sub-account/main/v1/wallet":5,"account/sub-account/main/v1/subaccount-list":7.5,"account/v1/wallet":5,"account/v1/currencies":30,"spot/v1/wallet":5,"account/v1/deposit/address":30,"account/v1/withdraw/charge":32,"account/v2/deposit-withdraw/history":7.5,"account/v1/deposit-withdraw/detail":7.5,"spot/v1/order_detail":1,"spot/v2/orders":5,"spot/v1/trades":5,"spot/v2/trades":5,"spot/v3/orders":5,"spot/v2/order_detail":1,"spot/v1/margin/isolated/borrow_record":1,"spot/v1/margin/isolated/repay_record":1,"spot/v1/margin/isolated/pairs":1,"spot/v1/margin/isolated/account":6,"spot/v1/trade_fee":6,"spot/v1/user_fee":6,"contract/private/assets-detail":5,"contract/private/order":2,"contract/private/order-history":10,"contract/private/position":10},post:{"account/sub-account/main/v1/sub-to-main":30,"account/sub-account/sub/v1/sub-to-main":30,"account/sub-account/main/v1/main-to-sub":30,"account/sub-account/sub/v1/sub-to-sub":30,"account/sub-account/main/v1/sub-to-sub":30,"account/v1/withdraw/apply":7.5,"spot/v1/submit_order":1,"spot/v1/batch_orders":1,"spot/v2/cancel_order":1,"spot/v1/cancel_orders":15,"spot/v3/cancel_order":1,"spot/v2/batch_orders":1,"spot/v2/submit_order":1,"spot/v1/margin/submit_order":1,"spot/v1/margin/isolated/borrow":6,"spot/v1/margin/isolated/repay":6,"spot/v1/margin/isolated/transfer":6,"contract/private/trades":10}}},timeframes:{"1m":1,"3m":3,"5m":5,"15m":15,"30m":30,"45m":45,"1h":60,"2h":120,"3h":180,"4h":240,"1d":1440,"1w":10080,"1M":43200},fees:{trading:{tierBased:!0,percentage:!0,taker:this.parseNumber("0.0025"),maker:this.parseNumber("0.0025"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.0020")],[this.parseNumber("10"),this.parseNumber("0.18")],[this.parseNumber("50"),this.parseNumber("0.0016")],[this.parseNumber("250"),this.parseNumber("0.0014")],[this.parseNumber("1000"),this.parseNumber("0.0012")],[this.parseNumber("5000"),this.parseNumber("0.0010")],[this.parseNumber("25000"),this.parseNumber("0.0008")],[this.parseNumber("50000"),this.parseNumber("0.0006")]],maker:[[this.parseNumber("0"),this.parseNumber("0.001")],[this.parseNumber("10"),this.parseNumber("0.0009")],[this.parseNumber("50"),this.parseNumber("0.0008")],[this.parseNumber("250"),this.parseNumber("0.0007")],[this.parseNumber("1000"),this.parseNumber("0.0006")],[this.parseNumber("5000"),this.parseNumber("0.0005")],[this.parseNumber("25000"),this.parseNumber("0.0004")],[this.parseNumber("50000"),this.parseNumber("0.0003")]]}}},precisionMode:v,exceptions:{exact:{3e4:u,30001:r,30002:r,30003:n,30004:r,30005:r,30006:r,30007:r,30008:r,30010:o,30011:r,30012:r,30013:h,30014:a,6e4:m,60001:m,60002:m,60003:u,60004:u,60005:u,60006:u,60007:c,60008:p,60009:u,60010:u,60011:c,60012:u,60020:o,60021:o,60022:o,60030:m,60031:m,60050:u,60051:u,61001:p,61003:m,5e4:m,50001:y,50002:m,50003:m,50004:m,50005:g,50006:f,50007:f,50008:f,50009:f,50010:f,50011:f,50012:f,50013:f,50014:m,50015:m,50016:m,50017:m,50018:m,50019:m,51004:p,50020:p,50021:m,50022:a,50023:y,50029:f,50030:f,50032:g,50035:f,50034:f,51011:f,53e3:n,53001:n,57001:m,58001:m,59001:u,59002:u,40001:u,40002:u,40003:u,40004:u,40005:u,40006:o,40007:m,40008:d,40009:m,40010:m,40011:m,40012:u,40013:u,40014:y,40015:y,40016:f,40017:f,40018:f,40019:u,40020:f,40021:u,40022:u,40023:u,40024:u,40025:u,40026:u,40027:p,40028:o,40029:f,40030:f,40031:f,40032:f,40033:f,40034:y,53002:o},broad:{}},commonCurrencies:{$GM:"GOLDMINER",$HERO:"Step Hero",$PAC:"PAC",BP:"BEYOND",GDT:"Gorilla Diamond",GLD:"Goldario",MVP:"MVP Coin",TRU:"Truebit"},options:{networks:{TRX:"TRC20",ETH:"ERC20"},defaultNetworks:{USDT:"ERC20"},defaultType:"spot",fetchBalance:{type:"spot"},accountsByType:{spot:"spot"},createMarketBuyOrderRequiresPrice:!0}})}async fetchTime(e={}){const t=await this.publicGetSystemTime(e),i=this.safeValue(t,"data",{});return this.safeInteger(i,"server_time")}async fetchStatus(e={}){const t=this.safeValue(this.options,"fetchStatus",{}),i=this.safeString(this.options,"defaultType");let s=this.safeString(t,"type",i);s=this.safeString(e,"type",s),e=this.omit(e,"type");const r=await this.publicGetSystemService(e),a=this.safeValue(r,"data",{}),n=this.safeValue(a,"service",[]),o=this.indexBy(n,"service_type");"swap"===s&&(s="contract");const h=this.safeValue(o,s);let d,c;if(void 0!==h){2===this.safeInteger(h,"status")?d="ok":(d="maintenance",c=this.safeInteger(h,"end_time"))}return{status:d,updated:void 0,eta:c,url:void 0,info:r}}async fetchSpotMarkets(e={}){const t=await this.publicGetSpotV1SymbolsDetails(e),i=this.safeValue(t,"data",{}),s=this.safeValue(i,"symbols",[]),r=[];for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"symbol"),a=this.safeInteger(t,"symbol_id"),n=this.safeString(t,"base_currency"),o=this.safeString(t,"quote_currency"),h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o),c=h+"/"+d,l=this.safeString(t,"min_buy_amount"),u=this.safeString(t,"min_sell_amount"),f=S.stringMax(l,u),p=this.safeNumber(t,"base_min_size");r.push({id:i,numericId:a,symbol:c,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:!0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:p,price:this.parseNumber(this.parsePrecision(this.safeString(t,"price_max_precision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:p,max:this.safeNumber(t,"base_max_size")},price:{min:void 0,max:void 0},cost:{min:this.parseNumber(f),max:void 0}},info:t})}return r}async fetchContractMarkets(e={}){const t=await this.publicGetContractV1Tickers(e),i=this.safeValue(t,"data",{}),s=this.safeValue(i,"tickers",[]),r=[];for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"contract_symbol"),a=i.slice(0,-4),n=i.slice(-4),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d="USDT",c=o+"/"+h+":"+d;r.push({id:i,numericId:void 0,symbol:c,base:o,quote:h,settle:d,baseId:a,quoteId:n,settleId:void 0,type:"swap",spot:!1,margin:!1,swap:!0,future:!1,option:!1,active:!0,contract:!0,linear:!0,inverse:!1,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:void 0,price:void 0},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return r}async fetchMarkets(e={}){const t=await this.fetchSpotMarkets(e),i=await this.fetchContractMarkets(e);return this.arrayConcat(t,i)}async fetchCurrencies(e={}){const t=await this.publicGetSpotV1Currencies(e),i=this.safeValue(t,"data",{}),s=this.safeValue(i,"currencies",[]),r={};for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"id"),a=this.safeCurrencyCode(i),n=this.safeString(t,"name"),o=this.safeValue(t,"withdraw_enabled"),h=this.safeValue(t,"deposit_enabled"),d=o&&h;r[a]={id:i,code:a,name:n,info:t,active:d,deposit:h,withdraw:o,fee:void 0,precision:void 0,limits:{amount:{min:void 0,max:void 0},withdraw:{min:void 0,max:void 0}}}}return r}async fetchTransactionFee(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=await this.privateGetAccountV1WithdrawCharge(this.extend(i,t)),r=s.data,a={};return a[e]=this.safeNumber(r,"withdraw_fee"),{info:s,withdraw:a,deposit:{}}}parseDepositWithdrawFee(e,t){return{info:e,withdraw:{fee:this.safeNumber(e,"withdraw_fee"),percentage:void 0},deposit:{fee:void 0,percentage:void 0},networks:{}}}async fetchDepositWithdrawFee(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=(await this.privateGetAccountV1WithdrawCharge(this.extend(i,t))).data;return this.parseDepositWithdrawFee(s)}parseTicker(e,t){const i=this.safeInteger(e,"timestamp",this.milliseconds()),s=this.safeString2(e,"symbol","contract_symbol"),r=(t=this.safeMarket(s,t)).symbol,a=this.safeString2(e,"close_24h","last_price");let n=this.safeString(e,"price_change_percent_24h");if(void 0===n){const t=this.safeString(e,"fluctuation");if(void 0!==t&&"0"!==t){const e=t[0];n=e+S.stringMul(t.replace(e,""),"100")}else"0"===t&&(n="0")}const o=this.safeString(e,"base_volume_24h");let h=this.safeString(e,"quote_volume_24h");h=this.safeString(e,"volume_24h",h);const d=this.safeString2(e,"avg_price","index_price"),c=this.safeString2(e,"high_24h","high_price"),l=this.safeString2(e,"low_24h","low_price");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:c,low:l,bid:this.safeString(e,"best_bid"),bidVolume:this.safeString(e,"best_bid_size"),ask:this.safeString(e,"best_ask"),askVolume:this.safeString(e,"best_ask_size"),vwap:void 0,open:this.safeString(e,"open_24h"),close:a,last:a,previousClose:void 0,change:void 0,percentage:n,average:d,baseVolume:o,quoteVolume:h,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={};let r;i.swap?(r="publicGetContractV1Tickers",s.contract_symbol=i.id):i.spot&&(r="publicGetSpotV1Ticker",s.symbol=i.id);const a=await this[r](this.extend(s,t)),n=this.safeValue(a,"data",{}),o=this.safeValue(n,"tickers",[]);let h;i.spot?h=this.indexBy(o,"symbol"):i.swap&&(h=this.indexBy(o,"contract_symbol"));const d=this.safeValue(h,i.id);return this.parseTicker(d,i)}async fetchTickers(e,t={}){let i,s;if(await this.loadMarkets(),void 0!==(e=this.marketSymbols(e))){const t=this.safeValue(e,0);s=this.market(t)}[i,t]=this.handleMarketTypeAndParams("fetchTickers",s,t);const r=this.getSupportedMapping(i,{spot:"publicGetSpotV2Ticker",swap:"publicGetContractV1Tickers"}),a=await this[r](t),n=this.safeValue(a,"data",{}),o=this.safeValue(n,"tickers",[]),h={};for(let e=0;e<o.length;e++){const t=this.parseTicker(o[e]);h[t.symbol]=t}return this.filterByArray(h,"symbol",e)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);if(!s.spot)throw new b(this.id+" fetchOrderBook() does not support "+s.type+" markets, only spot markets are accepted");const r={symbol:s.id};void 0!==t&&(r.size=t);const a=await this.publicGetSpotV1SymbolsBook(this.extend(r,i)),n=this.safeValue(a,"data",{}),o=this.safeInteger(n,"timestamp");return this.parseOrderBook(n,e,o,"buys","sells","price","amount")}parseTrade(e,t){const i=this.safeString(e,"detail_id"),s=this.safeInteger2(e,"order_time","create_time"),r=this.safeStringLower2(e,"type","side");let a;const n=this.safeString(e,"exec_type");void 0!==n&&(a="M"===n?"maker":"taker");let o=this.safeString(e,"price");o=this.safeString(e,"price_avg",o);let h=this.safeString(e,"count");h=this.safeString(e,"size",h);const d=this.safeString2(e,"amount","notional"),c=this.safeString(e,"order_id"),l=this.safeString(e,"symbol");t=this.safeMarket(l,t,"_");const u=this.safeString(e,"fees");let f;if(void 0!==u){const i=this.safeString(e,"fee_coin_name");let s=this.safeCurrencyCode(i);void 0===s&&(s="buy"===r?t.base:t.quote),f={cost:u,currency:s}}return this.safeTrade({info:e,id:i,order:c,timestamp:s,datetime:this.iso8601(s),symbol:t.symbol,type:undefined,side:r,price:o,amount:h,cost:d,takerOrMaker:a,fee:f},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);if(!r.spot)throw new b(this.id+" fetchTrades() does not support "+r.type+" orders, only spot orders are accepted");const a={symbol:r.id},n=await this.publicGetSpotV1SymbolsTrades(this.extend(a,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"trades",[]);return this.parseTrades(h,r,t,i)}parseOHLCV(e,t){return Array.isArray(e)?[this.safeTimestamp(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]:[this.safeTimestamp(e,"timestamp"),this.safeNumber2(e,"open","open_price"),this.safeNumber2(e,"high","high_price"),this.safeNumber2(e,"low","low_price"),this.safeNumber2(e,"close","close_price"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=a.type,o=this.parseTimeframe(t),h={symbol:a.id,step:this.safeInteger(this.timeframes,t,t)};void 0===s&&(s=500),s=Math.min(500,s);const d=parseInt(this.milliseconds()/1e3),c="spot"===n?"from":"start_time",l="spot"===n?"to":"end_time";if(void 0===i){const e=d-s*o;h[c]=e,h[l]=d}else{const e=parseInt(i/1e3)-1,t=this.sum(e,s*o);h[c]=e,h[l]=Math.min(t,d)}let u="publicGetSpotV1SymbolsKline";"swap"===n&&(u="publicGetContractPublicKline");const f=await this[u](this.extend(h,r)),p=this.safeValue(f,"data",{}),m=this.safeValue(p,"klines",[]),g="spot"===n?m:p;return this.parseOHLCVs(g,a,t,i,s)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new l(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e);if(!r.spot)throw new b(this.id+" fetchMyTrades() does not support "+r.type+" orders, only spot orders are accepted");const a=this.safeValue(this.options,"fetchMyTrades",{}),n=this.safeInteger(a,"limit",200);void 0===i&&(i=n);const o={symbol:r.id,N:i},h=await this.privateGetSpotV2Trades(this.extend(o,s)),d=this.safeValue(h,"data",{}),c=this.safeValue(d,"trades",[]);return this.parseTrades(c,r,t,i)}async fetchOrderTrades(e,t,i,s,r={}){if(void 0===t)throw new l(this.id+" fetchOrderTrades() requires a symbol argument");await this.loadMarkets();const a=this.market(t);if(!a.spot)throw new b(this.id+" fetchOrderTrades() does not support "+a.type+" orders, only spot orders are accepted");const n=this.safeValue(this.options,"fetchOrderTrades",{}),o=this.safeInteger(n,"limit",200);void 0===s&&(s=o);const h={symbol:a.id,order_id:e,N:s},d=await this.privateGetSpotV2Trades(this.extend(h,r)),c=this.safeValue(d,"data",{}),u=this.safeValue(c,"trades",[]);return this.parseTrades(u,a,i,s)}parseBalance(e,t){const i=this.safeValue(e,"data",{});let s;s="swap"===t?this.safeValue(e,"data",[]):"margin"===t?this.safeValue(i,"symbols",[]):this.safeValue(i,"wallet",[]);const r={info:e};if("margin"===t){for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"symbol"),a=this.safeSymbol(i,void 0,"_"),n=this.safeValue(t,"base",{}),o=this.safeValue(t,"quote",{}),h=this.safeCurrencyCode(this.safeString(n,"currency")),d=this.safeCurrencyCode(this.safeString(o,"currency")),c={};c[h]=this.parseBalanceHelper(n),c[d]=this.parseBalanceHelper(o),r[a]=this.safeBalance(c)}return r}for(let e=0;e<s.length;e++){const t=s[e];let i=this.safeString2(t,"id","currency");i=this.safeString(t,"coin_code",i);const a=this.safeCurrencyCode(i),n=this.account();n.free=this.safeString2(t,"available","available_balance"),n.used=this.safeString2(t,"frozen","frozen_balance"),r[a]=n}return this.safeBalance(r)}parseBalanceHelper(e){const t=this.account();t.used=this.safeString(e,"frozen"),t.free=this.safeString(e,"available"),t.total=this.safeString(e,"total_asset");const i=this.safeString(e,"borrow_unpaid"),s=this.safeString(e,"interest_unpaid");return t.debt=S.stringAdd(i,s),t}async fetchBalance(e={}){let t;await this.loadMarkets(),[t,e]=this.handleMarketTypeAndParams("fetchBalance",void 0,e);let i=this.getSupportedMapping(t,{spot:"privateGetSpotV1Wallet",swap:"privateGetContractPrivateAssetsDetail",account:"privateGetAccountV1Wallet",margin:"privateGetSpotV1MarginIsolatedAccount"});const s=this.safeString(e,"marginMode"),r=this.safeValue(e,"margin",!1);e=this.omit(e,["margin","marginMode"]),(void 0!==s||r)&&(i="privateGetSpotV1MarginIsolatedAccount",t="margin");const a=await this[i](e);return this.parseBalance(a,t)}parseTradingFee(e,t){const i=this.safeString(e,"symbol");return{info:e,symbol:this.safeSymbol(i),maker:this.safeNumber(e,"maker_fee_rate"),taker:this.safeNumber(e,"taker_fee_rate")}}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.spot)throw new b(this.id+" fetchTradingFee() does not support "+i.type+" orders, only spot orders are accepted");const s={symbol:i.id},r=await this.privateGetSpotV1TradeFee(this.extend(s,t)),a=this.safeValue(r,"data");return this.parseTradingFee(a)}parseOrder(e,t){let i;"string"==typeof e&&(i=e,e={}),i=this.safeString(e,"order_id",i);const s=this.safeInteger(e,"create_time"),r=this.safeString(e,"symbol"),a=this.safeSymbol(r,t,"_");let n;void 0!==t&&(n=this.parseOrderStatusByType(t.type,this.safeString(e,"status")));const o=this.safeString(e,"size"),h=this.safeString(e,"filled_size"),d=this.safeString(e,"price_avg"),c=this.safeString(e,"price"),l=this.safeString(e,"side");let u,f,p=this.safeString(e,"type");return"limit_maker"===p&&(p="limit",f=!0,u="PO"),"ioc"===p&&(p="limit",u="IOC"),this.safeOrder({id:i,clientOrderId:void 0,info:e,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:void 0,symbol:a,type:p,timeInForce:u,postOnly:f,side:l,price:c,stopPrice:void 0,triggerPrice:void 0,amount:o,cost:void 0,average:d,filled:h,remaining:void 0,status:n,fee:void 0,trades:void 0},t)}parseOrderStatusByType(e,t){const i=this.safeValue({spot:{1:"failed",2:"open",3:"failed",4:"open",5:"open",6:"closed",7:"canceling",8:"canceled"},swap:{1:"open",2:"open",4:"closed"}},e,{});return this.safeString(i,t,t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={},h=this.safeString(a,"timeInForce");if("FOK"===h)throw new f(this.id+" createOrder() only accepts timeInForce parameter values of IOC or PO");const d="market"===t,c=this.isPostOnly(d,"limit_maker"===t,a);a=this.omit(a,["timeInForce","postOnly"]);const l="IOC"===h||"ioc"===t,u="limit"===t||c||l;let p;if(n.spot){if(o.symbol=n.id,o.side=i,o.type=t,p="privatePostSpotV2SubmitOrder",u)o.size=this.amountToPrecision(e,s),o.price=this.priceToPrecision(e,r);else if(d)if("buy"===i){let e=this.safeNumber(a,"notional");if(this.safeValue(this.options,"createMarketBuyOrderRequiresPrice",!0)){if(void 0!==r){if(void 0===e){const t=this.numberToString(s),i=this.numberToString(r);e=this.parseNumber(S.stringMul(t,i))}}else if(void 0===e)throw new f(this.id+" createOrder () requires the price argument with market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount, or, alternatively, add .options['createMarketBuyOrderRequiresPrice'] = false and supply the total cost value in the 'amount' argument or in the 'notional' extra parameter (the exchange-specific behaviour)")}else e=void 0===e?s:e;o.notional=this.decimalToPrecision(e,w,n.precision.price,this.precisionMode)}else"sell"===i&&(o.size=this.amountToPrecision(e,s))}else if(n.swap)throw new b(this.id+" createOrder() does not accept swap orders, only spot orders are allowed");c&&(o.type="limit_maker"),l&&(o.type="ioc");const[m,g]=this.handleMarginModeAndParams("createOrder",a);void 0!==m&&(p="privatePostSpotV1MarginSubmitOrder");const y=await this[p](this.extend(o,g)),v=this.safeValue(y,"data",{}),k=this.parseOrder(v,n);return this.extend(k,{type:t,side:i,amount:s,price:r})}async cancelOrder(e,t,i={}){if(void 0===t)throw new l(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t);if(!s.spot)throw new b(this.id+" cancelOrder() does not support "+s.type+" orders, only spot orders are accepted");const r={order_id:e.toString(),symbol:s.id},a=await this.privatePostSpotV3CancelOrder(this.extend(r,i)),n=this.safeValue(a,"data");if(!0===n)return this.parseOrder(e,s);const o=this.safeValue(n,"succeed");if(void 0!==o){if(void 0===(e=this.safeString(o,0)))throw new f(this.id+" cancelOrder() failed to cancel "+t+" order id "+e)}else{if(!this.safeValue(n,"result"))throw new f(this.id+" cancelOrder() "+t+" order id "+e+" is filled or canceled")}const h=this.parseOrder(e,s);return this.extend(h,{id:e})}async cancelAllOrders(e,t={}){if(void 0===e)throw new l(this.id+" cancelAllOrders() requires a symbol argument");const i=this.safeString(t,"side");if(void 0===i)throw new l(this.id+" cancelAllOrders() requires a `side` parameter ('buy' or 'sell')");await this.loadMarkets();const s=this.market(e);if(!s.spot)throw new b(this.id+" cancelAllOrders() does not support "+s.type+" orders, only spot orders are accepted");const r={symbol:s.id,side:i};return await this.privatePostSpotV1CancelOrders(this.extend(r,t))}async fetchOrdersByStatus(e,t,i,s,r={}){if(void 0===t)throw new l(this.id+" fetchOrdersByStatus() requires a symbol argument");await this.loadMarkets();const a=this.market(t);if(!a.spot)throw new b(this.id+" fetchOrdersByStatus() does not support "+a.type+" orders, only spot orders are accepted");const n={symbol:a.id,offset:1,N:100};n.status="open"===e?9:"closed"===e?6:"canceled"===e?8:e;const o=await this.privateGetSpotV3Orders(this.extend(n,r)),h=this.safeValue(o,"data",{}),d=this.safeValue(h,"orders",[]);return this.parseOrders(d,a,i,s)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("open",e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("closed",e,t,i,s)}async fetchCanceledOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("canceled",e,t,i,s)}async fetchOrder(e,t,i={}){if(void 0===t)throw new l(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t);if(!s.spot)throw new b(this.id+" fetchOrder() does not support "+s.type+" orders, only spot orders are accepted");"string"!=typeof e&&(e=e.toString());const r={symbol:s.id,order_id:e},a=await this.privateGetSpotV2OrderDetail(this.extend(r,i)),n=this.safeValue(a,"data",{});return this.parseOrder(n,s)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id};if("USDT"===e){const s=this.safeValue(this.options,"defaultNetworks"),r=this.safeStringUpper(s,e),a=this.safeValue(this.options,"networks",{});let n=this.safeStringUpper(t,"network",r);n=this.safeString(a,n,n),void 0!==n&&(i.currency+="-"+n,t=this.omit(t,"network"))}const s=await this.privateGetAccountV1DepositAddress(this.extend(i,t)),r=this.safeValue(s,"data",{}),a=this.safeString(r,"address"),n=this.safeString(r,"address_memo"),o=this.safeString(r,"chain");let h;if(void 0!==o){const e=o.split("-"),t=this.safeString(e,1);h=this.safeNetwork(t)}return this.checkAddress(a),{currency:e,address:a,tag:n,network:h,info:s}}safeNetwork(e){return e}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={currency:a.id,amount:t,destination:"To Digital Address",address:i};if(void 0!==s&&(n.address_memo=s),"USDT"===e){const t=this.safeValue(this.options,"defaultNetworks"),i=this.safeStringUpper(t,e),s=this.safeValue(this.options,"networks",{});let a=this.safeStringUpper(r,"network",i);a=this.safeString(s,a,a),void 0!==a&&(n.currency+="-"+a,r=this.omit(r,"network"))}const o=await this.privatePostAccountV1WithdrawApply(this.extend(n,r)),h=this.safeValue(o,"data"),d=this.parseTransaction(h,a);return this.extend(d,{code:e,address:i,tag:s})}async fetchTransactionsByType(e,t,i,s,r={}){await this.loadMarkets(),void 0===s&&(s=50);const a={operation_type:e,offset:1,N:s};let n;if(void 0!==t&&(n=this.currency(t),a.currency=n.id),"USDT"===t){const e=this.safeValue(this.options,"defaultNetworks"),i=this.safeStringUpper(e,t),s=this.safeValue(this.options,"networks",{});let o=this.safeStringUpper(r,"network",i);o=this.safeString(s,o,o),void 0!==o&&(a.currency+="-"+o,n.code=a.currency,r=this.omit(r,"network"))}const o=await this.privateGetAccountV2DepositWithdrawHistory(this.extend(a,r)),h=this.safeValue(o,"data",{}),d=this.safeValue(h,"records",[]);return this.parseTransactions(d,n,i,s)}async fetchDeposit(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privateGetAccountV1DepositWithdrawDetail(this.extend(s,i)),a=this.safeValue(r,"data",{}),n=this.safeValue(a,"record",{});return this.parseTransaction(n)}async fetchDeposits(e,t,i,s={}){return await this.fetchTransactionsByType("deposit",e,t,i,s)}async fetchWithdrawal(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privateAccountGetDepositWithdrawDetail(this.extend(s,i)),a=this.safeValue(r,"data",{}),n=this.safeValue(a,"record",{});return this.parseTransaction(n)}async fetchWithdrawals(e,t,i,s={}){return await this.fetchTransactionsByType("withdraw",e,t,i,s)}parseTransactionStatus(e){return this.safeString({0:"pending",1:"pending",2:"pending",3:"ok",4:"canceled",5:"failed"},e,e)}parseTransaction(e,t){let i;const s=this.safeString(e,"withdraw_id"),r=this.safeString(e,"deposit_id");let a;void 0!==s&&""!==s?(a="withdraw",i=s):void 0!==r&&""!==r&&(a="deposit",i=r);const n=this.safeNumber(e,"arrival_amount"),o=this.safeInteger(e,"apply_time"),h=this.safeString(e,"currency"),d=this.safeCurrencyCode(h,t),c=this.parseTransactionStatus(this.safeString(e,"status")),l=this.safeNumber(e,"fee");let u;void 0!==l&&(u={cost:l,currency:d});const f=this.safeString(e,"tx_id");return{info:e,id:i,currency:d,amount:n,network:void 0,address:this.safeString(e,"address"),addressFrom:void 0,addressTo:void 0,tag:this.safeString(e,"address_memo"),tagFrom:void 0,tagTo:void 0,status:c,type:a,updated:void 0,txid:f,timestamp:0!==o?o:void 0,datetime:0!==o?this.iso8601(o):void 0,fee:u}}async repayMargin(e,t,i,s={}){if(await this.loadMarkets(),void 0===i)throw new l(this.id+" repayMargin() requires a symbol argument");const r=this.market(i),a=this.currency(e),n={symbol:r.id,currency:a.id,amount:this.currencyToPrecision(e,t)};s=this.omit(s,"marginMode");const o=await this.privatePostSpotV1MarginIsolatedRepay(this.extend(n,s)),h=this.safeValue(o,"data",{}),d=this.parseMarginLoan(h,a);return this.extend(d,{amount:t,symbol:i})}async borrowMargin(e,t,i,s={}){if(await this.loadMarkets(),void 0===i)throw new l(this.id+" borrowMargin() requires a symbol argument");const r=this.market(i),a=this.currency(e),n={symbol:r.id,currency:a.id,amount:this.currencyToPrecision(e,t)};s=this.omit(s,"marginMode");const o=await this.privatePostSpotV1MarginIsolatedBorrow(this.extend(n,s)),h=this.safeValue(o,"data",{}),d=this.parseMarginLoan(h,a);return this.extend(d,{amount:t,symbol:i})}parseMarginLoan(e,t){const i=this.milliseconds();return{id:this.safeString2(e,"borrow_id","repay_id"),currency:this.safeCurrencyCode(void 0,t),amount:void 0,symbol:void 0,timestamp:i,datetime:this.iso8601(i),info:e}}async fetchBorrowRate(e,t={}){let i;if(await this.loadMarkets(),e in this.markets)i=this.market(e);else{const t=this.safeString(this.options,"defaultSettle","USDT");i="USDT"===e?this.market("BTC/"+t):this.market(e+"/"+t)}const s={symbol:i.id},r=await this.privateGetSpotV1MarginIsolatedPairs(this.extend(s,t)),a=this.safeValue(r,"data",{}),n=this.safeValue(a,"symbols",[]),o="USDT"===e?i.quote:i.base;return this.parseBorrowRate(n,o)}parseBorrowRate(e,t){const i=this.milliseconds(),s="USDT"===t?this.safeValue(e[0],"quote",{}):this.safeValue(e[0],"base",{});return{currency:this.safeCurrencyCode(t),rate:this.safeNumber(s,"hourly_interest"),period:36e5,timestamp:i,datetime:this.iso8601(i),info:e}}async fetchBorrowRates(e={}){await this.loadMarkets();const t=await this.privateGetSpotV1MarginIsolatedPairs(e),i=this.safeValue(t,"data",{}),s=this.safeValue(i,"symbols",[]);return this.parseBorrowRates(s,void 0)}parseBorrowRates(e,t){const i=this.milliseconds(),s=[];for(let t=0;t<e.length;t++){const r=e[t],a=this.safeValue(r,"base",{});s.push({currency:this.safeCurrencyCode(this.safeString(a,"currency")),rate:this.safeNumber(a,"hourly_interest"),period:36e5,timestamp:i,datetime:this.iso8601(i),info:r})}return s}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n=this.currencyToPrecision(e,t),o={amount:n,currency:a.id},h=this.convertTypeToAccount(i),d=this.convertTypeToAccount(s);if("spot"===i)o.side="in",o.symbol=d;else{if("spot"!==s)throw new l(this.id+" transfer() requires either fromAccount or toAccount to be spot");o.side="out",o.symbol=h}const c=await this.privatePostSpotV1MarginIsolatedTransfer(this.extend(o,r));return this.extend(this.parseTransfer(c,a),{amount:this.parseNumber(n),fromAccount:i,toAccount:s})}parseTransferStatus(e){return this.safeString({1e3:"ok",OK:"ok"},e,e)}parseTransfer(e,t){const i=this.safeValue(e,"data",{});return{id:this.safeString(i,"transfer_id"),timestamp:void 0,datetime:void 0,currency:this.safeCurrencyCode(void 0,t),amount:void 0,fromAccount:void 0,toAccount:void 0,status:this.parseTransferStatus(this.safeString2(e,"code","message"))}}async fetchBorrowInterest(e,t,i,s,r={}){if(void 0===t)throw new l(this.id+" fetchBorrowInterest() requires a symbol argument");await this.loadMarkets();const a=this.market(t),n={symbol:a.id};void 0!==s&&(n.N=s),void 0!==i&&(n.start_time=i);const o=await this.privateGetSpotV1MarginIsolatedBorrowRecord(this.extend(n,r)),h=this.safeValue(o,"data",{}),d=this.safeValue(h,"records",[]),c=this.parseBorrowInterests(d,a);return this.filterByCurrencySinceLimit(c,e,i,s)}parseBorrowInterest(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t);const s=this.safeInteger(e,"create_time");return{symbol:this.safeString(t,"symbol"),marginMode:"isolated",currency:this.safeCurrencyCode(this.safeString(e,"currency")),interest:this.safeNumber(e,"interest_amount"),interestRate:this.safeNumber(e,"hourly_interest"),amountBorrowed:this.safeNumber(e,"borrow_amount"),timestamp:s,datetime:this.iso8601(s),info:e}}handleMarginModeAndParams(e,t={},i){let s;if([s,t]=super.handleMarginModeAndParams(e,t,i),void 0!==s&&"isolated"!==s)throw new b(this.id+" only isolated margin is supported");return[s,t]}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.implodeHostname(this.urls.api.rest)+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));let h="";const d="GET"===i||"DELETE"===i;if(d&&Object.keys(o).length&&(h=this.urlencode(o),n+="?"+h),"private"===t){this.checkRequiredCredentials();const e=this.milliseconds().toString();r={"X-BM-KEY":this.apiKey,"X-BM-TIMESTAMP":e,"Content-Type":"application/json"},d||(h=a=this.json(o));const t=e+"#"+this.uid+"#"+h,i=this.hmac(this.encode(t),this.encode(this.secret));r["X-BM-SIGN"]=i}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,n,o,h){if(void 0===n)return;const d=this.safeStringLower(n,"message"),c=this.safeString(n,"code");if(void 0!==c&&"1000"!==c||void 0!==d&&"ok"!==d){const e=this.id+" "+a;throw this.throwExactlyMatchedException(this.exceptions.exact,c,e),this.throwBroadlyMatchedException(this.exceptions.broad,c,e),this.throwExactlyMatchedException(this.exceptions.exact,d,e),this.throwBroadlyMatchedException(this.exceptions.broad,d,e),new u(e)}}}},87763:function(e,t,i){"use strict";const s=i(48819),{TICK_SIZE:r}=i(62115),{AuthenticationError:a,BadRequest:n,DDoSProtection:o,ExchangeError:h,ExchangeNotAvailable:d,InsufficientFunds:c,InvalidOrder:l,OrderNotFound:u,PermissionDenied:f,ArgumentsRequired:p,BadSymbol:m}=i(73449),g=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitmex",name:"BitMEX",countries:["SC"],version:"v1",userAgent:void 0,rateLimit:100,pro:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:!0,future:!0,option:!1,addMargin:void 0,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:!0,createOrder:!0,createReduceOnlyOrder:!0,editOrder:!0,fetchBalance:!0,fetchClosedOrders:!0,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDepositAddressesByNetwork:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!0,fetchFundingRates:!0,fetchIndexOHLCV:!1,fetchLedger:!0,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarketLeverageTiers:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositions:!0,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTransactions:"emulated",fetchTransfer:!1,fetchTransfers:!1,reduceMargin:void 0,setLeverage:!0,setMargin:void 0,setMarginMode:!0,setPositionMode:!1,transfer:!1,withdraw:!0},timeframes:{"1m":"1m","5m":"5m","1h":"1h","1d":"1d"},urls:{test:{public:"https://testnet.bitmex.com",private:"https://testnet.bitmex.com"},logo:"https://user-images.githubusercontent.com/1294454/27766319-f653c6e6-5ed4-11e7-933d-f0bc3699ae8f.jpg",api:{public:"https://www.bitmex.com",private:"https://www.bitmex.com"},www:"https://www.bitmex.com",doc:["https://www.bitmex.com/app/apiOverview","https://github.com/BitMEX/api-connectors/tree/master/official-http"],fees:"https://www.bitmex.com/app/fees",referral:"https://www.bitmex.com/register/upZpOX"},api:{public:{get:{announcement:5,"announcement/urgent":5,funding:5,instrument:5,"instrument/active":5,"instrument/activeAndIndices":5,"instrument/activeIntervals":5,"instrument/compositeIndex":5,"instrument/indices":5,insurance:5,leaderboard:5,liquidation:5,orderBook:5,"orderBook/L2":5,quote:5,"quote/bucketed":5,schema:5,"schema/websocketHelp":5,settlement:5,stats:5,"stats/history":5,trade:5,"trade/bucketed":5,"wallet/assets":5,"wallet/networks":5}},private:{get:{apiKey:5,chat:5,"chat/channels":5,"chat/connected":5,execution:5,"execution/tradeHistory":5,notification:5,order:5,position:5,user:5,"user/affiliateStatus":5,"user/checkReferralCode":5,"user/commission":5,"user/depositAddress":5,"user/executionHistory":5,"user/margin":5,"user/minWithdrawalFee":5,"user/wallet":5,"user/walletHistory":5,"user/walletSummary":5,"wallet/assets":5,"wallet/networks":5,userEvent:5},post:{apiKey:5,"apiKey/disable":5,"apiKey/enable":5,chat:5,order:1,"order/bulk":5,"order/cancelAllAfter":5,"order/closePosition":5,"position/isolate":1,"position/leverage":1,"position/riskLimit":5,"position/transferMargin":1,"user/cancelWithdrawal":5,"user/confirmEmail":5,"user/confirmEnableTFA":5,"user/confirmWithdrawal":5,"user/disableTFA":5,"user/logout":5,"user/logoutAll":5,"user/preferences":5,"user/requestEnableTFA":5,"user/requestWithdrawal":5},put:{order:1,"order/bulk":5,user:5},delete:{apiKey:5,order:1,"order/all":1}}},exceptions:{exact:{"Invalid API Key.":a,"This key is disabled.":f,"Access Denied":f,"Duplicate clOrdID":l,"orderQty is invalid":l,"Invalid price":l,"Invalid stopPx for ordType":l},broad:{"Signature not valid":a,overloaded:d,"Account has insufficient Available Balance":c,"Service unavailable":d,"Server Error":h,"Unable to cancel order due to existing state":l,"We require all new traders to verify":f}},precisionMode:r,options:{"api-expires":5,fetchOHLCVOpenTimestamp:!0,networks:{BTC:"btc",ETH:"eth",BSC:"bsc",BNB:"bsc",TRON:"tron",ERC20:"eth",BEP20:"bsc",TRC20:"tron",TRX:"tron",AVAX:"avax",NEAR:"near",XTZ:"xtz",DOT:"dot",SOL:"sol"},networksById:{btc:"BTC",eth:"ERC20",bsc:"BSC",tron:"TRX",avax:"AVAX",near:"NEAR",xtz:"XTZ",dot:"DOT",sol:"SOL"}},commonCurrencies:{USDt:"USDT",XBt:"BTC",XBT:"BTC",Gwei:"ETH",GWEI:"ETH",LAMP:"SOL",LAMp:"SOL"}})}async fetchMarkets(e={}){const t=await this.publicGetInstrumentActiveAndIndices(e),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"symbol"),a=this.safeString(s,"underlying"),n=this.safeString(s,"quoteCurrency"),o=this.safeString(s,"settlCurrency",""),h=this.safeCurrencyCode(a),d=this.safeCurrencyCode(n),c=this.safeCurrencyCode(o),l=r===a+n;let u,f=!1,p=!1,m=!1,y=h+"/"+d+":"+c;const b=this.safeString(s,"expiry"),v=this.parse8601(b),w=this.safeValue(s,"isInverse");let S="Unlisted"!==this.safeString(s,"state");l?u="swap":r.indexOf("B_")>=0?(p=!0,u="prediction",y=r):void 0!==v?(f=!0,u="future",y=y+"-"+this.yymmdd(v)):(m=!0,u="index",y=r,S=!1);const k=this.safeString2(s,"positionCurrency","underlying"),T=this.safeCurrencyCode(k)===d,_=this.safeNumber(s,"maxOrderQty"),O=!m,M=this.safeString(s,"initMargin","1"),I=this.parseNumber(g.stringDiv("1",M)),x=g.stringAbs(this.safeString(s,"multiplier"));i.push({id:r,symbol:y,base:h,quote:d,settle:c,baseId:a,quoteId:n,settleId:o,type:u,spot:!1,margin:!1,swap:l,future:f,option:!1,prediction:p,index:m,active:S,contract:O,linear:O?!w:void 0,inverse:O?w:void 0,taker:this.safeNumber(s,"takerFee"),maker:this.safeNumber(s,"makerFee"),contractSize:this.parseNumber(x),expiry:v,expiryDatetime:b,strike:this.safeNumber(s,"optionStrikePrice"),optionType:void 0,precision:{amount:this.safeNumber(s,"lotSize"),price:this.safeNumber(s,"tickSize"),quote:this.safeNumber(s,"tickSize"),base:this.safeNumber(s,"tickSize")},limits:{leverage:{min:O?this.parseNumber("1"):void 0,max:O?I:void 0},amount:{min:void 0,max:T?void 0:_},price:{min:void 0,max:this.safeNumber(s,"maxPrice")},cost:{min:void 0,max:T?_:void 0}},info:s})}return i}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();let o=this.safeString(s,"availableMargin"),h=this.safeString(s,"marginBalance");if("USDT"!==a){const e=a+"_USDT",t=this.safeMarket(e),i=this.safeValue(t,"info",{}),s=this.safeString(i,"underlyingToPositionMultiplier");void 0!==s?(o=g.stringDiv(o,s),h=g.stringDiv(h,s)):(o=g.stringDiv(o,"1e8"),h=g.stringDiv(h,"1e8"))}else o=g.stringDiv(o,"1e6"),h=g.stringDiv(h,"1e6");n.free=o,n.total=h,t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetUserMargin(this.extend({currency:"all"},e));return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={symbol:this.market(e).id};void 0!==t&&(s.depth=t);const r=await this.publicGetOrderBookL2(this.extend(s,i)),a={symbol:e,bids:[],asks:[],timestamp:void 0,datetime:void 0,nonce:void 0};for(let e=0;e<r.length;e++){const t=r[e],i="Sell"===t.side?"asks":"bids",s=this.safeNumber(t,"size"),n=this.safeNumber(t,"price");void 0!==n&&a[i].push([n,s])}return a.bids=this.sortBy(a.bids,0,!0),a.asks=this.sortBy(a.asks,0),a}async fetchOrder(e,t,i={}){const s={filter:{orderID:e}},r=await this.fetchOrders(t,void 0,void 0,this.deepExtend(s,i));if(1===r.length)return r[0];throw new u(this.id+": The order "+e+" not found.")}async fetchOrders(e,t,i,s={}){let r;await this.loadMarkets();let a={};void 0!==e&&(r=this.market(e),a.symbol=r.id),void 0!==t&&(a.startTime=this.iso8601(t)),void 0!==i&&(a.count=i),a=this.deepExtend(a,s),"filter"in a&&(a.filter=this.json(a.filter));const n=await this.privateGetOrder(a);return this.parseOrders(n,r,t,i)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.deepExtend({filter:{open:!0}},s))}async fetchClosedOrders(e,t,i,s={}){const r=await this.fetchOrders(e,t,i,s);return this.filterBy(r,"status","closed")}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets();let a={};void 0!==e&&(r=this.market(e),a.symbol=r.id),void 0!==t&&(a.startTime=this.iso8601(t)),void 0!==i&&(a.count=i),a=this.deepExtend(a,s),"filter"in a&&(a.filter=this.json(a.filter));const n=await this.privateGetExecutionTradeHistory(a);return this.parseTrades(n,r,t,i)}parseLedgerEntryType(e){return this.safeString({Withdrawal:"transaction",RealisedPNL:"margin",UnrealisedPNL:"margin",Deposit:"transaction",Transfer:"transfer",AffiliatePayout:"referral"},e,e)}parseLedgerEntry(e,t){const i=this.safeString(e,"transactID"),s=this.safeString(e,"account"),r=this.safeString(e,"tx"),a=this.parseLedgerEntryType(this.safeString(e,"transactType")),n=this.safeString(e,"currency"),o=this.safeCurrencyCode(n,t);let h=this.safeNumber(e,"amount");void 0!==h&&(h/=1e8);let d=this.parse8601(this.safeString(e,"transactTime"));void 0===d&&(d=0);let c=this.safeNumber(e,"fee",0);void 0!==c&&(c/=1e8);const l={cost:c,currency:o};let u=this.safeNumber(e,"walletBalance");void 0!==u&&(u/=1e8);const f=this.sum(u,-h);let p;h<0?(p="out",h=Math.abs(h)):p="in";const m=this.parseTransactionStatus(this.safeString(e,"transactStatus"));return{id:i,info:e,timestamp:d,datetime:this.iso8601(d),direction:p,account:s,referenceId:r,referenceAccount:undefined,type:a,currency:o,amount:h,before:f,after:u,status:m,fee:l}}async fetchLedger(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.currency(e));const a={};void 0!==i&&(a.count=i);const n=await this.privateGetUserWalletHistory(this.extend(a,s));return this.parseLedger(n,r,t,i)}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();const r={currency:"all"};void 0!==i&&(r.count=i);const a=await this.privateGetUserWalletHistory(this.extend(r,s)),n=this.filterByArray(a,"transactType",["Withdrawal","Deposit"],!1);let o;return void 0!==e&&(o=this.currency(e)),this.parseTransactions(n,o,t,i)}parseTransactionStatus(e){return this.safeString({Canceled:"canceled",Completed:"ok",Pending:"pending"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"currency");t=this.safeCurrency(i,t);const s=this.parse8601(this.safeString(e,"transactTime")),r=this.parse8601(this.safeString(e,"timestamp")),a=this.safeStringLower(e,"transactType");let n,o,h;"withdrawal"===a&&(n=this.safeString(e,"address"),o=this.safeString(e,"tx"),h=n);let d=this.safeString(e,"amount");const c="BTC"===t.code?"1e8":"1e6";d=g.stringDiv(g.stringAbs(d),c);let l=this.safeString(e,"fee");l=g.stringDiv(l,c);let u=this.safeString(e,"transactStatus");return void 0!==u&&(u=this.parseTransactionStatus(u)),{info:e,id:this.safeString(e,"transactID"),txid:this.safeString(e,"tx"),type:a,currency:t.code,network:this.safeString(e,"status"),amount:this.parseNumber(d),status:u,timestamp:s,datetime:this.iso8601(s),address:n,addressFrom:o,addressTo:h,tag:void 0,tagFrom:void 0,tagTo:void 0,updated:r,comment:void 0,fee:{currency:t.code,cost:this.parseNumber(l),rate:void 0}}}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s=await this.fetchTickers([i.symbol],t),r=this.safeValue(s,i.symbol);if(void 0===r)throw new m(this.id+" fetchTicker() symbol "+e+" not found");return r}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetInstrumentActiveAndIndices(t),s={};for(let e=0;e<i.length;e++){const t=this.parseTicker(i[e]),r=this.safeString(t,"symbol");void 0!==r&&(s[r]=t)}return this.filterByArray(s,"symbol",e)}parseTicker(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t),r=this.parse8601(this.safeString(e,"timestamp")),a=this.safeString(e,"prevPrice24h"),n=this.safeString(e,"lastPrice");return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeString(e,"highPrice"),low:this.safeString(e,"lowPrice"),bid:this.safeString(e,"bidPrice"),bidVolume:void 0,ask:this.safeString(e,"askPrice"),askVolume:void 0,vwap:this.safeString(e,"vwap"),open:a,close:n,last:n,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"homeNotional24h"),quoteVolume:this.safeString(e,"foreignNotional24h"),info:e},t)}parseOHLCV(e,t){return[this.parse8601(this.safeString(e,"timestamp")),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,binSize:this.safeString(this.timeframes,t,t),partial:!0};void 0!==s&&(n.count=s);const o=1e3*this.parseTimeframe(t),h=this.safeValue(this.options,"fetchOHLCVOpenTimestamp",!0);if(void 0!==i){let e=i;h&&(e=this.sum(e,o));const t=this.ymdhms(e);n.startTime=t}else n.reverse=!0;const d=await this.publicGetTradeBucketed(this.extend(n,r)),c=this.parseOHLCVs(d,a,t,i,s);if(h)for(let e=0;e<c.length;e++)c[e][0]=c[e][0]-o;return c}parseTrade(e,t){const i=this.parse8601(this.safeString(e,"timestamp")),s=this.safeString2(e,"avgPx","price"),r=this.safeString2(e,"size","lastQty"),a=this.safeString(e,"execCost"),n=g.stringDiv(g.stringAbs(a),"1e8"),o=this.safeString(e,"trdMatchID"),h=this.safeString(e,"orderID"),d=this.safeStringLower(e,"side");let c;const l=g.stringDiv(this.safeString(e,"execComm"),"1e8");if(void 0!==l){const t=this.safeString(e,"settlCurrency");c={cost:l,currency:this.safeCurrencyCode(t),rate:this.safeString(e,"commission")}}const u=this.safeString(e,"execType");let f;void 0!==l&&"Trade"===u&&(f=g.stringLt(l,"0")?"maker":"taker");const p=this.safeString(e,"symbol"),m=this.safeSymbol(p,t),y=this.safeStringLower(e,"ordType");return this.safeTrade({info:e,timestamp:i,datetime:this.iso8601(i),symbol:m,id:o,order:h,type:y,takerOrMaker:f,side:d,price:s,cost:n,amount:r,fee:c},t)}parseOrderStatus(e){return this.safeString({New:"open",PartiallyFilled:"open",Filled:"closed",DoneForDay:"open",Canceled:"canceled",PendingCancel:"open",PendingNew:"open",Rejected:"rejected",Expired:"expired",Stopped:"open",Untriggered:"open",Triggered:"open"},e,e)}parseTimeInForce(e){return this.safeString({Day:"Day",GoodTillCancel:"GTC",ImmediateOrCancel:"IOC",FillOrKill:"FOK"},e,e)}parseOrder(e,t){const i=this.parseOrderStatus(this.safeString(e,"ordStatus")),s=this.safeString(e,"symbol"),r=this.safeSymbol(s,t),a=this.parse8601(this.safeString(e,"timestamp")),n=this.parse8601(this.safeString(e,"transactTime")),o=this.safeString(e,"price"),h=this.safeString(e,"orderQty"),d=this.safeString(e,"cumQty"),c=this.safeString(e,"avgPx"),l=this.safeString(e,"orderID"),u=this.safeStringLower(e,"ordType"),f=this.safeStringLower(e,"side"),p=this.safeString(e,"clOrdID"),m=this.parseTimeInForce(this.safeString(e,"timeInForce")),g=this.safeNumber(e,"stopPx"),y=this.safeString(e,"execInst");let b;return void 0!==y&&(b="ParticipateDoNotInitiate"===y),this.safeOrder({info:e,id:l,clientOrderId:p,timestamp:a,datetime:this.iso8601(a),lastTradeTimestamp:n,symbol:r,type:u,timeInForce:m,postOnly:b,side:f,price:o,stopPrice:g,triggerPrice:g,amount:h,cost:void 0,average:c,filled:d,remaining:void 0,status:i,fee:void 0,trades:void 0},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==t?a.startTime=this.iso8601(t):a.reverse=!0,void 0!==i&&(a.count=i);const n=await this.publicGetTrade(this.extend(a,s));return this.parseTrades(n,r,t,i)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=this.capitalize(t);if(void 0!==this.safeValue(a,"reduceOnly")&&"swap"!==n.type&&"future"!==n.type)throw new l(this.id+" createOrder() does not support reduceOnly for "+n.type+" orders, reduceOnly orders are supported for swap and future markets only");const h=this.safeString(this.options,"brokerId","CCXT"),d={symbol:n.id,side:this.capitalize(i),orderQty:parseFloat(this.amountToPrecision(e,s)),ordType:o,text:h};if("Stop"===o||"StopLimit"===o||"MarketIfTouched"===o||"LimitIfTouched"===o){const t=this.safeNumber2(a,"stopPx","stopPrice");if(void 0===t)throw new p(this.id+" createOrder() requires a stopPx or stopPrice parameter for the "+o+" order type");d.stopPx=parseFloat(this.priceToPrecision(e,t)),a=this.omit(a,["stopPx","stopPrice"])}"Limit"!==o&&"StopLimit"!==o&&"LimitIfTouched"!==o||(d.price=parseFloat(this.priceToPrecision(e,r)));const c=this.safeString2(a,"clOrdID","clientOrderId");void 0!==c&&(d.clOrdID=c,a=this.omit(a,["clOrdID","clientOrderId"]));const u=await this.privatePostOrder(this.extend(d,a));return this.parseOrder(u,n)}async editOrder(e,t,i,s,r,a,n={}){await this.loadMarkets();const o={},h=this.safeString2(n,"origClOrdID","clientOrderId");if(void 0!==h){o.origClOrdID=h;const e=this.safeString(n,"clOrdID","clientOrderId");void 0!==e&&(o.clOrdID=e),n=this.omit(n,["origClOrdID","clOrdID","clientOrderId"])}else o.orderID=e;void 0!==r&&(o.orderQty=r),void 0!==a&&(o.price=a);const d=this.safeString(this.options,"brokerId","CCXT");o.text=d;const c=await this.privatePutOrder(this.extend(o,n));return this.parseOrder(c)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s=this.safeValue2(i,"clOrdID","clientOrderId"),r={};void 0===s?r.orderID=e:(r.clOrdID=s,i=this.omit(i,["clOrdID","clientOrderId"]));const a=await this.privateDeleteOrder(this.extend(r,i)),n=this.safeValue(a,0,{}),o=this.safeString(n,"error");if(void 0!==o&&o.indexOf("Unable to cancel order due to existing state")>=0)throw new u(this.id+" cancelOrder() failed: "+o);return this.parseOrder(n)}async cancelOrders(e,t,i={}){await this.loadMarkets();const s=this.safeValue2(i,"clOrdID","clientOrderId"),r={};void 0===s?r.orderID=e:(r.clOrdID=s,i=this.omit(i,["clOrdID","clientOrderId"]));const a=await this.privateDeleteOrder(this.extend(r,i));return this.parseOrders(a)}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};let s;void 0!==e&&(s=this.market(e),i.symbol=s.id);const r=await this.privateDeleteOrderAll(this.extend(i,t));return this.parseOrders(r,s)}async fetchPositions(e,t={}){await this.loadMarkets();const i=await this.privateGetPosition(t);return this.parsePositions(i,e)}parsePosition(e,t){const i=(t=this.safeMarket(this.safeString(e,"symbol"),t)).symbol,s=this.safeString(e,"timestamp"),r=!0===this.safeValue(e,"crossMargin")?"cross":"isolated";let a;a="USDT"===t.quote||"USD"===t.quote||"EUR"===t.quote?g.stringMul(this.safeString(e,"foreignNotional"),"-1"):this.safeString(e,"homeNotional");const n=this.safeNumber(e,"maintMargin"),o=this.safeNumber(e,"unrealisedPnl"),h=this.omitZero(this.safeNumber(e,"currentQty"));return{info:e,id:this.safeString(e,"account"),symbol:i,timestamp:this.parse8601(s),datetime:s,hedged:void 0,side:void 0,contracts:this.convertValue(h,t),contractSize:void 0,entryPrice:this.safeNumber(e,"avgEntryPrice"),markPrice:this.safeNumber(e,"markPrice"),notional:a,leverage:this.safeNumber(e,"leverage"),collateral:void 0,initialMargin:this.safeNumber(e,"initMargin"),initialMarginPercentage:this.safeNumber(e,"initMarginReq"),maintenanceMargin:this.convertValue(n,t),maintenanceMarginPercentage:this.safeNumber(e,"maintMarginReq"),unrealizedPnl:this.convertValue(o,t),liquidationPrice:this.safeNumber(e,"liquidationPrice"),marginMode:r,marginRatio:void 0,percentage:this.safeNumber(e,"unrealisedPnlPcnt")}}convertValue(e,t){if(void 0===e||void 0===t)return e;let i;if(e=this.numberToString(e),"USD"===t.quote||"EUR"===t.quote)i=g.stringMul(e,"0.00000001");else if("USDT"===t.quote)i=g.stringMul(e,"0.000001");else{let s;void 0!==t.quote&&(s=this.currency(t.quote)),void 0!==s&&(i=g.stringMul(e,this.numberToString(s.precision)))}return i=void 0!==i?parseFloat(i):void 0,i}isFiat(e){return"EUR"===e||"PLN"===e}async withdraw(e,t,i,s,r={}){if([s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets(),"BTC"!==e)throw new h(this.id+" supoprts BTC withdrawals only, other currencies coming soon...");const a=this.currency(e),n={currency:"XBt",amount:t,address:i},o=await this.privatePostUserRequestWithdrawal(this.extend(n,r));return this.parseTransaction(o,a)}async fetchFundingRates(e,t={}){await this.loadMarkets();const i=await this.publicGetInstrumentActiveAndIndices(t),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"symbol"),a=this.safeMarket(r);this.safeValue(a,"swap",!1)&&s.push(t)}return this.parseFundingRates(s,e)}parseFundingRate(e,t){const i=this.safeString(e,"timestamp"),s=this.safeString(e,"symbol"),r=this.safeString(e,"fundingTimestamp");return{info:e,symbol:this.safeSymbol(s,t),markPrice:this.safeNumber(e,"markPrice"),indexPrice:void 0,interestRate:void 0,estimatedSettlePrice:this.safeNumber(e,"indicativeSettlePrice"),timestamp:this.parse8601(i),datetime:i,fundingRate:this.safeNumber(e,"fundingRate"),fundingTimestamp:this.iso8601(r),fundingDatetime:r,nextFundingRate:this.safeNumber(e,"indicativeFundingRate"),nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async fetchFundingRateHistory(e,t,i,s={}){await this.loadMarkets();const r={};let a;if(e in this.currencies){const t=this.currency(e);r.symbol=t.id}else if(void 0!==e){const t=e.split(":"),i=["nearest","daily","weekly","monthly","quarterly","biquarterly","perpetual"];if(t.length>1&&this.inArray(t[1],i)){e=this.currency(t[0]).id+":"+t[1],r.symbol=e}else a=this.market(e),r.symbol=a.id}void 0!==t&&(r.startTime=this.iso8601(t)),void 0!==i&&(r.count=i);const n=this.safeInteger2(s,"until","till");s=this.omit(s,["until","till"]),void 0!==n&&(r.endTime=this.iso8601(n));const o=await this.publicGetFunding(this.extend(r,s));return this.parseFundingRateHistories(o,a,t,i)}parseFundingRateHistory(e,t){const i=this.safeString(e,"symbol"),s=this.safeString(e,"timestamp");return{info:e,symbol:this.safeSymbol(i,t),fundingRate:this.safeNumber(e,"fundingRate"),timestamp:this.parse8601(s),datetime:s}}async setLeverage(e,t,i={}){if(void 0===t)throw new p(this.id+" setLeverage() requires a symbol argument");if(e<.01||e>100)throw new n(this.id+" leverage should be between 0.01 and 100");await this.loadMarkets();const s=this.market(t);if("swap"!==s.type&&"future"!==s.type)throw new m(this.id+" setLeverage() supports future and swap contracts only");const r={symbol:s.id,leverage:e};return await this.privatePostPositionLeverage(this.extend(r,i))}async setMarginMode(e,t,i={}){if(void 0===t)throw new p(this.id+" setMarginMode() requires a symbol argument");if("isolated"!==(e=e.toLowerCase())&&"cross"!==e)throw new n(this.id+" setMarginMode() marginMode argument should be isolated or cross");await this.loadMarkets();const s=this.market(t);if("swap"!==s.type&&"future"!==s.type)throw new m(this.id+" setMarginMode() supports swap and future contracts only");const r="cross"!==e,a={symbol:s.id,enabled:r};return await this.privatePostPositionIsolate(this.extend(a,i))}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.safeStringUpper(t,"network");if(void 0===i)throw new p(this.id+' fetchDepositAddress requires params["network"]');const s=this.currency(e);let r=s.id;const a=this.networkCodeToId(i,s.code),n=r.length;r=r.slice(0,n-1)+r.slice(n-1,n).toLowerCase(),t=this.omit(t,"network");const o={currency:r,network:a},h=await this.privateGetUserDepositAddress(this.extend(o,t));return{currency:e,address:h.replace('"',"").replace('"',""),tag:void 0,network:this.networkIdToCode(a).toUpperCase(),info:h}}calculateRateLimiterCost(e,t,i,s,r={},a={}){const n=this.checkRequiredCredentials(!1),o=this.safeValue(r,"cost",1);return 1!==o?n?o:20:o}handleErrors(e,t,i,s,r,a,d,c,l){if(void 0!==d){if(429===e)throw new o(this.id+" "+a);if(e>=400){const t=this.safeValue(d,"error",{}),i=this.safeString(t,"message"),s=this.id+" "+a;if(this.throwExactlyMatchedException(this.exceptions.exact,i,s),this.throwBroadlyMatchedException(this.exceptions.broad,i,s),400===e)throw new n(s);throw new h(s)}}}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n="/api/"+this.version+"/"+e;if("GET"===i)Object.keys(s).length&&(n+="?"+this.urlencode(s));else{const e=this.safeString(s,"_format");void 0!==e&&(n+="?"+this.urlencode({_format:e}),s=this.omit(s,"_format"))}const o=this.urls.api[t]+n,h=this.checkRequiredCredentials(!1);if("private"===t||"public"===t&&h){this.checkRequiredCredentials();let e=i+n,t=this.safeInteger(this.options,"api-expires");r={"Content-Type":"application/json","api-key":this.apiKey},t=this.sum(this.seconds(),t),t=t.toString(),e+=t,r["api-expires"]=t,"POST"!==i&&"PUT"!==i&&"DELETE"!==i||Object.keys(s).length&&(e+=a=this.json(s)),r["api-signature"]=this.hmac(this.encode(e),this.encode(this.secret))}return{url:o,method:i,body:a,headers:r}}}},84070:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,AuthenticationError:n,InvalidOrder:o,InsufficientFunds:h,BadRequest:d}=i(73449),{TICK_SIZE:c}=i(62115),l=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitopro",name:"BitoPro",countries:["TW"],version:"v3",rateLimit:100,pro:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:!0,createOrder:!0,editOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!1,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchOrderTrades:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!1,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactionFees:!1,fetchTransactions:!1,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!0,fetchWithdrawals:!0,setLeverage:!1,setMarginMode:!1,transfer:!1,withdraw:!0},timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","3h":"3h","6h":"6h","12h":"12h","1d":"1d","1w":"1w","1M":"1M"},urls:{logo:"https://user-images.githubusercontent.com/1294454/158227251-3a92a220-9222-453c-9277-977c6677fe71.jpg",api:{rest:"https://api.bitopro.com/v3"},www:"https://www.bitopro.com",doc:["https://github.com/bitoex/bitopro-offical-api-docs/blob/master/v3-1/rest-1/rest.md"],fees:"https://www.bitopro.com/fees"},requiredCredentials:{apiKey:!0,secret:!0},api:{public:{get:["order-book/{pair}","tickers","tickers/{pair}","trades/{pair}","provisioning/currencies","provisioning/trading-pairs","provisioning/limitations-and-fees","trading-history/{pair}"]},private:{get:["accounts/balance","orders/history","orders/all/{pair}","orders/trades/{pair}","orders/{pair}/{orderId}","wallet/withdraw/{currency}/{serial}","wallet/withdraw/{currency}/id/{id}","wallet/depositHistory/{currency}","wallet/withdrawHistory/{currency}"],post:["orders/{pair}","orders/batch","wallet/withdraw/{currency}"],put:["orders"],delete:["orders/{pair}/{id}","orders/all","orders/{pair}"]}},fees:{trading:{tierBased:!0,percentage:!0,maker:this.parseNumber("0.001"),taker:this.parseNumber("0.002"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.002")],[this.parseNumber("3000000"),this.parseNumber("0.00194")],[this.parseNumber("5000000"),this.parseNumber("0.0015")],[this.parseNumber("30000000"),this.parseNumber("0.0014")],[this.parseNumber("300000000"),this.parseNumber("0.0013")],[this.parseNumber("550000000"),this.parseNumber("0.0012")],[this.parseNumber("1300000000"),this.parseNumber("0.0011")]],maker:[[this.parseNumber("0"),this.parseNumber("0.001")],[this.parseNumber("3000000"),this.parseNumber("0.00097")],[this.parseNumber("5000000"),this.parseNumber("0.0007")],[this.parseNumber("30000000"),this.parseNumber("0.0006")],[this.parseNumber("300000000"),this.parseNumber("0.0005")],[this.parseNumber("550000000"),this.parseNumber("0.0004")],[this.parseNumber("1300000000"),this.parseNumber("0.0003")]]}}},options:{networks:{ERC20:"ERC20",ETH:"ERC20",TRX:"TRX",TRC20:"TRX",BEP20:"BSC",BSC:"BSC"}},precisionMode:c,exceptions:{exact:{"Unsupported currency.":d,"Unsupported order type":d,"Invalid body":d,"Invalid Signature":n,"Address not in whitelist.":d},broad:{"Invalid amount":o,"Balance for ":h,"Invalid ":d,"Wrong parameter":d}},commonCurrencies:{}})}async fetchCurrencies(e={}){const t=await this.publicGetProvisioningCurrencies(e),i=this.safeValue(t,"data",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"currency"),a=this.safeCurrencyCode(r),n=this.safeValue(t,"deposit"),o=this.safeValue(t,"withdraw"),h=this.safeNumber(t,"withdrawFee"),d={withdraw:{min:this.safeNumber(t,"minWithdraw"),max:this.safeNumber(t,"maxWithdraw")},amount:{min:void 0,max:void 0}};s[a]={id:r,code:a,info:t,type:void 0,name:void 0,active:n&&o,deposit:n,withdraw:o,fee:h,precision:void 0,limits:d}}return s}async fetchMarkets(e={}){const t=await this.publicGetProvisioningTradingPairs(),i=this.safeValue(t,"data",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=!this.safeValue(t,"maintain"),a=this.safeString(t,"pair"),n=a.toUpperCase(),o=this.safeString(t,"base"),h=this.safeString(t,"quote"),d=this.safeCurrencyCode(o),c=this.safeCurrencyCode(h),l=d+"/"+c,u={amount:{min:this.safeNumber(t,"minLimitBaseAmount"),max:this.safeNumber(t,"maxLimitBaseAmount")},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0},leverage:{min:void 0,max:void 0}};s.push({id:a,uppercaseId:n,symbol:l,base:d,quote:c,baseId:d,quoteId:c,settle:void 0,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,derivative:!1,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,limits:u,precision:{price:this.parseNumber(this.parsePrecision(this.safeString(t,"quotePrecision"))),amount:this.parseNumber(this.parsePrecision(this.safeString(t,"basePrecision")))},active:r,info:t})}return s}parseTicker(e,t){const i=this.safeString(e,"pair");t=this.safeMarket(i,t);const s=this.safeString(t,"symbol");return this.safeTicker({symbol:s,timestamp:void 0,datetime:void 0,high:this.safeString(e,"high24hr"),low:this.safeString(e,"low24hr"),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:void 0,close:this.safeString(e,"lastPrice"),last:this.safeString(e,"lastPrice"),previousClose:void 0,change:void 0,percentage:this.safeString(e,"priceChange24hr"),average:void 0,baseVolume:this.safeString(e,"volume24hr"),quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={pair:i.id},r=await this.publicGetTickersPair(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseTicker(a,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetTickers(),s=this.safeValue(i,"data",[]);return this.parseTickers(s,e)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={pair:s.id};void 0!==t&&(r.limit=t);const a=await this.publicGetOrderBookPair(this.extend(r,i));return this.parseOrderBook(a,s.symbol,void 0,"bids","asks","price","amount")}parseTrade(e,t){const i=this.safeString(e,"tradeId"),s=this.safeString(e,"orderId");let r;r=void 0===i?this.safeTimestamp(e,"timestamp"):this.safeInteger(e,"timestamp");const a=this.safeString(e,"pair");t=this.safeMarket(a,t);const n=this.safeString(t,"symbol"),o=this.safeString(e,"price"),h=this.safeStringLower(e,"type");let d=this.safeStringLower(e,"action");if(void 0===d){d=this.safeValue(e,"isBuyer")?"buy":"sell"}let c,l=this.safeString(e,"amount");void 0===l&&(l=this.safeString(e,"baseAmount"));const u=this.safeString(e,"fee"),f=this.safeCurrencyCode(this.safeString(e,"feeSymbol"));void 0!==u&&(c={cost:u,currency:f,rate:void 0});const p=this.safeValue(e,"isTaker");let m;return void 0!==p&&(m=p?"taker":"maker"),this.safeTrade({id:i,info:e,order:s,timestamp:r,datetime:this.iso8601(r),symbol:n,takerOrMaker:m,type:h,side:d,price:o,amount:l,cost:void 0,fee:c},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pair:r.id},n=await this.publicGetTradesPair(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.publicGetProvisioningLimitationsAndFees(e),i=this.safeValue(t,"tradingFeeRate",{}),s=this.safeValue(i,0),r={},a=this.safeNumber(s,"makerFee"),n=this.safeNumber(s,"takerFee");for(let e=0;e<this.symbols.length;e++){const t=this.symbols[e];r[t]={info:s,symbol:t,maker:a,taker:n,percentage:!0,tierBased:!0}}return r}parseOHLCV(e,t,i="1m",s,r){return[this.safeInteger(e,"timestamp"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.safeString(this.timeframes,t,t),o={pair:a.id,resolution:n};void 0===s&&(s=500);const h=this.parseTimeframe(t);let d;if(void 0===i)o.to=this.seconds(),o.from=o.to-s*h;else{const e=1e3*h;d=Math.floor(i/e)*e,o.from=Math.floor(i/1e3),o.to=this.sum(o.from,s*h)}const c=await this.publicGetTradingHistoryPair(this.extend(o,r)),l=this.safeValue(c,"data",[]),u=this.parseOHLCVs(l,a,t,i,s);return this.insertMissingCandles(u,h,d,s)}insertMissingCandles(e,t,i,s){if(0===e.length)return e;const r=[];let a,n=e[0];a=void 0===i?n[0]:i;let o=0;const h=e.length;let d=0;for(;d<s&&o<h;){const i=e[o];if(i[0]===a)r.push(i),o=this.sum(o,1);else{const e=this.arrayConcat([],n);e[0]=a,e[1]=e[4],e[2]=e[4],e[3]=e[4],e[5]=this.parseNumber("0"),r.push(e)}a=this.sum(a,1e3*t),d=r.length,n=r[d-1]}return r}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.safeString(s,"amount"),o={free:this.safeString(s,"available"),total:n};t[a]=o}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetAccountsBalance(e),i=this.safeValue(t,"data",[]);return this.parseBalance(i)}parseOrderStatus(e){return this.safeString({"-1":"open",0:"open",1:"open",2:"closed",3:"closed",4:"canceled",6:"canceled"},e,void 0)}parseOrder(e,t){const i=this.safeString2(e,"id","orderId"),s=this.safeInteger2(e,"timestamp","createdTimestamp");let r=this.safeString(e,"action");r=r.toLowerCase();const a=this.safeString2(e,"amount","originalAmount"),n=this.safeString(e,"price"),o=this.safeString(e,"pair");t=this.safeMarket(o,t,"_");const h=this.safeString(t,"symbol"),d=this.safeString(e,"status"),c=this.parseOrderStatus(d),u=this.safeStringLower(e,"type"),f=this.safeString(e,"avgExecutionPrice"),p=this.safeString(e,"executedAmount"),m=this.safeString(e,"remainingAmount"),g=this.safeString(e,"timeInForce");let y,b;"POST_ONLY"===g&&(y=!0);const v=this.safeString(e,"fee"),w=this.safeCurrencyCode(this.safeString(e,"feeSymbol"));return l.stringGt(v,"0")&&(b={currency:w,cost:v}),this.safeOrder({id:i,clientOrderId:void 0,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:this.safeInteger(e,"updatedTimestamp"),symbol:h,type:u,timeInForce:g,postOnly:y,side:r,price:n,stopPrice:void 0,triggerPrice:void 0,amount:a,cost:void 0,average:f,filled:p,remaining:m,status:c,fee:b,trades:void 0,info:e},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),h={type:t,pair:n.id,action:i,amount:this.amountToPrecision(e,s),timestamp:this.milliseconds()},d=t.toUpperCase();if("LIMIT"===d&&(h.price=this.priceToPrecision(e,r)),"STOP_LIMIT"===d){h.price=this.priceToPrecision(e,r);const t=this.safeValue2(a,"triggerPrice","stopPrice");if(a=this.omit(a,["triggerPrice","stopPrice"]),void 0===t)throw new o(this.id+" createOrder() requires a stopPrice parameter for "+d+" orders");h.stopPrice=this.priceToPrecision(e,t);const i=this.safeString(a,"condition");if(void 0===i)throw new o(this.id+" createOrder() requires a condition parameter for "+d+" orders");h.condition=i}this.isPostOnly("MARKET"===d,void 0,a)&&(h.timeInForce="POST_ONLY");const c=await this.privatePostOrdersPair(this.extend(h,a),a);return this.parseOrder(c,n)}async cancelOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" cancelOrder() requires the symbol argument");await this.loadMarkets();const s=this.market(t),r={id:e,pair:s.id},n=await this.privateDeleteOrdersPairId(this.extend(r,i));return this.parseOrder(n,s)}async cancelOrders(e,t,i={}){if(void 0===t)throw new a(this.id+" cancelOrders() requires a symbol argument");await this.loadMarkets();const s={};s[this.market(t).uppercaseId]=e;return await this.privatePutOrders(this.extend(s,i))}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};let s=this.safeString(this.options,"privateDeleteOrdersPair","privateDeleteOrdersAll");if(void 0!==e){const t=this.market(e);i.pair=t.id,s="privateDeleteOrdersPair"}const r=await this[s](this.extend(i,t));return this.safeValue(r,"data",{})}async fetchOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" fetchOrder() requires the symbol argument");await this.loadMarkets();const s=this.market(t),r={orderId:e,pair:s.id},n=await this.privateGetOrdersPairOrderId(this.extend(r,i));return this.parseOrder(n,s)}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchOrders() requires the symbol argument");await this.loadMarkets();const r=this.market(e),n={pair:r.id};void 0!==t&&(n.startTimestamp=t),void 0!==i&&(n.limit=i);const o=await this.privateGetOrdersAllPair(this.extend(n,s),s);let h=this.safeValue(o,"data");return void 0===h&&(h=[]),this.parseOrders(h,r,t,i)}fetchOpenOrders(e,t,i,s={}){return this.fetchOrders(e,t,i,this.extend({statusKind:"OPEN"},s))}async fetchClosedOrders(e,t,i,s={}){return this.fetchOrders(e,t,i,this.extend({statusKind:"DONE"},s))}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchMyTrades() requires the symbol argument");await this.loadMarkets();const r=this.market(e),n={pair:r.id},o=await this.privateGetOrdersTradesPair(this.extend(n,s)),h=this.safeValue(o,"data",[]);return this.parseTrades(h,r,t,i)}parseTransactionStatus(e){return this.safeString({COMPLETE:"ok",INVALID:"failed",PROCESSING:"pending",WAIT_PROCESS:"pending",FAILED:"failed",EXPIRED:"failed",CANCELLED:"failed",EMAIL_VERIFICATION:"pending",WAIT_CONFIRMATION:"pending"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"coin"),s=this.safeCurrencyCode(i,t),r=this.safeInteger(e,"timestamp"),a=this.safeString(e,"address"),n=this.safeString(e,"message"),o=this.safeString(e,"status");let h=this.safeString(e,"protocol");return"MAIN"===h&&(h=s),{info:e,id:this.safeString(e,"serial"),txid:this.safeString(e,"txid"),type:void 0,currency:s,network:this.networkIdToCode(h),amount:this.safeNumber(e,"total"),status:this.parseTransactionStatus(o),timestamp:r,datetime:this.iso8601(r),address:a,addressFrom:void 0,addressTo:a,tag:n,tagFrom:void 0,tagTo:n,updated:void 0,comment:void 0,fee:{currency:s,cost:this.safeNumber(e,"fee"),rate:void 0}}}async fetchDeposits(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchDeposits() requires the code argument");await this.loadMarkets();const r=this.safeCurrency(e),n={currency:r.id};void 0!==t&&(n.startTimestamp=t),void 0!==i&&(n.limit=i);const o=await this.privateGetWalletDepositHistoryCurrency(this.extend(n,s)),h=this.safeValue(o,"data",[]);return this.parseTransactions(h,r,t,i,{type:"deposit"})}async fetchWithdrawals(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchWithdrawals() requires the code argument");await this.loadMarkets();const r=this.safeCurrency(e),n={currency:r.id};void 0!==t&&(n.startTimestamp=t),void 0!==i&&(n.limit=i);const o=await this.privateGetWalletWithdrawHistoryCurrency(this.extend(n,s)),h=this.safeValue(o,"data",[]);return this.parseTransactions(h,r,t,i,{type:"withdrawal"})}async fetchWithdrawal(e,t,i={}){if(void 0===t)throw new a(this.id+" fetchWithdrawal() requires the code argument");await this.loadMarkets();const s=this.safeCurrency(t),r={serial:e,currency:s.id},n=await this.privateGetWalletWithdrawCurrencySerial(this.extend(r,i)),o=this.safeValue(n,"data",{});return this.parseTransaction(o,s)}async withdraw(e,t,i,s,a={}){[s,a]=this.handleWithdrawTagAndParams(s,a),await this.loadMarkets(),this.checkAddress(i);const n=this.currency(e),o={currency:n.id,amount:this.numberToString(t),address:i};if("network"in a){const e=this.safeValue(this.options,"networks",{}),t=this.safeStringUpper(a,"network");a=this.omit(a,["network"]);const i=this.safeString(e,t);if(void 0===i)throw new r(this.id+" invalid network "+t);o.protocol=i}void 0!==s&&(o.message=s);const h=await this.privatePostWalletWithdrawCurrency(this.extend(o,a)),d=this.safeValue(h,"data",{});return this.parseTransaction(d,n)}sign(e,t="public",i="GET",s={},r,a){let n="/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if(void 0===r&&(r={}),r["X-BITOPRO-API"]="ccxt","private"===t){if(this.checkRequiredCredentials(),"POST"===i||"PUT"===i){a=this.json(s);const e=this.stringToBase64(a),t=this.hmac(e,this.encode(this.secret),"sha384");r["X-BITOPRO-APIKEY"]=this.apiKey,r["X-BITOPRO-PAYLOAD"]=e,r["X-BITOPRO-SIGNATURE"]=t}else if("GET"===i||"DELETE"===i){Object.keys(o).length&&(n+="?"+this.urlencode(o));let e={nonce:this.milliseconds()};e=this.json(e);const t=this.stringToBase64(e),i=this.hmac(t,this.encode(this.secret),"sha384");r["X-BITOPRO-APIKEY"]=this.apiKey,r["X-BITOPRO-PAYLOAD"]=t,r["X-BITOPRO-SIGNATURE"]=i}}else"public"===t&&"GET"===i&&Object.keys(o).length&&(n+="?"+this.urlencode(o));return n=this.urls.api.rest+n,{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;if(e>=200&&e<300)return;const c=this.id+" "+n,l=this.safeString(o,"error");throw this.throwExactlyMatchedException(this.exceptions.exact,l,c),this.throwBroadlyMatchedException(this.exceptions.broad,l,c),new r(c)}}},93223:function(e,t,i){"use strict";const s=i(48819),{AuthenticationError:r,ExchangeError:a,PermissionDenied:n,BadRequest:o,ArgumentsRequired:h,OrderNotFound:d,InsufficientFunds:c,ExchangeNotAvailable:l,DDoSProtection:u,InvalidAddress:f,InvalidOrder:p}=i(73449),{TICK_SIZE:m}=i(62115),g=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitpanda",name:"Bitpanda Pro",countries:["AT"],rateLimit:300,version:"v1",has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:!0,createDepositAddress:!0,createOrder:!0,createReduceOnlyOrder:!1,fetchAccounts:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposit:!1,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLedger:!1,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchOrderTrades:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactionFee:!1,fetchTransactionFees:!1,fetchTransactions:!1,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!1,fetchWithdrawals:!0,privateAPI:!0,publicAPI:!0,reduceMargin:!1,setLeverage:!1,setMargin:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!0},timeframes:{"1m":"1/MINUTES","5m":"5/MINUTES","15m":"15/MINUTES","30m":"30/MINUTES","1h":"1/HOURS","4h":"4/HOURS","1d":"1/DAYS","1w":"1/WEEKS","1M":"1/MONTHS"},urls:{logo:"https://user-images.githubusercontent.com/51840849/87591171-9a377d80-c6f0-11ea-94ac-97a126eac3bc.jpg",api:{public:"https://api.exchange.bitpanda.com/public",private:"https://api.exchange.bitpanda.com/public"},www:"https://www.bitpanda.com/en/pro",doc:["https://developers.bitpanda.com/exchange/"],fees:"https://www.bitpanda.com/en/pro/fees"},api:{public:{get:["currencies","candlesticks/{instrument_code}","fees","instruments","order-book/{instrument_code}","market-ticker","market-ticker/{instrument_code}","price-ticks/{instrument_code}","time"]},private:{get:["account/balances","account/deposit/crypto/{currency_code}","account/deposit/fiat/EUR","account/deposits","account/deposits/bitpanda","account/withdrawals","account/withdrawals/bitpanda","account/fees","account/orders","account/orders/{order_id}","account/orders/{order_id}/trades","account/trades","account/trades/{trade_id}","account/trading-volume"],post:["account/deposit/crypto","account/withdraw/crypto","account/withdraw/fiat","account/fees","account/orders"],delete:["account/orders","account/orders/{order_id}","account/orders/client/{client_id}"]}},fees:{trading:{tierBased:!0,percentage:!0,taker:this.parseNumber("0.0015"),maker:this.parseNumber("0.001"),tiers:[{taker:[[this.parseNumber("0"),this.parseNumber("0.0015")],[this.parseNumber("100"),this.parseNumber("0.0013")],[this.parseNumber("250"),this.parseNumber("0.0013")],[this.parseNumber("1000"),this.parseNumber("0.001")],[this.parseNumber("5000"),this.parseNumber("0.0009")],[this.parseNumber("10000"),this.parseNumber("0.00075")],[this.parseNumber("20000"),this.parseNumber("0.00065")]],maker:[[this.parseNumber("0"),this.parseNumber("0.001")],[this.parseNumber("100"),this.parseNumber("0.001")],[this.parseNumber("250"),this.parseNumber("0.0009")],[this.parseNumber("1000"),this.parseNumber("0.00075")],[this.parseNumber("5000"),this.parseNumber("0.0006")],[this.parseNumber("10000"),this.parseNumber("0.0005")],[this.parseNumber("20000"),this.parseNumber("0.0005")]]}]}},requiredCredentials:{apiKey:!0,secret:!1},precisionMode:m,exceptions:{exact:{INVALID_CLIENT_UUID:p,ORDER_NOT_FOUND:d,ONLY_ONE_ERC20_ADDRESS_ALLOWED:f,DEPOSIT_ADDRESS_NOT_USED:f,INVALID_CREDENTIALS:r,MISSING_CREDENTIALS:r,INVALID_APIKEY:r,INVALID_SCOPES:r,INVALID_SUBJECT:r,INVALID_ISSUER:r,INVALID_AUDIENCE:r,INVALID_DEVICE_ID:r,INVALID_IP_RESTRICTION:r,APIKEY_REVOKED:r,APIKEY_EXPIRED:r,SYNCHRONIZER_TOKEN_MISMATCH:r,SESSION_EXPIRED:r,INTERNAL_ERROR:r,CLIENT_IP_BLOCKED:n,MISSING_PERMISSION:n,ILLEGAL_CHARS:o,UNSUPPORTED_MEDIA_TYPE:o,ACCOUNT_HISTORY_TIME_RANGE_TOO_BIG:o,CANDLESTICKS_TIME_RANGE_TOO_BIG:o,INVALID_INSTRUMENT_CODE:o,INVALID_ORDER_TYPE:o,INVALID_UNIT:o,INVALID_PERIOD:o,INVALID_TIME:o,INVALID_DATE:o,INVALID_CURRENCY:o,INVALID_AMOUNT:o,INVALID_PRICE:o,INVALID_LIMIT:o,INVALID_QUERY:o,INVALID_CURSOR:o,INVALID_ACCOUNT_ID:o,INVALID_SIDE:p,INVALID_ACCOUNT_HISTORY_FROM_TIME:o,INVALID_ACCOUNT_HISTORY_MAX_PAGE_SIZE:o,INVALID_ACCOUNT_HISTORY_TIME_PERIOD:o,INVALID_ACCOUNT_HISTORY_TO_TIME:o,INVALID_CANDLESTICKS_GRANULARITY:o,INVALID_CANDLESTICKS_UNIT:o,INVALID_ORDER_BOOK_DEPTH:o,INVALID_ORDER_BOOK_LEVEL:o,INVALID_PAGE_CURSOR:o,INVALID_TIME_RANGE:o,INVALID_TRADE_ID:o,INVALID_UI_ACCOUNT_SETTINGS:o,NEGATIVE_AMOUNT:p,NEGATIVE_PRICE:p,MIN_SIZE_NOT_SATISFIED:p,BAD_AMOUNT_PRECISION:p,BAD_PRICE_PRECISION:p,BAD_TRIGGER_PRICE_PRECISION:p,MAX_OPEN_ORDERS_EXCEEDED:o,MISSING_PRICE:p,MISSING_ORDER_TYPE:p,MISSING_SIDE:p,MISSING_CANDLESTICKS_PERIOD_PARAM:h,MISSING_CANDLESTICKS_UNIT_PARAM:h,MISSING_FROM_PARAM:h,MISSING_INSTRUMENT_CODE:h,MISSING_ORDER_ID:p,MISSING_TO_PARAM:h,MISSING_TRADE_ID:h,INVALID_ORDER_ID:d,NOT_FOUND:d,INSUFFICIENT_LIQUIDITY:c,INSUFFICIENT_FUNDS:c,NO_TRADING:l,SERVICE_UNAVAILABLE:l,GATEWAY_TIMEOUT:l,RATELIMIT:u,CF_RATELIMIT:u,INTERNAL_SERVER_ERROR:a},broad:{}},commonCurrencies:{MIOTA:"IOTA"},options:{fetchTradingFees:{method:"fetchPrivateTradingFees"},fiat:["EUR","CHF"]}})}async fetchTime(e={}){const t=await this.publicGetTime(e);return this.safeInteger(t,"epoch_millis")}async fetchCurrencies(e={}){const t=await this.publicGetCurrencies(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"code"),a=this.safeCurrencyCode(r);i[a]={id:r,code:a,name:void 0,info:s,active:void 0,fee:void 0,precision:this.parseNumber(this.parsePrecision(this.safeString(s,"precision"))),withdraw:void 0,deposit:void 0,limits:{amount:{min:void 0,max:void 0},withdraw:{min:void 0,max:void 0}}}}return i}async fetchMarkets(e={}){const t=await this.publicGetInstruments(e),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeValue(s,"base",{}),a=this.safeValue(s,"quote",{}),n=this.safeString(r,"code"),o=this.safeString(a,"code"),h=n+"_"+o,d=this.safeCurrencyCode(n),c=this.safeCurrencyCode(o),l=this.safeString(s,"state");i.push({id:h,symbol:d+"/"+c,base:d,quote:c,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:"ACTIVE"===l,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(s,"amount_precision"))),price:this.parseNumber(this.parsePrecision(this.safeString(s,"market_precision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(s,"min_size"),max:void 0}},info:s})}return i}async fetchTradingFees(e={}){let t=this.safeString(e,"method");if(e=this.omit(e,"method"),void 0===t){const e=this.safeValue(this.options,"fetchTradingFees",{});t=this.safeString(e,"method","fetchPrivateTradingFees")}return await this[t](e)}async fetchPublicTradingFees(e={}){await this.loadMarkets();const t=await this.publicGetFees(e),i=this.safeValue(t,0,{}),s=this.safeValue(i,"fee_tiers"),r=this.parseFeeTiers(s),a=this.safeValue(s,0,{}),n={};for(let e=0;e<this.symbols.length;e++){const t=this.symbols[e];n[t]={info:i,symbol:t,maker:this.safeNumber(a,"maker_fee"),taker:this.safeNumber(a,"taker_fee"),percentage:!0,tierBased:!0,tiers:r}}return n}async fetchPrivateTradingFees(e={}){await this.loadMarkets();const t=await this.privateGetAccountFees(e),i=this.safeValue(t,"active_fee_tier",{});let s=this.safeString(i,"maker_fee"),r=this.safeString(i,"taker_fee");s=g.stringDiv(s,"100"),r=g.stringDiv(r,"100");const a=this.safeValue(t,"fee_tiers"),n={},o=this.parseFeeTiers(a);for(let e=0;e<this.symbols.length;e++){const i=this.symbols[e];n[i]={info:t,symbol:i,maker:this.parseNumber(s),taker:this.parseNumber(r),percentage:!0,tierBased:!0,tiers:o}}return n}parseFeeTiers(e,t){const i=[],s=[];for(let t=0;t<e.length;t++){const r=e[t],a=this.safeNumber(r,"volume");let n=this.safeString(r,"taker_fee"),o=this.safeString(r,"maker_fee");o=g.stringDiv(o,"100"),n=g.stringDiv(n,"100"),s.push([a,this.parseNumber(o)]),i.push([a,this.parseNumber(n)])}return{maker:s,taker:i}}parseTicker(e,t){const i=this.parse8601(this.safeString(e,"time")),s=this.safeString(e,"instrument_code"),r=this.safeSymbol(s,t,"_"),a=this.safeString(e,"last_price"),n=this.safeString(e,"price_change_percentage"),o=this.safeString(e,"price_change"),h=this.safeString(e,"base_volume"),d=this.safeString(e,"quote_volume");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"best_bid"),bidVolume:void 0,ask:this.safeString(e,"best_ask"),askVolume:void 0,vwap:void 0,open:void 0,close:a,last:a,previousClose:void 0,change:o,percentage:n,average:void 0,baseVolume:h,quoteVolume:d,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={instrument_code:i.id},r=await this.publicGetMarketTickerInstrumentCode(this.extend(s,t));return this.parseTicker(r,i)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetMarketTicker(t),s={};for(let e=0;e<i.length;e++){const t=this.parseTicker(i[e]);s[t.symbol]=t}return this.filterByArray(s,"symbol",e)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={instrument_code:s.id};void 0!==t&&(r.depth=t);const a=await this.publicGetOrderBookInstrumentCode(this.extend(r,i)),n=this.parse8601(this.safeString(a,"time"));return this.parseOrderBook(a,s.symbol,n,"bids","asks","price","amount")}parseOHLCV(e,t){const i=this.safeValue(e,"granularity"),s=this.safeString(i,"unit"),r=this.safeString(i,"period")+this.safeString({MINUTES:"m",HOURS:"h",DAYS:"d",WEEKS:"w",MONTHS:"M"},s),a=1e3*this.parseTimeframe(r),n=this.parse8601(this.safeString(e,"time")),o=a*parseInt(n/a),h=this.safeValue(this.options,"fetchOHLCV",{}),d=this.safeString(h,"volume","total_amount");return[o,this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,d)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.safeString(this.timeframes,t),[o,h]=n.split("/"),d=1e3*this.parseTimeframe(t);void 0===s&&(s=1500);const c={instrument_code:a.id,period:o,unit:h};if(void 0===i){const e=this.milliseconds();c.to=this.iso8601(e),c.from=this.iso8601(e-s*d)}else c.from=this.iso8601(i),c.to=this.iso8601(this.sum(i,s*d));const l=await this.publicGetCandlesticksInstrumentCode(this.extend(c,r));return this.parseOHLCVs(l,a,t,i,s)}parseTrade(e,t){const i=this.safeValue(e,"fee",{});e=this.safeValue(e,"trade",e);let s=this.safeInteger(e,"trade_timestamp");void 0===s&&(s=this.parse8601(this.safeString(e,"time")));const r=this.safeStringLower2(e,"side","taker_side"),a=this.safeString(e,"price"),n=this.safeString(e,"amount"),o=this.safeString(e,"volume"),h=this.safeString(e,"instrument_code"),d=this.safeSymbol(h,t,"_"),c=this.safeString(i,"fee_amount");let l,u;if(void 0!==c){const e=this.safeString(i,"fee_currency");u={cost:c,currency:this.safeCurrencyCode(e),rate:this.safeString(i,"fee_percentage")},l=this.safeStringLower(i,"fee_type")}return this.safeTrade({id:this.safeString2(e,"trade_id","sequence"),order:this.safeString(e,"order_id"),timestamp:s,datetime:this.iso8601(s),symbol:d,type:void 0,side:r,price:a,amount:n,cost:o,takerOrMaker:l,fee:u,info:e},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={instrument_code:r.id};void 0!==t&&(a.from=this.iso8601(t),a.to=this.iso8601(this.sum(t,144e5)));const n=await this.publicGetPriceTicksInstrumentCode(this.extend(a,s));return this.parseTrades(n,r,t,i)}parseBalance(e){const t=this.safeValue(e,"balances",[]),i={info:e};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"currency_code"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"available"),n.used=this.safeString(s,"locked"),i[a]=n}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetAccountBalances(e);return this.parseBalance(t)}parseDepositAddress(e,t){let i;void 0!==t&&(i=t.code);const s=this.safeString(e,"address"),r=this.safeString(e,"destination_tag");return this.checkAddress(s),{currency:i,address:s,tag:r,network:void 0,info:e}}async createDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},r=await this.privatePostAccountDepositCrypto(this.extend(s,t));return this.parseDepositAddress(r,i)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency_code:i.id},r=await this.privateGetAccountDepositCryptoCurrencyCode(this.extend(s,t));return this.parseDepositAddress(r,i)}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;if(void 0!==e&&(a=this.currency(e),r.currency_code=a.id),void 0!==i&&(r.max_page_size=i),void 0!==t){if(void 0===this.safeString(s,"to"))throw new h(this.id+' fetchDeposits() requires a "to" iso8601 string param with the since argument is specified');r.from=this.iso8601(t)}const n=await this.privateGetAccountDeposits(this.extend(r,s)),o=this.safeValue(n,"deposit_history",[]);return this.parseTransactions(o,a,t,i,{type:"deposit"})}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;if(void 0!==e&&(a=this.currency(e),r.currency_code=a.id),void 0!==i&&(r.max_page_size=i),void 0!==t){if(void 0===this.safeString(s,"to"))throw new h(this.id+' fetchWithdrawals() requires a "to" iso8601 string param with the since argument is specified');r.from=this.iso8601(t)}const n=await this.privateGetAccountWithdrawals(this.extend(r,s)),o=this.safeValue(n,"withdrawal_history",[]);return this.parseTransactions(o,a,t,i,{type:"withdrawal"})}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={currency:e,amount:this.currencyToPrecision(e,t)},o=this.safeValue(this.options,"fiat",[]),d=this.inArray(e,o),c=d?"privatePostAccountWithdrawFiat":"privatePostAccountWithdrawCrypto";if(d){if(void 0===this.safeString(r,"payout_account_id"))throw new h(this.id+" withdraw() requires a payout_account_id param for fiat "+e+" withdrawals")}else{const e={address:i};void 0!==s&&(e.destination_tag=s),n.recipient=e}const l=await this[c](this.extend(n,r));return this.parseTransaction(l,a)}parseTransaction(e,t){const i=this.safeString(e,"transaction_id"),s=this.safeNumber(e,"amount"),r=this.parse8601(this.safeString(e,"time")),a=this.safeString(e,"currency");t=this.safeCurrency(a,t);const n=this.safeNumber2(e,"fee_amount","fee");let o;const h=this.safeString(e,"recipient"),d=this.safeString(e,"destination_tag");if(void 0!==n){const t=this.safeString(e,"fee_currency",a);o={cost:n,currency:this.safeCurrencyCode(t)}}return{info:e,id:i,currency:t.code,amount:s,network:void 0,address:h,addressFrom:void 0,addressTo:h,tag:d,tagFrom:void 0,tagTo:d,status:"ok",type:void 0,updated:void 0,txid:this.safeString(e,"blockchain_transaction_id"),timestamp:r,datetime:this.iso8601(r),fee:o}}parseOrderStatus(e){return this.safeString({FILLED:"open",FILLED_FULLY:"closed",FILLED_CLOSED:"canceled",FILLED_REJECTED:"rejected",OPEN:"open",REJECTED:"rejected",CLOSED:"canceled",FAILED:"failed",STOP_TRIGGERED:"triggered"},e,e)}parseOrder(e,t){const i=this.safeValue(e,"order",e),s=this.safeString(i,"order_id"),r=this.safeString(i,"client_id"),a=this.parse8601(this.safeString(i,"time")),n=this.parseOrderStatus(this.safeString(i,"status")),o=this.parseOrderStatus(n),h=this.safeString(i,"instrument_code"),d=this.safeSymbol(h,t,"_"),c=this.safeString(i,"price"),l=this.safeString(i,"amount"),u=this.safeString(i,"filled_amount"),f=this.safeStringLower(i,"side"),p=this.safeStringLower(i,"type"),m=this.parseTimeInForce(this.safeString(i,"time_in_force")),g=this.safeNumber(i,"trigger_price"),y=this.safeValue(i,"is_post_only"),b=this.safeValue(e,"trades",[]);return this.safeOrder({id:s,clientOrderId:r,info:e,timestamp:a,datetime:this.iso8601(a),lastTradeTimestamp:void 0,symbol:d,type:p,timeInForce:m,postOnly:y,side:f,price:c,stopPrice:g,triggerPrice:g,amount:l,cost:void 0,average:void 0,filled:u,remaining:void 0,status:o,trades:b},t)}parseTimeInForce(e){return this.safeString({GOOD_TILL_CANCELLED:"GTC",GOOD_TILL_TIME:"GTT",IMMEDIATE_OR_CANCELLED:"IOC",FILL_OR_KILL:"FOK"},e,e)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=t.toUpperCase(),d={instrument_code:n.id,type:o,side:i.toUpperCase(),amount:this.amountToPrecision(e,s)};let c=!1;if("LIMIT"!==o&&"STOP"!==o||(c=!0),"STOP"===o){const i=this.safeNumber(a,"trigger_price");if(void 0===i)throw new h(this.id+" createOrder() requires a trigger_price param for "+t+" orders");d.trigger_price=this.priceToPrecision(e,i),a=this.omit(a,"trigger_price")}c&&(d.price=this.priceToPrecision(e,r));const l=this.safeString2(a,"clientOrderId","client_id");void 0!==l&&(d.client_id=l,a=this.omit(a,["clientOrderId","client_id"]));const u=await this.privatePostAccountOrders(this.extend(d,a));return this.parseOrder(u,n)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s=this.safeString2(i,"clientOrderId","client_id");i=this.omit(i,["clientOrderId","client_id"]);let r="privateDeleteAccountOrdersOrderId";const a={};void 0!==s?(r="privateDeleteAccountOrdersClientClientId",a.client_id=s):a.order_id=e;return await this[r](this.extend(a,i))}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};if(void 0!==e){const t=this.market(e);i.instrument_code=t.id}return await this.privateDeleteAccountOrders(this.extend(i,t))}async cancelOrders(e,t,i={}){await this.loadMarkets();const s={ids:e.join(",")};return await this.privateDeleteAccountOrders(this.extend(s,i))}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={order_id:e},r=await this.privateGetAccountOrdersOrderId(this.extend(s,i));return this.parseOrder(r)}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;if(void 0!==e&&(a=this.market(e),r.instrument_code=a.id),void 0!==t){if(void 0===this.safeString(s,"to"))throw new h(this.id+' fetchOpenOrders() requires a "to" iso8601 string param with the since argument is specified, max range is 100 days');r.from=this.iso8601(t)}void 0!==i&&(r.max_page_size=i);const n=await this.privateGetAccountOrders(this.extend(r,s)),o=this.safeValue(n,"order_history",[]);return this.parseOrders(o,a,t,i)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOpenOrders(e,t,i,this.extend({with_cancelled_and_rejected:!0},s))}async fetchOrderTrades(e,t,i,s,r={}){await this.loadMarkets();const a={order_id:e};void 0!==s&&(a.max_page_size=s);const n=await this.privateGetAccountOrdersOrderIdTrades(this.extend(a,r)),o=this.safeValue(n,"trade_history",[]);let h;return void 0!==t&&(h=this.market(t)),this.parseTrades(o,h,i,s)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;if(void 0!==e&&(a=this.market(e),r.instrument_code=a.id),void 0!==t){if(void 0===this.safeString(s,"to"))throw new h(this.id+' fetchMyTrades() requires a "to" iso8601 string param with the since argument is specified, max range is 100 days');r.from=this.iso8601(t)}void 0!==i&&(r.max_page_size=i);const n=await this.privateGetAccountTrades(this.extend(r,s)),o=this.safeValue(n,"trade_history",[]);return this.parseTrades(o,a,t,i)}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t]+"/"+this.version+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));return"public"===t?Object.keys(o).length&&(n+="?"+this.urlencode(o)):"private"===t&&(this.checkRequiredCredentials(),r={Accept:"application/json",Authorization:"Bearer "+this.apiKey},"POST"===i?(a=this.json(o),r["Content-Type"]="application/json"):Object.keys(o).length&&(n+="?"+this.urlencode(o))),{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,n,o,h,d){if(void 0===o)return;const c=this.safeString(o,"error");if(void 0!==c){const e=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,c,e),this.throwBroadlyMatchedException(this.exceptions.broad,c,e),new a(e)}}}},68120:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,ExchangeNotAvailable:n,InsufficientFunds:o,OrderNotFound:h,InvalidOrder:d,DDoSProtection:c,InvalidNonce:l,AuthenticationError:u,RateLimitExceeded:f,PermissionDenied:p,BadRequest:m,BadSymbol:g,AccountSuspended:y,OrderImmediatelyFillable:b,OnMaintenance:v}=i(73449),{TRUNCATE:w,TICK_SIZE:S}=i(62115),k=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitrue",name:"Bitrue",countries:["SG"],rateLimit:1e3,certified:!1,version:"v1",pro:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:void 0,future:void 0,option:!1,cancelAllOrders:!1,cancelOrder:!0,createOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchBalance:!0,fetchBidsAsks:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!1,fetchDeposits:!0,fetchMarginMode:!1,fetchMarkets:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchPositionMode:!1,fetchStatus:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransactionFees:!1,fetchTransactions:!1,fetchTransfers:!1,fetchWithdrawals:!0,transfer:!1,withdraw:!0},timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1H","2h":"2H","4h":"4H","1d":"1D","1w":"1W"},urls:{logo:"https://user-images.githubusercontent.com/1294454/139516488-243a830d-05dd-446b-91c6-c1f18fe30c63.jpg",api:{v1:"https://www.bitrue.com/api/v1",v2:"https://www.bitrue.com/api/v2",kline:"https://www.bitrue.com/kline-api"},www:"https://www.bitrue.com",referral:"https://www.bitrue.com/activity/task/task-landing?inviteCode=EZWETQE&cn=900000",doc:["https://github.com/Bitrue-exchange/bitrue-official-api-docs"],fees:"https://bitrue.zendesk.com/hc/en-001/articles/4405479952537"},api:{kline:{public:{get:{"public.json":1,"public{currency}.json":1}}},v1:{public:{get:{ping:1,time:1,exchangeInfo:1,depth:{cost:1,byLimit:[[100,1],[500,5],[1e3,10]]},trades:1,historicalTrades:5,aggTrades:1,"ticker/24hr":{cost:1,noSymbol:40},"ticker/price":{cost:1,noSymbol:2},"ticker/bookTicker":{cost:1,noSymbol:2},"market/kline":1}},private:{get:{order:1,openOrders:1,allOrders:5,account:5,myTrades:{cost:5,noSymbol:40},"etf/net-value/{symbol}":1,"withdraw/history":1,"deposit/history":1},post:{order:4,"withdraw/commit":1},delete:{order:1}}},v2:{private:{get:{myTrades:5}}}},fees:{trading:{feeSide:"get",tierBased:!1,percentage:!0,taker:this.parseNumber("0.00098"),maker:this.parseNumber("0.00098")},future:{trading:{feeSide:"quote",tierBased:!0,percentage:!0,taker:this.parseNumber("0.000400"),maker:this.parseNumber("0.000200"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.000400")],[this.parseNumber("250"),this.parseNumber("0.000400")],[this.parseNumber("2500"),this.parseNumber("0.000350")],[this.parseNumber("7500"),this.parseNumber("0.000320")],[this.parseNumber("22500"),this.parseNumber("0.000300")],[this.parseNumber("50000"),this.parseNumber("0.000270")],[this.parseNumber("100000"),this.parseNumber("0.000250")],[this.parseNumber("200000"),this.parseNumber("0.000220")],[this.parseNumber("400000"),this.parseNumber("0.000200")],[this.parseNumber("750000"),this.parseNumber("0.000170")]],maker:[[this.parseNumber("0"),this.parseNumber("0.000200")],[this.parseNumber("250"),this.parseNumber("0.000160")],[this.parseNumber("2500"),this.parseNumber("0.000140")],[this.parseNumber("7500"),this.parseNumber("0.000120")],[this.parseNumber("22500"),this.parseNumber("0.000100")],[this.parseNumber("50000"),this.parseNumber("0.000080")],[this.parseNumber("100000"),this.parseNumber("0.000060")],[this.parseNumber("200000"),this.parseNumber("0.000040")],[this.parseNumber("400000"),this.parseNumber("0.000020")],[this.parseNumber("750000"),this.parseNumber("0")]]}}},delivery:{trading:{feeSide:"base",tierBased:!0,percentage:!0,taker:this.parseNumber("0.000500"),maker:this.parseNumber("0.000100"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.000500")],[this.parseNumber("250"),this.parseNumber("0.000450")],[this.parseNumber("2500"),this.parseNumber("0.000400")],[this.parseNumber("7500"),this.parseNumber("0.000300")],[this.parseNumber("22500"),this.parseNumber("0.000250")],[this.parseNumber("50000"),this.parseNumber("0.000240")],[this.parseNumber("100000"),this.parseNumber("0.000240")],[this.parseNumber("200000"),this.parseNumber("0.000240")],[this.parseNumber("400000"),this.parseNumber("0.000240")],[this.parseNumber("750000"),this.parseNumber("0.000240")]],maker:[[this.parseNumber("0"),this.parseNumber("0.000100")],[this.parseNumber("250"),this.parseNumber("0.000080")],[this.parseNumber("2500"),this.parseNumber("0.000050")],[this.parseNumber("7500"),this.parseNumber("0.0000030")],[this.parseNumber("22500"),this.parseNumber("0")],[this.parseNumber("50000"),this.parseNumber("-0.000050")],[this.parseNumber("100000"),this.parseNumber("-0.000060")],[this.parseNumber("200000"),this.parseNumber("-0.000070")],[this.parseNumber("400000"),this.parseNumber("-0.000080")],[this.parseNumber("750000"),this.parseNumber("-0.000090")]]}}}},options:{fetchMyTradesMethod:"v2PrivateGetMyTrades",hasAlreadyAuthenticatedSuccessfully:!1,recvWindow:5e3,timeDifference:0,adjustForTimeDifference:!1,parseOrderToPrecision:!1,newOrderRespType:{market:"FULL",limit:"FULL"},networks:{ERC20:"ETH",TRC20:"TRX",TRON:"TRX"}},commonCurrencies:{MIM:"MIM Swarm"},precisionMode:S,exceptions:{exact:{"System is under maintenance.":v,"System abnormality":r,"You are not authorized to execute this request.":p,"API key does not exist":u,"Order would trigger immediately.":b,"Stop price would trigger immediately.":b,"Order would immediately match and take.":b,"Account has insufficient balance for requested action.":o,"Rest API trading is not enabled.":n,"You don't have permission.":p,"Market is closed.":n,"Too many requests. Please try again later.":c,"-1000":n,"-1001":n,"-1002":u,"-1003":f,"-1013":d,"-1015":f,"-1016":n,"-1020":m,"-1021":l,"-1022":u,"-1100":m,"-1101":m,"-1102":m,"-1103":m,"-1104":m,"-1105":m,"-1106":m,"-1111":m,"-1112":d,"-1114":m,"-1115":m,"-1116":m,"-1117":m,"-1118":m,"-1119":m,"-1120":m,"-1121":g,"-1125":u,"-1127":m,"-1128":m,"-1130":m,"-1131":m,"-2008":u,"-2010":r,"-2011":h,"-2013":h,"-2014":u,"-2015":u,"-2019":o,"-3005":o,"-3006":o,"-3008":o,"-3010":r,"-3015":r,"-3022":y,"-4028":m,"-3020":o,"-3041":o,"-5013":o,"-11008":o,"-4051":o},broad:{"has no operation privilege":p,MAX_POSITION:d}}})}costToPrecision(e,t){return this.decimalToPrecision(t,w,this.markets[e].precision.quote,this.precisionMode,this.paddingMode)}currencyToPrecision(e,t,i){return void 0!==this.safeValue(this.currencies[e],"precision")?this.decimalToPrecision(t,w,this.currencies[e].precision,this.precisionMode,this.paddingMode):this.numberToString(t)}nonce(){return this.milliseconds()-this.options.timeDifference}async fetchStatus(e={}){const t=await this.v1PublicGetPing(e);return{status:Object.keys(t).length?"maintenance":"ok",updated:void 0,eta:void 0,url:void 0,info:t}}async fetchTime(e={}){const t=await this.v1PublicGetTime(e);return this.safeInteger(t,"serverTime")}safeNetwork(e){const t=e.toUpperCase();return this.safeString2({Aeternity:"Aeternity",AION:"AION",Algorand:"Algorand",ASK:"ASK",ATOM:"ATOM","AVAX C-Chain":"AVAX C-Chain",bch:"bch",BCH:"BCH",BEP2:"BEP2",BEP20:"BEP20",Bitcoin:"Bitcoin",BRP20:"BRP20",Cardano:"ADA",CasinoCoin:"CasinoCoin","CasinoCoin XRPL":"CasinoCoin XRPL",Contentos:"Contentos",Dash:"Dash",Decoin:"Decoin",DeFiChain:"DeFiChain",DGB:"DGB",Divi:"Divi",dogecoin:"DOGE",EOS:"EOS",ERC20:"ERC20",ETC:"ETC",Filecoin:"Filecoin",FREETON:"FREETON",HBAR:"HBAR","Hedera Hashgraph":"Hedera Hashgraph",HRC20:"HRC20",ICON:"ICON",ICP:"ICP",Ignis:"Ignis","Internet Computer":"Internet Computer",IOTA:"IOTA",KAVA:"KAVA",KSM:"KSM",LiteCoin:"LiteCoin",Luna:"Luna",MATIC:"MATIC","Mobile Coin":"Mobile Coin",MonaCoin:"MonaCoin",Monero:"Monero",NEM:"NEM",NEP5:"NEP5",OMNI:"OMNI",PAC:"PAC",Polkadot:"Polkadot",Ravencoin:"Ravencoin",Safex:"Safex",SOLANA:"SOL",Songbird:"Songbird","Stellar Lumens":"Stellar Lumens",Symbol:"Symbol",Tezos:"XTZ",theta:"theta",THETA:"THETA",TRC20:"TRC20",VeChain:"VeChain",VECHAIN:"VECHAIN",Wanchain:"Wanchain","XinFin Network":"XinFin Network",XRP:"XRP",XRPL:"XRPL",ZIL:"ZIL"},e,t,e)}async fetchCurrencies(e={}){const t=await this.v1PublicGetExchangeInfo(e),i={},s=this.safeValue(t,"coins",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"coin"),a=this.safeString(t,"coinFulName"),n=this.safeCurrencyCode(r),o=this.safeValue(t,"enableDeposit"),h=this.safeValue(t,"enableWithdraw"),d=this.safeValue(t,"chains",[]),c={};for(let e=0;e<d.length;e++){const t=d[e],i=this.safeNetwork(t);c[i]={info:t,id:t,network:i,active:void 0,fee:void 0,precision:void 0,limits:{withdraw:{min:void 0,max:void 0}}}}const l=h&&o;i[n]={id:r,name:a,code:n,precision:void 0,info:t,active:l,deposit:o,withdraw:h,networks:c,fee:this.safeNumber(t,"withdrawFee"),limits:{withdraw:{min:this.safeNumber(t,"minWithdraw"),max:this.safeNumber(t,"maxWithdraw")}}}}return i}async fetchMarkets(e={}){const t=await this.v1PublicGetExchangeInfo(e);this.options.adjustForTimeDifference&&await this.loadTimeDifference();const i=this.safeValue(t,"symbols",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"symbol"),a=this.safeStringLower(t,"symbol"),n=this.safeString(t,"baseAsset"),o=this.safeString(t,"quoteAsset"),h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o),c=this.safeValue(t,"filters",[]),l=this.indexBy(c,"filterType"),u=this.safeString(t,"status"),f=this.safeValue(l,"PRICE_FILTER",{}),p=this.safeValue(l,"LOT_SIZE",{}),m=this.safeString(t,"pricePrecision"),g=this.safeString(t,"quantityPrecision"),y=this.safeString(f,"priceScale",m),b=this.safeString(p,"volumeScale",g),v={id:r,lowercaseId:a,symbol:h+"/"+d,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:"TRADING"===u,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(b)),price:this.parseNumber(this.parsePrecision(y)),base:this.parseNumber(this.parsePrecision(this.safeString(t,"baseAssetPrecision"))),quote:this.parseNumber(this.parsePrecision(this.safeString(t,"quotePrecision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(p,"minQty"),max:this.safeNumber(p,"maxQty")},price:{min:this.safeNumber(f,"minPrice"),max:this.safeNumber(f,"maxPrice")},cost:{min:this.safeNumber(p,"minVal"),max:void 0}},info:t};s.push(v)}return s}parseBalance(e){const t={info:e},i=this.safeInteger(e,"updateTime"),s=this.safeValue(e,"balances",[]);for(let e=0;e<s.length;e++){const i=s[e],r=this.safeString(i,"asset"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(i,"free"),n.used=this.safeString(i,"locked"),t[a]=n}return t.timestamp=i,t.datetime=this.iso8601(i),this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.v1PrivateGetAccount(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={symbol:this.market(e).id};void 0!==t&&(s.limit=t);const r=await this.v1PublicGetDepth(this.extend(s,i)),a=this.parseOrderBook(r,e);return a.nonce=this.safeInteger(r,"lastUpdateId"),a}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.safeString(e,"last");return this.safeTicker({symbol:i,timestamp:void 0,datetime:void 0,high:this.safeString(e,"high24hr"),low:this.safeString(e,"low24hr"),bid:this.safeString(e,"highestBid"),bidVolume:void 0,ask:this.safeString(e,"lowestAsk"),askVolume:void 0,vwap:void 0,open:void 0,close:s,last:s,previousClose:void 0,change:void 0,percentage:this.safeString(e,"percentChange"),average:void 0,baseVolume:this.safeString(e,"baseVolume"),quoteVolume:this.safeString(e,"quoteVolume"),info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s=this.safeStringUpper(i,"baseId"),a=this.safeStringUpper(i,"quoteId"),n={currency:a,command:"returnTicker"},o=await this.klinePublicGetPublicCurrencyJson(this.extend(n,t)),h=this.safeValue(o,"data",{}),d=s+"_"+a,c=this.safeValue(h,d);if(void 0===c)throw new r(this.id+" fetchTicker() could not find the ticker for "+i.symbol);return this.parseTicker(c,i)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,scale:this.safeString(this.timeframes,t,t)};void 0!==s&&(n.limit=s);const o=await this.v1PublicGetMarketKline(this.extend(n,r)),h=this.safeValue(o,"data",[]);return this.parseOHLCVs(h,a,t,i,s)}parseOHLCV(e,t){return[this.safeTimestamp(e,"i"),this.safeNumber(e,"o"),this.safeNumber(e,"h"),this.safeNumber(e,"l"),this.safeNumber(e,"c"),this.safeNumber(e,"v")]}async fetchBidsAsks(e,t={}){await this.loadMarkets();const i=this.safeString2(this.options,"fetchBidsAsks","defaultType","spot"),s=this.safeString(t,"type",i),r=this.omit(t,"type");let a;a="future"===s?"fapiPublicGetTickerBookTicker":"delivery"===s?"dapiPublicGetTickerBookTicker":"publicGetTickerBookTicker";const n=await this[a](r);return this.parseTickers(n,e)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.klinePublicGetPublicJson(this.extend({command:"returnTicker"},t)),s=this.safeValue(i,"data",{}),r={},a=Object.keys(s);for(let e=0;e<a.length;e++){r[a[e].replace("_","")]=s[a[e]]}return this.parseTickers(r,e)}parseTrade(e,t){const i=this.safeInteger2(e,"T","time"),s=this.safeString2(e,"p","price"),r=this.safeString2(e,"q","qty"),a=this.safeString(e,"symbol"),n=this.safeSymbol(a,t);let o,h=this.safeString2(e,"t","a");h=this.safeString2(e,"id","tradeId",h);const d=this.safeString(e,"orderId");let c,l;return"m"in e?o=e.m?"sell":"buy":"isBuyerMaker"in e?o=e.isBuyerMaker?"sell":"buy":"side"in e?o=this.safeStringLower(e,"side"):"isBuyer"in e&&(o=e.isBuyer?"buy":"sell"),"commission"in e&&(c={cost:this.safeString(e,"commission"),currency:this.safeCurrencyCode(this.safeString(e,"commissionAssert"))}),"isMaker"in e&&(l=e.isMaker?"maker":"taker"),"maker"in e&&(l=e.maker?"maker":"taker"),this.safeTrade({info:e,timestamp:i,datetime:this.iso8601(i),symbol:n,id:h,order:d,type:void 0,side:o,takerOrMaker:l,price:s,amount:r,cost:void 0,fee:c},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id},n=this.safeString(this.options,"fetchTradesMethod","v1PublicGetAggTrades");void 0!==i&&(a.limit=i);const o=await this[n](this.extend(a,s));return this.parseTrades(o,r,t,i)}parseOrderStatus(e){return this.safeString({NEW:"open",PARTIALLY_FILLED:"open",FILLED:"closed",CANCELED:"canceled",PENDING_CANCEL:"canceling",REJECTED:"rejected",EXPIRED:"expired"},e,e)}parseOrder(e,t){const i=this.parseOrderStatus(this.safeString(e,"status")),s=this.safeString(e,"symbol"),r=this.safeSymbol(s,t),a=this.safeString(e,"executedQty");let n,o;"time"in e?n=this.safeInteger(e,"time"):"transactTime"in e?n=this.safeInteger(e,"transactTime"):"updateTime"in e&&"open"===i&&(k.stringGt(a,"0")?o=this.safeInteger(e,"updateTime"):n=this.safeInteger(e,"updateTime"));const h=this.safeString(e,"avgPrice"),d=this.safeString(e,"price"),c=this.safeString(e,"origQty"),l=this.safeString2(e,"cummulativeQuoteQty","cumQuote"),u=this.safeString(e,"orderId");let f=this.safeStringLower(e,"type");const p=this.safeStringLower(e,"side"),m=this.safeValue(e,"fills",[]),g=this.safeString(e,"clientOrderId"),y=this.safeString(e,"timeInForce"),b="limit_maker"===f||"GTX"===y;"limit_maker"===f&&(f="limit");const v=this.safeString(e,"stopPrice"),w=this.parseNumber(this.omitZero(v));return this.safeOrder({info:e,id:u,clientOrderId:g,timestamp:n,datetime:this.iso8601(n),lastTradeTimestamp:o,symbol:r,type:f,timeInForce:y,postOnly:b,side:p,price:d,stopPrice:w,triggerPrice:w,amount:c,cost:l,average:h,filled:a,remaining:void 0,status:i,fee:void 0,trades:m},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=t.toUpperCase(),h=this.safeValue(n.info,"orderTypes");if(!this.inArray(o,h))throw new d(this.id+" "+t+" is not a valid order type in market "+e);const c={symbol:n.id,side:i.toUpperCase(),type:o,quantity:this.amountToPrecision(e,s)},l=this.safeString2(a,"newClientOrderId","clientOrderId");if(void 0!==l&&(a=this.omit(a,["newClientOrderId","clientOrderId"]),c.newClientOrderId=l),"LIMIT"===o){if(void 0===r)throw new d(this.id+" createOrder() requires a price argument");c.price=this.priceToPrecision(e,r)}const u=this.safeValue2(a,"triggerPrice","stopPrice");void 0!==u&&(a=this.omit(a,["triggerPrice","stopPrice"]),c.stopPrice=this.priceToPrecision(e,u));const f=await this.v1PrivatePostOrder(this.extend(c,a));return this.parseOrder(f,n)}async fetchOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={symbol:s.id},n=this.safeValue2(i,"origClientOrderId","clientOrderId");void 0!==n?r.origClientOrderId=n:r.orderId=e;const o=this.omit(i,["type","clientOrderId","origClientOrderId"]),h=await this.v1PrivateGetOrder(this.extend(r,o));return this.parseOrder(h,s)}async fetchClosedOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchClosedOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={symbol:r.id};void 0!==t&&(n.startTime=t),void 0!==i&&(n.limit=i);const o=await this.v1PrivateGetAllOrders(this.extend(n,s));return this.parseOrders(o,r,t,i)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={symbol:r.id},o=await this.v1PrivateGetOpenOrders(this.extend(n,s));return this.parseOrders(o,r,t,i)}async cancelOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r=this.safeValue2(i,"origClientOrderId","clientOrderId"),n={symbol:s.id};void 0===r?n.orderId=e:n.origClientOrderId=r;const o=this.omit(i,["type","origClientOrderId","clientOrderId"]),h=await this.v1PrivateDeleteOrder(this.extend(n,o));return this.parseOrder(h,s)}async fetchMyTrades(e,t,i,s={}){const r=this.safeString(this.options,"fetchMyTradesMethod","v2PrivateGetMyTrades");if(void 0===e&&"v2PrivateGetMyTrades"===r)throw new a(this.id+" v2PrivateGetMyTrades() requires a symbol argument");await this.loadMarkets();const n={};let o;void 0!==e&&(o=this.market(e),n.symbol=o.id),void 0!==t&&(n.startTime=t),void 0!==i&&(n.limit=i);const h=await this[r](this.extend(n,s));return this.parseTrades(h,o,t,i)}async fetchDeposits(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchDeposits() requires a code argument");await this.loadMarkets();const r=this.currency(e),n={coin:r.id,status:1};void 0!==t&&(n.startTime=t),void 0!==i&&(n.limit=i);const o=await this.v1PrivateGetDepositHistory(this.extend(n,s)),h=this.safeValue(o,"data",[]);return this.parseTransactions(h,r,t,i)}async fetchWithdrawals(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchWithdrawals() requires a code argument");await this.loadMarkets();const r=this.currency(e),n={coin:r.id,status:5};void 0!==t&&(n.startTime=t),void 0!==i&&(n.limit=i);const o=await this.v1PrivateGetWithdrawHistory(this.extend(n,s)),h=this.safeValue(o,"data",{});return this.parseTransactions(h,r)}parseTransactionStatusByType(e,t){const i=this.safeValue({deposit:{0:"pending",1:"ok"},withdrawal:{0:"pending",5:"ok",6:"canceled"}},t,{});return this.safeString(i,e,e)}parseTransaction(e,t){const i=this.safeString2(e,"id","withdrawId"),s=this.safeString(e,"tagType");let r,a,n=this.safeString(e,"addressTo"),o=this.safeString(e,"addressFrom");if(void 0!==s){if(void 0!==n){const e=n.split("_");n=this.safeString(e,0),r=this.safeString(e,1)}if(void 0!==o){const e=o.split("_");o=this.safeString(e,0),a=this.safeString(e,1)}}const h=this.safeString(e,"txid"),d=this.safeInteger(e,"createdAt"),c=this.safeInteger(e,"updatedAt"),l="payAmount"in e||"ctime"in e?"withdrawal":"deposit",u=this.parseTransactionStatusByType(this.safeString(e,"status"),l),f=this.safeNumber(e,"amount");let p,m=this.safeString2(e,"symbol","coin");if(void 0!==m){const e=m.split("_");m=this.safeString(e,0);const t=this.safeString(e,1);void 0!==t&&(p=t.toUpperCase())}const g=this.safeCurrencyCode(m,t),y=this.safeNumber(e,"fee");let b;return void 0!==y&&(b={currency:g,cost:y}),{info:e,id:i,txid:h,timestamp:d,datetime:this.iso8601(d),network:p,address:n,addressTo:n,addressFrom:o,tag:r,tagTo:r,tagFrom:a,type:l,amount:f,currency:g,status:u,updated:c,internal:!1,fee:b}}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const n=this.currency(e);let o=this.safeString(r,"chainName");if(void 0===o){const e=this.safeValue(n,"networks",{}),t=this.safeValue(this.options,"networks",{});let i=this.safeStringUpper(r,"network");i=this.safeString(t,i,i);const s=this.safeValue(e,i,{});if(o=this.safeString(s,"id"),void 0===o)throw new a(this.id+" withdraw() requires a network parameter or a chainName parameter");r=this.omit(r,"network")}const h={coin:n.id.toUpperCase(),amount:t,addressTo:i,chainName:o};void 0!==s&&(h.tag=s);const d=await this.v1PrivatePostWithdrawCommit(this.extend(h,r)),c=this.safeValue(d,"data");return this.parseTransaction(c,n)}sign(e,t="public",i="GET",s={},r,a){const[n,o]=t;let h=this.urls.api[n]+"/"+this.implodeParams(e,s);if(s=this.omit(s,this.extractParams(e)),"private"===o){this.checkRequiredCredentials();const e=this.safeInteger(this.options,"recvWindow",5e3);let t=this.urlencode(this.extend({timestamp:this.nonce(),recvWindow:e},s));t+="&signature="+this.hmac(this.encode(t),this.encode(this.secret)),r={"X-MBX-APIKEY":this.apiKey},"GET"===i||"DELETE"===i?h+="?"+t:(a=t,r["Content-Type"]="application/x-www-form-urlencoded")}else Object.keys(s).length&&(h+="?"+this.urlencode(s));return{url:h,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,l){if(418===e||429===e)throw new c(this.id+" "+e.toString()+" "+t+" "+n);if(e>=400){if(n.indexOf("Price * QTY is zero or less")>=0)throw new d(this.id+" order cost = amount * price is zero or less "+n);if(n.indexOf("LOT_SIZE")>=0)throw new d(this.id+" order amount should be evenly divisible by lot size "+n);if(n.indexOf("PRICE_FILTER")>=0)throw new d(this.id+" order price is invalid, i.e. exceeds allowed price precision, exceeds min price or max price limits or is invalid float value in general, use this.priceToPrecision (symbol, amount) "+n)}if(void 0===o)return;const u=this.safeValue(o,"success",!0);if(!u){const e=this.safeString(o,"msg");let t;if(void 0!==e){try{t=JSON.parse(e)}catch(e){t=void 0}void 0!==t&&(o=t)}}const f=this.safeString(o,"msg");void 0!==f&&(this.throwExactlyMatchedException(this.exceptions.exact,f,this.id+" "+f),this.throwBroadlyMatchedException(this.exceptions.broad,f,this.id+" "+f));const p=this.safeString(o,"code");if(void 0!==p){if("200"===p||k.stringEquals(p,"0"))return;if("-2015"===p&&this.options.hasAlreadyAuthenticatedSuccessfully)throw new c(this.id+" temporary banned: "+n);const e=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,p,e),new r(e)}if(!u)throw new r(this.id+" "+n)}calculateRateLimiterCost(e,t,i,s,r={},a={}){if("noSymbol"in r&&!("symbol"in s))return r.noSymbol;if("byLimit"in r&&"limit"in s){const e=s.limit,t=r.byLimit;for(let i=0;i<t.length;i++){const s=t[i];if(e<=s[0])return s[1]}}return this.safeValue(r,"cost",1)}}},25686:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,InvalidNonce:a,AuthenticationError:n,OrderNotFound:o,NotSupported:h,BadRequest:d,ArgumentsRequired:c}=i(73449),{TICK_SIZE:l}=i(62115),u=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitso",name:"Bitso",countries:["MX"],rateLimit:2e3,version:"v3",has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:!0,createDepositAddress:!1,createOrder:!0,createReduceOnlyOrder:!1,fetchAccounts:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchDeposit:!0,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDeposits:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLedger:!0,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderTrades:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!1,fetchTime:!1,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactionFee:!1,fetchTransactionFees:!0,fetchTransactions:!1,fetchTransfer:!1,fetchTransfers:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/51840849/87295554-11f98280-c50e-11ea-80d6-15b3bafa8cbf.jpg",api:{rest:"https://api.bitso.com"},www:"https://bitso.com",doc:"https://bitso.com/api_info",fees:"https://bitso.com/fees",referral:"https://bitso.com/?ref=itej"},precisionMode:l,options:{precision:{XRP:1e-6,MXN:.01,TUSD:.01},defaultPrecision:1e-8},timeframes:{"1m":"60","5m":"300","15m":"900","30m":"1800","1h":"3600","4h":"14400","12h":"43200","1d":"86400","1w":"604800"},api:{public:{get:["available_books","ticker","order_book","trades","ohlc"]},private:{get:["account_status","balance","fees","fundings","fundings/{fid}","funding_destination","kyc_documents","ledger","ledger/trades","ledger/fees","ledger/fundings","ledger/withdrawals","mx_bank_codes","open_orders","order_trades/{oid}","orders/{oid}","user_trades","user_trades/{tid}","withdrawals/","withdrawals/{wid}"],post:["bitcoin_withdrawal","debit_card_withdrawal","ether_withdrawal","ripple_withdrawal","bcash_withdrawal","litecoin_withdrawal","orders","phone_number","phone_verification","phone_withdrawal","spei_withdrawal","ripple_withdrawal","bcash_withdrawal","litecoin_withdrawal"],delete:["orders","orders/{oid}","orders/all"]}},exceptions:{"0201":n,104:a,"0304":d}})}async fetchLedger(e,t,i,s={}){const r={};void 0!==i&&(r.limit=i);const a=await this.privateGetLedger(this.extend(r,s)),n=this.safeValue(a,"payload",[]);return this.parseLedger(n,e,t,i)}parseLedgerEntryType(e){return this.safeString({funding:"transaction",withdrawal:"transaction",trade:"trade",fee:"fee"},e,e)}parseLedgerEntry(e,t){const i=this.safeString(e,"operation"),s=this.parseLedgerEntryType(i),r=this.safeValue(e,"balance_updates",[]),a=this.safeValue(r,0,{});let n,o;const h=this.safeString(a,"amount"),d=this.safeString(a,"currency"),c=this.safeCurrencyCode(d,t),l=this.safeValue(e,"details",{});let f=this.safeString2(l,"fid","wid");if(void 0===f&&(f=this.safeString(l,"tid")),"funding"===i)n="in";else if("withdrawal"===i)n="out";else if("trade"===i)n=void 0;else if("fee"===i){n="out";o={cost:u.stringAbs(h),currency:t}}const p=this.parse8601(this.safeString(e,"created_at"));return this.safeLedgerEntry({id:this.safeString(e,"eid"),direction:n,account:void 0,referenceId:f,referenceAccount:void 0,type:s,currency:c,amount:h,timestamp:p,datetime:this.iso8601(p),before:void 0,after:void 0,status:"ok",fee:o,info:e},t)}async fetchMarkets(e={}){const t=await this.publicGetAvailableBooks(e),i=this.safeValue(t,"payload",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"book"),[a,n]=r.split("_");let o=a.toUpperCase(),h=n.toUpperCase();o=this.safeCurrencyCode(o),h=this.safeCurrencyCode(h);const d=this.safeValue(t,"fees",{}),c=this.safeValue(d,"flat_rate",{}),l=this.safeString(c,"taker"),f=this.safeString(c,"maker"),p=this.parseNumber(u.stringDiv(l,"100")),m=this.parseNumber(u.stringDiv(f,"100")),g=this.safeValue(d,"structure",[]),y={taker:p,maker:m,percentage:!0,tierBased:!0},b=[],v=[];for(let e=0;e<g.length;e++){const t=g[e],i=this.safeNumber(t,"volume"),s=this.safeNumber(t,"taker"),r=this.safeNumber(t,"maker");b.push([i,s]),v.push([i,r]),0===e&&(y.taker=s,y.maker=r)}const w={taker:b,maker:v};y.tiers=w;const S=this.safeNumber(this.options.precision,h,this.options.defaultPrecision);s.push(this.extend({id:r,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,taker:p,maker:m,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(this.options.precision,o,this.options.defaultPrecision),price:this.safeNumber(t,"tick_size",S)},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"minimum_amount"),max:this.safeNumber(t,"maximum_amount")},price:{min:this.safeNumber(t,"minimum_price"),max:this.safeNumber(t,"maximum_price")},cost:{min:this.safeNumber(t,"minimum_value"),max:this.safeNumber(t,"maximum_value")}},info:t},y))}return s}parseBalance(e){const t=this.safeValue(e,"payload",{}),i=this.safeValue(t,"balances",[]),s={info:e,timestamp:void 0,datetime:void 0};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(t,"available"),n.used=this.safeString(t,"locked"),n.total=this.safeString(t,"total"),s[a]=n}return this.safeBalance(s)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetBalance(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={book:s.id},a=await this.publicGetOrderBook(this.extend(r,i)),n=this.safeValue(a,"payload"),o=this.parse8601(this.safeString(n,"updated_at"));return this.parseOrderBook(n,s.symbol,o,"bids","asks","price","amount")}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.parse8601(this.safeString(e,"created_at")),r=this.safeString(e,"vwap"),a=this.safeString(e,"volume"),n=u.stringMul(a,r),o=this.safeString(e,"last");return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:r,open:void 0,close:o,last:o,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:a,quoteVolume:n,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={book:i.id},r=await this.publicGetTicker(this.extend(s,t)),a=this.safeValue(r,"payload");return this.parseTicker(a,i)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={book:a.id,time_bucket:this.safeString(this.timeframes,t,t)};if(void 0!==i){if(n.start=i,void 0!==s){const e=this.parseTimeframe(t);n.end=this.sum(i,e*s*1e3)}}else if(void 0!==s){const e=this.milliseconds();n.end=e,n.start=e-1e3*this.parseTimeframe(t)*s}const o=await this.publicGetOhlc(this.extend(n,r)),h=this.safeValue(o,"payload",[]);return this.parseOHLCVs(h,a,t,i,s)}parseOHLCV(e,t,i="1m"){return[this.safeInteger(e,"bucket_start_time"),this.safeNumber(e,"first_rate"),this.safeNumber(e,"max_rate"),this.safeNumber(e,"min_rate"),this.safeNumber(e,"last_rate"),this.safeNumber(e,"volume")]}parseTrade(e,t){const i=this.parse8601(this.safeString(e,"created_at")),s=this.safeString(e,"book"),r=this.safeSymbol(s,t,"_"),a=this.safeString2(e,"side","maker_side");let n;n=a===this.safeString(e,"maker_side")?"maker":"taker";let o,h=this.safeString2(e,"amount","major");void 0!==h&&(h=u.stringAbs(h));const d=this.safeString(e,"fees_amount");if(void 0!==d){const t=this.safeString(e,"fees_currency");o={cost:d,currency:this.safeCurrencyCode(t)}}let c=this.safeString(e,"minor");void 0!==c&&(c=u.stringAbs(c));const l=this.safeString(e,"price"),f=this.safeString(e,"oid"),p=this.safeString(e,"tid");return this.safeTrade({id:p,info:e,timestamp:i,datetime:this.iso8601(i),symbol:r,order:f,type:void 0,side:a,takerOrMaker:n,price:l,amount:h,cost:c,fee:o},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={book:r.id},n=await this.publicGetTrades(this.extend(a,s));return this.parseTrades(n.payload,r,t,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privateGetFees(e),i=this.safeValue(t,"payload",{}),s=this.safeValue(i,"fees",[]),r={};for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"book"),a=this.safeSymbol(i,void 0,"_");r[a]={info:t,symbol:a,maker:this.safeNumber(t,"maker_fee_decimal"),taker:this.safeNumber(t,"taker_fee_decimal"),percentage:!0,tierBased:!0}}return r}async fetchMyTrades(e,t,i=25,s={}){await this.loadMarkets();const a=this.market(e),n="marker"in s;if(void 0!==t&&!n)throw new r(this.id+" fetchMyTrades() does not support fetching trades starting from a timestamp with the `since` argument, use the `marker` extra param to filter starting from an integer trade id");n&&(s=this.extend(s,{marker:parseInt(s.marker)}));const o={book:a.id,limit:i},h=await this.privateGetUserTrades(this.extend(o,s));return this.parseTrades(h.payload,a,t,i)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={book:n.id,side:i,type:t,major:this.amountToPrecision(n.symbol,s)};"limit"===t&&(o.price=this.priceToPrecision(n.symbol,r));const h=await this.privatePostOrders(this.extend(o,a));return{info:h,id:this.safeString(h.payload,"oid")}}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={oid:e};return await this.privateDeleteOrdersOid(this.extend(s,i))}async cancelOrders(e,t,i={}){if(!Array.isArray(e))throw new c(this.id+" cancelOrders() ids argument should be an array");let s;void 0!==t&&(s=this.market(t));const r={oids:e.join(",")},a=await this.privateDeleteOrders(this.extend(r,i)),n=this.safeValue(a,"payload",[]),o=[];for(let e=0;e<n.length;e++){const t=n[e];o.push(this.parseOrder(t,s))}return o}async cancelAllOrders(e,t={}){if(void 0!==e)throw new h(this.id+" cancelAllOrders() deletes all orders for user, it does not support filtering by symbol.");const i=await this.privateDeleteOrdersAll(t),s=this.safeValue(i,"payload",[]),r=[];for(let e=0;e<s.length;e++){const t=this.parseOrder(s[e]);r.push(t)}return r}parseOrderStatus(e){return this.safeString({"partial-fill":"open",completed:"closed"},e,e)}parseOrder(e,t){let i;i="string"==typeof e?e:this.safeString(e,"oid");const s=this.safeString(e,"side"),r=this.parseOrderStatus(this.safeString(e,"status")),a=this.safeString(e,"book"),n=this.safeSymbol(a,t,"_"),o=this.safeString(e,"type"),h=this.parse8601(this.safeString(e,"created_at")),d=this.safeString(e,"price"),c=this.safeString(e,"original_amount"),l=this.safeString(e,"unfilled_amount"),u=this.safeString(e,"client_id");return this.safeOrder({info:e,id:i,clientOrderId:u,timestamp:h,datetime:this.iso8601(h),lastTradeTimestamp:void 0,symbol:n,type:o,timeInForce:void 0,postOnly:void 0,side:s,price:d,stopPrice:void 0,triggerPrice:void 0,amount:c,cost:void 0,remaining:l,filled:void 0,status:r,fee:void 0,average:void 0,trades:void 0},t)}async fetchOpenOrders(e,t,i=25,s={}){await this.loadMarkets();const a=this.market(e),n="marker"in s;if(void 0!==t&&!n)throw new r(this.id+" fetchOpenOrders() does not support fetching orders starting from a timestamp with the `since` argument, use the `marker` extra param to filter starting from an integer trade id");n&&(s=this.extend(s,{marker:parseInt(s.marker)}));const o={book:a.id,limit:i},h=await this.privateGetOpenOrders(this.extend(o,s));return this.parseOrders(h.payload,a,t,i)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s=await this.privateGetOrdersOid({oid:e}),r=this.safeValue(s,"payload");if(Array.isArray(r)){if(1===s.payload.length)return this.parseOrder(r[0])}throw new o(this.id+": The order "+e+" not found.")}async fetchOrderTrades(e,t,i,s,r={}){await this.loadMarkets();const a=this.market(t),n={oid:e},o=await this.privateGetOrderTradesOid(this.extend(n,r));return this.parseTrades(o.payload,a)}async fetchDeposit(e,t,i={}){await this.loadMarkets();const s={fid:e},r=await this.privateGetFundingsFid(this.extend(s,i)),a=this.safeValue(r,"payload",[]),n=this.safeValue(a,0,{});return this.parseTransaction(n)}async fetchDeposits(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.currency(e));const a=await this.privateGetFundings(s),n=this.safeValue(a,"payload",[]);return this.parseTransactions(n,r,t,i,s)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={fund_currency:this.currency(e).id},s=await this.privateGetFundingDestination(this.extend(i,t));let r,a=this.safeString(s.payload,"account_identifier");if(a.indexOf("?dt=")>=0){const e=a.split("?dt=");a=this.safeString(e,0),r=this.safeString(e,1)}return this.checkAddress(a),{currency:e,address:a,tag:r,network:void 0,info:s}}async fetchTransactionFees(e,t={}){await this.loadMarkets();const i=await this.privateGetFees(t),s={},r=this.safeValue(i,"payload",{}),a=this.safeValue(r,"deposit_fees",[]);for(let t=0;t<a.length;t++){const i=a[t],r=this.safeString(i,"currency"),n=this.safeCurrencyCode(r);(void 0===e||this.inArray(n,e))&&(s[n]={deposit:this.safeNumber(i,"fee"),withdraw:void 0,info:{deposit:i,withdraw:void 0}})}const n=this.safeValue(r,"withdrawal_fees",[]),o=Object.keys(n);for(let t=0;t<o.length;t++){const i=o[t],r=this.safeCurrencyCode(i);(void 0===e||this.inArray(r,e))&&(s[r]={deposit:this.safeValue(s[r],"deposit"),withdraw:this.safeNumber(n,i),info:{deposit:this.safeValue(s[r].info,"deposit"),withdraw:this.safeNumber(n,i)}})}return s}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.privateGetFees(t),s=this.safeValue(i,"payload",{});return this.parseDepositWithdrawFees(s,e)}parseDepositWithdrawFees(e,t,i){const s={},r=this.safeValue(e,"deposit_fees",[]),a=this.safeValue(e,"withdrawal_fees",[]);for(let e=0;e<r.length;e++){const i=r[e],a=this.safeString(i,"currency"),n=this.safeCurrencyCode(a);(void 0===t||n in t)&&(s[n]={deposit:{fee:this.safeNumber(i,"fee"),percentage:!this.safeValue(i,"is_fixed")},withdraw:{fee:void 0,percentage:void 0},networks:{},info:i})}const n=Object.keys(a);for(let e=0;e<n.length;e++){const i=n[e],r=this.safeCurrencyCode(i);if(void 0===t||r in t){const e=this.parseNumber(a[i]);void 0===this.safeValue(s,r)&&(s[r]=this.depositWithdrawFee({})),s[r].withdraw.fee=e,s[r].info[r]=e}}return s}async withdraw(e,t,i,s,a={}){[s,a]=this.handleWithdrawTagAndParams(s,a),this.checkAddress(i),await this.loadMarkets();const n={BTC:"Bitcoin",ETH:"Ether",XRP:"Ripple",BCH:"Bcash",LTC:"Litecoin"},o=this.currency(e),h=e in n?n[e]:void 0;if(void 0===h)throw new r(this.id+" not valid withdraw coin: "+e);const d={amount:t,address:i,destination_tag:s},c="privatePost"+h+"Withdrawal",l=await this[c](this.extend(d,a)),u=this.safeValue(l,"payload",[]),f=this.safeValue(u,0);return this.parseTransaction(f,o)}safeNetwork(e){if(void 0===e)return;e=e.toUpperCase();return this.safeString({trx:"TRC20",erc20:"ERC20",bsc:"BEP20",bep2:"BEP2"},e,e)}parseTransaction(e,t){const i=this.safeString2(e,"currency","asset");t=this.safeCurrency(i,t);const s=this.safeValue(e,"details",{}),r=this.safeString(e,"created_at"),a=this.safeString(s,"withdrawal_address"),n=this.safeString(s,"receiving_address"),o=this.safeString2(e,"network","method"),h=this.safeString(e,"status"),d=this.safeString(e,"wid");return{id:this.safeString2(e,"wid","fid"),txid:this.safeString(s,"tx_hash"),timestamp:this.parse8601(r),datetime:r,network:this.safeNetwork(o),addressFrom:n,address:void 0!==a?a:n,addressTo:a,amount:this.safeString(e,"amount"),type:void 0===d?"deposit":"withdrawal",currency:this.safeCurrencyCode(i,t),status:this.parseTransactionStatus(h),updated:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,comment:void 0,fee:void 0,info:e}}parseTransactionStatus(e){return this.safeString({pending:"pending",in_progress:"pending",complete:"ok",failed:"failed"},e,e)}sign(e,t="public",i="GET",s={},r,a){let n="/"+this.version+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));"GET"!==i&&"DELETE"!==i||Object.keys(o).length&&(n+="?"+this.urlencode(o));const h=this.urls.api.rest+n;if("private"===t){this.checkRequiredCredentials();const e=this.nonce().toString();let t=[e,i,n].join("");"GET"!==i&&"DELETE"!==i&&Object.keys(o).length&&(t+=a=this.json(o));const s=this.hmac(this.encode(t),this.encode(this.secret));r={Authorization:"Bitso "+(this.apiKey+":"+e+":"+s),"Content-Type":"application/json"}}return{url:h,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0!==o&&"success"in o){let e=this.safeValue(o,"success",!1);if("string"==typeof e&&(e="true"===e||"1"===e),!e){const e=this.id+" "+this.json(o),t=this.safeValue(o,"error");if(void 0===t)throw new r(e);const i=this.safeString(t,"code");throw this.throwExactlyMatchedException(this.exceptions,i,e),new r(e)}}}}},7653:function(e,t,i){"use strict";const s=i(48819),{AuthenticationError:r,BadRequest:a,ExchangeError:n,NotSupported:o,PermissionDenied:h,InvalidNonce:d,OrderNotFound:c,InsufficientFunds:l,InvalidAddress:u,InvalidOrder:f,OnMaintenance:p,ExchangeNotAvailable:m}=i(73449),{TICK_SIZE:g}=i(62115),y=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitstamp",name:"Bitstamp",countries:["GB"],rateLimit:75,version:"v2",userAgent:this.userAgents.chrome,pro:!0,has:{CORS:!0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLedger:!0,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!0,fetchTransactionFees:!0,fetchTransactions:!0,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/27786377-8c8ab57e-5fe9-11e7-8ea4-2b05b6bcceec.jpg",api:{public:"https://www.bitstamp.net/api",private:"https://www.bitstamp.net/api"},www:"https://www.bitstamp.net",doc:"https://www.bitstamp.net/api"},timeframes:{"1m":"60","3m":"180","5m":"300","15m":"900","30m":"1800","1h":"3600","2h":"7200","4h":"14400","6h":"21600","12h":"43200","1d":"86400","1w":"259200"},requiredCredentials:{apiKey:!0,secret:!0},api:{public:{get:{"ohlc/{pair}/":1,"order_book/{pair}/":1,"ticker_hour/{pair}/":1,"ticker/{pair}/":1,"transactions/{pair}/":1,"trading-pairs-info/":1}},private:{post:{"balance/":1,"balance/{pair}/":1,"bch_withdrawal/":1,"bch_address/":1,"user_transactions/":1,"user_transactions/{pair}/":1,"open_orders/all/":1,"open_orders/{pair}/":1,"order_status/":1,"cancel_order/":1,"cancel_all_orders/":1,"cancel_all_orders/{pair}/":1,"buy/{pair}/":1,"buy/market/{pair}/":1,"buy/instant/{pair}/":1,"sell/{pair}/":1,"sell/market/{pair}/":1,"sell/instant/{pair}/":1,"transfer-to-main/":1,"transfer-from-main/":1,"withdrawal-requests/":1,"withdrawal/open/":1,"withdrawal/status/":1,"withdrawal/cancel/":1,"liquidation_address/new/":1,"liquidation_address/info/":1,"btc_unconfirmed/":1,"websockets_token/":1,"btc_withdrawal/":1,"btc_address/":1,"ripple_withdrawal/":1,"ripple_address/":1,"ltc_withdrawal/":1,"ltc_address/":1,"eth_withdrawal/":1,"eth_address/":1,"xrp_withdrawal/":1,"xrp_address/":1,"xlm_withdrawal/":1,"xlm_address/":1,"pax_withdrawal/":1,"pax_address/":1,"link_withdrawal/":1,"link_address/":1,"usdc_withdrawal/":1,"usdc_address/":1,"omg_withdrawal/":1,"omg_address/":1,"dai_withdrawal/":1,"dai_address/":1,"knc_withdrawal/":1,"knc_address/":1,"mkr_withdrawal/":1,"mkr_address/":1,"zrx_withdrawal/":1,"zrx_address/":1,"gusd_withdrawal/":1,"gusd_address/":1,"aave_withdrawal/":1,"aave_address/":1,"bat_withdrawal/":1,"bat_address/":1,"uma_withdrawal/":1,"uma_address/":1,"snx_withdrawal/":1,"snx_address/":1,"uni_withdrawal/":1,"uni_address/":1,"yfi_withdrawal/":1,yfi_address:1,"audio_withdrawal/":1,"audio_address/":1,"crv_withdrawal/":1,"crv_address/":1,"algo_withdrawal/":1,"algo_address/":1,"comp_withdrawal/":1,"comp_address/":1,grt_withdrawal:1,"grt_address/":1,"usdt_withdrawal/":1,"usdt_address/":1,"eurt_withdrawal/":1,"eurt_address/":1,"matic_withdrawal/":1,"matic_address/":1,"sushi_withdrawal/":1,"sushi_address/":1,"chz_withdrawal/":1,"chz_address/":1,"enj_withdrawal/":1,"enj_address/":1,"alpha_withdrawal/":1,"alpha_address/":1,"ftt_withdrawal/":1,"ftt_address/":1,"storj_withdrawal/":1,"storj_address/":1,"axs_withdrawal/":1,"axs_address/":1,"sand_withdrawal/":1,"sand_address/":1,"hbar_withdrawal/":1,"hbar_address/":1,"rgt_withdrawal/":1,"rgt_address/":1,"fet_withdrawal/":1,"fet_address/":1,"skl_withdrawal/":1,"skl_address/":1,"cel_withdrawal/":1,"cel_address/":1,"sxp_withdrawal/":1,"sxp_address/":1,"ada_withdrawal/":1,"ada_address/":1,"slp_withdrawal/":1,"slp_address/":1,"ftm_withdrawal/":1,"ftm_address/":1,"perp_withdrawal/":1,"perp_address/":1,"dydx_withdrawal/":1,"dydx_address/":1,"gala_withdrawal/":1,"gala_address/":1,"shib_withdrawal/":1,"shib_address/":1,"amp_withdrawal/":1,"amp_address/":1,"sgb_withdrawal/":1,"sgb_address/":1,"avax_withdrawal/":1,"avax_address/":1,"wbtc_withdrawal/":1,"wbtc_address/":1,"ctsi_withdrawal/":1,"ctsi_address/":1,"cvx_withdrawal/":1,"cvx_address/":1,"imx_withdrawal/":1,"imx_address/":1,"nexo_withdrawal/":1,"nexo_address/":1,"ust_withdrawal/":1,"ust_address/":1,"ant_withdrawal/":1,"ant_address/":1,"gods_withdrawal/":1,"gods_address/":1,"rad_withdrawal/":1,"rad_address/":1,"band_withdrawal/":1,"band_address/":1,"inj_withdrawal/":1,"inj_address/":1,"rly_withdrawal/":1,"rly_address/":1,"rndr_withdrawal/":1,"rndr_address/":1,"vega_withdrawal/":1,"vega_address/":1,"1inch_withdrawal/":1,"1inch_address/":1,"ens_withdrawal/":1,"ens_address/":1,"mana_withdrawal/":1,"mana_address/":1,"lrc_withdrawal/":1,"lrc_address/":1,"ape_withdrawal/":1,"ape_address/":1,"mpl_withdrawal/":1,"mpl_address/":1,"euroc_withdrawal/":1,"euroc_address/":1,"sol_withdrawal/":1,"sol_address/":1,"dot_withdrawal/":1,"dot_address/":1,"near_withdrawal/":1,"near_address/":1,"doge_withdrawal/":1,"doge_address/":1,"flr_withdrawal/":1,"flr_address/":1}}},fees:{trading:{tierBased:!0,percentage:!0,taker:this.parseNumber("0.005"),maker:this.parseNumber("0.005"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.005")],[this.parseNumber("20000"),this.parseNumber("0.0025")],[this.parseNumber("100000"),this.parseNumber("0.0024")],[this.parseNumber("200000"),this.parseNumber("0.0022")],[this.parseNumber("400000"),this.parseNumber("0.0020")],[this.parseNumber("600000"),this.parseNumber("0.0015")],[this.parseNumber("1000000"),this.parseNumber("0.0014")],[this.parseNumber("2000000"),this.parseNumber("0.0013")],[this.parseNumber("4000000"),this.parseNumber("0.0012")],[this.parseNumber("20000000"),this.parseNumber("0.0011")],[this.parseNumber("50000000"),this.parseNumber("0.0010")],[this.parseNumber("100000000"),this.parseNumber("0.0007")],[this.parseNumber("500000000"),this.parseNumber("0.0005")],[this.parseNumber("2000000000"),this.parseNumber("0.0003")],[this.parseNumber("6000000000"),this.parseNumber("0.0001")],[this.parseNumber("20000000000"),this.parseNumber("0.00005")],[this.parseNumber("20000000001"),this.parseNumber("0")]],maker:[[this.parseNumber("0"),this.parseNumber("0.005")],[this.parseNumber("20000"),this.parseNumber("0.0025")],[this.parseNumber("100000"),this.parseNumber("0.0024")],[this.parseNumber("200000"),this.parseNumber("0.0022")],[this.parseNumber("400000"),this.parseNumber("0.0020")],[this.parseNumber("600000"),this.parseNumber("0.0015")],[this.parseNumber("1000000"),this.parseNumber("0.0014")],[this.parseNumber("2000000"),this.parseNumber("0.0013")],[this.parseNumber("4000000"),this.parseNumber("0.0012")],[this.parseNumber("20000000"),this.parseNumber("0.0011")],[this.parseNumber("50000000"),this.parseNumber("0.0010")],[this.parseNumber("100000000"),this.parseNumber("0.0007")],[this.parseNumber("500000000"),this.parseNumber("0.0005")],[this.parseNumber("2000000000"),this.parseNumber("0.0003")],[this.parseNumber("6000000000"),this.parseNumber("0.0001")],[this.parseNumber("20000000000"),this.parseNumber("0.00005")],[this.parseNumber("20000000001"),this.parseNumber("0")]]}},funding:{tierBased:!1,percentage:!1,withdraw:{},deposit:{BTC:0,BCH:0,LTC:0,ETH:0,XRP:0,XLM:0,PAX:0,USD:7.5,EUR:0}}},precisionMode:g,commonCurrencies:{UST:"USTC"},exceptions:{exact:{"No permission found":h,"API key not found":r,"IP address not allowed":h,"Invalid nonce":d,"Invalid signature":r,"Authentication failed":r,"Missing key, signature and nonce parameters":r,"Wrong API key format":r,"Your account is frozen":h,"Please update your profile with your FATCA information, before using API.":h,"Order not found.":c,"Price is more than 20% below market price.":f,"Bitstamp.net is under scheduled maintenance. We'll be back soon.":p,"Order could not be placed.":m,"Invalid offset.":a},broad:{"Minimum order size is":f,"Check your account balance for details.":l,"Ensure this value has at least":u,"Ensure that there are no more than":f}}})}async fetchMarkets(e={}){const t=await this.fetchMarketsFromCache(e),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"name");let[a,n]=r.split("/");const o=a.toLowerCase(),h=n.toLowerCase();a=this.safeCurrencyCode(a),n=this.safeCurrencyCode(n);const d=this.safeString(s,"minimum_order").split(" "),c=this.safeString(s,"trading");i.push({id:this.safeString(s,"url_symbol"),marketId:o+"_"+h,symbol:a+"/"+n,base:a,quote:n,settle:void 0,baseId:o,quoteId:h,settleId:void 0,type:"spot",spot:!0,margin:!1,future:!1,swap:!1,option:!1,active:"Enabled"===c,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(s,"base_decimals"))),price:this.parseNumber(this.parsePrecision(this.safeString(s,"counter_decimals")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(d,0),max:void 0}},info:s})}return i}constructCurrencyObject(e,t,i,s,r,a){let n="crypto";const o=this.describe();this.isFiat(t)&&(n="fiat");const h=this.parseNumber(this.parsePrecision(this.numberToString(s)));return{id:e,code:t,info:a,type:n,name:i,active:!0,deposit:void 0,withdraw:void 0,fee:this.safeNumber(o.fees.funding.withdraw,t),precision:h,limits:{amount:{min:h,max:void 0},price:{min:h,max:void 0},cost:{min:r,max:void 0},withdraw:{min:void 0,max:void 0}}}}async fetchMarketsFromCache(e={}){const t=this.safeValue(this.options,"fetchMarkets",{}),i=this.safeInteger(t,"timestamp"),s=this.safeInteger(t,"expires",1e3),r=this.milliseconds();if(void 0===i||r-i>s){const i=await this.publicGetTradingPairsInfo(e);this.options.fetchMarkets=this.extend(t,{response:i,timestamp:r})}return this.safeValue(this.options.fetchMarkets,"response")}async fetchCurrencies(e={}){const t=await this.fetchMarketsFromCache(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"name");let[a,n]=r.split("/");const o=a.toLowerCase(),h=n.toLowerCase();a=this.safeCurrencyCode(a),n=this.safeCurrencyCode(n);const d=this.safeString(s,"description"),[c,l]=d.split(" / "),u=this.safeString(s,"minimum_order").split(" ")[0];if(!(a in i)){const e=this.safeInteger(s,"base_decimals");i[a]=this.constructCurrencyObject(o,a,c,e,void 0,s)}if(!(n in i)){const e=this.safeInteger(s,"counter_decimals");i[n]=this.constructCurrencyObject(h,n,l,e,this.parseNumber(u),s)}}return i}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={pair:s.id},a=await this.publicGetOrderBookPair(this.extend(r,i)),n=this.safeInteger(a,"microtimestamp"),o=parseInt(n/1e3),h=this.parseOrderBook(a,s.symbol,o);return h.nonce=n,h}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.safeTimestamp(e,"timestamp"),r=this.safeString(e,"vwap"),a=this.safeString(e,"volume"),n=y.stringMul(a,r),o=this.safeString(e,"last");return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:r,open:this.safeString(e,"open"),close:o,last:o,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:a,quoteVolume:n,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={pair:i.id},r=await this.publicGetTickerPair(this.extend(s,t));return this.parseTicker(r,i)}getCurrencyIdFromTransaction(e){const t=this.safeStringLower(e,"currency");if(void 0!==t)return t;e=this.omit(e,["fee","price","datetime","type","status","id"]);const i=Object.keys(e);for(let t=0;t<i.length;t++){const s=i[t];if(s.indexOf("_")<0){const t=this.safeNumber(e,s);if(void 0!==t&&0!==t)return s}}}getMarketFromTrade(e){e=this.omit(e,["fee","price","datetime","tid","type","order_id","side"]);const t=Object.keys(e),i=t.length;if(i>2)throw new n(this.id+" getMarketFromTrade() too many keys: "+this.json(t)+" in the trade: "+this.json(e));if(2===i){let e=t[0]+t[1];if(e in this.markets_by_id)return this.safeMarket(e);if(e=t[1]+t[0],e in this.markets_by_id)return this.safeMarket(e)}}parseTrade(e,t){const i=this.safeString2(e,"id","tid");let s,r,a=this.safeString(e,"price"),n=this.safeString(e,"amount");const o=this.safeString(e,"order_id");let h,d=this.safeString(e,"cost");if(void 0===t){const i=Object.keys(e);for(let e=0;e<i.length;e++){const s=i[e];"order_id"!==s&&s.indexOf("_")>=0&&(h=s,t=this.safeMarket(h,t,"_"))}}void 0===t&&(t=this.getMarketFromTrade(e));const c=this.safeString(e,"fee"),l=t.quote;a=this.safeString(e,h,a),n=this.safeString(e,t.baseId,n),d=this.safeString(e,t.quoteId,d),s=t.symbol;const u=this.safeString2(e,"date","datetime");let f,p;if(void 0!==u&&(u.indexOf(" ")>=0?f=this.parse8601(u):(f=parseInt(u),f*=1e3)),"id"in e){if(void 0!==n){y.stringLt(n,"0")?(r="sell",n=y.stringNeg(n)):r="buy"}}else r=this.safeString(e,"type"),r="1"===r?"sell":"0"===r?"buy":void 0;return void 0!==d&&(d=y.stringAbs(d)),void 0!==c&&(p={cost:c,currency:l}),this.safeTrade({id:i,info:e,timestamp:f,datetime:this.iso8601(f),symbol:s,order:o,type:undefined,side:r,takerOrMaker:void 0,price:a,amount:n,cost:d,fee:p},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pair:r.id,time:"hour"},n=await this.publicGetTransactionsPair(this.extend(a,s));return this.parseTrades(n,r,t,i)}parseOHLCV(e,t){return[this.safeTimestamp(e,"timestamp"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={pair:a.id,step:this.safeString(this.timeframes,t,t)},o=this.parseTimeframe(t);if(void 0===s)if(void 0===i)n.limit=1e3;else{s=1e3;const e=parseInt(i/1e3);n.start=e,n.end=this.sum(e,s*o),n.limit=s}else{if(void 0!==i){const e=parseInt(i/1e3);n.start=e,n.end=this.sum(e,s*o)}n.limit=Math.min(s,1e3)}const h=await this.publicGetOhlcPair(this.extend(n,r)),d=this.safeValue(h,"data",{}),c=this.safeValue(d,"ohlc",[]);return this.parseOHLCVs(c,a,t,i,s)}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0},i=Object.keys(this.currencies);for(let s=0;s<i.length;s++){const r=i[s],a=this.currency(r).id,n=this.account();n.free=this.safeString(e,a+"_available"),n.used=this.safeString(e,a+"_reserved"),n.total=this.safeString(e,a+"_balance"),t[r]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostBalance(e);return this.parseBalance(t)}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={pair:i.id},r=await this.privatePostBalancePair(this.extend(s,t));return this.parseTradingFee(r,i)}parseTradingFee(e,t){t=this.safeMarket(void 0,t);const i=this.safeString(e,t.id+"_fee"),s=y.stringDiv(i,"100"),r=this.parseNumber(s);return{info:e,symbol:t.symbol,maker:r,taker:r}}parseTradingFees(e){const t={info:e},i=this.symbols;for(let s=0;s<i.length;s++){const r=i[s],a=this.market(r),n=this.parseTradingFee(e,a);t[r]=n}return t}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privatePostBalance(e);return this.parseTradingFees(t)}async fetchTransactionFees(e,t={}){await this.loadMarkets();const i=await this.privatePostBalance(t);return this.parseTransactionFees(i,e)}parseTransactionFees(e,t){void 0===t&&(t=Object.keys(this.currencies));const i={};let s;const r=Object.keys(e);for(let a=0;a<r.length;a++){const n=r[a],o=n.split("_")[0],h=this.safeCurrencyCode(o);(void 0===t||this.inArray(h,t))&&(n.indexOf("_available")>=0&&(s=o,i[h]={deposit:void 0,withdraw:void 0,info:{}}),o===s&&(i[h].info[n]=this.safeNumber(e,n)),n.indexOf("_withdrawal_fee")>=0&&(i[h].withdraw=this.safeNumber(e,n)))}return i}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.privatePostBalance(t);return this.parseDepositWithdrawFees(i,e)}parseDepositWithdrawFees(e,t,i){const s={},r=Object.keys(e);for(let i=0;i<r.length;i++){const a=r[i],n=a.split("_")[0],o=this.safeCurrencyCode(n),h=this.safeNumber(e,a);if(void 0!==t&&!this.inArray(o,t))continue;a.indexOf("_available")>=0&&(s[o]=this.depositWithdrawFee({})),a.indexOf("_withdrawal_fee")>=0&&(s[o].withdraw.fee=h);void 0!==this.safeValue(s,o)&&(s[o].info[a]=h)}return s}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);let o="privatePost"+this.capitalize(i);const h={pair:n.id,amount:this.amountToPrecision(e,s)};"market"===t?o+="Market":"instant"===t?o+="Instant":h.price=this.priceToPrecision(e,r),o+="Pair";const d=this.safeString2(a,"client_order_id","clientOrderId");void 0!==d&&(h.client_order_id=d,a=this.omit(a,["client_order_id","clientOrderId"]));const c=await this[o](this.extend(h,a)),l=this.parseOrder(c,n);return this.extend(l,{type:t})}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={id:e};return await this.privatePostCancelOrder(this.extend(s,i))}async cancelAllOrders(e,t={}){let i;await this.loadMarkets();const s={};let r="privatePostCancelAllOrders";return void 0!==e&&(i=this.market(e),s.pair=i.id,r="privatePostCancelAllOrdersPair"),await this[r](this.extend(s,t))}parseOrderStatus(e){return this.safeString({"In Queue":"open",Open:"open",Finished:"closed",Canceled:"canceled"},e,e)}async fetchOrderStatus(e,t,i={}){await this.loadMarkets();const s=this.safeValue2(i,"client_order_id","clientOrderId"),r={};void 0!==s?(r.client_order_id=s,i=this.omit(i,["client_order_id","clientOrderId"])):r.id=e;const a=await this.privatePostOrderStatus(this.extend(r,i));return this.parseOrderStatus(this.safeString(a,"status"))}async fetchOrder(e,t,i={}){let s;await this.loadMarkets(),void 0!==t&&(s=this.market(t));const r=this.safeValue2(i,"client_order_id","clientOrderId"),a={};void 0!==r?(a.client_order_id=r,i=this.omit(i,["client_order_id","clientOrderId"])):a.id=e;const n=await this.privatePostOrderStatus(this.extend(a,i));return this.parseOrder(n,s)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a,n="privatePostUserTransactions";void 0!==e&&(a=this.market(e),r.pair=a.id,n+="Pair"),void 0!==i&&(r.limit=i);const o=await this[n](this.extend(r,s)),h=this.filterBy(o,"type","2");return this.parseTrades(h,a,t,i)}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();const r={};void 0!==i&&(r.limit=i);const a=await this.privatePostUserTransactions(this.extend(r,s));let n;void 0!==e&&(n=this.currency(e));const o=this.filterByArray(a,"type",["0","1"],!1);return this.parseTransactions(o,n,t,i)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};r.timedelta=void 0!==t?this.milliseconds()-t:5e7;const a=await this.privatePostWithdrawalRequests(this.extend(r,s));return this.parseTransactions(a,void 0,t,i)}parseTransaction(e,t){const i=this.parse8601(this.safeString(e,"datetime")),s=this.getCurrencyIdFromTransaction(e),r=this.safeCurrencyCode(s,t),a=this.safeString(e,"fee");let n,o;"amount"in e?o=this.safeString(e,"amount"):void 0!==t?(o=this.safeString(e,t.id,o),n=t.code):void 0!==r&&void 0!==s&&(o=this.safeString(e,s,o),n=r),void 0!==o&&(o=y.stringAbs(o));let h,d,c="ok";if("status"in e&&(c=this.parseTransactionStatus(this.safeString(e,"status"))),"type"in e){const t=this.safeString(e,"type");"0"===t?h="deposit":"1"===t&&(h="withdrawal")}else h="withdrawal";let l=this.safeString(e,"address");if(void 0!==l){const e=l.split("?dt=");e.length>1&&(l=e[0],d=e[1])}let u={currency:void 0,cost:void 0,rate:void 0};return void 0!==a&&(u={currency:n,cost:a,rate:void 0}),{info:e,id:this.safeString(e,"id"),txid:this.safeString(e,"transaction_id"),type:h,currency:r,network:void 0,amount:this.parseNumber(o),status:c,timestamp:i,datetime:this.iso8601(i),address:l,addressFrom:void 0,addressTo:l,tag:d,tagFrom:void 0,tagTo:d,updated:void 0,comment:void 0,fee:u}}parseTransactionStatus(e){return this.safeString({0:"pending",1:"pending",2:"ok",3:"canceled",4:"failed"},e,e)}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"client_order_id");let r=this.safeString(e,"type");void 0!==r&&(r="1"===r?"sell":"buy");const a=this.parse8601(this.safeString(e,"datetime")),n=this.safeStringLower(e,"currency_pair"),o=this.safeSymbol(n,t,"/"),h=this.parseOrderStatus(this.safeString(e,"status")),d=this.safeString(e,"amount"),c=this.safeValue(e,"transactions",[]),l=this.safeString(e,"price");return this.safeOrder({id:i,clientOrderId:s,datetime:this.iso8601(a),timestamp:a,lastTradeTimestamp:void 0,status:h,symbol:o,type:void 0,timeInForce:void 0,postOnly:void 0,side:r,price:l,stopPrice:void 0,triggerPrice:void 0,cost:void 0,amount:d,filled:void 0,remaining:void 0,trades:c,fee:void 0,info:e,average:void 0},t)}parseLedgerEntryType(e){return this.safeString({0:"transaction",1:"transaction",2:"trade",14:"transfer"},e,e)}parseLedgerEntry(e,t){const i=this.parseLedgerEntryType(this.safeString(e,"type"));if("trade"===i){const t=this.parseTrade(e);let s;const r=Object.keys(e);for(let e=0;e<r.length;e++)if(r[e].indexOf("_")>=0){const t=r[e].replace("_","");s=this.safeMarket(t,s)}void 0===s&&(s=this.getMarketFromTrade(e));const a="buy"===t.side?"in":"out";return{id:t.id,info:e,timestamp:t.timestamp,datetime:t.datetime,direction:a,account:void 0,referenceId:t.order,referenceAccount:void 0,type:i,currency:s.base,amount:t.amount,before:void 0,after:void 0,status:"ok",fee:t.fee}}{const s=this.parseTransaction(e,t);let r;if("amount"in e){const t=this.safeString(e,"amount");r=y.stringGt(t,"0")?"in":"out"}else if("currency"in s&&void 0!==s.currency){const i=this.safeString(s,"currency");t=this.currency(i);const a=this.safeString(e,t.id);r=y.stringGt(a,"0")?"in":"out"}return{id:s.id,info:e,timestamp:s.timestamp,datetime:s.datetime,direction:r,account:void 0,referenceId:s.txid,referenceAccount:void 0,type:i,currency:s.currency,amount:s.amount,before:void 0,after:void 0,status:s.status,fee:s.fee}}}async fetchLedger(e,t,i,s={}){await this.loadMarkets();const r={};void 0!==i&&(r.limit=i);const a=await this.privatePostUserTransactions(this.extend(r,s));let n;return void 0!==e&&(n=this.currency(e)),this.parseLedger(a,n,t,i)}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e));const a=await this.privatePostOpenOrdersAll(s);return this.parseOrders(a,r,t,i,{status:"open",type:"limit"})}getCurrencyName(e){return e.toLowerCase()}isFiat(e){return"USD"===e||"EUR"===e||"GBP"===e}async fetchDepositAddress(e,t={}){if(this.isFiat(e))throw new o(this.id+" fiat fetchDepositAddress() for "+e+" is not supported!");const i=this.getCurrencyName(e),s="privatePost"+this.capitalize(i)+"Address",r=await this[s](t),a=this.safeString(r,"address"),n=this.safeString2(r,"memo_id","destination_tag");return this.checkAddress(a),{currency:e,address:a,tag:n,network:void 0,info:r}}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets(),this.checkAddress(i);const a={amount:t};let n,o;if(this.isFiat(e))o="privatePostWithdrawalOpen",n=this.currency(e),a.iban=i,a.account_currency=n.id;else{const t=this.getCurrencyName(e);o="privatePost"+this.capitalize(t)+"Withdrawal","XRP"===e?void 0!==s&&(a.destination_tag=s):"XLM"!==e&&"HBAR"!==e||void 0!==s&&(a.memo_id=s),a.address=i}const h=await this[o](this.extend(a,r));return this.parseTransaction(h,n)}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t]+"/";n+=this.version+"/",n+=this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if("public"===t)Object.keys(o).length&&(n+="?"+this.urlencode(o));else{this.checkRequiredCredentials();const e="BITSTAMP "+this.apiKey,t=this.uuid(),s=this.milliseconds().toString(),h="v2";let d="";r={"X-Auth":e,"X-Auth-Nonce":t,"X-Auth-Timestamp":s,"X-Auth-Version":h},"POST"===i&&(Object.keys(o).length?(a=this.urlencode(o),d="application/x-www-form-urlencoded",r["Content-Type"]=d):(a=this.urlencode({foo:"bar"}),d="application/x-www-form-urlencoded",r["Content-Type"]=d));const c=a||"",l=e+i+n.replace("https://","")+d+t+s+h+c,u=this.hmac(this.encode(l),this.encode(this.secret));r["X-Auth-Signature"]=u}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,o,h,d,c){if(void 0===h)return;const l=this.safeString(h,"status"),u=this.safeValue(h,"error");if("error"===l||void 0!==u){let e=[];if("string"==typeof u)e.push(u);else if(void 0!==u){const t=Object.keys(u);for(let i=0;i<t.length;i++){const s=t[i],r=this.safeValue(u,s);Array.isArray(r)?e=this.arrayConcat(e,r):e.push(r)}}const t=this.safeValue(h,"reason",{});if("string"==typeof t)e.push(t);else{const i=this.safeValue(t,"__all__",[]);for(let t=0;t<i.length;t++)e.push(i[t])}if("API0005"===this.safeString(h,"code"))throw new r(this.id+" invalid signature, use the uid for the main account if you have subaccounts");const i=this.id+" "+o;for(let t=0;t<e.length;t++){const s=e[t];this.throwExactlyMatchedException(this.exceptions.exact,s,i),this.throwBroadlyMatchedException(this.exceptions.broad,s,i)}throw new n(i)}}}},12554:function(e,t,i){"use strict";const s=i(48819),{BadSymbol:r,ExchangeError:a}=i(73449),{TICK_SIZE:n}=i(62115),o=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitstamp1",name:"Bitstamp",countries:["GB"],rateLimit:1e3,version:"v1",has:{CORS:!0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOpenInterestHistory:!1,fetchOrder:!1,fetchOrderBook:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1},urls:{logo:"https://user-images.githubusercontent.com/1294454/27786377-8c8ab57e-5fe9-11e7-8ea4-2b05b6bcceec.jpg",api:{rest:"https://www.bitstamp.net/api"},www:"https://www.bitstamp.net",doc:"https://www.bitstamp.net/api"},requiredCredentials:{apiKey:!0,secret:!0,uid:!0},api:{public:{get:["ticker","ticker_hour","order_book","transactions","eur_usd"]},private:{post:["balance","user_transactions","open_orders","order_status","cancel_order","cancel_all_orders","buy","sell","bitcoin_deposit_address","unconfirmed_btc","ripple_withdrawal","ripple_address","withdrawal_requests","bitcoin_withdrawal"]}},precisionMode:n,markets:{"BTC/USD":{id:"btcusd",symbol:"BTC/USD",base:"BTC",quote:"USD",baseId:"btc",quoteId:"usd",maker:.005,taker:.005,type:"spot",spot:!0},"BTC/EUR":{id:"btceur",symbol:"BTC/EUR",base:"BTC",quote:"EUR",baseId:"btc",quoteId:"eur",maker:.005,taker:.005,type:"spot",spot:!0},"EUR/USD":{id:"eurusd",symbol:"EUR/USD",base:"EUR",quote:"USD",baseId:"eur",quoteId:"usd",maker:.005,taker:.005,type:"spot",spot:!0},"XRP/USD":{id:"xrpusd",symbol:"XRP/USD",base:"XRP",quote:"USD",baseId:"xrp",quoteId:"usd",maker:.005,taker:.005,type:"spot",spot:!0},"XRP/EUR":{id:"xrpeur",symbol:"XRP/EUR",base:"XRP",quote:"EUR",baseId:"xrp",quoteId:"eur",maker:.005,taker:.005,type:"spot",spot:!0},"XRP/BTC":{id:"xrpbtc",symbol:"XRP/BTC",base:"XRP",quote:"BTC",baseId:"xrp",quoteId:"btc",maker:.005,taker:.005,type:"spot",spot:!0},"LTC/USD":{id:"ltcusd",symbol:"LTC/USD",base:"LTC",quote:"USD",baseId:"ltc",quoteId:"usd",maker:.005,taker:.005,type:"spot",spot:!0},"LTC/EUR":{id:"ltceur",symbol:"LTC/EUR",base:"LTC",quote:"EUR",baseId:"ltc",quoteId:"eur",maker:.005,taker:.005,type:"spot",spot:!0},"LTC/BTC":{id:"ltcbtc",symbol:"LTC/BTC",base:"LTC",quote:"BTC",baseId:"ltc",quoteId:"btc",maker:.005,taker:.005,type:"spot",spot:!0},"ETH/USD":{id:"ethusd",symbol:"ETH/USD",base:"ETH",quote:"USD",baseId:"eth",quoteId:"usd",maker:.005,taker:.005,type:"spot",spot:!0},"ETH/EUR":{id:"etheur",symbol:"ETH/EUR",base:"ETH",quote:"EUR",baseId:"eth",quoteId:"eur",maker:.005,taker:.005,type:"spot",spot:!0},"ETH/BTC":{id:"ethbtc",symbol:"ETH/BTC",base:"ETH",quote:"BTC",baseId:"eth",quoteId:"btc",maker:.005,taker:.005,type:"spot",spot:!0}}})}async fetchOrderBook(e,t,i={}){if("BTC/USD"!==e)throw new a(this.id+" "+this.version+" fetchOrderBook doesn't support "+e+", use it for BTC/USD only");await this.loadMarkets();const s=await this.publicGetOrderBook(i),r=this.safeTimestamp(s,"timestamp");return this.parseOrderBook(s,e,r)}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.safeTimestamp(e,"timestamp"),r=this.safeString(e,"vwap"),a=this.safeString(e,"volume"),n=o.stringMul(a,r),h=this.safeString(e,"last");return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:r,open:this.safeString(e,"open"),close:h,last:h,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:a,quoteVolume:n,info:e},t)}async fetchTicker(e,t={}){if("BTC/USD"!==e)throw new a(this.id+" "+this.version+" fetchTicker doesn't support "+e+", use it for BTC/USD only");await this.loadMarkets();const i=this.market(e),s=await this.publicGetTicker(t);return this.parseTicker(s,i)}parseTrade(e,t){const i=this.safeTimestamp2(e,"date","datetime"),s=0===e.type?"buy":"sell",r=this.safeString(e,"order_id"),a=this.safeString(e,"tid"),n=this.safeString(e,"price"),o=this.safeString(e,"amount"),h=this.safeString(e,"currency_pair");return t=this.safeMarket(h,t),this.safeTrade({id:a,info:e,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,order:r,type:void 0,side:s,takerOrMaker:void 0,price:n,amount:o,cost:void 0,fee:void 0},t)}async fetchTrades(e,t,i,s={}){if("BTC/USD"!==e)throw new r(this.id+" "+this.version+" fetchTrades doesn't support "+e+", use it for BTC/USD only");await this.loadMarkets();const a=this.market(e),n=await this.publicGetTransactions(this.extend({time:"minute"},s));return this.parseTrades(n,a,t,i)}parseBalance(e){const t={info:e},i=Object.keys(this.currencies);for(let s=0;s<i.length;s++){const r=i[s],a=this.currency(r).id,n=this.account();n.free=this.safeString(e,a+"_available"),n.used=this.safeString(e,a+"_reserved"),n.total=this.safeString(e,a+"_balance"),t[r]=n}return this.safeBalance(t)}async fetchBalance(e={}){const t=await this.privatePostBalance(e);return this.parseBalance(t)}async createOrder(e,t,i,s,r,n={}){if("limit"!==t)throw new a(this.id+" "+this.version+" accepts limit orders only");if("BTC/USD"!==e)throw new a(this.id+" v1 supports BTC/USD orders only");await this.loadMarkets();const o="privatePost"+this.capitalize(i),h={amount:s,price:r},d=await this[o](this.extend(h,n));return{info:d,id:this.safeString(d,"id")}}async cancelOrder(e,t,i={}){return await this.privatePostCancelOrder({id:e})}parseOrderStatus(e){return this.safeString({"In Queue":"open",Open:"open",Finished:"closed",Canceled:"canceled"},e,e)}async fetchOrderStatus(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privatePostOrderStatus(this.extend(s,i));return this.parseOrderStatus(r)}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e));const a={id:r?r.id:"all"},n=await this.privatePostOpenOrdersId(this.extend(a,s));return this.parseTrades(n,r,t,i)}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+this.implodeParams(e,s),o=this.omit(s,this.extractParams(e));if("public"===t)Object.keys(o).length&&(n+="?"+this.urlencode(o));else{this.checkRequiredCredentials();const e=this.nonce().toString(),t=e+this.uid+this.apiKey,i=this.encode(this.hmac(this.encode(t),this.encode(this.secret)));o=this.extend({key:this.apiKey,signature:i.toUpperCase(),nonce:e},o),a=this.urlencode(o),r={"Content-Type":"application/x-www-form-urlencoded"}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,n,o,h,d){if(void 0===o)return;if("error"===this.safeString(o,"status"))throw new a(this.id+" "+this.json(o))}}},9461:function(e,t,i){"use strict";const s=i(48819),{ArgumentsRequired:r,BadSymbol:a,ExchangeError:n,ExchangeNotAvailable:o,AuthenticationError:h,InvalidOrder:d,InsufficientFunds:c,OrderNotFound:l,DDoSProtection:u,PermissionDenied:f,AddressPending:p,OnMaintenance:m,BadRequest:g,InvalidAddress:y}=i(73449),{TRUNCATE:b,TICK_SIZE:v}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bittrex",name:"Bittrex",countries:["US"],version:"v3",rateLimit:1500,certified:!1,pro:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelAllOrders:!0,cancelOrder:!0,createDepositAddress:!0,createMarketOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchBalance:!0,fetchBidsAsks:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposit:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderTrades:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!0,fetchTransactionFees:void 0,fetchTransactions:!1,fetchWithdrawal:!0,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,withdraw:!0},timeframes:{"1m":"MINUTE_1","5m":"MINUTE_5","1h":"HOUR_1","1d":"DAY_1"},hostname:"bittrex.com",urls:{logo:"https://user-images.githubusercontent.com/51840849/87153921-edf53180-c2c0-11ea-96b9-f2a9a95a455b.jpg",api:{public:"https://api.bittrex.com",private:"https://api.bittrex.com"},www:"https://bittrex.com",doc:["https://bittrex.github.io/api/v3"],fees:["https://bittrex.zendesk.com/hc/en-us/articles/115003684371-BITTREX-SERVICE-FEES-AND-WITHDRAWAL-LIMITATIONS","https://bittrex.zendesk.com/hc/en-us/articles/115000199651-What-fees-does-Bittrex-charge-"],referral:"https://bittrex.com/Account/Register?referralCode=1ZE-G0G-M3B"},api:{public:{get:["ping","currencies","currencies/{symbol}","markets","markets/tickers","markets/summaries","markets/{marketSymbol}","markets/{marketSymbol}/summary","markets/{marketSymbol}/orderbook","markets/{marketSymbol}/trades","markets/{marketSymbol}/ticker","markets/{marketSymbol}/candles/{candleInterval}/recent","markets/{marketSymbol}/candles/{candleInterval}/historical/{year}/{month}/{day}","markets/{marketSymbol}/candles/{candleInterval}/historical/{year}/{month}","markets/{marketSymbol}/candles/{candleInterval}/historical/{year}"]},private:{get:["account","account/fees/fiat","account/fees/fiat/{currencySymbol}","account/fees/trading","account/fees/trading/{marketSymbol}","account/volume","account/permissions/markets","account/permissions/markets/{marketSymbol}","account/permissions/currencies","account/permissions/currencies/{currencySymbol}","addresses","addresses/{currencySymbol}","balances","balances/{currencySymbol}","deposits/open","deposits/closed","deposits/ByTxId/{txId}","deposits/{depositId}","executions","executions/last-id","executions/{executionId}","orders/closed","orders/open","orders/{orderId}","orders/{orderId}/executions","ping","subaccounts/{subaccountId}","subaccounts","subaccounts/withdrawals/open","subaccounts/withdrawals/closed","subaccounts/deposits/open","subaccounts/deposits/closed","withdrawals/open","withdrawals/closed","withdrawals/ByTxId/{txId}","withdrawals/{withdrawalId}","withdrawals/allowed-addresses","conditional-orders/{conditionalOrderId}","conditional-orders/closed","conditional-orders/open","transfers/sent","transfers/received","transfers/{transferId}","funds-transfer-methods/{fundsTransferMethodId}"],post:["addresses","orders","subaccounts","withdrawals","conditional-orders","transfers","batch"],delete:["orders/open","orders/{orderId}","withdrawals/{withdrawalId}","conditional-orders/{conditionalOrderId}"]}},fees:{trading:{tierBased:!0,percentage:!0,maker:this.parseNumber("0.0075"),taker:this.parseNumber("0.0075")},funding:{tierBased:!1,percentage:!1}},precisionMode:v,exceptions:{exact:{BAD_REQUEST:g,STARTDATE_OUT_OF_RANGE:g,APISIGN_NOT_PROVIDED:h,APIKEY_INVALID:h,INVALID_SIGNATURE:h,INVALID_CURRENCY:n,INVALID_PERMISSION:h,INSUFFICIENT_FUNDS:c,INVALID_CEILING_MARKET_BUY:d,INVALID_FIAT_ACCOUNT:d,INVALID_ORDER_TYPE:d,QUANTITY_NOT_PROVIDED:d,MIN_TRADE_REQUIREMENT_NOT_MET:d,NOT_FOUND:l,ORDER_NOT_OPEN:l,INVALID_ORDER:d,UUID_INVALID:l,RATE_NOT_PROVIDED:d,INVALID_MARKET:a,WHITELIST_VIOLATION_IP:f,DUST_TRADE_DISALLOWED_MIN_VALUE:d,RESTRICTED_MARKET:a,"We are down for scheduled maintenance, but we’ll be back up shortly.":m},broad:{throttled:u,problem:o}},options:{fetchTicker:{method:"publicGetMarketsMarketSymbolTicker"},fetchTickers:{method:"publicGetMarketsTickers"},fetchDeposits:{status:"ok"},fetchWithdrawals:{status:"ok"},parseOrderStatus:!1,hasAlreadyAuthenticatedSuccessfully:!1,subaccountId:void 0,fetchClosedOrdersFilterBySince:!0},commonCurrencies:{BIFI:"Bifrost Finance",BTR:"BTRIPS",GMT:"GMT Token",MEME:"Memetic",MER:"Mercury",PROS:"Pros.Finance",REPV2:"REP",TON:"Tokamak Network"}})}feeToPrecision(e,t){return this.decimalToPrecision(t,b,this.markets[e].precision.price,this.precisionMode)}async fetchMarkets(e={}){const t=await this.publicGetMarkets(e),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"baseCurrencySymbol"),a=this.safeString(s,"quoteCurrencySymbol"),n=this.safeCurrencyCode(r),o=this.safeCurrencyCode(a),h=this.safeString(s,"status");i.push({id:this.safeString(s,"symbol"),symbol:n+"/"+o,base:n,quote:o,settle:void 0,baseId:r,quoteId:a,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:"ONLINE"===h,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber("1e-8"),price:this.parseNumber(this.parsePrecision(this.safeString(s,"precision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(s,"minTradeSize"),max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:s})}return i}parseBalance(e){const t={info:e},i=this.indexBy(e,"currencySymbol"),s=Object.keys(i);for(let e=0;e<s.length;e++){const r=s[e],a=this.safeCurrencyCode(r),n=this.account(),o=i[r];n.free=this.safeString(o,"available"),n.total=this.safeString(o,"total"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetBalances(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={marketSymbol:s.id};if(void 0!==t){if(1!==t&&25!==t&&500!==t)throw new g(this.id+" fetchOrderBook() limit argument must be undefined, 1, 25 or 500, default is 25");r.depth=t}const a=await this.publicGetMarketsMarketSymbolOrderbook(this.extend(r,i)),n=this.safeInteger(this.last_response_headers,"Sequence"),o=this.parseOrderBook(a,s.symbol,void 0,"bid","ask","rate","quantity");return o.nonce=n,o}async fetchCurrencies(e={}){const t=await this.publicGetCurrencies(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"symbol"),a=this.safeCurrencyCode(r),n=this.parseNumber("1e-8"),o=this.safeNumber(s,"txFee"),h=this.safeString(s,"status");i[a]={id:r,code:a,info:s,type:this.safeString(s,"coinType"),name:this.safeString(s,"name"),active:"ONLINE"===h,deposit:void 0,withdraw:void 0,fee:o,precision:n,limits:{amount:{min:n,max:void 0},withdraw:{min:o,max:void 0}}}}return i}parseTicker(e,t){const i=this.parse8601(this.safeString(e,"updatedAt")),s=this.safeString(e,"symbol"),r=(t=this.safeMarket(s,t,"-")).symbol,a=this.safeString(e,"percentChange"),n=this.safeString(e,"lastTradeRate");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bidRate"),bidVolume:void 0,ask:this.safeString(e,"askRate"),askVolume:void 0,vwap:void 0,open:void 0,close:n,last:n,previousClose:void 0,change:void 0,percentage:a,average:void 0,baseVolume:this.safeString(e,"volume"),quoteVolume:this.safeString(e,"quoteVolume"),info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=this.safeValue(this.options,"fetchTickers",{}),s=this.safeString(i,"method","publicGetMarketsTickers"),r=this.safeString(t,"method",s);t=this.omit(t,"method");const a=await this[r](t),n=[];for(let e=0;e<a.length;e++){const t=this.parseTicker(a[e]);n.push(t)}return this.filterByArray(n,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={marketSymbol:i.id},r=this.safeValue(this.options,"fetchTicker",{}),a=this.safeString(r,"method","publicGetMarketsMarketSymbolTicker"),n=this.safeString(t,"method",a);t=this.omit(t,"method");const o=await this[n](this.extend(s,t));return this.parseTicker(o,i)}async fetchBidsAsks(e,t={}){await this.loadMarkets();const i=await this.publicGetMarketsTickers(t);return this.parseTickers(i,e)}parseTrade(e,t){const i=this.parse8601(this.safeString(e,"executedAt")),s=this.safeString(e,"id"),r=this.safeString(e,"orderId"),a=this.safeString(e,"marketSymbol");t=this.safeMarket(a,t,"-");const n=this.safeString(e,"rate"),o=this.safeString(e,"quantity");let h,d=this.safeStringLower2(e,"takerSide","direction");const c=this.safeValue(e,"isTaker");let l;void 0!==c&&(h=c?"taker":"maker",c||("buy"===d?d="sell":"sell"===d&&(d="buy")));const u=this.safeString(e,"commission");return void 0!==u&&(l={cost:u,currency:t.quote}),this.safeTrade({info:e,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,id:s,order:r,takerOrMaker:h,type:void 0,side:d,price:n,amount:o,cost:void 0,fee:l},t)}async fetchTime(e={}){const t=await this.publicGetPing(e);return this.safeInteger(t,"serverTime")}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={marketSymbol:r.id},n=await this.publicGetMarketsMarketSymbolTrades(this.extend(a,s));return this.parseTrades(n,r,t,i)}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={marketSymbol:i.id},r=await this.privateGetAccountFeesTradingMarketSymbol(this.extend(s,t));return this.parseTradingFee(r,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privateGetAccountFeesTrading(e);return this.parseTradingFees(t)}parseTradingFee(e,t){const i=this.safeString(e,"marketSymbol"),s=this.safeNumber(e,"makerRate"),r=this.safeNumber(e,"takerRate");return{info:e,symbol:this.safeSymbol(i,t),maker:s,taker:r}}parseTradingFees(e){const t={info:e};for(let i=0;i<e.length;i++){const s=this.parseTradingFee(e[i]);t[s.symbol]=s}return t}parseOHLCV(e,t){return[this.parse8601(this.safeString(e,"startsAt")),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=a.baseId+"-"+a.quoteId,o={candleInterval:this.safeString(this.timeframes,t,t),marketSymbol:n};let h="publicGetMarketsMarketSymbolCandlesCandleIntervalRecent";if(void 0!==i){const e=this.milliseconds(),s=Math.abs(e-i),r=this.yyyymmdd(i).split("-"),a=this.safeInteger(r,0),n=this.safeInteger(r,1),d=this.safeInteger(r,2);"1d"===t?s>316224e5&&(h="publicGetMarketsMarketSymbolCandlesCandleIntervalHistoricalYear",o.year=a):"1h"===t?s>26784e5&&(h="publicGetMarketsMarketSymbolCandlesCandleIntervalHistoricalYearMonth",o.year=a,o.month=n):s>864e5&&(h="publicGetMarketsMarketSymbolCandlesCandleIntervalHistoricalYearMonthDay",o.year=a,o.month=n,o.day=d)}const d=await this[h](this.extend(o,r));return this.parseOHLCVs(d,a,t,i,s)}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;const n=this.safeValue(s,"stop");void 0!==e&&(a=this.market(e),r.marketSymbol=a.id);let o="privateGetOrdersOpen";n&&(o="privateGetConditionalOrdersOpen");const h=this.omit(s,"stop"),d=await this[o](this.extend(r,h));return this.parseOrders(d,a,t,i)}async fetchOrderTrades(e,t,i,s,r={}){await this.loadMarkets();const a={orderId:e},n=await this.privateGetOrdersOrderIdExecutions(this.extend(a,r));let o;return void 0!==t&&(o=this.market(t)),this.parseTrades(n,o,i,s)}async createOrder(e,t,i,s,a,n={}){await this.loadMarkets();const o=this.market(e);let h;void 0!==t&&(h=t.toUpperCase());const d=o.baseId+"-"+o.quoteId,c=this.safeValue(n,"stop"),l=this.safeNumber2(n,"triggerPrice","stopPrice"),u={marketSymbol:d};let f="privatePostOrders";if(c||l){f="privatePostConditionalOrders";const t=this.safeString(n,"operand");if(void 0===t)throw new r(this.id+" createOrder() requires an operand parameter");const o=this.safeNumber(n,"trailingStopPercent"),c=this.safeValue(n,"orderToCreate"),p=this.safeValue(n,"orderToCancel");if(void 0===l&&(u.trailingStopPercent=this.priceToPrecision(e,o)),c){const t="CEILING_LIMIT"===h,r="CEILING_MARKET"===h;let o,c,l;if(t||r){let i;t?(c=this.priceToPrecision(e,a),i=this.safeNumber2(n,"ceiling","cost",s)):r&&(i=this.safeNumber2(n,"ceiling","cost"),void 0===i&&(i=void 0===a?s:s*a)),o=this.costToPrecision(e,i),l="IMMEDIATE_OR_CANCEL"}else"LIMIT"===h?(c=this.priceToPrecision(e,a),l="GOOD_TIL_CANCELLED"):l="IMMEDIATE_OR_CANCEL";u.orderToCreate={marketSymbol:d,direction:i.toUpperCase(),type:h,quantity:this.amountToPrecision(e,s),ceiling:o,limit:c,timeInForce:l,clientOrderId:this.safeString(n,"clientOrderId"),useAwards:this.safeValue(n,"useAwards")}}p&&(u.orderToCancel=p),u.triggerPrice=this.priceToPrecision(e,l),u.operand=t}else{void 0!==i&&(u.direction=i.toUpperCase()),u.type=h;const t="CEILING_LIMIT"===h,r="CEILING_MARKET"===h;if(t||r){let i;t?(u.limit=this.priceToPrecision(e,a),i=this.safeNumber2(n,"ceiling","cost",s)):r&&(i=this.safeNumber2(n,"ceiling","cost"),void 0===i&&(i=void 0===a?s:s*a)),u.ceiling=this.costToPrecision(e,i),u.timeInForce="IMMEDIATE_OR_CANCEL"}else u.quantity=this.amountToPrecision(e,s),"LIMIT"===h?(u.limit=this.priceToPrecision(e,a),u.timeInForce="GOOD_TIL_CANCELLED"):u.timeInForce="IMMEDIATE_OR_CANCEL"}const p=this.omit(n,["stop","stopPrice","ceiling","cost","operand","trailingStopPercent","orderToCreate","orderToCancel"]),m=await this[f](this.extend(u,p));return this.parseOrder(m,o)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s=this.safeValue(i,"stop");let r,a,n={};void 0!==t&&(a=this.market(t)),s?(r="privateDeleteConditionalOrdersConditionalOrderId",n={conditionalOrderId:e}):(r="privateDeleteOrdersOrderId",n={orderId:e});const o=this.omit(i,"stop"),h=await this[r](this.extend(n,o));return this.extend(this.parseOrder(h,a),{id:e,info:h,status:"canceled"})}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};let s;void 0!==e&&(s=this.market(e),i.marketSymbol=s.id);const r=await this.privateDeleteOrdersOpen(this.extend(i,t)),a=[];for(let e=0;e<r.length;e++){const t=this.safeValue(r[e],"result",{});a.push(t)}return this.parseOrders(a,s)}async fetchDeposit(e,t,i={}){await this.loadMarkets();const s={txId:e};let r;void 0!==t&&(r=this.currency(t));const a=await this.privateGetDepositsByTxIdTxId(this.extend(s,i)),n=this.parseTransactions(a,r,void 0,void 0);return this.safeValue(n,0)}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a,n;if(void 0!==e&&(a=this.currency(e),r.currencySymbol=a.id),void 0!==t){const e=1e3*parseInt(t/1e3);r.startDate=this.iso8601(e)}void 0!==i&&(r.pageSize=i);const o=this.safeValue(this.options,"fetchDeposits",{}),h=this.safeString(o,"status","ok");n="pending"===this.safeString(s,"status",h)?"privateGetDepositsOpen":"privateGetDepositsClosed",s=this.omit(s,"status");const d=await this[n](this.extend(r,s));return this.parseTransactions(d,a,void 0,i)}async fetchPendingDeposits(e,t,i,s={}){return await this.loadMarkets(),this.fetchDeposits(e,t,i,this.extend(s,{status:"pending"}))}async fetchWithdrawal(e,t,i={}){await this.loadMarkets();const s={txId:e};let r;void 0!==t&&(r=this.currency(t));const a=await this.privateGetWithdrawalsByTxIdTxId(this.extend(s,i)),n=this.parseTransactions(a,r,void 0,void 0);return this.safeValue(n,0)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a,n;if(void 0!==e&&(a=this.currency(e),r.currencySymbol=a.id),void 0!==t){const e=1e3*parseInt(t/1e3);r.startDate=this.iso8601(e)}void 0!==i&&(r.pageSize=i);const o=this.safeValue(this.options,"fetchWithdrawals",{}),h=this.safeString(o,"status","ok");n="pending"===this.safeString(s,"status",h)?"privateGetWithdrawalsOpen":"privateGetWithdrawalsClosed",s=this.omit(s,"status");const d=await this[n](this.extend(r,s));return this.parseTransactions(d,a,t,i)}async fetchPendingWithdrawals(e,t,i,s={}){return await this.loadMarkets(),this.fetchWithdrawals(e,t,i,this.extend(s,{status:"pending"}))}parseTransaction(e,t){const i=this.safeString2(e,"id","clientWithdrawalId"),s=this.safeNumber(e,"quantity"),r=this.safeString(e,"cryptoAddress");let a,n;"BLOCKCHAIN"===this.safeString(e,"source")?n=r:a=r;const o=this.safeString(e,"txId"),h=this.parse8601(this.safeString(e,"updatedAt")),d=this.parse8601(this.safeString(e,"createdAt")),c=d||h,l=void 0===d?"deposit":"withdrawal",u=this.safeString(e,"currencySymbol"),f=this.safeCurrencyCode(u,t);let p="pending";if("deposit"===l)p="ok";else{const t=this.safeString(e,"status");"ERROR_INVALID_ADDRESS"===t?p="failed":"CANCELLED"===t?p="canceled":"PENDING"===t?p="pending":("COMPLETED"===t||"AUTHORIZED"===t&&void 0!==o)&&(p="ok")}let m=this.safeNumber(e,"txCost");return void 0===m&&"deposit"===l&&(m=0),{info:e,id:i,currency:f,amount:s,network:void 0,address:r,addressTo:a,addressFrom:n,tag:void 0,tagTo:void 0,tagFrom:void 0,status:p,type:l,updated:h,txid:o,timestamp:c,datetime:this.iso8601(c),fee:{currency:f,cost:m}}}parseTimeInForce(e){return this.safeString({GOOD_TIL_CANCELLED:"GTC",IMMEDIATE_OR_CANCEL:"IOC",FILL_OR_KILL:"FOK",POST_ONLY_GOOD_TIL_CANCELLED:"PO"},e,e)}parseOrder(e,t){const i=this.safeString(e,"marketSymbol"),s=(t=this.safeMarket(i,t,"-")).symbol,r=t.quote,a=this.safeString(e,"createdAt"),n=this.safeString(e,"updatedAt"),o=this.safeString(e,"closedAt"),h=this.safeString(e,"clientOrderId");let d;void 0!==o?d=this.parse8601(o):n&&(d=this.parse8601(n));const c=this.parse8601(a);let l=this.safeStringLower(e,"direction");if(void 0===l){let t=this.safeValue(e,"orderToCreate");void 0===t&&(t=this.safeValue(e,"orderToCancel")),l=this.safeStringLower(t,"direction")}let u=this.safeStringLower(e,"type");if(void 0===u){let t=this.safeValue(e,"orderToCreate");void 0===t&&(t=this.safeValue(e,"orderToCancel")),u=this.safeStringLower(t,"type")}let f=this.safeString(e,"quantity");if(void 0===f){let t=this.safeValue(e,"orderToCreate");void 0===t&&(t=this.safeValue(e,"orderToCancel")),f=this.safeString(t,"quantity")}let p=this.safeString(e,"limit");if(void 0===p){let t=this.safeValue(e,"orderToCreate");void 0===t&&(t=this.safeValue(e,"orderToCancel")),p=this.safeString(t,"limit")}let m=this.parseTimeInForce(this.safeString(e,"timeInForce"));if(void 0===m){let t=this.safeValue(e,"orderToCreate");void 0===t&&(t=this.safeValue(e,"orderToCancel")),m=this.parseTimeInForce(this.safeString(t,"timeInForce"))}const g=this.safeString(e,"fillQuantity"),y=this.safeNumber(e,"commission"),b=this.safeString(e,"proceeds"),v=this.safeStringLower(e,"status"),w="PO"===m;return this.safeOrder({id:this.safeString(e,"id"),clientOrderId:h,timestamp:c,datetime:this.iso8601(c),lastTradeTimestamp:d,symbol:s,type:u,timeInForce:m,postOnly:w,side:l,price:p,stopPrice:this.safeString(e,"triggerPrice"),triggerPrice:this.safeString(e,"triggerPrice"),cost:b,average:void 0,amount:f,filled:g,remaining:void 0,status:v,fee:{cost:y,currency:r},info:e,trades:void 0},t)}parseOrders(e,t,i,s,r={}){return this.options.fetchClosedOrdersFilterBySince?super.parseOrders(e,t,i,s,r):super.parseOrders(e,t,void 0,s,r)}parseOrderStatus(e){return this.safeString({CLOSED:"closed",OPEN:"open",CANCELLED:"canceled",CANCELED:"canceled"},e,e)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s=this.safeValue(i,"stop");let r,a,n;void 0!==t&&(r=this.market(t));try{const t={};s?(n="privateGetConditionalOrdersConditionalOrderId",t.conditionalOrderId=e):(n="privateGetOrdersOrderId",t.orderId=e);const r=this.omit(i,"stop");a=await this[n](this.extend(t,r))}catch(e){if(this.last_json_response){if("UUID_INVALID"===this.safeString(this.last_json_response,"message"))throw new l(this.id+" fetchOrder() error: "+this.last_http_response)}throw e}return this.parseOrder(a,r)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==i&&(r.pageSize=i),void 0!==t&&(r.startDate=this.ymdhms(t,"T")+"Z"),void 0!==e&&(a=this.market(e),e=a.symbol,r.marketSymbol=a.id);const n=await this.privateGetExecutions(this.extend(r,s)),o=this.parseTrades(n,a);return this.filterBySymbolSinceLimit(o,e,t,i)}async fetchClosedOrders(e,t,i,s={}){await this.loadMarkets();const r=this.safeValue(s,"stop"),a={};let n;void 0!==i&&(a.pageSize=i),void 0!==t&&(a.startDate=this.ymdhms(t,"T")+"Z"),void 0!==e&&(n=this.market(e),a.marketSymbol=n.base+"-"+n.quote);let o="privateGetOrdersClosed";r&&(o="privateGetConditionalOrdersClosed");const h=this.omit(s,"stop"),d=await this[o](this.extend(a,h));return this.parseOrders(d,n,t,i)}async createDepositAddress(e,t={}){await this.loadMarkets();const i={currencySymbol:this.currency(e).id},s=await this.privatePostAddresses(this.extend(i,t)),r=this.safeString(s,"cryptoAddress"),a=this.safeString(s,"status");if(!r||"REQUESTED"===a)throw new p(this.id+" the address for "+e+" is being generated (pending, not ready yet, retry again later)");return this.checkAddress(r),{currency:e,address:r,tag:this.safeString(s,"cryptoAddressTag"),network:void 0,info:s}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={currencySymbol:this.currency(e).id},s=await this.privateGetAddressesCurrencySymbol(this.extend(i,t)),r=this.safeString(s,"cryptoAddress"),a=this.safeString(s,"status");if(!r||"REQUESTED"===a)throw new p(this.id+" the address for "+e+" is being generated (pending, not ready yet, retry again later)");return this.checkAddress(r),{currency:e,address:r,tag:this.safeString(s,"cryptoAddressTag"),network:void 0,info:s}}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={currencySymbol:a.id,quantity:t,cryptoAddress:i};void 0!==s&&(n.cryptoAddressTag=s);const o=await this.privatePostWithdrawals(this.extend(n,r));return this.parseTransaction(o,a)}sign(e,t="v3",i="GET",s={},r,a){let n=this.implodeParams(this.urls.api[t],{hostname:this.hostname})+"/";if("private"===t){n+=this.version+"/",this.checkRequiredCredentials(),n+=this.implodeParams(e,s),s=this.omit(s,this.extractParams(e));let t="";"POST"===i?t=a=this.json(s):Object.keys(s).length&&(n+="?"+this.rawencode(s));const o=this.hash(this.encode(t),"sha512","hex"),h=this.milliseconds().toString();let d=h+n+i+o;const c=this.safeValue(this.options,"subaccountId");void 0!==c&&(d+=c);const l=this.hmac(this.encode(d),this.encode(this.secret),"sha512");r={"Api-Key":this.apiKey,"Api-Timestamp":h,"Api-Content-Hash":o,"Api-Signature":l},void 0!==c&&(r["Api-Subaccount-Id"]=c),"POST"===i&&(r["Content-Type"]="application/json")}else"public"===t&&(n+=this.version+"/"),n+=this.implodeParams(e,s),s=this.omit(s,this.extractParams(e)),Object.keys(s).length&&(n+="?"+this.urlencode(s));return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,o,d,c){if(void 0!==o&&"{"===a[0]){const e=this.id+" "+a;let t=this.safeValue(o,"success");if(void 0===t){const t=this.safeString(o,"code");if("NOT_FOUND"===t&&i.indexOf("addresses")>=0)throw new y(e);return void(void 0!==t&&(this.throwExactlyMatchedException(this.exceptions.exact,t,e),this.throwBroadlyMatchedException(this.exceptions.broad,t,e)))}if("string"==typeof t&&(t="true"===t),!t){const t=this.safeString(o,"message");if("APIKEY_INVALID"===t)throw this.options.hasAlreadyAuthenticatedSuccessfully?new u(e):new h(e);if("INVALID_ORDER"===t){const e="cancel";if(i.indexOf(e)>=0){const e=i.split("?");if(e.length>1){const t=e[1].split("&"),i=t.length;let s;for(let e=0;e<i;e++){const i=t[e].split("=");if("uuid"===i[0]){s=i[1];break}}throw new l(void 0!==s?this.id+" cancelOrder "+s+" "+this.json(o):this.id+" cancelOrder "+this.json(o))}}}throw this.throwExactlyMatchedException(this.exceptions.exact,t,e),void 0!==t&&this.throwBroadlyMatchedException(this.exceptions.broad,t,e),new n(e)}}}}},54253:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,BadSymbol:a,AuthenticationError:n,InsufficientFunds:o,InvalidOrder:h,ArgumentsRequired:d,OrderNotFound:c,InvalidAddress:l,BadRequest:u,RateLimitExceeded:f,PermissionDenied:p,ExchangeNotAvailable:m,AccountSuspended:g,OnMaintenance:y}=i(73449),{SIGNIFICANT_DIGITS:b,DECIMAL_PLACES:v,TRUNCATE:w,ROUND:S}=i(62115),k=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitvavo",name:"Bitvavo",countries:["NL"],rateLimit:60,version:"v2",certified:!0,pro:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,editOrder:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!0},timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","2h":"2h","4h":"4h","6h":"6h","8h":"8h","12h":"12h","1d":"1d"},urls:{logo:"https://user-images.githubusercontent.com/1294454/169202626-bd130fc5-fcf9-41bb-8d97-6093225c73cd.jpg",api:{public:"https://api.bitvavo.com",private:"https://api.bitvavo.com"},www:"https://bitvavo.com/",doc:"https://docs.bitvavo.com/",fees:"https://bitvavo.com/en/fees",referral:"https://bitvavo.com/?a=24F34952F7"},api:{public:{get:{time:1,markets:1,assets:1,"{market}/book":1,"{market}/trades":5,"{market}/candles":1,"ticker/price":1,"ticker/book":1,"ticker/24h":{cost:1,noMarket:25}}},private:{get:{account:1,order:1,orders:5,ordersOpen:{cost:1,noMarket:25},trades:5,balance:5,deposit:1,depositHistory:5,withdrawalHistory:5},post:{order:1,withdrawal:1},put:{order:1},delete:{order:1,orders:1}}},fees:{trading:{tierBased:!0,percentage:!0,taker:this.parseNumber("0.0025"),maker:this.parseNumber("0.002"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.0025")],[this.parseNumber("100000"),this.parseNumber("0.0020")],[this.parseNumber("250000"),this.parseNumber("0.0016")],[this.parseNumber("500000"),this.parseNumber("0.0012")],[this.parseNumber("1000000"),this.parseNumber("0.0010")],[this.parseNumber("2500000"),this.parseNumber("0.0008")],[this.parseNumber("5000000"),this.parseNumber("0.0006")],[this.parseNumber("10000000"),this.parseNumber("0.0005")],[this.parseNumber("25000000"),this.parseNumber("0.0004")]],maker:[[this.parseNumber("0"),this.parseNumber("0.0015")],[this.parseNumber("100000"),this.parseNumber("0.0010")],[this.parseNumber("250000"),this.parseNumber("0.0008")],[this.parseNumber("500000"),this.parseNumber("0.0006")],[this.parseNumber("1000000"),this.parseNumber("0.0005")],[this.parseNumber("2500000"),this.parseNumber("0.0004")],[this.parseNumber("5000000"),this.parseNumber("0.0004")],[this.parseNumber("10000000"),this.parseNumber("0.0003")],[this.parseNumber("25000000"),this.parseNumber("0.0003")]]}}},requiredCredentials:{apiKey:!0,secret:!0},exceptions:{exact:{101:r,102:u,103:f,104:f,105:p,107:m,108:m,109:m,110:u,200:u,201:u,202:u,203:a,204:u,205:u,206:u,210:h,211:h,212:h,213:h,214:h,215:h,216:o,217:h,230:r,231:r,232:u,233:h,234:h,235:r,236:u,240:c,300:n,301:n,302:n,303:n,304:n,305:n,306:n,307:p,308:n,309:n,310:p,311:p,312:p,315:u,317:g,400:r,401:r,402:p,403:p,404:y,405:r,406:u,407:r,408:o,409:l,410:r,411:u,412:l,413:l,414:r},broad:{"start parameter is invalid":u,"symbol parameter is invalid":a,"amount parameter is invalid":h,"orderId parameter is invalid":h}},options:{"BITVAVO-ACCESS-WINDOW":1e4,fetchCurrencies:{expires:1e3}},precisionMode:b,commonCurrencies:{MIOTA:"IOTA"}})}currencyToPrecision(e,t,i){return this.decimalToPrecision(t,0,this.currencies[e].precision,v)}amountToPrecision(e,t){return this.decimalToPrecision(t,w,this.markets[e].precision.amount,v)}priceToPrecision(e,t){return t=this.decimalToPrecision(t,S,this.markets[e].precision.price,this.precisionMode),this.decimalToPrecision(t,w,8,v)}async fetchTime(e={}){const t=await this.publicGetTime(e);return this.safeInteger(t,"time")}async fetchMarkets(e={}){const t=await this.publicGetMarkets(e),i=await this.fetchCurrenciesFromCache(e),s=this.indexBy(i,"symbol"),r=[];for(let e=0;e<t.length;e++){const i=t[e],a=this.safeString(i,"market"),n=this.safeString(i,"base"),o=this.safeString(i,"quote"),h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o),c=this.safeString(i,"status"),l=this.safeValue(s,n);r.push({id:a,symbol:h+"/"+d,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:"trading"===c,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeInteger(l,"decimals",8),price:this.safeInteger(i,"pricePrecision")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(i,"minOrderInBaseAsset"),max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(i,"minOrderInQuoteAsset"),max:void 0}},info:i})}return r}async fetchCurrenciesFromCache(e={}){const t=this.safeValue(this.options,"fetchCurrencies",{}),i=this.safeInteger(t,"timestamp"),s=this.safeInteger(t,"expires",1e3),r=this.milliseconds();if(void 0===i||r-i>s){const i=await this.publicGetAssets(e);this.options.fetchCurrencies=this.extend(t,{response:i,timestamp:r})}return this.safeValue(this.options.fetchCurrencies,"response")}async fetchCurrencies(e={}){const t=await this.fetchCurrenciesFromCache(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"symbol"),a=this.safeCurrencyCode(r),n="OK"===this.safeValue(s,"depositStatus"),o="OK"===this.safeValue(s,"withdrawalStatus"),h=n&&o,d=this.safeString(s,"name");i[a]={id:r,info:s,code:a,name:d,active:h,deposit:n,withdraw:o,fee:this.safeNumber(s,"withdrawalFee"),precision:this.safeInteger(s,"decimals",8),limits:{amount:{min:void 0,max:void 0},withdraw:{min:this.safeNumber(s,"withdrawalMinAmount"),max:void 0}}}}return i}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={market:i.id},r=await this.publicGetTicker24h(this.extend(s,t));return this.parseTicker(r,i)}parseTicker(e,t){const i=this.safeString(e,"market"),s=this.safeSymbol(i,t,"-"),r=this.safeInteger(e,"timestamp"),a=this.safeString(e,"last"),n=this.safeString(e,"volume"),o=this.safeString(e,"volumeQuote"),h=this.safeString(e,"open");return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:this.safeString(e,"bidSize"),ask:this.safeString(e,"ask"),askVolume:this.safeString(e,"askSize"),vwap:void 0,open:h,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:n,quoteVolume:o,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetTicker24h(t);return this.parseTickers(i,e)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={market:r.id};void 0!==i&&(a.limit=i),void 0!==t&&(a.start=t);const n=await this.publicGetMarketTrades(this.extend(a,s));return this.parseTrades(n,r,t,i)}parseTrade(e,t){const i=this.safeString(e,"price"),s=this.safeString(e,"amount"),r=this.safeInteger(e,"timestamp"),a=this.safeString(e,"side"),n=this.safeString2(e,"id","fillId"),o=this.safeString(e,"market"),h=this.safeSymbol(o,t,"-"),d=this.safeValue(e,"taker");let c;void 0!==d&&(c=d?"taker":"maker");const l=this.safeString(e,"fee");let u;if(void 0!==l){const t=this.safeString(e,"feeCurrency");u={cost:l,currency:this.safeCurrencyCode(t)}}const f=this.safeString(e,"orderId");return this.safeTrade({info:e,id:n,symbol:h,timestamp:r,datetime:this.iso8601(r),order:f,type:void 0,side:a,takerOrMaker:c,price:i,amount:s,cost:void 0,fee:u},t)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privateGetAccount(e),i=this.safeValue(t,"fees"),s=this.safeNumber(i,"maker"),r=this.safeNumber(i,"taker"),a={};for(let e=0;e<this.symbols.length;e++){const i=this.symbols[e];a[i]={info:t,symbol:i,maker:s,taker:r,percentage:!0,tierBased:!0}}return a}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={market:s.id};void 0!==t&&(r.depth=t);const a=await this.publicGetMarketBook(this.extend(r,i)),n=this.parseOrderBook(a,s.symbol);return n.nonce=this.safeInteger(a,"nonce"),n}parseOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={market:a.id,interval:this.safeString(this.timeframes,t,t)};if(void 0!==i){const e=this.parseTimeframe(t);n.start=i,void 0===s&&(s=1440),n.end=this.sum(i,s*e*1e3)}void 0!==s&&(n.limit=s);const o=await this.publicGetMarketCandles(this.extend(n,r));return this.parseOHLCVs(o,a,t,i,s)}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"symbol"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"available"),n.used=this.safeString(s,"inOrder"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetBalance(e);return this.parseBalance(t)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={symbol:this.currency(e).id},s=await this.privateGetDeposit(this.extend(i,t)),r=this.safeString(s,"address"),a=this.safeString(s,"paymentId");return this.checkAddress(r),{currency:e,address:r,tag:a,network:void 0,info:s}}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={market:n.id,side:i,orderType:t},h="market"===t||"stopLoss"===t||"takeProfit"===t,d="limit"===t||"stopLossLimit"===t||"takeProfitLimit"===t,c=this.safeString(a,"timeInForce");let l=this.safeStringN(a,["triggerPrice","stopPrice","triggerAmount"]);const u=this.isPostOnly(h,!1,a),f=this.safeValue(a,"stopLossPrice"),p=this.safeValue(a,"takeProfitPrice");if(a=this.omit(a,["timeInForce","triggerPrice","stopPrice","stopLossPrice","takeProfitPrice"]),h){let t;if(void 0!==r){const e=this.numberToString(r),i=this.numberToString(s),a=k.stringMul(i,e);t=this.parseNumber(a)}else t=this.safeNumber(a,"cost");if(void 0!==t){const e=this.currency(n.quote).precision;o.amountQuote=this.decimalToPrecision(t,w,e,this.precisionMode)}else o.amount=this.amountToPrecision(e,s);a=this.omit(a,["cost"])}else d&&(o.price=this.priceToPrecision(e,r),o.amount=this.amountToPrecision(e,s));const m=void 0!==p||"takeProfit"===t||"takeProfitLimit"===t;void 0!==f||void 0!==l&&!m||"stopLoss"===t||"stopLossLimit"===t?(void 0!==f&&(l=f),o.orderType=h?"stopLoss":"stopLossLimit"):m&&(void 0!==p&&(l=p),o.orderType=h?"takeProfit":"takeProfitLimit"),void 0!==l&&(o.triggerAmount=this.priceToPrecision(e,l),o.triggerType="price",o.triggerReference="lastTrade"),void 0!==c&&"PO"!==c&&(o.timeInForce=c),u&&(o.postOnly=!0);const g=await this.privatePostOrder(this.extend(o,a));return this.parseOrder(g,n)}async editOrder(e,t,i,s,r,a,n={}){await this.loadMarkets();const o=this.market(t);let h={};const c=this.safeNumber(n,"amountRemaining");if(n=this.omit(n,"amountRemaining"),void 0!==a&&(h.price=this.priceToPrecision(t,a)),void 0!==r&&(h.amount=this.amountToPrecision(t,r)),void 0!==c&&(h.amountRemaining=this.amountToPrecision(t,c)),h=this.extend(h,n),Object.keys(h).length){h.orderId=e,h.market=o.id;const t=await this.privatePutOrder(this.extend(h,n));return this.parseOrder(t,o)}throw new d(this.id+" editOrder() requires an amount argument, or a price argument, or non-empty params")}async cancelOrder(e,t,i={}){if(void 0===t)throw new d(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={orderId:e,market:s.id},a=await this.privateDeleteOrder(this.extend(r,i));return this.parseOrder(a,s)}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};let s;void 0!==e&&(s=this.market(e),i.market=s.id);const r=await this.privateDeleteOrders(this.extend(i,t));return this.parseOrders(r,s)}async fetchOrder(e,t,i={}){if(void 0===t)throw new d(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={orderId:e,market:s.id},a=await this.privateGetOrder(this.extend(r,i));return this.parseOrder(a,s)}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new d(this.id+" fetchOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={market:r.id};void 0!==t&&(a.start=t),void 0!==i&&(a.limit=i);const n=await this.privateGetOrders(this.extend(a,s));return this.parseOrders(n,r,t,i)}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.market=a.id);const n=await this.privateGetOrdersOpen(this.extend(r,s));return this.parseOrders(n,a,t,i)}parseOrderStatus(e){return this.safeString({new:"open",canceled:"canceled",canceledAuction:"canceled",canceledSelfTradePrevention:"canceled",canceledIOC:"canceled",canceledFOK:"canceled",canceledMarketProtection:"canceled",canceledPostOnly:"canceled",filled:"closed",partiallyFilled:"open",expired:"canceled",rejected:"canceled",awaitingTrigger:"open"},e,e)}parseOrder(e,t){const i=this.safeString(e,"orderId"),s=this.safeInteger(e,"created"),r=this.safeString(e,"market"),a=(t=this.safeMarket(r,t,"-")).symbol,n=this.parseOrderStatus(this.safeString(e,"status")),o=this.safeString(e,"side"),h=this.safeString(e,"orderType"),d=this.safeString(e,"price"),c=this.safeString(e,"amount"),l=this.safeString(e,"amountRemaining"),u=this.safeString(e,"filledAmount");let f,p=this.safeString(e,"filledAmountQuote");if(void 0===p){const t=this.safeString(e,"amountQuote"),i=this.safeString(e,"amountQuoteRemaining");p=k.stringSub(t,i)}const m=this.safeNumber(e,"feePaid");if(void 0!==m){const t=this.safeString(e,"feeCurrency");f={cost:m,currency:this.safeCurrencyCode(t)}}const g=this.safeValue(e,"fills",[]),y=this.safeString(e,"timeInForce"),b=this.safeValue(e,"postOnly"),v=this.safeNumber(e,"triggerPrice");return this.safeOrder({info:e,id:i,clientOrderId:void 0,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:void 0,symbol:a,type:h,timeInForce:y,postOnly:b,side:o,price:d,stopPrice:v,triggerPrice:v,amount:c,cost:p,average:void 0,filled:u,remaining:l,status:n,fee:f,trades:g},t)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new d(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={market:r.id};void 0!==t&&(a.start=t),void 0!==i&&(a.limit=i);const n=await this.privateGetTrades(this.extend(a,s));return this.parseTrades(n,r,t,i)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={symbol:a.id,amount:this.currencyToPrecision(e,t),address:i};void 0!==s&&(n.paymentId=s);const o=await this.privatePostWithdrawal(this.extend(n,r));return this.parseTransaction(o,a)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.symbol=a.id),void 0!==t&&(r.start=t),void 0!==i&&(r.limit=i);const n=await this.privateGetWithdrawalHistory(this.extend(r,s));return this.parseTransactions(n,a,t,i,{type:"withdrawal"})}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.symbol=a.id),void 0!==t&&(r.start=t),void 0!==i&&(r.limit=i);const n=await this.privateGetDepositHistory(this.extend(r,s));return this.parseTransactions(n,a,t,i,{type:"deposit"})}parseTransactionStatus(e){return this.safeString({awaiting_processing:"pending",awaiting_email_confirmation:"pending",awaiting_bitvavo_inspection:"pending",approved:"pending",sending:"pending",in_mempool:"pending",processed:"pending",completed:"ok",canceled:"canceled"},e,e)}parseTransaction(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeString(e,"symbol"),r=this.safeCurrencyCode(s,t),a=this.parseTransactionStatus(this.safeString(e,"status")),n=this.safeNumber(e,"amount"),o=this.safeString(e,"address"),h=this.safeString(e,"txId");let d;const c=this.safeNumber(e,"fee");let l;void 0!==c&&(d={cost:c,currency:r}),l="success"in e||"address"in e?"withdrawal":"deposit";const u=this.safeString(e,"paymentId");return{info:e,id:undefined,txid:h,timestamp:i,datetime:this.iso8601(i),addressFrom:void 0,address:o,addressTo:o,tagFrom:void 0,tag:u,tagTo:u,type:l,amount:n,currency:r,status:a,updated:void 0,fee:d}}sign(e,t="public",i="GET",s={},r,a){const n=this.omit(s,this.extractParams(e));let o="/"+this.version+"/"+this.implodeParams(e,s);const h="GET"===i||"DELETE"===i;if(h&&Object.keys(n).length&&(o+="?"+this.urlencode(n)),"private"===t){this.checkRequiredCredentials();let e="";h||Object.keys(n).length&&(e=a=this.json(n));const t=this.milliseconds().toString(),s=t+i+o+e,d=this.hmac(this.encode(s),this.encode(this.secret)),c=this.safeString(this.options,"BITVAVO-ACCESS-WINDOW","10000");r={"BITVAVO-ACCESS-KEY":this.apiKey,"BITVAVO-ACCESS-SIGNATURE":d,"BITVAVO-ACCESS-TIMESTAMP":t,"BITVAVO-ACCESS-WINDOW":c},h||(r["Content-Type"]="application/json")}return o=this.urls.api[t]+o,{url:o,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;const c=this.safeString(o,"errorCode"),l=this.safeString(o,"error");if(void 0!==c){const e=this.id+" "+n;throw this.throwBroadlyMatchedException(this.exceptions.broad,l,e),this.throwExactlyMatchedException(this.exceptions.exact,c,e),new r(e)}}calculateRateLimiterCost(e,t,i,s,r={},a={}){return"noMarket"in r&&!("market"in s)?r.noMarket:this.safeValue(r,"cost",1)}}},5510:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,BadRequest:a,ArgumentsRequired:n,InsufficientFunds:o,InvalidOrder:h}=i(73449),{TICK_SIZE:d}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bkex",name:"BKEX",countries:["BVI"],rateLimit:100,version:"v2",certified:!1,has:{CORS:void 0,spot:!0,margin:void 0,swap:!0,future:void 0,option:void 0,addMargin:void 0,cancelAllOrders:void 0,cancelOrder:!0,cancelOrders:!0,createDepositAddress:void 0,createLimitOrder:void 0,createMarketOrder:void 0,createOrder:!0,editOrder:void 0,fetchAccounts:void 0,fetchBalance:!0,fetchBidsAsks:void 0,fetchBorrowRate:void 0,fetchBorrowRateHistory:void 0,fetchBorrowRates:void 0,fetchBorrowRatesPerSymbol:void 0,fetchCanceledOrders:void 0,fetchClosedOrder:void 0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposit:!1,fetchDepositAddress:!0,fetchDepositAddresses:void 0,fetchDepositAddressesByNetwork:void 0,fetchDeposits:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:void 0,fetchFundingRate:void 0,fetchFundingRateHistory:!0,fetchFundingRates:void 0,fetchIndexOHLCV:void 0,fetchL2OrderBook:void 0,fetchLedger:void 0,fetchLedgerEntry:void 0,fetchLeverageTiers:void 0,fetchMarginMode:!1,fetchMarketLeverageTiers:!0,fetchMarkets:!0,fetchMarkOHLCV:void 0,fetchMyTrades:void 0,fetchOHLCV:!0,fetchOpenOrder:!0,fetchOpenOrders:!0,fetchOrder:!1,fetchOrderBook:!0,fetchOrderBooks:void 0,fetchOrders:void 0,fetchOrderTrades:void 0,fetchPosition:void 0,fetchPositionMode:!1,fetchPositions:void 0,fetchPositionsRisk:void 0,fetchPremiumIndexOHLCV:void 0,fetchStatus:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTradingLimits:void 0,fetchTransactionFee:"emulated",fetchTransactionFees:!0,fetchTransactions:void 0,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!1,fetchWithdrawals:!0,privateAPI:!0,publicAPI:!0,reduceMargin:void 0,setLeverage:void 0,setMarginMode:void 0,setPositionMode:void 0,signIn:void 0,transfer:!1,withdraw:!1},timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","4h":"4h","6h":"6h","12h":"12h","1d":"1d","1w":"1w"},urls:{logo:"https://user-images.githubusercontent.com/1294454/158043180-bb079a65-69e8-45a2-b393-f094d334e610.jpg",api:{spot:"https://api.bkex.com",swap:"https://fapi.bkex.com"},www:"https://www.bkex.com/",doc:["https://bkexapi.github.io/docs/api_en.htm"],fees:["https://www.bkex.com/help/instruction/33"]},api:{public:{spot:{get:{"/common/symbols":1,"/common/currencys":1,"/common/timestamp":1,"/q/kline":1,"/q/tickers":1,"/q/ticker/price":1,"/q/depth":1,"/q/deals":1}},swap:{get:{"/market/candle":1,"/market/deals":1,"/market/depth":1,"/market/fundingRate":1,"/market/index":1,"/market/riskLimit":1,"/market/symbols":1,"/market/ticker/price":1,"/market/tickers":1,"/server/ping":1}}},private:{spot:{get:{"/u/api/info":1,"/u/account/balance":1,"/u/wallet/address":1,"/u/wallet/depositRecord":1,"/u/wallet/withdrawRecord":1,"/u/order/openOrders":1,"/u/order/openOrder/detail":1,"/u/order/historyOrders":1},post:{"/u/account/transfer":1,"/u/wallet/withdraw":1,"/u/order/create":1,"/u/order/cancel":1,"/u/order/batchCreate":1,"/u/order/batchCancel":1}},swap:{get:{"/account/balance":1,"/account/balanceRecord":1,"/account/order":1,"/account/orderForced":1,"/account/position":1,"/entrust/finished":1,"/entrust/unFinish":1,"/order/finished":1,"/order/finishedInfo":1,"/order/unFinish":1,"/position/info":1},post:{"/account/setLeverage":1,"/entrust/add":1,"/entrust/cancel":1,"/order/batchCancel":1,"/order/batchOpen":1,"/order/cancel":1,"/order/close":1,"/order/closeAll":1,"/order/open":1,"/position/setSpSl":1,"/position/update":1}}}},fees:{trading:{tierBased:!1,percentage:!0,maker:this.parseNumber("0.0015"),taker:this.parseNumber("0.002")}},options:{timeframes:{spot:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","4h":"4h","6h":"6h","12h":"12h","1d":"1d","1w":"1w"},swap:{"1m":"M1","5m":"M5","15m":"M15","30m":"M30","1h":"H1","4h":"H4","6h":"H6","1d":"D1"}},defaultType:"spot",networks:{TRX:"TRC-20",TRC20:"TRC-20",ETH:"ERC-20",ERC20:"ERC-20",BEP20:"BEP-20(BSC)"}},commonCurrencies:{SHINJA:"SHINJA(1M)"},precisionMode:d,exceptions:{exact:{1005:o},broad:{"Not Enough balance":o,"Order does not exist":h,"System busy, please try again later":a}}})}async fetchMarkets(e={}){let t=[this.publicSpotGetCommonSymbols(e),this.publicSwapGetMarketSymbols(e)];t=await Promise.all(t);const i=t[0],s=t[1],r=this.safeValue(i,"data",[]),a=this.safeValue(s,"data",[]),n=this.arrayConcat(r,a),o=[];for(let e=0;e<n.length;e++){const t=n[e],i=this.safeString(t,"symbol"),s=this.safeStringUpper(t,"symbol"),[r,a]=s.split("_"),h=this.safeCurrencyCode(r),d=this.safeCurrencyCode(a),c=void 0!==this.safeString(t,"minimumOrderSize")?"spot":"swap",l="swap"===c;let u,f,p=h+"/"+d;l&&(u=a,f=d,p=h+"/"+d+":"+f);const m=!!l||void 0;o.push({id:i,symbol:p,base:h,quote:d,settle:f,baseId:r,quoteId:a,settleId:u,type:c,spot:"spot"===c,margin:!1,future:!1,swap:l,option:!1,active:this.safeValue(t,"supportTrade"),contract:l,linear:m,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"volumePrecision"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"pricePrecision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumberN(t,["minimumOrderSize","marketMiniAmount","limitMiniAmount"]),max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"minimumTradeVolume"),max:void 0}},info:t})}return o}async fetchCurrencies(e={}){const t=await this.publicSpotGetCommonCurrencys(e),i=this.safeValue(t,"data",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"currency"),a=this.safeCurrencyCode(r),n=this.safeString(t,"name"),o=this.safeValue(t,"supportWithdraw"),h=this.safeValue(t,"supportDeposit"),d=this.safeValue(t,"supportTrade"),c=o&&h&&d;s[a]={id:r,code:a,name:n,deposit:h,withdraw:o,active:c,fee:this.safeNumber(t,"withdrawFee"),precision:void 0,limits:{amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0},withdraw:{min:this.safeNumber(t,"minWithdrawSingle"),max:this.safeNumber(t,"maxWithdrawSingle")}},info:t}}return s}async fetchTime(e={}){const t=await this.publicSpotGetCommonTimestamp(e);return this.safeInteger(t,"data")}async fetchStatus(e={}){const t=await this.publicSpotGetCommonTimestamp(e),i=this.safeInteger(t,"status"),s=this.safeInteger(t,"code");return{status:0===i&&0===s?"ok":i,updated:this.safeInteger(t,"data"),eta:void 0,url:void 0,info:t}}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=a.swap,o={symbol:a.id};let h="publicSpotGetQKline";const d=this.safeValue(this.options,"timeframes");if(n){const e=this.safeValue(d,"swap");h="publicSwapGetMarketCandle",o.period=this.safeString(e,t,t),void 0!==s&&(o.count=s)}else{const e=this.safeValue(d,"spot");o.symbol=a.id,o.period=this.safeString(e,t,t)}if(void 0!==s){o[n?"count":"size"]=s}if(void 0!==i){const e=n?"start":"from";o[e]=i,void 0===s&&(s=500);const r=s*this.parseTimeframe(t)*1e3;o[n?"end":"to"]=this.sum(o[e],r)}const c=await this[h](o),l=this.safeValue(c,"data",[]);return this.parseOHLCVs(l,a,t,i,s)}parseOHLCV(e,t){const i=t.swap?"amount":"volume";return[this.safeInteger(e,"ts"),this.safeFloat(e,"open"),this.safeFloat(e,"high"),this.safeFloat(e,"low"),this.safeFloat(e,"close"),this.safeFloat(e,i)]}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},[r,a]=this.handleMarketTypeAndParams("fetchTicker",i,t),n="swap"===r?"publicSwapGetMarketTickers":"publicSpotGetQTickers",o=await this[n](this.extend(s,a)),h=this.safeValue(o,"data",[]),d=this.safeValue(h,0);return this.parseTicker(d,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i={};if(void 0!==e&&!Array.isArray(e))throw new a(this.id+" fetchTickers() symbols argument should be an array");let s;if(void 0!==e){const t=this.marketIds(e),r=this.safeString(e,0);if(s=this.market(r),s.swap){if(Array.isArray(e)){if(e.length>1)throw new a(this.id+" fetchTickers() symbols argument cannot contain more than 1 symbol for swap markets")}i.symbol=s.id}else i.symbol=t.join(",")}const[r,n]=this.handleMarketTypeAndParams("fetchTickers",s,t),o="swap"===r?"publicSwapGetMarketTickers":"publicSpotGetQTickers",h=await this[o](this.extend(i,n)),d=this.safeValue(h,"data",[]);return this.parseTickers(d,e,n)}parseTicker(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t);const s=this.safeSymbol(i,t),r=this.safeInteger2(e,"ts","lastTime"),a=t.swap?"amount":"volume",n=t.swap?"volume":"quoteVolume",o=t.swap?"lastPrice":"close";return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:this.safeString(e,"open"),close:this.safeString(e,"close"),last:this.safeString(e,o),previousClose:void 0,change:void 0,percentage:this.safeString(e,"change"),average:void 0,baseVolume:this.safeString(e,a),quoteVolume:this.safeString(e,n),info:e},t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r=s.swap,a={symbol:s.id};let n="publicSpotGetQDepth";r?n="publicSwapGetMarketDepth":void 0!==t&&(a.depth=Math.min(t,50));const o=await this[n](this.extend(a,i)),h=this.safeValue(o,"data"),d=this.safeInteger(h,"timestamp");return this.parseOrderBook(h,s.symbol,d,"bid","ask")}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a=r.swap,n={symbol:r.id};let o="publicSpotGetQDeals";a?o="publicSwapGetMarketDeals":void 0!==i&&(n.size=Math.min(i,50));const h=await this[o](this.extend(n,s)),d=this.safeValue(h,"data");return this.parseTrades(d,r,t,i)}parseTrade(e,t){const i=this.safeInteger2(e,"ts","time"),s=this.safeString(e,"symbol");t=this.safeMarket(s,t);const r=this.parseTradeSide(this.safeString2(e,"direction","side")),a=this.safeNumber2(e,"volume","amount"),n=this.safeNumber(e,"price"),o=void 0;let h=this.safeString(e,"tid");return void 0===h&&(h=this.syntheticTradeId(t,i,r,a,n,o)),this.safeTrade({id:h,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,order:void 0,type:o,side:r,takerOrMaker:void 0,price:n,amount:a,cost:void 0,fee:void 0,info:e},t)}parseTradeSide(e){return this.safeString({B:"buy",S:"sell",buy:"buy",sell:"sell"},e,e)}syntheticTradeId(e,t,i,s,r,a,n){let o="";return void 0!==t&&(o=this.numberToString(t)+"-"+this.safeString(e,"id","_"),void 0!==i&&(o+="-"+i),void 0!==a&&(o+="-"+a),void 0!==n&&(o+="-"+n),void 0!==s&&(o+="-"+this.numberToString(s)),void 0!==r&&(o+="-"+this.numberToString(r))),o}async fetchBalance(e={}){await this.loadMarkets();const t=this.omit(e,"type"),i=await this.privateSpotGetUAccountBalance(t),s=this.safeValue(i,"data"),r=this.safeValue(s,"WALLET",[]),a={info:r};for(let e=0;e<r.length;e++){const t=r[e],i=t.currency,s=this.safeCurrencyCode(i),n=this.account();n.free=this.safeNumber(t,"available"),n.used=this.safeNumber(t,"frozen"),n.total=this.safeNumber(t,"total"),a[s]=n}return this.safeBalance(a)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},r=await this.privateSpotGetUWalletAddress(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseDepositAddress(a,i)}parseDepositAddress(e,t){const i=this.safeValue(e,0),s=this.safeString(i,"address"),r=this.safeString(i,"memo"),a=this.safeString(i,"currency");return{currency:(t=this.safeCurrency(a,t)).code,address:s,tag:r,network:void 0,info:e}}async fetchDeposits(e,t,i,s={}){if(void 0===e)throw new n(this.id+" fetchDeposits() requires code argument");await this.loadMarkets();const r=this.currency(e),a={currency:r.id};if(void 0!==t){a.startTime=t;const e=this.milliseconds();a.endTime=e}void 0!==i&&(a.Size=i);const o=await this.privateSpotGetUWalletDepositRecord(this.extend(a,s)),h=this.safeValue(o,"data",{}),d=this.safeValue(h,"data",[]);for(let e=0;e<d.length;e++)d[e].transactType="deposit";return this.parseTransactions(d,r,t,i,s)}async fetchWithdrawals(e,t,i,s={}){if(void 0===e)throw new n(this.id+" fetchWithdrawals() requires code argument");await this.loadMarkets();const r=this.currency(e),a={currency:r.id};if(void 0!==t){a.startTime=t;const e=this.milliseconds();a.endTime=e}void 0!==i&&(a.Size=i);const o=await this.privateSpotGetUWalletWithdrawRecord(this.extend(a,s)),h=this.safeValue(o,"data",{}),d=this.safeValue(h,"data",[]);for(let e=0;e<d.length;e++)d[e].transactType="withdrawal";return this.parseTransactions(d,r,t,i,s)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=this.safeNumber(e,"volume"),r=this.safeValue(e,"toAddress",{}),a=this.safeString(e,"fromAddress"),n=this.safeString(e,"hash"),o=this.safeString(e,"transactType"),h=this.safeInteger(e,"createTime"),d=this.safeString(e,"currency"),c=this.safeCurrencyCode(d,t);return{id:i,currency:c,amount:s,network:void 0,address:r,addressTo:r,addressFrom:a,tag:void 0,tagTo:void 0,tagFrom:void 0,status:this.parseTransactionStatus(this.safeString(e,"status")),type:o,updated:void 0,txid:n,timestamp:h,datetime:this.iso8601(h),fee:{currency:c,cost:void 0},info:e}}parseTransactionStatus(e){return this.safeString({"-1":"failed",0:"ok",3:"pending",5:"pending"},e,e)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o="buy"===i?"BID":"ASK",h={symbol:n.id,type:t.toUpperCase(),volume:this.amountToPrecision(e,s),direction:o};"market"!==t&&void 0!==r&&(h.price=this.priceToPrecision(e,r));const d=await this.privateSpotPostUOrderCreate(this.extend(h,a));return this.parseOrder(d,n)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s=void 0!==t?this.market(t):void 0,r={orderId:e},a=await this.privateSpotPostUOrderCancel(this.extend(r,i));return this.parseOrder(a,s)}async cancelOrders(e,t,i={}){if(!Array.isArray(e))throw new n(this.id+" cancelOrders() ids argument should be an array");await this.loadMarkets();const s={orders:this.json(e)},r=await this.privateSpotPostUOrderBatchCancel(this.extend(s,i)),a=this.safeValue(r,"data"),o=this.safeValue(a,"results"),h=void 0!==t?this.market(t):void 0;return this.parseOrders(o,h,void 0,void 0,i)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new n(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.size=i);const o=await this.privateSpotGetUOrderOpenOrders(this.extend(a,s)),h=this.safeValue(o,"data"),d=this.safeValue(h,"data");return this.parseOrders(d,r,t,i,s)}async fetchOpenOrder(e,t,i={}){const s={orderId:e},r=await this.privateSpotGetUOrderOpenOrderDetail(this.extend(s,i)),a=this.safeValue(r,"data"),n=void 0!==t?this.market(t):void 0;return this.parseOrder(a,n)}async fetchClosedOrders(e,t,i,s={}){if(void 0===e)throw new n(this.id+" fetchClosedOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.size=i),void 0!==t&&(a.startTime=t);const o=await this.privateSpotGetUOrderHistoryOrders(this.extend(a,s)),h=this.safeValue(o,"data"),d=this.safeValue(h,"data");return this.parseOrders(d,r,t,i,s)}parseOrder(e,t){const i=this.safeInteger(e,"createdTime"),s=this.safeInteger(e,"updateTime"),r=this.safeString(e,"dealVolume"),a=this.parseOrderSide(this.safeString(e,"direction")),n=this.safeString2(e,"id","data"),o=this.safeString(e,"price"),h=this.safeString(e,"status"),d=this.safeString(e,"type"),c=this.parseOrderType(d);let l,u=!1;"LIMIT_MAKER"===d&&(u=!0),void 0!==i&&(l=this.parseOrderStatus(h));const f=this.safeString(e,"symbol");t=this.safeMarket(f,t);const p=this.safeString(e,"totalVolume"),m=this.safeNumber(e,"stopPrice"),g=this.safeString(e,"dealAvgPrice");return this.safeOrder({id:n,clientOrderId:void 0,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:s,status:l,symbol:t.symbol,type:c,timeInForce:void 0,postOnly:u,side:a,price:o,stopPrice:m,triggerPrice:m,average:g,amount:p,filled:r,remaining:void 0,cost:void 0,trades:void 0,fee:void 0,info:e},t)}parseOrderSide(e){return this.safeString({BID:"buy",ASK:"sell"},e,e)}parseOrderStatus(e){return this.safeString({0:"open",1:"closed",2:"canceled",3:"open"},e,e)}parseOrderType(e){return this.safeString({MARKET:"market",LIMIT:"limit",LIMIT_MAKER:"limit",STOP_LIMIT:"limit"},e,e)}async fetchTransactionFees(e,t={}){await this.loadMarkets();const i=await this.publicSpotGetCommonCurrencys(t);return this.parseTransactionFees(i,e)}parseTransactionFees(e,t){const i=this.safeValue(e,"data"),s={};for(let e=0;e<i.length;e++){const r=i[e],a=this.safeString(r,"currency"),n=this.safeCurrency(a),o=this.safeString(n,"code");(void 0===t||this.inArray(o,t))&&(s[o]={withdraw:this.parseTransactionFee(r),deposit:void 0,info:r})}return s}parseTransactionFee(e,t){return this.safeNumber(e,"withdrawFee")}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.publicSpotGetCommonCurrencys(t),s=this.safeValue(i,"data");return this.parseDepositWithdrawFees(s,e,"currency")}parseDepositWithdrawFee(e,t){const i=this.depositWithdrawFee(e);return i.withdraw.fee=this.safeNumber(e,"withdrawFee"),i}async fetchFundingRateHistory(e,t,i,s={}){if(void 0===e)throw new n(this.id+" fetchFundingRateHistory() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={symbol:r.id},o=await this.publicSwapGetMarketFundingRate(this.extend(a,s)),h=this.safeValue(o,"data",[]),d=[];for(let e=0;e<h.length;e++){const t=h[e],i=this.safeString(t,"symbol"),s=this.safeSymbol(i),r=this.safeInteger(t,"time");d.push({info:t,symbol:s,fundingRate:this.safeNumber(t,"rate"),timestamp:r,datetime:this.iso8601(r)})}const c=this.sortBy(d,"timestamp");return this.filterBySymbolSinceLimit(c,r.symbol,t,i)}async fetchMarketLeverageTiers(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.swap)throw new a(this.id+" fetchMarketLeverageTiers() supports swap markets only");const s={symbol:i.id},r=await this.publicSwapGetMarketRiskLimit(this.extend(s,t)),n=this.safeValue(r,"data",[]);return this.parseMarketLeverageTiers(n,i)}parseMarketLeverageTiers(e,t){const i=[];for(let s=0;s<e.length;s++){const r=e[s],a=this.safeString(e,"symbol");t=this.safeMarket(a,t),i.push({tier:this.sum(s,1),currency:t.settle,minNotional:this.safeNumber(r,"minValue"),maxNotional:this.safeNumber(r,"maxValue"),maintenanceMarginRate:this.safeNumber(r,"maintenanceMarginRate"),maxLeverage:this.safeNumber(r,"maxLeverage"),info:r})}return i}sign(e,t="public",i="GET",s={},r,a){const n="private"===t[0],o=t[1],h="spot"===o?this.version:"fapi/"+this.version;let d=this.urls.api[o]+"/"+h+this.implodeParams(e,s);s=this.omit(s,this.extractParams(e));let c="";if(Object.keys(s).length&&(c=this.rawencode(this.keysort(s)),"GET"===i&&(d+="?"+c)),n){this.checkRequiredCredentials();const e=this.hmac(this.encode(c),this.encode(this.secret),"sha256");r={"Cache-Control":"no-cache","Content-type":"application/x-www-form-urlencoded",X_ACCESS_KEY:this.apiKey,X_SIGNATURE:e},"GET"!==i&&(a=c)}return{url:d,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;if("success"===this.safeValue(o,"msg"))return;const c=this.safeString(o,"code");if("0"!==c){const e=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,c,e),this.throwBroadlyMatchedException(this.exceptions.broad,n,e),new r(e)}}}},85480:function(e,t,i){"use strict";const s=i(48819),{TICK_SIZE:r}=i(62115),a=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bl3p",name:"BL3P",countries:["NL"],rateLimit:1e3,version:"1",comment:"An exchange market by BitonicNL",has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkOHLCV:!1,fetchOpenInterestHistory:!1,fetchOrderBook:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransfer:!1,fetchTransfers:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1},urls:{logo:"https://user-images.githubusercontent.com/1294454/28501752-60c21b82-6feb-11e7-818b-055ee6d0e754.jpg",api:{rest:"https://api.bl3p.eu"},www:"https://bl3p.eu",doc:["https://github.com/BitonicNL/bl3p-api/tree/master/docs","https://bl3p.eu/api","https://bitonic.nl/en/api"]},api:{public:{get:["{market}/ticker","{market}/orderbook","{market}/trades"]},private:{post:["{market}/money/depth/full","{market}/money/order/add","{market}/money/order/cancel","{market}/money/order/result","{market}/money/orders","{market}/money/orders/history","{market}/money/trades/fetch","GENMKT/money/info","GENMKT/money/deposit_address","GENMKT/money/new_deposit_address","GENMKT/money/wallet/history","GENMKT/money/withdraw"]}},markets:{"BTC/EUR":{id:"BTCEUR",symbol:"BTC/EUR",base:"BTC",quote:"EUR",baseId:"BTC",quoteId:"EUR",maker:.0025,taker:.0025,type:"spot",spot:!0}},precisionMode:r})}parseBalance(e){const t=this.safeValue(e,"data",{}),i=this.safeValue(t,"wallets",{}),s={info:t},r=Object.keys(this.currencies);for(let e=0;e<r.length;e++){const t=r[e],a=this.currency(t).id,n=this.safeValue(i,a,{}),o=this.safeValue(n,"available",{}),h=this.safeValue(n,"balance",{}),d=this.account();d.free=this.safeString(o,"value"),d.total=this.safeString(h,"value"),s[t]=d}return this.safeBalance(s)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostGENMKTMoneyInfo(e);return this.parseBalance(t)}parseBidAsk(e,t=0,i=1){const s=this.safeString(e,t),r=this.safeString(e,i);return[this.parseNumber(a.stringDiv(s,"100000.0")),this.parseNumber(a.stringDiv(r,"100000000.0"))]}async fetchOrderBook(e,t,i={}){const s=this.market(e),r={market:s.id},a=await this.publicGetMarketOrderbook(this.extend(r,i)),n=this.safeValue(a,"data");return this.parseOrderBook(n,s.symbol,void 0,"bids","asks","price_int","amount_int")}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.safeTimestamp(e,"timestamp"),r=this.safeString(e,"last"),a=this.safeValue(e,"volume",{});return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:void 0,close:r,last:r,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(a,"24h"),quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){const i=this.market(e),s={market:i.id},r=await this.publicGetMarketTicker(this.extend(s,t));return this.parseTicker(r,i)}parseTrade(e,t){const i=this.safeString(e,"trade_id"),s=this.safeInteger(e,"date"),r=this.safeString(e,"price_int"),n=this.safeString(e,"amount_int");return t=this.safeMarket(void 0,t),this.safeTrade({id:i,info:e,timestamp:s,datetime:this.iso8601(s),symbol:t.symbol,type:void 0,side:void 0,order:void 0,takerOrMaker:void 0,price:a.stringDiv(r,"100000"),amount:a.stringDiv(n,"100000000"),cost:void 0,fee:void 0},t)}async fetchTrades(e,t,i,s={}){const r=this.market(e),a=await this.publicGetMarketTrades(this.extend({market:r.id},s));return this.parseTrades(a.data.trades,r,t,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privatePostGENMKTMoneyInfo(e),i=this.safeValue(t,"data",{}),s=this.safeString(i,"trade_fee"),r=this.parseNumber(a.stringDiv(s,"100")),n={};for(let e=0;e<this.symbols.length;e++){const t=this.symbols[e];n[t]={info:i,symbol:t,maker:r,taker:r,percentage:!0,tierBased:!1}}return n}async createOrder(e,t,i,s,r,n={}){const o=this.market(e),h=this.numberToString(s),d=this.numberToString(r),c={market:o.id,amount_int:parseInt(a.stringMul(h,"100000000")),fee_currency:o.quote,type:"buy"===i?"bid":"ask"};"limit"===t&&(c.price_int=parseInt(a.stringMul(d,"100000.0")));const l=await this.privatePostMarketMoneyOrderAdd(this.extend(c,n));return{info:l,id:this.safeString(l.data,"order_id")}}async cancelOrder(e,t,i={}){const s={order_id:e};return await this.privatePostMarketMoneyOrderCancel(this.extend(s,i))}sign(e,t="public",i="GET",s={},r,a){const n=this.implodeParams(e,s);let o=this.urls.api.rest+"/"+this.version+"/"+n;const h=this.omit(s,this.extractParams(e));if("public"===t)Object.keys(h).length&&(o+="?"+this.urlencode(h));else{this.checkRequiredCredentials();const e=this.nonce();a=this.urlencode(this.extend({nonce:e},h));const t=this.base64ToBinary(this.secret),i=n+"\0"+a,s=this.hmac(this.encode(i),t,"sha512","base64");r={"Content-Type":"application/x-www-form-urlencoded","Rest-Key":this.apiKey,"Rest-Sign":s}}return{url:o,method:i,body:a,headers:r}}}},60167:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,AuthenticationError:a,OrderNotFound:n,InsufficientFunds:o,ArgumentsRequired:h}=i(73449),{TICK_SIZE:d}=i(62115),c=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"blockchaincom",secret:void 0,name:"Blockchain.com",countries:["LX"],rateLimit:500,version:"v3",has:{CORS:!1,spot:!0,margin:void 0,swap:!1,future:!1,option:!1,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchBalance:!0,fetchCanceledOrders:!0,fetchClosedOrders:!0,fetchDeposit:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchL2OrderBook:!0,fetchL3OrderBook:!0,fetchLedger:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!1,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPositionMode:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!1,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!0,fetchWithdrawals:!0,fetchWithdrawalWhitelist:!0,transfer:!1,withdraw:!0},timeframes:void 0,urls:{logo:"https://user-images.githubusercontent.com/1294454/147515585-1296e91b-7398-45e5-9d32-f6121538533f.jpeg",test:{public:"https://testnet-api.delta.exchange",private:"https://testnet-api.delta.exchange"},api:{public:"https://api.blockchain.com/v3/exchange",private:"https://api.blockchain.com/v3/exchange"},www:"https://blockchain.com",doc:["https://api.blockchain.com/v3"],fees:"https://exchange.blockchain.com/fees"},api:{public:{get:{tickers:1,"tickers/{symbol}":1,symbols:1,"symbols/{symbol}":1,"l2/{symbol}":1,"l3/{symbol}":1}},private:{get:{fees:1,orders:1,"orders/{orderId}":1,trades:1,fills:1,deposits:1,"deposits/{depositId}":1,accounts:1,"accounts/{account}/{currency}":1,whitelist:1,"whitelist/{currency}":1,withdrawals:1,"withdrawals/{withdrawalId}":1},post:{orders:1,"deposits/{currency}":1,withdrawals:1},delete:{orders:1,"orders/{orderId}":1}}},fees:{trading:{feeSide:"get",tierBased:!0,percentage:!0,tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.004")],[this.parseNumber("10000"),this.parseNumber("0.0022")],[this.parseNumber("50000"),this.parseNumber("0.002")],[this.parseNumber("100000"),this.parseNumber("0.0018")],[this.parseNumber("500000"),this.parseNumber("0.0018")],[this.parseNumber("1000000"),this.parseNumber("0.0018")],[this.parseNumber("2500000"),this.parseNumber("0.0018")],[this.parseNumber("5000000"),this.parseNumber("0.0016")],[this.parseNumber("25000000"),this.parseNumber("0.0014")],[this.parseNumber("100000000"),this.parseNumber("0.0011")],[this.parseNumber("500000000"),this.parseNumber("0.0008")],[this.parseNumber("1000000000"),this.parseNumber("0.0006")]],maker:[[this.parseNumber("0"),this.parseNumber("0.002")],[this.parseNumber("10000"),this.parseNumber("0.0012")],[this.parseNumber("50000"),this.parseNumber("0.001")],[this.parseNumber("100000"),this.parseNumber("0.0008")],[this.parseNumber("500000"),this.parseNumber("0.0007000000000000001")],[this.parseNumber("1000000"),this.parseNumber("0.0006")],[this.parseNumber("2500000"),this.parseNumber("0.0005")],[this.parseNumber("5000000"),this.parseNumber("0.0004")],[this.parseNumber("25000000"),this.parseNumber("0.0003")],[this.parseNumber("100000000"),this.parseNumber("0.0002")],[this.parseNumber("500000000"),this.parseNumber("0.0001")],[this.parseNumber("1000000000"),this.parseNumber("0")]]}}},requiredCredentials:{apiKey:!1,secret:!0},precisionMode:d,exceptions:{exact:{401:a,404:n},broad:{}}})}async fetchMarkets(e={}){const t=await this.publicGetSymbols(e),i=Object.keys(t),s=[];for(let e=0;e<i.length;e++){const r=i[e],a=this.safeValue(t,r),n=this.safeString(a,"base_currency"),o=this.safeString(a,"counter_currency"),h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o),l=this.safeNumber(a,"id");let u;u="open"===this.safeString(a,"status");const f=this.safeString(a,"min_price_increment"),p=this.safeString(a,"min_price_increment_scale"),m=this.parsePrecision(p),g=c.stringMul(f,m),y=this.safeString(a,"lot_size"),b=this.safeString(a,"lot_size_scale"),v=this.parsePrecision(b),w=c.stringMul(y,v),S=this.safeString(a,"min_order_size"),k=this.safeString(a,"min_order_size_scale"),T=this.parsePrecision(k),_=c.stringMul(S,T),O=this.parseNumber(_);let M;if(M=this.safeString(a,"max_order_size"),"0"!==M){const e=this.safeString(a,"max_order_size_scale"),t=this.parsePrecision(e),i=c.stringMul(M,t);M=this.parseNumber(i)}else M=void 0;s.push({info:a,id:r,numericId:l,symbol:h+"/"+d,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:u,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(w),price:this.parseNumber(g)},limits:{leverage:{min:void 0,max:void 0},amount:{min:O,max:M},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}}})}return s}async fetchOrderBook(e,t,i={}){return await this.fetchL3OrderBook(e,t,i)}async fetchL3OrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};void 0!==t&&(r.depth=t);const a=await this.publicGetL3Symbol(this.extend(r,i));return this.parseOrderBook(a,s.symbol,void 0,"bids","asks","px","qty")}async fetchL2OrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};void 0!==t&&(r.depth=t);const a=await this.publicGetL2Symbol(this.extend(r,i));return this.parseOrderBook(a,s.symbol,void 0,"bids","asks","px","qty")}parseTicker(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t,"-"),r=this.safeString(e,"last_trade_price"),a=this.safeString(e,"volume_24h"),n=this.safeString(e,"price_24h");return this.safeTicker({symbol:s,timestamp:void 0,datetime:void 0,high:void 0,low:void 0,bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:n,close:void 0,last:r,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:a,quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetTickersSymbol(this.extend(s,t));return this.parseTicker(r,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetTickers(t);return this.parseTickers(i,e)}parseOrderState(e){return this.safeString({OPEN:"open",REJECTED:"rejected",FILLED:"closed",CANCELED:"canceled",PART_FILLED:"open",EXPIRED:"expired"},e,e)}parseOrder(e,t){const i=this.safeString(e,"clOrdId"),s=this.safeStringLower(e,"ordType"),r=this.safeString(e,"ordStatus"),a=this.parseOrderState(r),n=this.safeStringLower(e,"side"),o=this.safeString(e,"symbol"),h=this.safeSymbol(o,t,"-"),d=this.safeString(e,"exOrdId"),c="market"!==s?this.safeString(e,"price"):void 0,l=this.safeNumber(e,"avgPx"),u=this.safeInteger(e,"timestamp"),f=this.iso8601(u),p=this.safeString(e,"cumQty"),m=this.safeString(e,"leavesQty");return this.safeOrder({id:d,clientOrderId:i,datetime:f,timestamp:u,lastTradeTimestamp:void 0,status:a,symbol:h,type:s,timeInForce:void 0,side:n,price:c,average:l,amount:void 0,filled:p,remaining:m,cost:void 0,trades:[],fees:{},info:e})}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=this.safeString(a,"ordType",t).toUpperCase(),d=this.safeString2(a,"clientOrderId","clOrdId",this.uuid16());a=this.omit(a,["ordType","clientOrderId","clOrdId"]);const c={ordType:o,symbol:n.id,side:i.toUpperCase(),orderQty:this.amountToPrecision(e,s),clOrdId:d},l=this.safeValue2(a,"stopPx","stopPrice");if(a=this.omit(a,["stopPx","stopPrice"]),("STOP"===o||"STOPLIMIT"===o)&&void 0===l)throw new h(this.id+" createOrder() requires a stopPx or stopPrice param for a "+o+" order");void 0!==l&&("MARKET"===o?c.ordType="STOP":"LIMIT"===o&&(c.ordType="STOPLIMIT"));let u=!1,f=!1;"LIMIT"!==c.ordType&&"STOPLIMIT"!==c.ordType||(u=!0),"STOP"!==c.ordType&&"STOPLIMIT"!==c.ordType||(f=!0),u&&(c.price=this.priceToPrecision(e,r)),f&&(c.stopPx=this.priceToPrecision(e,l));const p=await this.privatePostOrders(this.extend(c,a));return this.parseOrder(p,n)}async cancelOrder(e,t,i={}){const s={orderId:e};return{id:e,info:await this.privateDeleteOrdersOrderId(this.extend(s,i))}}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};if(void 0!==e){const t=this.marketId(e);i.symbol=t}return{symbol:e,info:await this.privateDeleteOrders(this.extend(i,t))}}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privateGetFees(e),i=this.safeNumber(t,"makerRate"),s=this.safeNumber(t,"takerRate"),r={};for(let e=0;e<this.symbols.length;e++){const a=this.symbols[e];r[a]={info:t,symbol:a,maker:i,taker:s}}return r}async fetchCanceledOrders(e,t,i,s={}){return await this.fetchOrdersByState("CANCELED",e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersByState("FILLED",e,t,i,s)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrdersByState("OPEN",e,t,i,s)}async fetchOrdersByState(e,t,i,s,r={}){await this.loadMarkets();const a={status:e,limit:100};let n;void 0!==t&&(n=this.market(t),a.symbol=n.id);const o=await this.privateGetOrders(this.extend(a,r));return this.parseOrders(o,n,i,s)}parseTrade(e,t){const i=this.safeString(e,"exOrdId"),s=this.safeString(e,"tradeId"),r=this.safeString(e,"side").toLowerCase(),a=this.safeString(e,"symbol"),n=this.safeString(e,"price"),o=this.safeString(e,"qty"),h=this.safeInteger(e,"timestamp"),d=this.iso8601(h),c=(t=this.safeMarket(a,t,"-")).symbol;let l;const u=this.safeString(e,"fee");if(void 0!==u){l={cost:u,currency:t.quote}}return this.safeTrade({id:s,timestamp:h,datetime:d,symbol:c,order:i,type:void 0,side:r,takerOrMaker:void 0,price:n,amount:o,cost:void 0,fee:l,info:e},t)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==i&&(r.limit=i),void 0!==e&&(r.symbol=this.marketId(e),a=this.market(e));const n=await this.privateGetFills(this.extend(r,s));return this.parseTrades(n,a,t,i,s)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},r=await this.privatePostDepositsCurrency(this.extend(s,t)),a=this.safeString(r,"address");let n,o;void 0!==a&&([o,n]=a.split(":"));const h={info:r};return h.currency=i.code,h.address=o,void 0!==n&&(h.tag=n),h}parseTransactionState(e){return this.safeString({COMPLETED:"ok",REJECTED:"failed",PENDING:"pending",FAILED:"failed",REFUNDED:"refunded"},e,e)}parseTransaction(e,t){let i,s;const r=this.safeNumber(e,"amount"),a=this.safeInteger(e,"timestamp"),n=this.safeString(e,"currency"),o=this.safeCurrencyCode(n,t),h=this.safeString(e,"state");"depositId"in e?(i="deposit",s=this.safeString(e,"depositId")):"withdrawalId"in e&&(i="withdrawal",s=this.safeString(e,"withdrawalId"));const d="withdrawal"===i?this.safeNumber(e,"fee"):void 0;let c;void 0!==d&&(c={currency:o,cost:d});const l=this.safeString(e,"address");return{info:e,id:s,txid:this.safeString(e,"txhash"),timestamp:a,datetime:this.iso8601(a),network:void 0,addressFrom:void 0,address:l,addressTo:l,tagFrom:void 0,tag:void 0,tagTo:void 0,type:i,amount:r,currency:o,status:this.parseTransactionState(h),updated:void 0,comment:void 0,fee:c}}async fetchWithdrawalWhitelist(e={}){await this.loadMarkets();const t=await this.privateGetWhitelist(),i=[];for(let e=0;e<t.length;e++){const s=t[e];i.push({beneficiaryId:this.safeString(s,"whitelistId"),name:this.safeString(s,"name"),currency:this.safeString(s,"currency"),info:s})}return i}async fetchWithdrawalWhitelistByCurrency(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=await this.privateGetWhitelistCurrency(this.extend(i,t)),r=[];for(let e=0;e<s.length;e++){const t=s[e];r.push({beneficiaryId:this.safeString(t,"whitelistId"),name:this.safeString(t,"name"),currency:this.safeString(t,"currency"),info:t})}return r}async withdraw(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n={amount:t,currency:a.id,beneficiary:i,sendMax:!1},o=await this.privatePostWithdrawals(this.extend(n,r));return this.parseTransaction(o,a)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==t&&(r.from=t),void 0!==e&&(a=this.currency(e));const n=await this.privateGetWithdrawals(this.extend(r,s));return this.parseTransactions(n,a,t,i)}async fetchWithdrawal(e,t,i={}){await this.loadMarkets();const s={withdrawalId:e},r=await this.privateGetWithdrawalsWithdrawalId(this.extend(s,i));return this.parseTransaction(r)}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==t&&(r.from=t),void 0!==e&&(a=this.currency(e));const n=await this.privateGetDeposits(this.extend(r,s));return this.parseTransactions(n,a,t,i)}async fetchDeposit(e,t,i={}){await this.loadMarkets();const s={depositId:this.safeString(i,"depositId",e)},r=await this.privateGetDepositsDepositId(this.extend(s,i));return this.parseTransaction(r)}async fetchBalance(e={}){await this.loadMarkets();const t=this.safeString(e,"account","primary");e=this.omit(e,"account");const i={account:t},s=await this.privateGetAccounts(this.extend(i,e)),a=this.safeValue(s,t);if(void 0===a)throw new r(this.id+' fetchBalance() could not find the "'+t+'" account');const n={info:s};for(let e=0;e<a.length;e++){const t=a[e],i=this.safeString(t,"currency"),s=this.safeCurrencyCode(i),r=this.account();r.free=this.safeString(t,"available"),r.total=this.safeString(t,"balance"),n[s]=r}return this.safeBalance(n)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={orderId:e},r=await this.privateGetOrdersOrderId(this.extend(s,i));return this.parseOrder(r)}sign(e,t="public",i="GET",s={},r,a){const n="/"+this.implodeParams(e,s);let o=this.urls.api[t]+n;const h=this.omit(s,this.extractParams(e));return"public"===t?Object.keys(h).length&&(o+="?"+this.urlencode(h)):"private"===t&&(this.checkRequiredCredentials(),r={"X-API-Token":this.secret},"GET"===i?Object.keys(h).length&&(o+="?"+this.urlencode(h)):(a=this.json(h),r["Content-Type"]="application/json")),{url:o,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,n,h,d){if(void 0===n)return;const c=this.safeString(n,"text");if(void 0!==c&&"Insufficient Balance"===c)throw new o(this.id+" "+a);const l=this.safeString(n,"status"),u=this.safeString(n,"error");if(void 0!==e){const e=this.id+" "+this.json(n);this.throwExactlyMatchedException(this.exceptions.exact,l,e),this.throwBroadlyMatchedException(this.exceptions.broad,u,e)}}}},66492:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,AuthenticationError:a,DDoSProtection:n,InvalidOrder:o,InsufficientFunds:h}=i(73449),{TICK_SIZE:d}=i(62115),c=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"btcalpha",name:"BTC-Alpha",countries:["US"],version:"v1",has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchDeposit:!1,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchL2OrderBook:!0,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!1,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!1},timeframes:{"5m":"5","15m":"15","30m":"30","1h":"60","4h":"240","1d":"D"},urls:{logo:"https://user-images.githubusercontent.com/1294454/42625213-dabaa5da-85cf-11e8-8f99-aa8f8f7699f0.jpg",api:{rest:"https://btc-alpha.com/api"},www:"https://btc-alpha.com",doc:"https://btc-alpha.github.io/api-docs",fees:"https://btc-alpha.com/fees/",referral:"https://btc-alpha.com/?r=123788"},api:{public:{get:["currencies/","pairs/","orderbook/{pair_name}","exchanges/","charts/{pair}/{type}/chart/","ticker/"]},private:{get:["wallets/","orders/own/","order/{id}/","exchanges/own/","deposits/","withdraws/"],post:["order/","order-cancel/"]}},fees:{trading:{maker:this.parseNumber("0.002"),taker:this.parseNumber("0.002")},funding:{withdraw:{}}},commonCurrencies:{CBC:"Cashbery"},precisionMode:d,exceptions:{exact:{},broad:{"Out of balance":h}}})}async fetchMarkets(e={}){const t=await this.publicGetPairs(e),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"name"),a=this.safeString(s,"currency1"),n=this.safeString(s,"currency2"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=this.safeString(s,"price_precision"),l=this.parsePrecision(d),u=this.safeString(s,"minimum_order_size");i.push({id:r,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:!0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(s,"amount_precision"))),price:this.parseNumber(this.parsePrecision(d))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.parseNumber(u),max:this.safeNumber(s,"maximum_order_size")},price:{min:this.parseNumber(l),max:void 0},cost:{min:this.parseNumber(c.stringMul(l,u)),max:void 0}},info:s})}return i}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetTicker(t);return this.parseTickers(i,e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={pair:i.id},r=await this.publicGetTicker(this.extend(s,t));return this.parseTicker(r,i)}parseTicker(e,t){const i=this.safeIntegerProduct(e,"timestamp",1e6),s=this.safeString(e,"pair");t=this.safeMarket(s,t,"_");const r=this.safeString(e,"last");return this.safeTicker({info:e,symbol:t.symbol,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"buy"),bidVolume:void 0,ask:this.safeString(e,"sell"),askVolume:void 0,vwap:void 0,open:void 0,close:r,last:r,previousClose:void 0,change:this.safeString(e,"diff"),percentage:void 0,average:void 0,baseVolume:void 0,quoteVolume:this.safeString(e,"vol")},t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={pair_name:s.id};t&&(r.limit_sell=t,r.limit_buy=t);const a=await this.publicGetOrderbookPairName(this.extend(r,i));return this.parseOrderBook(a,s.symbol,void 0,"buy","sell","price","amount")}parseBidsAsks(e,t=0,i=1){const s=[];for(let r=0;r<e.length;r++){const a=e[r];a&&s.push(this.parseBidAsk(a,t,i))}return s}parseTrade(e,t){const i=this.safeString(e,"pair");t=this.safeMarket(i,t,"_");const s=this.safeString(e,"timestamp"),r=this.parseNumber(c.stringMul(s,"1000000")),a=this.safeString(e,"price"),n=this.safeString(e,"amount"),o=this.safeString(e,"id"),h=this.safeString2(e,"my_side","type");return this.safeTrade({id:o,info:e,timestamp:r,datetime:this.iso8601(r),symbol:t.symbol,order:o,type:"limit",side:h,takerOrMaker:void 0,price:a,amount:n,cost:void 0,fee:void 0},t)}async fetchTrades(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.pair=r.id),void 0!==i&&(a.limit=i);const n=await this.publicGetExchanges(this.extend(a,s));return this.parseTrades(n,r,t,i)}async fetchDeposits(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.currency(e));const a=await this.privateGetDeposits(s);return this.parseTransactions(a,r,t,i,{type:"deposit"})}async fetchWithdrawals(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.currency(e),a.currency_id=r.id);const n=await this.privateGetWithdraws(this.extend(a,s));return this.parseTransactions(n,r,t,i,{type:"withdrawal"})}parseTransaction(e,t){const i=this.safeTimestamp(e,"timestamp"),s=this.safeString(e,"currency"),r=this.safeString(e,"status");return{id:this.safeString(e,"id"),info:e,timestamp:i,datetime:this.iso8601(i),network:void 0,address:void 0,addressTo:void 0,addressFrom:void 0,tag:void 0,tagTo:void 0,tagFrom:void 0,currency:this.safeCurrencyCode(s,t),amount:this.safeNumber(e,"amount"),txid:void 0,type:void 0,status:this.parseTransactionStatus(r),comment:void 0,fee:void 0,updated:void 0}}parseTransactionStatus(e){return this.safeString({10:"pending",20:"pending",30:"ok",40:"failed",50:"canceled"},e,e)}parseOHLCV(e,t){return[this.safeTimestamp(e,"time"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="5m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={pair:a.id,type:this.safeString(this.timeframes,t,t)};void 0!==s&&(n.limit=s),void 0!==i&&(n.since=parseInt(i/1e3));const o=await this.publicGetChartsPairTypeChart(this.extend(n,r));return this.parseOHLCVs(o,a,t,i,s)}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.used=this.safeString(s,"reserve"),n.total=this.safeString(s,"balance"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetWallets(e);return this.parseBalance(t)}parseOrderStatus(e){return this.safeString({1:"open",2:"canceled",3:"closed"},e,e)}parseOrder(e,t){const i=this.safeString(e,"pair"),s=(t=this.safeMarket(i,t,"_")).symbol;let r;r=this.safeValue(e,"success",!1)?this.safeTimestamp(e,"date"):this.safeInteger(e,"date");const a=this.safeString(e,"price"),n=this.safeString(e,"amount"),o=this.safeString(e,"amount_filled"),h=this.safeString(e,"amount_original"),d=this.parseOrderStatus(this.safeString(e,"status")),c=this.safeString2(e,"oid","id"),l=this.safeValue(e,"trades"),u=this.safeString2(e,"my_side","type");return this.safeOrder({id:c,clientOrderId:void 0,datetime:this.iso8601(r),timestamp:r,status:d,symbol:s,type:"limit",timeInForce:void 0,postOnly:void 0,side:u,price:a,stopPrice:void 0,triggerPrice:void 0,cost:void 0,amount:h,filled:o,remaining:n,trades:l,fee:void 0,info:e,lastTradeTimestamp:void 0,average:void 0},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),h={pair:n.id,type:i,amount:s,price:this.priceToPrecision(e,r)},d=await this.privatePostOrder(this.extend(h,a));if(!d.success)throw new o(this.id+" "+this.json(d));const l=this.parseOrder(d,n),u=l.amount.toString();return s=c.stringGt(u,"0")?l.amount:s,this.extend(l,{amount:this.parseNumber(s)})}async cancelOrder(e,t,i={}){const s={order:e};return await this.privatePostOrderCancel(this.extend(s,i))}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privateGetOrderId(this.extend(s,i));return this.parseOrder(r)}async fetchOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.pair=a.id),void 0!==i&&(r.limit=i);const n=await this.privateGetOrdersOwn(this.extend(r,s));return this.parseOrders(n,a,t,i)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({status:"1"},s))}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({status:"3"},s))}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};if(void 0!==e){const t=this.market(e);r.pair=t.id}void 0!==i&&(r.limit=i);const a=await this.privateGetExchangesOwn(this.extend(r,s));return this.parseTrades(a,void 0,t,i)}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){const n=this.urlencode(this.keysort(this.omit(s,this.extractParams(e))));let o=this.urls.api.rest+"/";if("charts/{pair}/{type}/chart/"!==e&&(o+="v1/"),o+=this.implodeParams(e,s),r={Accept:"application/json"},"public"===t)n.length&&(o+="?"+n);else{this.checkRequiredCredentials();let e=this.apiKey;"POST"===i?(r["Content-Type"]="application/x-www-form-urlencoded",e+=a=n):n.length&&(o+="?"+n),r["X-KEY"]=this.apiKey,r["X-SIGN"]=this.hmac(this.encode(e),this.encode(this.secret)),r["X-NONCE"]=this.nonce().toString()}return{url:o,method:i,body:a,headers:r}}handleErrors(e,t,i,s,o,h,d,c,l){if(void 0===d)return;const u=this.safeString(d,"error"),f=this.id+" "+h;if(void 0!==u&&(this.throwExactlyMatchedException(this.exceptions.exact,u,f),this.throwBroadlyMatchedException(this.exceptions.broad,u,f)),401===e||403===e)throw new a(f);if(429===e)throw new n(f);if(!(e<400))throw new r(f)}}},6142:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,InsufficientFunds:a,InvalidOrder:n,AuthenticationError:o,PermissionDenied:h,InvalidNonce:d,OrderNotFound:c,DDoSProtection:l}=i(73449),{TICK_SIZE:u}=i(62115),f=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"btcbox",name:"BtcBox",countries:["JP"],rateLimit:1e3,version:"v1",has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkOHLCV:!1,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!1,fetchTrades:!0,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!1,fetchWithdrawals:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!1},urls:{logo:"https://user-images.githubusercontent.com/51840849/87327317-98c55400-c53c-11ea-9a11-81f7d951cc74.jpg",api:{rest:"https://www.btcbox.co.jp/api"},www:"https://www.btcbox.co.jp/",doc:"https://blog.btcbox.jp/en/archives/8762",fees:"https://support.btcbox.co.jp/hc/en-us/articles/360001235694-Fees-introduction"},api:{public:{get:["depth","orders","ticker"]},private:{post:["balance","trade_add","trade_cancel","trade_list","trade_view","wallet"]}},markets:{"BTC/JPY":{id:"btc",symbol:"BTC/JPY",base:"BTC",quote:"JPY",baseId:"btc",quoteId:"jpy",taker:this.parseNumber("0.0005"),maker:this.parseNumber("0.0005"),type:"spot",spot:!0},"ETH/JPY":{id:"eth",symbol:"ETH/JPY",base:"ETH",quote:"JPY",baseId:"eth",quoteId:"jpy",taker:this.parseNumber("0.0010"),maker:this.parseNumber("0.0010"),type:"spot",spot:!0},"LTC/JPY":{id:"ltc",symbol:"LTC/JPY",base:"LTC",quote:"JPY",baseId:"ltc",quoteId:"jpy",taker:this.parseNumber("0.0010"),maker:this.parseNumber("0.0010"),type:"spot",spot:!0},"BCH/JPY":{id:"bch",symbol:"BCH/JPY",base:"BCH",quote:"JPY",baseId:"bch",quoteId:"jpy",taker:this.parseNumber("0.0010"),maker:this.parseNumber("0.0010"),type:"spot",spot:!0}},precisionMode:u,exceptions:{104:o,105:h,106:d,107:n,200:a,201:n,202:n,203:c,401:c,402:l}})}parseBalance(e){const t={info:e},i=Object.keys(this.currencies);for(let s=0;s<i.length;s++){const r=i[s],a=this.currency(r).id,n=a+"_balance";if(n in e){const i=this.account(),s=a+"_lock";i.free=this.safeString(e,n),i.used=this.safeString(e,s),t[r]=i}}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostBalance(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={};this.symbols.length>1&&(r.coin=s.baseId);const a=await this.publicGetDepth(this.extend(r,i));return this.parseOrderBook(a,s.symbol)}parseTicker(e,t){const i=this.milliseconds(),s=this.safeSymbol(void 0,t),r=this.safeString(e,"last");return this.safeTicker({symbol:s,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"buy"),bidVolume:void 0,ask:this.safeString(e,"sell"),askVolume:void 0,vwap:void 0,open:void 0,close:r,last:r,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"vol"),quoteVolume:this.safeString(e,"volume"),info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={};this.symbols.length>1&&(s.coin=i.baseId);const r=await this.publicGetTicker(this.extend(s,t));return this.parseTicker(r,i)}parseTrade(e,t){const i=this.safeTimestamp(e,"date");t=this.safeMarket(void 0,t);const s=this.safeString(e,"tid"),r=this.safeString(e,"price"),a=this.safeString(e,"amount"),n=this.safeString(e,"type");return this.safeTrade({info:e,id:s,order:void 0,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,type:undefined,side:n,takerOrMaker:void 0,price:r,amount:a,cost:void 0,fee:void 0},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={};this.symbols.length>1&&(a.coin=r.baseId);const n=await this.publicGetOrders(this.extend(a,s));return this.parseTrades(n,r,t,i)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={amount:s,price:r,type:i,coin:n.baseId},h=await this.privatePostTradeAdd(this.extend(o,a));return this.parseOrder(h,n)}async cancelOrder(e,t,i={}){await this.loadMarkets(),void 0===t&&(t="BTC/JPY");const s=this.market(t),r={id:e,coin:s.baseId},a=await this.privatePostTradeCancel(this.extend(r,i));return this.parseOrder(a,s)}parseOrderStatus(e){return this.safeString({part:"open",all:"closed",cancelled:"canceled",closed:"closed",no:"closed"},e,e)}parseOrder(e,t){const i=this.safeString(e,"id");let s;void 0!==this.safeString(e,"datetime")&&(s=this.parse8601(e.datetime+"+09:00"));const r=this.safeString(e,"amount_original"),a=this.safeString(e,"amount_outstanding"),n=this.safeString(e,"price");let o=this.parseOrderStatus(this.safeString(e,"status"));void 0===o&&f.stringEquals(a,"0")&&(o="closed");t=this.safeMarket(void 0,t);const h=this.safeString(e,"type");return this.safeOrder({id:i,clientOrderId:void 0,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:void 0,amount:r,remaining:a,filled:void 0,side:h,type:void 0,timeInForce:void 0,postOnly:void 0,status:o,symbol:t.symbol,price:n,stopPrice:void 0,triggerPrice:void 0,cost:void 0,trades:undefined,fee:void 0,info:e,average:void 0},t)}async fetchOrder(e,t,i={}){await this.loadMarkets(),void 0===t&&(t="BTC/JPY");const s=this.market(t),r=this.extend({id:e,coin:s.baseId},i),a=await this.privatePostTradeView(this.extend(r,i));return this.parseOrder(a,s)}async fetchOrdersByType(e,t,i,s,r={}){await this.loadMarkets(),void 0===t&&(t="BTC/JPY");const a=this.market(t),n={type:e,coin:a.baseId},o=await this.privatePostTradeList(this.extend(n,r)),h=this.parseOrders(o,a,i,s);if("open"===e)for(let e=0;e<h.length;e++)h[e].status="open";return h}async fetchOrders(e,t,i,s={}){return await this.fetchOrdersByType("all",e,t,i,s)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrdersByType("open",e,t,i,s)}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+this.version+"/"+e;if("public"===t)Object.keys(s).length&&(n+="?"+this.urlencode(s));else{this.checkRequiredCredentials();const e=this.nonce().toString(),t=this.extend({key:this.apiKey,nonce:e},s),i=this.urlencode(t),n=this.hash(this.encode(this.secret));t.signature=this.hmac(this.encode(i),this.encode(n)),a=this.urlencode(t),r={"Content-Type":"application/x-www-form-urlencoded"}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;if(e>=400)return;const c=this.safeValue(o,"result");if(void 0===c||!0===c)return;const l=this.safeValue(o,"code"),u=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions,l,u),new r(u)}async request(e,t="public",i="GET",s={},a,n,o={},h={}){let d=await this.fetch2(e,t,i,s,a,n,o,h);if("string"==typeof d){if(d=this.strip(d),!this.isJsonEncodedObject(d))throw new r(this.id+" "+d);d=JSON.parse(d)}return d}}},40212:function(e,t,i){"use strict";const s=i(48819),{TICK_SIZE:r}=i(62115),{ExchangeError:a,NotSupported:n,RequestTimeout:o,DDoSProtection:h,InvalidOrder:d,InvalidAddress:c,BadRequest:l,InsufficientFunds:u,OrderNotFound:f,AuthenticationError:p,ExchangeNotAvailable:m,ArgumentsRequired:g}=i(73449),y=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"btcex",name:"BTCEX",countries:["CA"],version:"v1",certified:!1,pro:!0,requiredCredentials:{apiKey:!0,secret:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/173489620-d49807a4-55cd-4f4e-aca9-534921298bbf.jpg",www:"https://www.btcex.com/",api:{rest:"https://api.btcex.com"},doc:"https://docs.btcex.com/",fees:"https://support.btcex.com/hc/en-us/articles/4415995130647",referral:{url:"https://www.btcex.com/en-us/register?i=48biatg1",discount:.1}},has:{CORS:void 0,spot:!0,margin:!0,swap:!0,future:!0,option:!0,cancelAllOrders:!0,cancelOrder:!0,createLimitBuyOrder:!0,createLimitSellOrder:!0,createMarketBuyOrder:!0,createMarketSellOrder:!0,createOrder:!0,createPostOnlyOrder:!0,createReduceOnlyOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,editOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchClosedOrders:!0,fetchCurrencies:!1,fetchDepositAddress:!1,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!0,fetchFundingRateHistory:!1,fetchFundingRates:!0,fetchIndexOHLCV:!1,fetchLeverage:!0,fetchLeverageTiers:!0,fetchMarginMode:!1,fetchMarketLeverageTiers:!0,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterest:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchOrderTrades:!0,fetchPosition:!0,fetchPositionMode:!1,fetchPositions:!0,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!1,fetchTime:!1,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransactionFees:void 0,fetchWithdrawal:!0,fetchWithdrawals:!0,setLeverage:!0,setMarginMode:!0,signIn:!0,transfer:!0,withdraw:!1},timeframes:{"1m":"1","3m":"3","5m":"5","15m":"15","30m":"30","1h":"60","2h":"120","3h":"180","4h":"240","6h":"360","12h":"720","1d":"1D","3d":"3D","1M":"30D"},api:{public:{get:["get_last_trades_by_currency","get_last_trades_by_instrument","get_order_book","tickers","get_instruments","get_tradingview_chart_data","cmc_spot_summary","cmc_spot_ticker","cmc_spot_orderbook","cmc_market_trades","cmc_contracts","cmc_contract_orderbook","coin_gecko_spot_pairs","coin_gecko_spot_ticker","coin_gecko_spot_orderbook","coin_gecko_market_trades","coin_gecko_contracts","coin_gecko_contract_orderbook","get_perpetual_leverage_bracket","get_perpetual_leverage_bracket_all"],post:["auth"]},private:{get:["get_deposit_record","get_withdraw_record","get_position","get_positions","get_open_orders_by_currency","get_open_orders_by_instrument","get_order_history_by_currency","get_order_history_by_instrument","get_order_state","get_user_trades_by_currency","get_user_trades_by_instrument","get_user_trades_by_order","get_perpetual_user_config"],post:["logout","get_assets_info","add_withdraw_address","buy","sell","cancel","cancel_all_by_currency","cancel_all_by_instrument","close_position","adjust_perpetual_leverage","adjust_perpetual_margin_type","submit_transfer"],delete:[]}},fees:{trading:{tierBased:!1,percentage:!0,maker:this.parseNumber("0.001"),taker:this.parseNumber("0.001")},margin:{tierBased:!1,percentage:!0,maker:this.parseNumber("0.001"),taker:this.parseNumber("0.001")},perpetual:{tierBased:!1,percentage:!0,maker:this.parseNumber("0.002"),taker:this.parseNumber("0.002")}},exceptions:{exact:{9999:a,9900:m,401:p,403:p,1e3:m,1001:l,2e3:p,2001:p,2002:p,2003:p,3e3:p,3002:p,3003:p,3004:l,3005:n,3007:p,3008:p,3009:p,3011:p,3012:p,3013:o,3015:p,3016:p,3018:l,3019:l,3020:l,3021:l,3022:l,3023:l,3024:l,3025:l,3026:l,3027:l,3028:l,3029:h,3030:h,3031:l,3032:l,3033:l,3034:p,3035:l,3036:l,3037:l,3038:l,3039:l,3040:p,3041:l,4e3:l,4001:c,4002:c,4003:l,4004:n,4005:a,4006:u,4007:l,4008:n,4009:c,4010:l,4011:l,5001:d,5002:f,5003:d,5004:d,5005:d,5006:d,5007:d,5008:d,5009:d,5010:d,5011:d,5012:d,5013:d,5014:d,5109:d,5135:d,5901:d,5902:d,5903:d,5904:d,5905:d,5906:d,5907:u,8e3:l,8001:l,8100:l,8101:o,8102:h,8103:l,8104:l,8105:l,8106:h,8107:a,1e4:p,11e3:l},broad:{}},precisionMode:r,options:{accountsByType:{wallet:"WALLET",spot:"SPOT",perpetual:"PERPETUAL",margin:"MARGIN",swap:"PERPETUAL",BTC:"BTC",ETH:"ETH"},createMarketBuyOrderRequiresPrice:!0},commonCurrencies:{}})}async fetchMarkets(e={}){const t=await this.publicGetGetInstruments(e),i=this.safeValue(t,"result",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"instrument_name"),a=this.safeString(t,"kind");let n=a;"perpetual"===a&&(n="swap");let o=this.safeString(t,"quote_currency");const h=this.safeString(t,"base_currency"),d="perpetual"===a,c="spot"===a,l="margin"===a,u="option"===a,f="future"===a,p=d||f||u;let m,g,y,b,v,w;(u||f)&&(o=this.safeString(t,"currency"),m=this.safeInteger(t,"expiration_timestamp")),p&&(y=h,b=this.safeCurrencyCode(y)),u&&(v=this.safeString(t,"option_type"),w=this.safeNumber(t,"strike"));const S=this.safeCurrencyCode(o),k=this.safeCurrencyCode(h);let T;if(T=l?r:S+"/"+k,p&&(g=this.safeNumber(t,"contract_size"),T=T+":"+b,(f||u)&&(T=T+"-"+this.yymmdd(m),u))){const e="call"===v?"C":"P";T=T+":"+this.numberToString(w)+":"+e}const _=this.safeNumber(t,"min_trade_amount"),O=this.safeNumber(t,"tick_size"),M=this.safeNumber(t,"maker_commission"),I=this.safeNumber(t,"taker_commission"),x=!(u||f);s.push({id:r,symbol:T,base:S,quote:k,baseId:o,quoteId:h,settleId:y,settle:b,type:n,maker:M,taker:I,percentage:x,spot:c,margin:l,swap:d,future:f,option:u,active:this.safeValue(t,"is_active"),contract:p,linear:!!p||void 0,inverse:!p&&void 0,contractSize:g,expiry:m,expiryDatetime:this.iso8601(m),strike:w,optionType:v,precision:{amount:_,price:O},limits:{leverage:{min:void 0,max:this.safeString(t,"leverage")},amount:{min:_,max:void 0},price:{min:O,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return s}parseTicker(e,t){let i=this.safeString(e,"instrument_name");i.indexOf("PERPETUAL")<0&&(i+="-SPOT"),t=this.safeMarket(i,t);const s=this.safeSymbol(i,t,"-"),r=this.safeInteger(e,"timestamp"),a=this.safeValue(e,"stats");return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeString(a,"high"),low:this.safeString(a,"low"),bid:this.safeString(e,"best_bid_price"),bidVolume:this.safeString(e,"best_bid_amount"),ask:this.safeString(e,"best_ask_price"),askVolume:this.safeString(e,"best_ask_amount"),vwap:void 0,open:void 0,close:this.safeString(e,"last_price"),last:this.safeString(e,"last_price"),previousClose:void 0,change:void 0,percentage:this.safeString(a,"price_change"),average:void 0,baseVolume:this.safeString(a,"volume"),quoteVolume:this.safeString(a,"turnover"),info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={instrument_name:i.id},r=await this.publicGetTickers(this.extend(s,t)),a=this.safeValue(r,"result",{}),n=this.safeValue(a,0);return this.parseTicker(n,i)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={instrument_name:s.id};void 0!==t&&(r.depth=t);const a=await this.publicGetGetOrderBook(this.extend(r,i)),n=this.safeValue(a,"result",{}),o=this.safeInteger(n,"timestamp"),h=this.parseOrderBook(n,s.symbol,o);return h.nonce=this.safeInteger(n,"version"),h}parseOHLCV(e,t){return[this.safeTimestamp(e,"tick"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);void 0===s&&(s=10);const n={resolution:this.safeString(this.timeframes,t,t)};let o=a.id;if((a.spot||a.margin)&&(o=a.baseId+"-"+a.quoteId),n.instrument_name=o,void 0===i)n.end_timestamp=this.milliseconds(),n.start_timestamp=0;else{const e=1e3*this.parseTimeframe(t);n.start_timestamp=i,n.end_timestamp=this.sum(n.start_timestamp,s*e)}const h=await this.publicGetGetTradingviewChartData(this.extend(n,r)),d=this.safeValue(h,"result",[]);return this.parseOHLCVs(d,a,t,i,s)}parseTrade(e,t){const i=this.safeString(e,"trade_id"),s=this.safeString(e,"instrument_name"),r=this.safeSymbol(s,t),a=this.safeInteger(e,"timestamp"),n=this.safeString(e,"direction"),o=this.safeString(e,"price"),h=this.safeString(e,"amount"),d=this.safeString(e,"role"),c=this.safeString(e,"fee");let l;if(void 0!==c){const t=this.safeString(e,"fee_coin_type");l={cost:c,currency:this.safeCurrencyCode(t)}}return this.safeTrade({info:e,id:i,timestamp:a,datetime:this.iso8601(a),symbol:r,order:this.safeString(e,"order_id"),type:this.safeString(e,"order_type"),side:n,takerOrMaker:d,price:o,amount:h,cost:void 0,fee:l},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={instrument_name:r.id};void 0!==i&&(a.count=i);const n=await this.publicGetGetLastTradesByInstrument(this.extend(a,s)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"trades",[]);return this.parseTrades(h,r,t,i)}async signIn(e={}){let t=this.safeString(this.options,"accessToken");if(void 0!==t)return t;this.checkRequiredCredentials();const i={grant_type:"client_credentials",client_id:this.apiKey,client_secret:this.secret},s=await this.publicPostAuth(this.extend(i,e)),r=this.safeValue(s,"result");return t=this.safeString(r,"access_token"),this.options.accessToken=t,t}parseBalance(e){const t={info:e},i=Object.keys(e);for(let s=0;s<i.length;s++){const r=i[s],a=this.safeValue(e,r);if("WALLET"===r||"SPOT"===r){const e=this.safeValue(a,"details");if(void 0!==e)for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"coin_type"),a=this.safeCurrencyCode(r),n=this.safeValue(t,a,this.account());n.free=this.safeString(s,"available"),n.used=this.safeString(s,"freeze"),n.total=this.safeString(s,"total"),t[a]=n}}else{const e="USDT",i=this.account();i.total=this.safeString(a,"wallet_balance"),i.free=this.safeString(a,"available_withdraw_funds"),t[e]=i}}return this.safeBalance(t)}async fetchBalance(e={}){await this.signIn(),await this.loadMarkets();const t=this.safeStringLower(e,"type","spot"),i=this.safeValue(this.options,"accountsByType",{}),s=this.safeString(i,t,t);e=this.omit(e,"type");const r={asset_type:[s]},a=await this.privatePostGetAssetsInfo(this.extend(r,e)),n=this.safeValue(a,"result",[]);return this.parseBalance(n)}parseOrderStatus(e){return this.safeString({open:"open",cancelled:"canceled",filled:"closed",rejected:"rejected"},e,e)}parseTimeInForce(e){if("-"===e)return;return this.safeString({good_til_cancelled:"GTC",good_til_date:"GTD",fill_or_kill:"FOK",immediate_or_cancel:"IOC"},e,e)}parseOrder(e,t){const i=this.safeInteger(e,"creation_timestamp"),s=this.safeInteger(e,"last_update_timestamp"),r=this.safeString(e,"order_id");let a=this.safeString(e,"price");"-1"===a&&(a=void 0);const n=this.safeString(e,"average_price"),o=this.safeString(e,"amount"),h=this.safeString(e,"filled_amount"),d=this.parseOrderStatus(this.safeString(e,"order_state")),c=this.safeString(e,"instrument_name");t=this.safeMarket(c,t);const l=this.safeStringLower(e,"direction");let u,f=this.safeString(e,"commission");void 0!==f&&(f=y.stringAbs(f),u={cost:f,currency:t.base});const p=this.safeValue(e,"trades"),m=this.safeNumber(e,"trigger_price");return this.safeOrder({info:e,id:r,clientOrderId:void 0,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:s,symbol:t.symbol,type:this.safeString(e,"order_type"),timeInForce:this.parseTimeInForce(this.safeString(e,"time_in_force")),postOnly:this.safeValue(e,"post_only"),side:l,price:this.parseNumber(a),stopPrice:m,triggerPrice:m,stopLossPrice:this.safeNumber(e,"stop_loss_price"),takeProfitPrice:this.safeNumber(e,"take_profit_price"),amount:o,cost:void 0,average:n,filled:h,remaining:void 0,status:d,fee:u,trades:p},t)}async fetchOrder(e,t,i={}){await this.signIn(),await this.loadMarkets();const s={order_id:e},r=await this.privateGetGetOrderState(this.extend(s,i)),a=this.safeValue(r,"result");return this.parseOrder(a)}async createOrder(e,t,i,s,r,a={}){await this.signIn(),await this.loadMarkets();const n=this.market(e),o={instrument_name:n.id,type:t};if("sell"===i&&(o.amount=this.amountToPrecision(e,s)),"limit"===t)o.price=this.priceToPrecision(e,r);else{const t=this.safeNumber(a,"cost"),h=this.numberToString(s),c=this.numberToString(r),l=this.parseNumber(y.stringMul(h,c),t);if(n.swap)void 0!==l?(o.amount=this.priceToPrecision(e,l),o.market_amount_order=!0):(o.market_amount_order=!1,o.amount=this.amountToPrecision(e,s));else if("buy"===i){if(this.safeValue(this.options,"createMarketBuyOrderRequiresPrice",!0)){if(void 0===l)throw new d(this.id+" createOrder() requires a price argument for market buy orders on spot markets to calculate the total amount to spend (amount * price), alternatively set the createMarketBuyOrderRequiresPrice option to false and pass in the cost to spend into the amount parameter");o.amount=this.priceToPrecision(e,l)}else o.amount=this.priceToPrecision(e,s)}a=this.omit(a,"cost")}if(n.swap){const s=this.safeStringUpper(a,"timeInForce");"GTC"===s?o.time_in_force="good_till_cancelled":"FOK"===s?o.time_in_force="fill_or_kill":"IOC"===s&&(o.time_in_force="immediate_or_cancel");const r="market"===t,n=this.safeValue(a,"post_only",!1);this.isPostOnly(r,n,a)&&(o.post_only=!0);const h=this.safeValue(a,"reduceOnly",!1);if(h&&(o.reduce_only=!0),"buy"===i){const e=h?"SHORT":"LONG";o.position_side=e}else{const e=h?"LONG":"SHORT";o.position_side=e}const d=this.safeNumber2(a,"triggerPrice","stopPrice");let c=this.safeNumber(a,"stopLossPrice"),l=this.safeNumber(a,"takeProfitPrice");const u=this.safeValue(a,"stopLoss"),f=this.safeValue(a,"takeProfit");d?(o.condition_type="STOP",o.trigger_price=this.priceToPrecision(e,d),o.trigger_price_type=1):c||l?(o.condition_type="STOP",o.trigger_price=c?this.priceToPrecision(e,c):this.priceToPrecision(e,l),o.reduce_only=!0,o.trigger_price_type=1):(u||f)&&(u?(c=this.safeNumber(u,"price"),o.stop_loss_price=this.priceToPrecision(e,c),o.stop_loss_type=1):(l=this.safeNumber(f,"price"),o.take_profit_price=this.priceToPrecision(e,l),o.take_profit_type=1)),a=this.omit(a,["timeInForce","postOnly","reduceOnly","stopPrice","triggerPrice","stopLossPrice","takeProfitPrice","stopLoss","takeProfit"])}const h="privatePost"+this.capitalize(i),c=await this[h](this.extend(o,a)),l=this.safeValue(c,"result",{}),u=this.safeValue(l,"order");return this.parseOrder(u,n)}async cancelOrder(e,t,i={}){await this.signIn(),await this.loadMarkets();const s={order_id:e},r=await this.privatePostCancel(this.extend(s,i)),a=this.safeValue(r,"result",{});return this.parseOrder(a)}async cancelAllOrders(e,t={}){if(void 0===e)throw new g(this.id+" cancelAllOrders() requires a symbol argument");await this.signIn(),await this.loadMarkets();const i={instrument_name:this.market(e).id};return await this.privatePostCancelAllByInstrument(this.extend(i,t))}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new g(this.id+" fetchOpenOrders() requires a symbol argument");await this.signIn(),await this.loadMarkets();const r=this.market(e),a={instrument_name:r.id},n=await this.privateGetGetOpenOrdersByInstrument(this.extend(a,s)),o=this.safeValue(n,"result",[]);return this.parseOrders(o,r,t,i)}async fetchClosedOrders(e,t,i,s={}){if(void 0===e)throw new g(this.id+" fetchClosedOrders() requires a symbol argument");await this.signIn(),await this.loadMarkets();const r=this.market(e),a={instrument_name:r.id};void 0!==i&&(a.count=i);const n=await this.privateGetGetOrderHistoryByInstrument(this.extend(a,s)),o=this.safeValue(n,"result",[]);return this.parseOrders(o,r,t,i)}async fetchOrderTrades(e,t,i,s,r={}){if(void 0===e)throw new g(this.id+" fetchOrderTrades() requires a id argument");await this.loadMarkets();const a={order_id:e};void 0!==s&&(a.count=s);const n=await this.privateGetGetUserTradesByOrder(this.extend(a,r)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"trades",[]);return this.parseTrades(h,void 0,i,s)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new g(this.id+" fetchMyTrades() requires a id argument");await this.signIn(),await this.loadMarkets();const r={};let a;const n=this.market(e);r.instrument_name=n.id,a=void 0===t?"privateGetGetUserTradesByInstrument":"privateGetGetUserTradesByInstrumentAndTime",void 0!==i&&(r.count=i);const o=await this[a](this.extend(r,s)),h=this.safeValue(o,"result",{}),d=this.safeValue(h,"trades",[]);return this.parseTrades(d,n,t,i)}parsePosition(e,t){const i=this.safeString(e,"instrument_name");t=this.safeMarket(i,t);const s=this.safeString(e,"size");let r=this.safeString(e,"direction");r="buy"===r?"long":"short";const a=this.safeString(e,"maintenance_margin"),n=this.safeString(e,"risk_level"),o=y.stringDiv(a,n),h=this.safeString(e,"mark_price"),d=y.stringMul(h,s),c=this.safeString(e,"floating_profit_loss"),l=this.safeString(e,"initial_margin"),u=y.stringMul(y.stringDiv(c,l),"100"),f=this.safeString(e,"margin_type");return{info:e,id:void 0,symbol:this.safeString(t,"symbol"),timestamp:void 0,datetime:void 0,initialMargin:this.parseNumber(l),initialMarginPercentage:this.parseNumber(y.stringDiv(l,d)),maintenanceMargin:this.parseNumber(a),maintenanceMarginPercentage:this.parseNumber(y.stringDiv(a,d)),entryPrice:this.safeNumber(e,"average_price"),notional:this.parseNumber(d),leverage:this.safeNumber(e,"leverage"),unrealizedPnl:this.parseNumber(c),contracts:this.parseNumber(s),contractSize:this.safeValue(t,"contractSize"),marginRatio:this.parseNumber(n),liquidationPrice:this.safeNumber(e,"liquid_price"),markPrice:this.parseNumber(h),collateral:this.parseNumber(o),marginType:f,side:r,percentage:this.parseNumber(u)}}async fetchPosition(e,t={}){await this.signIn(),await this.loadMarkets();const i={instrument_name:this.market(e).id},s=await this.privateGetGetPosition(this.extend(i,t)),r=this.safeValue(s,"result");return this.parsePosition(r)}async fetchPositions(e,t={}){await this.signIn(),await this.loadMarkets();const i=await this.privateGetGetPositions(this.extend({currency:"PERPETUAL"},t)),s=this.safeValue(i,"result");return this.parsePositions(s,e)}parseTransactionStatus(e){return this.safeString({deposit_confirmed:"ok",deposit_waiting_confirm:"pending",withdraw_init:"pending",withdraw_noticed_block_chain:"pending",withdraw_waiting_confirm:"pending",withdraw_confirmed:"ok",withdraw_failed:"failed",withdraw_auditing:"pending",withdraw_audit_reject:"failed"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"coin_type"),s=this.safeCurrencyCode(i,t),r=this.safeString(e,"id"),a=this.safeString(e,"tx_hash"),n=this.safeInteger(e,"create_time"),o=this.safeInteger(e,"update_time"),h=this.safeNumber(e,"amount"),d=this.safeString(e,"state");return{info:e,id:r,txid:a,timestamp:n,datetime:this.iso8601(n),network:void 0,addressFrom:void 0,address:void 0,addressTo:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,type:void 0,amount:h,currency:s,status:this.parseTransactionStatus(d),updated:o,fee:void 0}}async fetchDeposits(e,t,i,s={}){if(void 0===e)throw new g(this.id+" fetchDeposits() requires the code argument");await this.signIn(),await this.loadMarkets();const r=this.safeCurrency(e),a={coin_type:r.id},n=await this.privateGetGetDepositRecord(this.extend(a,s)),o=this.safeValue(n,"result",[]);return this.parseTransactions(o,r,t,i,{type:"deposit"})}async fetchWithdrawals(e,t,i,s={}){if(void 0===e)throw new g(this.id+" fetchWithdrawals() requires the code argument");await this.signIn(),await this.loadMarkets();const r=this.safeCurrency(e),a={coin_type:r.id},n=await this.privateGetGetWithdrawRecord(this.extend(a,s)),o=this.safeValue(n,"result",[]);return this.parseTransactions(o,r,t,i,{type:"withdrawal"})}async fetchWithdrawal(e,t,i={}){if(void 0===t)throw new g(this.id+" fetchWithdrawal() requires the code argument");await this.signIn(),await this.loadMarkets();const s=this.safeCurrency(t),r={coin_type:s.id,withdraw_id:e},a=await this.privateGetGetWithdrawRecord(this.extend(r,i)),n=this.safeValue(a,"result",[]),o=this.filterBy(n,"id",e),h=this.safeValue(o,0);return this.parseTransaction(h,s)}async fetchLeverage(e,t={}){await this.signIn(),await this.loadMarkets();const i={instrument_name:this.market(e).id},s=await this.privateGetGetPerpetualUserConfig(this.extend(i,t)),r=this.safeValue(s,"result",{});return this.safeNumber(r,"leverage")}async fetchMarketLeverageTiers(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.swap)throw new l(this.id+" fetchMarketLeverageTiers() supports swap markets only");const s={instrument_name:i.id},r=await this.publicGetGetPerpetualLeverageBracket(this.extend(s,t)),a=this.safeValue(r,"result",[]);return this.parseMarketLeverageTiers(a,i)}parseMarketLeverageTiers(e,t){const i=[],s=e;for(let e=0;e<s.length;e++){const r=s[e];i.push({tier:this.safeInteger(r,"bracket"),currency:t.settle,minNotional:this.safeNumber(r,"notionalFloor"),maxNotional:this.safeNumber(r,"notionalCap"),maintenanceMarginRate:this.safeNumber(r,"maintenanceMarginRate"),maxLeverage:this.safeNumber(r,"initialLeverage"),info:r})}return i}async fetchLeverageTiers(e,t={}){await this.loadMarkets();const i=await this.publicGetGetPerpetualLeverageBracketAll(t),s=this.safeValue(i,"result",{});return e=this.marketSymbols(e),this.parseLeverageTiers(s,e,"symbol")}parseLeverageTiers(e,t,i){const s={},r={},a=Object.keys(e);for(let i=0;i<a.length;i++){const n=a[i],o=e[n],h=this.safeMarket(n),d=this.safeSymbol(n,h);let c=0;s[d]=this.parseMarketLeverageTiers(o,h),void 0!==t&&(c=t.length,this.inArray(d,t)&&(r[d]=this.parseMarketLeverageTiers(o,h))),void 0===d||0!==c&&!this.inArray(d,t)||(r[d]=this.parseMarketLeverageTiers(o,h))}return r}async setMarginMode(e,t,i={}){this.checkRequiredSymbol("setMarginMode",t),await this.signIn(),await this.loadMarkets();const s=this.market(t);if(!s.swap)throw new l(this.id+" setMarginMode() supports swap contracts only");if("isolated"!==e&&"isolate"!==e&&"cross"!==e)throw new l(this.id+" marginMode must be either isolated or cross");e="isolated"===e?"isolate":"cross";const r={instrument_name:s.id,margin_type:e};return await this.privatePostAdjustPerpetualMarginType(this.extend(r,i))}async setLeverage(e,t,i={}){if(void 0===t)throw new g(this.id+" setLeverage() requires a symbol argument");await this.signIn(),await this.loadMarkets(),this.checkRequiredSymbol("setLeverage",t);const s=this.market(t);if(!s.swap)throw new l(this.id+" setLeverage() supports swap contracts only");if(e<1||e>125)throw new l(this.id+" leverage should be between 1 and 125");const r={instrument_name:s.id,leverage:e};return await this.privatePostAdjustPerpetualLeverage(this.extend(r,i))}async fetchFundingRates(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetCoinGeckoContracts(t),s=this.safeValue(i,"result",[]),r={};for(let t=0;t<s.length;t++){const i=s[t],a=this.safeString(i,"ticker_id"),n=this.safeMarket(a),o=n.symbol;void 0!==e?this.inArray(o,e)&&(r[o]=this.parseFundingRate(i,n)):r[o]=this.parseFundingRate(i,n)}return this.filterByArray(r,"symbol",e)}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e),s=await this.publicGetCoinGeckoContracts(t),r=this.safeValue(s,"result",[]);for(let e=0;e<r.length;e++){const t=r[e];if(this.safeString(t,"ticker_id")===i.id)return this.parseFundingRate(t,i)}return this.parseFundingRate(r,i)}parseFundingRate(e,t){const i=this.safeString(e,"ticker_id"),s=this.safeInteger(e,"next_funding_rate_timestamp");return{info:e,symbol:this.safeSymbol(i,t),markPrice:void 0,indexPrice:this.safeNumber(e,"index_price"),interestRate:void 0,estimatedSettlePrice:void 0,timestamp:void 0,datetime:void 0,fundingRate:this.safeNumber(e,"funding_rate"),fundingTimestamp:s,fundingDatetime:this.iso8601(s),nextFundingRate:void 0,nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async transfer(e,t,i,s,r={}){await this.signIn(),await this.loadMarkets();const a=this.currency(e),n=this.safeValue(this.options,"accountsByType",{}),o=this.safeString(n,i,i),h=this.safeString(n,s,s),d={coin_type:a.id,amount:this.currencyToPrecision(e,t),from:o,to:h},c=await this.privatePostSubmitTransfer(this.extend(d,r));return this.parseTransfer(c,a)}parseTransfer(e,t){return{info:e,id:this.safeString(e,"id"),timestamp:void 0,datetime:void 0,currency:void 0,amount:void 0,fromAccount:void 0,toAccount:void 0,status:void 0}}async fetchOpenInterest(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.contract)throw new l(this.id+" fetchOpenInterest() supports contract markets only");const s=await this.publicGetCoinGeckoContracts(t),r=this.safeValue(s,"result",[]);for(let e=0;e<r.length;e++){const t=r[e];if(this.safeString(t,"ticker_id")===i.id)return this.parseOpenInterest(t,i)}return this.parseOpenInterest(r,i)}parseOpenInterest(e,t){const i=this.safeString(e,"ticker_id");t=this.safeMarket(i,t);const s=this.safeNumber(e,"open_interest");return{info:e,symbol:t.symbol,baseVolume:s,quoteVolume:void 0,openInterestAmount:s,openInterestValue:void 0,timestamp:void 0,datetime:void 0}}sign(e,t="public",i="GET",s={},r,a){let n="/api/"+this.version+"/"+t+"/"+e;if("public"===t&&Object.keys(s).length&&(n+="?"+this.urlencode(s)),"private"===t){this.checkRequiredCredentials(),"GET"===i&&Object.keys(s).length&&(n+="?"+this.urlencode(s));const o=this.safeString(this.options,"accessToken");if(void 0===o)throw new p(this.id+" sign() requires access token");if(r={Authorization:"bearer "+o},"POST"===i&&(r["Content-Type"]="application/json",Object.keys(s).length)){const i={jsonrpc:"2.0",id:this.nonce(),method:"/"+t+"/"+e,params:s};a=this.json(i)}}return{url:this.urls.api.rest+n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,n,o,h,d){if(void 0===o)return;const c=this.safeValue(o,"error");if(c){const e=this.id+" "+n,t=this.safeString(c,"code"),i=this.safeString(c,"message");throw this.throwExactlyMatchedException(this.exceptions.exact,t,e),this.throwBroadlyMatchedException(this.exceptions.broad,i,e),new a(e)}}}},69284:function(e,t,i){"use strict";const s=i(48819),{ArgumentsRequired:r,ExchangeError:a,OrderNotFound:n,InvalidOrder:o,InsufficientFunds:h,DDoSProtection:d,BadRequest:c}=i(73449),{TICK_SIZE:l}=i(62115),u=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"btcmarkets",name:"BTC Markets",countries:["AU"],rateLimit:1e3,version:"v3",has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,cancelOrders:!0,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:"emulated",fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTime:!0,fetchTrades:!0,fetchTransactions:!0,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/51840849/89731817-b3fb8480-da52-11ea-817f-783b08aaf32b.jpg",api:{public:"https://api.btcmarkets.net",private:"https://api.btcmarkets.net"},www:"https://btcmarkets.net",doc:["https://api.btcmarkets.net/doc/v3","https://github.com/BTCMarkets/API"]},api:{public:{get:["markets","markets/{marketId}/ticker","markets/{marketId}/trades","markets/{marketId}/orderbook","markets/{marketId}/candles","markets/tickers","markets/orderbooks","time"]},private:{get:["orders","orders/{id}","batchorders/{ids}","trades","trades/{id}","withdrawals","withdrawals/{id}","deposits","deposits/{id}","transfers","transfers/{id}","addresses","withdrawal-fees","assets","accounts/me/trading-fees","accounts/me/withdrawal-limits","accounts/me/balances","accounts/me/transactions","reports/{id}"],post:["orders","batchorders","withdrawals","reports"],delete:["orders","orders/{id}","batchorders/{ids}"],put:["orders/{id}"]}},timeframes:{"1m":"1m","1h":"1h","1d":"1d"},precisionMode:l,exceptions:{3:o,6:d,InsufficientFund:h,InvalidPrice:o,InvalidAmount:o,MissingArgument:o,OrderAlreadyCancelled:o,OrderNotFound:n,OrderStatusIsFinal:o,InvalidPaginationParameter:c},fees:{percentage:!0,tierBased:!0,maker:this.parseNumber("-0.0005"),taker:this.parseNumber("0.0020")},options:{fees:{AUD:{maker:this.parseNumber("0.0085"),taker:this.parseNumber("0.0085")}}}})}async fetchTransactionsWithMethod(e,t,i,s,r={}){await this.loadMarkets();const a={};let n;void 0!==s&&(a.limit=s),void 0!==i&&(a.after=i),void 0!==t&&(n=this.currency(t));const o=await this[e](this.extend(a,r));return this.parseTransactions(o,n,i,s)}async fetchTransactions(e,t,i,s={}){return await this.fetchTransactionsWithMethod("privateGetTransfers",e,t,i,s)}async fetchDeposits(e,t,i,s={}){return await this.fetchTransactionsWithMethod("privateGetDeposits",e,t,i,s)}async fetchWithdrawals(e,t,i,s={}){return await this.fetchTransactionsWithMethod("privateGetWithdrawals",e,t,i,s)}parseTransactionStatus(e){return this.safeString({Accepted:"pending","Pending Authorization":"pending",Complete:"ok",Cancelled:"cancelled",Failed:"failed"},e,e)}parseTransactionType(e){return this.safeString({Withdraw:"withdrawal",Deposit:"deposit"},e,e)}parseTransaction(e,t){const i=this.parse8601(this.safeString(e,"creationTime")),s=this.parse8601(this.safeString(e,"lastUpdate"));let r=this.parseTransactionType(this.safeStringLower(e,"type"));"withdraw"===r&&(r="withdrawal");const a=this.safeValue(e,"paymentDetail",{}),n=this.safeString(a,"txId");let o,h=this.safeString(a,"address");if(void 0!==h){const e=h.split("?dt=");e.length>1&&(h=e[0],o=e[1])}const d=h,c=o,l=this.safeNumber(e,"fee"),u=this.parseTransactionStatus(this.safeString(e,"status")),f=this.safeString(e,"assetName"),p=this.safeCurrencyCode(f);let m=this.safeNumber(e,"amount");return l&&(m-=l),{id:this.safeString(e,"id"),txid:n,timestamp:i,datetime:this.iso8601(i),network:void 0,address:h,addressTo:d,addressFrom:undefined,tag:o,tagTo:c,tagFrom:undefined,type:r,amount:m,currency:p,status:u,updated:s,comment:void 0,fee:{currency:p,cost:l,rate:void 0},info:e}}async fetchMarkets(e={}){const t=await this.publicGetMarkets(e),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"baseAssetName"),a=this.safeString(s,"quoteAssetName"),n=this.safeString(s,"marketId"),o=this.safeCurrencyCode(r),h=this.safeCurrencyCode(a),d=o+"/"+h,c=this.safeValue(this.safeValue(this.options,"fees",{}),h,this.fees),l=this.parseNumber(this.parsePrecision(this.safeString(s,"priceDecimals"))),u=this.safeNumber(s,"minOrderAmount"),f=this.safeNumber(s,"maxOrderAmount");let p;"AUD"===h&&(p=l),i.push({id:n,symbol:d,base:o,quote:h,settle:void 0,baseId:r,quoteId:a,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,taker:c.taker,maker:c.maker,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(s,"amountDecimals"))),price:l},limits:{leverage:{min:void 0,max:void 0},amount:{min:u,max:f},price:{min:p,max:void 0},cost:{min:void 0,max:void 0}},info:s})}return i}async fetchTime(e={}){const t=await this.publicGetTime(e);return this.parse8601(this.safeString(t,"timestamp"))}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"assetName"),a=this.safeCurrencyCode(r),n=this.account();n.used=this.safeString(s,"locked"),n.total=this.safeString(s,"balance"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetAccountsMeBalances(e);return this.parseBalance(t)}parseOHLCV(e,t){return[this.parse8601(this.safeString(e,0)),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={marketId:a.id,timeWindow:this.safeString(this.timeframes,t,t)};void 0!==i&&(n.from=this.iso8601(i)),void 0!==s&&(n.limit=s);const o=await this.publicGetMarketsMarketIdCandles(this.extend(n,r));return this.parseOHLCVs(o,a,t,i,s)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={marketId:this.market(e).id},r=await this.publicGetMarketsMarketIdOrderbook(this.extend(s,i)),a=this.safeIntegerProduct(r,"snapshotId",.001),n=this.parseOrderBook(r,e,a);return n.nonce=this.safeInteger(r,"snapshotId"),n}parseTicker(e,t){const i=this.safeString(e,"marketId"),s=(t=this.safeMarket(i,t,"-")).symbol,r=this.parse8601(this.safeString(e,"timestamp")),a=this.safeString(e,"lastPrice"),n=this.safeString(e,"volume24h"),o=this.safeString(e,"volumeQte24h"),h=this.safeString(e,"price24h"),d=this.safeString(e,"pricePct24h");return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeString(e,"high24h"),low:this.safeString(e,"low"),bid:this.safeString(e,"bestBid"),bidVolume:void 0,ask:this.safeString(e,"bestAsk"),askVolume:void 0,vwap:void 0,open:void 0,close:a,last:a,previousClose:void 0,change:h,percentage:d,average:void 0,baseVolume:n,quoteVolume:o,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={marketId:i.id},r=await this.publicGetMarketsMarketIdTicker(this.extend(s,t));return this.parseTicker(r,i)}async fetchTicker2(e,t={}){await this.loadMarkets();const i=this.market(e),s={id:i.id},r=await this.publicGetMarketIdTick(this.extend(s,t));return this.parseTicker(r,i)}parseTrade(e,t){const i=this.parse8601(this.safeString(e,"timestamp")),s=this.safeString(e,"marketId"),r="AUD"===(t=this.safeMarket(s,t,"-")).quote?t.quote:t.base;let a=this.safeString(e,"side");"Bid"===a?a="buy":"Ask"===a&&(a="sell");const n=this.safeString(e,"id"),o=this.safeString(e,"price"),h=this.safeString(e,"amount"),d=this.safeString(e,"orderId");let c;const l=this.safeString(e,"fee");void 0!==l&&(c={cost:l,currency:r});const u=this.safeStringLower(e,"liquidityType");return this.safeTrade({info:e,id:n,timestamp:i,datetime:this.iso8601(i),order:d,symbol:t.symbol,type:void 0,side:a,price:o,amount:h,cost:void 0,takerOrMaker:u,fee:c},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={marketId:r.id},n=await this.publicGetMarketsMarketIdTrades(this.extend(a,s));return this.parseTrades(n,r,t,i)}async createOrder(e,t,i,s,a,n={}){await this.loadMarkets();const o=this.market(e),h={marketId:o.id,amount:this.amountToPrecision(e,s),side:"buy"===i?"Bid":"Ask"},d=t.toLowerCase(),c=this.safeValue(this.options,"orderTypes",{limit:"Limit",market:"Market",stop:"Stop","stop limit":"Stop Limit","take profit":"Take Profit"});h.type=this.safeString(c,d,t);let l=!1,u=!1;if("limit"===d?l=!0:"stop limit"===d?(u=!0,l=!0):("take profit"===d||"stop"===d)&&(u=!0),l){if(void 0===a)throw new r(this.id+" createOrder() requires a price argument for a "+t+"order");h.price=this.priceToPrecision(e,a)}if(u){const i=this.safeNumber(n,"triggerPrice");if(n=this.omit(n,"triggerPrice"),void 0===i)throw new r(this.id+" createOrder() requires a triggerPrice parameter for a "+t+"order");h.triggerPrice=this.priceToPrecision(e,i)}const f=this.safeString(n,"clientOrderId");void 0!==f&&(h.clientOrderId=f),n=this.omit(n,"clientOrderId");const p=await this.privatePostOrders(this.extend(h,n));return this.parseOrder(p,o)}async cancelOrders(e,t,i={}){await this.loadMarkets();for(let t=0;t<e.length;t++)e[t]=parseInt(e[t]);const s={ids:e};return await this.privateDeleteBatchordersIds(this.extend(s,i))}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={id:e};return await this.privateDeleteOrdersId(this.extend(s,i))}calculateFee(e,t,i,s,r,a="taker",n={}){const o=this.markets[e];let h,d;if("AUD"===o.quote){h=o.quote;const t=this.numberToString(s),i=this.numberToString(r),a=u.stringMul(t,i);d=this.costToPrecision(e,a)}else h=o.base,d=this.amountToPrecision(e,s);const c=o[a],l=u.stringMul(this.numberToString(c),d);return{type:a,currency:h,rate:c,cost:parseFloat(this.feeToPrecision(e,l))}}parseOrderStatus(e){return this.safeString({Accepted:"open",Placed:"open","Partially Matched":"open","Fully Matched":"closed",Cancelled:"canceled","Partially Cancelled":"canceled",Failed:"rejected"},e,e)}parseOrder(e,t){const i=this.parse8601(this.safeString(e,"creationTime")),s=this.safeString(e,"marketId");t=this.safeMarket(s,t,"-");let r=this.safeString(e,"side");"Bid"===r?r="buy":"Ask"===r&&(r="sell");const a=this.safeStringLower(e,"type"),n=this.safeString(e,"price"),o=this.safeString(e,"amount"),h=this.safeString(e,"openAmount"),d=this.parseOrderStatus(this.safeString(e,"status")),c=this.safeString(e,"orderId"),l=this.safeString(e,"clientOrderId"),u=this.safeString(e,"timeInForce"),f=this.safeNumber(e,"triggerPrice"),p=this.safeValue(e,"postOnly");return this.safeOrder({info:e,id:c,clientOrderId:l,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:void 0,symbol:t.symbol,type:a,timeInForce:u,postOnly:p,side:r,price:n,stopPrice:f,triggerPrice:f,cost:void 0,amount:o,filled:void 0,remaining:h,average:void 0,status:d,trades:void 0,fee:void 0},t)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privateGetOrdersId(this.extend(s,i));return this.parseOrder(r)}async fetchOrders(e,t,i,s={}){await this.loadMarkets();const r={status:"all"};let a;void 0!==e&&(a=this.market(e),r.marketId=a.id),void 0!==t&&(r.after=t),void 0!==i&&(r.limit=i);const n=await this.privateGetOrders(this.extend(r,s));return this.parseOrders(n,a,t,i)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({status:"open"},s))}async fetchClosedOrders(e,t,i,s={}){const r=await this.fetchOrders(e,t,i,s);return this.filterBy(r,"status","closed")}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.marketId=a.id),void 0!==t&&(r.after=t),void 0!==i&&(r.limit=i);const n=await this.privateGetTrades(this.extend(r,s));return this.parseTrades(n,a,t,i)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets();const a=this.currency(e),n={currency_id:a.id,amount:this.currencyToPrecision(e,t)};"AUD"!==e&&(this.checkAddress(i),n.toAddress=i),void 0!==s&&(n.toAddress=i+"?dt="+s);const o=await this.privatePostWithdrawals(this.extend(n,r));return this.parseTransaction(o,a)}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n="/"+this.version+"/"+this.implodeParams(e,s);const o=this.keysort(this.omit(s,this.extractParams(e)));if("private"===t){this.checkRequiredCredentials();const e=this.nonce().toString(),t=this.base64ToBinary(this.encode(this.secret));let s=i+n+e;"GET"===i||"DELETE"===i?Object.keys(o).length&&(n+="?"+this.urlencode(o)):s+=a=this.json(o);const h=this.hmac(this.encode(s),t,"sha512","base64");r={Accept:"application/json","Accept-Charset":"UTF-8","Content-Type":"application/json","BM-AUTH-APIKEY":this.apiKey,"BM-AUTH-TIMESTAMP":e,"BM-AUTH-SIGNATURE":h}}else"public"===t&&Object.keys(o).length&&(n+="?"+this.urlencode(o));return{url:this.urls.api[t]+n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,n,o,h,d){if(void 0!==o){if("success"in o&&!o.success){const e=this.safeString(o,"errorCode"),t=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions,e,t),new a(t)}if(e>=400){const e=this.safeString(o,"code"),t=this.safeString(o,"message"),i=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions,e,i),this.throwExactlyMatchedException(this.exceptions,t,i),new a(i)}}}}},20233:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a}=i(73449),{TICK_SIZE:n}=i(62115),o=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"btctradeua",name:"BTC Trade UA",countries:["UA"],rateLimit:3e3,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createMarketOrder:!1,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkOHLCV:!1,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrderBook:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,signIn:!0},urls:{referral:"https://btc-trade.com.ua/registration/22689",logo:"https://user-images.githubusercontent.com/1294454/27941483-79fc7350-62d9-11e7-9f61-ac47f28fcd96.jpg",api:{rest:"https://btc-trade.com.ua/api"},www:"https://btc-trade.com.ua",doc:"https://docs.google.com/document/d/1ocYA0yMy_RXd561sfG3qEPZ80kyll36HUxvCRe5GbhE/edit"},api:{public:{get:["deals/{symbol}","trades/sell/{symbol}","trades/buy/{symbol}","japan_stat/high/{symbol}"]},private:{post:["auth","ask/{symbol}","balance","bid/{symbol}","buy/{symbol}","my_orders/{symbol}","order/status/{id}","remove/order/{id}","sell/{symbol}"]}},precisionMode:n,markets:{"BCH/UAH":{id:"bch_uah",symbol:"BCH/UAH",base:"BCH",quote:"UAH",baseId:"bch",quoteId:"uah",type:"spot",spot:!0},"BTC/UAH":{id:"btc_uah",symbol:"BTC/UAH",base:"BTC",quote:"UAH",baseId:"btc",quoteId:"uah",precision:{price:this.parseNumber("1e-1")},limits:{amount:{min:this.parseNumber("1e-10")}},type:"spot",spot:!0},"DASH/BTC":{id:"dash_btc",symbol:"DASH/BTC",base:"DASH",quote:"BTC",baseId:"dash",quoteId:"btc",type:"spot",spot:!0},"DASH/UAH":{id:"dash_uah",symbol:"DASH/UAH",base:"DASH",quote:"UAH",baseId:"dash",quoteId:"uah",type:"spot",spot:!0},"DOGE/BTC":{id:"doge_btc",symbol:"DOGE/BTC",base:"DOGE",quote:"BTC",baseId:"doge",quoteId:"btc",type:"spot",spot:!0},"DOGE/UAH":{id:"doge_uah",symbol:"DOGE/UAH",base:"DOGE",quote:"UAH",baseId:"doge",quoteId:"uah",type:"spot",spot:!0},"ETH/UAH":{id:"eth_uah",symbol:"ETH/UAH",base:"ETH",quote:"UAH",baseId:"eth",quoteId:"uah",type:"spot",spot:!0},"ITI/UAH":{id:"iti_uah",symbol:"ITI/UAH",base:"ITI",quote:"UAH",baseId:"iti",quoteId:"uah",type:"spot",spot:!0},"KRB/UAH":{id:"krb_uah",symbol:"KRB/UAH",base:"KRB",quote:"UAH",baseId:"krb",quoteId:"uah",type:"spot",spot:!0},"LTC/BTC":{id:"ltc_btc",symbol:"LTC/BTC",base:"LTC",quote:"BTC",baseId:"ltc",quoteId:"btc",type:"spot",spot:!0},"LTC/UAH":{id:"ltc_uah",symbol:"LTC/UAH",base:"LTC",quote:"UAH",baseId:"ltc",quoteId:"uah",type:"spot",spot:!0},"NVC/BTC":{id:"nvc_btc",symbol:"NVC/BTC",base:"NVC",quote:"BTC",baseId:"nvc",quoteId:"btc",type:"spot",spot:!0},"NVC/UAH":{id:"nvc_uah",symbol:"NVC/UAH",base:"NVC",quote:"UAH",baseId:"nvc",quoteId:"uah",type:"spot",spot:!0},"PPC/BTC":{id:"ppc_btc",symbol:"PPC/BTC",base:"PPC",quote:"BTC",baseId:"ppc",quoteId:"btc",type:"spot",spot:!0},"SIB/UAH":{id:"sib_uah",symbol:"SIB/UAH",base:"SIB",quote:"UAH",baseId:"sib",quoteId:"uah",type:"spot",spot:!0},"XMR/UAH":{id:"xmr_uah",symbol:"XMR/UAH",base:"XMR",quote:"UAH",baseId:"xmr",quoteId:"uah",type:"spot",spot:!0},"ZEC/UAH":{id:"zec_uah",symbol:"ZEC/UAH",base:"ZEC",quote:"UAH",baseId:"zec",quoteId:"uah",type:"spot",spot:!0}},fees:{trading:{maker:this.parseNumber("0.001"),taker:this.parseNumber("0.001")}}})}async signIn(e={}){return await this.privatePostAuth(e)}parseBalance(e){const t={info:e},i=this.safeValue(e,"accounts",[]);for(let e=0;e<i.length;e++){const s=i[e],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(s,"balance"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostBalance(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id},a=await this.publicGetTradesBuySymbol(this.extend(r,i)),n=await this.publicGetTradesSellSymbol(this.extend(r,i)),o={bids:[],asks:[]};return a&&"list"in a&&(o.bids=a.list),n&&"list"in n&&(o.asks=n.list),this.parseOrderBook(o,s.symbol,void 0,"bids","asks","price","currency_trade")}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.milliseconds(),r={symbol:i,timestamp:s,datetime:this.iso8601(s),high:void 0,low:void 0,bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:void 0,close:void 0,last:void 0,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:void 0,quoteVolume:void 0,info:e},a=e.length;if(a>0){for(let t=Math.max(a-48,0);t<e.length;t++){const i=e[t];void 0===r.open&&(r.open=this.safeString(i,1));const s=this.safeString(i,2);(void 0===r.high||void 0!==s&&o.stringLt(r.high,s))&&(r.high=s);const a=this.safeString(i,3);(void 0===r.low||void 0!==a&&o.stringLt(r.low,a))&&(r.low=a);const n=this.safeString(i,5);void 0===r.baseVolume?r.baseVolume=n:r.baseVolume=o.stringAdd(r.baseVolume,n)}const t=a-1;r.last=this.safeString(e[t],4),r.close=r.last}return this.safeTicker(r,t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetJapanStatHighSymbol(this.extend(s,t)),a=this.safeValue(r,"trades");return this.parseTicker(a,i)}convertMonthNameToString(e){return this.safeString({Jan:"01",Feb:"02",Mar:"03",Apr:"04",May:"05",Jun:"06",Jul:"07",Aug:"08",Sept:"09",Oct:"10",Nov:"11",Dec:"12"},e)}parseExchangeSpecificDatetime(e){const t=e.split(" ");let i=t[0],s=t[1].replace(",","");s.length<2&&(s="0"+s);const a=t[2].replace(",","");if(i=i.replace(",",""),i=i.replace(".",""),i=this.convertMonthNameToString(i),!i)throw new r(this.id+" parseTrade() unrecognized month name: "+e);const n=t[3].split(":");let o=this.safeString(n,0),h="00";const d=this.safeString(t,4);if("noon"===o)o="12";else{let e=parseInt(o);void 0!==d&&"p"===d[0]&&(e=12+e,e>23&&(e=0)),o=e.toString(),o.length<2&&(o="0"+o),h=this.safeString(n,1,"00"),h.length<2&&(h="0"+h)}const c=[a,i,s].join("-")+"T"+o+":"+h+":00",l=this.parse8601(c),u=parseInt(h);return u<11||u>2?l-72e5:l-108e5}parseTrade(e,t){const i=this.parseExchangeSpecificDatetime(this.safeString(e,"pub_date")),s=this.safeString(e,"id"),r=this.safeString(e,"type"),a=this.safeString(e,"price"),n=this.safeString(e,"amnt_trade");return t=this.safeMarket(void 0,t),this.safeTrade({id:s,info:e,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,type:"limit",side:r,order:void 0,takerOrMaker:void 0,price:a,amount:n,cost:void 0,fee:void 0},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id},n=await this.publicGetDealsSymbol(this.extend(a,s)),o=[];for(let e=0;e<n.length;e++){this.safeInteger(n[e],"id")%2&&o.push(n[e])}return this.parseTrades(o,r,t,i)}async createOrder(e,t,i,s,a,n={}){if("market"===t)throw new r(this.id+" createOrder() allows limit orders only");await this.loadMarkets();const o=this.market(e),h="privatePost"+this.capitalize(i)+"Id",d={count:s,currency1:o.quoteId,currency:o.baseId,price:a};return this[h](this.extend(d,n))}async cancelOrder(e,t,i={}){const s={id:e};return await this.privatePostRemoveOrderId(this.extend(s,i))}parseOrder(e,t){const i=this.milliseconds(),s=this.safeSymbol(void 0,t),r=this.safeString(e,"type"),a=this.safeString(e,"price"),n=this.safeString(e,"amnt_trade"),o=this.safeString(e,"amnt_trade");return this.safeOrder({id:this.safeString(e,"id"),clientOrderId:void 0,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:void 0,status:"open",symbol:s,type:void 0,timeInForce:void 0,postOnly:void 0,side:r,price:a,stopPrice:void 0,triggerPrice:void 0,amount:n,filled:void 0,remaining:o,trades:void 0,info:e,cost:void 0,average:void 0,fee:void 0},t)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={symbol:r.id},o=await this.privatePostMyOrdersSymbol(this.extend(n,s)),h=this.safeValue(o,"your_open_orders");return this.parseOrders(h,r,t,i)}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if("public"===t)Object.keys(o).length&&(n+=this.implodeParams(e,o));else{this.checkRequiredCredentials();const e=this.nonce(),t=(a=this.urlencode(this.extend({out_order_id:e,nonce:e},o)))+this.secret;r={"public-key":this.apiKey,"api-sign":this.hash(this.encode(t),"sha256"),"Content-Type":"application/x-www-form-urlencoded"}}return{url:n,method:i,body:a,headers:r}}}},51899:function(e,t,i){"use strict";const s=i(48819),{BadRequest:r,ExchangeError:a,InsufficientFunds:n,InvalidOrder:o}=i(73449),{TICK_SIZE:h}=i(62115),d=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"btcturk",name:"BTCTurk",countries:["TR"],rateLimit:100,has:{CORS:!0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1},timeframes:{"1m":1,"15m":15,"30m":30,"1h":60,"4h":240,"1d":"1 day","1w":"1 week","1y":"1 year"},urls:{logo:"https://user-images.githubusercontent.com/51840849/87153926-efbef500-c2c0-11ea-9842-05b63612c4b9.jpg",api:{public:"https://api.btcturk.com/api/v2",private:"https://api.btcturk.com/api/v1",graph:"https://graph-api.btcturk.com/v1"},www:"https://www.btcturk.com",doc:"https://github.com/BTCTrader/broker-api-docs"},api:{public:{get:{orderbook:1,ticker:.1,trades:1,"server/exchangeinfo":1}},private:{get:{"users/balances":1,openOrders:1,allOrders:1,"users/transactions/trade":1},post:{order:1,cancelOrder:1},delete:{order:1}},graph:{get:{ohlcs:1,"klines/history":1}}},fees:{trading:{maker:this.parseNumber("0.0005"),taker:this.parseNumber("0.0009")}},exceptions:{exact:{FAILED_ORDER_WITH_OPEN_ORDERS:n,FAILED_LIMIT_ORDER:o,FAILED_MARKET_ORDER:o}},precisionMode:h})}async fetchMarkets(e={}){const t=await this.publicGetServerExchangeinfo(e),i=this.safeValue(t,"data"),s=this.safeValue(i,"symbols",[]),r=[];for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"name"),a=this.safeString(t,"numerator"),n=this.safeString(t,"denominator"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=this.safeValue(t,"filters",[]);let c,l,u,f,p;for(let e=0;e<d.length;e++){const t=d[e];"PRICE_FILTER"===this.safeString(t,"filterType")&&(c=this.safeNumber(t,"minPrice"),l=this.safeNumber(t,"maxPrice"),u=this.safeNumber(t,"minAmount"),f=this.safeNumber(t,"maxAmount"),p=this.safeNumber(t,"minExchangeValue"))}const m=this.safeString(t,"status");r.push({id:i,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:"TRADING"===m,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"numeratorScale"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"denominatorScale")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:u,max:f},price:{min:c,max:l},cost:{min:p,max:void 0}},info:t})}return r}parseBalance(e){const t=this.safeValue(e,"data",[]),i={info:e,timestamp:void 0,datetime:void 0};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"asset"),a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(s,"balance"),n.free=this.safeString(s,"free"),n.used=this.safeString(s,"locked"),i[a]=n}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetUsersBalances(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={pairSymbol:s.id},a=await this.publicGetOrderbook(this.extend(r,i)),n=this.safeValue(a,"data"),o=this.safeInteger(n,"timestamp");return this.parseOrderBook(n,s.symbol,o,"bids","asks",0,1)}parseTicker(e,t){const i=this.safeString(e,"pair"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeInteger(e,"timestamp"),a=this.safeString(e,"last");return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:this.safeString(e,"open"),close:a,last:a,previousClose:void 0,change:this.safeString(e,"daily"),percentage:this.safeString(e,"dailyPercent"),average:this.safeString(e,"average"),baseVolume:this.safeString(e,"volume"),quoteVolume:void 0,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetTicker(t),s=this.safeValue(i,"data");return this.parseTickers(s,e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=await this.fetchTickers([e],t);return this.safeValue(i,e)}parseTrade(e,t){const i=this.safeInteger2(e,"date","timestamp"),s=this.safeString2(e,"tid","id"),r=this.safeString(e,"orderId"),a=this.safeString(e,"price"),n=d.stringAbs(this.safeString(e,"amount")),o=this.safeString(e,"pair"),h=this.safeSymbol(o,t),c=this.safeString2(e,"side","orderType");let l;const u=this.safeString(e,"fee");if(void 0!==u){const t=this.safeString(e,"denominatorSymbol");l={cost:d.stringAbs(u),currency:this.safeCurrencyCode(t)}}return this.safeTrade({info:e,id:s,order:r,timestamp:i,datetime:this.iso8601(i),symbol:h,type:void 0,side:c,takerOrMaker:void 0,price:a,amount:n,cost:void 0,fee:l},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pairSymbol:r.id};void 0!==i&&(a.last=i);const n=await this.publicGetTrades(this.extend(a,s)),o=this.safeValue(n,"data");return this.parseTrades(o,r,t,i)}parseOHLCV(e,t){return[this.safeTimestamp(e,"timestamp"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="1h",i,s,a={}){await this.loadMarkets();const n=this.market(e),o={symbol:n.id,resolution:this.safeValue(this.timeframes,t,t)},h=this.safeInteger(a,"until",this.milliseconds());if(o.to=parseInt(h/1e3),void 0!==i?o.from=parseInt(i/1e3):void 0===s&&(s=100),void 0!==s){if("1y"===t)throw new r(this.id+' fetchOHLCV () does not accept a limit parameter when timeframe == "1y"');const e=this.parseTimeframe(t)*(s-1);if(void 0!==i){const t=parseInt(i/1e3)+e;o.to=Math.min(o.to,t)}else o.from=parseInt(h/1e3)-e}const d=await this.graphGetKlinesHistory(this.extend(o,a));return this.parseOHLCVs(d,n,t,i,s)}parseOHLCVs(e,t,i="1m",s,r){const a=[],n=this.safeValue(e,"t"),o=this.safeValue(e,"h"),h=this.safeValue(e,"o"),d=this.safeValue(e,"l"),c=this.safeValue(e,"c"),l=this.safeValue(e,"v");for(let e=0;e<n.length;e++){const i={timestamp:this.safeValue(n,e),high:this.safeValue(o,e),open:this.safeValue(h,e),low:this.safeValue(d,e),close:this.safeValue(c,e),volume:this.safeValue(l,e)};a.push(this.parseOHLCV(i,t))}const u=this.sortBy(a,0),f=void 0===s;return this.filterBySinceLimit(u,s,r,0,f)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={orderType:i,orderMethod:t,pairSymbol:n.id,quantity:this.amountToPrecision(e,s)};"market"!==t&&(o.price=this.priceToPrecision(e,r)),"clientOrderId"in a?o.newClientOrderId=a.clientOrderId:"newClientOrderId"in a||(o.newClientOrderId=this.uuid());const h=await this.privatePostOrder(this.extend(o,a)),d=this.safeValue(h,"data");return this.parseOrder(d,n)}async cancelOrder(e,t,i={}){const s={id:e};return await this.privateDeleteOrder(this.extend(s,i))}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.pairSymbol=a.id);const n=await this.privateGetOpenOrders(this.extend(r,s)),o=this.safeValue(n,"data"),h=this.safeValue(o,"bids",[]),d=this.safeValue(o,"asks",[]);return this.parseOrders(this.arrayConcat(h,d),a,t,i)}async fetchOrders(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pairSymbol:r.id};void 0!==i&&(a.last=i),void 0!==t&&(a.startTime=Math.floor(t/1e3));const n=await this.privateGetAllOrders(this.extend(a,s)),o=this.safeValue(n,"data");return this.parseOrders(o,r,t,i)}parseOrderStatus(e){return this.safeString({Untouched:"open",Partial:"open",Canceled:"canceled",Closed:"closed"},e,e)}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"price"),r=this.safeString2(e,"amount","quantity"),a=d.stringAbs(r),n=this.safeString(e,"leftAmount"),o=this.safeString(e,"pairSymbol"),h=this.safeSymbol(o,t),c=this.safeString(e,"type"),l=this.safeString(e,"method"),u=this.safeString(e,"orderClientId"),f=this.safeInteger2(e,"updateTime","datetime"),p=this.safeString(e,"status"),m=this.parseOrderStatus(p);return this.safeOrder({info:e,id:i,price:s,amount:a,remaining:n,filled:void 0,cost:void 0,average:void 0,status:m,side:c,type:l,clientOrderId:u,timestamp:f,datetime:this.iso8601(f),symbol:h,fee:void 0},t)}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e));const a=await this.privateGetUsersTransactionsTrade(),n=this.safeValue(a,"data");return this.parseTrades(n,r,t,i)}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,n){if("btctrader"===this.id)throw new a(this.id+" is an abstract base API for BTCExchange, BTCTurk");let o=this.urls.api[t]+"/"+e;if("GET"===i||"DELETE"===i?Object.keys(s).length&&(o+="?"+this.urlencode(s)):n=this.json(s),"private"===t){this.checkRequiredCredentials();const e=this.nonce().toString(),t=this.base64ToBinary(this.secret),i=this.apiKey+e;r={"X-PCK":this.apiKey,"X-Stamp":e,"X-Signature":this.hmac(this.encode(i),t,"sha256","base64"),"Content-Type":"application/json"}}return{url:o,method:i,body:n,headers:r}}handleErrors(e,t,i,s,r,n,o,h,d){const c=this.safeString(o,"code","0"),l=this.safeString(o,"message"),u=void 0===l?n:l;if(this.throwExactlyMatchedException(this.exceptions.exact,l,this.id+" "+u),"0"!==c&&"SUCCESS"!==c)throw new a(this.id+" "+u)}}},64875:function(e,t,i){"use strict";const s=i(48819),{AddressPending:r,AuthenticationError:a,ExchangeError:n,NotSupported:o,PermissionDenied:h,ArgumentsRequired:d}=i(73449),{TICK_SIZE:c}=i(62115),l=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"buda",name:"Buda",countries:["AR","CL","CO","PE"],rateLimit:1e3,version:"v2",has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createDepositAddress:!0,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!1,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransactionFees:!0,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!1,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/47380619-8a029200-d706-11e8-91e0-8a391fe48de3.jpg",api:{rest:"https://www.buda.com/api"},www:"https://www.buda.com",doc:"https://api.buda.com",fees:"https://www.buda.com/comisiones"},status:{status:"error",updated:void 0,eta:void 0,url:void 0},api:{public:{get:["pairs","markets","currencies","markets/{market}","markets/{market}/ticker","markets/{market}/volume","markets/{market}/order_book","markets/{market}/trades","currencies/{currency}/fees/deposit","currencies/{currency}/fees/withdrawal","tv/history"],post:["markets/{market}/quotations"]},private:{get:["balances","balances/{currency}","currencies/{currency}/balances","orders","orders/{id}","markets/{market}/orders","deposits","currencies/{currency}/deposits","withdrawals","currencies/{currency}/withdrawals","currencies/{currency}/receive_addresses","currencies/{currency}/receive_addresses/{id}"],post:["markets/{market}/orders","currencies/{currency}/deposits","currencies/{currency}/withdrawals","currencies/{currency}/simulated_withdrawals","currencies/{currency}/receive_addresses"],put:["orders/{id}"]}},timeframes:{"1m":"1","5m":"5","30m":"30","1h":"60","2h":"120","1d":"D","1w":"W"},fees:{trading:{tierBased:!0,percentage:!0,taker:.008,maker:.004,tiers:{taker:[[0,.008],[2e3,.007],[2e4,.006],[1e5,.005],[5e5,.004],[25e5,.003],[125e5,.002]],maker:[[0,.004],[2e3,.0035],[2e4,.003],[1e5,.0025],[5e5,.002],[25e5,.0015],[125e5,.001]]}}},precisionMode:c,exceptions:{not_authorized:a,forbidden:h,invalid_record:n,not_found:n,parameter_missing:n,bad_parameter:n}})}async fetchCurrencyInfo(e,t){if(!t){const e=await this.publicGetCurrencies();t=this.safeValue(e,"currencies")}for(let i=0;i<t.length;i++){const s=t[i];if(s.id===e)return s}}async fetchMarkets(e={}){const t=await this.publicGetMarkets(e),i=this.safeValue(t,"markets",[]),s=await this.publicGetCurrencies(),r=this.safeValue(s,"currencies"),a=[];for(let e=0;e<i.length;e++){const t=i[e],s=this.safeString(t,"base_currency"),n=this.safeString(t,"quote_currency"),o=this.safeCurrencyCode(s),h=this.safeCurrencyCode(n),d=await this.fetchCurrencyInfo(s,r),c=await this.fetchCurrencyInfo(n,r),u=this.safeValue(t,"minimum_order_amount",[]),f=this.safeString(t,"taker_fee"),p=this.safeString(t,"maker_fee");a.push({id:this.safeString(t,"id"),symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:s,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:!0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,taker:this.parseNumber(l.stringDiv(f,"1000")),maker:this.parseNumber(l.stringDiv(p,"1000")),precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(d,"input_decimals"))),price:this.parseNumber(this.parsePrecision(this.safeString(c,"input_decimals")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(u,0),max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return a}async fetchCurrencies(e={}){const t=(await this.publicGetCurrencies()).currencies,i={};for(let e=0;e<t.length;e++){const s=t[e];if(!this.safeValue(s,"managed",!1))continue;const r=this.safeString(s,"id"),a=this.safeCurrencyCode(r),n=this.parseNumber(this.parsePrecision(this.safeString(s,"input_decimals"))),o=this.safeValue(s,"deposit_minimum",[]),h=this.safeValue(s,"withdrawal_minimum",[]),d=this.safeNumber(o,0),c=this.safeNumber(h,0);i[a]={id:r,code:a,info:s,name:void 0,active:!0,deposit:void 0,withdraw:void 0,fee:void 0,precision:n,limits:{amount:{min:n,max:void 0},deposit:{min:d,max:void 0},withdraw:{min:c}}}}return i}async fetchTransactionFees(e,t={}){await this.loadMarkets();const i={},s={},r={};void 0===e&&(e=Object.keys(this.currencies));for(let t=0;t<e.length;t++){const a=e[t],n={currency:this.currency(a).id},o=await this.publicGetCurrenciesCurrencyFeesWithdrawal(n),h=await this.publicGetCurrenciesCurrencyFeesDeposit(n);i[a]=this.parseTransactionFee(o.fee),s[a]=this.parseTransactionFee(h.fee),r[a]={withdraw:o,deposit:h}}return{withdraw:i,deposit:s,info:r}}parseTransactionFee(e,t){return void 0===t&&(t=e.name),"withdrawal"===t&&(t="withdraw"),{type:t,currency:e.base[1],rate:e.percent,cost:parseFloat(e.base[0])}}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={market:i.id},r=await this.publicGetMarketsMarketTicker(this.extend(s,t)),a=this.safeValue(r,"ticker");return this.parseTicker(a,i)}parseTicker(e,t){const i=this.milliseconds(),s=this.safeString(e,"market_id"),r=this.safeSymbol(s,t,"-"),a=this.safeValue(e,"last_price",[]),n=this.safeString(a,0);let o=this.safeString(e,"price_variation_24h");o=l.stringMul(o,"100");const h=this.safeValue(e,"max_bid",[]),d=this.safeValue(e,"min_ask",[]),c=this.safeValue(e,"volume",[]);return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:void 0,low:void 0,bid:this.safeString(h,0),bidVolume:void 0,ask:this.safeString(d,0),askVolume:void 0,vwap:void 0,open:void 0,close:n,last:n,previousClose:void 0,change:void 0,percentage:o,average:void 0,baseVolume:this.safeString(c,0),quoteVolume:void 0,info:e},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={market:r.id};void 0!==i&&(a.limit=i);const n=await this.publicGetMarketsMarketTrades(this.extend(a,s));return this.parseTrades(n.trades.entries,r,t,i)}parseTrade(e,t){let i,s;let r,a,n;let o;return t&&(o=t.symbol),Array.isArray(e)&&(i=this.safeInteger(e,0),r=this.safeString(e,1),a=this.safeString(e,2),s=this.safeString(e,3),n=this.safeString(e,4)),this.safeTrade({id:n,order:undefined,info:e,timestamp:i,datetime:this.iso8601(i),symbol:o,type:undefined,side:s,takerOrMaker:void 0,price:r,amount:a,cost:void 0,fee:undefined},t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={market:s.id},a=await this.publicGetMarketsMarketOrderBook(this.extend(r,i)),n=this.safeValue(a,"order_book");return this.parseOrderBook(n,s.symbol)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);void 0===i&&(i=this.milliseconds()-864e5);const n={symbol:a.id,resolution:this.safeString(this.timeframes,t,t),from:i/1e3,to:this.seconds()},o=await this.publicGetTvHistory(this.extend(n,r));return this.parseTradingViewOHLCV(o,a,t,i,s)}parseBalance(e){const t={info:e},i=this.safeValue(e,"balances",[]);for(let e=0;e<i.length;e++){const s=i[e],r=this.safeString(s,"id"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s.available_amount,0),n.total=this.safeString(s.amount,0),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetBalances(e);return this.parseBalance(t)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={id:parseInt(e)},r=await this.privateGetOrdersId(this.extend(s,i)),a=this.safeValue(r,"order");return this.parseOrder(a)}async fetchOrders(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e));const a={market:r.id,per:i},n=await this.privateGetMarketsMarketOrders(this.extend(a,s)),o=this.safeValue(n,"orders");return this.parseOrders(o,r,t,i)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({state:"pending"},s))}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({state:"traded"},s))}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets(),i="buy"===i?"Bid":"Ask";const n={market:this.market(e).id,price_type:t,type:i,amount:this.amountToPrecision(e,s)};"limit"===t&&(n.limit=this.priceToPrecision(e,r));const o=await this.privatePostMarketsMarketOrders(this.extend(n,a)),h=this.safeValue(o,"order");return this.parseOrder(h)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={id:parseInt(e),state:"canceling"},r=await this.privatePutOrdersId(this.extend(s,i)),a=this.safeValue(r,"order");return this.parseOrder(a)}parseOrderStatus(e){return this.safeString({traded:"closed",received:"open",canceling:"canceled"},e,e)}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.parse8601(this.safeString(e,"created_at")),r=this.iso8601(s),a=this.safeString(e,"market_id"),n=this.safeSymbol(a,t,"-"),o=this.safeString(e,"price_type"),h=this.safeStringLower(e,"type"),d=this.parseOrderStatus(this.safeString(e,"state")),c=this.safeValue(e,"original_amount",[]),l=this.safeString(c,0),u=this.safeValue(e,"amount",[]),f=this.safeString(u,0),p=this.safeValue(e,"traded_amount",[]),m=this.safeString(p,0),g=this.safeValue(e,"total_exchanged",[]),y=this.safeString(g,0),b=this.safeValue(e,"limit",[]);let v=this.safeString(b,0);void 0===v&&void 0!==b&&(v=b);const w=this.safeValue(e,"paid_fee",[]),S=this.safeString(w,0);let k;if(void 0!==S){const e=this.safeString(w,1),t=this.safeCurrencyCode(e);k={cost:S,code:t,currency:t}}return this.safeOrder({info:e,id:i,clientOrderId:void 0,datetime:r,timestamp:s,lastTradeTimestamp:void 0,status:d,symbol:n,type:o,timeInForce:void 0,postOnly:void 0,side:h,price:v,stopPrice:void 0,triggerPrice:void 0,average:void 0,cost:y,amount:l,filled:m,remaining:f,trades:void 0,fee:k},t)}isFiat(e){return this.safeValue({ARS:!0,CLP:!0,COP:!0,PEN:!0},e,!1)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e);if(this.isFiat(e))throw new o(this.id+" fetchDepositAddress() for fiat "+e+" is not supported");const s={currency:i.id},a=await this.privateGetCurrenciesCurrencyReceiveAddresses(this.extend(s,t)),n=this.safeValue(a,"receive_addresses"),h=[];for(let e=1;e<n.length;e++){const t=n[e];if(t.ready){const e=t.address;this.checkAddress(e),h.push(e)}}if(h.length<1)throw new r(this.id+": there are no addresses ready for receiving "+e+", retry again later)");return{currency:e,address:h[0],tag:void 0,network:void 0,info:n}}async createDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e);if(this.isFiat(e))throw new o(this.id+" createDepositAddress() of fiat for "+e+" is not supported");const s={currency:i.id},r=await this.privatePostCurrenciesCurrencyReceiveAddresses(this.extend(s,t));return{currency:e,address:this.safeString(r.receive_address,"address"),tag:void 0,info:r}}parseTransactionStatus(e){return this.safeString({rejected:"failed",confirmed:"ok",anulled:"canceled",retained:"canceled",pending_confirmation:"pending"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=this.parse8601(this.safeString(e,"created_at")),r=this.safeString(e,"currency"),a=this.safeCurrencyCode(r,t),n=parseFloat(e.amount[0]),o=parseFloat(e.fee[0]),h=e.fee[1],d=this.parseTransactionStatus(this.safeString(e,"state")),c="deposit_data"in e?"deposit":"withdrawal",l=this.safeValue(e,c+"_data",{}),u=this.safeValue(l,"target_address"),f=this.safeString(l,"tx_hash"),p=this.parse8601(this.safeString(l,"updated_at"));return{info:e,id:i,txid:f,timestamp:s,datetime:this.iso8601(s),network:void 0,address:u,addressTo:void 0,addressFrom:void 0,tag:void 0,tagTo:void 0,tagFrom:void 0,type:c,amount:n,currency:a,status:d,updated:p,fee:{cost:o,rate:h}}}async fetchDeposits(e,t,i,s={}){if(await this.loadMarkets(),void 0===e)throw new d(this.id+" fetchDeposits() requires a currency code argument");const r=this.currency(e),a={currency:r.id,per:i},n=await this.privateGetCurrenciesCurrencyDeposits(this.extend(a,s)),o=this.safeValue(n,"deposits");return this.parseTransactions(o,r,t,i)}async fetchWithdrawals(e,t,i,s={}){if(await this.loadMarkets(),void 0===e)throw new d(this.id+" fetchWithdrawals() requires a currency code argument");const r=this.currency(e),a={currency:r.id,per:i},n=await this.privateGetCurrenciesCurrencyWithdrawals(this.extend(a,s)),o=this.safeValue(n,"withdrawals");return this.parseTransactions(o,r,t,i)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a={currency:this.currency(e).id,amount:t,withdrawal_data:{target_address:i}},n=await this.privatePostCurrenciesCurrencyWithdrawals(this.extend(a,r)),o=this.safeValue(n,"withdrawal");return this.parseTransaction(o)}nonce(){return this.microseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));Object.keys(o).length&&("GET"===i?n+="?"+this.urlencode(o):a=this.json(o));const h=this.urls.api.rest+"/"+this.version+"/"+n;if("private"===t){this.checkRequiredCredentials();const e=this.nonce().toString(),t=[i,"/api/"+this.version+"/"+n];if(a){const e=this.stringToBase64(a);t.push(this.decode(e))}t.push(e);const s=t.join(" "),o=this.hmac(this.encode(s),this.encode(this.secret),"sha384");r={"X-SBTC-APIKEY":this.apiKey,"X-SBTC-SIGNATURE":o,"X-SBTC-NONCE":e,"Content-Type":"application/json"}}return{url:h,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,o,h,d){if(void 0!==o&&e>=400){const e=this.safeString(o,"code"),t=this.safeString(o,"message",a),i=this.id+" "+t;if(void 0!==e)throw this.throwExactlyMatchedException(this.exceptions,e,i),new n(i)}}}},73803:function(e,t,i){const s=i(48819),{TICK_SIZE:r}=i(62115),{AuthenticationError:a,ExchangeError:n,ArgumentsRequired:o,PermissionDenied:h,InvalidOrder:d,OrderNotFound:c,InsufficientFunds:l,BadRequest:u,RateLimitExceeded:f,InvalidNonce:p,NotSupported:m,RequestTimeout:g}=i(73449),y=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bybit",name:"Bybit",countries:["VG"],version:"v3",userAgent:void 0,rateLimit:20,hostname:"bybit.com",pro:!0,certified:!0,has:{CORS:!0,spot:!0,margin:!0,swap:!0,future:!0,option:void 0,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,createPostOnlyOrder:!0,createReduceOnlyOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,editOrder:!0,fetchBalance:!0,fetchBorrowInterest:!1,fetchBorrowRate:!0,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposit:!1,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDepositAddressesByNetwork:!0,fetchDeposits:!0,fetchFundingRate:!0,fetchFundingRateHistory:!0,fetchIndexOHLCV:!0,fetchLedger:!0,fetchMarketLeverageTiers:!0,fetchMarkets:!0,fetchMarkOHLCV:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterest:!0,fetchOpenInterestHistory:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchOrderTrades:!0,fetchPosition:!0,fetchPositions:!0,fetchPremiumIndexOHLCV:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!0,fetchTransactions:!1,fetchTransfers:!0,fetchWithdrawals:!0,setLeverage:!0,setMarginMode:!0,setPositionMode:!0,transfer:!0,withdraw:!0},timeframes:{"1m":"1","3m":"3","5m":"5","15m":"15","30m":"30","1h":"60","2h":"120","4h":"240","6h":"360","12h":"720","1d":"D","1w":"W","1M":"M"},urls:{test:{spot:"https://api-testnet.{hostname}",futures:"https://api-testnet.{hostname}",v2:"https://api-testnet.{hostname}",public:"https://api-testnet.{hostname}",private:"https://api-testnet.{hostname}"},logo:"https://user-images.githubusercontent.com/51840849/76547799-daff5b80-649e-11ea-87fb-3be9bac08954.jpg",api:{spot:"https://api.{hostname}",futures:"https://api.{hostname}",v2:"https://api.{hostname}",public:"https://api.{hostname}",private:"https://api.{hostname}"},www:"https://www.bybit.com",doc:["https://bybit-exchange.github.io/docs/inverse/","https://bybit-exchange.github.io/docs/linear/","https://github.com/bybit-exchange"],fees:"https://help.bybit.com/hc/en-us/articles/360039261154",referral:"https://www.bybit.com/register?affiliate_id=35953"},api:{public:{get:{"v2/public/orderBook/L2":1,"v2/public/kline/list":3,"v2/public/tickers":1,"v2/public/trading-records":1,"v2/public/symbols":1,"v2/public/mark-price-kline":3,"v2/public/index-price-kline":3,"v2/public/premium-index-kline":2,"v2/public/open-interest":1,"v2/public/big-deal":1,"v2/public/account-ratio":1,"v2/public/funding-rate":1,"v2/public/elite-ratio":1,"v2/public/funding/prev-funding-rate":1,"v2/public/risk-limit/list":1,"public/linear/kline":3,"public/linear/recent-trading-records":1,"public/linear/risk-limit":1,"public/linear/funding/prev-funding-rate":1,"public/linear/mark-price-kline":1,"public/linear/index-price-kline":1,"public/linear/premium-index-kline":1,"spot/v1/time":1,"spot/v1/symbols":1,"spot/quote/v1/depth":1,"spot/quote/v1/depth/merged":1,"spot/quote/v1/trades":1,"spot/quote/v1/kline":1,"spot/quote/v1/ticker/24hr":1,"spot/quote/v1/ticker/price":1,"spot/quote/v1/ticker/book_ticker":1,"spot/v3/public/symbols":1,"spot/v3/public/quote/depth":1,"spot/v3/public/quote/depth/merged":1,"spot/v3/public/quote/trades":1,"spot/v3/public/quote/kline":1,"spot/v3/public/quote/ticker/24hr":1,"spot/v3/public/quote/ticker/price":1,"spot/v3/public/quote/ticker/bookTicker":1,"spot/v3/public/server-time":1,"spot/v3/public/infos":1,"v2/public/time":1,"v3/public/time":1,"v2/public/announcement":1,"option/usdc/openapi/public/v1/order-book":1,"option/usdc/openapi/public/v1/symbols":1,"option/usdc/openapi/public/v1/tick":1,"option/usdc/openapi/public/v1/delivery-price":1,"option/usdc/openapi/public/v1/query-trade-latest":1,"option/usdc/openapi/public/v1/query-historical-volatility":1,"option/usdc/openapi/public/v1/all-tickers":1,"perpetual/usdc/openapi/public/v1/order-book":1,"perpetual/usdc/openapi/public/v1/symbols":1,"perpetual/usdc/openapi/public/v1/tick":1,"perpetual/usdc/openapi/public/v1/kline/list":1,"perpetual/usdc/openapi/public/v1/mark-price-kline":1,"perpetual/usdc/openapi/public/v1/index-price-kline":1,"perpetual/usdc/openapi/public/v1/premium-index-kline":1,"perpetual/usdc/openapi/public/v1/open-interest":1,"perpetual/usdc/openapi/public/v1/big-deal":1,"perpetual/usdc/openapi/public/v1/account-ratio":1,"perpetual/usdc/openapi/public/v1/prev-funding-rate":1,"perpetual/usdc/openapi/public/v1/risk-limit/list":1,"asset/v1/public/deposit/allowed-deposit-list":1,"contract/v3/public/copytrading/symbol/list":1,"derivatives/v3/public/order-book/L2":1,"derivatives/v3/public/kline":1,"derivatives/v3/public/tickers":1,"derivatives/v3/public/instruments-info":1,"derivatives/v3/public/mark-price-kline":1,"derivatives/v3/public/index-price-kline":1,"derivatives/v3/public/funding/history-funding-rate":1,"derivatives/v3/public/risk-limit/list":1,"derivatives/v3/public/delivery-price":1,"derivatives/v3/public/recent-trade":1,"derivatives/v3/public/open-interest":1,"derivatives/v3/public/insurance":1}},private:{get:{"v2/private/order/list":5,"v2/private/order":5,"v2/private/stop-order/list":5,"v2/private/stop-order":1,"v2/private/position/list":25,"v2/private/position/fee-rate":40,"v2/private/execution/list":25,"v2/private/trade/closed-pnl/list":1,"v2/public/risk-limit/list":1,"v2/public/funding/prev-funding-rate":25,"v2/private/funding/prev-funding":25,"v2/private/funding/predicted-funding":25,"v2/private/account/api-key":5,"v2/private/account/lcp":1,"v2/private/wallet/balance":25,"v2/private/wallet/fund/records":25,"v2/private/wallet/withdraw/list":25,"v2/private/exchange-order/list":1,"private/linear/order/list":5,"private/linear/order/search":5,"private/linear/stop-order/list":5,"private/linear/stop-order/search":5,"private/linear/position/list":25,"private/linear/trade/execution/list":25,"private/linear/trade/closed-pnl/list":25,"public/linear/risk-limit":1,"private/linear/funding/predicted-funding":25,"private/linear/funding/prev-funding":25,"futures/private/order/list":5,"futures/private/order":5,"futures/private/stop-order/list":5,"futures/private/stop-order":5,"futures/private/position/list":25,"futures/private/execution/list":25,"futures/private/trade/closed-pnl/list":1,"spot/v1/account":2.5,"spot/v1/order":2.5,"spot/v1/open-orders":2.5,"spot/v1/history-orders":2.5,"spot/v1/myTrades":2.5,"spot/v1/cross-margin/order":10,"spot/v1/cross-margin/accounts/balance":10,"spot/v1/cross-margin/loan-info":10,"spot/v1/cross-margin/repay/history":10,"spot/v3/private/order":2.5,"spot/v3/private/open-orders":2.5,"spot/v3/private/history-orders":2.5,"spot/v3/private/my-trades":2.5,"spot/v3/private/account":2.5,"spot/v3/private/reference":2.5,"spot/v3/private/record":2.5,"spot/v3/private/cross-margin-orders":10,"spot/v3/private/cross-margin-account":10,"spot/v3/private/cross-margin-loan-info":10,"spot/v3/private/cross-margin-repay-history":10,"asset/v1/private/transfer/list":50,"asset/v3/private/transfer/inter-transfer/list/query":.84,"asset/v1/private/sub-member/transfer/list":50,"asset/v3/private/transfer/sub-member/list/query":.84,"asset/v3/private/transfer/sub-member-transfer/list/query":.84,"asset/v3/private/transfer/universal-transfer/list/query":.84,"asset/v1/private/sub-member/member-ids":50,"asset/v1/private/deposit/record/query":50,"asset/v1/private/withdraw/record/query":25,"asset/v1/private/coin-info/query":25,"asset/v3/private/coin-info/query":25,"asset/v1/private/asset-info/query":50,"asset/v1/private/deposit/address":100,"asset/v3/private/deposit/address/query":.17,"asset/v1/private/universal/transfer/list":50,"contract/v3/private/copytrading/order/list":1,"contract/v3/private/copytrading/position/list":1,"contract/v3/private/copytrading/wallet/balance":1,"contract/v3/private/position/limit-info":25,"contract/v3/private/order/unfilled-orders":1,"contract/v3/private/order/list":1,"contract/v3/private/position/list":1,"contract/v3/private/execution/list":1,"contract/v3/private/position/closed-pnl":1,"contract/v3/private/account/wallet/balance":1,"contract/v3/private/account/fee-rate":1,"contract/v3/private/account/wallet/fund-records":1,"unified/v3/private/order/unfilled-orders":1,"unified/v3/private/order/list":1,"unified/v3/private/position/list":1,"unified/v3/private/execution/list":1,"unified/v3/private/delivery-record":1,"unified/v3/private/settlement-record":1,"unified/v3/private/account/wallet/balance":1,"unified/v3/private/account/transaction-log":1,"asset/v2/private/exchange/exchange-order-all":1,"unified/v3/private/account/borrow-history":1,"unified/v3/private/account/borrow-rate":1,"unified/v3/private/account/info":1,"user/v3/private/frozen-sub-member":10,"user/v3/private/query-sub-members":5,"user/v3/private/query-api":5,"asset/v3/private/transfer/transfer-coin/list/query":.84,"asset/v3/private/transfer/account-coin/balance/query":.84,"asset/v3/private/transfer/asset-info/query":.84,"asset/v3/public/deposit/allowed-deposit-list/query":.17,"asset/v3/private/deposit/record/query":.17,"asset/v3/private/withdraw/record/query":.17},post:{"v2/private/order/create":30,"v2/private/order/cancel":30,"v2/private/order/cancelAll":300,"v2/private/order/replace":30,"v2/private/stop-order/create":30,"v2/private/stop-order/cancel":30,"v2/private/stop-order/cancelAll":300,"v2/private/stop-order/replace":30,"v2/private/position/change-position-margin":40,"v2/private/position/trading-stop":40,"v2/private/position/leverage/save":40,"v2/private/tpsl/switch-mode":40,"v2/private/position/switch-isolated":2.5,"v2/private/position/risk-limit":2.5,"v2/private/position/switch-mode":2.5,"private/linear/order/create":30,"private/linear/order/cancel":30,"private/linear/order/cancel-all":300,"private/linear/order/replace":30,"private/linear/stop-order/create":30,"private/linear/stop-order/cancel":30,"private/linear/stop-order/cancel-all":300,"private/linear/stop-order/replace":30,"private/linear/position/set-auto-add-margin":40,"private/linear/position/switch-isolated":40,"private/linear/position/switch-mode":40,"private/linear/tpsl/switch-mode":2.5,"private/linear/position/add-margin":40,"private/linear/position/set-leverage":40,"private/linear/position/trading-stop":40,"private/linear/position/set-risk":2.5,"futures/private/order/create":30,"futures/private/order/cancel":30,"futures/private/order/cancelAll":30,"futures/private/order/replace":30,"futures/private/stop-order/create":30,"futures/private/stop-order/cancel":30,"futures/private/stop-order/cancelAll":30,"futures/private/stop-order/replace":30,"futures/private/position/change-position-margin":40,"futures/private/position/trading-stop":40,"futures/private/position/leverage/save":40,"futures/private/position/switch-mode":40,"futures/private/tpsl/switch-mode":40,"futures/private/position/switch-isolated":40,"futures/private/position/risk-limit":2.5,"spot/v1/order":2.5,"spot/v1/cross-margin/loan":10,"spot/v1/cross-margin/repay":10,"spot/v3/private/order":2.5,"spot/v3/private/cancel-order":2.5,"spot/v3/private/cancel-orders":2.5,"spot/v3/private/cancel-orders-by-ids":2.5,"spot/v3/private/purchase":2.5,"spot/v3/private/redeem":2.5,"spot/v3/private/cross-margin-loan":10,"spot/v3/private/cross-margin-repay":10,"asset/v1/private/transfer":150,"asset/v3/private/transfer/inter-transfer":2.5,"asset/v1/private/sub-member/transfer":150,"asset/v1/private/withdraw":50,"asset/v3/private/withdraw/create":1,"asset/v1/private/withdraw/cancel":50,"asset/v3/private/withdraw/cancel":.84,"asset/v1/private/transferable-subs/save":3e3,"asset/v1/private/universal/transfer":1500,"asset/v3/private/transfer/sub-member-transfer":2.5,"asset/v3/private/transfer/transfer-sub-member-save":2.5,"asset/v3/private/transfer/universal-transfer":2.5,"user/v3/private/create-sub-member":10,"user/v3/private/create-sub-api":10,"user/v3/private/update-api":10,"user/v3/private/delete-api":10,"user/v3/private/update-sub-api":10,"user/v3/private/delete-sub-api":10,"option/usdc/openapi/private/v1/place-order":2.5,"option/usdc/openapi/private/v1/batch-place-order":2.5,"option/usdc/openapi/private/v1/replace-order":2.5,"option/usdc/openapi/private/v1/batch-replace-orders":2.5,"option/usdc/openapi/private/v1/cancel-order":2.5,"option/usdc/openapi/private/v1/batch-cancel-orders":2.5,"option/usdc/openapi/private/v1/cancel-all":2.5,"option/usdc/openapi/private/v1/query-active-orders":2.5,"option/usdc/openapi/private/v1/query-order-history":2.5,"option/usdc/openapi/private/v1/execution-list":2.5,"option/usdc/openapi/private/v1/query-transaction-log":2.5,"option/usdc/openapi/private/v1/query-wallet-balance":2.5,"option/usdc/openapi/private/v1/query-asset-info":2.5,"option/usdc/openapi/private/v1/query-margin-info":2.5,"option/usdc/openapi/private/v1/query-position":2.5,"option/usdc/openapi/private/v1/query-delivery-list":2.5,"option/usdc/openapi/private/v1/query-position-exp-date":2.5,"option/usdc/openapi/private/v1/mmp-modify":2.5,"option/usdc/openapi/private/v1/mmp-reset":2.5,"perpetual/usdc/openapi/private/v1/place-order":2.5,"perpetual/usdc/openapi/private/v1/replace-order":2.5,"perpetual/usdc/openapi/private/v1/cancel-order":2.5,"perpetual/usdc/openapi/private/v1/cancel-all":2.5,"perpetual/usdc/openapi/private/v1/position/leverage/save":2.5,"option/usdc/openapi/private/v1/session-settlement":2.5,"option/usdc/private/asset/account/setMarginMode":2.5,"perpetual/usdc/openapi/public/v1/risk-limit/list":2.5,"perpetual/usdc/openapi/private/v1/position/set-risk-limit":2.5,"perpetual/usdc/openapi/private/v1/predicted-funding":2.5,"contract/v3/private/copytrading/order/create":2.5,"contract/v3/private/copytrading/order/cancel":2.5,"contract/v3/private/copytrading/order/close":2.5,"contract/v3/private/copytrading/position/close":2.5,"contract/v3/private/copytrading/position/set-leverage":2.5,"contract/v3/private/copytrading/wallet/transfer":2.5,"contract/v3/private/copytrading/order/trading-stop":2.5,"contract/v3/private/order/create":1,"contract/v3/private/order/cancel":1,"contract/v3/private/order/cancel-all":1,"contract/v3/private/order/replace":1,"contract/v3/private/position/set-auto-add-margin":1,"contract/v3/private/position/switch-isolated":1,"contract/v3/private/position/switch-mode":1,"contract/v3/private/position/switch-tpsl-mode":1,"contract/v3/private/position/set-leverage":1,"contract/v3/private/position/trading-stop":1,"contract/v3/private/position/set-risk-limit":1,"contract/v3/private/account/setMarginMode":1,"unified/v3/private/order/create":2.5,"unified/v3/private/order/replace":2.5,"unified/v3/private/order/cancel":2.5,"unified/v3/private/order/create-batch":2.5,"unified/v3/private/order/replace-batch":2.5,"unified/v3/private/order/cancel-batch":2.5,"unified/v3/private/order/cancel-all":2.5,"unified/v3/private/position/set-leverage":2.5,"unified/v3/private/position/tpsl/switch-mode":2.5,"unified/v3/private/position/set-risk-limit":2.5,"unified/v3/private/position/trading-stop":2.5,"unified/v3/private/account/upgrade-unified-account":2.5,"unified/v3/private/account/setMarginMode":2.5,"fht/compliance/tax/v3/private/registertime":50,"fht/compliance/tax/v3/private/create":50,"fht/compliance/tax/v3/private/status":50,"fht/compliance/tax/v3/private/url":50},delete:{"spot/v1/order":2.5,"spot/v1/order/fast":2.5,"spot/order/batch-cancel":2.5,"spot/order/batch-fast-cancel":2.5,"spot/order/batch-cancel-by-ids":2.5}}},httpExceptions:{403:f},exceptions:{exact:{"-10009":u,"-1004":u,"-1021":u,"-1103":u,"-1140":d,"-1197":d,"-2013":d,"-2015":a,"-6017":u,"-6025":u,"-6029":u,5004:n,7001:u,10001:u,10002:p,10003:a,10004:a,10005:h,10006:f,10007:a,10008:a,10009:a,10010:h,10014:u,10016:n,10017:u,10018:f,10020:h,10027:h,12201:u,110001:d,110003:d,110004:l,110005:d,110006:l,110007:l,110008:d,110009:d,110010:d,110011:d,110012:l,110013:u,110014:l,110015:u,110016:d,110017:d,110018:u,110019:d,110020:d,110021:d,110022:d,110023:d,110024:d,110025:d,110026:d,110027:d,110028:d,110029:d,110030:d,110031:d,110032:d,110033:d,110034:d,110035:d,110036:d,110037:d,110038:d,110039:d,110040:d,110041:d,110042:d,110043:u,110044:l,110045:l,110046:u,110047:u,110048:u,110049:u,110050:u,110051:l,110052:l,110053:l,110054:d,110055:d,110056:d,110057:d,110058:d,110059:d,110060:u,110061:u,110062:u,110063:n,110064:d,110065:h,110066:n,110067:h,110068:h,110069:h,110070:d,130006:d,130021:l,130074:d,131001:l,140003:d,140004:l,140005:d,140006:l,140007:l,140008:d,140009:d,140010:d,140011:d,140012:l,140013:u,140014:l,140015:d,140016:d,140017:d,140018:u,140019:d,140020:d,140021:d,140022:d,140023:d,140024:u,140025:u,140026:u,140027:u,140028:d,140029:u,140030:d,140031:u,140032:d,140033:d,140034:d,140035:d,140036:u,140037:d,140038:u,140039:u,140040:d,140041:d,140042:d,140043:u,140044:l,140045:l,140046:u,140047:u,140048:u,140049:u,140050:d,140051:l,140052:l,140053:l,140054:d,140055:d,140056:d,140057:d,140058:d,140059:d,140060:u,140061:u,140062:u,140063:n,140064:d,140065:h,140066:n,140067:h,140068:h,140069:h,140070:d,20001:c,20003:d,20004:d,20005:d,20006:d,20007:d,20008:d,20009:d,20010:d,20011:d,20012:d,20013:d,20014:d,20015:d,20016:d,20017:d,20018:d,20019:d,20020:d,20021:d,20022:u,20023:u,20031:u,20070:u,20071:u,20084:u,30001:u,30003:d,30004:d,30005:d,30007:d,30008:d,30009:n,30010:l,30011:h,30012:h,30013:h,30014:d,30015:d,30016:n,30017:d,30018:d,30019:d,30020:d,30021:d,30022:d,30023:d,30024:d,30025:d,30026:d,30027:d,30028:d,30029:d,30030:d,30031:l,30032:d,30033:f,30034:c,30035:f,30036:n,30037:d,30041:n,30042:l,30043:d,30044:d,30045:d,30049:l,30050:n,30051:n,30052:n,30054:n,30057:n,30063:n,30067:l,30068:n,30074:d,30075:d,30078:n,33004:a,34026:n,34036:u,35015:u,3100116:u,3100198:u,3200300:l},broad:{"Request timeout":g,"unknown orderInfo":c,"invalid api_key":a,oc_diff:l,new_oc:l,"openapi sign params error!":a}},precisionMode:r,options:{createMarketBuyOrderRequiresPrice:!0,createUnifiedMarginAccount:!1,defaultType:"swap",defaultSubType:"linear",defaultSettle:"USDT",code:"BTC",recvWindow:5e3,timeDifference:0,adjustForTimeDifference:!1,brokerId:"CCXT",accountsByType:{spot:"SPOT",margin:"SPOT",future:"CONTRACT",swap:"CONTRACT",option:"OPTION",investment:"INVESTMENT",unified:"UNIFIED",funding:"FUND"},accountsById:{SPOT:"spot",MARGIN:"spot",CONTRACT:"contract",OPTION:"option",INVESTMENT:"investment",UNIFIED:"unified"},networks:{ERC20:"ETH",TRC20:"TRX",BEP20:"BSC",OMNI:"OMNI",SPL:"SOL"},networksById:{ETH:"ERC20",TRX:"TRC20",BSC:"BEP20",OMNI:"OMNI",SPL:"SOL"},defaultNetwork:"ERC20",defaultNetworks:{USDT:"TRC20"}},fees:{trading:{feeSide:"get",tierBased:!0,percentage:!0,taker:75e-5,maker:1e-4},funding:{tierBased:!1,percentage:!1,withdraw:{},deposit:{}}},commonCurrencies:{GAS:"GASDAO"}})}nonce(){return this.milliseconds()-this.options.timeDifference}async isUnifiedMarginEnabled(e={}){if(void 0===this.safeValue(this.options,"enableUnifiedMargin")){const t=await this.privateGetUserV3PrivateQueryApi(e),i=this.safeValue(t,"result",{});this.options.enableUnifiedMargin=1===this.safeInteger(i,"unified")}return this.options.enableUnifiedMargin}async upgradeUnifiedAccount(e={}){if(!this.safeValue(this.options,"createUnifiedMarginAccount"))throw new m(this.id+' upgradeUnifiedAccount() warning this method can only be called once, it is not reverseable and you will be stuck with a unified margin account, you also need at least 5000 USDT in your bybit account to do this. If you want to disable this warning set exchange.options["createUnifiedMarginAccount"]=true.');return await this.privatePostUnifiedV3PrivateAccountUpgradeUnifiedAccount(e)}async fetchTime(e={}){const t=await this.publicGetV3PublicTime(e);return this.safeInteger(t,"time")}async fetchCurrencies(e={}){if(!this.checkRequiredCredentials(!1))return;const t=await this.privateGetAssetV3PrivateCoinInfoQuery(e),i=this.safeValue(t,"result",[]),s=this.safeValue(i,"rows",[]),r={};for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"coin"),a=this.safeCurrencyCode(i),n=this.safeString(t,"name"),o=this.safeValue(t,"chains",[]),h={};let d;for(let e=0;e<o.length;e++){const t=o[e],i=this.safeString(t,"chain"),s=this.networkIdToCode(i),r=this.parseNumber(this.parsePrecision(this.safeString(t,"minAccuracy")));d=void 0===d?r:Math.min(d,r);const a=1===this.safeInteger(t,"chainDeposit"),n=1===this.safeInteger(t,"chainWithdraw");h[s]={info:t,id:i,network:s,active:void 0,deposit:a,withdraw:n,fee:this.safeNumber(t,"withdrawFee"),precision:r,limits:{withdraw:{min:this.safeNumber(t,"withdrawMin"),max:void 0},deposit:{min:this.safeNumber(t,"depositMin"),max:void 0}}}}r[a]={info:t,code:a,id:i,name:n,active:void 0,deposit:void 0,withdraw:void 0,fee:void 0,precision:d,limits:{amount:{min:void 0,max:void 0}},networks:h}}return r}async fetchMarkets(e={}){this.options.adjustForTimeDifference&&await this.loadTimeDifference();let t=[this.fetchSpotMarkets(e),this.fetchDerivativesMarkets({category:"linear"}),this.fetchDerivativesMarkets({category:"inverse"})];t=await Promise.all(t);const i=t[0],s=t[1],r=t[2];let a=i;return a=this.arrayConcat(a,s),this.arrayConcat(a,r)}async fetchSpotMarkets(e){const t=await this.publicGetSpotV3PublicSymbols(e),i=this.safeValue(t,"result",{}),s=this.safeValue(i,"list",[]),r=[],a=this.parseNumber("0.001"),n=this.parseNumber("0.001");for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"name"),o=this.safeString(t,"baseCoin"),h=this.safeString(t,"quoteCoin"),d=this.safeCurrencyCode(o),c=this.safeCurrencyCode(h),l=d+"/"+c,u=1===this.safeInteger(t,"showStatus"),f=this.safeNumber(t,"quotePrecision");r.push({id:i,symbol:l,base:d,quote:c,settle:void 0,baseId:o,quoteId:h,settleId:void 0,type:"spot",spot:!0,margin:void 0,swap:!1,future:!1,option:!1,active:u,contract:!1,linear:void 0,inverse:void 0,taker:a,maker:n,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(t,"basePrecision"),price:this.safeNumber(t,"minPricePrecision",f)},limits:{leverage:{min:this.parseNumber("1"),max:void 0},amount:{min:this.safeNumber(t,"minTradeQty"),max:this.safeNumber(t,"maxTradeQty")},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"minTradeAmt"),max:this.safeNumber(t,"maxTradeAmt")}},info:t})}return r}async fetchDerivativesMarkets(e){e.limit=1e3;const t=await this.publicGetDerivativesV3PublicInstrumentsInfo(e),i=this.safeValue(t,"result",{});let s=this.safeValue(i,"list",[]),r=this.safeString(i,"nextPageCursor");if(void 0!==r)for(;void 0!==r;){e.cursor=r;const t=await this.publicGetDerivativesV3PublicInstrumentsInfo(e),i=this.safeValue(t,"result",{}),a=this.safeValue(i,"list",[]);if(0===a.length)break;s=this.arrayConcat(a,s),r=this.safeString(i,"nextPageCursor")}const a=[];let n=this.safeString(i,"category");for(let e=0;e<s.length;e++){const t=s[e];void 0===n&&(n=this.safeString(t,"category"));const i="linear"===n,r="inverse"===n,o=this.safeString(t,"contractType"),h="InverseFutures"===o,d="LinearPerpetual"===o,c="InversePerpetual"===o,l=this.safeString(t,"symbol"),u=this.safeString(t,"baseCoin"),f=this.safeString(t,"quoteCoin"),p=i?f:u,m=this.safeString(t,"settleCoin",p),g=this.safeCurrencyCode(u),y=this.safeCurrencyCode(f);let b;b=d&&"USD"===m?"USDC":this.safeCurrencyCode(m);let v=g+"/"+y;const w=this.safeValue(t,"lotSizeFilter",{}),S=this.safeValue(t,"priceFilter",{}),k=this.safeValue(t,"leverageFilter",{}),T=this.safeString(t,"status");let _;void 0!==T&&(_="Trading"===T);const O=d||c,M=h,I="option"===n;let x;O?x="swap":M?x="future":I&&(x="option");let C=this.omitZero(this.safeString(t,"deliveryTime"));void 0!==C&&(C=parseInt(C));const P=this.iso8601(C);let A,N;if(v=v+":"+b,void 0!==C&&(v=v+"-"+this.yymmdd(C),I)){const e=l.split("-");A=this.safeString(e,2);const t=this.safeString(e,3);v=v+"-"+A+"-"+t,"P"===t?N="put":"C"===t&&(N="call")}const B=r?this.safeNumber2(w,"minTradingQty","minOrderQty"):this.parseNumber("1");a.push({id:l,symbol:v,base:g,quote:y,settle:b,baseId:u,quoteId:f,settleId:m,type:x,spot:!1,margin:void 0,swap:O,future:M,option:I,active:_,contract:!0,linear:i,inverse:r,taker:this.safeNumber(t,"takerFee",this.parseNumber("0.0006")),maker:this.safeNumber(t,"makerFee",this.parseNumber("0.0001")),contractSize:B,expiry:C,expiryDatetime:P,strike:A,optionType:N,precision:{amount:this.safeNumber(w,"qtyStep"),price:this.safeNumber(S,"tickSize")},limits:{leverage:{min:this.safeNumber(k,"minLeverage"),max:this.safeNumber(k,"maxLeverage")},amount:{min:this.safeNumber2(w,"minTradingQty","minOrderQty"),max:this.safeNumber2(w,"maxTradingQty","maxOrderQty")},price:{min:this.safeNumber(S,"minPrice"),max:this.safeNumber(S,"maxPrice")},cost:{min:void 0,max:void 0}},info:t})}return a}parseTicker(e,t){return"s"in e?this.parseSpotTicker(e,t):this.parseContractTicker(e,t)}parseSpotTicker(e,t){const i=this.safeString(e,"s"),s=this.safeSymbol(i,t,void 0,"spot"),r=this.safeInteger(e,"t");return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeString(e,"h"),low:this.safeString(e,"l"),bid:this.safeString(e,"bp"),bidVolume:this.safeString(e,"bq"),ask:this.safeString(e,"ap"),askVolume:this.safeString(e,"aq"),vwap:void 0,open:this.safeString(e,"o"),close:this.safeString2(e,"lp","c"),last:void 0,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"v"),quoteVolume:this.safeString(e,"qv"),info:e},t)}parseContractTicker(e,t){const i=this.safeInteger(e,"time"),s=this.safeString(e,"symbol"),r=this.safeSymbol(s,t,void 0,"contract"),a=this.safeString2(e,"last_price","lastPrice"),n=this.safeStringN(e,["prev_price_24h","openPrice","prevPrice24h"]);let o=this.safeStringN(e,["price_24h_pcnt","change24h","price24hPcnt"]);o=y.stringMul(o,"100");const h=this.safeStringN(e,["turnover_24h","turnover24h","quoteVolume"]),d=this.safeStringN(e,["volume_24h","volume24h","volume"]),c=this.safeStringN(e,["bid_price","bid","bestBidPrice","bidPrice","bid1Price"]),l=this.safeStringN(e,["ask_price","ask","bestAskPrice","askPrice","ask1Price"]),u=this.safeStringN(e,["high_price_24h","high24h","highPrice","highPrice24h"]),f=this.safeStringN(e,["low_price_24h","low24h","lowPrice","lowPrice24h"]);return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:u,low:f,bid:c,bidVolume:this.safeString2(e,"bidSize","bid1Size"),ask:l,askVolume:this.safeString2(e,"askSize","ask1Size"),vwap:void 0,open:n,close:a,last:a,previousClose:void 0,change:void 0,percentage:o,average:void 0,baseVolume:d,quoteVolume:h,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id};let r;i.spot?r="publicGetSpotV3PublicQuoteTicker24hr":(r="publicGetDerivativesV3PublicTickers",i.option?s.category="option":i.linear?s.category="linear":i.inverse&&(s.category="inverse"));const a=await this[r](this.extend(s,t)),n=this.safeValue(a,"result",[]);let o;if(Array.isArray(n))o=this.safeValue(n,0);else{const e=this.safeValue(n,"list");o=void 0!==e?this.safeValue(e,0):n}return this.parseTicker(o,i)}async fetchSpotTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetSpotV3PublicQuoteTicker24hr(t),s=this.safeValue(i,"result",[]),r=this.safeValue(s,"list"),a={};for(let e=0;e<r.length;e++){const t=this.parseTicker(r[e]);a[t.symbol]=t}return this.filterByArray(a,"symbol",e)}async fetchDerivativesTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i={},[s,r]=this.handleSubTypeAndParams("fetchTickers",void 0,t,"linear");if("option"===s)throw new m(this.id+" fetchTickers() is not supported for option markets");i.category=s;const a=await this.publicGetDerivativesV3PublicTickers(this.extend(i,r));let n=this.safeValue(a,"result",[]);Array.isArray(n)||(n=this.safeValue(n,"list"));const o={};for(let e=0;e<n.length;e++){const t=this.parseTicker(n[e]);o[t.symbol]=t}return this.filterByArray(o,"symbol",e)}async fetchTickers(e,t={}){let i;await this.loadMarkets(),void 0!==e&&(e=this.marketSymbols(e),i=this.market(e[0]));const[s,r]=this.handleMarketTypeAndParams("fetchTickers",i,t);return"spot"===s?await this.fetchSpotTickers(e,r):await this.fetchDerivativesTickers(e,r)}parseOHLCV(e,t){return"t"in e?this.parseSpotOHLCV(e,t):this.parseContractOHLCV(e,t)}parseSpotOHLCV(e,t){return[this.safeInteger(e,"t"),this.safeNumber(e,"o"),this.safeNumber(e,"h"),this.safeNumber(e,"l"),this.safeNumber(e,"c"),this.safeNumber(e,"v")]}parseContractOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchSpotOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.parseTimeframe(t),o={symbol:a.id,limit:s};void 0!==i&&(o.startTime=i,o.endTime=void 0===s?this.sum(i,1e3*n*1e3):this.sum(i,s*n*1e3)),void 0!==s&&(o.limit=s),o.interval=t;const h=await this.publicGetSpotV3PublicQuoteKline(this.extend(o,r)),d=this.safeValue(h,"result",{}),c=this.safeValue(d,"list",[]);return this.parseOHLCVs(c,a,t,i,s)}async fetchDerivativesOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);if(a.option)throw new m(this.id+" fetchOHLCV() is not supported for option markets");const n={symbol:a.id},o=this.parseTimeframe(t),h=this.milliseconds();void 0===s?s=200:n.limit=s,void 0===i&&(i=h-s*o*1e3);let d=this.safeInteger(r,"end");void 0===d&&(d=this.sum(i,s*o*1e3)),a.linear?n.category="linear":a.inverse&&(n.category="inverse"),n.start=i,n.end=d,n.interval=this.safeString(this.timeframes,t,t);const c=this.safeString(r,"price");r=this.omit(r,"price");const l=this.safeValue({mark:"publicGetDerivativesV3PublicMarkPriceKline",index:"publicGetDerivativesV3PublicIndexPriceKline"},c,"publicGetDerivativesV3PublicKline"),u=await this[l](this.extend(n,r)),f=this.safeValue(u,"result",{}),p=this.safeValue(f,"list",[]);return this.parseOHLCVs(p,a,t,i,s)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();return this.market(e).spot?await this.fetchSpotOHLCV(e,t,i,s,r):await this.fetchDerivativesOHLCV(e,t,i,s,r)}parseFundingRate(e,t){const i=this.safeInteger(e,"timestamp");e=this.omit(e,"timestamp");const s=this.safeString(e,"symbol"),r=this.safeSymbol(s,t,void 0,"swap"),a=this.safeNumber(e,"fundingRate"),n=this.safeInteger(e,"nextFundingTime");return{info:e,symbol:r,markPrice:this.safeNumber(e,"markPrice"),indexPrice:this.safeNumber(e,"indexPrice"),interestRate:void 0,estimatedSettlePrice:void 0,timestamp:i,datetime:this.iso8601(i),fundingRate:a,fundingTimestamp:n,fundingDatetime:this.iso8601(n),nextFundingRate:void 0,nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e);t.symbol=i.id;const s=[i.symbol],r=await this.fetchFundingRates(s,t);return this.safeValue(r,i.symbol)}async fetchFundingRates(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=this.safeString(e,0);let s,r="swap";void 0!==i&&(s=this.market(i),r=s.type);const a={};let n;if([n,t]=this.handleSubTypeAndParams("fetchFundingRates",s,t,"linear"),"swap"!==r)throw new m(this.id+" fetchFundingRates() does not support "+r+" markets");a.category=n;const o=await this.publicGetDerivativesV3PublicTickers(this.extend(a,t));let h=this.safeValue(o,"result",[]);const d=this.safeInteger(o,"time");Array.isArray(h)||(h=this.safeValue(h,"list"));const c={};for(let e=0;e<h.length;e++){h[e].timestamp=d;const t=this.parseFundingRate(h[e],void 0);c[t.symbol]=t}return this.filterByArray(c,"symbol",e)}async fetchFundingRateHistory(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchFundingRateHistory() requires a symbol");await this.loadMarkets();const r={},a=this.market(e);if(e=a.symbol,r.symbol=a.id,a.option)throw new m(this.id+" fetchFundingRateHistory() is not supported for option markets");a.linear?r.category="linear":a.inverse&&(r.category="inverse"),void 0!==t&&(r.startTime=t);const n=this.safeInteger2(s,"until","till"),h=this.safeInteger(s,"endTime",n);s=this.omit(s,["endTime","till","until"]),void 0!==h&&(r.endTime=h),void 0!==i&&(r.limit=i);const d=await this.publicGetDerivativesV3PublicFundingHistoryFundingRate(this.extend(r,s)),c=[],l=this.safeValue(d,"result"),u=this.safeValue(l,"list");for(let e=0;e<u.length;e++){const t=u[e],i=this.safeInteger(t,"fundingRateTimestamp");c.push({info:t,symbol:this.safeSymbol(this.safeString(t,"symbol"),void 0,void 0,"swap"),fundingRate:this.safeNumber(t,"fundingRate"),timestamp:i,datetime:this.iso8601(i)})}const f=this.sortBy(c,"timestamp");return this.filterBySymbolSinceLimit(f,e,t,i)}async fetchIndexOHLCV(e,t="1m",i,s,r={}){return await this.fetchOHLCV(e,t,i,s,this.extend({price:"index"},r))}async fetchMarkOHLCV(e,t="1m",i,s,r={}){return await this.fetchOHLCV(e,t,i,s,this.extend({price:"mark"},r))}async fetchPremiumIndexOHLCV(e,t="1m",i,s,r={}){return await this.fetchOHLCV(e,t,i,s,this.extend({price:"premiumIndex"},r))}parseTrade(e,t){return"isBuyerMaker"in e||"feeTokenId"in e?this.parseSpotTrade(e,t):this.parseContractTrade(e,t)}parseSpotTrade(e,t){const i=this.safeIntegerN(e,["time","creatTime"]);let s,r;const a=this.safeInteger(e,"isBuyerMaker");if(void 0!==a)r=1===a?"buy":"sell";else{const t=this.safeInteger(e,"isBuyer");s=0===this.safeInteger(e,"isMaker")?"maker":"taker",r=0===t?"buy":"sell"}const n=this.safeString(e,"symbol");let o;t=this.safeMarket(n,t,void 0,"spot");const h=this.safeString(e,"execFee");if(void 0!==h){const t=this.safeString(e,"feeTokenId");o={cost:h,currency:this.safeCurrencyCode(t)}}return this.safeTrade({id:this.safeString(e,"tradeId"),info:e,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,order:this.safeString(e,"orderId"),type:void 0,side:r,takerOrMaker:s,price:this.safeString2(e,"price","orderPrice"),amount:this.safeString2(e,"qty","orderQty"),cost:void 0,fee:o},t)}parseContractTrade(e,t){const i=this.safeStringN(e,["execId","id","tradeId"]),s=this.safeString(e,"symbol"),r=(t=this.safeMarket(s,t,void 0,"contract")).symbol,a=this.safeStringN(e,["execQty","orderQty","size"]),n=this.safeStringN(e,["execPrice","orderPrice","price"]),o=this.safeString(e,"execValue"),h=this.safeIntegerN(e,["time","execTime","tradeTime"]);let d=this.safeStringLower(e,"side");if(void 0===d){const t=this.safeInteger(e,"isBuyer");void 0!==t&&(d=t?"buy":"sell")}const c=this.safeValue(e,"isMaker");let l;if(void 0!==c)l=c?"maker":"taker";else{let t=this.safeString(e,"lastLiquidityInd");"UNKNOWN"===t&&(t=void 0),void 0!==t&&(l="TAKER"===t||"MAKER"===t?t.toLowerCase():"AddedLiquidity"===t?"maker":"taker")}let u=this.safeStringLower(e,"orderType");"unknown"===u&&(u=void 0);const f=this.safeString(e,"execFee");let p;if(void 0!==f){let i;i=t.spot?this.safeString(e,"commissionAsset"):t.inverse?t.base:t.settle,p={cost:f,currency:i}}return this.safeTrade({id:i,info:e,timestamp:h,datetime:this.iso8601(h),symbol:r,order:this.safeString(e,"orderId"),type:u,side:d,takerOrMaker:l,price:n,amount:a,cost:o,fee:p},t)}async fetchSpotTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.limit=i);const n=await this.publicGetSpotV3PublicQuoteTrades(this.extend(a,s)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"list",[]);return this.parseTrades(h,r,t,i)}async fetchDerivativesTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.limit=i),r.option?a.category="option":r.linear?a.category="linear":r.inverse&&(a.category="inverse");const n=await this.publicGetDerivativesV3PublicRecentTrade(this.extend(a,s)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"list",[]);return this.parseTrades(h,r,t,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();return"spot"===this.market(e).type?await this.fetchSpotTrades(e,t,i,s):await this.fetchDerivativesTrades(e,t,i,s)}async fetchSpotOrderBook(e,t,i={}){await this.loadMarkets();const s={symbol:this.market(e).id};void 0!==t&&(s.limit=t);const r=await this.publicGetSpotV3PublicQuoteDepth(this.extend(s,i)),a=this.safeValue(r,"result",[]),n=this.safeInteger(a,"time");return this.parseOrderBook(a,e,n)}async fetchDerivativesOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};void 0!==t&&(r.limit=t),s.option?r.category="option":s.linear?r.category="linear":s.inverse&&(r.category="inverse");const a=await this.publicGetDerivativesV3PublicOrderBookL2(this.extend(r,i)),n=this.safeValue(a,"result",[]),o=this.safeInteger(n,"ts");return this.parseOrderBook(n,e,o,"b","a")}async fetchOrderBook(e,t,i={}){await this.loadMarkets();return this.market(e).spot?await this.fetchSpotOrderBook(e,t,i):await this.fetchDerivativesOrderBook(e,t,i)}parseBalance(e){const t={info:e},i=this.safeValue(e,"result",{}),s=this.safeValueN(i,["loanAccountList","list","coin","balances"]);if(void 0===s){const e="USDC",s=this.account();s.free=this.safeString(i,"availableBalance"),s.total=this.safeString(i,"walletBalance"),t[e]=s}else for(let e=0;e<s.length;e++){const i=s[e],r=this.account(),a=this.safeString(i,"loan"),n=this.safeString(i,"interest");void 0!==a&&void 0!==n&&(r.debt=y.stringAdd(a,n)),r.total=this.safeString2(i,"total","walletBalance"),r.free=this.safeStringN(i,["free","availableBalanceWithoutConvert","availableBalance"]),r.used=this.safeString(i,"locked");const o=this.safeStringN(i,["tokenId","coin","currencyCoin"]);t[this.safeCurrencyCode(o)]=r}return this.safeBalance(t)}async fetchSpotBalance(e={}){let t;await this.loadMarkets(),[t,e]=this.handleMarginModeAndParams("fetchBalance",e);let i="privateGetSpotV3PrivateAccount";void 0!==t&&(i="privateGetSpotV3PrivateCrossMarginAccount");const s=await this[i](e);return this.parseBalance(s)}async fetchUnifiedMarginBalance(e={}){await this.loadMarkets();const t=await this.privateGetUnifiedV3PrivateAccountWalletBalance(e);return this.parseBalance(t)}async fetchDerivativesBalance(e={}){await this.loadMarkets();const t=await this.privateGetContractV3PrivateAccountWalletBalance(this.extend({},e));return this.parseBalance(t)}async fetchUSDCBalance(e={}){await this.loadMarkets();const t=await this.privatePostOptionUsdcOpenapiPrivateV1QueryWalletBalance(e);return this.parseBalance(t)}async fetchBalance(e={}){let t;if(await this.loadMarkets(),[t,e]=this.handleMarketTypeAndParams("fetchBalance",void 0,e),"spot"===t)return await this.fetchSpotBalance(e);return await this.isUnifiedMarginEnabled()?await this.fetchUnifiedMarginBalance(e):await this.fetchDerivativesBalance(e)}parseOrderStatus(e){return this.safeString({NEW:"open",PARTIALLY_FILLED:"open",FILLED:"closed",CANCELED:"canceled",PENDING_CANCEL:"open",PENDING_NEW:"open",REJECTED:"rejected",PARTIALLY_FILLED_CANCELLED:"canceled",Created:"open",New:"open",Rejected:"rejected",PartiallyFilled:"open",PartiallyFilledCancelled:"canceled",Filled:"closed",PendingCancel:"open",Cancelled:"canceled",Untriggered:"open",Deactivated:"canceled",Triggered:"open",Active:"open"},e,e)}parseTimeInForce(e){return this.safeString({GoodTillCancel:"GTC",ImmediateOrCancel:"IOC",FillOrKill:"FOK",PostOnly:"PO"},e,e)}parseOrder(e,t){return"orderCategory"in e?this.parseSpotOrder(e,t):this.parseContractOrder(e,t)}parseContractOrder(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t,void 0,"contract")).symbol,r=this.safeInteger(e,"createdTime"),a=this.safeString(e,"orderId"),n=this.safeStringLower(e,"orderType"),o=this.safeString(e,"price"),h=this.safeString(e,"qty"),d=this.safeString(e,"cumExecValue"),c=this.safeString(e,"cumExecQty"),l=this.safeString(e,"leavesQty"),u=this.safeInteger(e,"updateTime"),f=this.safeString(e,"orderStatus"),p=this.parseOrderStatus(f),m=this.safeStringLower(e,"side");let g;if(this.safeValue(t,"contract")){const i=this.safeString(e,"cumExecFee");void 0!==i&&(g={cost:i,currency:t.settle})}let y=this.safeString(e,"orderLinkId");void 0!==y&&y.length<1&&(y=void 0);const b=this.safeString(e,"timeInForce"),v=this.parseTimeInForce(b),w=this.omitZero(this.safeString(e,"triggerPrice"));return this.safeOrder({info:e,id:a,clientOrderId:y,timestamp:r,datetime:this.iso8601(r),lastTradeTimestamp:u,symbol:s,type:n,timeInForce:v,postOnly:void 0,side:m,price:o,stopPrice:w,triggerPrice:w,amount:h,cost:d,average:void 0,filled:c,remaining:l,status:p,fee:g,trades:void 0},t)}parseSpotOrder(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t,void 0,"spot");const s=this.safeInteger(e,"createTime"),r=this.safeStringLower(e,"orderType");let a=this.safeString(e,"orderPrice");"0"===a&&"market"===r&&(a=void 0);const n=this.safeString(e,"execQty"),o=this.safeStringLower(e,"side"),h=this.parseTimeInForce(this.safeString(e,"timeInForce")),d=this.safeString(e,"triggerPrice"),c="PO"===h;let l;return l=t.spot&&"market"===r&&"buy"===o?n:this.safeString(e,"orderQty"),this.safeOrder({id:this.safeString(e,"orderId"),clientOrderId:this.safeString(e,"orderLinkId"),timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:this.safeInteger(e,"updateTime"),symbol:t.symbol,type:r,timeInForce:h,postOnly:c,side:o,price:a,triggerPrice:d,stopPrice:d,amount:l,cost:this.safeString(e,"cummulativeQuoteQty"),average:this.safeString(e,"avgPrice"),filled:n,remaining:void 0,status:this.parseOrderStatus(this.safeString(e,"status")),fee:void 0,trades:void 0,info:e},t)}async fetchOrder(e,t,i={}){let s,r;if(await this.loadMarkets(),void 0!==t&&(s=this.market(t)),[r,i]=this.handleMarketTypeAndParams("fetchOrder",s,i),"spot"===r){const t={orderId:e},r=await this.privateGetSpotV3PrivateOrder(this.extend(i,t)),a=this.safeValue(r,"result",{});return this.parseOrder(a,s)}{if(void 0===s)throw new o(this.id+" fetchOrder() requires a symbol argument for "+r+" markets");const a={orderId:e},n=await this.fetchOrders(t,void 0,void 0,this.extend(a,i)),h=n.length;if(0===h)throw new c("Order "+e+" does not exist.");if(h>1)throw new d(this.id+" returned more than one order");return this.safeValue(n,0)}}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);e=n.symbol;const o=await this.isUnifiedMarginEnabled(),h="USDC"===n.settle;return n.spot?await this.createSpotOrder(e,t,i,s,r,a):o&&!n.inverse?await this.createUnifiedMarginOrder(e,t,i,s,r,a):h?await this.createUsdcOrder(e,t,i,s,r,a):await this.createContractV3Order(e,t,i,s,r,a)}async createSpotOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);if("market"===t&&"buy"===i&&this.options.createMarketBuyOrderRequiresPrice){const e=this.safeNumber(a,"cost");if(a=this.omit(a,"cost"),void 0===r&&void 0===e)throw new d(this.id+" createOrder() requires the price argument with market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount, or, alternatively, add .options['createMarketBuyOrderRequiresPrice'] = false to supply the cost in the amount argument (the exchange-specific behaviour)");{const t=this.numberToString(s),i=this.numberToString(r),a=y.stringMul(t,i);s=void 0!==e?e:this.parseNumber(a)}}const o=t.toUpperCase(),h={symbol:n.id,side:this.capitalize(i),orderType:o,timeInForce:"GTC",orderQty:this.amountToPrecision(e,s)};if("LIMIT"===o||"LIMIT_MAKER"===o){if(void 0===r)throw new d(this.id+" createOrder requires a price argument for a "+t+" order");h.orderPrice=this.priceToPrecision(e,r)}this.isPostOnly("MARKET"===o,"LIMIT_MAKER"===t,a)&&(h.orderType="LIMIT_MAKER");const c=this.safeString2(a,"clientOrderId","orderLinkId");void 0!==c&&(h.orderLinkId=c),a=this.omit(a,["clientOrderId","orderLinkId","postOnly"]);const l=this.safeString(this.options,"brokerId");void 0!==l&&(h.agentSource=l);const u=this.safeNumber2(a,"triggerPrice","stopPrice");void 0!==u&&(a.triggerPrice=this.priceToPrecision(e,u)),a=this.omit(a,"stopPrice");const f=await this.privatePostSpotV3PrivateOrder(this.extend(h,a)),p=this.safeValue(f,"result",{});return this.parseOrder(p)}async createUnifiedMarginOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);if(!n.linear&&!n.option)throw new m(this.id+" createOrder does not allow inverse market orders for "+e+" markets");if(void 0===r&&"limit"===t)throw new o(this.id+" createOrder requires a price argument for limit orders");const h=t.toLowerCase(),d={symbol:n.id,side:this.capitalize(i),orderType:this.capitalize(h),timeInForce:"GoodTillCancel",qty:this.amountToPrecision(e,s)};n.linear?d.category="linear":d.category="option";const c="market"===h;"limit"===h&&(d.price=this.priceToPrecision(e,r));const l=this.safeString(a,"time_in_force"),u=this.safeStringLower(a,"timeInForce");this.isPostOnly(c,"PostOnly"===l,a)?d.timeInForce="PostOnly":"gtc"===u?d.timeInForce="GoodTillCancel":"fok"===u?d.timeInForce="FillOrKill":"ioc"===u&&(d.timeInForce="ImmediateOrCancel");const f=this.safeValue2(a,"stopPrice","triggerPrice"),p=this.safeValue(a,"stopLossPrice",f),g=void 0!==p,b=this.safeValue(a,"takeProfitPrice");if(g||void 0!==b){d.triggerBy="LastPrice";const t=g?p:b,s=this.priceToPrecision(e,t);d.triggerPrice=s;const r="buy"===i,a=p?!r:r,o=this.numberToString(n.precision.price);d.basePrice=a?y.stringAdd(s,o):y.stringSub(s,o)}const v=this.safeString(a,"clientOrderId");void 0!==v?d.orderLinkId=v:n.option&&(d.orderLinkId=this.uuid16()),a=this.omit(a,["stopPrice","timeInForce","triggerPrice","stopLossPrice","takeProfitPrice","postOnly","clientOrderId"]);const w=await this.privatePostUnifiedV3PrivateOrderCreate(this.extend(d,a)),S=this.safeValue(w,"result",{});return this.parseOrder(S)}async createContractV3Order(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);if(void 0===r&&"limit"===t)throw new o(this.id+" createContractV3Order requires a price argument for limit orders");const h=t.toLowerCase(),d={symbol:n.id,side:this.capitalize(i),orderType:this.capitalize(h),timeInForce:"GoodTillCancel",qty:this.amountToPrecision(e,s)};if(n.future){const e=this.safeInteger(a,"position_idx",0);d.position_idx=e,a=this.omit(a,"position_idx")}const c="market"===h;"limit"===h&&(d.price=this.priceToPrecision(e,r));const l=this.safeString(a,"time_in_force"),u=this.safeStringLower(a,"timeInForce");this.isPostOnly(c,"PostOnly"===l,a)?d.timeInForce="PostOnly":"gtc"===u?d.timeInForce="GoodTillCancel":"fok"===u?d.timeInForce="FillOrKill":"ioc"===u&&(d.timeInForce="ImmediateOrCancel");const f=this.safeValue2(a,"stopPrice","triggerPrice"),p=this.safeValue(a,"stopLossPrice",f),m=void 0!==p,g=this.safeValue(a,"takeProfitPrice");if(m||void 0!==g){const t=m?p:g,s=this.priceToPrecision(e,t),r="buy"===i,a=p?!r:r;d.triggerDirection=a?2:1,d.triggerBy="LastPrice",d.triggerPrice=this.priceToPrecision(e,s)}const y=this.safeString(a,"clientOrderId");void 0!==y?d.orderLinkId=y:n.option&&(d.orderLinkId=this.uuid16()),a=this.omit(a,["stopPrice","timeInForce","triggerPrice","stopLossPrice","takeProfitPrice","postOnly","clientOrderId"]);const b=await this.privatePostContractV3PrivateOrderCreate(this.extend(d,a)),v=this.safeValue(b,"result",{});return this.parseOrder(v)}async createUsdcOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);if("market"===t)throw new m(this.id+"createOrder does not allow market orders for "+e+" markets");if(void 0===r&&"limit"===t)throw new o(this.id+" createOrder requires a price argument for limit orders");const h=t.toLowerCase(),d={symbol:n.id,side:this.capitalize(i),orderType:this.capitalize(h),timeInForce:"GoodTillCancel",orderQty:this.amountToPrecision(e,s)},c="market"===h;void 0!==("limit"===h)&&(d.orderPrice=this.priceToPrecision(e,r));const l=this.safeString(a,"time_in_force"),u=this.safeStringLower(a,"timeInForce");if(this.isPostOnly(c,"PostOnly"===l,a)?d.time_in_force="PostOnly":"gtc"===u?d.time_in_force="GoodTillCancel":"fok"===u?d.time_in_force="FillOrKill":"ioc"===u&&(d.time_in_force="ImmediateOrCancel"),n.swap){const t=this.safeValue2(a,"stopPrice","triggerPrice"),i=this.safeValue(a,"stopLossPrice",t),s=void 0!==i,r=this.safeValue(a,"takeProfitPrice");if(s||void 0!==r){d.orderFilter="StopOrder",d.trigger_by="LastPrice";const t=s?i:r,a=this.priceToPrecision(e,t);d.triggerPrice=a;const o=this.numberToString(n.precision.price);d.basePrice=s?y.stringSub(a,o):y.stringAdd(a,o)}else d.orderFilter="Order"}const f=this.safeString(a,"clientOrderId");void 0!==f?d.orderLinkId=f:n.option&&(d.orderLinkId=this.uuid16()),a=this.omit(a,["stopPrice","timeInForce","triggerPrice","stopLossPrice","takeProfitPrice","postOnly","clientOrderId"]);const p=n.option?"privatePostOptionUsdcOpenapiPrivateV1PlaceOrder":"privatePostPerpetualUsdcOpenapiPrivateV1PlaceOrder",g=await this[p](this.extend(d,a)),b=this.safeValue(g,"result",{});return this.parseOrder(b)}async editUnifiedMarginOrder(e,t,i,s,r,a,n={}){await this.loadMarkets();const h=this.market(t);if(!h.linear&&!h.option)throw new m(this.id+" editOrder does not allow inverse market orders for "+t+" markets");if(void 0===a&&"limit"===i)throw new o(this.id+" editOrder requires a price argument for limit orders");const d=i.toLowerCase(),c={orderId:e,symbol:h.id,side:this.capitalize(s),orderType:this.capitalize(d),timeInForce:"GoodTillCancel",qty:this.amountToPrecision(t,r)};h.linear?c.category="linear":c.category="option";const l="market"===d;"limit"===d&&(c.price=this.priceToPrecision(t,a));const u=this.safeString(n,"time_in_force"),f=this.safeStringLower(n,"timeInForce");this.isPostOnly(l,"PostOnly"===u,n)?c.timeInForce="PostOnly":"gtc"===f?c.timeInForce="GoodTillCancel":"fok"===f?c.timeInForce="FillOrKill":"ioc"===f&&(c.timeInForce="ImmediateOrCancel");const p=this.safeValue2(n,"stopPrice","triggerPrice"),g=this.safeValue(n,"stopLossPrice"),y=void 0!==g,b=this.safeValue(n,"takeProfitPrice"),v=void 0!==b;y&&(c.stopLoss=this.priceToPrecision(t,g)),v&&(c.takeProfit=this.priceToPrecision(t,b)),void 0!==p&&(c.triggerBy="LastPrice",c.triggerPrice=this.priceToPrecision(t,p));const w=this.safeString(n,"clientOrderId");void 0!==w&&(c.orderLinkId=w),n=this.omit(n,["stopPrice","timeInForce","triggerPrice","stopLossPrice","takeProfitPrice","postOnly","clientOrderId"]);const S=await this.privatePostUnifiedV3PrivateOrderReplace(this.extend(c,n)),k=this.safeValue(S,"result",{});return this.parseOrder(k)}async editContractV3Order(e,t,i,s,r,a,n={}){await this.loadMarkets();const o={symbol:this.market(t).id,orderId:e,qty:this.amountToPrecision(t,r)};void 0!==a&&(o.price=this.priceToPrecision(t,a));const h=this.safeValue2(n,"stopPrice","triggerPrice"),d=this.safeValue(n,"stopLossPrice"),c=void 0!==d,l=this.safeValue(n,"takeProfitPrice"),u=void 0!==l;c&&(o.stopLoss=this.priceToPrecision(t,d)),u&&(o.takeProfit=this.priceToPrecision(t,l)),void 0!==h&&(o.triggerPrice=this.priceToPrecision(t,h)),n=this.omit(n,["stopPrice","triggerPrice","stopLossPrice","takeProfitPrice"]);const f=await this.privatePostContractV3PrivateOrderReplace(this.extend(o,n)),p=this.safeValue(f,"result",{});return{info:f,id:this.safeString(p,"orderId")}}async editOrder(e,t,i,s,r,a,n={}){if(void 0===t)throw new o(this.id+" editOrder() requires an symbol argument");await this.loadMarkets();const h=this.market(t),d=await this.isUnifiedMarginEnabled();if(h.spot)throw new m(this.id+" editOrder() does not support spot markets");return d&&!h.inverse?await this.editUnifiedMarginOrder(e,t,i,s,r,a,n):await this.editContractV3Order(e,t,i,s,r,a,n)}async cancelSpotOrder(e,t,i={}){await this.loadMarkets();const s=this.market(t),r={};void 0!==e&&(r.orderId=e);const a=await this.privatePostSpotV3PrivateCancelOrder(this.extend(r,i)),n=this.safeValue(a,"result",{});return this.parseOrder(n,s)}async cancelUnifiedMarginOrder(e,t,i={}){if(void 0===t)throw new o(this.id+" cancelUnifiedMarginOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={symbol:s.id},a=this.safeValue(i,"stop",!1);if(i=this.omit(i,["stop"]),r.orderFilter=a?"StopOrder":"Order",void 0!==e&&(r.orderId=e),s.option)r.category="option";else{if(!s.linear)throw new m(this.id+" cancelUnifiedMarginOrder() does not allow inverse market orders for "+t+" markets");r.category="linear"}const n=await this.privatePostUnifiedV3PrivateOrderCancel(this.extend(r,i)),h=this.safeValue(n,"result",{});return this.parseOrder(h,s)}async cancelUSDCOrder(e,t,i={}){if(void 0===t)throw new o(this.id+" cancelUSDCOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={symbol:s.id},a=this.safeValue(i,"stop",!1);let n;i=this.omit(i,["stop"]),void 0!==e&&(r.orderId=e),s.option?n="privatePostOptionUsdcOpenapiPrivateV1CancelOrder":(n="privatePostPerpetualUsdcOpenapiPrivateV1CancelOrder",r.orderFilter=a?"StopOrder":"Order");const h=await this[n](this.extend(r,i)),d=this.safeValue(h,"result",{});return this.parseOrder(d,s)}async cancelDerivativesOrder(e,t,i={}){if(void 0===t)throw new o(this.id+" cancelDerivativesOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={symbol:s.id,orderId:e},a=await this.privatePostContractV3PrivateOrderCancel(this.extend(r,i)),n=this.safeValue(a,"result",{});return this.parseOrder(n,s)}async cancelOrder(e,t,i={}){if(void 0===t)throw new o(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r=await this.isUnifiedMarginEnabled(),a="USDC"===s.settle;return s.spot?await this.cancelSpotOrder(e,t,i):r&&!s.inverse?await this.cancelUnifiedMarginOrder(e,t,i):a?await this.cancelUSDCOrder(e,t,i):await this.cancelDerivativesOrder(e,t,i)}async cancelAllSpotOrders(e,t={}){if(void 0===e)throw new o(this.id+" cancelAllSpotOrders() requires a symbol argument");await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.privateDeleteSpotOrderBatchCancel(this.extend(s,t)),a=this.safeValue(r,"result",[]);return Array.isArray(a)?this.parseOrders(a,i):r}async cancelAllUnifiedMarginOrders(e,t={}){let i,s;await this.loadMarkets();const r={};let a;void 0!==e&&(i=this.market(e),s=i.settle,r.symbol=i.id),[a,t]=this.handleSubTypeAndParams("cancelAllOrders",i,t,"linear"),r.category=a,[s,t]=this.handleOptionAndParams(t,"cancelAllOrders","settle",s),void 0!==s&&(r.settleCoin=s);const n=this.safeValue(t,"stop",!1);t=this.omit(t,["stop"]),n&&(r.orderFilter="StopOrder");const o=await this.privatePostUnifiedV3PrivateOrderCancelAll(this.extend(r,t)),h=this.safeValue(o,"result",[]),d=this.safeValue(h,"list");return Array.isArray(d)?this.parseOrders(d,i):o}async cancelAllUSDCOrders(e,t={}){if(void 0===e)throw new o(this.id+" cancelAllUSDCOrders() requires a symbol argument");await this.loadMarkets();const i=this.market(e);let s;const r={symbol:i.id};if(i.option)s="privatePostOptionUsdcOpenapiPrivateV1CancelAll";else{s="privatePostPerpetualUsdcOpenapiPrivateV1CancelAll";const e=this.safeValue(t,"stop",!1);r.orderFilter=e?"StopOrder":"Order",t=this.omit(t,["stop"])}const a=await this[s](this.extend(r,t)),n=this.safeValue(a,"result",[]);return Array.isArray(n)?this.parseOrders(n,i):a}async cancelAllDerivativesOrders(e,t={}){let i,s;await this.loadMarkets();const r={};void 0!==e&&(i=this.market(e),s=i.settle,r.symbol=i.id),[s,t]=this.handleOptionAndParams(t,"cancelAllOrders","settle",s),void 0!==s&&(r.settleCoin=s);const a=await this.privatePostContractV3PrivateOrderCancelAll(this.extend(r,t)),n=this.safeValue(a,"result",[]),o=this.safeValue(n,"list",[]);return this.parseOrders(o,i)}async cancelAllOrders(e,t={}){let i;await this.loadMarkets();let s,r=this.safeString(t,"settleCoin");void 0===r&&([r,t]=this.handleOptionAndParams(t,"cancelAllOrders","settle",r)),void 0!==e&&(i=this.market(e),r=i.settle),[s,t]=this.handleSubTypeAndParams("cancelAllOrders",i,t);const a="USDC"===r,n="inverse"===s;if(n&&(a||"USDT"===r))throw new o(this.id+" cancelAllOrders with inverse subType requires settle to not be USDT or USDC");const[h,d]=this.handleMarketTypeAndParams("cancelAllOrders",i,t),c=await this.isUnifiedMarginEnabled();return"spot"===h?await this.cancelAllSpotOrders(e,d):c&&!n?await this.cancelAllUnifiedMarginOrders(e,d):a?await this.cancelAllUSDCOrders(e,d):await this.cancelAllDerivativesOrders(e,d)}async fetchUnifiedMarginOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;if(void 0===e){let e;[e,s]=this.handleSubTypeAndParams("fetchUnifiedMarginOrders",a,s,"linear"),r.category=e}else if(a=this.market(e),r.symbol=a.id,a.option)r.category="option";else{if(!a.linear)throw new m(this.id+" fetchUnifiedMarginOrders() does not allow inverse market orders for "+e+" markets");r.category="linear"}const n=this.safeValue(s,"stop",!1);s=this.omit(s,["stop"]),n&&(r.orderFilter="StopOrder"),void 0!==i&&(r.limit=i);const o=await this.privateGetUnifiedV3PrivateOrderList(this.extend(r,s)),h=this.safeValue(o,"result",{}),d=this.safeValue(h,"list",[]);return this.parseOrders(d,a,t,i)}async fetchDerivativesOrders(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.symbol=r.id);const n=this.safeValue(s,"stop",!1);s=this.omit(s,["stop"]),n&&(a.orderFilter="StopOrder");const o=await this.privateGetContractV3PrivateOrderList(this.extend(a,s)),h=this.safeValue(o,"result",{}),d=this.safeValue2(h,"data","list",[]);return this.parseOrders(d,r,t,i)}async fetchOrders(e,t,i,s={}){let r;await this.loadMarkets();let a,n=this.safeString(s,"settleCoin");void 0===n&&([n,s]=this.handleOptionAndParams(s,"fetchOrders","settle",n)),void 0!==e&&(r=this.market(e),n=r.settle),[a,s]=this.handleSubTypeAndParams("fetchOpenOrders",r,s);const h="inverse"===a;if(h&&("USDC"===n||"USDT"===n))throw new o(this.id+" fetchOrders with inverse subType requires settle to not be USDT or USDC");const[d,c]=this.handleMarketTypeAndParams("fetchOpenOrders",r,s),l=await this.isUnifiedMarginEnabled();if("spot"===d)throw new m(this.id+" fetchOrders() does not support "+r.type+" markets, use exchange.fetchOpenOrders () and exchange.fetchClosedOrders () instead");return l&&!h?await this.fetchUnifiedMarginOrders(e,t,i,c):await this.fetchDerivativesOrders(e,t,i,c)}async fetchSpotClosedOrders(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e));const a={};void 0!==e&&(a.symbol=r.id),void 0!==i&&(a.limit=i),void 0!==t&&(a.startTime=t);const n=await this.privateGetSpotV3PrivateHistoryOrders(this.extend(a,s)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"list",[]);return this.parseOrders(h,r,t,i)}async fetchClosedOrders(e,t,i,s={}){let r,a;if(await this.loadMarkets(),void 0!==e&&(r=this.market(e)),[a,s]=this.handleMarketTypeAndParams("fetchClosedOrders",r,s),"spot"===a)return await this.fetchSpotClosedOrders(e,t,i,s);const n={},o=await this.isUnifiedMarginEnabled();return n.orderStatus=o?"Canceled":"Filled,Canceled",await this.fetchOrders(e,t,i,this.extend(n,s))}async fetchSpotOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.symbol=e),void 0!==i&&(r.limit=i);const n=await this.privateGetSpotV3PrivateOpenOrders(this.extend(r,s)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"list",[]);return this.parseOrders(h,a,t,i)}async fetchUnifiedMarginOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a,n;if(void 0===e){let e;[e,s]=this.handleSubTypeAndParams("fetchUnifiedMarginOrders",a,s,"linear"),r.category=e}else if(a=this.market(e),r.symbol=a.id,a.option)r.category="option";else{if(!a.linear)throw new m(this.id+" fetchUnifiedMarginOpenOrders() does not allow inverse market orders for "+e+" markets");r.category="linear"}[n,s]=this.handleMarketTypeAndParams("fetchUnifiedMarginOpenOrders",a,s);const o=this.safeValue(s,"stop",!1)||"stop"===n||"conditional"===n;s=this.omit(s,["stop"]),o&&(r.orderFilter="StopOrder"),void 0!==i&&(r.limit=i);const h=await this.privateGetUnifiedV3PrivateOrderUnfilledOrders(this.extend(r,s)),d=this.safeValue(h,"result",{}),c=this.safeValue(d,"list",[]);return this.parseOrders(c,a,t,i)}async fetchDerivativesOpenOrders(e,t,i,s={}){let r,a;await this.loadMarkets();const n={};void 0!==e&&(r=this.market(e),a=r.settle,n.symbol=r.id),[a,s]=this.handleOptionAndParams(s,"cancelAllOrders","settle",a),void 0!==a&&(n.settleCoin=a);const o=this.safeValue(s,"stop",!1);s=this.omit(s,["stop"]),o&&(n.orderFilter="StopOrder");const h=await this.privateGetContractV3PrivateOrderUnfilledOrders(this.extend(n,s)),d=this.safeValue(h,"result",{}),c=this.safeValue(d,"list",[]);return this.parseOrders(c,r,t,i)}async fetchUSDCOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a,n;void 0!==e&&(a=this.market(e),r.symbol=a.id),[n,s]=this.handleMarketTypeAndParams("fetchUSDCOpenOrders",a,s),r.category="swap"===n?"perpetual":"option";const o=await this.privatePostOptionUsdcOpenapiPrivateV1QueryActiveOrders(this.extend(r,s)),h=this.safeValue(o,"result",{}),d=this.safeValue(h,"dataList",[]);return this.parseOrders(d,a,t,i)}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets();let a,n=this.safeString(s,"settleCoin");void 0===n&&([n,s]=this.handleOptionAndParams(s,"fetchOpenOrders","settle",n)),void 0!==e&&(r=this.market(e),n=r.settle),[a,s]=this.handleSubTypeAndParams("fetchOpenOrders",r,s);const h="inverse"===a,d="USDC"===n;if(h&&(d||"USDT"===n))throw new o(this.id+" fetchOpenOrders with inverse subType requires settle to not be USDT or USDC");const[c,l]=this.handleMarketTypeAndParams("fetchOpenOrders",r,s),u=await this.isUnifiedMarginEnabled();return"spot"===c?await this.fetchSpotOpenOrders(e,t,i,l):u&&!h?await this.fetchUnifiedMarginOpenOrders(e,t,i,l):d?await this.fetchUSDCOpenOrders(e,t,i,l):await this.fetchDerivativesOpenOrders(e,t,i,l)}async fetchOrderTrades(e,t,i,s,r={}){const a={orderId:e};return await this.fetchMyTrades(t,i,s,this.extend(a,r))}async fetchMySpotTrades(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchMySpotTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==t&&(a.startTime=t),void 0!==i&&(a.limit=i);const n=await this.privateGetSpotV3PrivateMyTrades(this.extend(a,s)),h=this.safeValue(n,"result",{}),d=this.safeValue(h,"list",[]);return this.parseTrades(d,r,t,i)}async fetchMyUnifiedMarginTrades(e,t,i,s={}){let r,a;await this.loadMarkets();const n={};let o;void 0!==e&&(r=this.market(e),a=r.settle,n.symbol=r.id),[o,s]=this.handleSubTypeAndParams("fetchMyTrades",r,s,"linear"),n.category=o,[a,s]=this.handleOptionAndParams(s,"cancelAllOrders","settle",a),void 0!==a&&(n.settleCoin=a),void 0!==t&&(n.startTime=t),void 0!==i&&(n.limit=i);const h=await this.privateGetUnifiedV3PrivateExecutionList(this.extend(n,s)),d=this.safeValue(h,"result",{}),c=this.safeValue(d,"list",[]);return this.parseTrades(c,r,t,i)}async fetchMyContractTrades(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchMyContractTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==t&&(a.startTime=t),void 0!==i&&(a.limit=i);const n=await this.privateGetContractV3PrivateExecutionList(this.extend(a,s)),h=this.safeValue(n,"result",{}),d=this.safeValue(h,"list",[]);return this.parseTrades(d,r,t,i)}async fetchMyUsdcTrades(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e?(r=this.market(e),a.symbol=r.id,a.category=r.option?"OPTION":"PERPETUAL"):a.category="PERPETUAL";const n=await this.privatePostOptionUsdcOpenapiPrivateV1ExecutionList(this.extend(a,s)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"dataList",[]);return this.parseTrades(h,r,t,i)}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets();let a,n=this.safeString(s,"settleCoin");void 0===n&&([n,s]=this.handleOptionAndParams(s,"fetchMyTrades","settle",n)),void 0!==e&&(r=this.market(e),n=r.settle),[a,s]=this.handleSubTypeAndParams("fetchMyTrades",r,s);const h="inverse"===a,d="USDC"===n;if(h&&(d||"USDT"===n))throw new o(this.id+" fetchMyTrades with inverse subType requires settle to not be USDT or USDC");const[c,l]=this.handleMarketTypeAndParams("fetchMyTrades",r,s),u=await this.isUnifiedMarginEnabled();return"spot"===c?await this.fetchMySpotTrades(e,t,i,l):u&&!h?await this.fetchMyUnifiedMarginTrades(e,t,i,l):d?await this.fetchMyUsdcTrades(e,t,i,l):await this.fetchMyContractTrades(e,t,i,l)}parseDepositAddress(e,t){const i=this.safeString(e,"addressDeposit"),s=this.safeString(e,"tagDeposit"),r=this.safeString(t,"code"),a=this.safeString(e,"chain");return this.checkAddress(i),{currency:r,address:i,tag:s,network:a,info:e}}async fetchDepositAddressesByNetwork(e,t={}){await this.loadMarkets();let i=this.currency(e);const s={coin:i.id},r=await this.privateGetAssetV3PrivateDepositAddressQuery(this.extend(s,t)),a=this.safeValue(r,"result",[]),n=this.safeValue(a,"chains",[]),o=this.safeString(a,"coin");i=this.currency(o);const h=this.parseDepositAddresses(n,[e],!1,{currency:i.id});return this.indexBy(h,"network")}async fetchDepositAddress(e,t={}){await this.loadMarkets();const[i,s]=this.handleNetworkCodeAndParams(t),r=this.networkCodeToId(i),a=this.currency(e),n={coin:a.id};void 0!==r&&(n.chainType=r);const o=await this.privateGetAssetV3PrivateDepositAddressQuery(this.extend(n,s)),h=this.safeValue(o,"result",{}),d=this.safeValue(h,"chains",[]),c=this.indexBy(d,"chain"),l=this.selectNetworkIdFromRawNetworks(e,i,c),u=this.safeValue(c,l,{});return this.parseDepositAddress(u,a)}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;const n=this.safeInteger(s,"until");void 0!==e&&(a=this.currency(e),r.coin=a.id),void 0!==t&&(r.startTime=t),void 0!==i&&(r.limit=i),void 0!==n?r.endTime=n:void 0!==t&&(r.endTime=t+2592e6);const o=await this.privateGetAssetV3PrivateDepositRecordQuery(this.extend(r,s)),h=this.safeValue(o,"result",{}),d=this.safeValue(h,"rows",[]);return this.parseTransactions(d,a,t,i)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.coin=a.id),void 0!==t&&(r.startTime=this.yyyymmdd(t)),void 0!==i&&(r.limit=i);const n=await this.privateGetAssetV3PrivateWithdrawRecordQuery(this.extend(r,s)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"rows",[]);return this.parseTransactions(h,a,t,i)}parseTransactionStatus(e){return this.safeString({ToBeConfirmed:"pending",UnderReview:"pending",Success:"ok",Expire:"expired",0:"unknown",1:"pending",2:"processing",3:"ok",4:"fail",SecurityCheck:"pending",Pending:"pending",success:"ok",CancelByUser:"canceled",Reject:"rejected",Fail:"failed",BlockchainConfirmed:"ok"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"coin"),s=this.safeCurrencyCode(i,t),r=this.safeInteger2(e,"createTime","successAt"),a=this.safeInteger(e,"updateTime"),n=this.parseTransactionStatus(this.safeString(e,"status")),o=this.safeNumber2(e,"depositFee","withdrawFee",0),h="depositFee"in e?"deposit":"withdrawal";let d;void 0!==o&&(d={cost:o,currency:s});const c=this.safeString(e,"toAddress");return{info:e,id:this.safeString2(e,"id","withdrawId"),txid:this.safeString(e,"txID"),timestamp:r,datetime:this.iso8601(r),network:this.networkIdToCode(this.safeString(e,"chain")),address:void 0,addressTo:c,addressFrom:void 0,tag:this.safeString(e,"tag"),tagTo:void 0,tagFrom:void 0,type:h,amount:this.safeNumber(e,"amount"),currency:s,status:n,updated:a,fee:d}}async fetchLedger(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.coin=a.id),void 0!==t&&(r.start_date=this.yyyymmdd(t)),void 0!==i&&(r.limit=i);const n=await this.privateGetV2PrivateWalletFundRecords(this.extend(r,s)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"data",[]);return this.parseLedger(h,a,t,i)}parseLedgerEntry(e,t){const i=this.safeString(e,"coin"),s=this.safeCurrencyCode(i,t),r=this.safeString(e,"amount"),a=this.safeString(e,"wallet_balance"),n=y.stringLt(r,"0")?"out":"in";let o;if(void 0!==a&&void 0!==r){const e="out"===n?r:y.stringNeg(r);o=y.stringAdd(a,e)}const h=this.parse8601(this.safeString(e,"exec_time")),d=this.parseLedgerEntryType(this.safeString(e,"type")),c=this.safeString(e,"id"),l=this.safeString(e,"tx_id");return{id:c,currency:s,account:this.safeString(e,"wallet_id"),referenceAccount:void 0,referenceId:l,status:void 0,amount:this.parseNumber(r),before:this.parseNumber(o),after:this.parseNumber(a),fee:void 0,direction:n,timestamp:h,datetime:this.iso8601(h),type:d,info:e}}parseLedgerEntryType(e){return this.safeString({Deposit:"transaction",Withdraw:"transaction",RealisedPNL:"trade",Commission:"fee",Refund:"cashback",Prize:"prize",ExchangeOrderWithdraw:"transaction",ExchangeOrderDeposit:"transaction"},e,e)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets(),this.checkAddress(i);const a=this.currency(e),n={coin:a.id,amount:this.numberToString(t),address:i};void 0!==s&&(n.tag=s);const[o,h]=this.handleNetworkCodeAndParams(r),d=this.networkCodeToId(o);void 0!==d&&(n.chain=d.toUpperCase());const c=await this.privatePostAssetV3PrivateWithdrawCreate(this.extend(n,h)),l=this.safeValue(c,"result",{});return this.parseTransaction(l,a)}async fetchPosition(e,t={}){if(void 0===e)throw new o(this.id+" fetchPosition() requires a symbol argument");await this.loadMarkets();const i=this.market(e),s={symbol:i.id};let r;const a=await this.isUnifiedMarginEnabled(),n="USDC"===i.settle;if(a)if(r="privateGetUnifiedV3PrivatePositionList",i.option)s.category="option";else{if(!i.linear)throw new m(this.id+" fetchPosition() does not allow inverse market orders for "+e+" markets");s.category="linear"}else n?(r="privatePostOptionUsdcOpenapiPrivateV1QueryPosition",i.option?s.category="OPTION":i.linear&&(s.category="PERPETUAL")):r="privateGetContractV3PrivatePositionList";const h=await this[r](this.extend(s,t)),d=this.safeValue(h,"result",{}),c=this.safeValue2(d,"list","dataList",[]),l=this.safeInteger(h,"time"),u=this.safeValue(c,0),f=this.parsePosition(u,i);return this.extend(f,{timestamp:l,datetime:this.iso8601(l)})}async fetchUnifiedMarginPositions(e,t={}){await this.loadMarkets();const i={};let s,r;if(Array.isArray(e)){if(e.length>1)throw new o(this.id+" fetchPositions() does not accept an array with more than one symbol")}else void 0!==e&&(e=[e]);e=this.marketSymbols(e),[s,t]=this.handleMarketTypeAndParams("fetchPositions",void 0,t),[r,t]=this.handleSubTypeAndParams("fetchPositions",void 0,t,"linear"),i.category=r,"option"===s&&(i.category="option");const a=await this.privateGetUnifiedV3PrivatePositionList(this.extend(i,t)),n=this.safeValue(a,"result",{}),h=this.safeValue(n,"list",[]),d=[];for(let e=0;e<h.length;e++){let t=h[e];"data"in t&&"is_valid"in t&&(t=this.safeValue(t,"data")),d.push(this.parsePosition(t))}return this.filterByArray(d,"symbol",e,!1)}async fetchUSDCPositions(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i={};let s,r;if(Array.isArray(e)){if(1!==e.length)throw new o(this.id+" fetchUSDCPositions() takes an array with exactly one symbol");const t=this.safeString(e,0);s=this.market(t),i.symbol=s.id}else void 0!==e&&(s=this.market(e),i.symbol=s.id);[r,t]=this.handleMarketTypeAndParams("fetchUSDCPositions",s,t),i.category="option"===r?"OPTION":"PERPETUAL";const a=await this.privatePostOptionUsdcOpenapiPrivateV1QueryPosition(this.extend(i,t)),n=this.safeValue(a,"result",{}),h=this.safeValue(n,"dataList",[]),d=[];for(let e=0;e<h.length;e++){let t=h[e];"data"in t&&"is_valid"in t&&(t=this.safeValue(t,"data")),d.push(this.parsePosition(t,s))}return this.filterByArray(d,"symbol",e,!1)}async fetchDerivativesPositions(e,t={}){await this.loadMarkets();const i={};if(Array.isArray(e)){const t=e.length;if(t>1)throw new o(this.id+" fetchPositions() does not accept an array with more than one symbol");1===t&&(i.symbol=this.marketId(e[0]))}else void 0!==e?i.symbol=this.marketId(e):i.dataFilter="valid";let s;[s,t]=this.handleOptionAndParams(t,"fetchPositions","settle",s),void 0!==s&&(i.settleCoin=s);const r=await this.privateGetContractV3PrivatePositionList(this.extend(i,t)),a=this.safeValue(r,"result",{}),n=this.safeValue(a,"list",[]);return this.parsePositions(n,e,t)}async fetchPositions(e,t={}){if(Array.isArray(e)){if(e.length>1)throw new o(this.id+" fetchPositions() does not accept an array with more than one symbol")}else void 0!==e&&(e=[e]);await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.isUnifiedMarginEnabled();let s=this.safeString(t,"settleCoin");void 0===s&&([s,t]=this.handleOptionAndParams(t,"fetchPositions","settle",s));const r="USDC"===s,[a,n]=this.handleSubTypeAndParams("fetchPositions",void 0,t),h="inverse"===a;if(h&&(r||"USDT"===s))throw new o(this.id+" fetchPositions with inverse subType requires settle to not be USDT or USDC");return i&&!h?await this.fetchUnifiedMarginPositions(e,n):r?await this.fetchUSDCPositions(e,n):await this.fetchDerivativesPositions(e,n)}parsePosition(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t,void 0,"contract");const s=y.stringAbs(this.safeString(e,"size"));let r=this.safeString(e,"side");void 0!==r&&(r="Buy"===r?"long":"Sell"===r?"short":void 0);const a=this.safeString(e,"positionValue"),n=this.omitZero(this.safeString(e,"unrealisedPnl"));let o=this.safeString(e,"positionIM"),h=this.safeString(e,"positionMM"),d=this.parse8601(this.safeString(e,"updated_at"));void 0===d&&(d=this.safeInteger(e,"updatedAt"));const c=this.safeInteger(e,"tradeMode",0)?"isolated":"cross";let l=this.safeString(e,"positionBalance");const u=this.omitZero(this.safeString(e,"entryPrice")),f=this.omitZero(this.safeString(e,"liqPrice")),p=this.safeString(e,"leverage");if(void 0!==f)if("USDC"===t.settle){const e=y.stringAbs(y.stringSub(u,f));l=y.stringAdd(y.stringAdd(y.stringMul(e,s),h),n)}else{const i=this.safeString(e,"bustPrice");if(t.linear){const e=y.stringAbs(y.stringSub(f,i));h=y.stringMul(e,s),o=y.stringDiv(y.stringMul(s,u),p)}else{const e=y.stringAbs(y.stringSub(i,f)),t=y.stringMul(i,f);h=y.stringDiv(y.stringMul(s,e),t),o=y.stringDiv(s,y.stringMul(u,p))}}const m=y.stringDiv(h,a),g=y.stringMul(y.stringDiv(n,o),"100"),b=y.stringDiv(h,l,4);return{info:e,id:void 0,symbol:t.symbol,timestamp:d,datetime:this.iso8601(d),initialMargin:this.parseNumber(o),initialMarginPercentage:this.parseNumber(y.stringDiv(o,a)),maintenanceMargin:this.parseNumber(h),maintenanceMarginPercentage:this.parseNumber(m),entryPrice:this.parseNumber(u),notional:this.parseNumber(a),leverage:this.parseNumber(p),unrealizedPnl:this.parseNumber(n),contracts:this.parseNumber(s),contractSize:this.safeNumber(t,"contractSize"),marginRatio:this.parseNumber(b),liquidationPrice:this.parseNumber(f),markPrice:this.safeNumber(e,"markPrice"),collateral:this.parseNumber(l),marginMode:c,side:r,percentage:this.parseNumber(g)}}async setMarginMode(e,t,i={}){if(void 0===t)throw new o(this.id+" setMarginMode() requires a symbol argument");await this.loadMarkets();const s=this.market(t);if("USDC"===s.settle)throw new m(this.id+" setMarginMode() does not support market "+t);if("ISOLATED"!==(e=e.toUpperCase())&&"CROSS"!==e)throw new u(this.id+" setMarginMode() marginMode must be either isolated or cross");const r=this.safeString(i,"leverage");let a,n;if(void 0===r){if(a=this.safeNumber2(i,"sell_leverage","sellLeverage"),n=this.safeNumber2(i,"buy_leverage","buyLeverage"),void 0===a||void 0===n)throw new o(this.id+" setMarginMode() requires a leverage parameter or sell_leverage and buy_leverage parameters");i=this.omit(i,["buy_leverage","sell_leverage","sellLeverage","buyLeverage"])}else i=this.omit(i,"leverage"),a=r,n=r;const h="ISOLATED"===e?1:0,d={symbol:s.id,tradeMode:h,buyLeverage:r,sellLeverage:r};return await this.privatePostContractV3PrivatePositionSwitchIsolated(this.extend(d,i))}async setLeverage(e,t,i={}){if(void 0===t)throw new o(this.id+" setLeverage() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r="USDC"===s.settle,a=await this.isUnifiedMarginEnabled();let n,h;if(e=this.numberToString(e),a||!r)if(h={symbol:s.id,buyLeverage:e,sellLeverage:e},a&&!s.inverse){if(s.option)h.category="option";else{if(!s.linear)throw new m(this.id+" setUnifiedMarginLeverage() leverage doesn't support inverse market in unified margin");h.category="linear"}n="privatePostUnifiedV3PrivatePositionSetLeverage"}else n="privatePostContractV3PrivatePositionSetLeverage";else h={symbol:s.id,leverage:e},n="privatePostPerpetualUsdcOpenapiPrivateV1PositionLeverageSave";return await this[n](this.extend(h,i))}async setPositionMode(e,t,i={}){let s;await this.loadMarkets(),s=e?3:0;const r={mode:s};if(void 0===t)r.coin="USDT";else{const e=this.market(t);r.symbol=e.id}return await this.privatePostContractV3PrivatePositionSwitchMode(this.extend(r,i))}async fetchDerivativesOpenInterestHistory(e,t="1h",i,s,r={}){await this.loadMarkets();let a=this.market(e);const n=a.linear?"linear":"inverse",o=this.safeString(r,"category",n),h={symbol:a.id,interval:t,category:o};void 0!==i&&(h.since=i),void 0!==s&&(h.limit=s);const d=await this.publicGetDerivativesV3PublicOpenInterest(this.extend(h,r)),c=this.safeValue(d,"result",{}),l=this.safeString(c,"symbol");a=this.safeMarket(l,a,void 0,"contract");const u=this.safeValue(c,"list",[]);return this.parseOpenInterests(u,a,i,s)}async fetchOpenInterest(e,t={}){await this.loadMarkets();let i=this.market(e);if(!i.contract)throw new u(this.id+" fetchOpenInterest() supports contract markets only");const s=this.safeString(t,"interval","1h");if("1m"===s)throw new u(this.id+" fetchOpenInterest() cannot use the 1m timeframe");const r=i.linear?"linear":"inverse",a=this.safeString(t,"category",r),n={symbol:i.id,interval:s,category:a},o=await this.publicGetDerivativesV3PublicOpenInterest(this.extend(n,t)),h=this.safeValue(o,"result",{}),d=this.safeString(h,"symbol");i=this.safeMarket(d,i,void 0,"contract");const c=this.safeValue(h,"list",[]);return this.parseOpenInterest(c[0],i)}async fetchOpenInterestHistory(e,t="1h",i,s,r={}){if("1m"===t)throw new u(this.id+"fetchOpenInterestHistory cannot use the 1m timeframe");await this.loadMarkets();const a=this.market(e);if(a.spot||a.option)throw new u(this.id+" fetchOpenInterestHistory() symbol does not support market "+e);const n={symbol:a.id};return void 0!==s&&(n.limit=s),await this.fetchDerivativesOpenInterestHistory(e,t,i,s,r)}parseOpenInterest(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeNumber2(e,"open_interest","openInterest");return{symbol:t.symbol,openInterestAmount:void 0,openInterestValue:s,timestamp:i,datetime:this.iso8601(i),info:e}}async fetchBorrowRate(e,t={}){await this.loadMarkets();const i=this.currency(e),s={coin:i.id},r=await this.privateGetSpotV3PrivateCrossMarginLoanInfo(this.extend(s,t)),a=this.safeValue(r,"result",{});return this.parseBorrowRate(a,i)}parseBorrowRate(e,t){const i=this.milliseconds(),s=this.safeString(e,"coin");return{currency:this.safeCurrencyCode(s,t),rate:this.safeNumber(e,"interestRate"),period:864e5,timestamp:i,datetime:this.iso8601(i),info:e}}async fetchBorrowInterest(e,t,i,s,r={}){await this.loadMarkets();const a=await this.privateGetSpotV3PrivateCrossMarginAccount(this.extend({},r)),n=this.safeValue(a,"result",{}),o=this.safeValue(n,"loanAccountList",[]),h=this.parseBorrowInterests(o,void 0);return this.filterByCurrencySinceLimit(h,e,i,s)}parseBorrowInterest(e,t){return{symbol:void 0,marginMode:"cross",currency:this.safeCurrencyCode(this.safeString(e,"tokenId")),interest:this.safeNumber(e,"interest"),interestRate:void 0,amountBorrowed:this.safeNumber(e,"loan"),timestamp:void 0,datetime:void 0,info:e}}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.safeString(r,"transferId",this.uuid()),n=this.safeValue(this.options,"accountsByType",{}),o=this.safeString(n,i,i),h=this.safeString(n,s,s),d=this.currency(e),c=this.currencyToPrecision(e,t);let l,u;[l,r]=this.handleOptionAndParams(r,"transfer","method","privatePostAssetV1PrivateTransfer"),u="privatePostAssetV3PrivateTransferInterTransfer"===l?{transferId:a,fromAccountType:o,toAccountType:h,coin:d.id,amount:c}:{transfer_id:a,from_account_type:o,to_account_type:h,coin:d.id,amount:c};const f=await this[l](this.extend(u,r)),p=this.safeInteger2(f,"time","time_now"),m=this.safeValue(f,"result",{}),g=this.safeStringN(f,["retCode","retMsg","ret_code","ret_msg"]),y=this.parseTransferStatus(g);return this.extend(this.parseTransfer(m,d),{timestamp:p,datetime:this.iso8601(p),amount:this.parseNumber(c),fromAccount:i,toAccount:s,status:y})}async fetchTransfers(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.safeCurrencyCode(e),a.coin=r.id),void 0!==t&&(a.startTime=t),void 0!==i&&(a.limit=i);const n=await this.privateGetAssetV3PrivateTransferInterTransferListQuery(this.extend(a,s)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"list",[]);return this.parseTransfers(h,r,t,i)}async borrowMargin(e,t,i,s={}){await this.loadMarkets();const r=this.currency(e),[a,n]=this.handleMarginModeAndParams("borrowMargin",s);if("isolated"===a)throw new m(this.id+" borrowMargin () cannot use isolated margin");const o={coin:r.id,qty:this.currencyToPrecision(e,t)},h=await this.privatePostSpotV3PrivateCrossMarginLoan(this.extend(o,n)),d=this.safeValue(h,"result",{}),c=this.parseMarginLoan(d,r);return this.extend(c,{symbol:i,amount:t})}async repayMargin(e,t,i,s={}){await this.loadMarkets();const r=this.currency(e),[a,n]=this.handleMarginModeAndParams("repayMargin",s);if("isolated"===a)throw new m(this.id+" repayMargin () cannot use isolated margin");const o={coin:r.id,qty:this.numberToString(t)},h=await this.privatePostSpotV3PrivateCrossMarginRepay(this.extend(o,n)),d=this.safeValue(h,"result",{}),c=this.parseMarginLoan(d,r);return this.extend(c,{symbol:i,amount:t})}parseMarginLoan(e,t){return{id:this.safeString2(e,"transactId","repayId"),currency:this.safeString(t,"code"),amount:void 0,symbol:void 0,timestamp:void 0,datetime:void 0,info:e}}parseTransferStatus(e){return this.safeString({0:"ok",OK:"ok",SUCCESS:"ok"},e,e)}parseTransfer(e,t){const i=this.safeString(e,"coin"),s=this.safeTimestamp(e,"timestamp"),r=this.safeString2(e,"fromAccountType","from_account_type"),a=this.safeString2(e,"toAccountType","to_account_type"),n=this.safeValue(this.options,"accountsById",{}),o=this.safeString(n,r,r),h=this.safeString(n,a,a);return{info:e,id:this.safeString2(e,"transferId","transfer_id"),timestamp:s,datetime:this.iso8601(s),currency:this.safeCurrencyCode(i,t),amount:this.safeNumber(e,"amount"),fromAccount:o,toAccount:h,status:this.parseTransferStatus(this.safeString(e,"status"))}}sign(e,t="public",i="GET",s={},r,a){let n=this.implodeHostname(this.urls.api[t])+"/"+e;if("public"===t)Object.keys(s).length&&(n+="?"+this.rawencode(s));else if("private"===t){this.checkRequiredCredentials();const t=n.indexOf("openapi")>=0,o=n.indexOf("unified/v3")>=0,h=this.nonce().toString();if(t){a=Object.keys(s).length?this.json(s):"{}";const e=h+this.apiKey+a,t=this.hmac(this.encode(e),this.encode(this.secret),"sha256","hex");r={"Content-Type":"application/json","X-BAPI-API-KEY":this.apiKey,"X-BAPI-TIMESTAMP":h,"X-BAPI-SIGN":t}}else if(o){r={"Content-Type":"application/json","X-BAPI-API-KEY":this.apiKey,"X-BAPI-SIGN-TYPE":"2","X-BAPI-TIMESTAMP":h,"X-BAPI-RECV-WINDOW":this.options.recvWindow.toString()};const t=s,o=this.rawencode(t),d=h.toString()+this.apiKey+this.options.recvWindow.toString();let c;"POST"===i?c=d+(a=this.json(t)):(c=d+o,n+="unified/v3/private/order/list"===e?"?"+this.rawencode(t):"?"+this.urlencode(t)),r["X-BAPI-SIGN"]=this.hmac(this.encode(c),this.encode(this.secret))}else{const t=this.extend(s,{api_key:this.apiKey,recv_window:this.options.recvWindow,timestamp:h}),o=this.keysort(t),d=this.rawencode(o),c=this.hmac(this.encode(d),this.encode(this.secret));if("POST"===i){const e=n.indexOf("spot")>=0,i=this.extend(t,{sign:c});e?(a=this.urlencode(i),r={"Content-Type":"application/x-www-form-urlencoded"}):(a=this.json(i),r={"Content-Type":"application/json"})}else n+="contract/v3/private/order/list"===e?"?"+this.rawencode(o):"?"+this.urlencode(o),n+="&sign="+c}}if("POST"===i){const e=this.safeString(this.options,"brokerId");void 0!==e&&(r.Referer=e)}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,o,h,d){if(!o)return;const c=this.safeString2(o,"ret_code","retCode");if("0"!==c){if("30084"===c)return;let e;throw e="10005"===c?this.id+' private api uses /user/v3/private/query-api to check if you have a unified account. The API key of user id must own one of permissions: "Account Transfer", "Subaccount Transfer", "Withdrawal" '+a:this.id+" "+a,this.throwBroadlyMatchedException(this.exceptions.broad,a,e),this.throwExactlyMatchedException(this.exceptions.exact,c,e),new n(e)}}async fetchDerivativesMarketLeverageTiers(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id};i.linear?s.category="linear":i.inverse&&(s.category="inverse");const r=await this.publicGetDerivativesV3PublicRiskLimitList(this.extend(s,t)),a=this.safeValue(r,"result"),n=this.safeValue(a,"list");return this.parseMarketLeverageTiers(n,i)}async fetchMarketLeverageTiers(e,t={}){await this.loadMarkets();let i;if(i=this.market(e),i.spot||i.option)throw new u(this.id+" fetchMarketLeverageTiers() symbol does not support market "+e);return i.id,await this.fetchDerivativesMarketLeverageTiers(e,t)}parseMarketLeverageTiers(e,t){let i=0;const s=[];for(let r=0;r<e.length;r++){const a=e[r],n=this.safeNumber(a,"limit");s.push({tier:this.sum(r,1),currency:t.base,minNotional:i,maxNotional:n,maintenanceMarginRate:this.safeNumber2(a,"maintain_margin","maintainMargin"),maxLeverage:this.safeNumber2(a,"max_leverage","maxLeverage"),info:a}),i=n}return s}parseTradingFee(e,t){const i=this.safeString(e,"symbol");return{info:e,symbol:this.safeSymbol(i,void 0,void 0,"contract"),maker:this.safeNumber(e,"makerFeeRate"),taker:this.safeNumber(e,"takerFeeRate")}}async fetchTradingFee(e,t={}){if("v3"!==this.version)throw new m(this.id+" fetchTradingFee() is only support for v3");await this.loadMarkets();const i=this.market(e);if(i.spot)throw new m(this.id+" fetchTradingFee() is not supported for spot market");const s={symbol:i.id},r=await this.privateGetContractV3PrivateAccountFeeRate(this.extend(s,t)),a=this.safeValue(r,"result",{}),n=this.safeValue(a,"list",[]),o=this.safeValue(n,0,{});return this.parseTradingFee(o)}async fetchTradingFees(e={}){if("v3"!==this.version)throw new m(this.id+" fetchTradingFees() is only support for v3");let t;if(await this.loadMarkets(),[t,e]=this.handleOptionAndParams(e,"fetchTradingFees","type","future"),"spot"===t)throw new m(this.id+" fetchTradingFees() is not supported for spot market");const i=await this.privateGetContractV3PrivateAccountFeeRate(e);let s=this.safeValue(i,"result",{});s=this.safeValue(s,"list",[]);const r={};for(let e=0;e<s.length;e++){const t=this.parseTradingFee(s[e]);r[t.symbol]=t}return r}}},74228:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,AuthenticationError:n,NullResponse:o,InvalidOrder:h,InsufficientFunds:d,InvalidNonce:c,OrderNotFound:l,RateLimitExceeded:u,DDoSProtection:f,BadSymbol:p}=i(73449),{TICK_SIZE:m}=i(62115),g=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"cex",name:"CEX.IO",countries:["GB","EU","CY","RU"],rateLimit:1500,pro:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,cancelOrders:!1,createDepositAddress:!1,createOrder:!0,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,editOrder:!0,fetchBalance:!0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposit:!1,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDeposits:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPositionMode:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactions:!1,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!1,fetchWithdrawals:!1,fetchWithdrawalWhitelist:!1,reduceMargin:!1,setLeverage:!1,setMargin:!1,setMarginMode:!1,transfer:!1,withdraw:!1},timeframes:{"1m":"1m","1h":"1h","1d":"1d"},urls:{logo:"https://user-images.githubusercontent.com/1294454/27766442-8ddc33b0-5ed8-11e7-8b98-f786aef0f3c9.jpg",api:{rest:"https://cex.io/api"},www:"https://cex.io",doc:"https://cex.io/cex-api",fees:["https://cex.io/fee-schedule","https://cex.io/limits-commissions"],referral:"https://cex.io/r/0/up105393824/0/"},requiredCredentials:{apiKey:!0,secret:!0,uid:!0},api:{public:{get:["currency_profile","currency_limits/","last_price/{pair}/","last_prices/{currencies}/","ohlcv/hd/{yyyymmdd}/{pair}","order_book/{pair}/","ticker/{pair}/","tickers/{currencies}/","trade_history/{pair}/"],post:["convert/{pair}","price_stats/{pair}"]},private:{post:["active_orders_status/","archived_orders/{pair}/","balance/","cancel_order/","cancel_orders/{pair}/","cancel_replace_order/{pair}/","close_position/{pair}/","get_address/","get_crypto_address","get_myfee/","get_order/","get_order_tx/","open_orders/{pair}/","open_orders/","open_position/{pair}/","open_positions/{pair}/","place_order/{pair}/","raw_tx_history"]}},fees:{trading:{maker:this.parseNumber("0.0016"),taker:this.parseNumber("0.0025")},funding:{withdraw:{},deposit:{BTC:0,ETH:0,BCH:0,DASH:0,BTG:0,ZEC:0,XRP:0,XLM:0}}},precisionMode:m,exceptions:{exact:{},broad:{"Insufficient funds":d,"Nonce must be incremented":c,"Invalid Order":h,"Order not found":l,"limit exceeded":u,"Invalid API key":n,"There was an error while placing your order":h,"Sorry, too many clients already":f,"Invalid Symbols Pair":p,"Wrong currency pair":p}},options:{fetchOHLCVWarning:!0,createMarketBuyOrderRequiresPrice:!0,order:{status:{c:"canceled",d:"closed",cd:"canceled",a:"open"}},defaultNetwork:"ERC20",defaultNetworks:{USDT:"TRC20"},networks:{ERC20:"Ethereum",BTC:"BTC",BEP20:"Binance Smart Chain",BSC:"Binance Smart Chain",TRC20:"Tron"},networksById:{Ethereum:"ERC20",BTC:"BTC","Binance Smart Chain":"BEP20",Tron:"TRC20"}}})}async fetchCurrenciesFromCache(e={}){const t=this.safeValue(this.options,"fetchCurrencies",{}),i=this.safeInteger(t,"timestamp"),s=this.safeInteger(t,"expires",1e3),r=this.milliseconds();if(void 0===i||r-i>s){const i=await this.publicGetCurrencyProfile(e);this.options.fetchCurrencies=this.extend(t,{response:i,timestamp:r})}return this.safeValue(this.options.fetchCurrencies,"response")}async fetchCurrencies(e={}){const t=await this.fetchCurrenciesFromCache(e);this.options.currencies={timestamp:this.milliseconds(),response:t};const i=this.safeValue(t,"data",[]),s=this.safeValue(i,"symbols",[]),r={};for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"code"),a=this.safeCurrencyCode(i),n=!0;r[a]={id:i,code:a,name:i,active:n,deposit:void 0,withdraw:void 0,precision:this.parseNumber(this.safeString(t,"precision")),fee:void 0,limits:{amount:{min:this.safeNumber(t,"minimumCurrencyAmount"),max:void 0},withdraw:{min:this.safeNumber(t,"minimalWithdrawalAmount"),max:void 0}},info:t}}return r}async fetchMarkets(e={}){const t=await this.fetchCurrenciesFromCache(e),i=this.safeValue(t,"data",{}),s=this.safeValue(i,"symbols",[]),r=this.indexBy(s,"code"),a=this.safeValue(i,"pairs",[]),n=await this.publicGetCurrencyLimits(e),o=[],h=this.safeValue(n.data,"pairs");for(let e=0;e<h.length;e++){const t=h[e],i=this.safeString(t,"symbol1"),s=this.safeString(t,"symbol2"),n=this.safeCurrencyCode(i),d=this.safeCurrencyCode(s),c=this.safeValue(r,i,{}),l=this.safeValue(r,s,{});let u=this.safeString(l,"precision","8");for(let e=0;e<a.length;e++){const t=a[e];t.symbol1===i&&t.symbol2===s&&(u=this.safeString(t,"pricePrecision",u))}const f=this.safeString(c,"precision","8"),p=this.safeString(c,"scale","0"),m=g.stringSub(f,p);o.push({id:i+"/"+s,symbol:n+"/"+d,base:n,quote:d,settle:void 0,baseId:i,quoteId:s,settleId:void 0,type:"spot",spot:!0,margin:void 0,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(m)),price:this.parseNumber(this.parsePrecision(u))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"minLotSize"),max:this.safeNumber(t,"maxLotSize")},price:{min:this.safeNumber(t,"minPrice"),max:this.safeNumber(t,"maxPrice")},cost:{min:this.safeNumber(t,"minLotSizeS2"),max:void 0}},info:t})}return o}parseBalance(e){const t={info:e},i=this.omit(e,["username","timestamp"]),s=Object.keys(i);for(let e=0;e<s.length;e++){const r=s[e],a=this.safeValue(i,r,{}),n=this.account();n.free=this.safeString(a,"available"),n.used=this.safeString(a,"orders","0");t[this.safeCurrencyCode(r)]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostBalance(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={pair:s.id};void 0!==t&&(r.depth=t);const a=await this.publicGetOrderBookPair(this.extend(r,i)),n=this.safeTimestamp(a,"timestamp");return this.parseOrderBook(a,s.symbol,n)}parseOHLCV(e,t){return[this.safeTimestamp(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,a={}){await this.loadMarkets();const n=this.market(e);if(void 0===i)i=this.milliseconds()-864e5;else if(this.options.fetchOHLCVWarning)throw new r(this.id+" fetchOHLCV warning: CEX can return historical candles for a certain date only, this might produce an empty or null reply. Set exchange.options['fetchOHLCVWarning'] = false or add ({ 'options': { 'fetchOHLCVWarning': false }}) to constructor params to suppress this warning message.");const h={pair:n.id,yyyymmdd:this.yyyymmdd(i,"")};try{const e=await this.publicGetOhlcvHdYyyymmddPair(this.extend(h,a)),r="data"+this.safeString(this.timeframes,t,t),o=this.safeString(e,r),d=JSON.parse(o);return this.parseOHLCVs(d,n,t,i,s)}catch(e){if(e instanceof o)return[]}}parseTicker(e,t){const i=this.safeTimestamp(e,"timestamp"),s=this.safeString(e,"volume"),r=this.safeString(e,"high"),a=this.safeString(e,"low"),n=this.safeString(e,"bid"),o=this.safeString(e,"ask"),h=this.safeString(e,"last"),d=this.safeSymbol(void 0,t);return this.safeTicker({symbol:d,timestamp:i,datetime:this.iso8601(i),high:r,low:a,bid:n,bidVolume:void 0,ask:o,askVolume:void 0,vwap:void 0,open:void 0,close:h,last:h,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:s,quoteVolume:void 0,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i={currencies:Object.keys(this.currencies).join("/")},s=await this.publicGetTickersCurrencies(this.extend(i,t)),r=this.safeValue(s,"data",[]),a={};for(let e=0;e<r.length;e++){const t=r[e],i=this.safeString(t,"pair"),s=this.safeMarket(i,void 0,":");a[s.symbol]=this.parseTicker(t,s)}return this.filterByArray(a,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={pair:i.id},r=await this.publicGetTickerPair(this.extend(s,t));return this.parseTicker(r,i)}parseTrade(e,t){const i=this.safeTimestamp(e,"date"),s=this.safeString(e,"tid"),r=this.safeString(e,"type"),a=this.safeString(e,"price"),n=this.safeString(e,"amount");return t=this.safeMarket(void 0,t),this.safeTrade({info:e,id:s,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,type:undefined,side:r,order:void 0,takerOrMaker:void 0,price:a,amount:n,cost:void 0,fee:void 0},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pair:r.id},n=await this.publicGetTradeHistoryPair(this.extend(a,s));return this.parseTrades(n,r,t,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privatePostGetMyfee(e),i=this.safeValue(t,"data",{}),s={};for(let e=0;e<this.symbols.length;e++){const t=this.symbols[e],r=this.market(t),a=this.safeValue(i,r.id,{}),n=this.safeString(a,"buyMaker"),o=this.safeString(a,"buy"),h=this.parseNumber(g.stringDiv(n,"100")),d=this.parseNumber(g.stringDiv(o,"100"));s[t]={info:a,symbol:t,maker:h,taker:d,percentage:!0}}return s}async createOrder(e,t,i,s,r,a={}){if("market"===t&&"buy"===i&&this.options.createMarketBuyOrderRequiresPrice){if(void 0===r)throw new h(this.id+" createOrder() requires the price argument with market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount, or, alternatively, add .options['createMarketBuyOrderRequiresPrice'] = false to supply the cost in the amount argument (the exchange-specific behaviour)");s*=r}await this.loadMarkets();const n=this.market(e),o={pair:n.id,type:i,amount:s};"limit"===t?o.price=r:o.order_type=t;const d=await this.privatePostPlaceOrderPair(this.extend(o,a)),c=this.safeNumber(d,"amount"),l=this.safeNumber(d,"pending"),u=this.safeValue(d,"time"),f=this.safeValue(d,"complete")?"closed":"open";let p;return void 0!==c&&void 0!==l&&(p=Math.max(c-l,0)),{id:this.safeString(d,"id"),info:d,clientOrderId:void 0,timestamp:u,datetime:this.iso8601(u),lastTradeTimestamp:void 0,type:t,side:this.safeString(d,"type"),symbol:n.symbol,status:f,price:this.safeNumber(d,"price"),amount:c,cost:void 0,average:void 0,remaining:l,filled:p,fee:void 0,trades:void 0}}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={id:e};return await this.privatePostCancelOrder(this.extend(s,i))}parseOrder(e,t){let i,s=this.safeValue(e,"time");if(s="string"==typeof s&&s.indexOf("T")>=0?this.parse8601(s):parseInt(s),void 0===t){const s=this.safeString(e,"symbol1"),r=this.safeString(e,"symbol2");i=this.safeCurrencyCode(s)+"/"+this.safeCurrencyCode(r),i in this.markets&&(t=this.market(i))}const r=this.parseOrderStatus(this.safeString(e,"status")),a=this.safeNumber(e,"price");let n=this.safeNumber(e,"amount");void 0!==n&&(n=Math.abs(n));const o=this.safeNumber2(e,"pending","remains"),h=n-o;let d,c;if(void 0!==t){i=t.symbol;const s=this.safeNumber(e,"ta:"+t.quote),r=this.safeNumber(e,"tta:"+t.quote);c=this.sum(s,r);const a="fa:"+t.base,n="tfa:"+t.base,o="fa:"+t.quote,h="tfa:"+t.quote;let l=this.safeNumber(e,"tradingFeeMaker");if(l||(l=this.safeNumber(e,"tradingFeeTaker",l)),l&&(l/=100),a in e||n in e){const i=this.safeNumber2(e,a,n);d={currency:t.base,rate:l,cost:i}}else if(o in e||h in e){const i=this.safeNumber2(e,o,h);d={currency:t.quote,rate:l,cost:i}}}c||(c=a*h);const l=e.type;let u;const f=e.id;if("vtx"in e){u=[];for(let s=0;s<e.vtx.length;s++){const r=e.vtx[s],a=this.safeString(r,"type");if("cancel"===a)continue;const n=this.safeNumber(r,"price");if(void 0===n)continue;if("costsNothing"===a)continue;const o=this.parse8601(this.safeString(r,"time")),h=this.safeNumber(r,"amount"),d=this.safeNumber(r,"fee_amount");let c,l=h<0?-h:h;"sell"===a?(c=l,l=this.sum(d,c)/n):c=l*n,u.push({id:this.safeString(r,"id"),timestamp:o,datetime:this.iso8601(o),order:f,symbol:i,price:n,amount:l,cost:c,side:a,fee:{cost:d,currency:t.quote},info:r,type:void 0,takerOrMaker:void 0})}}return{id:f,clientOrderId:void 0,datetime:this.iso8601(s),timestamp:s,lastTradeTimestamp:void 0,status:r,symbol:i,type:void 0===a?"market":"limit",timeInForce:void 0,postOnly:void 0,side:l,price:a,stopPrice:void 0,triggerPrice:void 0,cost:c,amount:n,filled:h,remaining:o,trades:u,fee:d,info:e,average:void 0}}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a,n="privatePostOpenOrders";void 0!==e&&(a=this.market(e),r.pair=a.id,n+="Pair");const o=await this[n](this.extend(r,s));for(let e=0;e<o.length;e++)o[e]=this.extend(o[e],{status:"open"});return this.parseOrders(o,a,t,i)}async fetchClosedOrders(e,t,i,s={}){await this.loadMarkets();if(void 0===e)throw new a(this.id+" fetchClosedOrders() requires a symbol argument");const r=this.market(e),n={pair:r.id},o=await this.privatePostArchivedOrdersPair(this.extend(n,s));return this.parseOrders(o,r,t,i)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={id:e.toString()},r=await this.privatePostGetOrderTx(this.extend(s,i)),a=this.safeValue(r,"data",{});return this.parseOrder(a)}async fetchOrders(e,t,i,s={}){await this.loadMarkets();const r={limit:i,pair:this.market(e).id,dateFrom:t},a=await this.privatePostArchivedOrdersPair(this.extend(r,s)),n=[];for(let e=0;e<a.length;e++){const t=a[e],i=this.parseOrderStatus(this.safeString(t,"status")),s=this.safeString(t,"symbol1"),r=this.safeString(t,"symbol2"),o=this.safeCurrencyCode(s),h=this.safeCurrencyCode(r),d=o+"/"+h,c=this.safeString(t,"type"),l=this.safeNumber(t,"a:"+s+":cds"),u=this.safeNumber(t,"a:"+r+":cds"),f=this.safeNumber(t,"f:"+r+":cds"),p=this.safeNumber(t,"amount"),m=this.safeNumber(t,"price"),g=this.safeNumber(t,"remains"),y=p-g;let b,v,w,S;if(m){const e=this.safeNumber(t,"ta:"+r,0),i=this.safeNumber(t,"tta:"+r,0),s=this.safeNumber(t,"fa:"+r,0),a=this.safeNumber(t,"tfa:"+r,0);v="sell"===c?this.sum(this.sum(e,i),this.sum(s,a)):this.sum(e,i)-this.sum(s,a),S="limit",b=p,w=v/y}else S="market",b=l,v=u,w=b/v;const k=this.safeString(t,"time"),T=this.safeString(t,"lastTxTime"),_=this.parse8601(k);n.push({id:this.safeString(t,"id"),timestamp:_,datetime:this.iso8601(_),lastUpdated:this.parse8601(T),status:i,symbol:d,side:c,price:m,amount:b,average:w,type:S,filled:y,cost:v,remaining:g,fee:{cost:f,currency:h},info:t})}return n}parseOrderStatus(e){return this.safeString(this.options.order.status,e,e)}async editOrder(e,t,i,s,r,n,o={}){if(void 0===r)throw new a(this.id+" editOrder() requires a amount argument");if(void 0===n)throw new a(this.id+" editOrder() requires a price argument");await this.loadMarkets();const h=this.market(t),d={pair:h.id,type:s,amount:r,price:n,order_id:e},c=await this.privatePostCancelReplaceOrderPair(this.extend(d,o));return this.parseOrder(c,h)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},[s,r]=this.handleNetworkCodeAndParams(t),a=await this.privatePostGetCryptoAddress(this.extend(i,r)),n=this.safeValue(a,"data",{}),o=this.safeValue(n,"addresses",[]),h=this.indexBy(o,"blockchain"),d=this.selectNetworkIdFromRawNetworks(e,s,h),c=this.safeValue(h,d,{}),l=this.safeString2(c,"address","destination");return this.checkAddress(l),{currency:e,address:l,tag:this.safeString2(c,"destinationTag","memo"),network:this.networkIdToCode(d),info:n}}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if("public"===t)Object.keys(o).length&&(n+="?"+this.urlencode(o));else{this.checkRequiredCredentials();const e=this.nonce().toString(),t=e+this.uid+this.apiKey,i=this.hmac(this.encode(t),this.encode(this.secret));a=this.json(this.extend({key:this.apiKey,signature:i.toUpperCase(),nonce:e},o)),r={"Content-Type":"application/json"}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,h,d,c){if(Array.isArray(h))return h;if("true"!==n){if(void 0===h)throw new o(this.id+" returned "+this.json(h));if((!("e"in h)||!("ok"in h)||"ok"!==h.ok)&&"error"in h){const e=this.safeString(h,"error"),t=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,e,t),this.throwBroadlyMatchedException(this.exceptions.broad,e,t),new r(t)}}}}},62939:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,AuthenticationError:n,BadRequest:o,InvalidOrder:h,NotSupported:d,OrderNotFound:c,RateLimitExceeded:l,InvalidNonce:u}=i(73449),{TICK_SIZE:f,TRUNCATE:p,DECIMAL_PLACES:m}=i(62115),g=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"coinbase",name:"Coinbase",countries:["US"],rateLimit:400,version:"v2",userAgent:this.userAgents.chrome,headers:{"CB-VERSION":"2018-05-30"},has:{CORS:!0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,cancelOrders:!0,createDepositAddress:!0,createLimitBuyOrder:!0,createLimitSellOrder:!0,createMarketBuyOrder:!0,createMarketSellOrder:!0,createOrder:!0,createPostOnlyOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!0,createStopMarketOrder:!1,createStopOrder:!0,fetchAccounts:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchCanceledOrders:!0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchL2OrderBook:!1,fetchLedger:!0,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyBuys:!0,fetchMySells:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!1,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,withdraw:void 0},urls:{logo:"https://user-images.githubusercontent.com/1294454/40811661-b6eceae2-653a-11e8-829e-10bfadb078cf.jpg",api:{rest:"https://api.coinbase.com"},www:"https://www.coinbase.com",doc:["https://developers.coinbase.com/api/v2","https://docs.cloud.coinbase.com/advanced-trade-api/docs/welcome"],fees:["https://support.coinbase.com/customer/portal/articles/2109597-buy-sell-bank-transfer-fees","https://www.coinbase.com/advanced-fees"],referral:"https://www.coinbase.com/join/58cbe25a355148797479dbd2"},requiredCredentials:{apiKey:!0,secret:!0},api:{v2:{public:{get:["currencies","time","exchange-rates","users/{user_id}","prices/{symbol}/buy","prices/{symbol}/sell","prices/{symbol}/spot"]},private:{get:["accounts","accounts/{account_id}","accounts/{account_id}/addresses","accounts/{account_id}/addresses/{address_id}","accounts/{account_id}/addresses/{address_id}/transactions","accounts/{account_id}/transactions","accounts/{account_id}/transactions/{transaction_id}","accounts/{account_id}/buys","accounts/{account_id}/buys/{buy_id}","accounts/{account_id}/sells","accounts/{account_id}/sells/{sell_id}","accounts/{account_id}/deposits","accounts/{account_id}/deposits/{deposit_id}","accounts/{account_id}/withdrawals","accounts/{account_id}/withdrawals/{withdrawal_id}","payment-methods","payment-methods/{payment_method_id}","user","user/auth"],post:["accounts","accounts/{account_id}/primary","accounts/{account_id}/addresses","accounts/{account_id}/transactions","accounts/{account_id}/transactions/{transaction_id}/complete","accounts/{account_id}/transactions/{transaction_id}/resend","accounts/{account_id}/buys","accounts/{account_id}/buys/{buy_id}/commit","accounts/{account_id}/sells","accounts/{account_id}/sells/{sell_id}/commit","accounts/{account_id}/deposits","accounts/{account_id}/deposits/{deposit_id}/commit","accounts/{account_id}/withdrawals","accounts/{account_id}/withdrawals/{withdrawal_id}/commit"],put:["accounts/{account_id}","user"],delete:["accounts/{id}","accounts/{account_id}/transactions/{transaction_id}"]}},v3:{private:{get:["brokerage/accounts","brokerage/accounts/{account_uuid}","brokerage/orders/historical/batch","brokerage/orders/historical/fills","brokerage/orders/historical/{order_id}","brokerage/products","brokerage/products/{product_id}","brokerage/products/{product_id}/candles","brokerage/products/{product_id}/ticker","brokerage/transaction_summary"],post:["brokerage/orders","brokerage/orders/batch_cancel"]}}},fees:{trading:{taker:this.parseNumber("0.006"),maker:this.parseNumber("0.004"),tierBased:!0,percentage:!0,tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.006")],[this.parseNumber("10000"),this.parseNumber("0.004")],[this.parseNumber("50000"),this.parseNumber("0.0025")],[this.parseNumber("100000"),this.parseNumber("0.002")],[this.parseNumber("1000000"),this.parseNumber("0.0018")],[this.parseNumber("15000000"),this.parseNumber("0.0016")],[this.parseNumber("75000000"),this.parseNumber("0.0012")],[this.parseNumber("250000000"),this.parseNumber("0.0008")],[this.parseNumber("400000000"),this.parseNumber("0.0005")]],maker:[[this.parseNumber("0"),this.parseNumber("0.004")],[this.parseNumber("10000"),this.parseNumber("0.0025")],[this.parseNumber("50000"),this.parseNumber("0.0015")],[this.parseNumber("100000"),this.parseNumber("0.001")],[this.parseNumber("1000000"),this.parseNumber("0.0008")],[this.parseNumber("15000000"),this.parseNumber("0.0006")],[this.parseNumber("75000000"),this.parseNumber("0.0003")],[this.parseNumber("250000000"),this.parseNumber("0.0")],[this.parseNumber("400000000"),this.parseNumber("0.0")]]}}},precisionMode:f,exceptions:{exact:{two_factor_required:n,param_required:r,validation_error:r,invalid_request:r,personal_details_required:n,identity_verification_required:n,jumio_verification_required:n,jumio_face_match_verification_required:n,unverified_email:n,authentication_error:n,invalid_authentication_method:n,invalid_token:n,revoked_token:n,expired_token:n,invalid_scope:n,not_found:r,rate_limit_exceeded:l,internal_server_error:r},broad:{"request timestamp expired":u,"order with this orderID was not found":c}},timeframes:{"1m":"ONE_MINUTE","5m":"FIVE_MINUTE","15m":"FIFTEEN_MINUTE","30m":"THIRTY_MINUTE","1h":"ONE_HOUR","2h":"TWO_HOUR","6h":"SIX_HOUR","1d":"ONE_DAY"},commonCurrencies:{CGLD:"CELO"},options:{stablePairs:["BUSD-USD","CBETH-ETH","DAI-USD","GUSD-USD","GYEN-USD","PAX-USD","PAX-USDT","USDC-EUR","USDC-GBP","USDT-EUR","USDT-GBP","USDT-USD","USDT-USDC","WBTC-BTC"],fetchCurrencies:{expires:5e3},accounts:["wallet","fiat"],createMarketBuyOrderRequiresPrice:!0,advanced:!0,fetchMarkets:"fetchMarketsV3",fetchTicker:"fetchTickerV3",fetchTickers:"fetchTickersV3",fetchAccounts:"fetchAccountsV3"}})}async fetchTime(e={}){const t=await this.v2PublicGetTime(e),i=this.safeValue(t,"data",{});return this.safeTimestamp(i,"epoch")}async fetchAccounts(e={}){return"fetchAccountsV3"===this.safeString(this.options,"fetchAccounts","fetchAccountsV3")?await this.fetchAccountsV3(e):await this.fetchAccountsV2(e)}async fetchAccountsV2(e={}){await this.loadMarkets();const t=await this.v2PrivateGetAccounts(this.extend({limit:100},e)),i=this.safeValue(t,"data",[]);return this.parseAccounts(i,e)}async fetchAccountsV3(e={}){await this.loadMarkets();const t=await this.v3PrivateGetBrokerageAccounts(this.extend({limit:100},e)),i=this.safeValue(t,"accounts",[]);return this.parseAccounts(i,e)}parseAccount(e){const t=this.safeValue(e,"active"),i=this.safeString(e,"currency"),s=this.safeValue(e,"currency",{}),r=this.safeString(s,"code",i),a=this.safeString(e,"name"),n=this.safeString(e,"type"),o=a.split(" ");return{id:this.safeString2(e,"id","uuid"),type:void 0!==t?this.safeStringLower(o,1):n,code:this.safeCurrencyCode(r),info:e}}async createDepositAddress(e,t={}){let i=this.safeString(t,"account_id");if(t=this.omit(t,"account_id"),void 0===i){await this.loadAccounts();for(let t=0;t<this.accounts.length;t++){const s=this.accounts[t];if(s.code===e&&"wallet"===s.type){i=s.id;break}}}if(void 0===i)throw new r(this.id+" createDepositAddress() could not find the account with matching currency code, specify an `account_id` extra param");const s={account_id:i},a=await this.v2PrivatePostAccountsAccountIdAddresses(this.extend(s,t)),n=this.safeValue(a,"data",{});return{currency:e,tag:this.safeString(n,"destination_tag"),address:this.safeString(n,"address"),info:a}}async fetchMySells(e,t,i,s={}){const r=this.prepareAccountRequest(i,s);await this.loadMarkets();const a=this.omit(s,["account_id","accountId"]),n=await this.v2PrivateGetAccountsAccountIdSells(this.extend(r,a));return this.parseTrades(n.data,void 0,t,i)}async fetchMyBuys(e,t,i,s={}){const r=this.prepareAccountRequest(i,s);await this.loadMarkets();const a=this.omit(s,["account_id","accountId"]),n=await this.v2PrivateGetAccountsAccountIdBuys(this.extend(r,a));return this.parseTrades(n.data,void 0,t,i)}async fetchTransactionsWithMethod(e,t,i,s,r={}){const a=await this.prepareAccountRequestWithCurrencyCode(t,s,r);await this.loadMarkets();const n=this.omit(r,["account_id","accountId"]),o=await this[e](this.extend(a,n));return this.parseTransactions(o.data,void 0,i,s)}async fetchWithdrawals(e,t,i,s={}){return await this.fetchTransactionsWithMethod("v2PrivateGetAccountsAccountIdWithdrawals",e,t,i,s)}async fetchDeposits(e,t,i,s={}){return await this.fetchTransactionsWithMethod("v2PrivateGetAccountsAccountIdDeposits",e,t,i,s)}parseTransactionStatus(e){return this.safeString({created:"pending",completed:"ok",canceled:"canceled"},e,e)}parseTransaction(e,t){const i=this.safeValue(e,"subtotal",{}),s=this.safeValue(e,"fee",{}),r=this.safeString(e,"id"),a=this.parse8601(this.safeValue(e,"created_at")),n=this.parse8601(this.safeValue(e,"updated_at")),o=this.safeString(e,"resource"),h=this.safeNumber(i,"amount"),d=this.safeString(i,"currency"),c=this.safeCurrencyCode(d),l=this.safeNumber(s,"amount"),u=this.safeString(s,"currency"),f={cost:l,currency:this.safeCurrencyCode(u)};let p=this.parseTransactionStatus(this.safeString(e,"status"));if(void 0===p){p=this.safeValue(e,"committed")?"ok":"pending"}return{info:e,id:r,txid:r,timestamp:a,datetime:this.iso8601(a),network:void 0,address:void 0,addressTo:void 0,addressFrom:void 0,tag:void 0,tagTo:void 0,tagFrom:void 0,type:o,amount:h,currency:c,status:p,updated:n,fee:f}}parseTrade(e,t){let i;const s=this.safeValue(e,"total",{}),r=this.safeValue(e,"amount",{}),a=this.safeValue(e,"subtotal",{}),n=this.safeValue(e,"fee",{}),o=this.safeString(e,"product_id");if(void 0!==(t=this.safeMarket(o,t,"-")))i=t.symbol;else{const e=this.safeString(r,"currency"),t=this.safeString(s,"currency");if(void 0!==e&&void 0!==t){i=this.safeCurrencyCode(e)+"/"+this.safeCurrencyCode(t)}}const h=this.safeValue(e,"size_in_quote"),d=this.safeString(e,"price"),c=h?void 0:this.safeString(e,"size"),l=h?this.safeString(e,"size"):void 0,u=this.safeString(e,"commission"),f=this.safeString(r,"amount",c),p=this.safeString(a,"amount",l);let m,y;m=void 0!==p&&void 0!==f?g.stringDiv(p,f):d,y=void 0!==m&&void 0!==f?g.stringMul(m,f):p;const b=this.safeString(n,"currency"),v=this.safeStringN(e,["created_at","trade_time","time"]),w=this.safeStringLower2(e,"resource","side"),S=this.safeStringLower(e,"liquidity_indicator");return this.safeTrade({info:e,id:this.safeString2(e,"id","trade_id"),order:this.safeString(e,"order_id"),timestamp:this.parse8601(v),datetime:v,symbol:i,type:void 0,side:"unknown_order_side"===w?void 0:w,takerOrMaker:"unknown_liquidity_indicator"===S?void 0:S,price:m,amount:f,cost:y,fee:{cost:this.safeNumber(n,"amount",u),currency:this.safeCurrencyCode(b)}})}async fetchMarkets(e={}){const t=this.safeString(this.options,"fetchMarkets","fetchMarketsV3");return await this[t](e)}async fetchMarketsV2(e={}){const t=await this.fetchCurrenciesFromCache(e),i=this.safeValue(t,"currencies",{}),s=this.safeValue(t,"exchangeRates",{}),r=this.safeValue(i,"data",[]),a=this.indexBy(r,"id"),n=this.safeValue(this.safeValue(s,"data",{}),"rates",{}),o=Object.keys(n),h=[];for(let e=0;e<o.length;e++){const t=o[e],i=this.safeCurrencyCode(t);if("crypto"===(t in a?"fiat":"crypto"))for(let e=0;e<r.length;e++){const s=r[e],a=this.safeString(s,"id"),n=this.safeCurrencyCode(a);h.push({id:t+"-"+a,symbol:i+"/"+n,base:i,quote:n,settle:void 0,baseId:t,quoteId:a,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:void 0,price:void 0},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(s,"min_size"),max:void 0}},info:s})}}return h}async fetchMarketsV3(e={}){const t=await this.v3PrivateGetBrokerageProducts(e),i=await this.v3PrivateGetBrokerageTransactionSummary(e),s=this.safeValue(i,"fee_tier",{}),r=this.safeValue(t,"products",[]),a=[];for(let e=0;e<r.length;e++){const t=r[e],i=this.safeString(t,"product_id"),n=this.safeString(t,"base_currency_id"),o=this.safeString(t,"quote_currency_id"),h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o),c=this.safeStringLower(t,"product_type"),l=this.safeValue(t,"trading_disabled"),u=this.safeValue(this.options,"stablePairs",[]);a.push({id:i,symbol:h+"/"+d,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:c,spot:"spot"===c,margin:void 0,swap:!1,future:!1,option:!1,active:!l,contract:!1,linear:void 0,inverse:void 0,taker:this.inArray(i,u)?1e-5:this.safeNumber(s,"taker_fee_rate"),maker:this.inArray(i,u)?0:this.safeNumber(s,"maker_fee_rate"),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(t,"base_increment"),price:this.safeNumber(t,"quote_increment")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"base_min_size"),max:this.safeNumber(t,"base_max_size")},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"quote_min_size"),max:this.safeNumber(t,"quote_max_size")}},info:t})}return a}async fetchCurrenciesFromCache(e={}){const t=this.safeValue(this.options,"fetchCurrencies",{}),i=this.safeInteger(t,"timestamp"),s=this.safeInteger(t,"expires",1e3),r=this.milliseconds();if(void 0===i||r-i>s){const i=await this.v2PublicGetCurrencies(e),s=await this.v2PublicGetExchangeRates(e);this.options.fetchCurrencies=this.extend(t,{currencies:i,exchangeRates:s,timestamp:r})}return this.safeValue(this.options,"fetchCurrencies",{})}async fetchCurrencies(e={}){const t=await this.fetchCurrenciesFromCache(e),i=this.safeValue(t,"currencies",{}),s=this.safeValue(t,"exchangeRates",{}),r=this.safeValue(i,"data",[]),a=this.indexBy(r,"id"),n=this.safeValue(this.safeValue(s,"data",{}),"rates",{}),o=Object.keys(n),h={};for(let e=0;e<o.length;e++){const t=o[e],i=t in a?"fiat":"crypto",s=this.safeValue(a,t,{}),r=this.safeString(s,"id",t),n=this.safeString(s,"name"),d=this.safeCurrencyCode(r);h[d]={id:r,code:d,info:s,type:i,name:n,active:!0,deposit:void 0,withdraw:void 0,fee:void 0,precision:void 0,limits:{amount:{min:this.safeNumber(s,"min_size"),max:void 0},withdraw:{min:void 0,max:void 0}}}}return h}async fetchTickers(e,t={}){return"fetchTickersV3"===this.safeString(this.options,"fetchTickers","fetchTickersV3")?await this.fetchTickersV3(e,t):await this.fetchTickersV2(e,t)}async fetchTickersV2(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.v2PublicGetExchangeRates(this.extend({},t)),s=this.safeValue(i,"data",{}),r=this.safeValue(s,"rates",{}),a=this.safeString(s,"currency"),n={},o=Object.keys(r);for(let e=0;e<o.length;e++){const t=o[e],i=t+"-"+a,s=this.safeMarket(i,void 0,"-");n[s.symbol]=this.parseTicker(r[t],s)}return this.filterByArray(n,"symbol",e)}async fetchTickersV3(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.v3PrivateGetBrokerageProducts(t),s=this.safeValue(i,"products",[]),r={};for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"product_id"),a=this.safeMarket(i,void 0,"-");r[a.symbol]=this.parseTicker(t,a)}return this.filterByArray(r,"symbol",e)}async fetchTicker(e,t={}){return"fetchTickerV3"===this.safeString(this.options,"fetchTicker","fetchTickerV3")?await this.fetchTickerV3(e,t):await this.fetchTickerV2(e,t)}async fetchTickerV2(e,t={}){await this.loadMarkets();const i=this.market(e),s=this.extend({symbol:i.id},t),r=await this.v2PublicGetPricesSymbolSpot(s),a=await this.v2PublicGetPricesSymbolBuy(s),n=await this.v2PublicGetPricesSymbolSell(s),o=this.safeValue(r,"data",{}),h=this.safeValue(a,"data",{}),d=this.safeValue(n,"data",{}),c={bid:this.safeNumber(d,"amount"),ask:this.safeNumber(h,"amount"),price:this.safeNumber(o,"amount")};return this.parseTicker(c,i)}async fetchTickerV3(e,t={}){await this.loadMarkets();const i=this.market(e),s={product_id:i.id,limit:1},r=await this.v3PrivateGetBrokerageProductsProductIdTicker(this.extend(s,t)),a=this.safeValue(r,"trades",[]);return this.parseTicker(a[0],i)}parseTicker(e,t){const i=this.safeString(e,"product_id"),s=this.safeNumber(e,"price");return this.safeTicker({symbol:this.safeSymbol(i,t),timestamp:void 0,datetime:void 0,bid:this.safeNumber(e,"bid"),ask:this.safeNumber(e,"ask"),last:s,high:void 0,low:void 0,bidVolume:void 0,askVolume:void 0,vwap:void 0,open:void 0,close:s,previousClose:void 0,change:void 0,percentage:this.safeNumber(e,"price_percentage_change_24h"),average:void 0,baseVolume:void 0,quoteVolume:void 0,info:e},t)}parseBalance(e,t={}){const i=this.safeValue(e,"data",[]),s=this.safeValue(t,"type",this.options.accounts),r={info:e};for(let e=0;e<i.length;e++){const t=i[e],a=this.safeString(t,"type");if(this.inArray(a,s)){const e=this.safeValue(t,"balance");if(void 0!==e){const t=this.safeString(e,"currency"),i=this.safeCurrencyCode(t),s=this.safeString(e,"amount"),a=s;let n=this.safeValue(r,i);void 0===n?(n=this.account(),n.free=a,n.total=s):(n.free=g.stringAdd(n.free,s),n.total=g.stringAdd(n.total,s)),r[i]=n}}}return this.safeBalance(r)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.v2PrivateGetAccounts(this.extend({limit:100},e));return this.parseBalance(t,e)}async fetchLedger(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.currency(e));const a=await this.prepareAccountRequestWithCurrencyCode(e,i,s),n=this.omit(s,["account_id","accountId"]),o=await this.v2PrivateGetAccountsAccountIdTransactions(this.extend(a,n));return this.parseLedger(o.data,r,t,i)}parseLedgerEntryStatus(e){return this.safeString({completed:"ok"},e,e)}parseLedgerEntryType(e){return this.safeString({buy:"trade",sell:"trade",fiat_deposit:"transaction",fiat_withdrawal:"transaction",exchange_deposit:"transaction",exchange_withdrawal:"transaction",send:"transaction",pro_deposit:"transaction",pro_withdrawal:"transaction"},e,e)}parseLedgerEntry(e,t){const i=this.safeValue(e,"amount",{});let s,r=this.safeString(i,"amount");g.stringLt(r,"0")?(s="out",r=g.stringNeg(r)):s="in";const a=this.safeString(i,"currency"),n=this.safeCurrencyCode(a,t);let o;const h=this.safeValue(e,"network",{}),d=this.safeValue(h,"transaction_fee");if(void 0!==d){const e=this.safeString(d,"currency"),i=this.safeCurrencyCode(e,t);o={cost:this.safeNumber(d,"amount"),currency:i}}const c=this.parse8601(this.safeValue(e,"created_at")),l=this.safeString(e,"id"),u=this.parseLedgerEntryType(this.safeString(e,"type")),f=this.parseLedgerEntryStatus(this.safeString(e,"status")),p=this.safeString(e,"resource_path");let m;if(void 0!==p){const e=p.split("/");e.length>3&&(m=e[3])}return{info:e,id:l,timestamp:c,datetime:this.iso8601(c),direction:s,account:m,referenceId:void 0,referenceAccount:void 0,type:u,currency:n,amount:this.parseNumber(r),before:void 0,after:void 0,status:f,fee:o}}async findAccountId(e){await this.loadMarkets(),await this.loadAccounts();for(let t=0;t<this.accounts.length;t++){const i=this.accounts[t];if(i.code===e)return i.id}}prepareAccountRequest(e,t={}){const i=this.safeString2(t,"account_id","accountId");if(void 0===i)throw new a(this.id+" prepareAccountRequest() method requires an account_id (or accountId) parameter");const s={account_id:i};return void 0!==e&&(s.limit=e),s}async prepareAccountRequestWithCurrencyCode(e,t,i={}){let s=this.safeString2(i,"account_id","accountId");if(void 0===s){if(void 0===e)throw new a(this.id+" prepareAccountRequestWithCurrencyCode() method requires an account_id (or accountId) parameter OR a currency code argument");if(s=await this.findAccountId(e),void 0===s)throw new r(this.id+" prepareAccountRequestWithCurrencyCode() could not find account id for "+e)}const n={account_id:s};return void 0!==t&&(n.limit=t),n}async createOrder(e,t,i,s,a,n={}){await this.loadMarkets();const c=this.market(e),l={client_order_id:this.uuid(),product_id:c.id,side:i.toUpperCase()},u=this.safeNumberN(n,["stopPrice","stop_price","triggerPrice"]),f=this.safeNumber(n,"stopLossPrice"),p=this.safeNumber(n,"takeProfitPrice"),m=void 0!==u,y=void 0!==f,b=void 0!==p,v=this.safeString(n,"timeInForce"),w="PO"===v||this.safeValue2(n,"postOnly","post_only",!1),S=this.safeString(n,"end_time");let k=this.safeString(n,"stop_direction");if("limit"===t)if(m)if(void 0===k&&(k="buy"===i?"STOP_DIRECTION_STOP_DOWN":"STOP_DIRECTION_STOP_UP"),"GTD"===v||void 0!==S){if(void 0===S)throw new r(this.id+" createOrder() requires an end_time parameter for a GTD order");l.order_configuration={stop_limit_stop_limit_gtd:{base_size:this.amountToPrecision(e,s),limit_price:this.priceToPrecision(e,a),stop_price:this.priceToPrecision(e,u),stop_direction:k,end_time:S}}}else l.order_configuration={stop_limit_stop_limit_gtc:{base_size:this.amountToPrecision(e,s),limit_price:this.priceToPrecision(e,a),stop_price:this.priceToPrecision(e,u),stop_direction:k}};else if(y||b){let t;y?(void 0===k&&(k="buy"===i?"STOP_DIRECTION_STOP_UP":"STOP_DIRECTION_STOP_DOWN"),t=this.priceToPrecision(e,f)):(void 0===k&&(k="buy"===i?"STOP_DIRECTION_STOP_DOWN":"STOP_DIRECTION_STOP_UP"),t=this.priceToPrecision(e,p)),l.order_configuration={stop_limit_stop_limit_gtc:{base_size:this.amountToPrecision(e,s),limit_price:this.priceToPrecision(e,a),stop_price:t,stop_direction:k}}}else if("GTD"===v||void 0!==S){if(void 0===S)throw new r(this.id+" createOrder() requires an end_time parameter for a GTD order");l.order_configuration={limit_limit_gtd:{base_size:this.amountToPrecision(e,s),limit_price:this.priceToPrecision(e,a),end_time:S,post_only:w}}}else l.order_configuration={limit_limit_gtc:{base_size:this.amountToPrecision(e,s),limit_price:this.priceToPrecision(e,a),post_only:w}};else{if(m||y||b)throw new d(this.id+" createOrder() only stop limit orders are supported");if("buy"===i){let t;if(this.safeValue(this.options,"createMarketBuyOrderRequiresPrice",!0)){if(void 0===a)throw new h(this.id+" createOrder() requires a price argument for market buy orders on spot markets to calculate the total amount to spend (amount * price), alternatively set the createMarketBuyOrderRequiresPrice option to false and pass in the cost to spend into the amount parameter");{const i=this.numberToString(s),r=this.numberToString(a),n=this.parseNumber(g.stringMul(i,r));t=this.priceToPrecision(e,n)}}else t=this.amountToPrecision(e,s);l.order_configuration={market_market_ioc:{quote_size:t}}}else l.order_configuration={market_market_ioc:{base_size:this.amountToPrecision(e,s)}}}n=this.omit(n,["timeInForce","triggerPrice","stopLossPrice","takeProfitPrice","stopPrice","stop_price","stopDirection","stop_direction","clientOrderId","postOnly","post_only","end_time"]);const T=await this.v3PrivatePostBrokerageOrders(this.extend(l,n));if(!0!==this.safeValue(T,"success"))throw new o(this.id+" createOrder() has failed, check your arguments and parameters");const _=this.safeValue(T,"success_response",{});return this.parseOrder(_,c)}parseOrder(e,t){const i=this.safeString(e,"product_id"),s=this.safeSymbol(i,t,"-");void 0!==s&&(t=this.market(s));const r=this.safeValue(e,"order_configuration",{}),a=this.safeValue(r,"limit_limit_gtc",{}),n=this.safeValue(r,"limit_limit_gtd",{}),o=this.safeValue(r,"stop_limit_stop_limit_gtc",{}),h=this.safeValue(r,"stop_limit_stop_limit_gtd",{}),d=this.safeValue(r,"market_market_ioc",{}),c=void 0!==o||void 0!==h;let l,u,f,p;if(void 0!==a||void 0!==n){const e=void 0!==a?a:n;l=this.safeString(e,"limit_price"),u=this.safeString(e,"base_size"),f=this.safeValue(e,"post_only")}else if(c){const e=void 0!==o?o:h;l=this.safeString(e,"limit_price"),u=this.safeString(e,"base_size"),f=this.safeValue(e,"post_only"),p=this.safeString(e,"stop_price")}else u=this.safeString(d,"base_size");const m=this.safeString(e,"created_time");return this.safeOrder({info:e,id:this.safeString(e,"order_id"),clientOrderId:this.safeString(e,"client_order_id"),timestamp:this.parse8601(m),datetime:m,lastTradeTimestamp:void 0,symbol:s,type:this.parseOrderType(this.safeString(e,"order_type")),timeInForce:this.parseTimeInForce(this.safeString(e,"time_in_force")),postOnly:f,side:this.safeStringLower(e,"side"),price:l,stopPrice:p,triggerPrice:p,amount:u,filled:this.safeString(e,"filled_size"),remaining:void 0,cost:void 0,average:this.safeString(e,"average_filled_price"),status:this.parseOrderStatus(this.safeString(e,"status")),fee:{cost:this.safeString(e,"total_fees"),currency:void 0},trades:void 0},t)}parseOrderStatus(e){const t={OPEN:"open",FILLED:"closed",CANCELLED:"canceled",EXPIRED:"canceled",FAILED:"canceled",UNKNOWN_ORDER_STATUS:void 0};return this.safeString(t,e,e)}parseOrderType(e){if("UNKNOWN_ORDER_TYPE"===e)return;return this.safeString({MARKET:"market",LIMIT:"limit",STOP:"limit",STOP_LIMIT:"limit"},e,e)}parseTimeInForce(e){const t={GOOD_UNTIL_CANCELLED:"GTC",GOOD_UNTIL_DATE_TIME:"GTD",IMMEDIATE_OR_CANCEL:"IOC",FILL_OR_KILL:"FOK",UNKNOWN_TIME_IN_FORCE:void 0};return this.safeString(t,e,e)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s=await this.cancelOrders([e],t,i);return this.safeValue(s,0,{})}async cancelOrders(e,t,i={}){let s;await this.loadMarkets(),void 0!==t&&(s=this.market(t));const r={order_ids:e},a=await this.v3PrivatePostBrokerageOrdersBatchCancel(this.extend(r,i)),n=this.safeValue(a,"results",[]);for(let e=0;e<n.length;e++){if(!0!==this.safeValue(n[e],"success"))throw new o(this.id+" cancelOrders() has failed, check your arguments and parameters")}return this.parseOrders(n,s)}async fetchOrder(e,t,i={}){let s;await this.loadMarkets(),void 0!==t&&(s=this.market(t));const r={order_id:e},a=await this.v3PrivateGetBrokerageOrdersHistoricalOrderId(this.extend(r,i)),n=this.safeValue(a,"order",{});return this.parseOrder(n,s)}async fetchOrders(e,t,i=100,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e));const a={};void 0!==r&&(a.product_id=r.id),void 0!==i&&(a.limit=i),void 0!==t&&(a.start_date=this.parse8601(t));const n=await this.v3PrivateGetBrokerageOrdersHistoricalBatch(this.extend(a,s)),o=this.safeValue(n,"orders",[]);return this.parseOrders(o,r,t,i)}async fetchOrdersByStatus(e,t,i,s,r={}){let a;await this.loadMarkets(),void 0!==t&&(a=this.market(t));const n={order_status:e};void 0!==a&&(n.product_id=a.id),void 0===s&&(s=100),n.limit=s,void 0!==i&&(n.start_date=this.parse8601(i));const o=await this.v3PrivateGetBrokerageOrdersHistoricalBatch(this.extend(n,r)),h=this.safeValue(o,"orders",[]);return this.parseOrders(h,a,i,s)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("OPEN",e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("FILLED",e,t,i,s)}async fetchCanceledOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("CANCELLED",e,t,i,s)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.seconds().toString(),o={product_id:a.id,granularity:this.safeString(this.timeframes,t,t),end:n};if(void 0!==i){const e=i.toString(),t=g.stringDiv(e,"1000");o.start=this.decimalToPrecision(t,p,0,m)}else o.start=g.stringSub(n,"18000");const h=await this.v3PrivateGetBrokerageProductsProductIdCandles(this.extend(o,r)),d=this.safeValue(h,"candles",[]);return this.parseOHLCVs(d,a,t,i,s)}parseOHLCV(e,t){return[this.safeTimestamp(e,"start"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={product_id:r.id};void 0!==i&&(a.limit=i);const n=await this.v3PrivateGetBrokerageProductsProductIdTicker(this.extend(a,s)),o=this.safeValue(n,"trades",[]);return this.parseTrades(o,r,t,i)}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e));const a={};void 0!==r&&(a.product_id=r.id),void 0!==i&&(a.limit=i),void 0!==t&&(a.start_sequence_timestamp=this.iso8601(t));const n=await this.v3PrivateGetBrokerageOrdersHistoricalFills(this.extend(a,s)),o=this.safeValue(n,"fills",[]);return this.parseTrades(o,r,t,i)}sign(e,t=[],i="GET",s={},r,a){const n=t[0],o="private"===t[1];let h="/"+("v3"===n?"api/v3":"v2")+"/"+this.implodeParams(e,s);const d=this.omit(s,this.extractParams(e)),c=h;"GET"===i&&Object.keys(d).length&&(h+="?"+this.urlencode(d));const l=this.urls.api.rest+h;if(o){const e=this.safeString(this.headers,"Authorization");if(void 0!==e)r={Authorization:e,"Content-Type":"application/json"};else if(this.token)r={Authorization:"Bearer "+this.token,"Content-Type":"application/json"};else{this.checkRequiredCredentials();const e=this.nonce().toString();let t,s="";"GET"!==i&&Object.keys(d).length&&(s=a=this.json(d)),t="v3"===n?e+i+c+s:e+i+h+s;const o=this.hmac(this.encode(t),this.encode(this.secret));r={"CB-ACCESS-KEY":this.apiKey,"CB-ACCESS-SIGN":o,"CB-ACCESS-TIMESTAMP":e,"Content-Type":"application/json"}}}return{url:l,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;const c=this.id+" "+n;let l=this.safeString(o,"error");if(void 0!==l){const e=this.safeString(o,"error_description");throw this.throwExactlyMatchedException(this.exceptions.exact,l,c),this.throwBroadlyMatchedException(this.exceptions.broad,e,c),new r(c)}const u=this.safeValue(o,"errors");if(void 0!==u&&Array.isArray(u)){if(u.length>0){l=this.safeString(u[0],"id");const e=this.safeString(u[0],"message");if(void 0!==l)throw this.throwExactlyMatchedException(this.exceptions.exact,l,c),this.throwBroadlyMatchedException(this.exceptions.broad,e,c),new r(c)}}const f=this.options.advanced;if(void 0===this.safeValue(o,"data")&&!f)throw new r(this.id+" failed due to a malformed response "+this.json(o))}}},18806:function(e,t,i){"use strict";const s=i(51241);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"coinbaseprime",name:"Coinbase Prime",pro:!0,hostname:"exchange.coinbase.com",urls:{test:{public:"https://public.sandbox.exchange.coinbase.com",private:"https://public.sandbox.exchange.coinbase.com"},logo:"https://user-images.githubusercontent.com/1294454/44539184-29f26e00-a70c-11e8-868f-e907fc236a7c.jpg",api:{public:"https://api.{hostname}",private:"https://api.{hostname}"},www:"https://exchange.coinbase.com",doc:"https://docs.exchange.coinbase.com"}})}}},51241:function(e,t,i){"use strict";const s=i(48819),{InsufficientFunds:r,ArgumentsRequired:a,ExchangeError:n,InvalidOrder:o,InvalidAddress:h,AuthenticationError:d,NotSupported:c,OrderNotFound:l,OnMaintenance:u,PermissionDenied:f,RateLimitExceeded:p}=i(73449),{TICK_SIZE:m}=i(62115),g=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"coinbasepro",name:"Coinbase Pro",countries:["US"],rateLimit:100,userAgent:this.userAgents.chrome,pro:!0,has:{CORS:!0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,cancelAllOrders:!0,cancelOrder:!0,createDepositAddress:!0,createOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchAccounts:!0,fetchBalance:!0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!1,fetchDeposits:!0,fetchLedger:!0,fetchMarginMode:!1,fetchMarkets:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchOrderTrades:!0,fetchPositionMode:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactions:!0,fetchWithdrawals:!0,withdraw:!0},timeframes:{"1m":60,"5m":300,"15m":900,"1h":3600,"6h":21600,"1d":86400},hostname:"pro.coinbase.com",urls:{test:{public:"https://api-public.sandbox.pro.coinbase.com",private:"https://api-public.sandbox.pro.coinbase.com"},logo:"https://user-images.githubusercontent.com/1294454/41764625-63b7ffde-760a-11e8-996d-a6328fa9347a.jpg",api:{public:"https://api.{hostname}",private:"https://api.{hostname}"},www:"https://pro.coinbase.com/",doc:"https://docs.pro.coinbase.com",fees:["https://docs.pro.coinbase.com/#fees","https://support.pro.coinbase.com/customer/en/portal/articles/2945310-fees"]},requiredCredentials:{apiKey:!0,secret:!0,password:!0},api:{public:{get:["currencies","products","products/{id}","products/{id}/book","products/{id}/candles","products/{id}/stats","products/{id}/ticker","products/{id}/trades","time","products/spark-lines"]},private:{get:["accounts","accounts/{id}","accounts/{id}/holds","accounts/{id}/ledger","accounts/{id}/transfers","coinbase-accounts","fills","funding","fees","margin/profile_information","margin/buying_power","margin/withdrawal_power","margin/withdrawal_power_all","margin/exit_plan","margin/liquidation_history","margin/position_refresh_amounts","margin/status","oracle","orders","orders/{id}","orders/client:{client_oid}","otc/orders","payment-methods","position","profiles","profiles/{id}","reports/{report_id}","transfers","transfers/{transfer_id}","users/self/exchange-limits","users/self/hold-balances","users/self/trailing-volume","withdrawals/fee-estimate","conversions/{conversion_id}"],post:["conversions","deposits/coinbase-account","deposits/payment-method","coinbase-accounts/{id}/addresses","funding/repay","orders","position/close","profiles/margin-transfer","profiles/transfer","reports","withdrawals/coinbase","withdrawals/coinbase-account","withdrawals/crypto","withdrawals/payment-method"],delete:["orders","orders/client:{client_oid}","orders/{id}"]}},commonCurrencies:{CGLD:"CELO"},precisionMode:m,fees:{trading:{tierBased:!0,percentage:!0,maker:this.parseNumber("0.004"),taker:this.parseNumber("0.006")},funding:{tierBased:!1,percentage:!1,withdraw:{BCH:0,BTC:0,LTC:0,ETH:0,EUR:.15,USD:25},deposit:{BCH:0,BTC:0,LTC:0,ETH:0,EUR:.15,USD:10}}},exceptions:{exact:{"Insufficient funds":r,NotFound:l,"Invalid API Key":d,"invalid signature":d,"Invalid Passphrase":d,"Invalid order id":o,"Private rate limit exceeded":p,"Trading pair not available":f,"Product not found":o},broad:{"Order already done":l,"order not found":l,"price too small":o,"price too precise":o,"under maintenance":u,"size is too small":o,"Cancel only mode":u}}})}async fetchCurrencies(e={}){const t=await this.publicGetCurrencies(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"id"),a=this.safeString(s,"name"),n=this.safeCurrencyCode(r),o=this.safeValue(s,"details",{}),h="online"===this.safeString(s,"status");i[n]={id:r,code:n,info:s,type:this.safeString(o,"type"),name:a,active:h,deposit:void 0,withdraw:void 0,fee:void 0,precision:this.safeNumber(s,"max_precision"),limits:{amount:{min:this.safeNumber(o,"min_size"),max:void 0},withdraw:{min:this.safeNumber(o,"min_withdrawal_amount"),max:void 0}}}}return i}async fetchMarkets(e={}){const t=await this.publicGetProducts(e),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"id"),[a,n]=r.split("-"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=this.safeString(s,"status");i.push(this.extend(this.fees.trading,{id:r,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:this.safeValue(s,"margin_enabled"),swap:!1,future:!1,option:!1,active:"online"===d,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(s,"base_increment"),price:this.safeNumber(s,"quote_increment")},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(s,"min_market_funds"),max:void 0}},info:s}))}return i}async fetchAccounts(e={}){await this.loadMarkets();const t=await this.privateGetAccounts(e);return this.parseAccounts(t,e)}parseAccount(e){const t=this.safeString(e,"currency");return{id:this.safeString(e,"id"),type:void 0,code:this.safeCurrencyCode(t),info:e}}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"available"),n.used=this.safeString(s,"hold"),n.total=this.safeString(s,"balance"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetAccounts(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={id:this.marketId(e),level:2},r=await this.publicGetProductsIdBook(this.extend(s,i)),a=this.parseOrderBook(r,e);return a.nonce=this.safeInteger(r,"sequence"),a}parseTicker(e,t){let i,s,r,a,n,o,h,d;const c=void 0===t?void 0:t.symbol;return Array.isArray(e)?(a=this.safeString(e,4),i=this.milliseconds()):(i=this.parse8601(this.safeValue(e,"time")),s=this.safeString(e,"bid"),r=this.safeString(e,"ask"),n=this.safeString(e,"high"),o=this.safeString(e,"low"),h=this.safeString(e,"open"),a=this.safeString2(e,"price","last"),d=this.safeString(e,"volume")),this.safeTicker({symbol:c,timestamp:i,datetime:this.iso8601(i),high:n,low:o,bid:s,bidVolume:void 0,ask:r,askVolume:void 0,vwap:void 0,open:h,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:d,quoteVolume:void 0,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetProductsSparkLines(this.extend({},t)),s={},r=Object.keys(i);for(let e=0;e<r.length;e++){const t=r[e],a=this.safeValue(i,t,[]),n=this.safeValue(a,0,[]),o=this.safeMarket(t,void 0,"-");s[o.symbol]=this.parseTicker(n,o)}return this.filterByArray(s,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={id:i.id},r=this.safeString(this.options,"fetchTickerMethod","publicGetProductsIdTicker"),a=await this[r](this.extend(s,t));return this.parseTicker(a,i)}parseTrade(e,t){const i=this.parse8601(this.safeString2(e,"time","created_at")),s=this.safeString(e,"product_id");let r,a,n;t=this.safeMarket(s,t,"-");const o=this.safeStringLower(t,"quoteId");if(void 0!==o){const i=o+"_value";n=this.safeString(e,i);const s=this.safeString(e,"liquidity");void 0!==s&&(a="T"===s?"taker":"maker",r=this.safeString(t,a))}const h={cost:this.safeString2(e,"fill_fees","fee"),currency:t.quote,rate:r},d=this.safeString(e,"trade_id");let c="buy"===e.side?"sell":"buy";const l=this.safeString(e,"order_id"),u=this.safeString(e,"maker_order_id"),f=this.safeString(e,"taker_order_id");(void 0!==l||void 0!==u&&void 0!==f)&&(c="buy"===e.side?"buy":"sell");const p=this.safeString(e,"price"),m=this.safeString(e,"size");return this.safeTrade({id:d,order:l,info:e,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,type:void 0,takerOrMaker:a,side:c,price:p,amount:m,fee:h,cost:n},t)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={product_id:r.id};void 0!==i&&(n.limit=i);const o=await this.privateGetFills(this.extend(n,s));return this.parseTrades(o,r,t,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={id:r.id};void 0!==i&&(a.limit=i);const n=await this.publicGetProductsIdTrades(this.extend(a,s));return this.parseTrades(n,r,t,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privateGetFees(e),i=this.safeNumber(t,"maker_fee_rate"),s=this.safeNumber(t,"taker_fee_rate"),r={};for(let e=0;e<this.symbols.length;e++){const a=this.symbols[e];r[a]={info:t,symbol:a,maker:i,taker:s,percentage:!0,tierBased:!0}}return r}parseOHLCV(e,t){return[this.safeTimestamp(e,0),this.safeNumber(e,3),this.safeNumber(e,2),this.safeNumber(e,1),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.safeInteger(this.timeframes,t,t),o={id:a.id,granularity:n};void 0!==i&&(o.start=this.iso8601(i),s=void 0===s?300:Math.min(300,s),o.end=this.iso8601(this.sum((s-1)*n*1e3,i)));const h=await this.publicGetProductsIdCandles(this.extend(o,r));return this.parseOHLCVs(h,a,t,i,s)}async fetchTime(e={}){const t=await this.publicGetTime(e);return this.safeTimestamp(t,"epoch")}parseOrderStatus(e){return this.safeString({pending:"open",active:"open",open:"open",done:"closed",canceled:"canceled",canceling:"open"},e,e)}parseOrder(e,t){const i=this.parse8601(this.safeString(e,"created_at")),s=this.safeString(e,"product_id");t=this.safeMarket(s,t,"-");let r=this.parseOrderStatus(this.safeString(e,"status"));const a=this.safeString(e,"done_reason");"closed"===r&&"canceled"===a&&(r="canceled");const n=this.safeString(e,"price"),o=this.safeString(e,"filled_size"),h=this.safeString(e,"size",o),d=this.safeString(e,"executed_value"),c=this.safeNumber(e,"fill_fees");let l;void 0!==c&&(l={cost:c,currency:t.quote,rate:void 0});const u=this.safeString(e,"id"),f=this.safeString(e,"type"),p=this.safeString(e,"side"),m=this.safeString(e,"time_in_force"),g=this.safeValue(e,"post_only"),y=this.safeNumber(e,"stop_price"),b=this.safeString(e,"client_oid");return this.safeOrder({id:u,clientOrderId:b,info:e,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:void 0,status:r,symbol:t.symbol,type:f,timeInForce:m,postOnly:g,side:p,price:n,stopPrice:y,triggerPrice:y,cost:d,amount:h,filled:o,remaining:void 0,fee:l,average:void 0,trades:void 0},t)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={},r=this.safeString2(i,"clientOrderId","client_oid");let a;void 0===r?(a="privateGetOrdersId",s.id=e):(a="privateGetOrdersClientClientOid",s.client_oid=r,i=this.omit(i,["clientOrderId","client_oid"]));const n=await this[a](this.extend(s,i));return this.parseOrder(n)}async fetchOrderTrades(e,t,i,s,r={}){let a;await this.loadMarkets(),void 0!==t&&(a=this.market(t));const n={order_id:e},o=await this.privateGetFills(this.extend(n,r));return this.parseTrades(o,a,i,s)}async fetchOrders(e,t,i,s={}){return await this.fetchOpenOrders(e,t,i,this.extend({status:"all"},s))}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.product_id=a.id),void 0!==i&&(r.limit=i);const n=await this.privateGetOrders(this.extend(r,s));return this.parseOrders(n,a,t,i)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOpenOrders(e,t,i,this.extend({status:"done"},s))}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={type:t,side:i,product_id:n.id},h=this.safeString2(a,"clientOrderId","client_oid");void 0!==h&&(o.client_oid=h);const d=this.safeNumber2(a,"stopPrice","stop_price");void 0!==d&&(o.stop_price=this.priceToPrecision(e,d));const c=this.safeString2(a,"timeInForce","time_in_force");void 0!==c&&(o.time_in_force=c);if(this.safeValue2(a,"postOnly","post_only",!1)&&(o.post_only=!0),a=this.omit(a,["timeInForce","time_in_force","stopPrice","stop_price","clientOrderId","client_oid","postOnly","post_only"]),"limit"===t)o.price=this.priceToPrecision(e,r),o.size=this.amountToPrecision(e,s);else if("market"===t){let t=this.safeNumber2(a,"cost","funds");void 0===t?void 0!==r&&(t=s*r):a=this.omit(a,["cost","funds"]),void 0!==t?o.funds=this.costToPrecision(e,t):o.size=this.amountToPrecision(e,s)}const l=await this.privatePostOrders(this.extend(o,a));return this.parseOrder(l,n)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={},r=this.safeString2(i,"clientOrderId","client_oid");let a,n;return void 0===r?(a="privateDeleteOrdersId",s.id=e):(a="privateDeleteOrdersClientClientOid",s.client_oid=r,i=this.omit(i,["clientOrderId","client_oid"])),void 0!==t&&(n=this.market(t),s.product_id=n.symbol),await this[a](this.extend(s,i))}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};let s;return void 0!==e&&(s=this.market(e),i.product_id=s.symbol),await this.privateDeleteOrders(this.extend(i,t))}async fetchPaymentMethods(e={}){return await this.privateGetPaymentMethods(e)}async deposit(e,t,i,s={}){await this.loadMarkets();const r={currency:this.currency(e).id,amount:t};let a="privatePostDeposits";if("payment_method_id"in s)a+="PaymentMethod";else{if(!("coinbase_account_id"in s))throw new c(this.id+" deposit() requires one of `coinbase_account_id` or `payment_method_id` extra params");a+="CoinbaseAccount"}const o=await this[a](this.extend(r,s));if(!o)throw new n(this.id+" deposit() error: "+this.json(o));return{info:o,id:o.id}}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),o={currency:a.id,amount:t};let h="privatePostWithdrawals";"payment_method_id"in r?h+="PaymentMethod":"coinbase_account_id"in r?h+="CoinbaseAccount":(h+="Crypto",o.crypto_address=i,void 0!==s&&(o.destination_tag=s));const d=await this[h](this.extend(o,r));if(!d)throw new n(this.id+" withdraw() error: "+this.json(d));return this.parseTransaction(d,a)}parseLedgerEntryType(e){return this.safeString({transfer:"transfer",match:"trade",fee:"fee",rebate:"rebate",conversion:"trade"},e,e)}parseLedgerEntry(e,t){const i=this.safeString(e,"id");let s,r=this.safeString(e,"amount");const a=this.safeString(e,"balance"),n=g.stringSub(a,r);g.stringLt(r,"0")?(s="out",r=g.stringAbs(r)):s="in";const o=this.parseNumber(r),h=this.parseNumber(a),d=this.parseNumber(n),c=this.parse8601(this.safeValue(e,"created_at")),l=this.parseLedgerEntryType(this.safeString(e,"type")),u=this.safeCurrencyCode(void 0,t),f=this.safeValue(e,"details",{});let p,m,y;"transfer"===l?(p=this.safeString(f,"from"),m=this.safeString(f,"to"),y=this.safeString(f,"profile_transfer_id")):y=this.safeString(f,"order_id");return{id:i,currency:u,account:p,referenceAccount:m,referenceId:y,status:"ok",amount:o,before:d,after:h,fee:void 0,direction:s,timestamp:c,datetime:this.iso8601(c),type:l,info:e}}async fetchLedger(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchLedger() requires a code param");await this.loadMarkets(),await this.loadAccounts();const r=this.currency(e),o=this.indexBy(this.accounts,"code"),h=this.safeValue(o,e);if(void 0===h)throw new n(this.id+" fetchLedger() could not find account id for "+e);const d={id:h.id};void 0!==t&&(d.start_date=this.iso8601(t)),void 0!==i&&(d.limit=i);const c=await this.privateGetAccountsIdLedger(this.extend(d,s));for(let t=0;t<c.length;t++)c[t].currency=e;return this.parseLedger(c,r,t,i)}async fetchTransactions(e,t,i,s={}){let r;await this.loadMarkets(),await this.loadAccounts();let a=this.safeString(s,"id");if(void 0===a&&void 0!==e){r=this.currency(e);const t=this.indexBy(this.accounts,"code"),i=this.safeValue(t,e);if(void 0===i)throw new n(this.id+" fetchTransactions() could not find account id for "+e);a=i.id}const o={};let h;if(void 0!==a&&(o.id=a),void 0!==i&&(o.limit=i),void 0===a){h=await this.privateGetTransfers(this.extend(o,s));for(let e=0;e<h.length;e++){const t=this.safeString(h[e],"account_id"),i=this.safeValue(this.accountsById,t),s=this.safeString(i,"code");h[e].currency=s}}else{h=await this.privateGetAccountsIdTransfers(this.extend(o,s));for(let t=0;t<h.length;t++)h[t].currency=e}return this.parseTransactions(h,r,t,i)}async fetchDeposits(e,t,i,s={}){return await this.fetchTransactions(e,t,i,this.extend({type:"deposit"},s))}async fetchWithdrawals(e,t,i,s={}){return await this.fetchTransactions(e,t,i,this.extend({type:"withdraw"},s))}parseTransactionStatus(e){if(this.safeValue(e,"canceled_at"))return"canceled";const t=this.safeValue(e,"processed_at"),i=this.safeValue(e,"completed_at");return i?"ok":t&&!i?"failed":"pending"}parseTransaction(e,t){const i=this.safeValue(e,"details",{}),s=this.parse8601(this.safeString(e,"created_at")),r=this.safeString(e,"currency"),a=this.safeCurrencyCode(r,t);let n=this.safeNumber(e,"amount"),o=this.safeString(e,"type"),h=this.safeString(i,"crypto_address");h=this.safeString(e,"crypto_address",h);const d={currency:void 0,cost:void 0,rate:void 0};if("withdraw"===o){o="withdrawal",h=this.safeString(i,"sent_to_address",h);const e=this.safeNumber(i,"fee");void 0!==e&&(void 0!==n&&(n-=e),d.cost=e,d.currency=a)}const c=this.safeString(i,"network");return{info:e,id:this.safeString(e,"id"),txid:this.safeString(i,"crypto_transaction_hash"),type:o,currency:a,network:this.networkIdToCode(c),amount:n,status:this.parseTransactionStatus(e),timestamp:s,datetime:this.iso8601(s),address:h,addressFrom:void 0,addressTo:this.safeString(i,"crypto_address"),tag:this.safeString(i,"destination_tag"),tagFrom:void 0,tagTo:void 0,updated:this.parse8601(this.safeString(e,"processed_at")),comment:void 0,fee:d}}async createDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e);let s=this.safeValue(this.options,"coinbaseAccounts");void 0===s&&(s=await this.privateGetCoinbaseAccounts(),this.options.coinbaseAccounts=s,this.options.coinbaseAccountsByCurrencyId=this.indexBy(s,"currency"));const r=i.id,a=this.safeValue(this.options.coinbaseAccountsByCurrencyId,r);if(void 0===a)throw new h(this.id+" createDepositAddress() could not find currency code "+e+" with id = "+r+" in this.options['coinbaseAccountsByCurrencyId']");const n={id:a.id},o=await this.privatePostCoinbaseAccountsIdAddresses(this.extend(n,t)),d=this.safeString(o,"address"),c=this.safeString(o,"destination_tag");return{currency:e,address:this.checkAddress(d),tag:c,info:o}}sign(e,t="public",i="GET",s={},r,a){let n="/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));"GET"===i&&Object.keys(o).length&&(n+="?"+this.urlencode(o));const h=this.implodeHostname(this.urls.api[t])+n;if("private"===t){this.checkRequiredCredentials();const e=this.nonce().toString();let t="";"GET"!==i&&Object.keys(o).length&&(t=a=this.json(o));const s=e+i+n+t;let h;try{h=this.base64ToBinary(this.secret)}catch(e){throw new d(this.id+" sign() invalid base64 secret")}const c=this.hmac(this.encode(s),h,"sha256","base64");r={"CB-ACCESS-KEY":this.apiKey,"CB-ACCESS-SIGN":c,"CB-ACCESS-TIMESTAMP":e,"CB-ACCESS-PASSPHRASE":this.password,"Content-Type":"application/json"}}return{url:h,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,o,h,d){if(400===e||404===e){if("{"===a[0]){const e=this.safeString(o,"message"),t=this.id+" "+e;throw this.throwExactlyMatchedException(this.exceptions.exact,e,t),this.throwBroadlyMatchedException(this.exceptions.broad,e,t),new n(t)}throw new n(this.id+" "+a)}}async request(e,t="public",i="GET",s={},r,a,o={},h={}){const d=await this.fetch2(e,t,i,s,r,a,o,h);if("string"!=typeof d&&"message"in d)throw new n(this.id+" "+this.json(d));return d}}},51770:function(e,t,i){"use strict";const s=i(48819),{BadSymbol:r,ExchangeError:a,AuthenticationError:n}=i(73449),{TICK_SIZE:o}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"coincheck",name:"coincheck",countries:["JP","ID"],rateLimit:1500,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrderBook:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1},urls:{logo:"https://user-images.githubusercontent.com/51840849/87182088-1d6d6380-c2ec-11ea-9c64-8ab9f9b289f5.jpg",api:{rest:"https://coincheck.com/api"},www:"https://coincheck.com",doc:"https://coincheck.com/documents/exchange/api",fees:["https://coincheck.com/exchange/fee","https://coincheck.com/info/fee"]},api:{public:{get:["exchange/orders/rate","order_books","rate/{pair}","ticker","trades"]},private:{get:["accounts","accounts/balance","accounts/leverage_balance","bank_accounts","deposit_money","exchange/orders/opens","exchange/orders/transactions","exchange/orders/transactions_pagination","exchange/leverage/positions","lending/borrows/matches","send_money","withdraws"],post:["bank_accounts","deposit_money/{id}/fast","exchange/orders","exchange/transfers/to_leverage","exchange/transfers/from_leverage","lending/borrows","lending/borrows/{id}/repay","send_money","withdraws"],delete:["bank_accounts/{id}","exchange/orders/{id}","withdraws/{id}"]}},markets:{"BTC/JPY":{id:"btc_jpy",symbol:"BTC/JPY",base:"BTC",quote:"JPY",baseId:"btc",quoteId:"jpy",type:"spot",spot:!0},"ETC/JPY":{id:"etc_jpy",symbol:"ETC/JPY",base:"ETC",quote:"JPY",baseId:"etc",quoteId:"jpy",type:"spot",spot:!0},"FCT/JPY":{id:"fct_jpy",symbol:"FCT/JPY",base:"FCT",quote:"JPY",baseId:"fct",quoteId:"jpy",type:"spot",spot:!0},"MONA/JPY":{id:"mona_jpy",symbol:"MONA/JPY",base:"MONA",quote:"JPY",baseId:"mona",quoteId:"jpy",type:"spot",spot:!0},"ETC/BTC":{id:"etc_btc",symbol:"ETC/BTC",base:"ETC",quote:"BTC",baseId:"etc",quoteId:"btc",type:"spot",spot:!0}},fees:{trading:{tierBased:!1,percentage:!0,maker:this.parseNumber("0"),taker:this.parseNumber("0")}},precisionMode:o,exceptions:{exact:{"disabled API Key":n,"invalid authentication":n},broad:{}}})}parseBalance(e){const t={info:e},i=Object.keys(this.currencies);for(let s=0;s<i.length;s++){const r=i[s],a=this.currency(r).id;if(a in e){const i=this.account(),s=a+"_reserved";i.free=this.safeString(e,a),i.used=this.safeString(e,s),t[r]=i}}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetAccountsBalance(e);return this.parseBalance(t)}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e));const a=await this.privateGetExchangeOrdersOpens(s),n=this.safeValue(a,"orders",[]),o=this.parseOrders(n,r,t,i),h=[];for(let e=0;e<o.length;e++)h.push(this.extend(o[e],{status:"open"}));return h}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"order_type"),r=this.parse8601(this.safeString(e,"created_at")),a=this.safeString(e,"pending_amount"),n=this.safeString(e,"pending_amount"),o=this.safeString(e,"rate"),h=this.safeString(e,"pair"),d=this.safeSymbol(h,t,"_");return this.safeOrder({id:i,clientOrderId:void 0,timestamp:r,datetime:this.iso8601(r),lastTradeTimestamp:void 0,amount:a,remaining:n,filled:void 0,side:s,type:void 0,timeInForce:void 0,postOnly:void 0,status:undefined,symbol:d,price:o,stopPrice:void 0,triggerPrice:void 0,cost:void 0,fee:void 0,info:e,average:void 0,trades:void 0},t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={pair:s.id},a=await this.publicGetOrderBooks(this.extend(r,i));return this.parseOrderBook(a,s.symbol)}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.safeTimestamp(e,"timestamp"),r=this.safeString(e,"last");return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:void 0,close:r,last:r,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"volume"),quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){if("BTC/JPY"!==e)throw new r(this.id+" fetchTicker() supports BTC/JPY only");await this.loadMarkets();const i=this.market(e),s={pair:i.id},a=await this.publicGetTicker(this.extend(s,t));return this.parseTicker(a,i)}parseTrade(e,t){const i=this.parse8601(this.safeString(e,"created_at")),s=this.safeString(e,"id"),r=this.safeString(e,"rate"),a=this.safeString(e,"pair"),n=(t=this.safeMarket(a,t,"_")).baseId,o=t.quoteId,h=t.symbol;let d,c,l,u,f,p;if("liquidity"in e){"T"===this.safeString(e,"liquidity")?d="taker":"M"===this.safeString(e,"liquidity")&&(d="maker");const t=this.safeValue(e,"funds",{});c=this.safeString(t,n),l=this.safeString(t,o),f={currency:this.safeString(e,"fee_currency"),cost:this.safeString(e,"fee")},u=this.safeString(e,"side"),p=this.safeString(e,"order_id")}else c=this.safeString(e,"amount"),u=this.safeString(e,"order_type");return this.safeTrade({id:s,info:e,datetime:this.iso8601(i),timestamp:i,symbol:h,type:void 0,side:u,order:p,takerOrMaker:d,price:r,amount:c,cost:l,fee:f},t)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={};void 0!==i&&(a.limit=i);const n=await this.privateGetExchangeOrdersTransactionsPagination(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pair:r.id};void 0!==i&&(a.limit=i);const n=await this.publicGetTrades(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privateGetAccounts(e),i=this.safeValue(t,"exchange_fees",{}),s={};for(let e=0;e<this.symbols.length;e++){const t=this.symbols[e],r=this.market(t),a=this.safeValue(i,r.id,{});s[t]={info:a,symbol:t,maker:this.safeNumber(a,"maker_fee"),taker:this.safeNumber(a,"taker_fee"),percentage:!0,tierBased:!1}}return s}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n={pair:this.market(e).id};if("market"===t){const e=t+"_"+i;n.order_type=e;n[("buy"===i?e+"_":"")+"amount"]=s}else n.order_type=i,n.rate=r,n.amount=s;const o=await this.privatePostExchangeOrders(this.extend(n,a));return{info:o,id:this.safeString(o,"id")}}async cancelOrder(e,t,i={}){const s={id:e};return await this.privateDeleteExchangeOrdersId(this.extend(s,i))}async fetchDeposits(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.currency(e),a.currency=r.id),void 0!==i&&(a.limit=i);const n=await this.privateGetDepositMoney(this.extend(a,s)),o=this.safeValue(n,"deposits",[]);return this.parseTransactions(o,r,t,i,{type:"deposit"})}async fetchWithdrawals(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.currency(e));const a={};void 0!==i&&(a.limit=i);const n=await this.privateGetWithdraws(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTransactions(o,r,t,i,{type:"withdrawal"})}parseTransactionStatus(e){return this.safeString({pending:"pending",processing:"pending",finished:"ok",canceled:"canceled",confirmed:"pending",received:"ok"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=this.parse8601(this.safeString(e,"created_at")),r=this.safeString(e,"address"),a=this.safeNumber(e,"amount"),n=this.safeString(e,"currency"),o=this.safeCurrencyCode(n,t),h=this.parseTransactionStatus(this.safeString(e,"status")),d=this.parse8601(this.safeString(e,"confirmed_at"));let c;const l=this.safeNumber(e,"fee");return void 0!==l&&(c={cost:l,currency:o}),{info:e,id:i,txid:void 0,timestamp:s,datetime:this.iso8601(s),network:void 0,address:r,addressTo:r,addressFrom:void 0,tag:void 0,tagTo:void 0,tagFrom:void 0,type:void 0,amount:a,currency:o,status:h,updated:d,internal:void 0,fee:c}}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if("public"===t)Object.keys(o).length&&(n+="?"+this.urlencode(o));else{this.checkRequiredCredentials();const e=this.nonce().toString();let t="";"GET"===i?Object.keys(o).length&&(n+="?"+this.urlencode(this.keysort(o))):Object.keys(o).length&&(t=a=this.urlencode(this.keysort(o)));const s=e+n+t;r={"Content-Type":"application/x-www-form-urlencoded","ACCESS-KEY":this.apiKey,"ACCESS-NONCE":e,"ACCESS-SIGNATURE":this.hmac(this.encode(s),this.encode(this.secret))}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,n,o,h,d){if(void 0===o)return;if(!this.safeValue(o,"success",!0)){const e=this.safeString(o,"error"),t=this.id+" "+this.json(o);throw this.throwExactlyMatchedException(this.exceptions.exact,e,t),this.throwBroadlyMatchedException(this.exceptions.broad,n,t),new a(this.id+" "+this.json(o))}}}},78427:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,BadRequest:n,BadSymbol:o,RateLimitExceeded:h,InsufficientFunds:d,OrderNotFound:c,InvalidOrder:l,AuthenticationError:u,PermissionDenied:f,ExchangeNotAvailable:p,RequestTimeout:m}=i(73449),{TICK_SIZE:g}=i(62115),y=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"coinex",name:"CoinEx",version:"v1",countries:["CN"],rateLimit:2.5,pro:!0,has:{CORS:void 0,spot:!0,margin:!0,swap:!0,future:!1,option:!1,addMargin:!0,borrowMargin:!0,cancelAllOrders:!0,cancelOrder:!0,createDepositAddress:!0,createOrder:!0,createReduceOnlyOrder:!0,fetchBalance:!0,fetchBorrowInterest:!0,fetchBorrowRate:!0,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDepositAddressByNetwork:!1,fetchDepositAddresses:!1,fetchDeposits:!0,fetchDepositWithdrawFees:!0,fetchDepsoitWithdrawFee:"emulated",fetchFundingHistory:!0,fetchFundingRate:!0,fetchFundingRateHistory:!0,fetchFundingRates:!0,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!0,fetchMarketLeverageTiers:"emulated",fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPosition:!0,fetchPositions:!0,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!0,fetchTransfer:!1,fetchTransfers:!0,fetchWithdrawal:!1,fetchWithdrawals:!0,reduceMargin:!0,repayMargin:!0,setLeverage:!0,setMarginMode:!0,setPositionMode:!1,transfer:!0,withdraw:!0},timeframes:{"1m":"1min","3m":"3min","5m":"5min","15m":"15min","30m":"30min","1h":"1hour","2h":"2hour","4h":"4hour","6h":"6hour","12h":"12hour","1d":"1day","3d":"3day","1w":"1week"},urls:{logo:"https://user-images.githubusercontent.com/51840849/87182089-1e05fa00-c2ec-11ea-8da9-cc73b45abbbc.jpg",api:{public:"https://api.coinex.com",private:"https://api.coinex.com",perpetualPublic:"https://api.coinex.com/perpetual",perpetualPrivate:"https://api.coinex.com/perpetual"},www:"https://www.coinex.com",doc:"https://github.com/coinexcom/coinex_exchange_api/wiki",fees:"https://www.coinex.com/fees",referral:"https://www.coinex.com/register?refer_code=yw5fz"},api:{public:{get:{"amm/market":1,"common/currency/rate":1,"common/asset/config":1,"common/maintain/info":1,"common/temp-maintain/info":1,"margin/market":1,"market/info":1,"market/list":1,"market/ticker":1,"market/ticker/all":1,"market/depth":1,"market/deals":1,"market/kline":1,"market/detail":1}},private:{get:{"account/amm/balance":40,"account/investment/balance":40,"account/balance/history":40,"account/market/fee":40,"balance/coin/deposit":40,"balance/coin/withdraw":40,"balance/info":40,"balance/deposit/address/{coin_type}":40,"contract/transfer/history":40,"credit/info":40,"credit/balance":40,"investment/transfer/history":40,"margin/account":1,"margin/config":1,"margin/loan/history":40,"margin/transfer/history":40,"order/deals":40,"order/finished":40,"order/pending":4,"order/status":4,"order/status/batch":4,"order/user/deals":40,"order/stop/finished":40,"order/stop/pending":4,"order/user/trade/fee":1,"order/market/trade/info":1,"sub_account/balance":1,"sub_account/transfer/history":40,"sub_account/auth/api/{user_auth_id}":40},post:{"balance/coin/withdraw":40,"contract/balance/transfer":40,"margin/flat":40,"margin/loan":40,"margin/transfer":40,"order/limit/batch":13.334,"order/ioc":6.667,"order/limit":6.667,"order/market":6.667,"order/modify":6.667,"order/stop/limit":6.667,"order/stop/market":6.667,"order/stop/modify":6.667,"sub_account/transfer":40,"sub_account/register":1,"sub_account/unfrozen":40,"sub_account/frozen":40,"sub_account/auth/api":40},put:{"balance/deposit/address/{coin_type}":40,"sub_account/auth/api/{user_auth_id}":40,"v1/account/settings":40},delete:{"balance/coin/withdraw":40,"order/pending/batch":13.334,"order/pending":6.667,"order/stop/pending":13.334,"order/stop/pending/{id}":13.334,"sub_account/auth/api/{user_auth_id}":40}},perpetualPublic:{get:{ping:1,time:1,"market/list":1,"market/limit_config":1,"market/ticker":1,"market/ticker/all":1,"market/depth":1,"market/deals":1,"market/funding_history":1,"market/user_deals":1,"market/kline":1}},perpetualPrivate:{get:{"asset/query":40,"order/pending":4,"order/finished":40,"order/stop_finished":40,"order/stop_pending":4,"order/status":4,"order/stop_status":4,"position/pending":40,"position/funding":40},post:{"market/adjust_leverage":1,"market/position_expect":1,"order/put_limit":10,"order/put_market":10,"order/put_stop_limit":10,"order/put_stop_market":10,"order/modify":10,"order/modify_stop":10,"order/cancel":10,"order/cancel_all":20,"order/cancel_batch":20,"order/cancel_stop":10,"order/cancel_stop_all":20,"order/close_limit":10,"order/close_market":10,"position/adjust_margin":10,"position/stop_loss":10,"position/take_profit":10,"position/market_close":10}}},fees:{trading:{maker:.001,taker:.001},funding:{withdraw:{BCH:0,BTC:.001,LTC:.001,ETH:.001,ZEC:1e-4,DASH:1e-4}}},limits:{amount:{min:.001,max:void 0}},options:{createMarketBuyOrderRequiresPrice:!0,defaultType:"spot",defaultSubType:"linear",fetchDepositAddress:{fillResponseFromRequest:!0},accountsById:{spot:"0"}},commonCurrencies:{ACM:"Actinium"},precisionMode:g})}async fetchCurrencies(e={}){const t=await this.publicGetCommonAssetConfig(e),i=this.safeValue(t,"data",[]),s=Object.keys(i),r={};for(let e=0;e<s.length;e++){const t=i[s[e]],a=this.safeString(t,"asset"),n=this.safeString(t,"chain"),o=this.safeCurrencyCode(a),h=this.parseNumber(this.parsePrecision(this.safeString(t,"withdrawal_precision")));void 0===this.safeValue(r,o)&&(r[o]={id:a,numericId:void 0,code:o,info:t,name:void 0,active:!0,deposit:this.safeValue(t,"can_deposit"),withdraw:this.safeValue(t,"can_withdraw"),fee:this.safeNumber(t,"withdraw_tx_fee"),precision:h,limits:{amount:{min:void 0,max:void 0},deposit:{min:this.safeNumber(t,"deposit_least_amount"),max:void 0},withdraw:{min:this.safeNumber(t,"withdraw_least_amount"),max:void 0}}});const d=this.safeValue(r[o],"networks",{}),c={info:t,id:n,network:n,name:void 0,limits:{amount:{min:void 0,max:void 0},deposit:{min:this.safeNumber(t,"deposit_least_amount"),max:void 0},withdraw:{min:this.safeNumber(t,"withdraw_least_amount"),max:void 0}},active:!0,deposit:this.safeValue(t,"can_deposit"),withdraw:this.safeValue(t,"can_withdraw"),fee:this.safeNumber(t,"withdraw_tx_fee"),precision:h};d[n]=c,r[o].networks=d}return r}async fetchMarkets(e={}){let t=[this.fetchSpotMarkets(e),this.fetchContractMarkets(e)];t=await Promise.all(t);const i=t[0],s=t[1];return this.arrayConcat(i,s)}async fetchSpotMarkets(e){const t=await this.publicGetMarketInfo(e),i=this.safeValue(t,"data",{}),s=[],r=Object.keys(i);for(let e=0;e<r.length;e++){const t=i[r[e]],a=this.safeString(t,"name"),n=this.safeString(t,"trading_name"),o=n,h=this.safeString(t,"pricing_name"),d=this.safeCurrencyCode(o),c=this.safeCurrencyCode(h);let l=d+"/"+c;n===a&&(l=a),s.push({id:a,symbol:l,base:d,quote:c,settle:void 0,baseId:o,quoteId:h,settleId:void 0,type:"spot",spot:!0,margin:void 0,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,taker:this.safeNumber(t,"taker_fee_rate"),maker:this.safeNumber(t,"maker_fee_rate"),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"trading_decimal"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"pricing_decimal")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"min_amount"),max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return s}async fetchContractMarkets(e){const t=await this.perpetualPublicGetMarketList(e),i=this.safeValue(t,"data",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.fees,a=this.safeValue(t,"leverages",[]),n=this.safeInteger(t,"type"),o=1===n,h=2===n,d=this.safeString(t,"name"),c=this.safeString(t,"stock"),l=this.safeString(t,"money"),u=this.safeCurrencyCode(c),f=this.safeCurrencyCode(l),p=1===n?"USDT":c,m=this.safeCurrencyCode(p),g=u+"/"+f+":"+m,y=a.length;s.push({id:d,symbol:g,base:u,quote:f,settle:m,baseId:c,quoteId:l,settleId:p,type:"swap",spot:!1,margin:!1,swap:!0,future:!1,option:!1,active:this.safeValue(t,"available"),contract:!0,linear:o,inverse:h,taker:r.trading.taker,maker:r.trading.maker,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"stock_prec"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"money_prec")))},limits:{leverage:{min:this.safeString(a,0),max:this.safeString(a,y-1)},amount:{min:this.safeString(t,"amount_min"),max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return s}parseTicker(e,t){const i=this.safeInteger(e,"date"),s=this.safeSymbol(void 0,t);e=this.safeValue(e,"ticker",{});const r=this.safeString(e,"last");return this.safeTicker({symbol:s,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"buy"),bidVolume:void 0,ask:this.safeString(e,"sell"),askVolume:void 0,vwap:void 0,open:this.safeString(e,"open"),close:r,last:r,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString2(e,"vol","volume"),quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={market:i.id},r=i.swap?"perpetualPublicGetMarketTicker":"publicGetMarketTicker",a=await this[r](this.extend(s,t));return this.parseTicker(a.data,i)}async fetchTickers(e,t={}){let i;if(await this.loadMarkets(),void 0!==(e=this.marketSymbols(e))){const t=this.safeValue(e,0);i=this.market(t)}const[s,r]=this.handleMarketTypeAndParams("fetchTickers",i,t),a="swap"===s?"perpetualPublicGetMarketTickerAll":"publicGetMarketTickerAll",n=await this[a](r),o=this.safeValue(n,"data"),h=this.safeInteger(o,"date"),d=this.safeValue(o,"ticker",{}),c=Object.keys(d),l={};for(let e=0;e<c.length;e++){const t=c[e],i=this.safeMarket(t,void 0,void 0,s),r=i.symbol,a=this.parseTicker({date:h,ticker:d[t]},i);a.symbol=r,l[r]=a}return this.filterByArray(l,"symbol",e)}async fetchTime(e={}){const t=await this.perpetualPublicGetTime(e);return this.safeNumber(t,"data")}async fetchOrderBook(e,t=20,i={}){if(void 0===e)throw new a(this.id+" fetchOrderBook() requires a symbol argument");await this.loadMarkets();const s=this.market(e);void 0===t&&(t=20);const r={market:this.marketId(e),merge:"0",limit:t.toString()},n=s.swap?"perpetualPublicGetMarketDepth":"publicGetMarketDepth",o=await this[n](this.extend(r,i)),h=this.safeValue(o,"data",{}),d=this.safeInteger(h,"time");return this.parseOrderBook(h,e,d)}parseTrade(e,t){let i=this.safeTimestamp2(e,"create_time","time");void 0===i&&(i=this.safeInteger(e,"date_ms"));const s=this.safeString(e,"id"),r=this.safeString(e,"order_id"),a=this.safeString(e,"price"),n=this.safeString(e,"amount"),o=this.safeString(e,"market"),h=this.safeString(this.options,"defaultType");t=this.safeMarket(o,t,void 0,h);const d=this.safeSymbol(o,t),c=this.safeString(e,"deal_money");let l;const u=this.safeString2(e,"fee","deal_fee");if(void 0!==u){const t=this.safeString(e,"fee_asset");l={cost:u,currency:this.safeCurrencyCode(t)}}let f,p=this.safeString(e,"role");return"1"===p?p="maker":"2"===p&&(p="taker"),"swap"===t.type?(f=this.safeInteger(e,"side"),1===f?f="sell":2===f&&(f="buy"),void 0===f&&(f=this.safeString(e,"type"))):f=this.safeString(e,"type"),this.safeTrade({info:e,timestamp:i,datetime:this.iso8601(i),symbol:d,id:s,order:r,type:void 0,side:f,takerOrMaker:p,price:a,amount:n,cost:c,fee:l},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={market:r.id};void 0!==i&&(a.limit=i);const n=r.swap?"perpetualPublicGetMarketDeals":"publicGetMarketDeals",o=await this[n](this.extend(a,s));return this.parseTrades(o.data,r,t,i)}async fetchTradingFee(e,t={}){await this.loadMarkets();const i={market:this.market(e).id},s=await this.publicGetMarketDetail(this.extend(i,t)),r=this.safeValue(s,"data",{});return this.parseTradingFee(r)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.publicGetMarketInfo(e),i=this.safeValue(t,"data",{}),s={};for(let e=0;e<this.symbols.length;e++){const t=this.symbols[e],r=this.market(t),a=this.safeValue(i,r.id,{});s[t]=this.parseTradingFee(a,r)}return s}parseTradingFee(e,t){const i=this.safeValue(e,"name");return{info:e,symbol:this.safeSymbol(i,t),maker:this.safeNumber(e,"maker_fee_rate"),taker:this.safeNumber(e,"taker_fee_rate"),percentage:!0,tierBased:!0}}parseOHLCV(e,t){return[this.safeTimestamp(e,0),this.safeNumber(e,1),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,2),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={market:a.id,type:this.safeString(this.timeframes,t,t)};void 0!==s&&(n.limit=s);const o=a.swap?"perpetualPublicGetMarketKline":"publicGetMarketKline",h=await this[o](this.extend(n,r)),d=this.safeValue(h,"data",[]);return this.parseOHLCVs(d,a,t,i,s)}async fetchMarginBalance(e={}){await this.loadMarkets();const t=this.safeString(e,"symbol");let i,s=this.safeString(e,"market");if(void 0!==t)i=this.market(t),s=i.id;else if(void 0===s)throw new a(this.id+" fetchMarginBalance() fetching a margin account requires a market parameter or a symbol parameter");e=this.omit(e,["symbol","market"]);const r={market:s},n=await this.privateGetMarginAccount(this.extend(r,e)),o={info:n},h=this.safeValue(n,"data",{}),d=this.safeValue(h,"can_transfer",{}),c=this.safeValue(h,"balance",{}),l=this.safeValue(h,"loan",{}),u=this.safeValue(h,"interest",{}),f=this.account(),p=this.safeString(h,"sell_asset_type"),m=this.safeCurrencyCode(p);f.free=this.safeString(d,"sell_type"),f.total=this.safeString(c,"sell_type");const g=this.safeString(l,"sell_type"),b=this.safeString(u,"sell_type");f.debt=y.stringAdd(g,b),o[m]=f;const v=this.account(),w=this.safeString(h,"buy_asset_type"),S=this.safeCurrencyCode(w);v.free=this.safeString(d,"buy_type"),v.total=this.safeString(c,"buy_type");const k=this.safeString(l,"buy_type"),T=this.safeString(u,"buy_type");return v.debt=y.stringAdd(k,T),o[S]=v,this.safeBalance(o)}async fetchSpotBalance(e={}){await this.loadMarkets();const t=await this.privateGetBalanceInfo(e),i={info:t},s=this.safeValue(t,"data",{}),r=Object.keys(s);for(let e=0;e<r.length;e++){const t=r[e],a=this.safeCurrencyCode(t),n=this.safeValue(s,t,{}),o=this.account();o.free=this.safeString(n,"available"),o.used=this.safeString(n,"frozen"),i[a]=o}return this.safeBalance(i)}async fetchSwapBalance(e={}){await this.loadMarkets();const t=await this.perpetualPrivateGetAssetQuery(e),i={info:t},s=this.safeValue(t,"data",{}),r=Object.keys(s);for(let e=0;e<r.length;e++){const t=r[e],a=this.safeCurrencyCode(t),n=this.safeValue(s,t,{}),o=this.account();o.free=this.safeString(n,"available"),o.used=this.safeString(n,"frozen"),o.total=this.safeString(n,"balance_total"),i[a]=o}return this.safeBalance(i)}async fetchBalance(e={}){let t;[t,e]=this.handleMarketTypeAndParams("fetchBalance",void 0,e);return t=this.safeValue(e,"margin",!1)?"margin":t,e=this.omit(e,"margin"),"margin"===t?await this.fetchMarginBalance(e):"swap"===t?await this.fetchSwapBalance(e):await this.fetchSpotBalance(e)}parseOrderStatus(e){return this.safeString({not_deal:"open",part_deal:"open",done:"closed",cancel:"canceled"},e,e)}parseOrder(e,t){const i=this.safeTimestamp(e,"create_time"),s=this.safeString(e,"price"),r=this.safeString(e,"deal_money"),a=this.safeString(e,"amount"),n=this.safeString(e,"deal_amount"),o=this.safeString(e,"avg_price"),h=this.safeString(e,"left"),d=this.safeString(e,"market"),c=this.safeString(this.options,"defaultType");t=this.safeMarket(d,t,void 0,c);const l=this.safeString(e,"fee_asset");let u=this.safeCurrencyCode(l);void 0===u&&(u=t.quote);const f=this.parseOrderStatus(this.safeString(e,"status"));let p=this.safeInteger(e,"side");p=1===p?"sell":2===p?"buy":this.safeString(e,"type");let m=this.safeString(e,"order_type");return void 0===m&&(m=this.safeInteger(e,"type"),1===m?m="limit":2===m&&(m="market")),this.safeOrder({id:this.safeString2(e,"id","order_id"),clientOrderId:void 0,datetime:this.iso8601(i),timestamp:i,lastTradeTimestamp:this.safeTimestamp(e,"update_time"),status:f,symbol:t.symbol,type:m,timeInForce:void 0,postOnly:void 0,reduceOnly:void 0,side:p,price:s,stopPrice:this.safeString(e,"stop_price"),triggerPrice:this.safeString(e,"stop_price"),cost:r,average:o,amount:a,filled:n,remaining:h,trades:void 0,fee:{currency:u,cost:this.safeString(e,"deal_fee")},info:e},t)}async createOrder(e,t,i,s,r,o={}){await this.loadMarkets();const h=this.market(e),d=h.swap,c=this.safeValue2(o,"stopPrice","triggerPrice"),u=this.safeValue(o,"stopLossPrice"),f=this.safeValue(o,"takeProfitPrice"),p=this.safeString(o,"option"),m="market"===t,g=this.isPostOnly(m,"MAKER_ONLY"===p,o),b=this.safeInteger2(o,"position_id","positionId");let v=this.safeString(o,"timeInForce");const w=this.safeValue(o,"reduceOnly");if(void 0!==w&&"swap"!==h.type)throw new l(this.id+" createOrder() does not support reduceOnly for "+h.type+" orders, reduceOnly orders are supported for swap markets only");let S;const k={market:h.id};if(d)if(u||f){if(k.stop_type=this.safeInteger(o,"stop_type",1),void 0===b)throw new a(this.id+" createOrder() requires a position_id parameter for stop loss and take profit orders");k.position_id=b,u?(S="perpetualPrivatePostPositionStopLoss",k.stop_loss_price=this.priceToPrecision(e,u)):f&&(S="perpetualPrivatePostPositionTakeProfit",k.take_profit_price=this.priceToPrecision(e,f))}else S="perpetualPrivatePostOrderPut"+this.capitalize(t),i="buy"===i?2:1,void 0!==c&&(k.stop_price=this.priceToPrecision(e,c),k.stop_type=this.safeInteger(o,"stop_type",1),k.amount=this.amountToPrecision(e,s),k.side=i,"limit"===t?(S="perpetualPrivatePostOrderPutStopLimit",k.price=this.priceToPrecision(e,r)):"market"===t&&(S="perpetualPrivatePostOrderPutStopMarket"),k.amount=this.amountToPrecision(e,s)),"market"===t&&void 0===c||(g?k.option=1:void 0!==v&&(v="IOC"===v?2:"FOK"===v?3:1,k.effect_type=v)),"limit"===t&&void 0===c?(w?(S="perpetualPrivatePostOrderCloseLimit",k.position_id=b):k.side=i,k.price=this.priceToPrecision(e,r),k.amount=this.amountToPrecision(e,s)):"market"===t&&void 0===c&&(w?(S="perpetualPrivatePostOrderCloseMarket",k.position_id=b):(k.side=i,k.amount=this.amountToPrecision(e,s)));else{if(S="privatePostOrder"+this.capitalize(t),k.type=i,"market"===t&&"buy"===i)if(this.options.createMarketBuyOrderRequiresPrice){if(void 0===r)throw new l(this.id+" createOrder() requires the price argument with market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount, or, alternatively, add .options['createMarketBuyOrderRequiresPrice'] = false to supply the cost in the amount argument (the exchange-specific behaviour)");{const t=this.amountToPrecision(e,s),i=this.priceToPrecision(e,r),a=y.stringMul(t,i),n=this.parseNumber(a);k.amount=this.costToPrecision(e,n)}}else k.amount=this.costToPrecision(e,s);else k.amount=this.amountToPrecision(e,s);if("limit"!==t&&"ioc"!==t||(k.price=this.priceToPrecision(e,r)),void 0!==c&&(k.stop_price=this.priceToPrecision(e,c),"limit"===t?S="privatePostOrderStopLimit":"market"===t&&(S="privatePostOrderStopMarket")),("market"!==t||void 0!==c)&&(void 0!==v||g)){if((g||"IOC"!==v)&&"limit"===t&&void 0!==c)throw new l(this.id+" createOrder() only supports the IOC option for stop-limit orders");g?k.option="MAKER_ONLY":void 0!==v&&(k.option=v)}}const T=this.safeInteger(o,"account_id");if("margin"===this.safeString(this.options,"defaultType")){if(void 0===T)throw new n(this.id+" createOrder() requires an account_id parameter for margin orders");k.account_id=T}o=this.omit(o,["reduceOnly","positionId","timeInForce","postOnly","stopPrice","triggerPrice","stopLossPrice","takeProfitPrice"]);const _=await this[S](this.extend(k,o)),O=this.safeValue(_,"data");return this.parseOrder(O,h)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s=this.market(t),r=this.safeValue(i,"stop"),a=s.swap,o={market:s.id};o[a?"order_id":"id"]=e;let h=a?"perpetualPrivatePostOrderCancel":"privateDeleteOrderPending";r&&(h=a?"perpetualPrivatePostOrderCancelStop":"privateDeleteOrderStopPendingId");const d=this.safeInteger(i,"account_id");if("margin"===this.safeString(this.options,"defaultType")){if(void 0===d)throw new n(this.id+" cancelOrder() requires an account_id parameter for margin orders");o.account_id=d}const c=this.omit(i,["stop","account_id"]),l=await this[h](this.extend(o,c)),u=this.safeValue(l,"data");return this.parseOrder(u,s)}async cancelAllOrders(e,t={}){if(void 0===e)throw new a(this.id+" cancellAllOrders() requires a symbol argument");await this.loadMarkets();const i=this.market(e),s=i.id,r=this.safeInteger(t,"account_id",0),n={market:s},o=i.swap,h=this.safeValue(t,"stop");let d;o?(d="perpetualPrivatePostOrderCancelAll",h&&(d="perpetualPrivatePostOrderCancelStopAll")):(d="privateDeleteOrderPending",h&&(d="privateDeleteOrderStopPending"),n.account_id=r),t=this.omit(t,["stop","account_id"]);return await this[d](this.extend(n,t))}async fetchOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r=s.swap,n=this.safeValue(i,"stop"),o={market:s.id};let h;o[r?"order_id":"id"]=e,h=r?n?"perpetualPrivateGetOrderStopStatus":"perpetualPrivateGetOrderStatus":"privateGetOrderStatus",i=this.omit(i,"stop");const d=await this[h](this.extend(o,i)),c=this.safeValue(d,"data");return this.parseOrder(c,s)}async fetchOrdersByStatus(e,t,i,s,r={}){await this.loadMarkets();const o={limit:s=void 0===s?100:s},h=this.safeValue(r,"stop"),d=this.safeInteger(r,"side");let c;r=this.omit(r,"stop"),void 0!==t&&(c=this.market(t),o.market=c.id);const[l,u]=this.handleMarketTypeAndParams("fetchOrdersByStatus",c,r);let f;if("swap"===l){if(void 0===t)throw new a(this.id+" fetchOrdersByStatus() requires a symbol argument for swap markets");f="perpetualPrivateGetOrder"+this.capitalize(e),h&&(f="perpetualPrivateGetOrderStopPending"),o.side=void 0!==d?d:0,o.offset=0}else f="privateGetOrder"+this.capitalize(e),h&&(f="privateGetOrderStop"+this.capitalize(e)),o.page=1;const p=this.safeInteger(r,"account_id");if("margin"===this.safeString(this.options,"defaultType")){if(void 0===p)throw new n(this.id+" fetchOpenOrders() and fetchClosedOrders() require an account_id parameter for margin orders");o.account_id=p}r=this.omit(u,"account_id");const m=await this[f](this.extend(o,r)),g="swap"===l?"records":"data",y=this.safeValue(m,"data"),b=this.safeValue(y,g,[]);return this.parseOrders(b,c,i,s)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("pending",e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("finished",e,t,i,s)}async createDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={coin_type:i.id};if("network"in t){const e=this.safeString(t,"network");t=this.omit(t,"network"),s.smart_contract_name=e}const r=await this.privatePutBalanceDepositAddressCoinType(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseDepositAddress(a,i)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={coin_type:i.id},n=this.safeValue(i,"networks",{}),o=this.safeString(t,"network");t=this.omit(t,"network");const h=Object.keys(n).length;if(void 0!==n&&h>1){if(void 0===o)throw new a(this.id+" fetchDepositAddress() "+e+" requires a network parameter");if(!(o in n))throw new r(this.id+" fetchDepositAddress() "+o+" network not supported for "+e)}void 0!==o&&(s.smart_contract_name=o);const d=await this.privateGetBalanceDepositAddressCoinType(this.extend(s,t)),c=this.safeValue(d,"data",{}),l=this.parseDepositAddress(c,i),u=this.safeValue(this.options,"fetchDepositAddress",{});return this.safeValue(u,"fillResponseFromRequest",!0)&&(l.network=this.safeNetworkCode(o,i)),l}safeNetwork(e,t){const i=this.safeValue(t,"networks",{}),s=Object.keys(i),r=s.length;return void 0===e&&1===r?i[s[0]]:{id:e,network:void 0===e?void 0:e.toUpperCase()}}safeNetworkCode(e,t){return this.safeNetwork(e,t).network}parseDepositAddress(e,t){const i=this.safeString(e,"coin_address"),s=i.split(":");let r,a;return s.length>1?(r=s[0],a=s[1]):r=i,{info:e,currency:this.safeCurrencyCode(void 0,t),address:r,tag:a,network:void 0}}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets(),void 0===i&&(i=100);const o={limit:i,offset:0};let h;if(void 0!==e&&(r=this.market(e),o.market=r.id),[h,s]=this.handleMarketTypeAndParams("fetchMyTrades",r,s),"spot"!==h&&void 0===e)throw new a(this.id+" fetchMyTrades() requires a symbol argument for non-spot markets");const d="swap"===h;let c;if(d){c="perpetualPublicGetMarketUserDeals";const e=this.safeInteger(s,"side");if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a side parameter for swap markets");void 0!==t&&(o.start_time=t),o.side=e,s=this.omit(s,"side")}else c="privateGetOrderUserDeals",o.page=1;const l=this.safeInteger(s,"account_id");if("margin"===this.safeString(this.options,"defaultType")){if(void 0===l)throw new n(this.id+" fetchMyTrades() requires an account_id parameter for margin trades");o.account_id=l,s=this.omit(s,"account_id")}const u=await this[c](this.extend(o,s)),f=d?"records":"data",p=this.safeValue(u,"data"),m=this.safeValue(p,f,[]);return this.parseTrades(m,r,t,i)}async fetchPositions(e,t={}){await this.loadMarkets();const i={};let s;if(void 0!==(e=this.marketSymbols(e))){let t;if(Array.isArray(e)){if(e.length>1)throw new n(this.id+" fetchPositions() symbols argument cannot contain more than 1 symbol");t=e[0]}else t=e;s=this.market(t),i.market=s.id}const r=await this.perpetualPrivateGetPositionPending(this.extend(i,t)),a=this.safeValue(r,"data",[]),o=[];for(let e=0;e<a.length;e++)o.push(this.parsePosition(a[e],s));return this.filterByArray(o,"symbol",e,!1)}async fetchPosition(e,t={}){await this.loadMarkets();const i=this.market(e),s={market:i.id},r=await this.perpetualPrivateGetPositionPending(this.extend(s,t)),a=this.safeValue(r,"data",[]);return this.parsePosition(a[0],i)}parsePosition(e,t){const i=this.safeString(e,"market"),s=this.safeString(this.options,"defaultType"),r=(t=this.safeMarket(i,t,void 0,s)).symbol,a=this.safeInteger(e,"position_id"),n=1===this.safeInteger(e,"type")?"isolated":"cross",o=this.safeString(e,"liq_price"),h=this.safeString(e,"open_price"),d=this.safeString(e,"profit_unreal"),c=this.safeString(e,"amount"),l=1===this.safeInteger(e,"side")?"short":"long",u=this.safeTimestamp(e,"update_time"),f=this.safeString(e,"mainten_margin_amount"),p=this.safeString(e,"mainten_margin"),m=this.safeString(e,"margin_amount"),g=this.safeNumber(e,"leverage");return{info:e,id:a,symbol:r,notional:void 0,marginMode:n,liquidationPrice:o,entryPrice:h,unrealizedPnl:d,percentage:void 0,contracts:void 0,contractSize:c,markPrice:void 0,side:l,hedged:void 0,timestamp:u,datetime:this.iso8601(u),maintenanceMargin:f,maintenanceMarginPercentage:p,collateral:m,initialMargin:void 0,initialMarginPercentage:void 0,leverage:g,marginRatio:void 0}}async setMarginMode(e,t,i={}){if(void 0===t)throw new a(this.id+" setMarginMode() requires a symbol argument");if("isolated"!==(e=e.toLowerCase())&&"cross"!==e)throw new n(this.id+" setMarginMode() marginMode argument should be isolated or cross");await this.loadMarkets();const s=this.market(t);if("swap"!==s.type)throw new o(this.id+" setMarginMode() supports swap contracts only");let r;"isolated"===e?r=1:"cross"===e&&(r=2);const h=this.safeInteger(i,"leverage"),d=this.safeInteger(s.limits.leverage,"max",100),c=this.safeInteger(i,"position_type",r);if(void 0===h)throw new a(this.id+" setMarginMode() requires a leverage parameter");if(void 0===c)throw new a(this.id+" setMarginMode() requires a position_type parameter that will transfer margin to the specified trading pair");if(h<3||h>d)throw new n(this.id+" setMarginMode() leverage should be between 3 and "+d.toString()+" for "+t);const l={market:s.id,leverage:h.toString(),position_type:c};return await this.perpetualPrivatePostMarketAdjustLeverage(this.extend(l,i))}async setLeverage(e,t,i={}){if(void 0===t)throw new a(this.id+" setLeverage() requires a symbol argument");await this.loadMarkets();const s=this.safeString2(this.options,"defaultMarginMode","marginMode");let r;"isolated"===s?r=1:"cross"===s&&(r=2);const h=this.safeInteger(i,"position_type",r);if(void 0===h)throw new a(this.id+" setLeverage() requires a position_type parameter that will transfer margin to the specified trading pair");const d=this.market(t),c=this.safeInteger(d.limits.leverage,"max",100);if("swap"!==d.type)throw new o(this.id+" setLeverage() supports swap contracts only");if(e<3||e>c)throw new n(this.id+" setLeverage() leverage should be between 3 and "+c.toString()+" for "+t);const l={market:d.id,leverage:e.toString(),position_type:h};return await this.perpetualPrivatePostMarketAdjustLeverage(this.extend(l,i))}async fetchLeverageTiers(e,t={}){await this.loadMarkets();const i=await this.perpetualPublicGetMarketLimitConfig(t),s=this.safeValue(i,"data",{});return this.parseLeverageTiers(s,e,void 0)}parseLeverageTiers(e,t,i){const s={},r=Object.keys(e);for(let i=0;i<r.length;i++){const a=r[i],n=this.safeMarket(a,void 0,void 0,"spot"),o=this.safeString(n,"symbol");let h=0;void 0!==t&&(h=t.length),void 0===o||0!==h&&!this.inArray(t,o)||(s[o]=this.parseMarketLeverageTiers(e[a],n))}return s}parseMarketLeverageTiers(e,t){const i=[];let s=0;for(let r=0;r<e.length;r++){const a=e[r],n=this.safeNumber(a,0);i.push({tier:r+1,currency:t.linear?t.base:t.quote,minNotional:s,maxNotional:n,maintenanceMarginRate:this.safeNumber(a,2),maxLeverage:this.safeInteger(a,1),info:a}),s=n}return i}async modifyMarginHelper(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={market:r.id,amount:this.amountToPrecision(e,t),type:i},n=await this.perpetualPrivatePostPositionAdjustMargin(this.extend(a,s)),o=this.safeString(n,"message"),h=1===i?"add":"reduce";return this.extend(this.parseMarginModification(n,r),{amount:this.parseNumber(t),type:h,status:o})}parseMarginModification(e,t){return{info:e,type:void 0,amount:void 0,code:t.quote,symbol:this.safeSymbol(void 0,t),status:void 0}}async addMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,1,i)}async reduceMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,2,i)}async fetchFundingHistory(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchFundingHistory() requires a symbol argument");i=void 0===i?100:i,await this.loadMarkets();const r={market:this.market(e).id,limit:i};void 0!==t&&(r.start_time=t);const n=await this.perpetualPrivateGetPositionFunding(this.extend(r,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"records",[]),d=[];for(let t=0;t<h.length;t++){const i=h[t],s=this.safeTimestamp(i,"time"),r=this.safeString(i,"asset"),a=this.safeCurrencyCode(r);d.push({info:i,symbol:e,code:a,timestamp:s,datetime:this.iso8601(s),id:this.safeNumber(i,"position_id"),amount:this.safeNumber(i,"funding")})}return d}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.swap)throw new o(this.id+" fetchFundingRate() supports swap contracts only");const s={market:i.id},r=await this.perpetualPublicGetMarketTicker(this.extend(s,t)),a=this.safeValue(r,"data",{}),n=this.safeValue(a,"ticker",{}),h=this.safeInteger(a,"date");return n.timestamp=h,this.parseFundingRate(n,i)}parseFundingRate(e,t){const i=this.safeInteger(e,"timestamp");e=this.omit(e,"timestamp");const s=(i+60*this.safeInteger(e,"funding_time")*1e3)/36e5,r=36e5*Math.round(s);return{info:e,symbol:this.safeSymbol(void 0,t),markPrice:this.safeNumber(e,"sign_price"),indexPrice:this.safeNumber(e,"index_price"),interestRate:void 0,estimatedSettlePrice:void 0,timestamp:i,datetime:this.iso8601(i),fundingRate:this.safeNumber(e,"funding_rate_next"),fundingTimestamp:r,fundingDatetime:this.iso8601(r),nextFundingRate:this.safeNumber(e,"funding_rate_predict"),nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:this.safeNumber(e,"funding_rate_last"),previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async fetchFundingRates(e,t={}){let i;if(await this.loadMarkets(),void 0!==(e=this.marketSymbols(e))){const t=this.safeValue(e,0);if(i=this.market(t),!i.swap)throw new o(this.id+" fetchFundingRates() supports swap contracts only")}const s=await this.perpetualPublicGetMarketTickerAll(t),r=this.safeValue(s,"data",{}),a=this.safeValue(r,"ticker",{}),n=this.safeInteger(r,"date"),h=[],d=Object.keys(a);for(let e=0;e<d.length;e++){const t=d[e];if(-1===t.indexOf("_")){const e=this.safeMarket(t,void 0,void 0,"swap"),i=a[t];i.timestamp=n,h.push(this.parseFundingRate(i,e))}}return this.filterByArray(h,"symbol",e)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e);s&&(i=i+":"+s);const n={coin_type:a.id,coin_address:i,actual_amount:parseFloat(t),transfer_method:"onchain"},o=await this.privatePostBalanceCoinWithdraw(this.extend(n,r)),h=this.safeValue(o,"data",{});return this.parseTransaction(h,a)}parseTransactionStatus(e){return this.safeString({audit:"pending",pass:"pending",processing:"pending",confirming:"pending",not_pass:"failed",cancel:"canceled",finish:"ok",fail:"failed"},e,e)}async fetchFundingRateHistory(e,t,i=100,s={}){if(void 0===e)throw new a(this.id+" fetchFundingRateHistory() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={market:r.id,limit:i,offset:0};void 0!==t&&(n.start_time=t);const o=await this.perpetualPublicGetMarketFundingHistory(this.extend(n,s)),h=this.safeValue(o,"data"),d=this.safeValue(h,"records",[]),c=[];for(let e=0;e<d.length;e++){const t=d[e],i=this.safeString(t,"market"),s=this.safeSymbol(i),r=this.safeTimestamp(t,"time");c.push({info:t,symbol:s,fundingRate:this.safeString(t,"funding_rate"),timestamp:r,datetime:this.iso8601(r)})}const l=this.sortBy(c,"timestamp");return this.filterBySymbolSinceLimit(l,r.symbol,t,i)}parseTransaction(e,t){const i=this.safeString2(e,"coin_withdraw_id","coin_deposit_id"),s=this.safeString(e,"coin_address");let r=this.safeString(e,"remark");void 0!==r&&r.length<1&&(r=void 0);let a=this.safeValue(e,"tx_id");void 0!==a&&a.length<1&&(a=void 0);const n=this.safeString(e,"coin_type"),o=this.safeCurrencyCode(n,t),h=this.safeTimestamp(e,"create_time"),d="coin_withdraw_id"in e?"withdraw":"deposit",c=this.parseTransactionStatus(this.safeString(e,"status")),l=this.safeString(e,"smart_contract_name"),u=this.safeNumber(e,"actual_amount");let f,p,m=this.safeString(e,"tx_fee");"deposit"===d?(m="0",f=s):p=s;const g={cost:this.parseNumber(m),currency:o};return{info:e,id:i,txid:a,timestamp:h,datetime:this.iso8601(h),network:this.networkIdToCode(l),address:s,addressTo:void 0,addressFrom:void 0,tag:r,tagTo:f,tagFrom:p,type:d,amount:this.parseNumber(u),currency:o,status:c,updated:void 0,fee:g}}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n=this.currencyToPrecision(e,t),o={amount:n,coin_type:a.id};let h="privatePostContractBalanceTransfer";if("spot"===i&&"swap"===s)o.transfer_side="in";else if("swap"===i&&"spot"===s)o.transfer_side="out";else{const e=this.safeValue(this.options,"accountsById",{}),t=this.safeString(e,i,i),r=this.safeString(e,s,s);o.from_account=parseInt(t),o.to_account=parseInt(r),h="privatePostMarginTransfer"}const d=await this[h](this.extend(o,r));return this.extend(this.parseTransfer(d,a),{amount:this.parseNumber(n),fromAccount:i,toAccount:s})}parseTransferStatus(e){return this.safeString({0:"ok",SUCCESS:"ok"},e,e)}parseTransfer(e,t){const i=this.safeTimestamp(e,"created_at"),s=this.safeString(e,"transfer_type");let r,a;"transfer_out"===s?(r="swap",a="spot"):"transfer_in"===s?(r="spot",a="swap"):"IN"===s?(r="spot",a="margin"):"OUT"===s&&(r="margin",a="spot");const n=this.safeString(e,"asset"),o=this.safeCurrencyCode(n,t);return{id:this.safeInteger(e,"id"),timestamp:i,datetime:this.iso8601(i),currency:o,amount:this.safeNumber(e,"amount"),fromAccount:r,toAccount:a,status:this.parseTransferStatus(this.safeString2(e,"code","status"))}}async fetchTransfers(e,t,i,s={}){let r;await this.loadMarkets();const a={page:1,limit:i},n=this.safeInteger(s,"page");void 0!==n&&(a.page=n),void 0!==e&&(r=this.safeCurrencyCode(e),a.asset=r.id),void 0!==t&&(a.start_time=t),s=this.omit(s,"page");const o="margin"===this.safeString(this.options,"defaultType")?"privateGetMarginTransferHistory":"privateGetContractTransferHistory",h=await this[o](this.extend(a,s)),d=this.safeValue(h,"data",{}),c=this.safeValue(d,"records",[]);return this.parseTransfers(c,r,t,i)}async fetchWithdrawals(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchWithdrawals() requires a currency code argument");await this.loadMarkets();const r=this.currency(e),n={coin_type:r.id};void 0!==i&&(n.Limit=i);const o=await this.privateGetBalanceCoinWithdraw(this.extend(n,s));let h=this.safeValue(o,"data");return Array.isArray(h)||(h=this.safeValue(h,"data",[])),this.parseTransactions(h,r,t,i)}async fetchDeposits(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchDeposits() requires a currency code argument");await this.loadMarkets();const r=this.currency(e),n={coin_type:r.id};void 0!==i&&(n.Limit=i);const o=await this.privateGetBalanceCoinDeposit(this.extend(n,s));let h=this.safeValue(o,"data");return Array.isArray(h)||(h=this.safeValue(h,"data",[])),this.parseTransactions(h,r,t,i)}parseBorrowRate(e,t){const i=this.milliseconds(),s=this.safeValue(e,t,{});return{currency:this.safeCurrencyCode(t),rate:this.safeNumber(s,"day_rate"),period:864e5,timestamp:i,datetime:this.iso8601(i),info:e}}async fetchBorrowRate(e,t={}){let i;if(await this.loadMarkets(),e in this.markets)i=this.market(e);else{const t=this.safeString(this.options,"defaultSettle","USDT");i=this.market(e+"/"+t)}const s={market:i.id},r=await this.privateGetMarginConfig(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseBorrowRate(a,i.base)}async fetchBorrowRates(e={}){await this.loadMarkets();const t=await this.privateGetMarginConfig(e),i=this.milliseconds(),s=this.safeValue(t,"data",{}),r=[];for(let e=0;e<s.length;e++){const t=s[e],a=this.safeString(t,"market"),n=this.safeMarket(a,void 0,void 0,"spot"),o=this.safeValue(t,n.base);r.push({currency:n.base,rate:this.safeNumber(o,"day_rate"),period:864e5,timestamp:i,datetime:this.iso8601(i),info:t})}return r}async fetchBorrowInterest(e,t,i,s,r={}){await this.loadMarkets();const a={};let n;void 0!==t&&(n=this.market(t),a.market=n.id),void 0!==s&&(a.limit=s);const o=await this.privateGetMarginLoanHistory(this.extend(a,r)),h=this.safeValue(o,"data",{}),d=this.safeValue(h,"data",[]),c=this.parseBorrowInterests(d,n);return this.filterByCurrencySinceLimit(c,e,i,s)}parseBorrowInterest(e,t){const i=this.safeString(e,"market_type");t=this.safeMarket(i,t,void 0,"spot");const s=this.safeString(t,"symbol"),r=this.safeTimestamp(e,"expire_time"),a=this.safeString(e,"unflat_amount"),n=this.safeString(e,"loan_amount");let o=y.stringSub(a,n);return"0"===a&&(o=void 0),{account:void 0,symbol:s,marginMode:"isolated",marginType:void 0,currency:this.safeCurrencyCode(this.safeString(e,"coin_type")),interest:this.parseNumber(o),interestRate:this.safeNumber(e,"day_rate"),amountBorrowed:this.parseNumber(n),timestamp:r,datetime:this.iso8601(r),info:e}}async borrowMargin(e,t,i,s={}){if(void 0===i)throw new a(this.id+" borrowMargin() requires a symbol argument");await this.loadMarkets();const r=this.market(i),n=this.currency(e),o={market:r.id,coin_type:n.id,amount:this.currencyToPrecision(e,t)},h=await this.privatePostMarginLoan(this.extend(o,s)),d=this.safeValue(h,"data",{}),c=this.parseMarginLoan(d,n);return this.extend(c,{amount:t,symbol:i})}async repayMargin(e,t,i,s={}){if(void 0===i)throw new a(this.id+" repayMargin() requires a symbol argument");await this.loadMarkets();const r=this.market(i),n=this.currency(e),o={market:r.id,coin_type:n.id,amount:this.currencyToPrecision(e,t)},h=this.safeInteger(s,"loan_id");void 0!==h&&(o.loan_id=h);const d=await this.privatePostMarginFlat(this.extend(o,s)),c=this.parseMarginLoan(d,n);return this.extend(c,{amount:t,symbol:i})}parseMarginLoan(e,t){return{id:this.safeInteger(e,"loan_id"),currency:this.safeCurrencyCode(void 0,t),amount:void 0,symbol:void 0,timestamp:void 0,datetime:void 0,info:e}}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i={};if(void 0!==e){1===e.length&&(i.coin_type=this.safeValue(e,0))}const s=await this.publicGetCommonAssetConfig(this.extend(i,t));return this.parseDepositWithdrawFees(s,e)}parseDepositWithdrawFees(e,t,i){const s={};t=this.marketCodes(t);const r=this.safeValue(e,"data"),a=Object.keys(r);for(let e=0;e<a.length;e++){const i=a[e],n=i.split("-"),o=r[a[e]],h=this.safeString(o,"asset"),d=this.safeCurrency(h),c=this.safeString(d,"code");if(void 0===t||this.inArray(c,t)){void 0===this.safeValue(s,c)&&(s[c]=this.depositWithdrawFee({})),s[c].info[i]=o;const e=this.safeString(n,1),t=this.safeValue(o,"withdraw_tx_fee"),r={fee:t,percentage:void 0===t&&void 0},a={fee:void 0,percentage:void 0};if(void 0!==e){const t=this.networkIdToCode(e);s[c].networks[t]={withdraw:r,deposit:a}}else s[c].withdraw=r,s[c].deposit=a}}const n=Object.keys(s);for(let e=0;e<n.length;e++){const t=n[e],i=this.currency(t);s[t]=this.assignDefaultDepositWithdrawFees(s[t],i)}return s}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){e=this.implodeParams(e,s);let n=this.urls.api[t]+"/"+this.version+"/"+e,o=this.omit(s,this.extractParams(e));const h=this.nonce().toString();if("perpetualPrivate"===t||"https://api.coinex.com/perpetual/v1/market/user_deals"===n){this.checkRequiredCredentials(),o=this.extend({access_id:this.apiKey,timestamp:h},o),o=this.keysort(o);const e=this.rawencode(o);r={Authorization:this.hash(this.encode(e+"&secret_key="+this.secret),"sha256").toLowerCase(),AccessId:this.apiKey},"GET"===i||"PUT"===i?n+="?"+e:(r["Content-Type"]="application/x-www-form-urlencoded",a=e)}else if("public"===t||"perpetualPublic"===t)Object.keys(o).length&&(n+="?"+this.urlencode(o));else{this.checkRequiredCredentials(),o=this.extend({access_id:this.apiKey,tonce:h},o),o=this.keysort(o);const e=this.rawencode(o);r={Authorization:this.hash(this.encode(e+"&secret_key="+this.secret)).toUpperCase(),"Content-Type":"application/json"},"GET"===i||"DELETE"===i||"PUT"===i?n+="?"+e:a=this.json(o)}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,g,y){if(void 0===o)return;const b=this.safeString(o,"code"),v=this.safeValue(o,"data"),w=this.safeString(o,"message");if("0"!==b||"Success"!==w&&"Succeeded"!==w&&"Ok"!==w&&!v){const e={23:f,24:u,25:u,34:u,35:p,36:m,213:h,107:d,600:c,601:l,602:l,606:l};throw new(this.safeValue(e,b,r))(o.message)}}}},56810:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,AuthenticationError:a,RateLimitExceeded:n,ArgumentsRequired:o}=i(73449),{TICK_SIZE:h}=i(62115),d=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"coinfalcon",name:"CoinFalcon",countries:["GB"],rateLimit:1e3,version:"v1",has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradinFee:!1,fetchTradingFees:!0,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/41822275-ed982188-77f5-11e8-92bb-496bcd14ca52.jpg",api:{rest:"https://coinfalcon.com"},www:"https://coinfalcon.com",doc:"https://docs.coinfalcon.com",fees:"https://coinfalcon.com/fees",referral:"https://coinfalcon.com/?ref=CFJSVGTUPASB"},api:{public:{get:["markets","markets/{market}","markets/{market}/orders","markets/{market}/trades"]},private:{get:["user/accounts","user/orders","user/orders/{id}","user/orders/{id}/trades","user/trades","user/fees","account/withdrawals/{id}","account/withdrawals","account/deposit/{id}","account/deposits","account/deposit_address"],post:["user/orders","account/withdraw"],delete:["user/orders/{id}","account/withdrawals/{id}"]}},fees:{trading:{tierBased:!0,maker:0,taker:.002}},precisionMode:h})}async fetchMarkets(e={}){const t=await this.publicGetMarkets(e),i=this.safeValue(t,"data",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],[r,a]=t.name.split("-"),n=this.safeCurrencyCode(r),o=this.safeCurrencyCode(a);s.push({id:t.name,symbol:n+"/"+o,base:n,quote:o,settle:void 0,baseId:r,quoteId:a,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:!0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"size_precision"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"price_precision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"minPrice"),max:void 0},price:{min:this.safeNumber(t,"minVolume"),max:void 0},cost:{min:void 0,max:void 0}},info:t})}return s}parseTicker(e,t){const i=this.safeString(e,"name");t=this.safeMarket(i,t,"-");const s=this.milliseconds(),r=this.safeString(e,"last_price");return this.safeTicker({symbol:t.symbol,timestamp:s,datetime:this.iso8601(s),high:void 0,low:void 0,bid:this.safeString(e,"highest_bid"),bidVolume:void 0,ask:this.safeString(e,"lowest_ask"),askVolume:void 0,vwap:void 0,open:void 0,close:r,last:r,previousClose:void 0,change:this.safeString(e,"change_in_24h"),percentage:void 0,average:void 0,baseVolume:void 0,quoteVolume:this.safeString(e,"volume"),info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();return(await this.fetchTickers([e],t))[e]}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetMarkets(t),s=this.safeValue(i,"data",[]),r={};for(let e=0;e<s.length;e++){const t=this.parseTicker(s[e]);r[t.symbol]=t}return this.filterByArray(r,"symbol",e)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={market:s.id,level:"3"},a=await this.publicGetMarketsMarketOrders(this.extend(r,i)),n=this.safeValue(a,"data",{});return this.parseOrderBook(n,s.symbol,void 0,"bids","asks","price","size")}parseTrade(e,t){const i=this.parse8601(this.safeString(e,"created_at")),s=this.safeString(e,"price"),r=this.safeString(e,"size"),a=t.symbol,n=this.safeString(e,"id"),o=this.safeString(e,"side"),h=this.safeString(e,"order_id");let d;const c=this.safeString(e,"fee");if(void 0!==c){const t=this.safeString(e,"fee_currency_code");d={cost:c,currency:this.safeCurrencyCode(t)}}return this.safeTrade({info:e,timestamp:i,datetime:this.iso8601(i),symbol:a,id:n,order:h,type:void 0,side:o,takerOrMaker:void 0,price:s,amount:r,cost:void 0,fee:d},t)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={market:r.id};void 0!==t&&(a.start_time=this.iso8601(t)),void 0!==i&&(a.limit=i);const n=await this.privateGetUserTrades(this.extend(a,s)),h=this.safeValue(n,"data",[]);return this.parseTrades(h,r,t,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={market:r.id};void 0!==t&&(a.since=this.iso8601(t));const n=await this.publicGetMarketsMarketTrades(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privateGetUserFees(e),i=this.safeValue(t,"data",{}),s=this.safeString(i,"maker_fee"),r=this.safeString(i,"taker_fee"),a=this.parseNumber(d.stringDiv(s,"100")),n=this.parseNumber(d.stringDiv(r,"100")),o={};for(let e=0;e<this.symbols.length;e++){const i=this.symbols[e];o[i]={info:t,symbol:i,maker:a,taker:n,percentage:!0,tierBased:!0}}return o}parseBalance(e){const t={info:e},i=this.safeValue(e,"data",[]);for(let e=0;e<i.length;e++){const s=i[e],r=this.safeString(s,"currency_code"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"available_balance"),n.used=this.safeString(s,"hold_balance"),n.total=this.safeString(s,"balance"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetUserAccounts(e);return this.parseBalance(t)}parseDepositAddress(e,t){const i=this.safeString(e,"address"),s=this.safeString(e,"tag");return this.checkAddress(i),{currency:this.safeCurrencyCode(void 0,t),address:i,tag:s,network:void 0,info:e}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.safeCurrency(e),s={currency:this.safeStringLower(i,"id")},r=await this.privateGetAccountDepositAddress(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseDepositAddress(a,i)}parseOrderStatus(e){return this.safeString({fulfilled:"closed",canceled:"canceled",pending:"open",open:"open",partially_filled:"open"},e,e)}parseOrder(e,t){const i=this.safeString(e,"market"),s=this.safeSymbol(i,t,"-"),r=this.parse8601(this.safeString(e,"created_at")),a=this.safeString(e,"price"),n=this.safeString(e,"size"),o=this.safeString(e,"size_filled"),h=this.parseOrderStatus(this.safeString(e,"status"));let d=this.safeString(e,"operation_type");void 0!==d&&(d=d.split("_"),d=d[0]);const c=this.safeString(e,"order_type"),l=this.safeValue(e,"post_only");return this.safeOrder({id:this.safeString(e,"id"),clientOrderId:void 0,datetime:this.iso8601(r),timestamp:r,status:h,symbol:s,type:d,timeInForce:void 0,postOnly:l,side:c,price:a,stopPrice:void 0,triggerPrice:void 0,cost:void 0,amount:n,filled:o,remaining:void 0,trades:void 0,fee:void 0,info:e,lastTradeTimestamp:void 0,average:void 0},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={market:n.id,size:this.amountToPrecision(e,s),order_type:i};"limit"===t&&(r=this.priceToPrecision(e,r),o.price=r.toString()),o.operation_type=t+"_order";const h=await this.privatePostUserOrders(this.extend(o,a)),d=this.safeValue(h,"data",{});return this.parseOrder(d,n)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privateDeleteUserOrdersId(this.extend(s,i)),a=this.market(t),n=this.safeValue(r,"data",{});return this.parseOrder(n,a)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privateGetUserOrdersId(this.extend(s,i)),a=this.safeValue(r,"data",{});return this.parseOrder(a)}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.market=a.id),void 0!==t&&(r.since_time=this.iso8601(t));const n=await this.privateGetUserOrders(this.extend(r,s)),o=this.safeValue(n,"data",[]),h=this.filterByArray(o,"status",["pending","open","partially_filled"],!1);return this.parseOrders(h,a,t,i)}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=this.safeStringLower(a,"id")),void 0!==t&&(r.since_time=this.iso8601(t));const n=await this.privateGetAccountDeposits(this.extend(r,s)),o=this.safeValue(n,"data",[]);return o.reverse(),this.parseTransactions(o,a,void 0,i)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=this.safeStringLower(a,"id")),void 0!==t&&(r.since_time=this.iso8601(t));const n=await this.privateGetAccountWithdrawals(this.extend(r,s)),o=this.safeValue(n,"data",[]);return o.reverse(),this.parseTransactions(o,a,void 0,i)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={currency:this.safeStringLower(a,"id"),address:i,amount:t};void 0!==s&&(n.tag=s);const o=await this.privatePostAccountWithdraw(this.extend(n,r)),h=this.safeValue(o,"data",[]);return this.parseTransaction(h,a)}parseTransactionStatus(e){return this.safeString({completed:"ok",denied:"failed",approval_pending:"pending"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"address"),r=this.safeString(e,"tag"),a=this.safeString(e,"txid"),n=this.safeString(e,"currency_code"),o=this.safeCurrencyCode(n,t);let h=this.safeString(e,"type");"withdraw"===h&&(h="withdrawal");const d=this.parseTransactionStatus(this.safeString(e,"status")),c=this.safeString(e,"amount"),l=this.parseNumber(c),u=this.safeString(e,"fee");let f=0;return void 0!==u&&(f=this.parseNumber(u)),{info:e,id:i,txid:a,timestamp:void 0,datetime:void 0,network:void 0,address:s,addressTo:void 0,addressFrom:void 0,tag:r,tagTo:void 0,tagFrom:void 0,type:h,amount:l,currency:o,status:d,updated:void 0,fee:{currency:o,cost:f}}}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n="/api/"+this.version+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if("public"===t)Object.keys(o).length&&(n+="?"+this.urlencode(o));else{this.checkRequiredCredentials(),"GET"===i?Object.keys(o).length&&(n+="?"+this.urlencode(o)):a=this.json(o);const e=this.seconds().toString();let t=[e,i,n].join("|");a&&(t+="|"+a);const s=this.hmac(this.encode(t),this.encode(this.secret));r={"CF-API-KEY":this.apiKey,"CF-API-TIMESTAMP":e,"CF-API-SIGNATURE":s,"Content-Type":"application/json"}}return{url:this.urls.api.rest+n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,o,h,d,c,l){if(e<400)return;throw new(this.safeValue({401:a,429:n},e,r))(h)}}},70948:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,InvalidOrder:n,OrderNotFound:o,RateLimitExceeded:h,InsufficientFunds:d,AuthenticationError:c}=i(73449),{TICK_SIZE:l}=i(62115),u=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"coinmate",name:"CoinMate",countries:["GB","CZ","EU"],rateLimit:1e3,has:{CORS:!0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!1,fetchTransactions:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/51840849/87460806-1c9f3f00-c616-11ea-8c46-a77018a8f3f4.jpg",api:{rest:"https://coinmate.io/api"},www:"https://coinmate.io",fees:"https://coinmate.io/fees",doc:["https://coinmate.docs.apiary.io","https://coinmate.io/developers"],referral:"https://coinmate.io?referral=YTFkM1RsOWFObVpmY1ZjMGREQmpTRnBsWjJJNVp3PT0"},requiredCredentials:{apiKey:!0,secret:!0,uid:!0},api:{public:{get:["orderBook","ticker","transactions","tradingPairs"]},private:{post:["balances","bitcoinCashWithdrawal","bitcoinCashDepositAddresses","bitcoinDepositAddresses","bitcoinWithdrawal","bitcoinWithdrawalFees","buyInstant","buyLimit","cancelOrder","cancelOrderWithInfo","createVoucher","dashDepositAddresses","dashWithdrawal","ethereumWithdrawal","ethereumDepositAddresses","litecoinWithdrawal","litecoinDepositAddresses","openOrders","order","orderHistory","orderById","pusherAuth","redeemVoucher","replaceByBuyLimit","replaceByBuyInstant","replaceBySellLimit","replaceBySellInstant","rippleDepositAddresses","rippleWithdrawal","sellInstant","sellLimit","transactionHistory","traderFees","tradeHistory","transfer","transferHistory","unconfirmedBitcoinDeposits","unconfirmedBitcoinCashDeposits","unconfirmedDashDeposits","unconfirmedEthereumDeposits","unconfirmedLitecoinDeposits","unconfirmedRippleDeposits"]}},fees:{trading:{tierBased:!0,percentage:!0,maker:this.parseNumber("0.0012"),taker:this.parseNumber("0.0025"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.0035")],[this.parseNumber("10000"),this.parseNumber("0.0023")],[this.parseNumber("100000"),this.parseNumber("0.0021")],[this.parseNumber("250000"),this.parseNumber("0.0020")],[this.parseNumber("500000"),this.parseNumber("0.0015")],[this.parseNumber("1000000"),this.parseNumber("0.0013")],[this.parseNumber("3000000"),this.parseNumber("0.0010")],[this.parseNumber("15000000"),this.parseNumber("0.0005")]],maker:[[this.parseNumber("0"),this.parseNumber("0.003")],[this.parseNumber("10000"),this.parseNumber("0.0011")],[this.parseNumber("100000"),this.parseNumber("0.0010")],[this.parseNumber("250000"),this.parseNumber("0.0008")],[this.parseNumber("500000"),this.parseNumber("0.0005")],[this.parseNumber("1000000"),this.parseNumber("0.0003")],[this.parseNumber("3000000"),this.parseNumber("0.0002")],[this.parseNumber("15000000"),this.parseNumber("0")]]}}},options:{withdraw:{fillResponsefromRequest:!0,methods:{BTC:"privatePostBitcoinWithdrawal",LTC:"privatePostLitecoinWithdrawal",BCH:"privatePostBitcoinCashWithdrawal",ETH:"privatePostEthereumWithdrawal",XRP:"privatePostRippleWithdrawal",DASH:"privatePostDashWithdrawal",DAI:"privatePostDaiWithdrawal"}}},exceptions:{exact:{"No order with given ID":o},broad:{"Not enough account balance available":d,"Incorrect order ID":n,"Minimum Order Size ":n,"max allowed precision":n,"TOO MANY REQUESTS":h,"Access denied.":c}},precisionMode:l})}async fetchMarkets(e={}){const t=await this.publicGetTradingPairs(e),i=this.safeValue(t,"data",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"name"),a=this.safeString(t,"firstCurrency"),n=this.safeString(t,"secondCurrency"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=o+"/"+h;s.push({id:r,symbol:d,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"lotDecimals"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"priceDecimals")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"minAmount"),max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return s}parseBalance(e){const t=this.safeValue(e,"data",{}),i={info:e},s=Object.keys(t);for(let e=0;e<s.length;e++){const r=s[e],a=this.safeCurrencyCode(r),n=this.safeValue(t,r),o=this.account();o.free=this.safeString(n,"available"),o.used=this.safeString(n,"reserved"),o.total=this.safeString(n,"balance"),i[a]=o}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostBalances(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={currencyPair:s.id,groupByPriceLimit:"False"},a=(await this.publicGetOrderBook(this.extend(r,i))).data,n=this.safeTimestamp(a,"timestamp");return this.parseOrderBook(a,s.symbol,n,"bids","asks","price","amount")}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={currencyPair:i.id},r=await this.publicGetTicker(this.extend(s,t)),a=this.safeValue(r,"data"),n=this.safeTimestamp(a,"timestamp"),o=this.safeNumber(a,"last");return{symbol:i.symbol,timestamp:n,datetime:this.iso8601(n),high:this.safeNumber(a,"high"),low:this.safeNumber(a,"low"),bid:this.safeNumber(a,"bid"),bidVolume:void 0,ask:this.safeNumber(a,"ask"),vwap:void 0,askVolume:void 0,open:void 0,close:o,last:o,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeNumber(a,"amount"),quoteVolume:void 0,info:a}}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();const r={limit:1e3};if(void 0!==i&&(r.limit=i),void 0!==t&&(r.timestampFrom=t),void 0!==e){const t=this.currency(e);r.currency=t.id}const a=(await this.privatePostTransferHistory(this.extend(r,s))).data;return this.parseTransactions(a,void 0,t,i)}parseTransactionStatus(e){return this.safeString({COMPLETED:"ok",WAITING:"pending",SENT:"pending",CREATED:"pending",OK:"ok",NEW:"pending",CANCELED:"canceled"},e,e)}parseTransaction(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeNumber(e,"amount"),r=this.safeNumber(e,"fee"),a=this.safeString(e,"txid"),n=this.safeString(e,"destination"),o=this.safeString(e,"destinationTag"),h=this.safeString(e,"amountCurrency"),d=this.safeCurrencyCode(h,t),c=this.safeStringLower(e,"transferType"),l=this.parseTransactionStatus(this.safeString(e,"transferStatus")),u=this.safeString2(e,"transactionId","id"),f=this.safeString(e,"walletType");return{id:u,timestamp:i,datetime:this.iso8601(i),currency:d,amount:s,type:c,txid:a,network:f,address:n,addressTo:void 0,addressFrom:void 0,tag:o,tagTo:void 0,tagFrom:void 0,status:l,fee:{cost:r,currency:d},info:e}}async withdraw(e,t,i,s,a={}){[s,a]=this.handleWithdrawTagAndParams(s,a),this.checkAddress(i),await this.loadMarkets();const n=this.currency(e),o=this.safeValue(this.options,"withdraw",{}),h=this.safeValue(o,"methods",{}),d=this.safeString(h,e);if(void 0===d){const e=Object.keys(h);throw new r(this.id+" withdraw() only allows withdrawing the following currencies: "+e.join(", "))}const c={amount:this.currencyToPrecision(e,t),address:i};void 0!==s&&(c.destinationTag=s);const l=await this[d](this.extend(c,a)),u=this.safeValue(l,"data"),f=this.parseTransaction(u,n);return this.safeValue(o,"fillResponseFromRequest",!0)&&(f.amount=t,f.currency=e,f.address=i,f.tag=s,f.type="withdrawal",f.status="pending"),f}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets(),void 0===i&&(i=1e3);const r={limit:i};if(void 0!==e){const t=this.market(e);r.currencyPair=t.id}void 0!==t&&(r.timestampFrom=t);const a=await this.privatePostTradeHistory(this.extend(r,s)),n=this.safeValue(a,"data",[]);return this.parseTrades(n,void 0,t,i)}parseTrade(e,t){const i=this.safeString(e,"currencyPair");t=this.safeMarket(i,t,"_");const s=this.safeString(e,"price"),r=this.safeString(e,"amount"),a=this.safeStringLower2(e,"type","tradeType"),n=this.safeStringLower(e,"orderType"),o=this.safeString(e,"orderId"),h=this.safeString(e,"transactionId"),d=this.safeInteger2(e,"timestamp","createdTimestamp");let c;const l=this.safeString(e,"fee");void 0!==l&&(c={cost:l,currency:t.quote});let u=this.safeString(e,"feeType");return u="MAKER"===u?"maker":"taker",this.safeTrade({id:h,info:e,timestamp:d,datetime:this.iso8601(d),symbol:t.symbol,type:n,side:a,order:o,takerOrMaker:u,price:s,amount:r,cost:void 0,fee:c},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={currencyPair:r.id,minutesIntoHistory:10},n=await this.publicGetTransactions(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={currencyPair:i.id},r=await this.privatePostTraderFees(this.extend(s,t)),a=this.safeValue(r,"data",{}),n=this.safeString(a,"maker"),o=this.safeString(a,"taker"),h=this.parseNumber(u.stringDiv(n,"100")),d=this.parseNumber(u.stringDiv(o,"100"));return{info:a,symbol:i.symbol,maker:h,taker:d,percentage:!0,tierBased:!0}}async fetchOpenOrders(e,t,i,s={}){const r=await this.privatePostOpenOrders(this.extend({},s));return this.parseOrders(r.data,void 0,t,i,{status:"open"})}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={currencyPair:r.id};void 0!==i&&(n.limit=i);const o=await this.privatePostOrderHistory(this.extend(n,s));return this.parseOrders(o.data,r,t,i)}parseOrderStatus(e){return this.safeString({FILLED:"closed",CANCELLED:"canceled",PARTIALLY_FILLED:"open",OPEN:"open"},e,e)}parseOrderType(e){return this.safeString({LIMIT:"limit",MARKET:"market"},e,e)}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.safeInteger(e,"timestamp"),r=this.safeStringLower(e,"type"),a=this.safeString(e,"price"),n=this.safeString(e,"originalAmount"),o=this.safeString2(e,"remainingAmount","amount"),h=this.parseOrderStatus(this.safeString(e,"status")),d=this.parseOrderType(this.safeString(e,"orderTradeType")),c=this.safeString(e,"avgPrice"),l=this.safeString(e,"currencyPair"),u=this.safeSymbol(l,t,"_"),f=this.safeString(e,"clientOrderId"),p=this.safeNumber(e,"stopPrice");return this.safeOrder({id:i,clientOrderId:f,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:void 0,symbol:u,type:d,timeInForce:void 0,postOnly:void 0,side:r,price:a,stopPrice:p,triggerPrice:p,amount:n,cost:void 0,average:c,filled:void 0,remaining:o,status:h,trades:void 0,info:e,fee:void 0},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();let n="privatePost"+this.capitalize(i);const o={currencyPair:this.market(e).id};"market"===t?("buy"===i?o.total=this.amountToPrecision(e,s):o.amount=this.amountToPrecision(e,s),n+="Instant"):(o.amount=this.amountToPrecision(e,s),o.price=this.priceToPrecision(e,r),n+=this.capitalize(t));const h=await this[n](this.extend(o,a));return{info:h,id:this.safeString(h,"data")}}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={orderId:e};let r;t&&(r=this.market(t));const a=await this.privatePostOrderById(this.extend(s,i)),n=this.safeValue(a,"data");return this.parseOrder(n,r)}async cancelOrder(e,t,i={}){const s={orderId:e};return{info:await this.privatePostCancelOrderWithInfo(this.extend(s,i))}}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+e;if("public"===t)Object.keys(s).length&&(n+="?"+this.urlencode(s));else{this.checkRequiredCredentials();const e=this.nonce().toString(),t=e+this.uid+this.apiKey,i=this.hmac(this.encode(t),this.encode(this.secret));a=this.urlencode(this.extend({clientId:this.uid,nonce:e,publicKey:this.apiKey,signature:i.toUpperCase()},s)),r={"Content-Type":"application/x-www-form-urlencoded"}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0!==o&&"error"in o&&o.error){const e=this.safeString(o,"errorMessage"),t=this.id+" "+e;throw this.throwExactlyMatchedException(this.exceptions.exact,e,t),this.throwBroadlyMatchedException(this.exceptions.broad,e,t),new r(this.id+" "+this.json(o))}if(e>400){if(n){const e=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,n,e),this.throwBroadlyMatchedException(this.exceptions.broad,n,e),new r(e)}throw new r(this.id+" "+n)}}}},69261:function(e,t,i){"use strict";const s=i(48819),{BadSymbol:r,BadRequest:a,ExchangeError:n,ArgumentsRequired:o,OrderNotFound:h,OnMaintenance:d}=i(73449),{TICK_SIZE:c}=i(62115),l=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"coinone",name:"CoinOne",countries:["KR"],rateLimit:667,version:"v2",has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createMarketOrder:!1,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!1,fetchDepositAddresses:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1},urls:{logo:"https://user-images.githubusercontent.com/1294454/38003300-adc12fba-323f-11e8-8525-725f53c4a659.jpg",api:{rest:"https://api.coinone.co.kr"},www:"https://coinone.co.kr",doc:"https://doc.coinone.co.kr"},requiredCredentials:{apiKey:!0,secret:!0},api:{public:{get:["orderbook/","trades/","ticker/"]},private:{post:["account/deposit_address/","account/btc_deposit_address/","account/balance/","account/daily_balance/","account/user_info/","account/virtual_account/","order/cancel_all/","order/cancel/","order/limit_buy/","order/limit_sell/","order/complete_orders/","order/limit_orders/","order/order_info/","transaction/auth_number/","transaction/history/","transaction/krw/history/","transaction/btc/","transaction/coin/"]}},fees:{trading:{tierBased:!1,percentage:!0,taker:.002,maker:.002}},precisionMode:c,exceptions:{405:d,104:h,108:r,107:a},commonCurrencies:{SOC:"Soda Coin"}})}async fetchMarkets(e={}){const t=await this.publicGetTicker({currency:"all"}),i=[],s=this.safeCurrencyCode("krw"),r=Object.keys(t);for(let e=0;e<r.length;e++){const a=r[e],n=this.safeValue(t,a,{});if(void 0===this.safeValue(n,"currency"))continue;const o=this.safeCurrencyCode(a);i.push({id:a,symbol:o+"/"+s,base:o,quote:s,settle:void 0,baseId:a,quoteId:"krw",settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber("1e-4"),price:this.parseNumber("1e-4"),cost:this.parseNumber("1e-8")},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:n})}return i}parseBalance(e){const t={info:e},i=this.omit(e,["errorCode","result","normalWallets"]),s=Object.keys(i);for(let e=0;e<s.length;e++){const r=s[e],a=i[r],n=this.safeCurrencyCode(r),o=this.account();o.free=this.safeString(a,"avail"),o.total=this.safeString(a,"balance"),t[n]=o}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostAccountBalance(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={currency:s.id,format:"json"},a=await this.publicGetOrderbook(this.extend(r,i)),n=this.safeTimestamp(a,"timestamp");return this.parseOrderBook(a,s.symbol,n,"bid","ask","price","qty")}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetTicker(this.extend({currency:"all",format:"json"},t)),s={},r=Object.keys(i),a=this.safeTimestamp(i,"timestamp");for(let e=0;e<r.length;e++){const t=r[e],n=this.safeMarket(t),o=n.symbol,h=i[t];s[o]=this.parseTicker(h,n),s[o].timestamp=a}return this.filterByArray(s,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={currency:i.id,format:"json"},r=await this.publicGetTicker(this.extend(s,t));return this.parseTicker(r,i)}parseTicker(e,t){const i=this.safeTimestamp(e,"timestamp"),s=this.safeString(e,"first"),r=this.safeString(e,"last"),a=this.safeString(e,"yesterday_last"),n=this.safeSymbol(void 0,t);return this.safeTicker({symbol:n,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:s,close:r,last:r,previousClose:a,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"volume"),quoteVolume:void 0,info:e},t)}parseTrade(e,t){const i=this.safeTimestamp(e,"timestamp");t=this.safeMarket(void 0,t);const s=this.safeString(e,"is_ask");let r=this.safeString(e,"type");void 0!==s?"1"===s?r="sell":"0"===s&&(r="buy"):"ask"===r?r="sell":"bid"===r&&(r="buy");const a=this.safeString(e,"price"),n=this.safeString(e,"qty"),o=this.safeString(e,"orderId");let h,d=this.safeString(e,"fee");if(void 0!==d){d=l.stringAbs(d);let i=this.safeString(e,"feeRate");i=l.stringAbs(i);h={cost:d,currency:"sell"===r?t.quote:t.base,rate:i}}return this.safeTrade({id:this.safeString(e,"id"),info:e,timestamp:i,datetime:this.iso8601(i),order:o,symbol:t.symbol,type:void 0,side:r,takerOrMaker:void 0,price:a,amount:n,cost:void 0,fee:h},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={currency:r.id,format:"json"},n=await this.publicGetTrades(this.extend(a,s)),o=this.safeValue(n,"completeOrders",[]);return this.parseTrades(o,r,t,i)}async createOrder(e,t,i,s,r,a={}){if("limit"!==t)throw new n(this.id+" createOrder() allows limit orders only");await this.loadMarkets();const o=this.market(e),h={price:r,currency:o.id,qty:s},d="privatePostOrder"+this.capitalize(t)+this.capitalize(i),c=await this[d](this.extend(h,a));return this.parseOrder(c,o)}async fetchOrder(e,t,i={}){if(void 0===t)throw new o(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={order_id:e,currency:s.id},a=await this.privatePostOrderOrderInfo(this.extend(r,i)),n=this.safeValue(a,"info",{});return n.status=this.safeString(n,"status"),this.parseOrder(n,s)}parseOrderStatus(e){return this.safeString({live:"open",partially_filled:"open",filled:"closed"},e,e)}parseOrder(e,t){const i=this.safeString(e,"orderId"),s=this.safeString(e,"price"),r=this.safeTimestamp(e,"timestamp");let a=this.safeString(e,"type");"ask"===a?a="sell":"bid"===a&&(a="buy");const n=this.safeString(e,"remainQty"),o=this.safeString(e,"qty");let h=this.safeString(e,"status");if("live"===h&&void 0!==n&&void 0!==o){l.stringLt(n,o)&&(h="canceled")}h=this.parseOrderStatus(h);const d=t.symbol,c=t.base,u=t.quote;let f;const p=this.safeString(e,"fee");if(void 0!==p){const t="sell"===a?u:c;f={cost:p,rate:this.safeString(e,"feeRate"),currency:t}}return this.safeOrder({info:e,id:i,clientOrderId:void 0,timestamp:r,datetime:this.iso8601(r),lastTradeTimestamp:void 0,symbol:d,type:"limit",timeInForce:void 0,postOnly:void 0,side:a,price:s,stopPrice:void 0,triggerPrice:void 0,cost:void 0,average:void 0,amount:o,filled:void 0,remaining:n,status:h,fee:f,trades:void 0},t)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new n(this.id+" fetchOpenOrders() allows fetching closed orders with a specific symbol");await this.loadMarkets();const r=this.market(e),a={currency:r.id},o=await this.privatePostOrderLimitOrders(this.extend(a,s)),h=this.safeValue(o,"limitOrders",[]);return this.parseOrders(h,r,t,i)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={currency:r.id},n=await this.privatePostOrderCompleteOrders(this.extend(a,s)),h=this.safeValue(n,"completeOrders",[]);return this.parseTrades(h,r,t,i)}async cancelOrder(e,t,i={}){if(void 0===t)throw new o(this.id+" cancelOrder() requires a symbol argument. To cancel the order, pass a symbol argument and {'price': 12345, 'qty': 1.2345, 'is_ask': 0} in the params argument of cancelOrder.");const s=this.safeNumber(i,"price"),r=this.safeNumber(i,"qty"),a=this.safeInteger(i,"is_ask");if(void 0===s||void 0===r||void 0===a)throw new o(this.id+" cancelOrder() requires {'price': 12345, 'qty': 1.2345, 'is_ask': 0} in the params argument.");await this.loadMarkets();const n={order_id:e,price:s,qty:r,is_ask:a,currency:this.marketId(t)};return await this.privatePostOrderCancel(this.extend(n,i))}async fetchDepositAddresses(e,t={}){await this.loadMarkets();const i=await this.privatePostAccountDepositAddress(t),s=this.safeValue(i,"walletAddress",{}),r=Object.keys(s),a={};for(let e=0;e<r.length;e++){const t=r[e],i=s[t];if(!i||"-1"===i)continue;const n=t.split("_"),o=this.safeValue(n,0),h=this.safeValue(n,1),d=this.safeCurrencyCode(o);let c=this.safeValue(a,d);void 0===c&&(c={currency:d,address:void 0,tag:void 0,info:i});const l=this.safeString(c,"address",i);this.checkAddress(l),c.address=l,c.info=l,"tag"!==h&&"memo"!==h||(c.tag=i,c.info=[l,i]),a[d]=c}return a}sign(e,t="public",i="GET",s={},r,a){const n=this.implodeParams(e,s),o=this.omit(s,this.extractParams(e));let h=this.urls.api.rest+"/";if("public"===t)h+=n,Object.keys(o).length&&(h+="?"+this.urlencode(o));else{this.checkRequiredCredentials(),h+=this.version+"/"+n;const e=this.nonce().toString(),t=this.json(this.extend({access_token:this.apiKey,nonce:e},s)),i=this.stringToBase64(t);a=this.decode(i);const o=this.secret.toUpperCase();r={"Content-Type":"application/json","X-COINONE-PAYLOAD":i,"X-COINONE-SIGNATURE":this.hmac(i,this.encode(o),"sha512")}}return{url:h,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,o,h,d){if(void 0!==o){if(!("result"in o))throw new n(this.id+" "+a);if("success"!==o.result){const e=this.safeString(o,"errorCode"),t=this.id+" "+a;throw this.throwExactlyMatchedException(this.exceptions,e,t),new n(t)}}}}},98974:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a}=i(73449),{TICK_SIZE:n}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"coinspot",name:"CoinSpot",countries:["AU"],rateLimit:1e3,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createMarketOrder:!1,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkOHLCV:!1,fetchOpenInterestHistory:!1,fetchOrderBook:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1},urls:{logo:"https://user-images.githubusercontent.com/1294454/28208429-3cacdf9a-6896-11e7-854e-4c79a772a30f.jpg",api:{public:"https://www.coinspot.com.au/pubapi",private:"https://www.coinspot.com.au/api"},www:"https://www.coinspot.com.au",doc:"https://www.coinspot.com.au/api",referral:"https://www.coinspot.com.au/register?code=PJURCU"},api:{public:{get:["latest"]},private:{post:["orders","orders/history","my/coin/deposit","my/coin/send","quote/buy","quote/sell","my/balances","my/orders","my/buy","my/sell","my/buy/cancel","my/sell/cancel","ro/my/balances","ro/my/balances/{cointype}","ro/my/deposits","ro/my/withdrawals","ro/my/transactions","ro/my/transactions/{cointype}","ro/my/transactions/open","ro/my/transactions/{cointype}/open","ro/my/sendreceive","ro/my/affiliatepayments","ro/my/referralpayments"]}},markets:{"ADA/AUD":{id:"ada",symbol:"ADA/AUD",base:"ADA",quote:"AUD",baseId:"ada",quoteId:"aud",type:"spot",spot:!0},"BTC/AUD":{id:"btc",symbol:"BTC/AUD",base:"BTC",quote:"AUD",baseId:"btc",quoteId:"aud",type:"spot",spot:!0},"ETH/AUD":{id:"eth",symbol:"ETH/AUD",base:"ETH",quote:"AUD",baseId:"eth",quoteId:"aud",type:"spot",spot:!0},"XRP/AUD":{id:"xrp",symbol:"XRP/AUD",base:"XRP",quote:"AUD",baseId:"xrp",quoteId:"aud",type:"spot",spot:!0},"LTC/AUD":{id:"ltc",symbol:"LTC/AUD",base:"LTC",quote:"AUD",baseId:"ltc",quoteId:"aud",type:"spot",spot:!0},"DOGE/AUD":{id:"doge",symbol:"DOGE/AUD",base:"DOGE",quote:"AUD",baseId:"doge",quoteId:"aud",type:"spot",spot:!0},"RFOX/AUD":{id:"rfox",symbol:"RFOX/AUD",base:"RFOX",quote:"AUD",baseId:"rfox",quoteId:"aud",type:"spot",spot:!0},"POWR/AUD":{id:"powr",symbol:"POWR/AUD",base:"POWR",quote:"AUD",baseId:"powr",quoteId:"aud",type:"spot",spot:!0},"NEO/AUD":{id:"neo",symbol:"NEO/AUD",base:"NEO",quote:"AUD",baseId:"neo",quoteId:"aud",type:"spot",spot:!0},"TRX/AUD":{id:"trx",symbol:"TRX/AUD",base:"TRX",quote:"AUD",baseId:"trx",quoteId:"aud",type:"spot",spot:!0},"EOS/AUD":{id:"eos",symbol:"EOS/AUD",base:"EOS",quote:"AUD",baseId:"eos",quoteId:"aud",type:"spot",spot:!0},"XLM/AUD":{id:"xlm",symbol:"XLM/AUD",base:"XLM",quote:"AUD",baseId:"xlm",quoteId:"aud",type:"spot",spot:!0},"RHOC/AUD":{id:"rhoc",symbol:"RHOC/AUD",base:"RHOC",quote:"AUD",baseId:"rhoc",quoteId:"aud",type:"spot",spot:!0},"GAS/AUD":{id:"gas",symbol:"GAS/AUD",base:"GAS",quote:"AUD",baseId:"gas",quoteId:"aud",type:"spot",spot:!0}},commonCurrencies:{DRK:"DASH"},options:{fetchBalance:"private_post_my_balances"},precisionMode:n})}parseBalance(e){const t={info:e},i=this.safeValue2(e,"balance","balances");if(Array.isArray(i))for(let e=0;e<i.length;e++){const s=i[e],r=Object.keys(s);for(let e=0;e<r.length;e++){const i=r[e],a=s[i],n=this.safeCurrencyCode(i),o=this.account();o.total=this.safeString(a,"balance"),t[n]=o}}else{const e=Object.keys(i);for(let s=0;s<e.length;s++){const r=e[s],a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(i,r),t[a]=n}}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=this.safeString(this.options,"fetchBalance","private_post_my_balances"),i=await this[t](e);return this.parseBalance(i)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={cointype:s.id},a=await this.privatePostOrders(this.extend(r,i));return this.parseOrderBook(a,s.symbol,void 0,"buyorders","sellorders","rate","amount")}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.safeString(e,"last");return this.safeTicker({symbol:i,timestamp:void 0,datetime:void 0,high:void 0,low:void 0,bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:void 0,close:s,last:s,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:void 0,quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s=await this.publicGetLatest(t);let r=i.id;r=r.toLowerCase();const a=this.safeValue(s,"prices"),n=this.safeValue(a,r);return this.parseTicker(n,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetLatest(t),s={},r=this.safeValue(i,"prices"),a=Object.keys(r);for(let e=0;e<a.length;e++){const t=a[e],i=this.safeMarket(t);if(i.spot){const e=i.symbol,a=r[t];s[e]=this.parseTicker(a,i)}}return this.filterByArray(s,"symbol",e)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={cointype:r.id},n=await this.privatePostOrdersHistory(this.extend(a,s)),o=this.safeValue(n,"orders",[]);return this.parseTrades(o,r,t,i)}parseTrade(e,t){const i=this.safeString(e,"rate"),s=this.safeString(e,"amount"),r=this.safeNumber(e,"total"),a=this.safeInteger(e,"solddate"),n=this.safeString(e,"market"),o=this.safeSymbol(n,t,"/");return this.safeTrade({info:e,id:void 0,symbol:o,timestamp:a,datetime:this.iso8601(a),order:void 0,type:void 0,side:void 0,takerOrMaker:void 0,price:i,amount:s,cost:r,fee:void 0},t)}async createOrder(e,t,i,s,a,n={}){await this.loadMarkets();const o="privatePostMy"+this.capitalize(i);if("market"===t)throw new r(this.id+" createOrder() allows limit orders only");const h={cointype:this.market(e).id,amount:s,rate:a};return await this[o](this.extend(h,n))}async cancelOrder(e,t,i={}){const s=this.safeString(i,"side");if("buy"!==s&&"sell"!==s)throw new a(this.id+' cancelOrder() requires a side parameter, "buy" or "sell"');i=this.omit(i,"side");const r="privatePostMy"+this.capitalize(s)+"Cancel",n={id:e};return await this[r](this.extend(n,i))}sign(e,t="public",i="GET",s={},r,a){const n=this.urls.api[t]+"/"+e;if("private"===t){this.checkRequiredCredentials();const e=this.nonce();a=this.json(this.extend({nonce:e},s)),r={"Content-Type":"application/json",key:this.apiKey,sign:this.hmac(this.encode(a),this.encode(this.secret),"sha512")}}return{url:n,method:i,body:a,headers:r}}}},10073:function(e,t,i){"use strict";const s=i(48819),{AuthenticationError:r,ArgumentsRequired:a,ExchangeError:n,InsufficientFunds:o,DDoSProtection:h,InvalidNonce:d,PermissionDenied:c,BadRequest:l,BadSymbol:u,NotSupported:f,AccountNotEnabled:p,OnMaintenance:m,InvalidOrder:g}=i(73449),{TICK_SIZE:y}=i(62115),b=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"cryptocom",name:"Crypto.com",countries:["MT"],version:"v2",rateLimit:10,pro:!0,has:{CORS:!1,spot:!0,margin:!0,swap:void 0,future:void 0,option:void 0,borrowMargin:!0,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,fetchBalance:!0,fetchBidsAsks:!1,fetchBorrowInterest:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!0,fetchClosedOrders:"emulated",fetchCurrencies:!1,fetchDepositAddress:!0,fetchDepositAddressesByNetwork:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRates:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPositionMode:!1,fetchPositions:!1,fetchStatus:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!1,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransactionFees:!1,fetchTransactions:!1,fetchTransfers:!0,fetchWithdrawals:!0,repayMargin:!0,setLeverage:!1,setMarginMode:!1,transfer:!0,withdraw:!0},timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","4h":"4h","6h":"6h","12h":"12h","1d":"1D","1w":"7D","2w":"14D","1M":"1M"},urls:{logo:"https://user-images.githubusercontent.com/1294454/147792121-38ed5e36-c229-48d6-b49a-48d05fc19ed4.jpeg",test:{v1:"https://uat-api.3ona.co/exchange/v1",v2:"https://uat-api.3ona.co/v2",derivatives:"https://uat-api.3ona.co/v2"},api:{v1:"https://api.crypto.com/exchange/v1",v2:"https://api.crypto.com/v2",derivatives:"https://deriv-api.crypto.com/v1"},www:"https://crypto.com/",referral:"https://crypto.com/exch/5835vstech",doc:["https://exchange-docs.crypto.com/exchange/v1/rest-ws/index.html","https://exchange-docs.crypto.com/spot/index.html","https://exchange-docs.crypto.com/derivatives/index.html"],fees:"https://crypto.com/exchange/document/fees-limits"},api:{v1:{public:{get:{"public/auth":10/3,"public/get-instruments":10/3,"public/get-book":1,"public/get-candlestick":1,"public/get-trades":1,"public/get-tickers":1,"public/get-valuations":1,"public/get-expired-settlement-price":10/3,"public/get-insurance":1}},private:{post:{"private/set-cancel-on-disconnect":10/3,"private/get-cancel-on-disconnect":10/3,"private/user-balance":10/3,"private/user-balance-history":10/3,"private/get-positions":10/3,"private/create-order":2/3,"private/create-order-list":10/3,"private/cancel-order":2/3,"private/cancel-order-list":10/3,"private/cancel-all-orders":2/3,"private/close-position":10/3,"private/get-order-history":100,"private/get-open-orders":10/3,"private/get-order-detail":1/3,"private/get-trades":100,"private/change-account-leverage":10/3,"private/get-transactions":10/3,"private/create-subaccount-transfer":10/3,"private/get-subaccount-balances":10/3,"private/get-order-list":10/3,"private/create-withdrawal":10/3,"private/get-currency-networks":10/3,"private/get-deposit-address":10/3,"private/get-accounts":10/3}}},v2:{public:{get:{"public/auth":1,"public/get-instruments":1,"public/get-book":1,"public/get-candlestick":1,"public/get-ticker":1,"public/get-trades":1,"public/margin/get-transfer-currencies":1,"public/margin/get-load-currenices":1,"public/respond-heartbeat":1}},private:{post:{"private/set-cancel-on-disconnect":10/3,"private/get-cancel-on-disconnect":10/3,"private/create-withdrawal":10/3,"private/get-withdrawal-history":10/3,"private/get-currency-networks":10/3,"private/get-deposit-history":10/3,"private/get-deposit-address":10/3,"private/get-account-summary":10/3,"private/create-order":2/3,"private/cancel-order":2/3,"private/cancel-all-orders":2/3,"private/create-order-list":10/3,"private/get-order-history":10/3,"private/get-open-orders":10/3,"private/get-order-detail":1/3,"private/get-trades":100,"private/margin/get-user-config":10/3,"private/margin/get-account-summary":10/3,"private/margin/transfer":10/3,"private/margin/borrow":10/3,"private/margin/repay":10/3,"private/margin/get-transfer-history":10/3,"private/margin/get-borrow-history":10/3,"private/margin/get-interest-history":10/3,"private/margin/get-repay-history":10/3,"private/margin/get-liquidation-history":10/3,"private/margin/get-liquidation-orders":10/3,"private/margin/create-order":2/3,"private/margin/cancel-order":2/3,"private/margin/cancel-all-orders":2/3,"private/margin/get-order-history":10/3,"private/margin/get-open-orders":10/3,"private/margin/get-order-detail":1/3,"private/margin/get-trades":100,"private/deriv/transfer":10/3,"private/deriv/get-transfer-history":10/3,"private/get-accounts":10/3,"private/get-subaccount-balances":10/3,"private/create-subaccount-transfer":10/3,"private/otc/get-otc-user":10/3,"private/otc/get-instruments":10/3,"private/otc/request-quote":100,"private/otc/accept-quote":100,"private/otc/get-quote-history":10/3,"private/otc/get-trade-history":10/3}}},derivatives:{public:{get:{"public/auth":10/3,"public/get-instruments":10/3,"public/get-book":1,"public/get-candlestick":1,"public/get-trades":1,"public/get-tickers":1,"public/get-valuations":1,"public/get-expired-settlement-price":10/3,"public/get-insurance":1}},private:{post:{"private/set-cancel-on-disconnect":10/3,"private/get-cancel-on-disconnect":10/3,"private/user-balance":10/3,"private/user-balance-history":10/3,"private/get-positions":10/3,"private/create-order":2/3,"private/create-order-list":10/3,"private/cancel-order":2/3,"private/cancel-order-list":10/3,"private/cancel-all-orders":2/3,"private/close-position":10/3,"private/convert-collateral":10/3,"private/get-order-history":100,"private/get-open-orders":10/3,"private/get-order-detail":1/3,"private/get-trades":100,"private/change-account-leverage":10/3,"private/get-transactions":10/3,"private/create-subaccount-transfer":10/3,"private/get-subaccount-balances":10/3,"private/get-order-list":10/3}}}},fees:{trading:{maker:this.parseNumber("0.004"),taker:this.parseNumber("0.004"),tiers:{maker:[[this.parseNumber("0"),this.parseNumber("0.004")],[this.parseNumber("25000"),this.parseNumber("0.0035")],[this.parseNumber("50000"),this.parseNumber("0.0015")],[this.parseNumber("100000"),this.parseNumber("0.001")],[this.parseNumber("250000"),this.parseNumber("0.0009")],[this.parseNumber("1000000"),this.parseNumber("0.0008")],[this.parseNumber("20000000"),this.parseNumber("0.0007")],[this.parseNumber("100000000"),this.parseNumber("0.0006")],[this.parseNumber("200000000"),this.parseNumber("0.0004")]],taker:[[this.parseNumber("0"),this.parseNumber("0.004")],[this.parseNumber("25000"),this.parseNumber("0.0035")],[this.parseNumber("50000"),this.parseNumber("0.0025")],[this.parseNumber("100000"),this.parseNumber("0.0016")],[this.parseNumber("250000"),this.parseNumber("0.00015")],[this.parseNumber("1000000"),this.parseNumber("0.00014")],[this.parseNumber("20000000"),this.parseNumber("0.00013")],[this.parseNumber("100000000"),this.parseNumber("0.00012")],[this.parseNumber("200000000"),this.parseNumber("0.0001")]]}}},options:{defaultType:"spot",accountsById:{funding:"SPOT",spot:"SPOT",margin:"MARGIN",derivatives:"DERIVATIVES",swap:"DERIVATIVES",future:"DERIVATIVES"}},commonCurrencies:{USD_STABLE_COIN:"USDC"},precisionMode:y,exceptions:{exact:{10001:n,10002:c,10003:c,10004:l,10005:c,10006:h,10007:d,10008:l,10009:l,20001:l,20002:o,20005:p,30003:u,30004:l,30005:l,30006:g,30007:g,30008:g,30009:g,30010:l,30013:g,30014:g,30016:g,30017:g,30023:g,30024:g,30025:g,40001:l,40002:l,40003:l,40004:l,40005:l,40006:l,40007:l,40101:r,50001:l,9010001:m}}})}async fetchMarkets(e={}){let t=[this.fetchSpotMarkets(e),this.fetchDerivativesMarkets(e)];t=await Promise.all(t);const i=t[0],s=t[1];return this.arrayConcat(i,s)}async fetchSpotMarkets(e={}){const t=await this.v2PublicGetPublicGetInstruments(e),i=this.safeValue(t,"result",{}),s=this.safeValue(i,"instruments",[]),r=[];for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"instrument_name"),a=this.safeString(t,"base_currency"),n=this.safeString(t,"quote_currency"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=this.safeString(t,"min_price"),c=this.safeString(t,"min_quantity");let l=this.parseNumber("1");this.safeValue(t,"margin_trading_enabled_5x")&&(l=this.parseNumber("5"));this.safeValue(t,"margin_trading_enabled_10x")&&(l=this.parseNumber("10")),r.push({id:i,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:this.safeValue(t,"margin_trading_enabled"),swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(t,"quantity_tick_size"),price:this.safeNumber(t,"price_tick_size")},limits:{leverage:{min:this.parseNumber("1"),max:l},amount:{min:this.parseNumber(c),max:this.safeNumber(t,"max_quantity")},price:{min:this.parseNumber(d),max:this.safeNumber(t,"max_price")},cost:{min:this.parseNumber(b.stringMul(c,d)),max:void 0}},info:t})}return r}async fetchDerivativesMarkets(e={}){const t=[],i=await this.derivativesPublicGetPublicGetInstruments(),s=this.safeValue(i,"result",{}),r=this.safeValue(s,"data",[]);for(let e=0;e<r.length;e++){const i=r[e],s=this.safeString(i,"inst_type"),a="PERPETUAL_SWAP"===s,n="FUTURE"===s;if("CCY_PAIR"===s)continue;const o=this.safeString(i,"base_ccy"),h=this.safeString(i,"quote_ccy"),d=this.safeCurrencyCode(o),c=this.safeCurrencyCode(h);let l=d+"/"+c+":"+c,u=this.safeInteger(i,"expiry_timestamp_ms");0===u&&(u=void 0);let f="swap";n&&(f="future",l=l+"-"+this.yymmdd(u));const p=this.safeNumber(i,"contract_size");t.push({id:this.safeString(i,"symbol"),symbol:l,base:d,quote:c,settle:c,baseId:o,quoteId:h,settleId:h,type:f,spot:!1,margin:!1,swap:a,future:n,option:!1,active:this.safeValue(i,"tradable"),contract:!0,linear:!0,inverse:!1,contractSize:p,expiry:u,expiryDatetime:this.iso8601(u),strike:void 0,optionType:void 0,precision:{price:this.parseNumber(this.parsePrecision(this.safeString(i,"quote_decimals"))),amount:this.parseNumber(this.parsePrecision(this.safeString(i,"quantity_decimals")))},limits:{leverage:{min:this.parseNumber("1"),max:this.safeNumber(i,"max_leverage")},amount:{min:this.parseNumber(p),max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:i})}return t}async fetchTickers(e,t={}){let i;if(await this.loadMarkets(),void 0!==(e=this.marketSymbols(e))){const t=this.safeValue(e,0);i=this.market(t)}const[s,r]=this.handleMarketTypeAndParams("fetchTickers",i,t),a=this.getSupportedMapping(s,{spot:"v2PublicGetPublicGetTicker",future:"derivativesPublicGetPublicGetTickers",swap:"derivativesPublicGetPublicGetTickers"}),n=await this[a](r),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"data",[]);return this.parseTickers(h,e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={instrument_name:i.id},[r,a]=this.handleMarketTypeAndParams("fetchTicker",i,t);if("spot"!==r)throw new f(this.id+" fetchTicker() only supports spot markets");const n=await this.v2PublicGetPublicGetTicker(this.extend(s,a)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"data",{}),d=this.safeValue(h,0,{});return this.parseTicker(d,i)}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={instrument_name:r.id};void 0!==t&&(n.start_ts=t),void 0!==i&&(n.page_size=i);const[o,h]=this.handleMarketTypeAndParams("fetchOrders",r,s);let d=this.getSupportedMapping(o,{spot:"v2PrivatePostPrivateGetOrderHistory",margin:"v2PrivatePostPrivateMarginGetOrderHistory",future:"derivativesPrivatePostPrivateGetOrderHistory",swap:"derivativesPrivatePostPrivateGetOrderHistory"});const[c,l]=this.customHandleMarginModeAndParams("fetchOrders",h);void 0!==c&&(d="v2PrivatePostPrivateMarginGetOrderHistory");const u=await this[d](this.extend(n,l)),f=this.safeValue(u,"result",{}),p=this.safeValue2(f,"order_list","data",[]);return this.parseOrders(p,r,t,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={instrument_name:r.id};void 0!==t&&(a.start_ts=t),void 0!==i&&(a.page_size=i);const[n,o]=this.handleMarketTypeAndParams("fetchTrades",r,s),h=this.getSupportedMapping(n,{spot:"v2PublicGetPublicGetTrades",future:"derivativesPublicGetPublicGetTrades",swap:"derivativesPublicGetPublicGetTrades"}),d=await this[h](this.extend(a,o)),c=this.safeValue(d,"result",{}),l=this.safeValue(c,"data",[]);return this.parseTrades(l,r,t,i)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={instrument_name:a.id,timeframe:this.safeString(this.timeframes,t,t)},[o,h]=this.handleMarketTypeAndParams("fetchOHLCV",a,r),d=this.getSupportedMapping(o,{spot:"v2PublicGetPublicGetCandlestick",future:"derivativesPublicGetPublicGetCandlestick",swap:"derivativesPublicGetPublicGetCandlestick"});if("spot"!==o){let e=100;void 0!==s&&(e=s),n.count=e}const c=await this[d](this.extend(n,h)),l=this.safeValue(c,"result",{}),u=this.safeValue(l,"data",[]);return this.parseOHLCVs(u,a,t,i,s)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={instrument_name:s.id};t&&(r.depth=t);const[a,n]=this.handleMarketTypeAndParams("fetchOrderBook",s,i),o=this.getSupportedMapping(a,{spot:"v2PublicGetPublicGetBook",future:"derivativesPublicGetPublicGetBook",swap:"derivativesPublicGetPublicGetBook"}),h=await this[o](this.extend(r,n)),d=this.safeValue(h,"result"),c=this.safeValue(d,"data"),l=this.safeValue(c,0),u=this.safeInteger(l,"t");return this.parseOrderBook(l,e,u)}parseSwapBalance(e){const t=this.safeValue(e,"result",{}),i=this.safeValue(t,"data",[]),s={info:e};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"instrument_name"),a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(t,"total_cash_balance"),n.free=this.safeString(t,"total_available_balance"),s[a]=n}return this.safeBalance(s)}parseSpotBalance(e){const t=this.safeValue(e,"result",{}),i=this.safeValue(t,"accounts",[]),s={info:e};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(t,"balance"),n.free=this.safeString(t,"available"),n.used=this.safeString(t,"order"),s[a]=n}return this.safeBalance(s)}async fetchBalance(e={}){await this.loadMarkets();const[t,i]=this.handleMarketTypeAndParams("fetchBalance",void 0,e);let s=this.getSupportedMapping(t,{spot:"v2PrivatePostPrivateGetAccountSummary",margin:"v2PrivatePostPrivateMarginGetAccountSummary",future:"derivativesPrivatePostPrivateUserBalance",swap:"derivativesPrivatePostPrivateUserBalance"});const[r,a]=this.customHandleMarginModeAndParams("fetchBalance",i);void 0!==r&&(s="v2PrivatePostPrivateMarginGetAccountSummary");const n=await this[s](a);return this[this.getSupportedMapping(t,{spot:"parseSpotBalance",margin:"parseSpotBalance",future:"parseSwapBalance",swap:"parseSwapBalance"})](n)}async fetchOrder(e,t,i={}){let s;await this.loadMarkets(),void 0!==t&&(s=this.market(t));const r={},[a,n]=this.handleMarketTypeAndParams("fetchOrder",s,i),[o,h]=this.customHandleMarginModeAndParams("fetchOrder",n);r.order_id="spot"===a||"margin"===a||void 0!==o?e.toString():parseInt(e);let d=this.getSupportedMapping(a,{spot:"v2PrivatePostPrivateGetOrderDetail",margin:"v2PrivatePostPrivateMarginGetOrderDetail",future:"derivativesPrivatePostPrivateGetOrderDetail",swap:"derivativesPrivatePostPrivateGetOrderDetail"});void 0!==o&&(d="v2PrivatePostPrivateMarginGetOrderDetail");const c=await this[d](this.extend(r,h)),l=this.safeValue(c,"result",{}),u=this.safeValue(l,"order_info",l);return this.parseOrder(u,s)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=t.toUpperCase(),h={instrument_name:n.id,side:i.toUpperCase(),type:o,quantity:this.amountToPrecision(e,s)};"LIMIT"!==o&&"STOP_LIMIT"!==o||(h.price=this.priceToPrecision(e,r));this.safeValue(a,"postOnly",!1)&&(h.exec_inst="POST_ONLY",a=this.omit(a,["postOnly"]));const[d,c]=this.handleMarketTypeAndParams("createOrder",n,a);let l=this.getSupportedMapping(d,{spot:"v2PrivatePostPrivateCreateOrder",margin:"v2PrivatePostPrivateMarginCreateOrder",future:"derivativesPrivatePostPrivateCreateOrder",swap:"derivativesPrivatePostPrivateCreateOrder"});const[u,f]=this.customHandleMarginModeAndParams("createOrder",c);void 0!==u&&(l="v2PrivatePostPrivateMarginCreateOrder");const p=await this[l](this.extend(h,f)),m=this.safeValue(p,"result",{});return this.parseOrder(m,n)}async cancelAllOrders(e,t={}){let i;await this.loadMarkets(),void 0!==e&&(i=this.market(e));const s={},[r,n]=this.handleMarketTypeAndParams("cancelAllOrders",i,t),[o,h]=this.customHandleMarginModeAndParams("cancelAllOrders",n);if("spot"===r||"margin"===r||void 0!==o){if(void 0===e)throw new a(this.id+" cancelAllOrders() requires a symbol argument for "+r+" orders");s.instrument_name=i.id}let d=this.getSupportedMapping(r,{spot:"v2PrivatePostPrivateCancelAllOrders",margin:"v2PrivatePostPrivateMarginCancelAllOrders",future:"derivativesPrivatePostPrivateCancelAllOrders",swap:"derivativesPrivatePostPrivateCancelAllOrders"});return void 0!==o&&(d="v2PrivatePostPrivateMarginCancelAllOrders"),await this[d](this.extend(s,h))}async cancelOrder(e,t,i={}){let s;await this.loadMarkets(),void 0!==t&&(s=this.market(t));const r={},[n,o]=this.handleMarketTypeAndParams("cancelOrder",s,i),[h,d]=this.customHandleMarginModeAndParams("cancelOrder",o);if("spot"===n||"margin"===n||void 0!==h){if(void 0===t)throw new a(this.id+" cancelOrder() requires a symbol argument for "+n+" orders");r.instrument_name=s.id,r.order_id=e.toString()}else r.order_id=parseInt(e);let c=this.getSupportedMapping(n,{spot:"v2PrivatePostPrivateCancelOrder",margin:"v2PrivatePostPrivateMarginCancelOrder",future:"derivativesPrivatePostPrivateCancelOrder",swap:"derivativesPrivatePostPrivateCancelOrder"});void 0!==h&&(c="v2PrivatePostPrivateMarginCancelOrder");const l=await this[c](this.extend(r,d)),u=this.safeValue(l,"result",l);return this.parseOrder(u)}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.instrument_name=r.id),void 0!==i&&(a.page_size=i);const[n,o]=this.handleMarketTypeAndParams("fetchOpenOrders",r,s);let h=this.getSupportedMapping(n,{spot:"v2PrivatePostPrivateGetOpenOrders",margin:"v2PrivatePostPrivateMarginGetOpenOrders",future:"derivativesPrivatePostPrivateGetOpenOrders",swap:"derivativesPrivatePostPrivateGetOpenOrders"});const[d,c]=this.customHandleMarginModeAndParams("fetchOpenOrders",o);void 0!==d&&(h="v2PrivatePostPrivateMarginGetOpenOrders");const l=await this[h](this.extend(a,c)),u=this.safeValue(l,"result",{}),f=this.safeValue2(u,"order_list","data",[]);return this.parseOrders(f,r,t,i)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;if(void 0!==e&&(a=this.market(e),r.instrument_name=a.id),void 0!==t){r.start_ts=t;const e=this.sum(t,864e5);r.end_ts=e}void 0!==i&&(r.page_size=i);const[n,o]=this.handleMarketTypeAndParams("fetchMyTrades",a,s);let h=this.getSupportedMapping(n,{spot:"v2PrivatePostPrivateGetTrades",margin:"v2PrivatePostPrivateMarginGetTrades",future:"derivativesPrivatePostPrivateGetTrades",swap:"derivativesPrivatePostPrivateGetTrades"});const[d,c]=this.customHandleMarginModeAndParams("fetchMyTrades",o);void 0!==d&&(h="v2PrivatePostPrivateMarginGetTrades");const l=await this[h](this.extend(r,c)),u=this.safeValue(l,"result",{}),f=this.safeValue2(u,"trade_list","data",[]);return this.parseTrades(f,a,t,i)}parseAddress(e){let t,i,s;if(e.indexOf("?")>0){[t,s]=e.split("?");i=s.split("=")[1]}else t=e;return[t,i]}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets();const a=this.currency(e),n={currency:a.id,amount:t,address:i};void 0!==s&&(n.address_tag=s);const o=await this.v2PrivatePostPrivateCreateWithdrawal(this.extend(n,r)),h=this.safeValue(o,"result");return this.parseTransaction(h,a)}async fetchDepositAddressesByNetwork(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=await this.v2PrivatePostPrivateGetDepositAddress(this.extend(i,t)),r=this.safeValue(s,"result",{}),a=this.safeValue(r,"deposit_address_list",[]),o=a.length;if(0===o)throw new n(this.id+" fetchDepositAddressesByNetwork() generating address...");const h={};for(let e=0;e<o;e++){const t=this.safeValue(a,e),i=this.safeString(t,"address"),s=this.safeString(t,"currency"),r=this.safeCurrencyCode(s),[n,o]=this.parseAddress(i);this.checkAddress(n);const d=this.safeString(t,"network"),c=this.safeNetwork(d);h[c]={info:t,currency:r,address:n,tag:o,network:c}}return h}async fetchDepositAddress(e,t={}){const i=this.safeStringUpper(t,"network");t=this.omit(t,["network"]);const s=await this.fetchDepositAddressesByNetwork(e,t);if(i in s)return s[i];return s[Object.keys(s)[0]]}safeNetwork(e){return this.safeString({BTC:"BTC",ETH:"ETH",SOL:"SOL",BNB:"BNB",CRONOS:"CRONOS",MATIC:"MATIC",OP:"OP"},e,e)}async fetchDeposits(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.currency(e),a.currency=r.id),void 0!==t&&(a.start_ts=t),void 0!==i&&(a.page_size=i);const n=await this.v2PrivatePostPrivateGetDepositHistory(this.extend(a,s)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"deposit_list",[]);return this.parseTransactions(h,r,t,i)}async fetchWithdrawals(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.currency(e),a.currency=r.id),void 0!==t&&(a.start_ts=t),void 0!==i&&(a.page_size=i);const n=await this.v2PrivatePostPrivateGetWithdrawalHistory(this.extend(a,s)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"withdrawal_list",[]);return this.parseTransactions(h,r,t,i)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e);i=i.toLowerCase(),s=s.toLowerCase();const n=this.safeValue(this.options,"accountsById",{}),o=this.safeString(n,i,i),h=this.safeString(n,s,s),d={currency:a.id,amount:parseFloat(t),from:o,to:h};let c="v2PrivatePostPrivateDerivTransfer";"margin"!==i&&"margin"!==s||(c="v2PrivatePostPrivateMarginTransfer");const l=await this[c](this.extend(d,r));return this.parseTransfer(l,a)}async fetchTransfers(e,t,i,s={}){if(!("direction"in s))throw new a(this.id+' fetchTransfers() requires a direction param to be either "IN" or "OUT"');let r;await this.loadMarkets();const n={direction:"OUT"};void 0!==e&&(r=this.currency(e),n.currency=r.id),void 0!==t&&(n.start_ts=t),void 0!==i&&(n.page_size=i);let o="v2PrivatePostPrivateDerivGetTransferHistory";const[h,d]=this.customHandleMarginModeAndParams("fetchTransfers",s);void 0!==h&&(o="v2PrivatePostPrivateMarginGetTransferHistory");const c=await this[o](this.extend(n,d)),l=[];return l.push({response:c}),this.parseTransfers(l,r,t,i,s)}parseTransferStatus(e){return this.safeString({COMPLETED:"ok",PROCESSING:"pending"},e,e)}parseTransfer(e,t){const i=this.safeValue(e,"response",{}),s=this.safeValue(i,"result",{}),r=this.safeValue(s,"transfer_list",[]);let a,n,o,h,d,c,l;for(let e=0;e<r.length;e++){const t=r[e];a=this.safeInteger(t,"time"),n=this.safeNumber(t,"amount");const i=this.safeString(t,"currency");o=this.safeCurrencyCode(i),h=this.safeString(t,"information");const s=this.safeString(t,"status");d=this.parseTransferStatus(s)}if(void 0!==h){const e=h.split(" "),t=this.safeStringLower(e,0),s=this.safeString(i,"method");"from"===t?(c=this.safeStringLower(e,1),l="private/margin/get-transfer-history"===s?"margin":"derivative"):"to"===t&&(l=this.safeStringLower(e,1),c="private/margin/get-transfer-history"===s?"margin":"derivative")}return{info:r,id:this.safeString(i,"id"),timestamp:a,datetime:this.iso8601(a),currency:o,amount:n,fromAccount:c,toAccount:l,status:d}}parseTicker(e,t){const i=this.safeInteger(e,"t"),s=this.safeString(e,"i"),r=(t=this.safeMarket(s,t,"_")).symbol,a=this.safeString(e,"a"),n=this.safeString(e,"c");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"h"),low:this.safeString(e,"l"),bid:this.safeString(e,"b"),bidVolume:void 0,ask:this.safeString(e,"k"),askVolume:void 0,vwap:void 0,open:void 0,close:a,last:a,previousClose:void 0,change:n,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"v"),quoteVolume:void 0,info:e},t)}parseTrade(e,t){const i=this.safeInteger2(e,"t","create_time"),s=this.safeString2(e,"i","instrument_name"),r=(t=this.safeMarket(s,t,"_")).symbol,a=this.safeString2(e,"p","traded_price"),n=this.safeString2(e,"q","traded_quantity");let o=this.safeString2(e,"s","side");void 0!==o&&(o=o.toLowerCase());const h=this.safeString2(e,"d","trade_id"),d=this.safeStringLower2(e,"liquidity_indicator","taker_side"),c=this.safeString(e,"order_id");let l,u=this.safeString2(e,"fee","fees");if(void 0!==u){let i;this.safeValue(t,"contract",!1)&&(u=b.stringNeg(u)),t.spot?i=this.safeString(e,"fee_currency"):t.linear&&(i=t.quote),l={currency:i,cost:u}}return this.safeTrade({info:e,id:h,timestamp:i,datetime:this.iso8601(i),symbol:r,side:o,price:a,amount:n,cost:void 0,order:c,takerOrMaker:d,type:void 0,fee:l},t)}parseOHLCV(e,t){return[this.safeInteger(e,"t"),this.safeNumber(e,"o"),this.safeNumber(e,"h"),this.safeNumber(e,"l"),this.safeNumber(e,"c"),this.safeNumber(e,"v")]}parseOrderStatus(e){return this.safeString({ACTIVE:"open",CANCELED:"canceled",FILLED:"closed",REJECTED:"rejected",EXPIRED:"expired"},e,e)}parseTimeInForce(e){return this.safeString({GOOD_TILL_CANCEL:"GTC",IMMEDIATE_OR_CANCEL:"IOC",FILL_OR_KILL:"FOK"},e,e)}parseOrder(e,t){const i=this.safeInteger(e,"create_time"),s=this.safeInteger(e,"update_time"),r=this.safeString(e,"instrument_name"),a=this.safeSymbol(r,t),n=this.safeString(e,"quantity"),o=this.safeString(e,"cumulative_quantity"),h=this.parseOrderStatus(this.safeString(e,"status")),d=this.safeString(e,"order_id"),c=this.safeString(e,"client_oid"),l=this.safeString2(e,"price","limit_price"),u=this.safeString(e,"avg_price"),f=this.safeStringLower2(e,"type","order_type"),p=this.safeStringLower(e,"side"),m=this.parseTimeInForce(this.safeString(e,"time_in_force")),g=this.safeString(e,"exec_inst");let y;void 0!==g&&(y="POST_ONLY"===g);const b=this.safeString(e,"cumulative_value"),v=this.safeString(e,"cumulative_fee");let w;if(void 0!==v){const t=this.safeString(e,"fee_instrument_name");w={cost:v,currency:this.safeCurrencyCode(t)}}return this.safeOrder({info:e,id:d,clientOrderId:c,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:s,status:h,symbol:a,type:f,timeInForce:m,postOnly:y,side:p,price:l,amount:n,filled:o,remaining:void 0,cost:b,fee:w,average:u,trades:[]},t)}parseDepositStatus(e){return this.safeString({0:"pending",1:"ok",2:"failed",3:"pending"},e,e)}parseWithdrawalStatus(e){return this.safeString({0:"pending",1:"pending",2:"failed",3:"pending",4:"failed",5:"ok",6:"canceled"},e,e)}parseTransaction(e,t){let i;const s=this.safeString(e,"status");let r;"client_wid"in e?(i="withdrawal",r=this.parseWithdrawalStatus(s)):(i="deposit",r=this.parseDepositStatus(s));const a=this.safeString(e,"id"),n=this.safeString(e,"address"),[o,h]=this.parseAddress(n),d=this.safeString(e,"currency"),c=this.safeCurrencyCode(d,t),l=this.safeInteger(e,"create_time"),u=this.safeNumber(e,"amount"),f=this.safeString(e,"txid"),p=this.safeNumber(e,"fee");let m;void 0!==p&&(m={currency:c,cost:p});const g=this.safeInteger(e,"update_time");return{info:e,id:a,txid:f,timestamp:l,datetime:this.iso8601(l),network:void 0,address:o,addressTo:o,addressFrom:void 0,tag:h,tagTo:h,tagFrom:void 0,type:i,amount:u,currency:c,status:r,updated:g,internal:void 0,fee:m}}async repayMargin(e,t,i,s={}){await this.loadMarkets();const r=this.currency(e),a={currency:r.id,amount:this.currencyToPrecision(e,t)},n=await this.v2PrivatePostPrivateMarginRepay(this.extend(a,s)),o=this.parseMarginLoan(n,r);return this.extend(o,{amount:t})}async borrowMargin(e,t,i,s={}){await this.loadMarkets();const r=this.currency(e),a={currency:r.id,amount:this.currencyToPrecision(e,t)},n=await this.v2PrivatePostPrivateMarginBorrow(this.extend(a,s)),o=this.parseMarginLoan(n,r);return this.extend(o,{amount:t})}parseMarginLoan(e,t){return{id:this.safeInteger(e,"id"),currency:this.safeCurrencyCode(void 0,t),amount:void 0,symbol:void 0,timestamp:void 0,datetime:void 0,info:e}}async fetchBorrowInterest(e,t,i,s,r={}){await this.loadMarkets();const a={};let n,o;void 0!==t&&(n=this.market(t)),void 0!==e&&(o=this.currency(e),a.currency=o.id),void 0!==i&&(a.start_ts=i),void 0!==s&&(a.page_size=s);const h=await this.v2PrivatePostPrivateMarginGetInterestHistory(this.extend(a,r)),d=this.safeValue(h,"result",{}),c=this.safeValue(d,"list",[]);let l;for(let e=0;e<c.length;e++)l=this.parseBorrowInterests(c,n);return this.filterByCurrencySinceLimit(l,e,i,s)}parseBorrowInterest(e,t){const i=this.safeInteger(e,"time");let s;return void 0!==t&&(s=t.symbol),{symbol:s,marginMode:void 0,currency:this.safeCurrencyCode(this.safeString(e,"currency")),interest:this.safeNumber(e,"interest"),interestRate:this.safeNumber(e,"interest_rate"),amountBorrowed:void 0,timestamp:i,datetime:this.iso8601(i),info:e}}async fetchBorrowRates(e={}){await this.loadMarkets();const t=await this.v2PrivatePostPrivateMarginGetUserConfig(e),i=this.safeValue(t,"result",{}),s=this.safeValue(i,"currency_configs",[]);return this.parseBorrowRates(s,"currency")}parseBorrowRates(e,t){const i=this.milliseconds(),s=[];for(let t=0;t<e.length;t++){const r=e[t];s.push({currency:this.safeCurrencyCode(this.safeString(r,"currency")),rate:this.safeNumber(r,"hourly_rate"),period:36e5,timestamp:i,datetime:this.iso8601(i),info:r})}return s}customHandleMarginModeAndParams(e,t={}){const i=this.safeString(this.options,"defaultType"),s=this.safeValue(t,"margin",!1);let r;if(t=this.omit(t,"margin"),[r,t]=this.handleMarginModeAndParams(e,t),void 0!==r){if("cross"!==r)throw new f(this.id+" only cross margin is supported")}else"margin"!==i&&!0!==s||(r="cross");return[r,t]}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){const[n,o]=t;let h=this.urls.api[n]+"/"+e;const d=this.omit(s,this.extractParams(e));if("public"===o)Object.keys(d).length&&(h+="?"+this.urlencode(d));else{this.checkRequiredCredentials();const t=this.nonce().toString(),i=this.extend({},s),n=this.keysort(i),o=Object.keys(n);let h="";for(let e=0;e<o.length;e++)h=h+o[e].toString()+i[o[e]].toString();const d=e+t+this.apiKey+h+t,c=this.hmac(this.encode(d),this.encode(this.secret)),l=o.length;if(a=this.json({id:t,method:e,params:s,api_key:this.apiKey,sig:c,nonce:t}),0===l){const e="{}",t="[]";a=a.replace(t,e)}r={"Content-Type":"application/json"}}return{url:h,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,o,h,d){const c=this.safeString(o,"code");if("0"!==c){const e=this.id+" "+a;throw this.throwExactlyMatchedException(this.exceptions.exact,c,e),new n(this.id+" "+a)}}}},49610:function(e,t,i){"use strict";const s=i(48819),{BadSymbol:r,ExchangeError:a,ArgumentsRequired:n,ExchangeNotAvailable:o,InsufficientFunds:h,OrderNotFound:d,InvalidOrder:c,DDoSProtection:l,InvalidNonce:u,AuthenticationError:f,BadRequest:p}=i(73449),{TICK_SIZE:m}=i(62115),g=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"currencycom",name:"Currency.com",countries:["BY"],rateLimit:100,certified:!1,pro:!0,version:"v2",has:{CORS:void 0,spot:!0,margin:!0,swap:!0,future:!1,option:!1,addMargin:void 0,cancelAllOrders:void 0,cancelOrder:!0,cancelOrders:void 0,createDepositAddress:void 0,createLimitOrder:!0,createMarketOrder:!0,createOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,editOrder:"emulated",fetchAccounts:!0,fetchBalance:!0,fetchBidsAsks:void 0,fetchBorrowRate:void 0,fetchBorrowRateHistory:void 0,fetchBorrowRates:void 0,fetchBorrowRatesPerSymbol:void 0,fetchCanceledOrders:void 0,fetchClosedOrder:void 0,fetchClosedOrders:void 0,fetchCurrencies:!0,fetchDeposit:void 0,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDepositAddressesByNetwork:!1,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchL2OrderBook:!0,fetchLedger:!0,fetchLedgerEntry:!1,fetchLeverage:!0,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrder:void 0,fetchOpenOrders:!0,fetchOrder:void 0,fetchOrderBook:!0,fetchOrderBooks:void 0,fetchOrders:void 0,fetchOrderTrades:void 0,fetchPosition:void 0,fetchPositionMode:!1,fetchPositions:!0,fetchPositionsRisk:void 0,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTradingLimits:void 0,fetchTransactionFee:void 0,fetchTransactionFees:void 0,fetchTransactions:!0,fetchTransfers:void 0,fetchWithdrawal:void 0,fetchWithdrawals:!0,reduceMargin:void 0,setLeverage:void 0,setMarginMode:void 0,setPositionMode:void 0,signIn:void 0,transfer:void 0,withdraw:void 0},timeframes:{"1m":"1m","5m":"5m","10m":"10m","15m":"15m","30m":"30m","1h":"1h","4h":"4h","1d":"1d","1w":"1w"},hostname:"backend.currency.com",urls:{logo:"https://user-images.githubusercontent.com/1294454/83718672-36745c00-a63e-11ea-81a9-677b1f789a4d.jpg",api:{public:"https://api-adapter.{hostname}/api",private:"https://api-adapter.{hostname}/api",marketcap:"https://marketcap.{hostname}/api"},test:{public:"https://demo-api-adapter.{hostname}/api",private:"https://demo-api-adapter.{hostname}/api"},www:"https://www.currency.com",referral:"https://currency.com/trading/signup?c=362jaimv&pid=referral",doc:["https://currency.com/api"],fees:"https://currency.com/fees-charges"},api:{public:{get:{"v1/time":1,"v1/exchangeInfo":1,"v1/depth":1,"v1/aggTrades":1,"v1/klines":1,"v1/ticker/24hr":1,"v2/time":1,"v2/exchangeInfo":1,"v2/depth":1,"v2/aggTrades":1,"v2/klines":1,"v2/ticker/24hr":1}},marketcap:{get:{"v1/assets":1,"v1/candles":1,"v1/orderbook":1,"v1/summary":1,"v1/ticker":1,"v1/token/assets":1,"v1/token/orderbook":1,"v1/token/summary":1,"v1/token/ticker":1,"v1/token/trades":1,"v1/token_crypto/OHLC":1,"v1/token_crypto/assets":1,"v1/token_crypto/orderbook":1,"v1/token_crypto/summary":1,"v1/token_crypto/ticker":1,"v1/token_crypto/trades":1,"v1/trades":1}},private:{get:{"v1/account":1,"v1/currencies":1,"v1/deposits":1,"v1/depositAddress":1,"v1/ledger":1,"v1/leverageSettings":1,"v1/myTrades":1,"v1/openOrders":1,"v1/tradingPositions":1,"v1/tradingPositionsHistory":1,"v1/transactions":1,"v1/withdrawals":1,"v2/account":1,"v2/currencies":1,"v2/deposits":1,"v2/depositAddress":1,"v2/ledger":1,"v2/leverageSettings":1,"v2/myTrades":1,"v2/openOrders":1,"v2/tradingPositions":1,"v2/tradingPositionsHistory":1,"v2/transactions":1,"v2/withdrawals":1},post:{"v1/order":1,"v1/updateTradingPosition":1,"v1/updateTradingOrder":1,"v1/closeTradingPosition":1,"v2/order":1,"v2/updateTradingPosition":1,"v2/updateTradingOrder":1,"v2/closeTradingPosition":1},delete:{"v1/order":1,"v2/order":1}}},fees:{trading:{feeSide:"get",tierBased:!1,percentage:!0,taker:this.parseNumber("0.002"),maker:this.parseNumber("0.002")}},precisionMode:m,options:{defaultTimeInForce:"GTC",warnOnFetchOpenOrdersWithoutSymbol:!0,recvWindow:5e3,timeDifference:0,adjustForTimeDifference:!1,parseOrderToPrecision:!1,newOrderRespType:{market:"FULL",limit:"RESULT",stop:"RESULT"},leverage_markets_suffix:"_LEVERAGE",collateralCurrencies:["USD","EUR","USDT"]},exceptions:{broad:{"FIELD_VALIDATION_ERROR Cancel is available only for LIMIT order":c,"API key does not exist":f,"Order would trigger immediately.":c,"Account has insufficient balance for requested action.":h,"Rest API trading is not enabled.":o,"Combination of parameters invalid":p,"Invalid limit price":p,"Only leverage symbol allowed here:":r,"market data service is not available":o,"your time is ahead of server":u},exact:{"-1000":o,"-1013":c,"-1022":f,"-1030":c,"-1100":c,"-1104":a,"-1025":f,"-1128":p,"-2010":a,"-2011":d,"-2013":d,"-2014":f,"-2015":f}},commonCurrencies:{ACN:"Accenture",AMC:"AMC Entertainment Holdings",BNS:"Bank of Nova Scotia",CAR:"Avis Budget Group Inc",CLR:"Continental Resources",EDU:"New Oriental Education & Technology Group Inc",ETN:"Eaton",FOX:"Fox Corporation",GM:"General Motors Co",IQ:"iQIYI",OSK:"Oshkosh",PLAY:"Dave & Buster's Entertainment"}})}nonce(){return this.milliseconds()-this.options.timeDifference}async fetchTime(e={}){const t=await this.publicGetV2Time(e);return this.safeInteger(t,"serverTime")}async fetchCurrencies(e={}){if(!this.checkRequiredCredentials(!1))return;const t=await this.privateGetV2Currencies(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"displaySymbol"),a=this.safeCurrencyCode(r),n=this.safeNumber(s,"commissionFixed");i[a]={id:r,code:a,type:this.safeStringLower(s,"type"),name:this.safeString(s,"name"),active:void 0,deposit:void 0,withdraw:void 0,fee:n,precision:this.parseNumber(this.parsePrecision(this.safeString(s,"precision"))),limits:{amount:{min:void 0,max:void 0},withdraw:{min:this.safeNumber(s,"minWithdrawal"),max:this.safeNumber(s,"maxWithdrawal")},deposit:{min:this.safeNumber(s,"minDeposit"),max:void 0}},info:s}}return i}async fetchMarkets(e={}){const t=await this.publicGetV2ExchangeInfo(e);this.options.adjustForTimeDifference&&await this.loadTimeDifference();const i=this.safeValue(t,"symbols",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"symbol"),a=this.safeString(t,"baseAsset"),n=this.safeString(t,"quoteAsset"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n);let d=o+"/"+h;const c=this.safeString(t,"marketType"),l="SPOT"===c,u=!1,f="LEVERAGE"===c,p=f;f&&(d=d.replace(this.options.leverage_markets_suffix,""),d+=":"+h);const m="TRADING"===this.safeString(t,"status"),y=this.safeString2(t,"exchangeFee","tradingFee");let b=this.safeString(t,"makerFee",y),v=this.safeString(t,"takerFee",y);b=g.stringDiv(b,"100"),v=g.stringDiv(v,"100");const w=this.safeValue(t,"filters",[]),S=this.indexBy(w,"filterType");let k,T,_=this.safeNumber(t,"tickSize");if("PRICE_FILTER"in S){const e=this.safeValue(S,"PRICE_FILTER",{});_=this.safeNumber(e,"tickSize"),k=this.safeNumber(e,"minPrice");const t=this.safeString(e,"maxPrice");void 0!==t&&g.stringGt(t,"0")&&(T=t)}let O=this.parseNumber(this.parsePrecision(this.safeString(t,"baseAssetPrecision"))),M={min:void 0,max:void 0};if("LOT_SIZE"in S){const e=this.safeValue(S,"LOT_SIZE",{});O=this.safeNumber(e,"stepSize"),M={min:this.safeNumber(e,"minQty"),max:this.safeNumber(e,"maxQty")}}let I,x={min:void 0,max:void 0};if("MARKET_LOT_SIZE"in S){const e=this.safeValue(S,"MARKET_LOT_SIZE",{});x={min:this.safeNumber(e,"minQty"),max:this.safeNumber(e,"maxQty")}}if("MIN_NOTIONAL"in S){const e=this.safeValue(S,"MIN_NOTIONAL",{});I=this.safeNumber(e,"minNotional")}const C=f||u;s.push({id:r,symbol:d,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:c,spot:l,margin:p,swap:f,future:u,option:!1,active:m,contract:C,linear:!!C||void 0,inverse:void 0,taker:this.parseNumber(v),maker:this.parseNumber(b),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:O,price:_},limits:{leverage:{min:void 0,max:void 0},amount:M,market:x,price:{min:k,max:this.parseNumber(T)},cost:{min:I,max:void 0}},info:t})}return s}async fetchAccounts(e={}){const t=await this.privateGetV2Account(e),i=this.safeValue(t,"balances",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeInteger(t,"accountId"),a=this.safeString(t,"asset"),n=this.safeCurrencyCode(a);s.push({id:r,type:void 0,currency:n,info:t})}return s}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privateGetV2Account(e),i=this.safeNumber(t,"makerCommission"),s=this.safeNumber(t,"takerCommission"),r={};for(let e=0;e<this.symbols.length;e++){const a=this.symbols[e];r[a]={info:t,symbol:a,maker:i,taker:s,percentage:!0,tierBased:!1}}return r}parseBalance(e,t){const i={info:e},s=this.safeValue(e,"balances",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"asset"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(t,"free"),n.used=this.safeString(t,"locked"),i[a]=n}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetV2Account(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={symbol:this.market(e).id};void 0!==t&&(s.limit=t);const r=await this.publicGetV2Depth(this.extend(s,i)),a=this.parseOrderBook(r,e);return a.nonce=this.safeInteger(r,"lastUpdateId"),a}parseTicker(e,t){const i=this.safeInteger2(e,"closeTime","timestamp"),s=this.safeString2(e,"symbol","symbolName");t=this.safeMarket(s,t,"/");const r=this.safeString(e,"lastPrice");return this.safeTicker({symbol:t.symbol,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"highPrice"),low:this.safeString(e,"lowPrice"),bid:this.safeString2(e,"bidPrice","bid"),bidVolume:this.safeString(e,"bidQty"),ask:this.safeString2(e,"askPrice","ofr"),askVolume:this.safeString(e,"ofrQty"),vwap:this.safeString(e,"weightedAvgPrice"),open:this.safeString(e,"openPrice"),close:r,last:r,previousClose:this.safeString(e,"prevClosePrice"),change:this.safeString(e,"priceChange"),percentage:this.safeString(e,"priceChangePercent"),average:void 0,baseVolume:this.safeString(e,"volume"),quoteVolume:this.safeString(e,"quoteVolume"),info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetV2Ticker24hr(this.extend(s,t));return this.parseTicker(r,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetV2Ticker24hr(t);return this.parseTickers(i,e)}parseOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,interval:this.safeString(this.timeframes,t,t)};void 0!==i&&(n.startTime=i),void 0!==s&&(n.limit=s);const o=await this.publicGetV2Klines(this.extend(n,r));return this.parseOHLCVs(o,a,t,i,s)}parseTrade(e,t){const i=this.safeInteger2(e,"T","time"),s=this.safeString2(e,"p","price"),r=this.safeString2(e,"q","qty"),a=this.safeString2(e,"a","id");let n;const o=this.safeString(e,"orderId");let h,d;"m"in e?(n=e.m?"sell":"buy",h="taker"):"isBuyer"in e&&(n=e.isBuyer?"buy":"sell",h=e.isMaker?"maker":"taker"),"commission"in e&&(d={cost:this.safeString(e,"commission"),currency:this.safeCurrencyCode(this.safeString(e,"commissionAsset"))});const c=this.safeString(e,"symbol"),l=this.safeSymbol(c,t);return this.safeTrade({id:a,order:o,timestamp:i,datetime:this.iso8601(i),symbol:l,type:void 0,takerOrMaker:h,side:n,price:s,amount:r,cost:void 0,fee:d,info:e},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.limit=i),void 0!==t&&(a.startTime=t);const n=await this.publicGetV2AggTrades(this.extend(a,s));return this.parseTrades(n,r,t,i)}parseOrder(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t,"/"),r=this.safeString(e,"orderId"),a=this.safeString(e,"price"),n=this.safeString(e,"origQty"),o=this.safeString(e,"executedQty"),h=g.stringAbs(o),d=this.parseOrderStatus(this.safeString(e,"status")),c=this.parseOrderTimeInForce(this.safeString(e,"timeInForce")),l=this.parseOrderType(this.safeString(e,"type")),u=this.parseOrderSide(this.safeString(e,"side")),f=this.safeInteger2(e,"time","transactTime"),p=this.safeValue(e,"fills");return this.safeOrder({info:e,id:r,timestamp:f,datetime:this.iso8601(f),lastTradeTimestamp:void 0,symbol:s,type:l,timeInForce:c,side:u,price:a,stopPrice:void 0,triggerPrice:void 0,amount:n,cost:void 0,average:void 0,filled:h,remaining:void 0,status:d,fee:void 0,trades:p},t)}parseOrderStatus(e){return this.safeString({NEW:"open",PARTIALLY_FILLED:"open",FILLED:"closed",CANCELED:"canceled",PENDING_CANCEL:"canceling",REJECTED:"rejected",EXPIRED:"expired"},e,e)}parseOrderType(e){return this.safeString({MARKET:"market",LIMIT:"limit",STOP:"stop"},e,e)}parseOrderTimeInForce(e){return this.safeString({GTC:"GTC",FOK:"FOK",IOC:"IOC"},e,e)}parseOrderSide(e){return this.safeString({BUY:"buy",SELL:"sell"},e,e)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const o=this.market(e);let h;if(o.margin&&(h=this.safeString(this.options,"accountId"),h=this.safeString(a,"accountId",h),void 0===h))throw new n(this.id+" createOrder() requires an accountId parameter or an exchange.options['accountId'] option for "+o.type+" markets");const d=this.safeValue(this.options.newOrderRespType,t,"RESULT"),c={symbol:o.id,quantity:this.amountToPrecision(e,s),type:t.toUpperCase(),side:i.toUpperCase(),newOrderRespType:d};if("limit"===t)c.price=this.priceToPrecision(e,r),c.timeInForce=this.options.defaultTimeInForce;else if("stop"===t)c.type="STOP",c.price=this.priceToPrecision(e,r);else if("market"===t){const t=this.safeValue2(a,"triggerPrice","stopPrice");a=this.omit(a,["triggerPrice","stopPrice"]),void 0!==t&&(c.type="STOP",c.price=this.priceToPrecision(e,t))}const l=await this.privatePostV2Order(this.extend(c,a));return this.parseOrder(l,o)}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets();const n={};if(void 0!==e)r=this.market(e),n.symbol=r.id;else if(this.options.warnOnFetchOpenOrdersWithoutSymbol){const e=this.symbols.length,t=parseInt(e/2);throw new a(this.id+" fetchOpenOrders() WARNING: fetching open orders without specifying a symbol is rate-limited to one call per "+t.toString()+" seconds. Do not call this method frequently to avoid ban. Set "+this.id+'.options["warnOnFetchOpenOrdersWithoutSymbol"] = false to suppress this warning message.')}const o=await this.privateGetV2OpenOrders(this.extend(n,s));return this.parseOrders(o,r,t,i,s)}async cancelOrder(e,t,i={}){if(void 0===t)throw new n(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r=this.safeValue(i,"origClientOrderId"),a={symbol:s.id};void 0===r?a.orderId=e:a.origClientOrderId=r;const o=await this.privateDeleteV2Order(this.extend(a,i));return this.parseOrder(o,s)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new n(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.limit=i);const o=await this.privateGetV2MyTrades(this.extend(a,s));return this.parseTrades(o,r,t,i)}async fetchDeposits(e,t,i,s={}){return await this.fetchTransactionsByMethod("privateGetV2Deposits",e,t,i,s)}async fetchWithdrawals(e,t,i,s={}){return await this.fetchTransactionsByMethod("privateGetV2Withdrawals",e,t,i,s)}async fetchTransactions(e,t,i,s={}){return await this.fetchTransactionsByMethod("privateGetV2Transactions",e,t,i,s)}async fetchTransactionsByMethod(e,t,i,s,r={}){await this.loadMarkets();const a={};let n;void 0!==t&&(n=this.currency(t)),void 0!==i&&(a.startTime=i),void 0!==s&&(a.limit=s);const o=await this[e](this.extend(a,r));return this.parseTransactions(o,n,i,s,r)}parseTransaction(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeString(e,"currency"),r=this.safeCurrencyCode(s,t),a=this.safeString(e,"commission"),n={currency:void 0,cost:void 0,rate:void 0};void 0!==a&&(n.currency=r,n.cost=a);return{info:e,id:this.safeString(e,"id"),txid:this.safeString(e,"blockchainTransactionHash"),type:this.parseTransactionType(this.safeString(e,"type")),currency:r,network:void 0,amount:this.safeNumber(e,"amount"),status:this.parseTransactionStatus(this.safeString(e,"state")),timestamp:i,datetime:this.iso8601(i),address:void 0,addressFrom:void 0,addressTo:void 0,tag:void 0,tagFrom:void 0,tagTo:void 0,updated:void 0,comment:void 0,fee:n}}parseTransactionStatus(e){return this.safeString({APPROVAL:"pending",PROCESSED:"ok"},e,e)}parseTransactionType(e){return this.safeString({deposit:"deposit",withdrawal:"withdrawal"},e,e)}async fetchLedger(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e)),void 0!==t&&(r.startTime=t),void 0!==i&&(r.limit=i);const n=await this.privateGetV2Ledger(this.extend(r,s));return this.parseLedger(n,a,t,i)}parseLedgerEntry(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"amount"),r=g.stringAbs(s),a=this.safeInteger(e,"timestamp"),n=this.safeString(e,"currency"),o=this.safeCurrencyCode(n,t),h=this.safeString(e,"commission");let d;void 0!==h&&(d={currency:o,cost:h});const c=g.stringLt(s,"0")?"out":"in";return{id:i,timestamp:a,datetime:this.iso8601(a),direction:c,account:void 0,referenceId:this.safeString(e,"blockchainTransactionHash"),referenceAccount:void 0,type:this.parseLedgerEntryType(this.safeString(e,"type")),currency:o,amount:r,before:void 0,after:this.safeString(e,"balance"),status:this.parseLedgerEntryStatus(this.safeString(e,"status")),fee:d,info:e}}parseLedgerEntryStatus(e){return this.safeString({APPROVAL:"pending",PROCESSED:"ok",CANCELLED:"canceled"},e,e)}parseLedgerEntryType(e){return this.safeString({deposit:"transaction",withdrawal:"transaction",exchange_commission:"fee"},e,e)}async fetchLeverage(e,t={}){await this.loadMarkets();const i={symbol:this.market(e).id},s=await this.privateGetV2LeverageSettings(this.extend(i,t));return this.safeNumber(s,"value")}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={coin:i.id},r=await this.privateGetV2DepositAddress(this.extend(s,t));return this.parseDepositAddress(r,i)}parseDepositAddress(e,t){const i=this.safeString(e,"address");return this.checkAddress(i),{currency:(t=this.safeCurrency(void 0,t)).code,address:i,tag:void 0,network:void 0,info:e}}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t]+"/"+e;if("historicalTrades"===e&&(r={"X-MBX-APIKEY":this.apiKey}),"private"===t){this.checkRequiredCredentials();let e=this.urlencode(this.extend({timestamp:this.nonce(),recvWindow:this.options.recvWindow},s));e+="&signature="+this.hmac(this.encode(e),this.encode(this.secret)),r={"X-MBX-APIKEY":this.apiKey},"GET"===i||"DELETE"===i?n+="?"+e:(a=e,r["Content-Type"]="application/x-www-form-urlencoded")}else Object.keys(s).length&&(n+="?"+this.urlencode(s));return n=this.implodeHostname(n),{url:n,method:i,body:a,headers:r}}async fetchPositions(e,t={}){await this.loadMarkets();const i=await this.privateGetV2TradingPositions(t),s=this.safeValue(i,"positions",[]);return this.parsePositions(s,e)}parsePosition(e,t){const i=(t=this.safeMarket(this.safeString(e,"symbol"),t)).symbol,s=this.safeNumber(e,"createdTimestamp"),r=this.safeString(e,"openQuantity"),a=g.stringGt(r,"0")?"long":"short",n=g.stringAbs(r),o=this.safeNumber(e,"openPrice"),h=this.safeNumber(e,"upl"),d=this.safeString(e,"margin"),c=g.stringDiv("1",d);return{symbol:i,timestamp:s,datetime:this.iso8601(s),contracts:this.parseNumber(n),contractSize:void 0,entryPrice:o,collateral:void 0,side:a,unrealizedProfit:h,leverage:c,percentage:void 0,marginMode:void 0,notional:void 0,markPrice:void 0,liquidationPrice:void 0,initialMargin:void 0,initialMarginPercentage:void 0,maintenanceMargin:this.parseNumber(d),maintenanceMarginPercentage:void 0,marginRatio:void 0,info:e,id:void 0}}handleErrors(e,t,i,s,r,n,o,h,d){if(418===e||429===e)throw new l(this.id+" "+e.toString()+" "+t+" "+n);if(e>=400){if(n.indexOf("Price * QTY is zero or less")>=0)throw new c(this.id+" order cost = amount * price is zero or less "+n);if(n.indexOf("LOT_SIZE")>=0)throw new c(this.id+" order amount should be evenly divisible by lot size "+n);if(n.indexOf("PRICE_FILTER")>=0)throw new c(this.id+" order price is invalid, i.e. exceeds allowed price precision, exceeds min price or max price limits or is invalid float value in general, use this.priceToPrecision (symbol, amount) "+n)}if(void 0===o)return;const u=this.safeString(o,"code");if(void 0!==u&&"0"!==u){const e=this.id+" "+this.json(o);this.throwExactlyMatchedException(this.exceptions.exact,u,e);const t=this.safeString(o,"msg");throw this.throwBroadlyMatchedException(this.exceptions.broad,t,e),new a(e)}}}},34237:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,InsufficientFunds:a,BadRequest:n,BadSymbol:o,InvalidOrder:h,AuthenticationError:d,ArgumentsRequired:c,OrderNotFound:l,ExchangeNotAvailable:u}=i(73449),{TICK_SIZE:f}=i(62115),p=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"delta",name:"Delta Exchange",countries:["VC"],rateLimit:300,version:"v2",has:{CORS:void 0,spot:!0,margin:void 0,swap:void 0,future:void 0,option:void 0,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,editOrder:!0,fetchBalance:!0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposit:void 0,fetchDepositAddress:!0,fetchDeposits:void 0,fetchLedger:!0,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarketLeverageTiers:!1,fetchMarkets:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrderBook:!0,fetchPosition:!0,fetchPositionMode:!1,fetchPositions:!0,fetchStatus:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTransfer:void 0,fetchTransfers:void 0,fetchWithdrawal:void 0,fetchWithdrawals:void 0,transfer:!1,withdraw:!1},timeframes:{"1m":"1m","3m":"3m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","2h":"2h","4h":"4h","6h":"6h","1d":"1d","7d":"7d","1w":"1w","2w":"2w","1M":"30d"},urls:{logo:"https://user-images.githubusercontent.com/1294454/99450025-3be60a00-2931-11eb-9302-f4fd8d8589aa.jpg",test:{public:"https://testnet-api.delta.exchange",private:"https://testnet-api.delta.exchange"},api:{public:"https://api.delta.exchange",private:"https://api.delta.exchange"},www:"https://www.delta.exchange",doc:["https://docs.delta.exchange"],fees:"https://www.delta.exchange/fees",referral:"https://www.delta.exchange/app/signup/?code=IULYNB"},api:{public:{get:["assets","settings","indices","products","tickers","tickers/{symbol}","l2orderbook/{symbol}","trades/{symbol}","history/candles","history/sparklines"]},private:{get:["orders","orders/leverage","positions","positions/margined","orders/history","fills","fills/history/download/csv","wallet/balances","wallet/transactions","wallet/transactions/download","deposits/address"],post:["orders","orders/batch","orders/leverage","positions/change_margin"],put:["orders","orders/batch"],delete:["orders","orders/all","orders/batch"]}},fees:{trading:{tierBased:!0,percentage:!0,taker:this.parseNumber("0.0015"),maker:this.parseNumber("0.0010"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.0015")],[this.parseNumber("100"),this.parseNumber("0.0013")],[this.parseNumber("250"),this.parseNumber("0.0013")],[this.parseNumber("1000"),this.parseNumber("0.001")],[this.parseNumber("5000"),this.parseNumber("0.0009")],[this.parseNumber("10000"),this.parseNumber("0.00075")],[this.parseNumber("20000"),this.parseNumber("0.00065")]],maker:[[this.parseNumber("0"),this.parseNumber("0.001")],[this.parseNumber("100"),this.parseNumber("0.001")],[this.parseNumber("250"),this.parseNumber("0.0009")],[this.parseNumber("1000"),this.parseNumber("0.00075")],[this.parseNumber("5000"),this.parseNumber("0.0006")],[this.parseNumber("10000"),this.parseNumber("0.0005")],[this.parseNumber("20000"),this.parseNumber("0.0005")]]}}},options:{networks:{TRC20:"TRC20(TRON)",TRX:"TRC20(TRON)",BEP20:"BEP20(BSC)",BSC:"BEP20(BSC)"},networksById:{"BEP20(BSC)":"BSC","TRC20(TRON)":"TRC20"}},precisionMode:f,requiredCredentials:{apiKey:!0,secret:!0},exceptions:{exact:{insufficient_margin:a,order_size_exceed_available:h,risk_limits_breached:n,invalid_contract:o,immediate_liquidation:h,out_of_bankruptcy:h,self_matching_disrupted_post_only:h,immediate_execution_post_only:h,bad_schema:n,invalid_api_key:d,invalid_signature:d,open_order_not_found:l,unavailable:u},broad:{}}})}async fetchTime(e={}){const t=await this.publicGetSettings(e),i=this.safeValue(t,"result",{});return this.safeIntegerProduct(i,"server_time",.001)}async fetchStatus(e={}){const t=await this.publicGetSettings(e),i=this.safeValue(t,"result",{});return{status:"true"===this.safeString(i,"under_maintenance")?"maintenance":"ok",updated:this.safeIntegerProduct(i,"server_time",.001,this.milliseconds()),eta:void 0,url:void 0,info:t}}async fetchCurrencies(e={}){const t=await this.publicGetAssets(e),i=this.safeValue(t,"result",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"symbol"),a=this.safeInteger(t,"id"),n=this.safeCurrencyCode(r),o="enabled"===this.safeString(t,"deposit_status"),h="enabled"===this.safeString(t,"withdrawal_status"),d=o&&h;s[n]={id:r,numericId:a,code:n,name:this.safeString(t,"name"),info:t,active:d,deposit:o,withdraw:h,fee:this.safeNumber(t,"base_withdrawal_fee"),precision:this.parseNumber(this.parsePrecision(this.safeString(t,"precision"))),limits:{amount:{min:void 0,max:void 0},withdraw:{min:this.safeNumber(t,"min_withdrawal_amount"),max:void 0}}}}return s}async loadMarkets(e=!1,t={}){const i=await super.loadMarkets(e,t);(void 0===this.safeValue(this.options,"currenciesByNumericId")||e)&&(this.options.currenciesByNumericId=this.indexBy(this.currencies,"numericId"));return(void 0===this.safeValue(this.options,"marketsByNumericId")||e)&&(this.options.marketsByNumericId=this.indexBy(this.markets,"numericId")),i}async fetchMarkets(e={}){const t=await this.publicGetProducts(e),i=this.safeValue(t,"result",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e];let r=this.safeString(t,"contract_type");const a=this.safeValue(t,"quoting_asset",{}),n=this.safeValue(t,"underlying_asset",{}),o=this.safeValue(t,"settling_asset"),h=this.safeValue(t,"product_specs",{}),d=this.safeString(n,"symbol"),c=this.safeString(a,"symbol"),l=this.safeString(o,"symbol"),u=this.safeString(t,"symbol"),f=this.safeInteger(t,"id"),p=this.safeCurrencyCode(d),m=this.safeCurrencyCode(c),g=this.safeCurrencyCode(l),y="put_options"===r,b="move_options"===r,v="spot"===r,w="perpetual_futures"===r,S="futures"===r,k="call_options"===r||y||b,T=this.safeString(t,"strike_price"),_=this.safeString(t,"settlement_time"),O=this.parse8601(_),M=this.safeNumber(t,"contract_value");let I;I=v?this.parseNumber(this.parsePrecision(this.safeString(h,"underlying_precision"))):this.parseNumber("1");const x=g===p;let C,P=p+"/"+m;if(w||S||k)if(P=P+":"+g,S||k)if(P=P+"-"+this.yymmdd(O),k){r="option";let e="C";C="call",y?(e="P",C="put"):b&&(e="M",C="move"),P=P+":"+T+":"+e}else r="future";else r="swap";else P=u;const A=this.safeString(t,"state");s.push({id:u,numericId:f,symbol:P,base:p,quote:m,settle:g,baseId:d,quoteId:c,settleId:l,type:r,spot:v,margin:!!v&&void 0,swap:w,future:S,option:k,active:"live"===A,contract:!v,linear:v?void 0:x,inverse:v?void 0:!x,taker:this.safeNumber(t,"taker_commission_rate"),maker:this.safeNumber(t,"maker_commission_rate"),contractSize:M,expiry:O,expiryDatetime:_,strike:this.parseNumber(T),optionType:C,precision:{amount:I,price:this.safeNumber(t,"tick_size")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.parseNumber("1"),max:this.safeNumber(t,"position_size_limit")},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"min_size"),max:void 0}},info:t})}return s}parseTicker(e,t){const i=this.safeIntegerProduct(e,"timestamp",.001),s=this.safeString(e,"symbol"),r=this.safeSymbol(s,t),a=this.safeString(e,"close"),n=this.safeString(e,"open"),o=this.safeString(e,"volume"),h=this.safeString(e,"turnover");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:n,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:o,quoteVolume:h,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetTickersSymbol(this.extend(s,t)),a=this.safeValue(r,"result",{});return this.parseTicker(a,i)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetTickers(t),s=this.safeValue(i,"result",[]),r={};for(let e=0;e<s.length;e++){const t=this.parseTicker(s[e]);r[t.symbol]=t}return this.filterByArray(r,"symbol",e)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};void 0!==t&&(r.depth=t);const a=await this.publicGetL2orderbookSymbol(this.extend(r,i)),n=this.safeValue(a,"result",{});return this.parseOrderBook(n,s.symbol,void 0,"buy","sell","price","size")}parseTrade(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"order_id");let r=this.parse8601(this.safeString(e,"created_at"));r=this.safeIntegerProduct(e,"timestamp",.001,r);const a=this.safeString(e,"price"),n=this.safeString(e,"size"),o=this.safeValue(e,"product",{}),h=this.safeString(o,"symbol"),d=this.safeSymbol(h,t),c=this.safeString(e,"seller_role");let l=this.safeString(e,"side");void 0===l&&("taker"===c?l="sell":"maker"===c&&(l="buy"));const u=this.safeString(e,"role"),f=this.safeValue(e,"meta_data",{});let p=this.safeString(f,"order_type");void 0!==p&&(p=p.replace("_order",""));const m=this.safeString(e,"commission");let g;if(void 0!==m){const e=this.safeValue(o,"settling_asset",{}),t=this.safeString(e,"symbol");g={cost:m,currency:this.safeCurrencyCode(t)}}return this.safeTrade({id:i,order:s,timestamp:r,datetime:this.iso8601(r),symbol:d,type:p,side:l,price:a,amount:n,cost:void 0,takerOrMaker:u,fee:g,info:e},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id},n=await this.publicGetTradesSymbol(this.extend(a,s)),o=this.safeValue(n,"result",[]);return this.parseTrades(o,r,t,i)}parseOHLCV(e,t){return[this.safeTimestamp(e,"time"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,resolution:this.safeString(this.timeframes,t,t)},o=this.parseTimeframe(t);if(s=s||2e3,void 0===i){const e=this.seconds();n.end=e,n.start=e-s*o}else{const e=parseInt(i/1e3);n.start=e,n.end=this.sum(e,s*o)}const h=await this.publicGetHistoryCandles(this.extend(n,r)),d=this.safeValue(h,"result",[]);return this.parseOHLCVs(d,a,t,i,s)}parseBalance(e){const t=this.safeValue(e,"result",[]),i={info:e},s=this.safeValue(this.options,"currenciesByNumericId",{});for(let e=0;e<t.length;e++){const r=t[e],a=this.safeString(r,"asset_id"),n=this.safeValue(s,a),o=void 0===n?a:n.code,h=this.account();h.total=this.safeString(r,"balance"),h.free=this.safeString(r,"available_balance"),i[o]=h}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetWalletBalances(e);return this.parseBalance(t)}async fetchPosition(e,t={}){await this.loadMarkets();const i=this.market(e),s={product_id:i.numericId},r=await this.privateGetPositions(this.extend(s,t)),a=this.safeValue(r,"result",{});return this.parsePosition(a,i)}async fetchPositions(e,t={}){await this.loadMarkets();const i=await this.privateGetPositionsMargined(t),s=this.safeValue(i,"result",[]);return this.parsePositions(s,e)}parsePosition(e,t){const i=this.safeString(e,"product_symbol"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeIntegerProduct(e,"timestamp",.001),a=this.safeString(e,"size");let n;return void 0!==a&&(p.stringGt(a,"0")?n="buy":p.stringLt(a,"0")&&(n="sell")),{info:e,id:void 0,symbol:s,notional:void 0,marginMode:void 0,liquidationPrice:this.safeNumber(e,"liquidation_price"),entryPrice:this.safeNumber(e,"entry_price"),unrealizedPnl:void 0,percentage:void 0,contracts:this.parseNumber(a),contractSize:this.safeNumber(t,"contractSize"),markPrice:void 0,side:n,hedged:void 0,timestamp:r,datetime:this.iso8601(r),maintenanceMargin:void 0,maintenanceMarginPercentage:void 0,collateral:void 0,initialMargin:void 0,initialMarginPercentage:void 0,leverage:void 0,marginRatio:void 0}}parseOrderStatus(e){return this.safeString({open:"open",pending:"open",closed:"closed",cancelled:"canceled"},e,e)}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"client_order_id"),r=this.parse8601(this.safeString(e,"created_at")),a=this.safeString(e,"product_id"),n=this.safeValue(this.options,"marketsByNumericId",{}),o=void 0===(t=this.safeValue(n,a,t))?a:t.symbol,h=this.parseOrderStatus(this.safeString(e,"state")),d=this.safeString(e,"side");let c=this.safeString(e,"order_type");c=c.replace("_order","");const l=this.safeString(e,"limit_price"),u=this.safeString(e,"size"),f=this.safeString(e,"unfilled_size"),p=this.safeString(e,"average_fill_price");let m;const g=this.safeString(e,"paid_commission");if(void 0!==g){let e;if(void 0!==t){const i=this.safeValue(t.info,"settling_asset",{}),s=this.safeString(i,"symbol");e=this.safeCurrencyCode(s)}m={cost:g,currency:e}}return this.safeOrder({info:e,id:i,clientOrderId:s,timestamp:r,datetime:this.iso8601(r),lastTradeTimestamp:void 0,symbol:o,type:c,side:d,price:l,amount:u,cost:void 0,average:p,filled:void 0,remaining:f,status:h,fee:m,trades:void 0},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=t+"_order",o=this.market(e),h={product_id:o.numericId,size:this.amountToPrecision(o.symbol,s),side:i,order_type:n};"limit"===t&&(h.limit_price=this.priceToPrecision(o.symbol,r));const d=this.safeString2(a,"clientOrderId","client_order_id");a=this.omit(a,["clientOrderId","client_order_id"]),void 0!==d&&(h.client_order_id=d);const c=await this.privatePostOrders(this.extend(h,a)),l=this.safeValue(c,"result",{});return this.parseOrder(l,o)}async editOrder(e,t,i,s,r,a,n={}){await this.loadMarkets();const o=this.market(t),h={id:parseInt(e),product_id:o.numericId};void 0!==r&&(h.size=parseInt(this.amountToPrecision(t,r))),void 0!==a&&(h.limit_price=this.priceToPrecision(t,a));const d=await this.privatePutOrders(this.extend(h,n)),c=this.safeValue(d,"result");return this.parseOrder(c,o)}async cancelOrder(e,t,i={}){if(void 0===t)throw new c(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={id:parseInt(e),product_id:s.numericId},a=await this.privateDeleteOrders(this.extend(r,i)),n=this.safeValue(a,"result");return this.parseOrder(n,s)}async cancelAllOrders(e,t={}){if(void 0===e)throw new c(this.id+" cancelAllOrders() requires a symbol argument");await this.loadMarkets();const i={product_id:this.market(e).numericId};return this.privateDeleteOrdersAll(this.extend(i,t))}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrdersWithMethod("privateGetOrders",e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersWithMethod("privateGetOrdersHistory",e,t,i,s)}async fetchOrdersWithMethod(e,t,i,s,r={}){await this.loadMarkets();const a={};let n;void 0!==t&&(n=this.market(t),a.product_ids=n.numericId),void 0!==i&&(a.start_time=i.toString()+"000"),void 0!==s&&(a.page_size=s);const o=await this[e](this.extend(a,r)),h=this.safeValue(o,"result",[]);return this.parseOrders(h,n,i,s)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.product_ids=a.numericId),void 0!==t&&(r.start_time=t.toString()+"000"),void 0!==i&&(r.page_size=i);const n=await this.privateGetFills(this.extend(r,s)),o=this.safeValue(n,"result",[]);return this.parseTrades(o,a,t,i)}async fetchLedger(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.asset_id=a.numericId),void 0!==i&&(r.page_size=i);const n=await this.privateGetWalletTransactions(this.extend(r,s)),o=this.safeValue(n,"result",[]);return this.parseLedger(o,a,t,i)}parseLedgerEntryType(e){return this.safeString({pnl:"pnl",deposit:"transaction",withdrawal:"transaction",commission:"fee",conversion:"trade",referral_bonus:"referral",commission_rebate:"rebate"},e,e)}parseLedgerEntry(e,t){const i=this.safeString(e,"uuid");let s;const r=this.safeValue(e,"meta_data",{}),a=this.safeString(r,"transaction_id");let n=this.safeString(e,"transaction_type");"deposit"===n||"commission_rebate"===n||"referral_bonus"===n||"pnl"===n||"withdrawal_cancellation"===n||"promo_credit"===n?s="in":"withdrawal"!==n&&"commission"!==n&&"conversion"!==n&&"perpetual_futures_funding"!==n||(s="out"),n=this.parseLedgerEntryType(n);const o=this.safeInteger(e,"asset_id"),h=this.safeValue(this.options,"currenciesByNumericId"),d=void 0===(t=this.safeValue(h,o,t))?void 0:t.code,c=this.safeString(e,"amount"),l=this.parse8601(this.safeString(e,"created_at")),u=this.safeString(e,"balance"),f=p.stringMax("0",p.stringSub(u,c));return{info:e,id:i,direction:s,account:undefined,referenceId:a,referenceAccount:undefined,type:n,currency:d,amount:this.parseNumber(c),before:this.parseNumber(f),after:this.parseNumber(u),status:"ok",timestamp:l,datetime:this.iso8601(l),fee:void 0}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={asset_symbol:i.id},r=this.safeStringUpper(t,"network");void 0!==r&&(s.network=this.networkCodeToId(r,e),t=this.omit(t,"network"));const a=await this.privateGetDepositsAddress(this.extend(s,t)),n=this.safeValue(a,"result",{});return this.parseDepositAddress(n,i)}parseDepositAddress(e,t){const i=this.safeString(e,"address"),s=this.safeString(e,"asset_symbol"),r=this.safeString(e,"network");return this.checkAddress(i),{currency:this.safeCurrencyCode(s,t),address:i,tag:this.safeString(e,"memo"),network:this.networkIdToCode(r),info:e}}sign(e,t="public",i="GET",s={},r,a){const n="/"+this.version+"/"+this.implodeParams(e,s);let o=this.urls.api[t]+n;const h=this.omit(s,this.extractParams(e));if("public"===t)Object.keys(h).length&&(o+="?"+this.urlencode(h));else if("private"===t){this.checkRequiredCredentials();const e=this.seconds().toString();r={"api-key":this.apiKey,timestamp:e};let t=i+e+n;if("GET"===i||"DELETE"===i){if(Object.keys(h).length){const e="?"+this.urlencode(h);t+=e,o+=e}}else t+=a=this.json(h),r["Content-Type"]="application/json";const s=this.hmac(this.encode(t),this.encode(this.secret));r.signature=s}return{url:o,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;const c=this.safeValue(o,"error",{}),l=this.safeString(c,"code");if(void 0!==l){const e=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,l,e),this.throwBroadlyMatchedException(this.exceptions.broad,l,e),new r(e)}}}},41680:function(e,t,i){"use strict";const s=i(48819),{TICK_SIZE:r}=i(62115),{AuthenticationError:a,ExchangeError:n,ArgumentsRequired:o,PermissionDenied:h,InvalidOrder:d,OrderNotFound:c,DDoSProtection:l,NotSupported:u,ExchangeNotAvailable:f,InsufficientFunds:p,BadRequest:m,InvalidAddress:g,OnMaintenance:y}=i(73449),b=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"deribit",name:"Deribit",countries:["NL"],version:"v2",userAgent:void 0,rateLimit:50,pro:!0,has:{CORS:!0,spot:!1,margin:!1,swap:!0,future:!0,option:!0,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:!1,createDepositAddress:!0,createOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,editOrder:!0,fetchAccounts:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchDeposit:!1,fetchDepositAddress:!0,fetchDeposits:!0,fetchHistoricalVolatility:!0,fetchIndexOHLCV:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchOrderTrades:!0,fetchPosition:!0,fetchPositionMode:!1,fetchPositions:!0,fetchPremiumIndexOHLCV:!1,fetchStatus:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactions:!1,fetchTransfer:!1,fetchTransfers:!0,fetchWithdrawal:!1,fetchWithdrawals:!0,transfer:!0,withdraw:!0},timeframes:{"1m":"1","3m":"3","5m":"5","10m":"10","15m":"15","30m":"30","1h":"60","2h":"120","3h":"180","6h":"360","12h":"720","1d":"1D"},urls:{test:{rest:"https://test.deribit.com"},logo:"https://user-images.githubusercontent.com/1294454/41933112-9e2dd65a-798b-11e8-8440-5bab2959fcb8.jpg",api:{rest:"https://www.deribit.com"},www:"https://www.deribit.com",doc:["https://docs.deribit.com/v2","https://github.com/deribit"],fees:"https://www.deribit.com/pages/information/fees",referral:{url:"https://www.deribit.com/reg-1189.4038",discount:.1}},api:{public:{get:{auth:1,exchange_token:1,fork_token:1,set_heartbeat:1,disable_heartbeat:1,get_time:1,hello:1,status:1,test:1,subscribe:1,unsubscribe:1,unsubscribe_all:1,get_announcements:1,get_book_summary_by_currency:1,get_book_summary_by_instrument:1,get_contract_size:1,get_currencies:1,get_delivery_prices:1,get_funding_chart_data:1,get_funding_rate_history:1,get_funding_rate_value:1,get_historical_volatility:1,get_index:1,get_index_price:1,get_index_price_names:1,get_instrument:1,get_instruments:1,get_last_settlements_by_currency:1,get_last_settlements_by_instrument:1,get_last_trades_by_currency:1,get_last_trades_by_currency_and_time:1,get_last_trades_by_instrument:1,get_last_trades_by_instrument_and_time:1,get_mark_price_history:1,get_order_book:1,get_trade_volumes:1,get_tradingview_chart_data:1,get_volatility_index_data:1,ticker:1}},private:{get:{logout:1,enable_cancel_on_disconnect:1,disable_cancel_on_disconnect:1,get_cancel_on_disconnect:1,subscribe:1,unsubscribe:1,unsubscribe_all:1,change_api_key_name:1,change_scope_in_api_key:1,change_subaccount_name:1,create_api_key:1,create_subaccount:1,disable_api_key:1,disable_tfa_for_subaccount:1,enable_affiliate_program:1,enable_api_key:1,get_access_log:1,get_account_summary:1,get_affiliate_program_info:1,get_email_language:1,get_new_announcements:1,get_portfolio_margins:1,get_position:1,get_positions:1,get_subaccounts:1,get_subaccounts_details:1,get_transaction_log:1,list_api_keys:1,remove_api_key:1,remove_subaccount:1,reset_api_key:1,set_announcement_as_read:1,set_api_key_as_default:1,set_email_for_subaccount:1,set_email_language:1,set_password_for_subaccount:1,toggle_notifications_from_subaccount:1,toggle_subaccount_login:1,execute_block_trade:4,get_block_trade:1,get_last_block_trades_by_currency:1,invalidate_block_trade_signature:1,verify_block_trade:4,buy:4,sell:4,edit:4,edit_by_label:4,cancel:4,cancel_all:4,cancel_all_by_currency:4,cancel_all_by_instrument:4,cancel_by_label:4,close_position:4,get_margins:1,get_mmp_config:1,get_open_orders_by_currency:1,get_open_orders_by_instrument:1,get_order_history_by_currency:1,get_order_history_by_instrument:1,get_order_margin_by_ids:1,get_order_state:1,get_stop_order_history:1,get_trigger_order_history:1,get_user_trades_by_currency:1,get_user_trades_by_currency_and_time:1,get_user_trades_by_instrument:1,get_user_trades_by_instrument_and_time:1,get_user_trades_by_order:1,reset_mmp:1,set_mmp_config:1,get_settlement_history_by_instrument:1,get_settlement_history_by_currency:1,cancel_transfer_by_id:1,cancel_withdrawal:1,create_deposit_address:1,get_current_deposit_address:1,get_deposits:1,get_transfers:1,get_withdrawals:1,submit_transfer_to_subaccount:1,submit_transfer_to_user:1,withdraw:1}}},exceptions:{9999:h,1e4:a,10001:n,10002:d,10003:d,10004:c,10005:d,10006:d,10007:d,10008:d,10009:p,10010:c,10011:d,10012:d,10013:h,10014:h,10015:h,10016:h,10017:h,10018:h,10019:h,10020:n,10021:d,10022:d,10023:d,10024:d,10025:d,10026:d,10027:d,10028:l,10029:c,10030:n,10031:n,10032:d,10033:u,10034:d,10035:d,10036:d,10040:f,10041:y,10043:d,10044:d,10045:d,10046:d,10047:l,10048:n,11008:d,11029:m,11030:n,11031:n,11035:l,11036:d,11037:m,11038:d,11039:d,11041:d,11042:h,11043:m,11044:d,11045:m,11046:m,11047:m,11048:n,11049:m,11050:m,11051:y,11052:n,11053:n,11090:g,11091:g,11092:g,11093:l,11094:n,11095:n,11096:n,12e3:a,12001:l,12002:n,12998:a,12003:a,12004:a,12005:a,12100:n,12999:a,13e3:a,13001:a,13002:h,13003:a,13004:a,13005:a,13006:a,13007:a,13008:n,13009:a,13010:m,13011:m,13012:h,13013:m,13014:m,13015:m,13016:m,13017:n,13018:n,13019:n,13020:n,13021:h,13025:n,"-32602":m,"-32601":m,"-32700":m,"-32000":m,11054:d},precisionMode:r,options:{code:"BTC",fetchBalance:{code:"BTC"},fetchPositions:{code:"BTC"},transfer:{method:"privateGetSubmitTransferToSubaccount"}}})}async fetchTime(e={}){const t=await this.publicGetGetTime(e);return this.safeInteger(t,"result")}codeFromOptions(e,t={}){const i=this.safeValue(this.options,"code","BTC"),s=this.safeValue(this.options,e,{}),r=this.safeValue(s,"code",i);return this.safeValue(t,"code",r)}async fetchStatus(e={}){const t=await this.publicGetStatus(e),i=this.safeValue(t,"result");return{status:"false"===this.safeString(i,"locked")?"ok":"maintenance",updated:this.safeIntegerProduct(t,"usIn",.001,this.milliseconds()),eta:void 0,url:void 0,info:t}}async fetchAccounts(e={}){await this.loadMarkets();const t=await this.privateGetGetSubaccounts(e),i=this.safeValue(t,"result",[]);return this.parseAccounts(i)}parseAccount(e,t){return{info:e,id:this.safeString(e,"id"),type:this.safeString(e,"type"),code:this.safeCurrencyCode(void 0,t)}}async fetchMarkets(e={}){const t=await this.publicGetGetCurrencies(e),i=this.safeValue(t,"result",[]),s=[];for(let t=0;t<i.length;t++){const r={currency:this.safeString(i[t],"currency")},a=await this.publicGetGetInstruments(this.extend(r,e)),n=this.safeValue(a,"result",[]);for(let e=0;e<n.length;e++){const t=n[e],i=this.safeString(t,"instrument_name"),r=this.safeString(t,"base_currency"),a=this.safeString(t,"counter_currency"),o=this.safeString(t,"settlement_currency"),h=this.safeCurrencyCode(r),d=this.safeCurrencyCode(a),c=this.safeCurrencyCode(o),l=this.safeString(t,"kind"),u="perpetual"===this.safeValue(t,"settlement_period"),f=!u&&l.indexOf("future")>=0,p=l.indexOf("option")>=0,m=l.indexOf("combo")>=0,g=this.safeInteger(t,"expiration_timestamp");let y,b,v=i,w="swap";if(f?w="future":p&&(w="option"),!m&&(v=h+"/"+d+":"+c,(p||f)&&(v=v+"-"+this.yymmdd(g,""),p))){y=this.safeNumber(t,"strike"),b=this.safeString(t,"option_type");const e="call"===b?"C":"P";v=v+"-"+this.numberToString(y)+"-"+e}const S=this.safeNumber(t,"min_trade_amount"),k=this.safeNumber(t,"tick_size");s.push({id:i,symbol:v,base:h,quote:d,settle:c,baseId:r,quoteId:a,settleId:o,type:w,spot:!1,margin:!1,swap:u,future:f,option:p,active:this.safeValue(t,"is_active"),contract:!0,linear:c===d,inverse:c!==d,taker:this.safeNumber(t,"taker_commission"),maker:this.safeNumber(t,"maker_commission"),contractSize:this.safeNumber(t,"contract_size"),expiry:g,expiryDatetime:this.iso8601(g),strike:y,optionType:b,precision:{amount:S,price:k},limits:{leverage:{min:void 0,max:void 0},amount:{min:S,max:void 0},price:{min:k,max:void 0},cost:{min:void 0,max:void 0}},info:t})}}return s}parseBalance(e){const t={info:e},i=this.safeString(e,"currency"),s=this.safeCurrencyCode(i),r=this.account();return r.free=this.safeString(e,"available_funds"),r.used=this.safeString(e,"maintenance_margin"),r.total=this.safeString(e,"equity"),t[s]=r,this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=this.codeFromOptions("fetchBalance",e),i={currency:this.currency(t).id},s=await this.privateGetGetAccountSummary(this.extend(i,e)),r=this.safeValue(s,"result",{});return this.parseBalance(r)}async createDepositAddress(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=await this.privateGetCreateDepositAddress(this.extend(i,t)),r=this.safeValue(s,"result",{}),a=this.safeString(r,"address");return this.checkAddress(a),{currency:e,address:a,tag:void 0,info:s}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=await this.privateGetGetCurrentDepositAddress(this.extend(i,t)),r=this.safeValue(s,"result",{}),a=this.safeString(r,"address");return this.checkAddress(a),{currency:e,address:a,tag:void 0,network:void 0,info:s}}parseTicker(e,t){const i=this.safeInteger2(e,"timestamp","creation_timestamp"),s=this.safeString(e,"instrument_name"),r=this.safeSymbol(s,t),a=this.safeString2(e,"last_price","last"),n=this.safeValue(e,"stats",e);return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString2(n,"high","max_price"),low:this.safeString2(n,"low","min_price"),bid:this.safeString2(e,"best_bid_price","bid_price"),bidVolume:this.safeString(e,"best_bid_amount"),ask:this.safeString2(e,"best_ask_price","ask_price"),askVolume:this.safeString(e,"best_ask_amount"),vwap:void 0,open:void 0,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:void 0,quoteVolume:this.safeString(n,"volume"),info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={instrument_name:i.id},r=await this.publicGetTicker(this.extend(s,t)),a=this.safeValue(r,"result");return this.parseTicker(a,i)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=this.codeFromOptions("fetchTickers",t),s={currency:this.currency(i).id},r=await this.publicGetGetBookSummaryByCurrency(this.extend(s,t)),a=this.safeValue(r,"result",[]),n={};for(let e=0;e<a.length;e++){const t=this.parseTicker(a[e]);n[t.symbol]=t}return this.filterByArray(n,"symbol",e)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={instrument_name:a.id,resolution:this.safeString(this.timeframes,t,t)},o=this.parseTimeframe(t),h=this.milliseconds();void 0===i?(void 0===s&&(s=1e3),n.start_timestamp=h-(s-1)*o*1e3,n.end_timestamp=h):(n.start_timestamp=i,n.end_timestamp=void 0===s?h:this.sum(i,s*o*1e3));const d=await this.publicGetGetTradingviewChartData(this.extend(n,r)),c=this.safeValue(d,"result",{}),l=this.convertTradingViewToOHLCV(c,"ticks","open","high","low","close","volume",!0);return this.parseOHLCVs(l,a,t,i,s)}parseTrade(e,t){const i=this.safeString(e,"trade_id"),s=this.safeString(e,"instrument_name"),r=this.safeSymbol(s,t),a=this.safeInteger(e,"timestamp"),n=this.safeString(e,"direction"),o=this.safeString(e,"price");t=this.safeMarket(s,t);const h=this.safeString(e,"amount");let d=b.stringMul(h,o);t.inverse&&(d=b.stringDiv(h,o));const c=this.safeString(e,"liquidity");let l;void 0!==c&&(l="M"===c?"maker":"taker");const u=this.safeString(e,"fee");let f;if(void 0!==u){const t=this.safeString(e,"fee_currency");f={cost:u,currency:this.safeCurrencyCode(t)}}return this.safeTrade({id:i,info:e,timestamp:a,datetime:this.iso8601(a),symbol:r,order:this.safeString(e,"order_id"),type:this.safeString(e,"order_type"),side:n,takerOrMaker:l,price:o,amount:h,cost:d,fee:f},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={instrument_name:r.id,include_old:!0},n=void 0===t?"publicGetGetLastTradesByInstrument":"publicGetGetLastTradesByInstrumentAndTime";void 0!==t&&(a.start_timestamp=t),void 0!==i&&(a.count=i);const o=await this[n](this.extend(a,s)),h=this.safeValue(o,"result",{}),d=this.safeValue(h,"trades",[]);return this.parseTrades(d,r,t,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=this.codeFromOptions("fetchTradingFees",e),i={currency:this.currency(t).id,extended:!0},s=await this.privateGetGetAccountSummary(this.extend(i,e)),r=this.safeValue(s,"result",{}),a=this.safeValue(r,"fees",[]);let n={},o={},h={};for(let e=0;e<a.length;e++){const t=a[e],i=this.safeString(t,"instrument_type");"future"===i?o={info:t,maker:this.safeNumber(t,"maker_fee"),taker:this.safeNumber(t,"taker_fee")}:"perpetual"===i?n={info:t,maker:this.safeNumber(t,"maker_fee"),taker:this.safeNumber(t,"taker_fee")}:"option"===i&&(h={info:t,maker:this.safeNumber(t,"maker_fee"),taker:this.safeNumber(t,"taker_fee")})}const d={};for(let e=0;e<this.symbols.length;e++){const t=this.symbols[e],i=this.market(t);let s={info:i,symbol:t,percentage:!0,tierBased:!0,maker:i.maker,taker:i.taker};i.swap?s=this.extend(s,n):i.future?s=this.extend(s,o):i.option&&(s=this.extend(s,h)),d[t]=s}return d}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={instrument_name:s.id};void 0!==t&&(r.depth=t);const a=await this.publicGetGetOrderBook(this.extend(r,i)),n=this.safeValue(a,"result",{}),o=this.safeInteger(n,"timestamp"),h=this.safeInteger(n,"change_id"),d=this.parseOrderBook(n,s.symbol,o);return d.nonce=h,d}parseOrderStatus(e){return this.safeString({open:"open",cancelled:"canceled",filled:"closed",rejected:"rejected",untriggered:"open"},e,e)}parseTimeInForce(e){return this.safeString({good_til_cancelled:"GTC",fill_or_kill:"FOK",immediate_or_cancel:"IOC"},e,e)}parseOrderType(e){return this.safeString({stop_limit:"limit",take_limit:"limit",stop_market:"market",take_market:"market"},e,e)}parseOrder(e,t){const i=this.safeString(e,"instrument_name");t=this.safeMarket(i,t);const s=this.safeInteger(e,"creation_timestamp"),r=this.safeInteger(e,"last_update_timestamp"),a=this.safeString(e,"order_id"),n=this.safeString(e,"price"),o=this.safeString(e,"average_price"),h=this.safeString(e,"filled_amount"),d=this.safeString(e,"amount");let c,l=b.stringMul(h,o);if(t.inverse&&0!==this.parseNumber(o)&&(l=b.stringDiv(d,o)),void 0!==h){b.stringGt(h,"0")&&(c=r)}const u=this.parseOrderStatus(this.safeString(e,"order_state")),f=this.safeStringLower(e,"direction");let p,m=this.safeString(e,"commission");void 0!==m&&(m=b.stringAbs(m),p={cost:m,currency:t.base});const g=this.safeString(e,"order_type"),y=this.parseOrderType(g),v=this.safeValue(e,"trades"),w=this.parseTimeInForce(this.safeString(e,"time_in_force")),S=this.safeValue(e,"stop_price"),k=this.safeValue(e,"post_only");return this.safeOrder({info:e,id:a,clientOrderId:void 0,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:c,symbol:t.symbol,type:y,timeInForce:w,postOnly:k,side:f,price:n,stopPrice:S,triggerPrice:S,amount:d,cost:l,average:o,filled:h,remaining:void 0,status:u,fee:p,trades:v},t)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={order_id:e},r=await this.privateGetGetOrderState(this.extend(s,i)),a=this.safeValue(r,"result");return this.parseOrder(a)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);s=n.inverse||"USDC"===n.settle?this.amountToPrecision(e,s):this.currencyToPrecision(e,s);const o={instrument_name:n.id,amount:s,type:t},h=this.safeStringUpper(a,"timeInForce"),c=this.safeValue2(a,"reduceOnly","reduce_only"),l=this.safeValue(a,"stopLossPrice"),u=this.safeValue(a,"takeProfitPrice"),f="stop_limit"===t,p="stop_market"===t,m="take_limit"===t,g="take_market"===t,y=f||p||void 0!==l,b=m||g||void 0!==u;if(y&&b)throw new d(this.id+" createOrder () only allows one of stopLossPrice or takeProfitPrice to be specified");const v=y||b,w="limit"===t||f||m,S="market"===t||p||g,k=this.safeValue(a,"post_only"),T=this.isPostOnly(S,k,a);if(w?(o.type="limit",o.price=this.priceToPrecision(e,r)):o.type="market",v){const t=void 0!==l?l:u;o.trigger_price=this.priceToPrecision(e,t),o.trigger="last_price",o.type=y?S?"stop_market":"stop_limit":S?"take_market":"take_limit"}c&&(o.reduce_only=!0),T&&(o.post_only=!0,o.reject_post_only=!0),void 0!==h&&("GTC"===h&&(o.time_in_force="good_til_cancelled"),"IOC"===h&&(o.time_in_force="immediate_or_cancel"),"FOK"===h&&(o.time_in_force="fill_or_kill"));const _="privateGet"+this.capitalize(i);a=this.omit(a,["timeInForce","stopLossPrice","takeProfitPrice","postOnly","reduceOnly"]);const O=await this[_](this.extend(o,a)),M=this.safeValue(O,"result",{}),I=this.safeValue(M,"order"),x=this.safeValue(M,"trades",[]);return I.trades=x,this.parseOrder(I,n)}async editOrder(e,t,i,s,r,a,n={}){if(void 0===r)throw new o(this.id+" editOrder() requires an amount argument");if(void 0===a)throw new o(this.id+" editOrder() requires a price argument");await this.loadMarkets();const h={order_id:e,amount:this.amountToPrecision(t,r),price:this.priceToPrecision(t,a)},d=await this.privateGetEdit(this.extend(h,n)),c=this.safeValue(d,"result",{}),l=this.safeValue(c,"order"),u=this.safeValue(c,"trades",[]);return l.trades=u,this.parseOrder(l)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={order_id:e},r=await this.privateGetCancel(this.extend(s,i)),a=this.safeValue(r,"result",{});return this.parseOrder(a)}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};let s;if(void 0===e)s="privateGetCancelAll";else{s="privateGetCancelAllByInstrument";const t=this.market(e);i.instrument_name=t.id}return await this[s](this.extend(i,t))}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a,n;if(void 0===e){const e=this.codeFromOptions("fetchOpenOrders",s),t=this.currency(e);r.currency=t.id,n="privateGetGetOpenOrdersByCurrency"}else a=this.market(e),r.instrument_name=a.id,n="privateGetGetOpenOrdersByInstrument";const o=await this[n](this.extend(r,s)),h=this.safeValue(o,"result",[]);return this.parseOrders(h,a,t,i)}async fetchClosedOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a,n;if(void 0===e){const e=this.codeFromOptions("fetchClosedOrders",s),t=this.currency(e);r.currency=t.id,n="privateGetGetOrderHistoryByCurrency"}else a=this.market(e),r.instrument_name=a.id,n="privateGetGetOrderHistoryByInstrument";const o=await this[n](this.extend(r,s)),h=this.safeValue(o,"result",[]);return this.parseOrders(h,a,t,i)}async fetchOrderTrades(e,t,i,s,r={}){await this.loadMarkets();const a={order_id:e},n=await this.privateGetGetUserTradesByOrder(this.extend(a,r)),o=this.safeValue(n,"result",{});return this.parseTrades(o,void 0,i,s)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={include_old:!0};let a,n;if(void 0===e){const e=this.codeFromOptions("fetchMyTrades",s),i=this.currency(e);r.currency=i.id,void 0===t?n="privateGetGetUserTradesByCurrency":(n="privateGetGetUserTradesByCurrencyAndTime",r.start_timestamp=t)}else a=this.market(e),r.instrument_name=a.id,void 0===t?n="privateGetGetUserTradesByInstrument":(n="privateGetGetUserTradesByInstrumentAndTime",r.start_timestamp=t);void 0!==i&&(r.count=i);const o=await this[n](this.extend(r,s)),h=this.safeValue(o,"result",{}),d=this.safeValue(h,"trades",[]);return this.parseTrades(d,a,t,i)}async fetchDeposits(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchDeposits() requires a currency code argument");await this.loadMarkets();const r=this.currency(e),a={currency:r.id};void 0!==i&&(a.count=i);const n=await this.privateGetGetDeposits(this.extend(a,s)),h=this.safeValue(n,"result",{}),d=this.safeValue(h,"data",[]);return this.parseTransactions(d,r,t,i,s)}async fetchWithdrawals(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchWithdrawals() requires a currency code argument");await this.loadMarkets();const r=this.currency(e),a={currency:r.id};void 0!==i&&(a.count=i);const n=await this.privateGetGetWithdrawals(this.extend(a,s)),h=this.safeValue(n,"result",{}),d=this.safeValue(h,"data",[]);return this.parseTransactions(d,r,t,i,s)}parseTransactionStatus(e){return this.safeString({completed:"ok",unconfirmed:"pending"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"currency"),s=this.safeCurrencyCode(i,t),r=this.safeInteger2(e,"created_timestamp","received_timestamp"),a=this.safeInteger(e,"updated_timestamp"),n=this.parseTransactionStatus(this.safeString(e,"state")),o=this.safeString(e,"address"),h=this.safeNumber(e,"fee");let d,c="deposit";return void 0!==h&&(c="withdrawal",d={cost:h,currency:s}),{info:e,id:this.safeString(e,"id"),txid:this.safeString(e,"transaction_id"),timestamp:r,datetime:this.iso8601(r),address:o,addressTo:o,addressFrom:void 0,tag:void 0,tagTo:void 0,tagFrom:void 0,type:c,amount:this.safeNumber(e,"amount"),currency:s,status:n,updated:a,fee:d}}parsePosition(e,t){const i=this.safeString(e,"instrument_name");t=this.safeMarket(i,t);let s=this.safeString(e,"direction");s="buy"===s?"long":"short";const r=this.safeString(e,"floating_profit_loss"),a=this.safeString(e,"initial_margin"),n=this.safeString(e,"size_currency"),o=this.safeString(e,"maintenance_margin"),h=b.stringMul(b.stringDiv(r,a),"100"),d=this.milliseconds();return{info:e,id:void 0,symbol:this.safeString(t,"symbol"),timestamp:d,datetime:this.iso8601(d),initialMargin:this.parseNumber(a),initialMarginPercentage:this.parseNumber(b.stringMul(b.stringDiv(a,n),"100")),maintenanceMargin:this.parseNumber(o),maintenanceMarginPercentage:this.parseNumber(b.stringMul(b.stringDiv(o,n),"100")),entryPrice:this.safeNumber(e,"average_price"),notional:this.parseNumber(n),leverage:this.safeInteger(e,"leverage"),unrealizedPnl:this.parseNumber(r),contracts:void 0,contractSize:this.safeNumber(t,"contractSize"),marginRatio:void 0,liquidationPrice:this.safeNumber(e,"estimated_liquidation_price"),markPrice:this.safeNumber(e,"mark_price"),collateral:void 0,marginMode:void 0,side:s,percentage:this.parseNumber(h)}}async fetchPosition(e,t={}){await this.loadMarkets();const i={instrument_name:this.market(e).id},s=await this.privateGetGetPosition(this.extend(i,t)),r=this.safeValue(s,"result");return this.parsePosition(r)}async fetchPositions(e,t={}){let i;if(await this.loadMarkets(),void 0===e)i=this.codeFromOptions("fetchPositions",t);else if("string"==typeof e)i=e,e=void 0;else if(Array.isArray(e)){if(1!==e.length)throw new m(this.id+" fetchPositions() symbols argument cannot contain more than 1 symbol");i=this.market(e[0]).base}const s={currency:this.currency(i).id},r=await this.privateGetGetPositions(this.extend(s,t)),a=this.safeValue(r,"result");return this.parsePositions(a,e)}async fetchHistoricalVolatility(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=await this.publicGetGetHistoricalVolatility(this.extend(i,t)),r=this.safeValue(s,"result",{}),a=[];for(let e=0;e<r.length;e++){const t=this.safeInteger(r[e],0),i=this.safeNumber(r[e],1);a.push({info:s,timestamp:t,datetime:this.iso8601(t),volatility:i})}return a}async fetchTransfers(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchTransfers() requires a currency code argument");await this.loadMarkets();const r=this.currency(e),a={currency:r.id};void 0!==i&&(a.count=i);const n=await this.privateGetGetTransfers(this.extend(a,s)),h=this.safeValue(n,"result",{}),d=this.safeValue(h,"data",[]);return this.parseTransfers(d,r,t,i,s)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n={amount:t,currency:a.id,destination:s};let o=this.safeString(r,"method");if(r=this.omit(r,"method"),void 0===o){const e=this.safeValue(this.options,"transfer",{});o=this.safeString(e,"method","privateGetSubmitTransferToSubaccount")}const h=await this[o](this.extend(n,r)),d=this.safeValue(h,"result",{});return this.parseTransfer(d,a)}parseTransfer(e,t){const i=this.safeTimestamp(e,"created_timestamp"),s=this.safeString(e,"state"),r=this.safeString(e,"other_side"),a=this.safeString(e,"direction"),n=this.safeString(e,"currency");return{info:e,id:this.safeString(e,"id"),status:this.parseTransferStatus(s),amount:this.safeNumber(e,"amount"),code:this.safeCurrencyCode(n,t),fromAccount:"payment"!==a?r:void 0,toAccount:"payment"===a?r:void 0,timestamp:i,datetime:this.iso8601(i)}}parseTransferStatus(e){return this.safeString({prepared:"pending",confirmed:"ok",cancelled:"cancelled",waiting_for_admin:"pending"},e,e)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={currency:a.id,address:i,amount:t};void 0!==this.twofa&&(n.tfa=this.oath());const o=await this.privateGetWithdraw(this.extend(n,r));return this.parseTransaction(o,a)}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n="/api/"+this.version+"/"+t+"/"+e;if("public"===t&&Object.keys(s).length&&(n+="?"+this.urlencode(s)),"private"===t){this.checkRequiredCredentials();const e=this.nonce().toString(),t=this.milliseconds().toString(),a="";Object.keys(s).length&&(n+="?"+this.urlencode(s));const o=t+"\n"+e+"\n"+(i+"\n"+n+"\n"+a+"\n"),h=this.hmac(this.encode(o),this.encode(this.secret),"sha256");r={Authorization:"deri-hmac-sha256 id="+this.apiKey+",ts="+t+",sig="+h+",nonce="+e}}return{url:this.urls.api.rest+n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,o,h,d){if(!o)return;const c=this.safeValue(o,"error");if(void 0!==c){const e=this.safeString(c,"code"),t=this.id+" "+a;throw this.throwExactlyMatchedException(this.exceptions,e,t),new n(t)}}}},6755:function(e,t,i){"use strict";const s=i(48819),{AccountSuspended:r,BadRequest:a,BadResponse:n,NetworkError:o,NotSupported:h,DDoSProtection:d,AuthenticationError:c,PermissionDenied:l,ExchangeError:u,InsufficientFunds:f,InvalidOrder:p,InvalidNonce:m,OrderNotFound:g,InvalidAddress:y,RateLimitExceeded:b,BadSymbol:v}=i(73449),{TICK_SIZE:w}=i(62115),S=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"digifinex",name:"DigiFinex",countries:["SG"],version:"v3",rateLimit:900,has:{CORS:void 0,spot:!0,margin:!0,swap:!0,future:!1,option:!1,addMargin:!1,cancelOrder:!0,cancelOrders:!0,createOrder:!0,createPostOnlyOrder:!0,createReduceOnlyOrder:!0,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowInterest:!0,fetchBorrowRate:!0,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:!1,fetchFundingRate:!0,fetchFundingRateHistory:!0,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLedger:!0,fetchLeverage:!1,fetchLeverageTiers:!0,fetchMarginMode:!1,fetchMarketLeverageTiers:!0,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!0,fetchPositionMode:!1,fetchPositions:!0,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchStatus:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!1,fetchTransfers:!0,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!0,setMargin:!1,setMarginMode:!1,setPositionMode:!1,transfer:!0,withdraw:!0},timeframes:{"1m":"1","5m":"5","15m":"15","30m":"30","1h":"60","4h":"240","12h":"720","1d":"1D","1w":"1W"},urls:{logo:"https://user-images.githubusercontent.com/51840849/87443315-01283a00-c5fe-11ea-8628-c2a0feaf07ac.jpg",api:{rest:"https://openapi.digifinex.com"},www:"https://www.digifinex.com",doc:["https://docs.digifinex.com"],fees:"https://digifinex.zendesk.com/hc/en-us/articles/360000328422-Fee-Structure-on-DigiFinex",referral:"https://www.digifinex.com/en-ww/from/DhOzBg?channelCode=ljaUPp"},api:{public:{spot:{get:["{market}/symbols","kline","margin/currencies","margin/symbols","markets","order_book","ping","spot/symbols","time","trades","trades/symbols","ticker","currencies"]},swap:{get:["public/api_weight","public/candles","public/candles_history","public/depth","public/funding_rate","public/funding_rate_history","public/instrument","public/instruments","public/ticker","public/tickers","public/time","public/trades"]}},private:{spot:{get:["{market}/financelog","{market}/mytrades","{market}/order","{market}/order/detail","{market}/order/current","{market}/order/history","margin/assets","margin/financelog","margin/mytrades","margin/order","margin/order/current","margin/order/history","margin/positions","otc/financelog","spot/assets","spot/financelog","spot/mytrades","spot/order","spot/order/current","spot/order/history","deposit/address","deposit/history","withdraw/history"],post:["{market}/order/cancel","{market}/order/new","{market}/order/batch_new","margin/order/cancel","margin/order/new","margin/position/close","spot/order/cancel","spot/order/new","transfer","withdraw/new","withdraw/cancel"]},swap:{get:["account/balance","account/positions","account/finance_record","account/trading_fee_rate","account/transfer_record","trade/history_orders","trade/history_trades","trade/open_orders","trade/order_info"],post:["account/leverage","trade/batch_cancel_order","trade/batch_order","trade/cancel_order","trade/order_place"]}}},fees:{trading:{tierBased:!0,percentage:!0,maker:this.parseNumber("0.002"),taker:this.parseNumber("0.002")}},precisionMode:w,exceptions:{exact:{10001:[a,"Wrong request method, please check it's a GET ot POST request"],10002:[c,"Invalid ApiKey"],10003:[c,"Sign doesn't match"],10004:[a,"Illegal request parameters"],10005:[d,"Request frequency exceeds the limit"],10006:[l,"Unauthorized to execute this request"],10007:[l,"IP address Unauthorized"],10008:[m,"Timestamp for this request is invalid, timestamp must within 1 minute"],10009:[o,"Unexist endpoint, please check endpoint URL"],10011:[r,"ApiKey expired. Please go to client side to re-create an ApiKey"],20001:[l,"Trade is not open for this trading pair"],20002:[l,"Trade of this trading pair is suspended"],20003:[p,"Invalid price or amount"],20007:[p,"Price precision error"],20008:[p,"Amount precision error"],20009:[p,"Amount is less than the minimum requirement"],20010:[p,"Cash Amount is less than the minimum requirement"],20011:[f,"Insufficient balance"],20012:[a,"Invalid trade type, valid value: buy/sell)"],20013:[p,"No order info found"],20014:[a,"Invalid date, Valid format: 2018-07-25)"],20015:[a,"Date exceeds the limit"],20018:[l,"Your trading rights have been banned by the system"],20019:[v,'Wrong trading pair symbol. Correct format:"usdt_btc". Quote asset is in the front'],20020:[d,"You have violated the API operation trading rules and temporarily forbid trading. At present, we have certain restrictions on the user's transaction rate and withdrawal rate."],5e4:[u,"Exception error"],20021:[a,"Invalid currency"],20022:[a,"The ending timestamp must be larger than the starting timestamp"],20023:[a,"Invalid transfer type"],20024:[a,"Invalid amount"],20025:[a,"This currency is not transferable at the moment"],20026:[f,"Transfer amount exceed your balance"],20027:[l,"Abnormal account status"],20028:[l,"Blacklist for transfer"],20029:[l,"Transfer amount exceed your daily limit"],20030:[a,"You have no position on this trading pair"],20032:[l,"Withdrawal limited"],20033:[a,"Wrong Withdrawal ID"],20034:[l,"Withdrawal service of this crypto has been closed"],20035:[l,"Withdrawal limit"],20036:[u,"Withdrawal cancellation failed"],20037:[y,"The withdrawal address, Tag or chain type is not included in the withdrawal management list"],20038:[y,"The withdrawal address is not on the white list"],20039:[u,"Can't be canceled in current status"],20040:[b,"Withdraw too frequently; limitation: 3 times a minute, 100 times a day"],20041:[l,"Beyond the daily withdrawal limit"],20042:[v,"Current trading pair does not support API trading"],400002:[a,"Invalid Parameter"]},broad:{}},options:{defaultType:"spot",types:["spot","margin","otc"],accountsByType:{spot:"1",margin:"2",OTC:"3"},networks:{ARBITRUM:"Arbitrum",AVALANCEC:"AVAX-CCHAIN",AVALANCEX:"AVAX-XCHAIN",BEP20:"BEP20",BSC:"BEP20",CARDANO:"Cardano",CELO:"Celo",CHILIZ:"Chiliz",COSMOS:"COSMOS",CRC20:"Crypto.com",CRONOS:"Crypto.com",DOGECOIN:"DogeChain",ERC20:"ERC20",ETH:"ERC20",ETHW:"ETHW",IOTA:"MIOTA",KLAYTN:"KLAY",MATIC:"Polygon",METIS:"MetisDAO",MOONBEAM:"GLMR",MOONRIVER:"Moonriver",OPTIMISM:"OPETH",POLYGON:"Polygon",RIPPLE:"XRP",SOLANA:"SOL",STELLAR:"Stella",TERRACLASSIC:"TerraClassic",TERRA:"Terra",TON:"Ton",TRC20:"TRC20",TRON:"TRC20",TRX:"TRC20",VECHAIN:"Vechain"},networksById:{Arbitrum:"ARBITRUM","AVAX-CCHAIN":"AVALANCEC","AVAX-XCHAIN":"AVALANCEX",BEP20:"BEP20",Cardano:"CARDANO",Celo:"CELO",Chiliz:"CHILIZ",COSMOS:"COSMOS","Crypto.com":"CRC20",DogeChain:"DOGECOIN",ERC20:"ERC20",ETHW:"ETHW",MIOTA:"IOTA",KLAY:"KLAYTN",Polygon:"POLYGON",MetisDAO:"METIS",Moonriver:"MOONRIVER",GLMR:"MOONBEAM",OPETH:"OPTIMISM",XRP:"RIPPLE",SOL:"SOLANA",Stella:"STELLAR",Terra:"TERRA",TerraClassic:"TERRACLASSIC",Ton:"TON",TRC20:"TRC20",Vechain:"VECHAIN"}},commonCurrencies:{BHT:"Black House Test",EPS:"Epanus",FREE:"FreeRossDAO",MBN:"Mobilian Coin",TEL:"TEL666"}})}async fetchCurrencies(e={}){const t=await this.publicSpotGetCurrencies(e),i=this.safeValue(t,"data",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"currency"),a=this.safeCurrencyCode(r),n=this.safeInteger(t,"deposit_status",1)>0,o=this.safeInteger(t,"withdraw_status",1)>0,h=n&&o,d=this.safeString(t,"min_withdraw_fee"),c=this.safeString(t,"min_withdraw_amount"),l=this.safeString(t,"min_deposit_amount"),u=this.parseNumber(l),f=this.parseNumber(c),p=this.parseNumber(d),m=S.stringMin(d,S.stringMin(l,c)),g=this.parseNumber(m),y=this.safeString(t,"chain"),b={info:t,id:y,network:this.networkIdToCode(y),active:h,fee:p,precision:g,deposit:n,withdraw:o,limits:{amount:{min:void 0,max:void 0},withdraw:{min:f,max:void 0},deposit:{min:u,max:void 0}}};a in s?(Array.isArray(s[a].info)?s[a].info.push(t):s[a].info=[s[a].info,t],o&&(s[a].withdraw=!0,s[a].limits.withdraw.min=Math.min(s[a].limits.withdraw.min,f)),n&&(s[a].deposit=!0,s[a].limits.deposit.min=Math.min(s[a].limits.deposit.min,u)),h&&(s[a].active=!0)):s[a]={id:r,code:a,info:t,type:void 0,name:void 0,active:h,deposit:n,withdraw:o,fee:this.parseNumber(d),precision:void 0,limits:{amount:{min:void 0,max:void 0},withdraw:{min:f,max:void 0},deposit:{min:u,max:void 0}},networks:{}},void 0!==y?s[a].networks[y]=b:(s[a].active=h,s[a].fee=this.parseNumber(d),s[a].deposit=n,s[a].withdraw=o,s[a].limits={amount:{min:void 0,max:void 0},withdraw:{min:f,max:void 0},deposit:{min:u,max:void 0}}),s[a].precision=void 0===s[a].precision?g:Math.max(s[a].precision,g)}return s}async fetchMarkets(e={}){const t=this.safeValue(this.options,"fetchMarkets",{}),i=this.safeString(t,"method","fetch_markets_v2");return await this[i](e)}async fetchMarketsV2(e={}){const t=this.safeString(this.options,"defaultType"),[i,s]=this.handleMarginModeAndParams("fetchMarketsV2",e);let r=[this[void 0!==i?"publicSpotGetMarginSymbols":"publicSpotGetTradesSymbols"](s),this.publicSwapGetPublicInstruments(e)];r=await Promise.all(r);const a=r[0],n=r[1],o=this.safeValue(a,"symbol_list",[]),h=this.safeValue(n,"data",[]),d=this.arrayConcat(o,h),c=[];for(let e=0;e<d.length;e++){const s=d[e],r=this.safeString2(s,"symbol","instrument_id"),a=this.safeString2(s,"base_asset","base_currency"),n=this.safeString2(s,"quote_asset","quote_currency"),o=this.safeString(s,"clear_currency"),h=this.safeCurrencyCode(a),l=this.safeCurrencyCode(n),u=this.safeCurrencyCode(o);let f=this.safeInteger(s,"is_allow",1),p="margin"===t?"margin":"spot";const m=void 0===u,g=!m,y=void 0!==i||void 0;let b,v,w=h+"/"+l;if(g){p="swap",w=h+"/"+l+":"+u,b=this.safeValue(s,"is_inverse"),v=!b;this.safeValue(s,"isTrading")&&(f=!0)}c.push({id:r,symbol:w,base:h,quote:l,settle:u,baseId:a,quoteId:n,settleId:o,type:p,spot:m,margin:y,swap:g,future:!1,option:!1,active:!!f,contract:g,linear:v,inverse:b,contractSize:this.safeNumber(s,"contract_value"),expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(s,"amount_precision"))),price:this.parseNumber(this.parsePrecision(this.safeString(s,"price_precision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber2(s,"minimum_amount","min_order_amount"),max:void 0},price:{min:this.safeNumber(s,"tick_size"),max:void 0},cost:{min:this.safeNumber(s,"minimum_value"),max:void 0}},info:s})}return c}async fetchMarketsV1(e={}){const t=await this.publicSpotGetMarkets(e),i=this.safeValue(t,"data",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"market"),[a,n]=r.split("_"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n);s.push({id:r,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:void 0,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{price:this.parseNumber(this.parsePrecision(this.safeString(t,"price_precision"))),amount:this.parseNumber(this.parsePrecision(this.safeString(t,"volume_precision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"min_volume"),max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"min_amount"),max:void 0}},info:t})}return s}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account(),o=this.safeString2(s,"free","avail_balance"),h=this.safeString2(s,"total","equity");n.free=o,n.used=S.stringSub(h,o),n.total=h,t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){let t;await this.loadMarkets(),[t,e]=this.handleMarketTypeAndParams("fetchBalance",void 0,e);let i=this.getSupportedMapping(t,{spot:"privateSpotGetSpotAssets",margin:"privateSpotGetMarginAssets",swap:"privateSwapGetAccountBalance"});const[s,r]=this.handleMarginModeAndParams("fetchBalance",e);void 0!==s&&(i="privateSpotGetMarginAssets",t="margin");const a=await this[i](r),n="swap"===t?"data":"list",o=this.safeValue(a,n,[]);return this.parseBalance(o)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),[r,a]=this.handleMarketTypeAndParams("fetchOrderBook",s,i),n={};let o;"swap"===r?(o="publicSwapGetPublicDepth",n.instrument_id=s.id):(o="publicSpotGetOrderBook",n.symbol=s.id),void 0!==t&&(n.limit=t);const h=await this[o](this.extend(n,a));let d,c;return"swap"===r?(c=this.safeValue(h,"data",{}),d=this.safeInteger(c,"timestamp")):(c=h,d=this.safeTimestamp(h,"date")),this.parseOrderBook(c,s.symbol,d)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=this.safeString(e,0);let s,r;void 0!==i&&(s=this.market(i)),[r,t]=this.handleMarketTypeAndParams("fetchTickers",s,t);let a="publicSpotGetTicker";"swap"===r&&(a="publicSwapGetPublicTickers");const n=await this[a](this.extend({},t)),o={},h=this.safeValue2(n,"ticker","data",[]),d=this.safeInteger(n,"date");for(let e=0;e<h.length;e++){const t=this.extend({date:d},h[e]),i=this.parseTicker(t);o[i.symbol]=i}return this.filterByArray(o,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e);let s="publicSpotGetTicker";const r={};i.swap?(s="publicSwapGetPublicTicker",r.instrument_id=i.id):r.symbol=i.id;const a=await this[s](this.extend(r,t)),n=this.safeInteger(a,"date"),o=this.safeValue(a,"ticker",[]),h=this.safeValue(a,"data",{}),d=this.safeValue(o,0,{});let c;return c=i.swap?h:this.extend({date:n},d),this.parseTicker(c,i)}parseTicker(e,t){const i=this.safeStringUpper2(e,"symbol","instrument_id"),s=this.safeSymbol(i,t);t=this.safeMarket(i);let r=this.safeTimestamp(e,"date");t.swap&&(r=this.safeInteger(e,"timestamp"));const a=this.safeString(e,"last");return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeString2(e,"high","high_24h"),low:this.safeString2(e,"low","low_24h"),bid:this.safeString2(e,"buy","best_bid"),bidVolume:this.safeString(e,"best_bid_size"),ask:this.safeString2(e,"sell","best_ask"),askVolume:this.safeString(e,"best_ask_size"),vwap:void 0,open:this.safeString(e,"open_24h"),close:a,last:a,previousClose:void 0,change:void 0,percentage:this.safeString2(e,"change","price_change_percent"),average:void 0,baseVolume:this.safeString2(e,"vol","volume_24h"),quoteVolume:this.safeString(e,"base_vol"),info:e},t)}parseTrade(e,t){const i=this.safeString2(e,"id","trade_id"),s=this.safeString(e,"order_id"),r=this.safeString(e,"price"),a=this.safeStringN(e,["amount","volume","size"]),n=this.safeStringUpper2(e,"symbol","instrument_id"),o=this.safeSymbol(n,t);void 0===t&&(t=this.safeMarket(n));let h,d,c,l=this.safeTimestamp2(e,"date","timestamp"),u=this.safeString2(e,"type","side");if("swap"===t.type){l=this.safeInteger(e,"trade_time");const t=this.safeString(e,"order_type"),i=this.safeString(e,"match_role"),s=this.safeString(e,"direction");void 0!==t&&(h="0"===t?"limit":void 0),d="1"===i?"taker":"2"===i?"maker":void 0,"1"===u||"1"===s?u="buy":"2"===u||"2"===s||"3"===u||"3"===s?u="sell":"4"!==u&&"4"!==s||(u="buy")}else{const t=u.split("_");u=this.safeString(t,0),h=this.safeString(t,1),void 0===h&&(h="limit");d=this.safeValue(e,"is_maker")?"maker":"taker"}const f=this.safeString(e,"fee");if(void 0!==f){const t=this.safeString(e,"fee_currency");let i;void 0!==t&&(i=this.safeCurrencyCode(t)),c={cost:f,currency:i}}return this.safeTrade({id:i,info:e,timestamp:l,datetime:this.iso8601(l),symbol:o,type:h,order:s,side:u,price:r,amount:a,cost:void 0,takerOrMaker:d,fee:c},t)}async fetchTime(e={}){const t=await this.publicSpotGetTime(e);return this.safeTimestamp(t,"server_time")}async fetchStatus(e={}){const t=await this.publicSpotGetPing(e);return{status:0===this.safeInteger(t,"code")?"ok":"maintenance",updated:void 0,eta:void 0,url:void 0,info:t}}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);let a="publicSpotGetTrades";const n={};r.swap?(a="publicSwapGetPublicTrades",n.instrument_id=r.id):n.symbol=r.id,void 0!==i&&(n.limit=i);const o=await this[a](this.extend(n,s)),h=this.safeValue(o,"data",[]);return this.parseTrades(h,r,t,i)}parseOHLCV(e,t){return t.swap?[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]:[this.safeTimestamp(e,0),this.safeNumber(e,5),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,2),this.safeNumber(e,1)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);let n="publicSpotGetKline";const o={};if(a.swap)n="publicSwapGetPublicCandles",o.instrument_id=a.id,o.granularity=t,void 0!==s&&(o.limit=s);else if(o.symbol=a.id,o.period=this.safeString(this.timeframes,t,t),void 0!==i){const e=parseInt(i/1e3);if(o.start_time=e,void 0!==s){const i=this.parseTimeframe(t);o.end_time=this.sum(e,s*i)}}else if(void 0!==s){const e=this.seconds(),i=this.parseTimeframe(t);o.start_time=this.sum(e,-s*i)}const h=await this[n](this.extend(o,r));let d;if(a.swap){const e=this.safeValue(h,"data",{});d=this.safeValue(e,"candles",[])}else d=this.safeValue(h,"data",[]);return this.parseOHLCVs(d,a,t,i,s)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);let o,h;e=n.symbol,[o,a]=this.handleMarketTypeAndParams("createOrder",n,a);let d=this.getSupportedMapping(o,{spot:"privateSpotPostSpotOrderNew",margin:"privateSpotPostMarginOrderNew",swap:"privateSwapPostTradeOrderPlace"});[h,a]=this.handleMarginModeAndParams("createOrder",a),void 0!==h&&(d="privateSpotPostMarginOrderNew",o="margin");const c={},l="swap"===o,u="market"===t,f="limit"===t;c[l?"instrument_id":"symbol"]=n.id;let p=this.isPostOnly(u,!1,a);if(l){const t=this.safeValue(a,"reduceOnly",!1),n=this.safeString(a,"timeInForce");let o;if("buy"===i){const e=t?4:1;c.type=e}else{const e=t?3:2;c.type=e}f&&(o=0),"FOK"===n?o=u?15:9:"IOC"===n?o=u?13:4:"GTC"===n||u?o=14:"PO"===n&&(p=!0),void 0!==r&&(c.price=this.priceToPrecision(e,r)),c.order_type=o,c.size=s,a=this.omit(a,["reduceOnly","timeInForce"])}else{p=!0===p?1:2,c.market=o;let a="";"market"===t?a="_market":c.price=this.priceToPrecision(e,r),c.type=i+a,c.amount=this.amountToPrecision(e,s)}p&&(c.postOnly=p);const m=this.omit(a,["postOnly","post_only"]),g=await this[d](this.extend(c,m)),y=this.parseOrder(g,n);return this.extend(y,{symbol:e,type:t,side:i,amount:s,price:r})}async cancelOrder(e,t,i={}){let s,r;await this.loadMarkets(),void 0!==t&&(s=this.market(t)),[r,i]=this.handleMarketTypeAndParams("cancelOrder",s,i);let a=this.getSupportedMapping(r,{spot:"privateSpotPostSpotOrderCancel",margin:"privateSpotPostMarginOrderCancel",swap:"privateSwapPostTradeCancelOrder"});const[n,o]=this.handleMarginModeAndParams("cancelOrder",i);void 0!==n&&(a="privateSpotPostMarginOrderCancel",r="margin");const h={order_id:e=e.toString()};"swap"===r?(this.checkRequiredSymbol("cancelOrder",t),h.instrument_id=s.id):h.market=r;const d=await this[a](this.extend(h,o));if("spot"===r||"margin"===r){if(1!==this.safeValue(d,"success",[]).length)throw new g(this.id+" cancelOrder() "+e+" not found")}return d}async cancelOrders(e,t,i={}){await this.loadMarkets();const s=this.safeString(this.options,"defaultType","spot"),r=this.safeString(i,"type",s);i=this.omit(i,"type");const a={market:r,order_id:e.join(",")},n=await this.privateSpotPostCancelOrder(this.extend(a,i));if(this.safeValue(n,"success",[]).length<1)throw new g(this.id+" cancelOrders() error");return n}parseOrderStatus(e){return this.safeString({0:"open",1:"open",2:"closed",3:"canceled",4:"canceled"},e,e)}parseOrder(e,t){let i,s,r,a,n=this.safeString(e,"type");const o=this.safeString2(e,"symbol","instrument_id"),h=this.safeSymbol(o,t,"_");if("swap"===(t=this.market(h)).type){const t=this.safeInteger(e,"order_type");9===t||10===t||11===t||12===t||15===t?r="FOK":1===t||2===t||3===t||4===t||13===t?r="IOC":6!==t&&7!==t&&8!==t&&14!==t||(r="GTC"),a=0===t||1===t||4===t||5===t||9===t||10===t?"limit":"market","1"===n?n="open long":"2"===n?n="open short":"3"===n?n="close long":"4"===n&&(n="close short"),i=this.safeInteger(e,"insert_time"),s=this.safeInteger(e,"time_stamp")}else if(i=this.safeTimestamp(e,"created_date"),s=this.safeTimestamp(e,"finished_date"),void 0!==n){const e=n.split("_");e.length>1?(n=e[0],a=e[1]):a="limit"}return this.safeOrder({info:e,id:this.safeString2(e,"order_id","data"),clientOrderId:void 0,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:s,symbol:h,type:a,timeInForce:r,postOnly:void 0,side:n,price:this.safeNumber(e,"price"),stopPrice:void 0,triggerPrice:void 0,amount:this.safeNumber2(e,"amount","size"),filled:this.safeNumber2(e,"executed_amount","filled_qty"),remaining:void 0,cost:void 0,average:this.safeNumber2(e,"avg_price","price_avg"),status:this.parseOrderStatus(this.safeString2(e,"status","state")),fee:{cost:this.safeNumber(e,"fee")},trades:void 0},t)}async fetchOpenOrders(e,t,i,s={}){let r,a;await this.loadMarkets(),void 0!==e&&(r=this.market(e)),[a,s]=this.handleMarketTypeAndParams("fetchOpenOrders",r,s);let n=this.getSupportedMapping(a,{spot:"privateSpotGetSpotOrderCurrent",margin:"privateSpotGetMarginOrderCurrent",swap:"privateSwapGetTradeOpenOrders"});const[o,h]=this.handleMarginModeAndParams("fetchOpenOrders",s);void 0!==o&&(n="privateSpotGetMarginOrderCurrent",a="margin");const d={},c="swap"===a;if(c?(void 0!==t&&(d.start_timestamp=t),void 0!==i&&(d.limit=i)):d.market=a,void 0!==r){d[c?"instrument_id":"symbol"]=r.id}const l=await this[n](this.extend(d,h)),u=this.safeValue(l,"data",[]);return this.parseOrders(u,r,t,i)}async fetchOrders(e,t,i,s={}){let r,a;await this.loadMarkets(),void 0!==e&&(r=this.market(e)),[a,s]=this.handleMarketTypeAndParams("fetchOrders",r,s);let n=this.getSupportedMapping(a,{spot:"privateSpotGetSpotOrderHistory",margin:"privateSpotGetMarginOrderHistory",swap:"privateSwapGetTradeHistoryOrders"});const[o,h]=this.handleMarginModeAndParams("fetchOrders",s);void 0!==o&&(n="privateSpotGetMarginOrderHistory",a="margin");const d={};if("swap"===a?void 0!==t&&(d.start_timestamp=t):(d.market=a,void 0!==t&&(d.start_time=parseInt(t/1e3))),void 0!==r){d["swap"===a?"instrument_id":"symbol"]=r.id}void 0!==i&&(d.limit=i);const c=await this[n](this.extend(d,h)),l=this.safeValue(c,"data",[]);return this.parseOrders(l,r,t,i)}async fetchOrder(e,t,i={}){let s,r;await this.loadMarkets(),void 0!==t&&(s=this.market(t)),[r,i]=this.handleMarketTypeAndParams("fetchOrder",s,i);let a=this.getSupportedMapping(r,{spot:"privateSpotGetSpotOrder",margin:"privateSpotGetMarginOrder",swap:"privateSwapGetTradeOrderInfo"});const[n,o]=this.handleMarginModeAndParams("fetchOrder",i);void 0!==n&&(a="privateSpotGetMarginOrder",r="margin");const h={order_id:e};"swap"===r?void 0!==s&&(h.instrument_id=s.id):h.market=r;const d=await this[a](this.extend(h,o)),c=this.safeValue(d,"data"),l="swap"===r?c:this.safeValue(c,0);if(void 0===l)throw new g(this.id+" fetchOrder() order "+e.toString()+" not found");return this.parseOrder(l,s)}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets();const a={};let n;void 0!==e&&(r=this.market(e)),[n,s]=this.handleMarketTypeAndParams("fetchMyTrades",r,s);let o=this.getSupportedMapping(n,{spot:"privateSpotGetSpotMytrades",margin:"privateSpotGetMarginMytrades",swap:"privateSwapGetTradeHistoryTrades"});const[h,d]=this.handleMarginModeAndParams("fetchMyTrades",s);void 0!==h&&(o="privateSpotGetMarginMytrades",n="margin"),"swap"===n?void 0!==t&&(a.start_timestamp=t):(a.market=n,void 0!==t&&(a.start_time=parseInt(t/1e3)));void 0!==e&&(a["swap"===n?"instrument_id":"symbol"]=r.id),void 0!==i&&(a.limit=i);const c=await this[o](this.extend(a,d)),l="swap"===n?"data":"list",u=this.safeValue(c,l,[]);return this.parseTrades(u,r,t,i)}parseLedgerEntryType(e){return this.safeString({},e,e)}parseLedgerEntry(e,t){const i=this.parseLedgerEntryType(this.safeString2(e,"type","finance_type")),s=this.safeCurrencyCode(this.safeString2(e,"currency_mark","currency"),t),r=this.safeNumber2(e,"num","change"),a=this.safeNumber(e,"balance");let n=this.safeTimestamp(e,"time");return void 0===n&&(n=this.safeInteger(e,"timestamp")),{info:e,id:void 0,direction:void 0,account:void 0,referenceId:void 0,referenceAccount:void 0,type:i,currency:s,amount:r,before:void 0,after:a,status:void 0,timestamp:n,datetime:this.iso8601(n),fee:void 0}}async fetchLedger(e,t,i,s={}){await this.loadMarkets();const r={};let a;[a,s]=this.handleMarketTypeAndParams("fetchLedger",void 0,s);let n=this.getSupportedMapping(a,{spot:"privateSpotGetSpotFinancelog",margin:"privateSpotGetMarginFinancelog",swap:"privateSwapGetAccountFinanceRecord"});const[o,h]=this.handleMarginModeAndParams("fetchLedger",s);void 0!==o&&(n="privateSpotGetMarginFinancelog",a="margin"),"swap"===a?void 0!==t&&(r.start_timestamp=t):(r.market=a,void 0!==t&&(r.start_time=parseInt(t/1e3)));const d="swap"===a?"currency":"currency_mark";let c;void 0!==e&&(c=this.currency(e),r[d]=c.id),void 0!==i&&(r.limit=i);const l=await this[n](this.extend(r,h));let u;if("swap"===a)u=this.safeValue(l,"data",[]);else{const e=this.safeValue(l,"data",{});u=this.safeValue(e,"finance",[])}return this.parseLedger(u,c,t,i)}parseDepositAddress(e,t){const i=this.safeString(e,"address"),s=this.safeString(e,"addressTag"),r=this.safeStringUpper(e,"currency");return{info:e,currency:this.safeCurrencyCode(r),address:i,tag:s,network:void 0}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=await this.privateSpotGetDepositAddress(this.extend(i,t)),r=this.safeValue(s,"data",[]),a=this.parseDepositAddresses(r),n=this.safeValue(a,e);if(void 0===n)throw new y(this.id+" fetchDepositAddress() did not return an address for "+e+" - create the deposit address in the user settings on the exchange website first.");return n}async fetchTransactionsByType(e,t,i,s,r={}){let a;await this.loadMarkets();const n={};void 0!==t&&(a=this.currency(t),n.currency=a.id),void 0!==s&&(n.size=Math.min(500,s));const o="deposit"===e?"privateSpotGetDepositHistory":"privateSpotGetWithdrawHistory",h=await this[o](this.extend(n,r)),d=this.safeValue(h,"data",[]);return this.parseTransactions(d,a,i,s,{type:e})}async fetchDeposits(e,t,i,s={}){return await this.fetchTransactionsByType("deposit",e,t,i,s)}async fetchWithdrawals(e,t,i,s={}){return await this.fetchTransactionsByType("withdrawal",e,t,i,s)}parseTransactionStatus(e){return this.safeString({1:"pending",2:"pending",3:"ok",4:"failed"},e,e)}parseTransaction(e,t){const i=this.safeString2(e,"id","withdraw_id"),s=this.safeString(e,"address"),r=this.safeString(e,"memo"),a=this.safeString(e,"hash"),n=this.safeStringUpper(e,"currency"),o=this.safeCurrencyCode(n,t),h=this.parse8601(this.safeString(e,"created_date")),d=this.parse8601(this.safeString(e,"finished_date")),c=this.parseTransactionStatus(this.safeString(e,"state")),l=this.safeNumber(e,"amount"),u=this.safeNumber(e,"fee");let f;void 0!==u&&(f={currency:o,cost:u});const p=this.safeString(e,"chain");return{info:e,id:i,txid:a,timestamp:h,datetime:this.iso8601(h),network:p,address:s,addressTo:s,addressFrom:void 0,tag:r,tagTo:r,tagFrom:void 0,type:void 0,amount:l,currency:o,status:c,updated:d,fee:f}}parseTransferStatus(e){return this.safeString({0:"ok"},e,e)}parseTransfer(e,t){let i,s;const r=this.safeInteger(e,"type");1===r?(i="spot",s="swap"):2===r&&(i="swap",s="spot");const a=this.safeInteger(e,"timestamp");return{info:e,id:this.safeString(e,"transfer_id"),timestamp:a,datetime:this.iso8601(a),currency:this.safeCurrencyCode(this.safeString(e,"currency"),t),amount:this.safeNumber(e,"amount"),fromAccount:i,toAccount:s,status:this.parseTransferStatus(this.safeString(e,"code"))}}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n=this.safeValue(this.options,"accountsByType",{}),o=this.safeString(n,i,i),h=this.safeString(n,s,s),d={currency_mark:a.id,num:this.currencyToPrecision(e,t),from:o,to:h},c=await this.privateSpotPostTransfer(this.extend(d,r));return this.parseTransfer(c,a)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={address:i,amount:this.currencyToPrecision(e,t),currency:a.id};void 0!==s&&(n.memo=s);const o=await this.privateSpotPostWithdrawNew(this.extend(n,r));return this.parseTransaction(o,a)}async fetchBorrowInterest(e,t,i,s,r={}){await this.loadMarkets();const a={};let n;void 0!==t&&(n=this.market(t),a.symbol=n.id);const o=await this.privateSpotGetMarginPositions(this.extend(a,r)),h=this.safeValue(o,"positions"),d=this.parseBorrowInterests(h,n);return this.filterByCurrencySinceLimit(d,e,i,s)}parseBorrowInterest(e,t){const i=this.safeString(e,"symbol"),s=this.safeString(e,"amount"),r=this.safeString(e,"leverage_ratio"),a=S.stringDiv(s,r),n=S.stringSub(s,a),o=void 0===t?void 0:t.base;return{account:this.safeSymbol(i,t),currency:o,interest:void 0,interestRate:.001,amountBorrowed:this.parseNumber(n),timestamp:void 0,datetime:void 0,info:e}}async fetchBorrowRate(e,t={}){await this.loadMarkets();const i=await this.privateSpotGetMarginAssets(this.extend({},t)),s=this.safeValue(i,"list",[]);let r=[];for(let t=0;t<s.length;t++){const i=s[t];this.safeString(i,"currency")===e&&(r=i)}const a=this.safeString(r,"currency");return this.parseBorrowRate(r,a)}async fetchBorrowRates(e={}){await this.loadMarkets();const t=await this.privateSpotGetMarginAssets(e),i=this.safeValue(t,"list");return this.parseBorrowRates(i,"currency")}parseBorrowRate(e,t){const i=this.milliseconds(),s=this.safeString(e,"currency");return{currency:this.safeCurrencyCode(s,t),rate:.001,period:864e5,timestamp:i,datetime:this.iso8601(i),info:e}}parseBorrowRates(e,t){const i={};for(let s=0;s<e.length;s++){const r=e[s],a=this.safeString(r,t),n=this.safeCurrencyCode(a),o=this.parseBorrowRate(r,a);i[n]=o}return i}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.swap)throw new v(this.id+" fetchFundingRate() supports swap contracts only");const s={instrument_id:i.id},r=await this.publicSwapGetPublicFundingRate(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseFundingRate(a,i)}parseFundingRate(e,t){const i=this.safeString(e,"instrument_id"),s=this.safeInteger(e,"funding_time"),r=this.safeInteger(e,"next_funding_time");return{info:e,symbol:this.safeSymbol(i,t),markPrice:void 0,indexPrice:void 0,interestRate:void 0,estimatedSettlePrice:void 0,timestamp:void 0,datetime:void 0,fundingRate:this.safeString(e,"funding_rate"),fundingTimestamp:s,fundingDatetime:this.iso8601(s),nextFundingRate:this.safeString(e,"next_funding_rate"),nextFundingTimestamp:r,nextFundingDatetime:this.iso8601(r),previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async fetchFundingRateHistory(e,t,i,s={}){this.checkRequiredSymbol("fetchFundingRateHistory",e),await this.loadMarkets();const r=this.market(e);if(!r.swap)throw new v(this.id+" fetchFundingRateHistory() supports swap contracts only");const a={instrument_id:r.id};void 0!==t&&(a.start_timestamp=t),void 0!==i&&(a.limit=i);const n=await this.publicSwapGetPublicFundingRateHistory(this.extend(a,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"funding_rates",[]),d=[];for(let e=0;e<h.length;e++){const t=h[e],i=this.safeString(o,"instrument_id"),s=this.safeSymbol(i),r=this.safeInteger(t,"time");d.push({info:t,symbol:s,fundingRate:this.safeString(t,"rate"),timestamp:r,datetime:this.iso8601(r)})}const c=this.sortBy(d,"timestamp");return this.filterBySymbolSinceLimit(c,e,t,i)}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.swap)throw new a(this.id+" fetchTradingFee() supports swap markets only");const s={instrument_id:i.id},r=await this.privateSwapGetAccountTradingFeeRate(this.extend(s,t)),n=this.safeValue(r,"data",{});return this.parseTradingFee(n,i)}parseTradingFee(e,t){const i=this.safeString(e,"instrument_id");return{info:e,symbol:this.safeSymbol(i,t),maker:this.safeNumber(e,"maker_fee_rate"),taker:this.safeNumber(e,"taker_fee_rate")}}async fetchPositions(e,t={}){await this.loadMarkets();const i={};let s,r;if(void 0!==(e=this.marketSymbols(e))){let t;if(Array.isArray(e)){if(e.length>1)throw new a(this.id+" fetchPositions() symbols argument cannot contain more than 1 symbol");t=e[0]}else t=e;s=this.market(t)}[r,t]=this.handleMarketTypeAndParams("fetchPositions",s,t);const[n,o]=this.handleMarginModeAndParams("fetchPositions",t);if(void 0!==n&&(r="margin"),void 0!==s){i["swap"===r?"instrument_id":"symbol"]=s.id}const h=this.getSupportedMapping(r,{spot:"privateSpotGetMarginPositions",margin:"privateSpotGetMarginPositions",swap:"privateSwapGetAccountPositions"}),d=await this[h](this.extend(i,o)),c="swap"===r?"data":"positions",l=this.safeValue(d,c,[]),u=[];for(let e=0;e<l.length;e++)u.push(this.parsePosition(l[e],s));return this.filterByArray(u,"symbol",e,!1)}async fetchPosition(e,t={}){await this.loadMarkets();const i=this.market(e),s={};let r;[r,t]=this.handleMarketTypeAndParams("fetchPosition",i,t);const[a,n]=this.handleMarginModeAndParams("fetchPosition",t);void 0!==a&&(r="margin");const o=this.getSupportedMapping(r,{spot:"privateSpotGetMarginPositions",margin:"privateSpotGetMarginPositions",swap:"privateSwapGetAccountPositions"});s["swap"===r?"instrument_id":"symbol"]=i.id;const h=await this[o](this.extend(s,n)),d="swap"===r?"data":"positions",c=this.safeValue(h,d,[]),l=this.parsePosition(c[0],i);return"swap"===r?l:this.extend(l,{collateral:this.safeNumber(h,"margin"),marginRatio:this.safeNumber(h,"margin_rate")})}parsePosition(e,t){const i=this.safeString2(e,"instrument_id","symbol"),s=(t=this.safeMarket(i,t)).symbol;let r=this.safeString(e,"margin_mode");r=void 0!==r?"crossed"===r?"cross":"isolated":"crossed";const a=this.safeInteger(e,"timestamp");let n=this.safeString(e,"side");return"go_long"===n?n="long":"go_short"===n&&(n="short"),{info:e,id:void 0,symbol:s,notional:this.safeNumber(e,"amount"),marginMode:r,liquidationPrice:this.safeNumber(e,"liquidation_price"),entryPrice:this.safeNumber2(e,"avg_cost","entry_price"),unrealizedPnl:this.safeNumber(e,"unrealized_pnl"),contracts:this.safeNumber(e,"avail_position"),contractSize:this.safeNumber(t,"contractSize"),markPrice:this.safeNumber(e,"last"),side:n,hedged:void 0,timestamp:a,datetime:this.iso8601(a),maintenanceMargin:this.safeNumber(e,"margin"),maintenanceMarginPercentage:this.safeNumber(e,"maint_margin_ratio"),collateral:void 0,initialMargin:void 0,initialMarginPercentage:void 0,leverage:this.safeNumber2(e,"leverage","leverage_ratio"),marginRatio:this.safeNumber(e,"margin_ratio"),percentage:void 0}}async setLeverage(e,t,i={}){await this.loadMarkets(),this.checkRequiredSymbol("setLeverage",t);const s=this.market(t);if("swap"!==s.type)throw new v(this.id+" setLeverage() supports swap contracts only");if(e<1||e>100)throw new a(this.id+" leverage should be between 1 and 100");const r={instrument_id:s.id,leverage:e},n=this.safeString2(this.options,"marginMode","defaultMarginMode");let o=this.safeStringLower2(i,"marginMode","defaultMarginMode",n);if(void 0!==o&&(o="cross"===o?"crossed":"isolated",r.margin_mode=o,i=this.omit(i,["marginMode","defaultMarginMode"])),"isolated"===o){const e=this.safeString(i,"side");void 0!==e?(r.side=e,i=this.omit(i,"side")):this.checkRequiredArgument("setLeverage",e,"side",["long","short"])}return await this.privateSwapPostAccountLeverage(this.extend(r,i))}async fetchTransfers(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.safeCurrencyCode(e),a.currency=r.id),void 0!==t&&(a.start_timestamp=t),void 0!==i&&(a.limit=i);const n=await this.privateSwapGetAccountTransferRecord(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTransfers(o,r,t,i)}async fetchLeverageTiers(e,t={}){await this.loadMarkets();const i=await this.publicSwapGetPublicInstruments(t),s=this.safeValue(i,"data",[]);return e=this.marketSymbols(e),this.parseLeverageTiers(s,e,"symbol")}parseLeverageTiers(e,t,i){const s={},r={};for(let i=0;i<e.length;i++){const a=e[i],n=this.safeString(a,"instrument_id"),o=this.safeMarket(n),h=this.safeSymbol(n,o);let d=0;s[h]=this.parseMarketLeverageTiers(e[i],o),void 0!==t&&(d=t.length,this.inArray(h,t)&&(r[h]=this.parseMarketLeverageTiers(e[i],o))),void 0===h||0!==d&&!this.inArray(t,h)||(r[h]=this.parseMarketLeverageTiers(e[i],o))}return r}async fetchMarketLeverageTiers(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.swap)throw new a(this.id+" fetchMarketLeverageTiers() supports swap markets only");const s={instrument_id:i.id},r=await this.publicSwapGetPublicInstrument(this.extend(s,t)),n=this.safeValue(r,"data",{});return this.parseMarketLeverageTiers(n,i)}parseMarketLeverageTiers(e,t){const i=[],s=this.safeValue(e,"open_max_limits",{});for(let r=0;r<s.length;r++){const a=s[r],n=this.safeString(e,"instrument_id");t=this.safeMarket(n),i.push({tier:this.sum(r,1),currency:t.settle,minNotional:void 0,maxNotional:this.safeNumber(a,"max_limit"),maintenanceMarginRate:void 0,maxLeverage:this.safeNumber(a,"leverage"),info:a})}return i}handleMarginModeAndParams(e,t={},i){const s=this.safeString(this.options,"defaultType"),r=this.safeValue(t,"margin",!1);let a;if([a,t]=super.handleMarginModeAndParams(e,t,i),void 0!==a){if("cross"!==a)throw new h(this.id+" only cross margin is supported")}else"margin"!==s&&!0!==r||(a="cross");return[a,t]}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.publicSpotGetCurrencies(t),s=this.safeValue(i,"data");return this.parseDepositWithdrawFees(s,e)}parseDepositWithdrawFees(e,t,i){const s={};t=this.marketCodes(t);for(let i=0;i<e.length;i++){const r=e[i],a=this.safeString(r,"currency"),n=this.safeCurrencyCode(a);if(void 0===t||this.inArray(n,t)){void 0===this.safeValue(s,n)&&(s[n]=this.depositWithdrawFee({}),s[n].info=[]),s[n].info.push(r);const e=this.safeString(r,"chain"),t=this.safeValue(r,"min_withdraw_fee"),i={fee:t,percentage:void 0===t&&void 0},a={fee:void 0,percentage:void 0};if(void 0!==e){const t=this.networkIdToCode(e);s[n].networks[t]={withdraw:i,deposit:a}}else s[n].withdraw=i,s[n].deposit=a}}const r=Object.keys(s);for(let e=0;e<r.length;e++){const t=r[e],i=this.currency(t);s[t]=this.assignDefaultDepositWithdrawFees(s[t],i)}return s}sign(e,t=[],i="GET",s={},r,a){const n="private"===t[0],o="spot"===t[1]?"/v3":"/swap/v2",h=o+("/"+this.implodeParams(e,s));let d=this.urls.api.rest+h;const c=this.omit(s,this.extractParams(e));let l=this.urlencode(this.keysort(c));if(n){let e,t;if("/swap/v2"===o){if(t=this.milliseconds().toString(),e=t+i+h,"GET"===i)l&&(e+="?"+l);else if("POST"===i){const t=JSON.stringify(s);l=t,e+=t}}else t=this.nonce().toString(),e=l;const n=this.hmac(this.encode(e),this.encode(this.secret));"GET"===i?l&&(d+="?"+l):"POST"===i&&(r={"Content-Type":"application/x-www-form-urlencoded"},l&&(a=l)),r={"ACCESS-KEY":this.apiKey,"ACCESS-SIGN":n,"ACCESS-TIMESTAMP":t}}else l&&(d+="?"+l);return{url:d,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,o,h,d){if(!o)return;const c=this.safeString(o,"code");if("0"===c||"200"===c)return;const l=this.id+" "+a;if(void 0===c)throw new n(l);const f=[u,l],[p,m]=this.safeValue(this.exceptions.exact,c,f);throw new p(m)}}},74101:function(e,t,i){"use strict";const s=i(48819),{ArgumentsRequired:r,ExchangeError:a,OrderNotFound:n,AuthenticationError:o,InsufficientFunds:h,InvalidOrder:d,InvalidNonce:c,OnMaintenance:l,RateLimitExceeded:u,BadRequest:f,PermissionDenied:p}=i(73449),{TICK_SIZE:m}=i(62115),g=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"exmo",name:"EXMO",countries:["LT"],rateLimit:350,version:"v1.1",has:{CORS:void 0,spot:!0,margin:!0,swap:!1,future:!1,option:!1,addMargin:!0,cancelOrder:!0,cancelOrders:!1,createDepositAddress:!1,createOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchAccounts:!1,fetchBalance:!0,fetchCanceledOrders:!0,fetchCurrencies:!0,fetchDeposit:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:"emulated",fetchOrderBook:!0,fetchOrderBooks:!0,fetchOrderTrades:!0,fetchPositionMode:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactionFees:!0,fetchTransactions:!0,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!0,fetchWithdrawals:!0,reduceMargin:!0,setMargin:!1,transfer:!1,withdraw:!0},timeframes:{"1m":"1","5m":"5","15m":"15","30m":"30","45m":"45","1h":"60","2h":"120","3h":"180","4h":"240","1d":"D","1w":"W","1M":"M"},urls:{logo:"https://user-images.githubusercontent.com/1294454/27766491-1b0ea956-5eda-11e7-9225-40d67b481b8d.jpg",api:{public:"https://api.exmo.com",private:"https://api.exmo.com",web:"https://exmo.me"},www:"https://exmo.me",referral:"https://exmo.me/?ref=131685",doc:["https://exmo.me/en/api_doc?ref=131685"],fees:"https://exmo.com/en/docs/fees"},api:{web:{get:["ctrl/feesAndLimits","en/docs/fees"]},public:{get:["currency","currency/list/extended","order_book","pair_settings","ticker","trades","candles_history","required_amount","payments/providers/crypto/list"]},private:{post:["user_info","order_create","order_cancel","stop_market_order_create","stop_market_order_cancel","user_open_orders","user_trades","user_cancelled_orders","order_trades","deposit_address","withdraw_crypt","withdraw_get_txid","excode_create","excode_load","code_check","wallet_history","wallet_operations","margin/user/order/create","margin/user/order/update","margin/user/order/cancel","margin/user/position/close","margin/user/position/margin_add","margin/user/position/margin_remove","margin/currency/list","margin/pair/list","margin/settings","margin/funding/list","margin/user/info","margin/user/order/list","margin/user/order/history","margin/user/order/trades","margin/user/order/max_quantity","margin/user/position/list","margin/user/position/margin_remove_info","margin/user/position/margin_add_info","margin/user/wallet/list","margin/user/wallet/history","margin/user/trade/list","margin/trades","margin/liquidation/feed"]}},fees:{trading:{feeSide:"get",tierBased:!0,percentage:!0,maker:this.parseNumber("0.004"),taker:this.parseNumber("0.004")},transaction:{tierBased:!1,percentage:!1}},options:{networks:{ETH:"ERC20",TRX:"TRC20"},fetchTradingFees:{method:"fetchPrivateTradingFees"},margin:{fillResponseFromRequest:!0}},commonCurrencies:{GMT:"GMT Token"},precisionMode:m,exceptions:{exact:{40005:o,40009:c,40015:a,40016:l,40017:o,40032:p,40033:p,40034:u,50052:h,50054:h,50304:n,50173:n,50277:d,50319:d,50321:d,50381:d},broad:{"range period is too long":f,"invalid syntax":f,"API rate limit exceeded":u}}})}async modifyMarginHelper(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={position_id:r.id,quantity:t};let n;"add"===i?n="privatePostMarginUserPositionMarginAdd":"reduce"===i&&(n="privatePostMarginUserPositionMarginReduce");const o=await this[n](this.extend(a,s)),h=this.parseMarginModification(o,r),d=this.safeValue(this.options,"margin",{});return this.safeValue(d,"fillResponseFromRequest",!0)&&(h.type=i,h.amount=t),h}parseMarginModification(e,t){return{info:e,type:void 0,amount:void 0,code:this.safeValue(t,"quote"),symbol:this.safeSymbol(void 0,t),total:void 0,status:"ok"}}async reduceMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,"reduce",i)}async addMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,"add",i)}async fetchTradingFees(e={}){let t=this.safeString(e,"method");if(e=this.omit(e,"method"),void 0===t){const e=this.safeValue(this.options,"fetchTradingFees",{});t=this.safeString(e,"method","fetchPrivateTradingFees")}return await this[t](e)}async fetchPrivateTradingFees(e={}){await this.loadMarkets();const t=await this.privatePostMarginPairList(e),i=this.safeValue(t,"pairs",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"name"),a=this.safeSymbol(r,void 0,"_"),n=this.safeString(t,"trade_maker_fee"),o=this.safeString(t,"trade_taker_fee"),h=this.parseNumber(g.stringDiv(n,"100")),d=this.parseNumber(g.stringDiv(o,"100"));s[a]={info:t,symbol:a,maker:h,taker:d,percentage:!0,tierBased:!0}}return s}async fetchPublicTradingFees(e={}){await this.loadMarkets();const t=await this.publicGetPairSettings(e),i={};for(let e=0;e<this.symbols.length;e++){const s=this.symbols[e],r=this.market(s),a=this.safeValue(t,r.id,{}),n=this.safeString(a,"commission_maker_percent"),o=this.safeString(a,"commission_taker_percent"),h=this.parseNumber(g.stringDiv(n,"100")),d=this.parseNumber(g.stringDiv(o,"100"));i[s]={info:a,symbol:s,maker:h,taker:d,percentage:!0,tierBased:!0}}return i}parseFixedFloatValue(e){if(void 0===e||"-"===e)return;if(""===e)return 0;const t=e.indexOf("%")>=0,i=e.split(" ")[0].replace("%",""),s=parseFloat(i);if(s>0&&t)throw new a(this.id+" parseFixedFloatValue() detected an unsupported non-zero percentage-based fee "+e);return s}async fetchTransactionFees(e,t={}){await this.loadMarkets();const i=await this.publicGetPaymentsProvidersCryptoList(t),s={},r=Object.keys(i);for(let t=0;t<r.length;t++){const a=r[t];if(void 0!==e&&!this.inArray(a,e))continue;s[a]={deposit:void 0,withdraw:void 0};const n=this.currency(a),o=this.safeString(n,"id"),h=this.safeValue(i,o,[]);for(let e=0;e<h.length;e++){const t=h[e],i=this.safeString(t,"type"),r=this.safeString(t,"commission_desc"),n=this.parseFixedFloatValue(r);s[a][i]=n}s[a].info=h}return this.options.transactionFees=s,s}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.publicGetPaymentsProvidersCryptoList(t),s=this.parseDepositWithdrawFees(i,e);return this.options.transactionFees=s,s}parseDepositWithdrawFee(e,t){const i=this.depositWithdrawFee(e);for(let s=0;s<e.length;s++){const r=e[s],a=this.safeString(r,"type"),n=this.safeString(r,"name"),o=this.networkIdToCode(n,this.safeString(t,"code")),h=this.safeString(r,"commission_desc");let d,c=[];if(void 0!==h){c=h.split("%");d=c.length>=2}void 0===this.safeValue(i.networks,o)&&(i.networks[o]={withdraw:{fee:void 0,percentage:void 0},deposit:{fee:void 0,percentage:void 0}}),i.networks[o][a]={fee:this.parseFixedFloatValue(this.safeString(c,0)),percentage:d}}return this.assignDefaultDepositWithdrawFees(i)}async fetchCurrencies(e={}){const t=await this.publicGetCurrencyListExtended(e),i=await this.publicGetPaymentsProvidersCryptoList(e),s={};for(let e=0;e<t.length;e++){const r=t[e],a=this.safeString(r,"name"),n=this.safeString(r,"description"),o=this.safeValue(i,a);let h=!1,d="crypto";const c={deposit:{min:void 0,max:void 0},withdraw:{min:void 0,max:void 0}};let l,u,f;if(void 0===o)h=!0,d="fiat";else for(let e=0;e<o.length;e++){const t=o[e],i=this.safeString(t,"type"),s=this.safeNumber(t,"min");let r=this.safeNumber(t,"max");0===r&&(r=void 0);const a=this.safeValue(t,"enabled");if("deposit"===i?a&&!u?u=!0:a||(u=!1):"withdraw"===i&&(a&&!f?f=!0:a||(f=!1)),a&&(h=!0,(void 0===c[i].min||s<c[i].min)&&(c[i].min=s,c[i].max=r,"withdraw"===i))){const e=this.safeString(t,"commission_desc");l=this.parseFixedFloatValue(e)}}const p=this.safeCurrencyCode(a);s[p]={id:a,code:p,name:n,type:d,active:h,deposit:u,withdraw:f,fee:l,precision:this.parseNumber("1e-8"),limits:c,info:o}}return s}async fetchMarkets(e={}){const t=await this.publicGetPairSettings(e),i=Object.keys(t),s=[];for(let e=0;e<i.length;e++){const r=i[e],a=t[r],n=r.replace("_","/"),[o,h]=n.split("/"),d=this.safeCurrencyCode(o),c=this.safeCurrencyCode(h),l=this.safeString(a,"commission_taker_percent"),u=this.safeString(a,"commission_maker_percent");s.push({id:r,symbol:n,base:d,quote:c,settle:void 0,baseId:o,quoteId:h,settleId:void 0,type:"spot",spot:!0,margin:!0,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,taker:this.parseNumber(g.stringDiv(l,"100")),maker:this.parseNumber(g.stringDiv(u,"100")),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber("1e-8"),price:this.parseNumber(this.parsePrecision(this.safeString(a,"price_precision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(a,"min_quantity"),max:this.safeNumber(a,"max_quantity")},price:{min:this.safeNumber(a,"min_price"),max:this.safeNumber(a,"max_price")},cost:{min:this.safeNumber(a,"min_amount"),max:this.safeNumber(a,"max_amount")}},info:a})}return s}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,resolution:this.safeString(this.timeframes,t,t)},o=this.safeValue(this.options,"fetchOHLCV"),h=this.safeInteger(o,"maxLimit",3e3),d=this.parseTimeframe(t),c=this.milliseconds();if(void 0===i)void 0===s&&(s=1e3),s>h&&(s=h),n.from=parseInt(c/1e3)-s*d-1,n.to=parseInt(c/1e3);else if(n.from=parseInt(i/1e3)-1,void 0===s)n.to=parseInt(c/1e3);else{if(s>h)throw new f(this.id+" fetchOHLCV() will serve "+h.toString()+" candles at most");const e=this.sum(i,s*d*1e3);n.to=parseInt(e/1e3)}const l=await this.publicGetCandlesHistory(this.extend(n,r)),u=this.safeValue(l,"candles",[]);return this.parseOHLCVs(u,a,t,i,s)}parseOHLCV(e,t){return[this.safeInteger(e,"t"),this.safeNumber(e,"o"),this.safeNumber(e,"h"),this.safeNumber(e,"l"),this.safeNumber(e,"c"),this.safeNumber(e,"v")]}parseBalance(e){const t={info:e},i=this.safeValue(e,"balances",{}),s=this.safeValue(e,"reserved",{}),r=Object.keys(i);for(let e=0;e<r.length;e++){const a=r[e],n=this.safeCurrencyCode(a),o=this.account();a in i&&(o.free=this.safeString(i,a)),a in s&&(o.used=this.safeString(s,a)),t[n]=o}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostUserInfo(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={pair:s.id};void 0!==t&&(r.limit=t);const a=await this.publicGetOrderBook(this.extend(r,i)),n=this.safeValue(a,s.id);return this.parseOrderBook(n,s.symbol,void 0,"bid","ask")}async fetchOrderBooks(e,t,i={}){let s;if(await this.loadMarkets(),void 0===e){if(s=this.ids.join(","),s.length>2048){const e=this.ids.length;throw new a(this.id+" fetchOrderBooks() has "+e.toString()+" symbols exceeding max URL length, you are required to specify a list of symbols in the first argument to fetchOrderBooks")}}else s=this.marketIds(e),s=s.join(",");const r={pair:s};void 0!==t&&(r.limit=t);const n=await this.publicGetOrderBook(this.extend(r,i)),o={},h=Object.keys(n);for(let e=0;e<h.length;e++){const t=h[e],i=this.safeSymbol(t);o[i]=this.parseOrderBook(n[t],i,void 0,"bid","ask")}return o}parseTicker(e,t){const i=this.safeTimestamp(e,"updated");t=this.safeMarket(void 0,t);const s=this.safeString(e,"last_trade");return this.safeTicker({symbol:t.symbol,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"buy_price"),bidVolume:void 0,ask:this.safeString(e,"sell_price"),askVolume:void 0,vwap:void 0,open:void 0,close:s,last:s,previousClose:void 0,change:void 0,percentage:void 0,average:this.safeString(e,"avg"),baseVolume:this.safeString(e,"vol"),quoteVolume:this.safeString(e,"vol_curr"),info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetTicker(t),s={},r=Object.keys(i);for(let e=0;e<r.length;e++){const t=r[e],a=this.safeMarket(t,void 0,"_"),n=a.symbol,o=this.safeValue(i,t);s[n]=this.parseTicker(o,a)}return this.filterByArray(s,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=await this.publicGetTicker(t),s=this.market(e);return this.parseTicker(i[s.id],s)}parseTrade(e,t){const i=this.safeTimestamp(e,"date"),s=this.safeString(e,"trade_id"),r=this.safeString(e,"order_id"),a=this.safeString(e,"price"),n=this.safeString(e,"quantity"),o=this.safeString(e,"amount"),h=this.safeString(e,"type"),d=this.safeString(e,"pair"),c=(t=this.safeMarket(d,t,"_")).symbol,l=this.safeString(e,"exec_type");let u;const f=this.safeString(e,"commission_amount");if(void 0!==f){const t=this.safeString(e,"commission_currency"),i=this.safeCurrencyCode(t);let s=this.safeString(e,"commission_percent");void 0!==s&&(s=g.stringDiv(s,"1000",18)),u={cost:f,currency:i,rate:s}}return this.safeTrade({id:s,info:e,timestamp:i,datetime:this.iso8601(i),symbol:c,order:r,type:undefined,side:h,takerOrMaker:l,price:a,amount:n,cost:o,fee:u},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pair:r.id},n=await this.publicGetTrades(this.extend(a,s)),o=this.safeValue(n,r.id,[]);return this.parseTrades(o,r,t,i)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new r(this.id+" fetchMyTrades() requires a symbol argument (a single symbol or an array)");let a,n;if(await this.loadMarkets(),Array.isArray(e)){if(e.length<1)throw new r(this.id+" fetchMyTrades() requires a non-empty symbol array");a=this.marketIds(e).join(",")}else n=this.market(e),a=n.id;const o={pair:a};void 0!==i&&(o.limit=i);const h=await this.privatePostUserTrades(this.extend(o,s));let d=[];const c=Object.keys(h);for(let e=0;e<c.length;e++){const s=c[e],r=this.safeMarket(s,void 0,"_"),a=h[s],n=this.parseTrades(a,r,t,i);d=this.arrayConcat(d,n)}return this.filterBySinceLimit(d,t,i)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=("market"===t?t+"_":"")+i;let h=r;"market"===t&&void 0===r&&(h=0);const c={pair:n.id,quantity:this.amountToPrecision(n.symbol,s),type:o,price:this.priceToPrecision(n.symbol,h)};let l="privatePostOrderCreate",u=this.safeValue2(a,"client_id","clientOrderId");if(void 0!==u){if(u=this.safeInteger2(a,"client_id","clientOrderId"),void 0===u)throw new f(this.id+" createOrder() client order id must be an integer / numeric literal");c.client_id=u,a=this.omit(a,["client_id","clientOrderId"])}if("stop"===t||"stop_limit"===t||"trailing_stop"===t){const i=this.safeNumber2(a,"stop_price","stopPrice");if(void 0===i)throw new d(this.id+" createOrder() requires a stopPrice extra param for a "+t+" order");a=this.omit(a,["stopPrice","stop_price"]),c.stop_price=this.priceToPrecision(e,i),l="privatePostMarginUserOrderCreate"}const p=await this[l](this.extend(c,a)),m=this.safeString(p,"order_id"),g=this.milliseconds();return{id:m,info:p,timestamp:g,datetime:this.iso8601(g),lastTradeTimestamp:void 0,status:"open",symbol:n.symbol,type:t,side:i,price:r,cost:void 0,amount:s,remaining:s,filled:0,fee:void 0,trades:void 0,clientOrderId:u,average:void 0}}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={order_id:e};return await this.privatePostOrderCancel(this.extend(s,i))}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={order_id:e.toString()},r=await this.privatePostOrderTrades(this.extend(s,i)),a=this.parseOrder(r);return this.extend(a,{id:e.toString()})}async fetchOrderTrades(e,t,i,s,r={}){let a;void 0!==t&&(a=this.market(t));const n={order_id:e.toString()},o=await this.privatePostOrderTrades(this.extend(n,r)),h=this.safeValue(o,"trades");return this.parseTrades(h,a,i,s)}async fetchOpenOrders(e,t,i,s={}){if(await this.loadMarkets(),void 0!==e){e=this.market(e).symbol}const r=await this.privatePostUserOpenOrders(s),a=Object.keys(r);let n=[];for(let e=0;e<a.length;e++){const t=a[e],i=this.safeMarket(t),s=this.parseOrders(r[t],i);n=this.arrayConcat(n,s)}return this.filterBySymbolSinceLimit(n,e,t,i)}parseOrder(e,t){const i=this.safeString(e,"order_id"),s=this.safeTimestamp(e,"created"),r=this.safeString(e,"type");let a;"pair"in e?a=e.pair:"in_currency"in e&&"out_currency"in e&&(a="buy"===r?e.in_currency+"_"+e.out_currency:e.out_currency+"_"+e.in_currency);const n=(t=this.safeMarket(a,t)).symbol;let o=this.safeString(e,"quantity");if(void 0===o){const t="buy"===r?"in_amount":"out_amount";o=this.safeString(e,t)}const h=this.safeString(e,"price"),d=this.safeString(e,"amount"),c=this.safeValue(e,"trades",[]),l=this.safeInteger(e,"client_id");return this.safeOrder({id:i,clientOrderId:l,datetime:this.iso8601(s),timestamp:s,lastTradeTimestamp:void 0,status:void 0,symbol:n,type:"limit",timeInForce:void 0,postOnly:void 0,side:r,price:h,stopPrice:void 0,triggerPrice:void 0,cost:d,amount:o,filled:void 0,remaining:void 0,average:void 0,trades:c,fee:void 0,info:e},t)}async fetchCanceledOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==t&&(r.offset=i),void 0!==i&&(r.limit=i),void 0!==e&&(a=this.market(e));const n=await this.privatePostUserCancelledOrders(this.extend(r,s));return this.parseOrders(n,a,t,i,s)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=await this.privatePostDepositAddress(t),s=this.safeString(i,e);let r,a;if(s){const e=s.split(",");r=e[0];e.length>1&&(a=e[1])}return this.checkAddress(r),{currency:e,address:r,tag:a,network:void 0,info:i}}getMarketFromTrades(e){const t=this.indexBy(e,"pair"),i=Object.keys(t);if(1===i.length)return this.markets[i[0]]}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets();const a=this.currency(e),n={amount:t,currency:a.id,address:i};void 0!==s&&(n.invoice=s);const o=this.safeValue(this.options,"networks",{});let h=this.safeStringUpper(r,"network");h=this.safeString(o,h,h),void 0!==h&&(n.transport=h,r=this.omit(r,"network"));const d=await this.privatePostWithdrawCrypt(this.extend(n,r));return this.parseTransaction(d,a)}parseTransactionStatus(e){return this.safeString({transferred:"ok",paid:"ok",pending:"pending",processing:"pending",verifying:"pending"},e,e)}parseTransaction(e,t){const i=this.safeTimestamp2(e,"dt","created");let s=this.safeString(e,"amount");void 0!==s&&(s=g.stringAbs(s));let r=this.safeString(e,"txid");if(void 0===r){const t=this.safeValue(e,"extra",{}),i=this.safeString(t,"txid");""!==i&&(r=i)}const a=this.safeString(e,"type"),n=this.safeString2(e,"curr","currency"),o=this.safeCurrencyCode(n,t);let h,d;const c=this.safeString(e,"account");if("deposit"===a)d=c;else if("withdrawal"===a&&(h=c,void 0!==h)){const e=h.split(":");2===e.length&&(h=this.safeString(e,1),h=h.replace(" ",""))}const l={currency:void 0,cost:void 0,rate:void 0};if(!this.fees.transaction.percentage){const t="withdrawal"===a?"withdraw":"deposit";let i=this.safeString(e,"commission");if(void 0===i){const e=this.safeValue(this.options,"transactionFees",{}),s=this.safeValue(e,o,{});i=this.safeString(s,t)}"cashback"===this.safeString(e,"provider")&&(i="0"),void 0!==i&&("withdrawal"===a&&(s=g.stringSub(s,i)),l.cost=this.parseNumber(i),l.currency=o)}return{info:e,id:this.safeString2(e,"order_id","task_id"),txid:r,type:a,currency:o,network:this.safeString(e,"provider"),amount:s,status:this.parseTransactionStatus(this.safeStringLower(e,"status")),timestamp:i,datetime:this.iso8601(i),address:h,addressFrom:void 0,addressTo:h,tag:void 0,tagFrom:void 0,tagTo:void 0,updated:this.safeTimestamp(e,"updated"),comment:d,fee:l}}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==t&&(r.date=parseInt(t/1e3)),void 0!==e&&(a=this.currency(e));const n=await this.privatePostWalletHistory(this.extend(r,s));return this.parseTransactions(n.history,a,t,i)}async fetchWithdrawals(e,t,i,s={}){let r;await this.loadMarkets();const a={type:"withdraw"};void 0!==i&&(a.limit=i),void 0!==e&&(r=this.currency(e),a.currency=r.id);const n=await this.privatePostWalletOperations(this.extend(a,s)),o=this.safeValue(n,"items",[]);return this.parseTransactions(o,r,t,i)}async fetchWithdrawal(e,t,i={}){let s;await this.loadMarkets();const r={order_id:e,type:"withdraw"};void 0!==t&&(s=this.currency(t),r.currency=s.id);const a=await this.privatePostWalletOperations(this.extend(r,i)),n=this.safeValue(a,"items",[]),o=this.safeValue(n,0,{});return this.parseTransaction(o,s)}async fetchDeposit(e,t,i={}){let s;await this.loadMarkets();const r={order_id:e,type:"deposit"};void 0!==t&&(s=this.currency(t),r.currency=s.id);const a=await this.privatePostWalletOperations(this.extend(r,i)),n=this.safeValue(a,"items",[]),o=this.safeValue(n,0,{});return this.parseTransaction(o,s)}async fetchDeposits(e,t,i,s={}){let r;await this.loadMarkets();const a={type:"deposit"};void 0!==i&&(a.limit=i),void 0!==e&&(r=this.currency(e),a.currency=r.id);const n=await this.privatePostWalletOperations(this.extend(a,s)),o=this.safeValue(n,"items",[]);return this.parseTransactions(o,r,t,i)}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t]+"/";if("web"!==t&&(n+=this.version+"/"),n+=e,"public"===t||"web"===t)Object.keys(s).length&&(n+="?"+this.urlencode(s));else if("private"===t){this.checkRequiredCredentials();const e=this.nonce();a=this.urlencode(this.extend({nonce:e},s)),r={"Content-Type":"application/x-www-form-urlencoded",Key:this.apiKey,Sign:this.hmac(this.encode(a),this.encode(this.secret),"sha512")}}return{url:n,method:i,body:a,headers:r}}nonce(){return this.milliseconds()}handleErrors(e,t,i,s,r,n,o,h,d){if(void 0!==o&&("result"in o||"errmsg"in o)){let e=this.safeValue(o,"result",!1);if("string"==typeof e&&(e="true"===e||"1"===e),!e){let e;const t=this.safeString2(o,"error","errmsg"),i=t.split(":");if(i.length>1){const t=i[0].split(" ");e=t.length>1?t[1]:t[0]}const s=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,e,s),this.throwBroadlyMatchedException(this.exceptions.broad,t,s),new a(s)}}}}},63513:function(e,t,i){"use strict";const s=i(61985);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"flowbtc",name:"flowBTC",countries:["BR"],rateLimit:1e3,urls:{logo:"https://user-images.githubusercontent.com/51840849/87443317-01c0d080-c5fe-11ea-95c2-9ebe1a8fafd9.jpg",api:{public:"https://api.flowbtc.com.br:8443/ap/",private:"https://api.flowbtc.com.br:8443/ap/"},www:"https://www.flowbtc.com.br",doc:"https://www.flowbtc.com.br/api.html"},fees:{trading:{tierBased:!1,percentage:!0,maker:.0025,taker:.005}}})}}},98161:function(e,t,i){"use strict";const s=i(28267);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"fmfwio",name:"FMFW.io",countries:["KN"],urls:{logo:"https://user-images.githubusercontent.com/1294454/159177712-b685b40c-5269-4cea-ac83-f7894c49525d.jpg",api:{public:"https://api.fmfw.io",private:"https://api.fmfw.io"},www:"https://fmfw.io",doc:"https://api.fmfw.io/api/2/explore/",fees:"https://fmfw.io/fees-and-limits",referral:"https://fmfw.io/referral/da948b21d6c92d69"},fees:{trading:{maker:this.parseNumber("0.005"),taker:this.parseNumber("0.005")}}})}}},53927:function(e,t,i){"use strict";const s=i(48819),r=i(6832),{TICK_SIZE:a}=i(62115),{ExchangeError:n,BadRequest:o,ArgumentsRequired:h,AuthenticationError:d,PermissionDenied:c,AccountSuspended:l,InsufficientFunds:u,RateLimitExceeded:f,ExchangeNotAvailable:p,BadSymbol:m,InvalidOrder:g,OrderNotFound:y,NotSupported:b,AccountNotEnabled:v,OrderImmediatelyFillable:w,BadResponse:S}=i(73449);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"gate",name:"Gate.io",countries:["KR"],rateLimit:10/3,version:"v4",certified:!0,pro:!0,urls:{logo:"https://user-images.githubusercontent.com/1294454/31784029-0313c702-b509-11e7-9ccc-bc0da6a0e435.jpg",doc:"https://www.gate.io/docs/apiv4/en/index.html",www:"https://gate.io/",api:{public:{wallet:"https://api.gateio.ws/api/v4",futures:"https://api.gateio.ws/api/v4",margin:"https://api.gateio.ws/api/v4",delivery:"https://api.gateio.ws/api/v4",spot:"https://api.gateio.ws/api/v4",options:"https://api.gateio.ws/api/v4",sub_accounts:"https://api.gateio.ws/api/v4"},private:{withdrawals:"https://api.gateio.ws/api/v4",wallet:"https://api.gateio.ws/api/v4",futures:"https://api.gateio.ws/api/v4",margin:"https://api.gateio.ws/api/v4",delivery:"https://api.gateio.ws/api/v4",spot:"https://api.gateio.ws/api/v4",options:"https://api.gateio.ws/api/v4",subAccounts:"https://api.gateio.ws/api/v4"}},test:{public:{futures:"https://fx-api-testnet.gateio.ws/api/v4",delivery:"https://fx-api-testnet.gateio.ws/api/v4"},private:{futures:"https://fx-api-testnet.gateio.ws/api/v4",delivery:"https://fx-api-testnet.gateio.ws/api/v4"}},referral:{url:"https://www.gate.io/ref/2436035",discount:.2}},has:{CORS:void 0,spot:!0,margin:!0,swap:!0,future:!0,option:void 0,addMargin:!0,borrowMargin:!0,cancelAllOrders:!0,cancelOrder:!0,createDepositAddress:!0,createMarketOrder:!1,createOrder:!0,createPostOnlyOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!1,createStopOrder:!0,editOrder:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:!0,fetchFundingRate:!0,fetchFundingRateHistory:!0,fetchFundingRates:!0,fetchIndexOHLCV:!0,fetchLeverage:!1,fetchLeverageTiers:!0,fetchMarginMode:!1,fetchMarketLeverageTiers:"emulated",fetchMarkets:!0,fetchMarkOHLCV:!0,fetchMyTrades:!0,fetchNetworkDepositAddress:!0,fetchOHLCV:!0,fetchOpenInterest:!1,fetchOpenInterestHistory:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPositionMode:!1,fetchPositions:!0,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!1,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!0,fetchTransactionFees:!0,fetchWithdrawals:!0,reduceMargin:!0,repayMargin:!0,setLeverage:!0,setMarginMode:!1,transfer:!0,withdraw:!0},api:{public:{wallet:{get:{currency_chains:1.5}},spot:{get:{currencies:1,"currencies/{currency}":1,currency_pairs:1,"currency_pairs/{currency_pair}":1,tickers:1,order_book:1,trades:1,candlesticks:1}},margin:{get:{currency_pairs:1,"currency_pairs/{currency_pair}":1,"cross/currencies":1,"cross/currencies/{currency}":1,funding_book:1}},futures:{get:{"{settle}/contracts":1.5,"{settle}/contracts/{contract}":1.5,"{settle}/order_book":1.5,"{settle}/trades":1.5,"{settle}/candlesticks":1.5,"{settle}/tickers":1.5,"{settle}/funding_rate":1.5,"{settle}/insurance":1.5,"{settle}/contract_stats":1.5,"{settle}/liq_orders":1.5}},delivery:{get:{"{settle}/contracts":1.5,"{settle}/contracts/{contract}":1.5,"{settle}/order_book":1.5,"{settle}/trades":1.5,"{settle}/candlesticks":1.5,"{settle}/tickers":1.5,"{settle}/insurance":1.5}},options:{get:{underlyings:1.5,expirations:1.5,contracts:1.5,"contracts/{contract}":1.5,settlements:1.5,"settlements/{contract}":1.5,order_book:1.5,tickers:1.5,"underlying/tickers/{underlying}":1.5,candlesticks:1.5,"underlying/candlesticks":1.5,trades:1.5}}},private:{withdrawals:{post:{withdrawals:3e3},delete:{"withdrawals/{withdrawal_id}":300}},wallet:{get:{deposit_address:300,withdrawals:300,deposits:300,sub_account_transfers:300,withdraw_status:300,sub_account_balances:300,fee:300,total_balance:300},post:{transfers:300,sub_account_transfers:300}},subAccounts:{get:{sub_accounts:1,"sub_accounts/{user_id}":1,"sub_accounts/{user_id}/keys":1,"sub_accounts/{user_id}/keys/{key}":1},post:{sub_accounts:1,"sub_accounts/{user_id}/keys":1,"sub_accounts/{user_id}/lock":1,"sub_accounts/{user_id}/unlock":1},put:{"sub_accounts/{user_id}/keys/{key}":1},delete:{"sub_accounts/{user_id}/keys/{key}":1}},spot:{get:{accounts:1,open_orders:1,orders:1,"orders/{order_id}":1,my_trades:1,price_orders:1,"price_orders/{order_id}":1},post:{batch_orders:1,orders:1,cancel_batch_orders:1,price_orders:1},delete:{orders:1,"orders/{order_id}":1,price_orders:1,"price_orders/{order_id}":1},patch:{"orders/{order_id}":1}},margin:{get:{accounts:1.5,account_book:1.5,funding_accounts:1.5,loans:1.5,"loans/{loan_id}":1.5,"loans/{loan_id}/repayment":1.5,loan_records:1.5,"loan_records/{load_record_id}":1.5,auto_repay:1.5,transferable:1.5,"cross/accounts":1.5,"cross/account_book":1.5,"cross/loans":1.5,"cross/loans/{loan_id}":1.5,"cross/loans/repayments":1.5,"cross/transferable":1.5,"loan_records/{loan_record_id}":1.5,borrowable:1.5,"cross/repayments":1.5,"cross/borrowable":1.5},post:{loans:1.5,merged_loans:1.5,"loans/{loan_id}/repayment":1.5,auto_repay:1.5,"cross/loans":1.5,"cross/loans/repayments":1.5,"cross/repayments":1.5},patch:{"loans/{loan_id}":1.5,"loan_records/{loan_record_id}":1.5},delete:{"loans/{loan_id}":1.5}},futures:{get:{"{settle}/accounts":1.5,"{settle}/account_book":1.5,"{settle}/positions":1.5,"{settle}/positions/{contract}":1.5,"{settle}/orders":1.5,"{settle}/orders/{order_id}":1.5,"{settle}/my_trades":1.5,"{settle}/position_close":1.5,"{settle}/liquidates":1.5,"{settle}/price_orders":1.5,"{settle}/price_orders/{order_id}":1.5,"{settle}/dual_comp/positions/{contract}":1.5},post:{"{settle}/positions/{contract}/margin":1.5,"{settle}/positions/{contract}/leverage":1.5,"{settle}/positions/{contract}/risk_limit":1.5,"{settle}/dual_mode":1.5,"{settle}/dual_comp/positions/{contract}":1.5,"{settle}/dual_comp/positions/{contract}/margin":1.5,"{settle}/dual_comp/positions/{contract}/leverage":1.5,"{settle}/dual_comp/positions/{contract}/risk_limit":1.5,"{settle}/orders":1.5,"{settle}/price_orders":1.5},delete:{"{settle}/orders":1.5,"{settle}/orders/{order_id}":1.5,"{settle}/price_orders":1.5,"{settle}/price_orders/{order_id}":1.5}},delivery:{get:{"{settle}/accounts":1.5,"{settle}/account_book":1.5,"{settle}/positions":1.5,"{settle}/positions/{contract}":1.5,"{settle}/orders":1.5,"{settle}/orders/{order_id}":1.5,"{settle}/my_trades":1.5,"{settle}/position_close":1.5,"{settle}/liquidates":1.5,"{settle}/price_orders":1.5,"{settle}/price_orders/{order_id}":1.5,"{settle}/settlements":1.5},post:{"{settle}/positions/{contract}/margin":1.5,"{settle}/positions/{contract}/leverage":1.5,"{settle}/positions/{contract}/risk_limit":1.5,"{settle}/orders":1.5,"{settle}/price_orders":1.5},delete:{"{settle}/orders":1.5,"{settle}/orders/{order_id}":1.5,"{settle}/price_orders":1.5,"{settle}/price_orders/{order_id}":1.5}},options:{get:{accounts:1.5,account_book:1.5,positions:1.5,"positions/{contract}":1.5,position_close:1.5,orders:1.5,"orders/{order_id}":1.5,my_trades:1.5},post:{orders:1.5},delete:{orders:1.5,"orders/{order_id}":1.5}}}},timeframes:{"10s":"10s","1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","4h":"4h","8h":"8h","1d":"1d","7d":"7d","1w":"7d"},commonCurrencies:{"88MPH":"MPH",AXIS:"Axis DeFi",BIFI:"Bitcoin File",BOX:"DefiBox",BTCBEAR:"BEAR",BTCBULL:"BULL",BYN:"BeyondFi",EGG:"Goose Finance",GTC:"Game.com",GTC_HT:"Game.com HT",GTC_BSC:"Game.com BSC",HIT:"HitChain",MM:"Million",MPH:"Morpher",POINT:"GatePoint",RAI:"Rai Reflex Index",SBTC:"Super Bitcoin",TNC:"Trinity Network Credit",TON:"TONToken",VAI:"VAIOT"},requiredCredentials:{apiKey:!0,secret:!0},headers:{"X-Gate-Channel-Id":"ccxt"},options:{createOrder:{expiration:86400},networks:{TRC20:"TRX",ERC20:"ETH",BEP20:"BSC"},timeInForce:{GTC:"gtc",IOC:"ioc",PO:"poc",POC:"poc"},accountsByType:{funding:"spot",spot:"spot",margin:"margin",cross_margin:"cross_margin",cross:"cross_margin",isolated:"margin",swap:"futures",future:"delivery",futures:"futures",delivery:"delivery"},defaultType:"spot",swap:{fetchMarkets:{settlementCurrencies:["usdt","btc"]}},future:{fetchMarkets:{settlementCurrencies:["usdt"]}}},precisionMode:a,fees:{trading:{tierBased:!0,feeSide:"get",percentage:!0,maker:this.parseNumber("0.002"),taker:this.parseNumber("0.002"),tiers:{maker:[[this.parseNumber("0"),this.parseNumber("0.002")],[this.parseNumber("1.5"),this.parseNumber("0.00185")],[this.parseNumber("3"),this.parseNumber("0.00175")],[this.parseNumber("6"),this.parseNumber("0.00165")],[this.parseNumber("12.5"),this.parseNumber("0.00155")],[this.parseNumber("25"),this.parseNumber("0.00145")],[this.parseNumber("75"),this.parseNumber("0.00135")],[this.parseNumber("200"),this.parseNumber("0.00125")],[this.parseNumber("500"),this.parseNumber("0.00115")],[this.parseNumber("1250"),this.parseNumber("0.00105")],[this.parseNumber("2500"),this.parseNumber("0.00095")],[this.parseNumber("3000"),this.parseNumber("0.00085")],[this.parseNumber("6000"),this.parseNumber("0.00075")],[this.parseNumber("11000"),this.parseNumber("0.00065")],[this.parseNumber("20000"),this.parseNumber("0.00055")],[this.parseNumber("40000"),this.parseNumber("0.00055")],[this.parseNumber("75000"),this.parseNumber("0.00055")]],taker:[[this.parseNumber("0"),this.parseNumber("0.002")],[this.parseNumber("1.5"),this.parseNumber("0.00195")],[this.parseNumber("3"),this.parseNumber("0.00185")],[this.parseNumber("6"),this.parseNumber("0.00175")],[this.parseNumber("12.5"),this.parseNumber("0.00165")],[this.parseNumber("25"),this.parseNumber("0.00155")],[this.parseNumber("75"),this.parseNumber("0.00145")],[this.parseNumber("200"),this.parseNumber("0.00135")],[this.parseNumber("500"),this.parseNumber("0.00125")],[this.parseNumber("1250"),this.parseNumber("0.00115")],[this.parseNumber("2500"),this.parseNumber("0.00105")],[this.parseNumber("3000"),this.parseNumber("0.00095")],[this.parseNumber("6000"),this.parseNumber("0.00085")],[this.parseNumber("11000"),this.parseNumber("0.00075")],[this.parseNumber("20000"),this.parseNumber("0.00065")],[this.parseNumber("40000"),this.parseNumber("0.00065")],[this.parseNumber("75000"),this.parseNumber("0.00065")]]}},swap:{tierBased:!0,feeSide:"base",percentage:!0,maker:this.parseNumber("0.0"),taker:this.parseNumber("0.0005"),tiers:{maker:[[this.parseNumber("0"),this.parseNumber("0.0000")],[this.parseNumber("1.5"),this.parseNumber("-0.00005")],[this.parseNumber("3"),this.parseNumber("-0.00005")],[this.parseNumber("6"),this.parseNumber("-0.00005")],[this.parseNumber("12.5"),this.parseNumber("-0.00005")],[this.parseNumber("25"),this.parseNumber("-0.00005")],[this.parseNumber("75"),this.parseNumber("-0.00005")],[this.parseNumber("200"),this.parseNumber("-0.00005")],[this.parseNumber("500"),this.parseNumber("-0.00005")],[this.parseNumber("1250"),this.parseNumber("-0.00005")],[this.parseNumber("2500"),this.parseNumber("-0.00005")],[this.parseNumber("3000"),this.parseNumber("-0.00008")],[this.parseNumber("6000"),this.parseNumber("-0.01000")],[this.parseNumber("11000"),this.parseNumber("-0.01002")],[this.parseNumber("20000"),this.parseNumber("-0.01005")],[this.parseNumber("40000"),this.parseNumber("-0.02000")],[this.parseNumber("75000"),this.parseNumber("-0.02005")]],taker:[[this.parseNumber("0"),this.parseNumber("0.00050")],[this.parseNumber("1.5"),this.parseNumber("0.00048")],[this.parseNumber("3"),this.parseNumber("0.00046")],[this.parseNumber("6"),this.parseNumber("0.00044")],[this.parseNumber("12.5"),this.parseNumber("0.00042")],[this.parseNumber("25"),this.parseNumber("0.00040")],[this.parseNumber("75"),this.parseNumber("0.00038")],[this.parseNumber("200"),this.parseNumber("0.00036")],[this.parseNumber("500"),this.parseNumber("0.00034")],[this.parseNumber("1250"),this.parseNumber("0.00032")],[this.parseNumber("2500"),this.parseNumber("0.00030")],[this.parseNumber("3000"),this.parseNumber("0.00030")],[this.parseNumber("6000"),this.parseNumber("0.00030")],[this.parseNumber("11000"),this.parseNumber("0.00030")],[this.parseNumber("20000"),this.parseNumber("0.00030")],[this.parseNumber("40000"),this.parseNumber("0.00030")],[this.parseNumber("75000"),this.parseNumber("0.00030")]]}}},exceptions:{exact:{INVALID_PARAM_VALUE:o,INVALID_PROTOCOL:o,INVALID_ARGUMENT:o,INVALID_REQUEST_BODY:o,MISSING_REQUIRED_PARAM:h,BAD_REQUEST:o,INVALID_CONTENT_TYPE:o,NOT_ACCEPTABLE:o,METHOD_NOT_ALLOWED:o,NOT_FOUND:n,INVALID_CREDENTIALS:d,INVALID_KEY:d,IP_FORBIDDEN:d,READ_ONLY:c,INVALID_SIGNATURE:d,MISSING_REQUIRED_HEADER:d,REQUEST_EXPIRED:d,ACCOUNT_LOCKED:l,FORBIDDEN:c,SUB_ACCOUNT_NOT_FOUND:n,SUB_ACCOUNT_LOCKED:l,MARGIN_BALANCE_EXCEPTION:n,MARGIN_TRANSFER_FAILED:n,TOO_MUCH_FUTURES_AVAILABLE:n,FUTURES_BALANCE_NOT_ENOUGH:u,ACCOUNT_EXCEPTION:n,SUB_ACCOUNT_TRANSFER_FAILED:n,ADDRESS_NOT_USED:n,TOO_FAST:f,WITHDRAWAL_OVER_LIMIT:n,API_WITHDRAW_DISABLED:p,INVALID_WITHDRAW_ID:n,INVALID_WITHDRAW_CANCEL_STATUS:n,INVALID_PRECISION:g,INVALID_CURRENCY:m,INVALID_CURRENCY_PAIR:m,POC_FILL_IMMEDIATELY:w,ORDER_NOT_FOUND:y,CLIENT_ID_NOT_FOUND:y,ORDER_CLOSED:g,ORDER_CANCELLED:g,QUANTITY_NOT_ENOUGH:g,BALANCE_NOT_ENOUGH:u,MARGIN_NOT_SUPPORTED:g,MARGIN_BALANCE_NOT_ENOUGH:u,AMOUNT_TOO_LITTLE:g,AMOUNT_TOO_MUCH:g,REPEATED_CREATION:g,LOAN_NOT_FOUND:y,LOAN_RECORD_NOT_FOUND:y,NO_MATCHED_LOAN:n,NOT_MERGEABLE:n,NO_CHANGE:n,REPAY_TOO_MUCH:n,TOO_MANY_CURRENCY_PAIRS:g,TOO_MANY_ORDERS:g,MIXED_ACCOUNT_TYPE:g,AUTO_BORROW_TOO_MUCH:n,TRADE_RESTRICTED:u,USER_NOT_FOUND:v,CONTRACT_NO_COUNTER:n,CONTRACT_NOT_FOUND:m,RISK_LIMIT_EXCEEDED:n,INSUFFICIENT_AVAILABLE:u,LIQUIDATE_IMMEDIATELY:g,LEVERAGE_TOO_HIGH:g,LEVERAGE_TOO_LOW:g,ORDER_NOT_OWNED:n,ORDER_FINISHED:n,POSITION_CROSS_MARGIN:n,POSITION_IN_LIQUIDATION:n,POSITION_IN_CLOSE:n,POSITION_EMPTY:g,REMOVE_TOO_MUCH:n,RISK_LIMIT_NOT_MULTIPLE:n,RISK_LIMIT_TOO_HIGH:n,RISK_LIMIT_TOO_lOW:n,PRICE_TOO_DEVIATED:g,SIZE_TOO_LARGE:g,SIZE_TOO_SMALL:g,PRICE_OVER_LIQUIDATION:g,PRICE_OVER_BANKRUPT:g,ORDER_POC_IMMEDIATE:w,INCREASE_POSITION:g,CONTRACT_IN_DELISTING:n,INTERNAL:p,SERVER_ERROR:p,TOO_BUSY:p,CROSS_ACCOUNT_NOT_FOUND:n,RISK_LIMIT_TOO_LOW:o},broad:{}}})}async fetchMarkets(e={}){let t=[this.fetchSpotMarkets(e),this.fetchContractMarkets(e),this.fetchOptionMarkets(e)];t=await Promise.all(t);const i=t[0],s=t[1],r=t[2],a=this.arrayConcat(i,s);return this.arrayConcat(a,r)}async fetchSpotMarkets(e={}){const t=await this.publicMarginGetCurrencyPairs(e),i=await this.publicSpotGetCurrencyPairs(e),s=this.indexBy(t,"id"),a=[];for(let e=0;e<i.length;e++){const t=i[e],n=this.safeString(t,"id"),o=this.safeValue(s,n),h=this.deepExtend(o,t),[d,c]=n.split("_"),l=this.safeCurrencyCode(d),u=this.safeCurrencyCode(c),f=this.safeString(h,"fee"),p=this.safeString(h,"maker_fee_rate",f),m=this.parseNumber(this.parsePrecision(this.safeString(h,"amount_precision"))),g=this.safeString(h,"trade_status"),y=void 0!==this.safeNumber(h,"leverage");a.push({id:n,symbol:l+"/"+u,base:l,quote:u,settle:void 0,baseId:d,quoteId:c,settleId:void 0,type:"spot",spot:!0,margin:y,swap:!1,future:!1,option:!1,active:"tradable"===g,contract:!1,linear:void 0,inverse:void 0,taker:this.parseNumber(r.stringDiv(f,"100")),maker:this.parseNumber(r.stringDiv(p,"100")),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:m,price:this.parseNumber(this.parsePrecision(this.safeString(h,"precision")))},limits:{leverage:{min:this.parseNumber("1"),max:this.safeNumber(h,"leverage",1)},amount:{min:this.safeNumber(t,"min_base_amount",m),max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(h,"min_quote_amount"),max:y?this.safeNumber(h,"max_quote_amount"):void 0}},info:h})}return a}async fetchContractMarkets(e={}){const t=[],i=this.getSettlementCurrencies("swap","fetchMarkets"),s=this.getSettlementCurrencies("future","fetchMarkets");for(let s=0;s<i.length;s++){const r=i[s],a={settle:r},n=await this.publicFuturesGetSettleContracts(this.extend(a,e));for(let e=0;e<n.length;e++){const i=this.parseContractMarket(n[e],r);t.push(i)}}for(let i=0;i<s.length;i++){const r=s[i],a={settle:r},n=await this.publicDeliveryGetSettleContracts(this.extend(a,e));for(let e=0;e<n.length;e++){const i=this.parseContractMarket(n[e],r);t.push(i)}}return t}parseContractMarket(e,t){const i=this.safeString(e,"name"),s=i.split("_"),a=this.safeString(s,0),n=this.safeString(s,1),o=this.safeString(s,2),h=this.safeCurrencyCode(a),d=this.safeCurrencyCode(n),c=this.safeCurrencyCode(t),l=this.safeTimestamp(e,"expire_time");let u="",f="swap";void 0!==o?(u=h+"/"+d+":"+c+"-"+this.yymmdd(l,""),f="future"):u=h+"/"+d+":"+c;const p=this.safeString(e,"order_price_deviate"),m=this.safeString(e,"mark_price"),g=r.stringSub("1",p),y=r.stringAdd("1",p),b=r.stringMul(g,m),v=r.stringMul(y,m),w=this.safeString(e,"taker_fee_rate"),S=this.safeString(e,"maker_fee_rate",w),k=d===c;return{id:i,symbol:u,base:h,quote:d,settle:c,baseId:a,quoteId:n,settleId:t,type:f,spot:!1,margin:!1,swap:"swap"===f,future:"future"===f,option:"option"===f,active:!0,contract:!0,linear:k,inverse:!k,taker:this.parseNumber(r.stringDiv(w,"100")),maker:this.parseNumber(r.stringDiv(S,"100")),contractSize:this.safeNumber(e,"quanto_multiplier"),expiry:l,expiryDatetime:this.iso8601(l),strike:void 0,optionType:void 0,precision:{amount:this.parseNumber("1"),price:this.safeNumber(e,"order_price_round")},limits:{leverage:{min:this.safeNumber(e,"leverage_min"),max:this.safeNumber(e,"leverage_max")},amount:{min:this.safeNumber(e,"order_size_min"),max:this.safeNumber(e,"order_size_max")},price:{min:this.parseNumber(b),max:this.parseNumber(v)},cost:{min:void 0,max:void 0}},info:e}}async fetchOptionMarkets(e={}){const t=[],i=await this.fetchOptionUnderlyings();for(let s=0;s<i.length;s++){const a=i[s],n=e;n.underlying=a;const o=await this.publicOptionsGetContracts(n);for(let e=0;e<o.length;e++){const i=o[e],s=this.safeString(i,"name"),n=a.split("_"),h=this.safeString(n,0),d=this.safeString(n,1),c=this.safeCurrencyCode(h),l=this.safeCurrencyCode(d);let u=c+"/"+l;const f=this.safeTimestamp(i,"expiration_time"),p=this.safeString(i,"strike_price"),m=this.safeValue(i,"is_call"),g=m?"C":"P",y=m?"call":"put";u=u+":"+l+"-"+this.yymmdd(f)+"-"+p+"-"+g;const b=this.safeString(i,"order_price_deviate"),v=this.safeString(i,"mark_price"),w=r.stringSub("1",b),S=r.stringAdd("1",b),k=r.stringMul(w,v),T=r.stringMul(S,v),_=this.safeString(i,"taker_fee_rate"),O=this.safeString(i,"maker_fee_rate",_);t.push({id:s,symbol:u,base:c,quote:l,settle:l,baseId:h,quoteId:d,settleId:d,type:"option",spot:!1,margin:!1,swap:!1,future:!1,option:!0,active:!0,contract:!0,linear:!0,inverse:!1,taker:this.parseNumber(r.stringDiv(_,"100")),maker:this.parseNumber(r.stringDiv(O,"100")),contractSize:this.parseNumber("1"),expiry:f,expiryDatetime:this.iso8601(f),strike:p,optionType:y,precision:{amount:this.parseNumber("1"),price:this.safeNumber(i,"order_price_round")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(i,"order_size_min"),max:this.safeNumber(i,"order_size_max")},price:{min:this.parseNumber(k),max:this.parseNumber(T)},cost:{min:void 0,max:void 0}},info:i})}}return t}async fetchOptionUnderlyings(){const e=await this.publicOptionsGetUnderlyings(),t=[];for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"name");void 0!==r&&t.push(r)}return t}prepareRequest(e,t,i={}){const s={};if(void 0!==e)e.contract?(s.contract=e.id,s.settle=e.settleId):s.currency_pair=e.id;else{const e="swap"===t;if(e||"future"===t){const t=e?"usdt":"btc",r=this.safeStringLower(i,"settle",t);i=this.omit(i,"settle"),s.settle=r}}return[s,i]}spotOrderPrepareRequest(e,t=!1,i={}){const[s,r]=this.getMarginMode(t,i),a={};if(!t){if(void 0===e)throw new h(this.id+" spotOrderPrepareRequest() requires a market argument for non-stop orders");a.account=s,a.currency_pair=e.id}return[a,r]}multiOrderSpotPrepareRequest(e,t=!1,i={}){const[s,r]=this.getMarginMode(t,i),a={account:s};return void 0!==e&&(t?a.market=e.id:a.currency_pair=e.id),[a,r]}getMarginMode(e,t){const i=this.safeStringLower2(this.options,"defaultMarginMode","marginMode","spot");let s=this.safeStringLower2(t,"marginMode","account",i);if(t=this.omit(t,["marginMode","account"]),"cross"===s?s="cross_margin":"isolated"===s?s="margin":""===s&&(s="spot"),e&&("spot"===s&&(s="normal"),"cross_margin"===s))throw new o(this.id+" getMarginMode() does not support stop orders for cross margin");return[s,t]}getSettlementCurrencies(e,t){const i=this.safeValue(this.options,e,{}),s=this.safeValue(i,t,{}),r="swap"===e?["usdt"]:["btc"];return this.safeValue(s,"settlementCurrencies",r)}async fetchCurrencies(e={}){if(void 0!==this.safeValue(this.urls,"apiBackup"))return;const t=await this.publicSpotGetCurrencies(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"currency"),a=this.safeStringLower(s,"currency"),n=this.safeCurrencyCode(r),o=this.safeValue(s,"delisted"),h=this.safeValue(s,"withdraw_disabled",!1),d=this.safeValue(s,"deposit_disabled",!1),c=this.safeValue(s,"trade_disabled",!1),l=!h,u=!d,f=!o&&!c&&l&&u;i[n]={id:r,lowerCaseId:a,name:void 0,code:n,precision:this.parseNumber("1e-4"),info:s,active:f,deposit:u,withdraw:l,fee:void 0,fees:[],limits:this.limits}}return i}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.swap)throw new m(this.id+" fetchFundingRate() supports swap contracts only");const[s,r]=this.prepareRequest(i,void 0,t),a=await this.publicFuturesGetSettleContractsContract(this.extend(s,r));return this.parseFundingRate(a)}async fetchFundingRates(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const[i,s]=this.prepareRequest(void 0,"swap",t),r=await this.publicFuturesGetSettleContracts(this.extend(i,s)),a=this.parseFundingRates(r);return this.filterByArray(a,"symbol",e)}parseFundingRate(e,t){const i=this.safeString(e,"name"),s=this.safeSymbol(i,t,"_","swap"),r=this.safeNumber(e,"mark_price"),a=this.safeNumber(e,"index_price"),n=this.safeNumber(e,"interest_rate"),o=this.safeNumber(e,"funding_rate"),h=this.safeTimestamp(e,"funding_next_apply"),d=this.safeNumber(e,"funding_rate_indicative");return{info:e,symbol:s,markPrice:r,indexPrice:a,interestRate:n,estimatedSettlePrice:void 0,timestamp:void 0,datetime:void 0,fundingRate:o,fundingTimestamp:h,fundingDatetime:this.iso8601(h),nextFundingRate:d,nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async fetchNetworkDepositAddress(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=await this.privateWalletGetDepositAddress(this.extend(i,t)),r=this.safeValue(s,"multichain_addresses"),a=this.safeString(s,"currency");e=this.safeCurrencyCode(a);const n={};for(let t=0;t<r.length;t++){const i=r[t];if(this.safeInteger(i,"obtain_failed"))continue;const s=this.safeString(i,"chain"),a=this.safeString(i,"address"),o=this.safeString(i,"payment_id");n[s]={info:i,code:e,currency:e,address:a,tag:o}}return n}async createDepositAddress(e,t={}){return await this.fetchDepositAddress(e,t)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=await this.privateWalletGetDepositAddress(this.extend(i,t)),r=this.safeString(s,"currency");e=this.safeCurrencyCode(r);const a=this.safeString(s,"address");let n,o;if(void 0!==a){if(a.indexOf("New address is being generated for you, please wait")>=0)throw new S(this.id+" New address is being generated for you, please wait a few seconds and try again to get the address.");if(a.indexOf(" ")>=0){const e=a.split(" ");o=e[0],n=e[1]}else o=a}return this.checkAddress(o),{info:s,code:e,currency:e,address:o,tag:n,network:void 0}}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={currency_pair:i.id},r=await this.privateWalletGetFee(this.extend(s,t));return this.parseTradingFee(r,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privateWalletGetFee(e);return this.parseTradingFees(t)}parseTradingFees(e){const t={};for(let i=0;i<this.symbols.length;i++){const s=this.symbols[i],r=this.market(s);t[s]=this.parseTradingFee(e,r)}return t}parseTradingFee(e,t){const i=this.safeValue(t,"contract"),s=i?"futures_taker_fee":"taker_fee",r=i?"futures_maker_fee":"maker_fee";return{info:e,symbol:this.safeString(t,"symbol"),maker:this.safeNumber(e,r),taker:this.safeNumber(e,s)}}async fetchTransactionFees(e,t={}){await this.loadMarkets();const i=await this.privateWalletGetWithdrawStatus(t),s={};let r={};for(let t=0;t<i.length;t++){r={};const a=i[t],n=this.safeString(a,"currency"),o=this.safeCurrencyCode(n);if(void 0!==e&&!this.inArray(o,e))continue;const h=this.safeValue(a,"withdraw_fix_on_chains");if(void 0===h)r=this.safeNumber(a,"withdraw_fix");else{const e=Object.keys(h);for(let t=0;t<e.length;t++){const i=e[t];r[i]=this.parseNumber(h[i])}}s[o]={withdraw:r,deposit:void 0,info:a}}return s}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.privateWalletGetWithdrawStatus(t);return this.parseDepositWithdrawFees(i,e,"currency")}parseDepositWithdrawFee(e,t){const i=this.safeValue(e,"withdraw_fix_on_chains"),s={info:e,withdraw:{fee:this.safeNumber(e,"withdraw_fix"),percentage:!1},deposit:{fee:this.safeNumber(e,"deposit"),percentage:!1},networks:{}};if(void 0!==i){const e=Object.keys(i);for(let t=0;t<e.length;t++){const r=e[t];s.networks[r]={withdraw:{fee:this.parseNumber(i[r]),percentage:!1},deposit:{fee:void 0,percentage:void 0}}}}return s}async fetchFundingHistory(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e),e=r.symbol);const[a,n]=this.handleMarketTypeAndParams("fetchFundingHistory",r,s),[o,h]=this.prepareRequest(r,a,n);o.type="fund",void 0!==t&&(o.from=t/1e3),void 0!==i&&(o.limit=i);const d=this.getSupportedMapping(a,{swap:"privateFuturesGetSettleAccountBook",future:"privateDeliveryGetSettleAccountBook"}),c=await this[d](this.extend(o,h));return this.parseFundingHistories(c,e,t,i)}parseFundingHistories(e,t,i,s){const r=[];for(let t=0;t<e.length;t++){const i=e[t],s=this.parseFundingHistory(i);r.push(s)}const a=this.sortBy(r,"timestamp");return this.filterBySymbolSinceLimit(a,t,i,s)}parseFundingHistory(e,t){const i=this.safeTimestamp(e,"time"),s=this.safeString(e,"text");return t=this.safeMarket(s,t,"_","swap"),{info:e,symbol:this.safeString(t,"symbol"),code:this.safeString(t,"settle"),timestamp:i,datetime:this.iso8601(i),id:void 0,amount:this.safeNumber(e,"change")}}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),[r,a]=this.prepareRequest(s,void 0,i),n=this.getSupportedMapping(s.type,{spot:"publicSpotGetOrderBook",margin:"publicSpotGetOrderBook",swap:"publicFuturesGetSettleOrderBook",future:"publicDeliveryGetSettleOrderBook"});void 0!==t&&(r.limit=t),r.with_id=!0;const o=await this[n](this.extend(r,a));let h=this.safeInteger(o,"current");s.spot||(h*=1e3);const d=s.spot?0:"p",c=s.spot?1:"s",l=this.safeInteger(o,"id"),u=this.parseOrderBook(o,e,h,"bids","asks",d,c);return u.nonce=l,u}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),[s,r]=this.prepareRequest(i,void 0,t),a=this.getSupportedMapping(i.type,{spot:"publicSpotGetTickers",margin:"publicSpotGetTickers",swap:"publicFuturesGetSettleTickers",future:"publicDeliveryGetSettleTickers"}),n=await this[a](this.extend(s,r)),o=this.safeValue(n,0);return this.parseTicker(o,i)}parseTicker(e,t){const i=this.safeString2(e,"currency_pair","contract"),s="contract"in e?"contract":"spot",r=this.safeSymbol(i,t,"_",s),a=this.safeString(e,"last"),n=this.safeString2(e,"lowest_ask","a"),o=this.safeString2(e,"highest_bid","b"),h=this.safeString(e,"high_24h"),d=this.safeString(e,"low_24h"),c=this.safeString(e,"B"),l=this.safeString(e,"A"),u=this.safeInteger(e,"t");let f=this.safeString2(e,"base_volume","volume_24h_base");"nan"===f&&(f="0");let p=this.safeString2(e,"quote_volume","volume_24h_quote");"nan"===p&&(p="0");const m=this.safeString(e,"change_percentage");return this.safeTicker({symbol:r,timestamp:u,datetime:this.iso8601(u),high:h,low:d,bid:o,bidVolume:c,ask:n,askVolume:l,vwap:void 0,open:void 0,close:a,last:a,previousClose:void 0,change:void 0,percentage:m,average:void 0,baseVolume:f,quoteVolume:p,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=this.safeString(e,0);let s;void 0!==i&&(s=this.market(i));const[r,a]=this.handleMarketTypeAndParams("fetchTickers",s,t),[n,o]=this.prepareRequest(void 0,r,a),h=this.getSupportedMapping(r,{spot:"publicSpotGetTickers",margin:"publicSpotGetTickers",swap:"publicFuturesGetSettleTickers",future:"publicDeliveryGetSettleTickers"}),d=await this[h](this.extend(n,o));return this.parseTickers(d,e)}parseBalanceHelper(e){const t=this.account();return t.used=this.safeString2(e,"freeze","locked"),t.free=this.safeString(e,"available"),t.total=this.safeString(e,"total"),"borrowed"in e&&(t.debt=this.safeString(e,"borrowed")),t}async fetchBalance(e={}){await this.loadMarkets();const t=this.safeString(e,"symbol");e=this.omit(e,"symbol");const[i,s]=this.handleMarketTypeAndParams("fetchBalance",void 0,e),[r,a]=this.prepareRequest(void 0,i,s),[n,o]=this.getMarginMode(!1,a);if(void 0!==t){const e=this.market(t);r.currency_pair=e.id}const h=this.getSupportedMapping(i,{spot:this.getSupportedMapping(n,{spot:"privateSpotGetAccounts",margin:"privateMarginGetAccounts",cross_margin:"privateMarginGetCrossAccounts"}),funding:"privateMarginGetFundingAccounts",swap:"privateFuturesGetSettleAccounts",future:"privateDeliveryGetSettleAccounts"});let d=await this[h](this.extend(r,o));("swap"===i||"future"===i)&&(d=[d]);const c={info:d},l="margin"===n;let u=d;if("balances"in u){const e=[],t=this.safeValue(u,"balances",[]),i=Object.keys(t);for(let s=0;s<i.length;s++){const r=i[s],a=t[r];a.currency=r,e.push(a)}u=e}for(let e=0;e<u.length;e++){const t=u[e];if(l){const e=this.safeString(t,"currency_pair"),i=this.safeSymbol(e,void 0,"_","margin"),s=this.safeValue(t,"base",{}),r=this.safeValue(t,"quote",{}),a=this.safeCurrencyCode(this.safeString(s,"currency")),n=this.safeCurrencyCode(this.safeString(r,"currency")),o={};o[a]=this.parseBalanceHelper(s),o[n]=this.parseBalanceHelper(r),c[i]=this.safeBalance(o)}else{c[this.safeCurrencyCode(this.safeString(t,"currency"))]=this.parseBalanceHelper(t)}}return l?c:this.safeBalance(c)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.safeString(r,"price");let o={};[o,r]=this.prepareRequest(a,void 0,r),o.interval=this.safeString(this.timeframes,t,t);let h="publicSpotGetCandlesticks",d=1e3;if(a.contract){d=1999,s=void 0===s?d:Math.min(s,d),a.future?h="publicDeliveryGetSettleCandlesticks":a.swap&&(h="publicFuturesGetSettleCandlesticks");("mark"===n||"index"===n)&&(o.contract=n+"_"+a.id,r=this.omit(r,"price"))}s=void 0===s?d:Math.min(s,d);let c=this.safeInteger(r,"until");if(void 0!==c&&(c=parseInt(c/1e3),r=this.omit(r,"until")),void 0!==i){const e=this.parseTimeframe(t);o.from=parseInt(i/1e3);const r=this.sum(o.from,s*e-1),a=this.seconds(),n=Math.min(r,a);o.to=void 0!==c?Math.min(n,c):n}else void 0!==c&&(o.to=c),o.limit=s;const l=await this[h](this.extend(o,r));return this.parseOHLCVs(l,a,t,i,s)}async fetchFundingRateHistory(e,t,i,s={}){if(void 0===e)throw new h(this.id+" fetchFundingRateHistory() requires a symbol argument");await this.loadMarkets();const r=this.market(e);if(!r.swap)throw new m(this.id+" fetchFundingRateHistory() supports swap contracts only");const[a,n]=this.prepareRequest(r,void 0,s);void 0!==i&&(a.limit=i);const o=await this.publicFuturesGetSettleFundingRate(this.extend(a,n)),d=[];for(let t=0;t<o.length;t++){const i=o[t],s=this.safeTimestamp(i,"t");d.push({info:i,symbol:e,fundingRate:this.safeNumber(i,"r"),timestamp:s,datetime:this.iso8601(s)})}const c=this.sortBy(d,"timestamp");return this.filterBySymbolSinceLimit(c,r.symbol,t,i)}parseOHLCV(e,t){return Array.isArray(e)?[this.safeTimestamp(e,0),this.safeNumber(e,5),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,2),this.safeNumber(e,6)]:[this.safeTimestamp(e,"t"),this.safeNumber(e,"o"),this.safeNumber(e,"h"),this.safeNumber(e,"l"),this.safeNumber(e,"c"),this.safeNumber(e,"v")]}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),[a,n]=this.prepareRequest(r,void 0,s),o=this.getSupportedMapping(r.type,{spot:"publicSpotGetTrades",margin:"publicSpotGetTrades",swap:"publicFuturesGetSettleTrades",future:"publicDeliveryGetSettleTrades"});void 0!==i&&(a.limit=i),void 0!==t&&r.contract&&(a.from=parseInt(t/1e3));const h=await this[o](this.extend(a,n));return this.parseTrades(h,r,t,i)}async fetchOrderTrades(e,t,i,s,r={}){if(await this.loadMarkets(),void 0===t)throw new h(this.id+" fetchOrderTrades requires a symbol argument");return await this.fetchMyTrades(t,i,s,{order_id:e})}async fetchMyTrades(e,t,i,s={}){let r,a;await this.loadMarkets();let n={};const o=void 0!==e?this.market(e):void 0,h=this.safeInteger2(s,"until","till");s=this.omit(s,["until","till"]),[r,s]=this.handleMarketTypeAndParams("fetchMyTrades",o,s);"swap"===r||"future"===r?[n,s]=this.prepareRequest(o,r,s):(void 0!==o&&(n.currency_pair=o.id),[a,s]=this.getMarginMode(!1,s),n.account=a),void 0!==i&&(n.limit=i),void 0!==t&&(n.from=parseInt(t/1e3)),void 0!==h&&(n.to=parseInt(h/1e3));const d=this.getSupportedMapping(r,{spot:"privateSpotGetMyTrades",margin:"privateSpotGetMyTrades",swap:"privateFuturesGetSettleMyTrades",future:"privateDeliveryGetSettleMyTrades"}),c=await this[d](this.extend(n,s));return this.parseTrades(c,o,t,i)}parseTrade(e,t){const i=this.safeString(e,"id");let s=this.safeTimestamp2(e,"time","create_time");s=this.safeInteger(e,"create_time_ms",s);const a=this.safeString2(e,"currency_pair","contract"),n="contract"in e?"contract":"spot";t=this.safeMarket(a,t,"_",n);let o=this.safeString2(e,"amount","size");const h=this.safeString(e,"price"),d=r.stringLt(o,"0")?"sell":"buy";o=r.stringAbs(o);const c=this.safeString2(e,"side","type",d),l=this.safeString(e,"order_id"),u=this.safeString(e,"fee"),f=this.safeString(e,"gt_fee"),p=this.safeString(e,"point_fee"),m=[];if(void 0!==u){const i=this.safeString(e,"fee_currency");let s=this.safeCurrencyCode(i);void 0===s&&(s=this.safeString(t,"settle")),m.push({cost:u,currency:s})}void 0!==f&&m.push({cost:f,currency:"GT"}),void 0!==p&&m.push({cost:p,currency:"GatePoint"});const g=this.safeString(e,"role");return this.safeTrade({info:e,id:i,timestamp:s,datetime:this.iso8601(s),symbol:t.symbol,order:l,type:void 0,side:c,takerOrMaker:g,price:h,amount:o,cost:void 0,fee:void 0,fees:m},t)}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;if(void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==i&&(r.limit=i),void 0!==t){const e=parseInt(t/1e3);r.from=e,r.to=this.sum(e,2592e3)}const n=await this.privateWalletGetDeposits(this.extend(r,s));return this.parseTransactions(n,a)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;if(void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==i&&(r.limit=i),void 0!==t){const e=parseInt(t/1e3);r.from=e,r.to=this.sum(e,2592e3)}const n=await this.privateWalletGetWithdrawals(this.extend(r,s));return this.parseTransactions(n,a)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={currency:a.id,address:i,amount:this.currencyToPrecision(e,t)};void 0!==s&&(n.memo=s);const o=this.safeValue(this.options,"networks",{});let h=this.safeStringUpper(r,"network");h=this.safeStringLower(o,h,h),void 0!==h&&(n.chain=h,r=this.omit(r,"network"));const d=await this.privateWithdrawalsPostWithdrawals(this.extend(n,r));return this.parseTransaction(d,a)}parseTransactionStatus(e){return this.safeString({PEND:"pending",REQUEST:"pending",DMOVE:"pending",CANCEL:"failed",DONE:"ok",BCODE:"ok"},e,e)}parseTransactionType(e){return this.safeString({d:"deposit",w:"withdrawal"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"id");let s,a=this.safeString(e,"amount");void 0!==i&&("b"===i[0]?(s=r.stringGt(a,"0")?"deposit":"withdrawal",a=r.stringAbs(a)):s=this.parseTransactionType(i[0]));const n=this.safeString(e,"currency"),o=this.safeCurrencyCode(n),h=this.safeString(e,"txid"),d=this.safeString(e,"status"),c=this.parseTransactionStatus(d),l=this.safeString(e,"address"),u=this.safeNumber(e,"fee"),f=this.safeString(e,"memo"),p=this.safeTimestamp(e,"timestamp");return{info:e,id:i,txid:h,currency:o,amount:this.parseNumber(a),network:void 0,address:l,addressTo:void 0,addressFrom:void 0,tag:f,tagTo:void 0,tagFrom:void 0,status:c,type:s,timestamp:p,datetime:this.iso8601(p),updated:void 0,fee:u}}async createOrder(e,t,i,s,a,d={}){await this.loadMarkets();const c=this.market(e),l=c.contract,u=this.safeValue(d,"trigger"),f=this.safeValue2(d,"triggerPrice","stopPrice"),p=this.safeValue(d,"stopLossPrice",f),m=this.safeValue(d,"takeProfitPrice"),y=void 0!==p,b=void 0!==m,v=y||b;if(y&&b)throw new n(this.id+" createOrder() stopLossPrice and takeProfitPrice cannot both be defined");let w="Orders";const S=this.safeValue(d,"reduceOnly"),k=this.safeStringLower2(d,"time_in_force","tif"),T=this.isPostOnly("market"===t,"poc"===k,d);let _=this.handleTimeInForce(d);d=this.omit(d,["stopPrice","triggerPrice","stopLossPrice","takeProfitPrice","reduceOnly","timeInForce","postOnly"]),T&&(_="poc");const O="limit"===t,M="market"===t;if(O&&void 0===a)throw new h(this.id+" createOrder () requires a price argument for "+t+" orders");if(l){const t=this.amountToPrecision(e,s),o="sell"===i?r.stringNeg(t):t;if(s=parseInt(o),M){if("poc"===_||"gtc"===_)throw new n(this.id+' createOrder () timeInForce for market orders must be "IOC"');_="ioc",a=0}}let I;if(v||void 0!==u){if(l){if(I={initial:{contract:c.id,size:s,price:this.priceToPrecision(e,a)},settle:c.settleId},void 0===u){let t,s;y?(t="buy"===i?1:2,s=this.priceToPrecision(e,p)):b&&(t="buy"===i?2:1,s=this.priceToPrecision(e,m));const r=this.safeInteger(d,"price_type",0);if(r<0||r>2)throw new o(this.id+" createOrder () price_type should be 0 latest deal price, 1 mark price, 2 index price");d=this.omit(d,["price_type"]),I.trigger={price_type:r,price:this.priceToPrecision(e,s),rule:t}}void 0!==S&&(I.initial.reduce_only=S),void 0!==_&&(I.initial.tif=_)}else{const r=this.safeValue(this.options,"createOrder",{});let n;if([n,d]=this.getMarginMode(!0,d),I={put:{type:t,side:i,price:this.priceToPrecision(e,a),amount:this.amountToPrecision(e,s),account:n,time_in_force:"gtc"},market:c.id},void 0===u){const t=this.safeInteger(r,"expiration"),s=this.safeInteger(d,"expiration",t);let a,n;y?(a="buy"===i?">=":"<=",n=this.priceToPrecision(e,p)):b&&(a="buy"===i?"<=":">=",n=this.priceToPrecision(e,m)),I.trigger={price:this.priceToPrecision(e,n),rule:a,expiration:s}}void 0!==_&&(I.put.time_in_force=_)}w="PriceOrders"}else{if(l)I={contract:c.id,size:s,settle:c.settleId},I.price=M?a:this.priceToPrecision(e,a),void 0!==S&&(I.reduce_only=S),void 0!==_&&(I.tif=_);else{let n;[n,d]=this.getMarginMode(!1,d),I={currency_pair:c.id,type:t,account:n,side:i};const o=this.safeValue(this.options,"createMarketBuyOrderRequiresPrice",!0);if(M&&"buy"===i)if(o){if(void 0===a)throw new g(this.id+" createOrder() requires price argument for market buy orders on spot markets to calculate the total amount to spend (amount * price), alternatively set the createMarketBuyOrderRequiresPrice option to false and pass in the cost to spend into the amount parameter");{const t=this.numberToString(s),i=this.numberToString(a),n=this.parseNumber(r.stringMul(t,i));I.amount=this.costToPrecision(e,n)}}else{const t=this.safeNumber(d,"cost",s);d=this.omit(d,"cost"),I.amount=this.costToPrecision(e,t)}else I.amount=this.amountToPrecision(e,s);O?I.price=this.priceToPrecision(e,a):_="ioc",void 0!==_&&(I.time_in_force=_)}let n=this.safeString2(d,"text","clientOrderId");if(void 0!==n){if(n.length>28)throw new o(this.id+" createOrder () clientOrderId or text param must be up to 28 characters");d=this.omit(d,["text","clientOrderId"]),"t"!==n[0]&&(n="t-"+n),I.text=n}}const x=this.getSupportedMapping(c.type,{spot:"privateSpotPost"+w,margin:"privateSpotPost"+w,swap:"privateFuturesPostSettle"+w,future:"privateDeliveryPostSettle"+w}),C=await this[x](this.deepExtend(I,d));return this.parseOrder(C,c)}async editOrder(e,t,i,s,r,a,n={}){await this.loadMarkets();const h=this.market(t);if(!h.spot)throw new o(this.id+" editOrder() supports only spot markets");const[d,c]=this.handleMarketTypeAndParams("editOrder",h,n),l=this.convertTypeToAccount(d);if("spot"===l&&!("limit"===i))throw new g(this.id+" editOrder() does not support "+i+" orders for "+d+" markets");const u={order_id:e,currency_pair:h.id,account:l};void 0!==r&&(u.amount=this.amountToPrecision(t,r)),void 0!==a&&(u.price=this.priceToPrecision(t,a));const f=await this.privateSpotPatchOrdersOrderId(this.extend(u,c));return this.parseOrder(f,h)}parseOrderStatus(e){return this.safeString({open:"open",_new:"open",filled:"closed",cancelled:"canceled",liquidated:"closed",ioc:"canceled",failed:"canceled",expired:"canceled",finished:"closed",succeeded:"closed"},e,e)}parseOrder(e,t){const i=this.safeValue2(e,"put","initial"),s=this.safeValue(e,"trigger");let a=this.safeString(i,"contract"),n=this.safeString(i,"type"),o=this.safeStringUpper2(i,"time_in_force","tif"),h=this.safeString2(i,"amount","size"),d=this.safeString(i,"side"),c=this.safeString(i,"price");a=this.safeString(e,"contract",a),n=this.safeString(e,"type",n),o=this.safeStringUpper2(e,"time_in_force","tif",o),"POC"===o&&(o="PO");const l="PO"===o;h=this.safeString2(e,"amount","size",h),d=this.safeString(e,"side",d),c=this.safeString(e,"price",c);let u,f=this.safeString(e,"left"),p=r.stringSub(h,f),m=this.safeString(e,"filled_total"),g=this.safeNumber(e,"fill_price");if(i&&(f=h,p="0",m="0"),a){n=r.stringEquals(c,"0")&&"IOC"===o?"market":"limit",d=r.stringGt(h,"0")?"buy":"sell",u=this.safeString(e,"finish_as","open")}else u=this.safeString(e,"status");let y=this.safeInteger(e,"create_time_ms");void 0===y&&(y=this.safeTimestamp2(e,"create_time","ctime"));let b=this.safeInteger(e,"update_time_ms");void 0===b&&(b=this.safeTimestamp2(e,"update_time","finish_time"));const v="currency_pair"in e?"spot":"contract",w=this.safeString2(e,"currency_pair","market",a),S=this.safeSymbol(w,t,"_",v),k=[],T=this.safeString(e,"gt_fee");T&&k.push({currency:"GT",cost:T});const _=this.safeString(e,"fee");_&&k.push({currency:this.safeCurrencyCode(this.safeString(e,"fee_currency")),cost:_});const O=this.safeString(e,"rebated_fee");O&&k.push({currency:this.safeCurrencyCode(this.safeString(e,"rebated_fee_currency")),cost:r.stringNeg(O)});const M=k.length>1,I=this.parseOrderStatus(u);let x=this.parseNumber(r.stringAbs(p)),C=this.parseNumber(r.stringAbs(f));if("spot"===this.safeString(e,"account")){const t=this.safeString(e,"avg_deal_price");g=this.parseNumber(t),"market"===n&&"buy"===d&&(x=r.stringDiv(p,t),C=r.stringDiv(f,t),c=void 0,m=h,h=r.stringDiv(h,t))}return this.safeOrder({id:this.safeString(e,"id"),clientOrderId:this.safeString(e,"text"),timestamp:y,datetime:this.iso8601(y),lastTradeTimestamp:b,status:I,symbol:S,type:n,timeInForce:o,postOnly:l,reduceOnly:this.safeValue(e,"is_reduce_only"),side:d,price:this.parseNumber(c),stopPrice:this.safeNumber(s,"price"),triggerPrice:this.safeNumber(s,"price"),average:g,amount:this.parseNumber(r.stringAbs(h)),cost:r.stringAbs(m),filled:x,remaining:C,fee:M?void 0:this.safeValue(k,0),fees:M?k:[],trades:void 0,info:e},t)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s=this.safeValue2(i,"is_stop_order","stop",!1);i=this.omit(i,["is_stop_order","stop"]);let r=this.safeString2(i,"text","clientOrderId"),a=e;void 0!==r&&(i=this.omit(i,["text","clientOrderId"]),"t"!==r[0]&&(r="t-"+r),a=r);const n=void 0===t?void 0:this.market(t),[o,h]=this.handleMarketTypeAndParams("fetchOrder",n,i),d="swap"===o||"future"===o,[c,l]=d?this.prepareRequest(n,o,h):this.spotOrderPrepareRequest(n,s,h);c.order_id=a;const u=s?"PriceOrders":"Orders",f=this.getSupportedMapping(o,{spot:"privateSpotGet"+u+"OrderId",margin:"privateSpotGet"+u+"OrderId",swap:"privateFuturesGetSettle"+u+"OrderId",future:"privateDeliveryGetSettle"+u+"OrderId"}),p=await this[f](this.extend(c,l));return this.parseOrder(p,n)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("open",e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("finished",e,t,i,s)}async fetchOrdersByStatus(e,t,i,s,r={}){let a;await this.loadMarkets(),void 0!==t&&(a=this.market(t),t=a.symbol);const n=this.safeValue(r,"stop");r=this.omit(r,"stop");const[o,h]=this.handleMarketTypeAndParams("fetchOrdersByStatus",a,r),d="spot"===o||"margin"===o,[c,l]=d?this.multiOrderSpotPrepareRequest(a,n,h):this.prepareRequest(a,o,h);"closed"===e&&(e="finished"),c.status=e,void 0!==s&&(c.limit=s),void 0!==i&&d&&(c.from=parseInt(i/1e3));let u=n?"PriceOrders":"Orders";const f=d&&"open"===e&&!n;f&&(u="OpenOrders");const p=this.getSupportedMapping(o,{spot:"privateSpotGet"+u,margin:"privateSpotGet"+u,swap:"privateFuturesGetSettle"+u,future:"privateDeliveryGetSettle"+u}),m=await this[p](this.extend(c,l));let g=m;if(f){g=[];for(let e=0;e<m.length;e++){const t=this.safeValue(m[e],"orders");g=this.arrayConcat(g,t)}}const y=this.parseOrders(g,a,i,s);return this.filterBySymbolSinceLimit(y,t,i,s)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s=void 0===t?void 0:this.market(t),r=this.safeValue2(i,"is_stop_order","stop",!1);i=this.omit(i,["is_stop_order","stop"]);const[a,n]=this.handleMarketTypeAndParams("cancelOrder",s,i),[o,h]="spot"===a||"margin"===a?this.spotOrderPrepareRequest(s,r,n):this.prepareRequest(s,a,n);o.order_id=e;const d=r?"Price":"",c=this.getSupportedMapping(a,{spot:"privateSpotDelete"+d+"OrdersOrderId",margin:"privateSpotDelete"+d+"OrdersOrderId",swap:"privateFuturesDeleteSettle"+d+"OrdersOrderId",future:"privateDeliveryDeleteSettle"+d+"OrdersOrderId"}),l=await this[c](this.extend(o,h));return this.parseOrder(l,s)}async cancelAllOrders(e,t={}){await this.loadMarkets();const i=void 0===e?void 0:this.market(e),s=this.safeValue(t,"stop");t=this.omit(t,"stop");const[r,a]=this.handleMarketTypeAndParams("cancelAllOrders",i,t),[n,o]="spot"===r?this.multiOrderSpotPrepareRequest(i,s,a):this.prepareRequest(i,r,a),h=s?"PriceOrders":"Orders",d=this.getSupportedMapping(r,{spot:"privateSpotDelete"+h,margin:"privateSpotDelete"+h,swap:"privateFuturesDeleteSettle"+h,future:"privateDeliveryDeleteSettle"+h}),c=await this[d](this.extend(n,o));return this.parseOrders(c,i)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n=this.convertTypeToAccount(i),o=this.convertTypeToAccount(s),d=this.currencyToPrecision(e,t),c={currency:a.id,amount:d};if(n in this.options.accountsByType?c.from=n:(c.from="margin",c.currency_pair=n),o in this.options.accountsByType?c.to=o:(c.to="margin",c.currency_pair=o),"margin"===n||"margin"===o){const e=this.safeString2(r,"symbol","currency_pair");if(void 0===e)throw new h(this.id+' transfer requires params["symbol"] for isolated margin transfers');const t=this.market(e);c.currency_pair=t.id,r=this.omit(r,"symbol")}"futures"!==o&&"delivery"!==o&&"futures"!==n&&"delivery"!==n||(c.settle=a.lowerCaseId);const l=await this.privateWalletPostTransfers(this.extend(c,r));return this.parseTransfer(l,a)}parseTransfer(e,t){const i=this.milliseconds();return{id:void 0,timestamp:i,datetime:this.iso8601(i),currency:this.safeCurrencyCode(void 0,t),amount:void 0,fromAccount:void 0,toAccount:void 0,status:void 0,info:e}}async setLeverage(e,t,i={}){if(void 0===t)throw new h(this.id+" setLeverage() requires a symbol argument");if(e<0||e>100)throw new o(this.id+" setLeverage() leverage should be between 1 and 100");await this.loadMarkets();const s=this.market(t),r=this.getSupportedMapping(s.type,{swap:"privateFuturesPostSettlePositionsContractLeverage",future:"privateDeliveryPostSettlePositionsContractLeverage"}),[a,n]=this.prepareRequest(s,void 0,i),d=this.safeString2(this.options,"marginMode","defaultMarginMode"),c=this.safeString(n,"cross_leverage_limit");let l=this.safeString(n,"marginMode",d);void 0!==c&&(l="cross",e=c),"cross"===l||"cross_margin"===l?(a.cross_leverage_limit=e.toString(),a.leverage="0"):a.leverage=e.toString();return await this[r](this.extend(a,n))}parsePosition(e,t){const i=this.safeString(e,"contract");t=this.safeMarket(i,t,"_","contract");const s=this.safeString(e,"size");let a;r.stringGt(s,"0")?a="long":r.stringLt(s,"0")&&(a="short");const n=this.safeString(e,"maintenance_rate"),o=this.safeString(e,"value"),h=this.safeString(e,"leverage");let d;d="0"===h?"cross":"isolated";const c=this.safeString(e,"unrealised_pnl"),l=r.stringMul("0.00075",o),u=r.stringAdd(r.stringDiv(o,h),l),f=r.stringMul(r.stringDiv(c,u),"100");return{info:e,id:void 0,symbol:this.safeString(t,"symbol"),timestamp:void 0,datetime:void 0,initialMargin:this.parseNumber(u),initialMarginPercentage:this.parseNumber(r.stringDiv(u,o)),maintenanceMargin:this.parseNumber(r.stringMul(n,o)),maintenanceMarginPercentage:this.parseNumber(n),entryPrice:this.safeNumber(e,"entry_price"),notional:this.parseNumber(o),leverage:this.safeNumber(e,"leverage"),unrealizedPnl:this.parseNumber(c),contracts:this.parseNumber(r.stringAbs(s)),contractSize:this.safeValue(t,"contractSize"),marginRatio:void 0,liquidationPrice:this.safeNumber(e,"liq_price"),markPrice:this.safeNumber(e,"mark_price"),collateral:this.safeNumber(e,"margin"),marginMode:d,side:a,percentage:this.parseNumber(f)}}async fetchPositions(e,t={}){let i;if(await this.loadMarkets(),void 0!==e){if((e=this.marketSymbols(e)).length>0){i=this.market(e[0]);for(let t=1;t<e.length;t++){if(this.market(e[t]).type!==i.type)throw new o(this.id+" fetchPositions() does not support multiple types of positions at the same time")}}}const[s,r]=this.handleMarketTypeAndParams("fetchPositions",i,t);if("swap"!==s&&"future"!==s)throw new h(this.id+' fetchPositions requires a type parameter, "swap" or "future"');const[a,n]=this.prepareRequest(void 0,s,r),d=this.getSupportedMapping(s,{swap:"privateFuturesGetSettlePositions",future:"privateDeliveryGetSettlePositions"}),c=await this[d](this.extend(a,n));return this.parsePositions(c,e)}async fetchLeverageTiers(e,t={}){await this.loadMarkets();const[i,s]=this.handleMarketTypeAndParams("fetchLeverageTiers",void 0,t),[r,a]=this.prepareRequest(void 0,i,s);if("future"!==i&&"swap"!==i)throw new o(this.id+" fetchLeverageTiers only supports swap and future");const n=this.getSupportedMapping(i,{swap:"publicFuturesGetSettleContracts",future:"publicDeliveryGetSettleContracts"}),h=await this[n](this.extend(r,a));return this.parseLeverageTiers(h,e,"name")}parseMarketLeverageTiers(e,t){const i=this.safeString(e,"maintenance_rate"),s=this.safeString(e,"leverage_max"),a=this.safeString(e,"risk_limit_step"),n=this.safeString(e,"risk_limit_max"),o=r.stringDiv("1",s);let h=i,d=o,c="0";const l=[];for(;r.stringLt(c,n);){const s=r.stringAdd(c,a);l.push({tier:this.parseNumber(r.stringDiv(s,a)),currency:this.safeString(t,"settle"),minNotional:this.parseNumber(c),maxNotional:this.parseNumber(s),maintenanceMarginRate:this.parseNumber(h),maxLeverage:this.parseNumber(r.stringDiv("1",d)),info:e}),h=r.stringAdd(h,i),d=r.stringAdd(d,o),c=s}return l}async repayMargin(e,t,i,s={}){const r=this.safeString(s,"marginMode");s=this.omit(s,"marginMode"),this.checkRequiredMarginArgument("repayMargin",i,r),await this.loadMarkets();const a=this.currency(e),n={currency:a.id,amount:this.currencyToPrecision(e,t)};let o;if(void 0===i)o="privateMarginPostCrossRepayments";else{o="privateMarginPostLoansLoanIdRepayment";const e=this.market(i);n.currency_pair=e.id,n.mode="partial";const t=this.safeString2(s,"loan_id","id");if(void 0===t)throw new h(this.id+" repayMargin() requires loan_id param for isolated margin");n.loan_id=t}s=this.omit(s,["marginMode","loan_id","id"]);let d=await this[o](this.extend(n,s));return"cross"===r&&(d=d[0]),this.parseMarginLoan(d,a)}async borrowMargin(e,t,i,s={}){const r=this.safeString(s,"marginMode");s=this.omit(s,"marginMode"),this.checkRequiredMarginArgument("borrowMargin",i,r),await this.loadMarkets();const a=this.currency(e),n={currency:a.id,amount:this.currencyToPrecision(e,t)};let o;if(void 0===i)o="privateMarginPostCrossLoans";else{const e=this.market(i);n.currency_pair=e.id,n.side="borrow",n.rate=this.safeString(s,"rate","0.0001"),n.auto_renew=!0,o="privateMarginPostLoans"}s=this.omit(s,["marginMode","rate"]);const h=await this[o](this.extend(n,s));return this.parseMarginLoan(h,a)}parseMarginLoan(e,t){const i=this.safeString2(this.options,"defaultMarginMode","marginMode","cross");let s=this.safeInteger(e,"create_time");"isolated"===i&&(s=this.safeTimestamp(e,"create_time"));const r=this.safeString(e,"currency"),a=this.safeString(e,"currency_pair");return{id:this.safeInteger(e,"id"),currency:this.safeCurrencyCode(r,t),amount:this.safeNumber(e,"amount"),symbol:this.safeSymbol(a,void 0,"_","margin"),timestamp:s,datetime:this.iso8601(s),info:e}}sign(e,t=[],i="GET",s={},r,a){const n=t[0],o=t[1];let h=this.omit(s,this.extractParams(e));const d=""===(e=this.implodeParams(e,s))?"":"/"+e;let c="/"+o+d;"subAccounts"!==o&&"withdrawals"!==o||(c=d);let l=this.urls.api[n][o];if(void 0===l)throw new b(this.id+" does not have a testnet for the "+o+" market type.");if(l+=c,"public"===n)Object.keys(h).length&&(l+="?"+this.urlencode(h));else{this.checkRequiredCredentials();let t="",s=!1;if(("futures"===o||"delivery"===o)&&"POST"===i){const t=e.split("/"),i=this.safeString(t,1,"");s=i.indexOf("dual")>=0||i.indexOf("positions")>=0}if("GET"===i||"DELETE"===i||s||"PATCH"===i)Object.keys(h).length&&(t=this.urlencode(h),l+="?"+t),"PATCH"===i&&(a=this.json(h));else{const e=this.safeValue(h,"query",{});Object.keys(e).length&&(t=this.urlencode(e),l+="?"+t),h=this.omit(h,"query"),a=this.json(h)}const n=void 0===a?"":a,d=this.hash(this.encode(n),"sha512"),u=this.seconds().toString(),f="/api/"+this.version+c,p=[i.toUpperCase(),f,t,d,u].join("\n"),m=this.hmac(this.encode(p),this.encode(this.secret),"sha512");r={KEY:this.apiKey,Timestamp:u,SIGN:m,"Content-Type":"application/json"}}return{url:l,method:i,body:a,headers:r}}async modifyMarginHelper(e,t,i={}){await this.loadMarkets();const s=this.market(e),[r,a]=this.prepareRequest(s,void 0,i);r.change=this.numberToString(t);const n=this.getSupportedMapping(s.type,{swap:"privateFuturesPostSettlePositionsContractMargin",future:"privateDeliveryPostSettlePositionsContractMargin"}),o=await this[n](this.extend(r,a));return this.parseMarginModification(o,s)}parseMarginModification(e,t){const i=this.safeString(e,"contract");t=this.safeMarket(i,t,"_","contract");const s=this.safeNumber(e,"margin");return{info:e,amount:void 0,code:this.safeValue(t,"quote"),symbol:t.symbol,total:s,status:"ok"}}async reduceMargin(e,t,i={}){return await this.modifyMarginHelper(e,-t,i)}async addMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,i)}async fetchOpenInterestHistory(e,t="5m",i,s,r={}){await this.loadMarkets();const a=this.market(e);if(!a.contract)throw new o(this.id+" fetchOpenInterest() supports contract markets only");const n={contract:a.id,settle:a.settleId,interval:this.safeString(this.timeframes,t,t)};void 0!==s&&(n.limit=s),void 0!==i&&(n.from=i);const h=await this.publicFuturesGetSettleContractStats(this.extend(n,r));return this.parseOpenInterests(h,a,i,s)}parseOpenInterest(e,t){const i=this.safeIntegerProduct(e,"time",1e3);return{symbol:this.safeString(t,"symbol"),openInterestAmount:this.safeNumber(e,"open_interest"),openInterestValue:this.safeNumber(e,"open_interest_usd"),timestamp:i,datetime:this.iso8601(i),info:e}}handleErrors(e,t,i,s,r,a,o,h,d){if(void 0===o)return;const c=this.safeString(o,"label");if(void 0!==c){const e=this.id+" "+a;throw this.throwExactlyMatchedException(this.exceptions.exact,c,e),new n(e)}}}},94663:function(e,t,i){"use strict";const s=i(53927);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"gateio",alias:!0})}}},23094:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,BadRequest:n,OrderNotFound:o,InvalidOrder:h,InvalidNonce:d,InsufficientFunds:c,AuthenticationError:l,PermissionDenied:u,NotSupported:f,OnMaintenance:p,RateLimitExceeded:m,ExchangeNotAvailable:g}=i(73449),{TICK_SIZE:y}=i(62115),b=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"gemini",name:"Gemini",countries:["US"],rateLimit:100,version:"v1",pro:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createDepositAddress:!0,createMarketOrder:!1,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBidsAsks:!1,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!1,fetchDepositAddress:void 0,fetchDepositAddressesByNetwork:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactions:!0,postOnly:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/27816857-ce7be644-6096-11e7-82d6-3c257263229c.jpg",api:{public:"https://api.gemini.com",private:"https://api.gemini.com",web:"https://docs.gemini.com"},www:"https://gemini.com/",doc:["https://docs.gemini.com/rest-api","https://docs.sandbox.gemini.com"],test:{public:"https://api.sandbox.gemini.com",private:"https://api.sandbox.gemini.com",web:"https://docs.gemini.com"},fees:["https://gemini.com/api-fee-schedule","https://gemini.com/trading-fees","https://gemini.com/transfer-fees"]},api:{web:{get:["rest-api"]},public:{get:{"v1/symbols":5,"v1/symbols/details/{symbol}":5,"v1/staking/rates":5,"v1/pubticker/{symbol}":5,"v2/ticker/{symbol}":5,"v2/candles/{symbol}/{timeframe}":5,"v1/trades/{symbol}":5,"v1/auction/{symbol}":5,"v1/auction/{symbol}/history":5,"v1/pricefeed":5,"v1/book/{symbol}":5,"v1/earn/rates":5}},private:{post:{"v1/staking/unstake":1,"v1/staking/stake":1,"v1/staking/rewards":1,"v1/staking/history":1,"v1/order/new":1,"v1/order/cancel":1,"v1/wrap/{symbol}":1,"v1/order/cancel/session":1,"v1/order/cancel/all":1,"v1/order/status":1,"v1/orders":1,"v1/mytrades":1,"v1/notionalvolume":1,"v1/tradevolume":1,"v1/clearing/new":1,"v1/clearing/status":1,"v1/clearing/cancel":1,"v1/clearing/confirm":1,"v1/balances":1,"v1/balances/staking":1,"v1/notionalbalances/{currency}":1,"v1/transfers":1,"v1/addresses/{network}":1,"v1/deposit/{network}/newAddress":1,"v1/deposit/{currency}/newAddress":1,"v1/withdraw/{currency}":1,"v1/account/transfer/{currency}":1,"v1/payments/addbank":1,"v1/payments/methods":1,"v1/payments/sen/withdraw":1,"v1/balances/earn":1,"v1/earn/interest":1,"v1/earn/history":1,"v1/approvedAddresses/{network}/request":1,"v1/approvedAddresses/account/{network}":1,"v1/approvedAddresses/{network}/remove":1,"v1/account":1,"v1/account/create":1,"v1/account/list":1,"v1/heartbeat":1}}},precisionMode:y,fees:{trading:{taker:.004,maker:.002}},httpExceptions:{400:n,403:u,404:o,406:c,429:m,500:r,502:g,503:p},timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1hr","6h":"6hr","1d":"1day"},exceptions:{exact:{AuctionNotOpen:n,ClientOrderIdTooLong:n,ClientOrderIdMustBeString:n,ConflictingOptions:n,EndpointMismatch:n,EndpointNotFound:n,IneligibleTiming:n,InsufficientFunds:c,InvalidJson:n,InvalidNonce:d,InvalidOrderType:h,InvalidPrice:h,InvalidQuantity:h,InvalidSide:h,InvalidSignature:l,InvalidSymbol:n,InvalidTimestampInPayload:n,Maintenance:p,MarketNotOpen:h,MissingApikeyHeader:l,MissingOrderField:h,MissingRole:l,MissingPayloadHeader:l,MissingSignatureHeader:l,NoSSL:l,OptionsMustBeArray:n,OrderNotFound:o,RateLimit:m,System:r,UnsupportedOption:n},broad:{"The Gemini Exchange is currently undergoing maintenance.":p,"We are investigating technical issues with the Gemini Exchange.":g}},options:{fetchMarketsMethod:"fetch_markets_from_web",fetchMarketFromWebRetries:10,fetchMarketsFromAPI:{fetchDetailsForAllSymbols:!1,fetchDetailsForMarketIds:[]},fetchUsdtMarkets:["btcusdt","ethusdt"],fetchTickerMethod:"fetchTickerV1",networkIds:{bitcoin:"BTC",ethereum:"ERC20",bitcoincash:"BCH",litecoin:"LTC",zcash:"ZEC",filecoin:"FIL",dogecoin:"DOGE",tezos:"XTZ"},networks:{BTC:"bitcoin",ERC20:"ethereum",BCH:"bitcoincash",LTC:"litecoin",ZEC:"zcash",FIL:"filecoin",DOGE:"dogecoin",XTZ:"tezos"},nonce:"milliseconds"}})}async fetchMarkets(e={}){if("fetch_markets_from_web"===this.safeValue(this.options,"fetchMarketsMethod","fetch_markets_from_api")){const t=await this.fetchMarketsFromWeb(e),i=await this.fetchUSDTMarkets(e);return this.arrayConcat(t,i)}return await this.fetchMarketsFromAPI(e)}async fetchMarketsFromWeb(e={}){const t=this.safeInteger(this.options,"fetchMarketFromWebRetries",10);let i,s=0;for(;s<t;)try{i=await this.webGetRestApi(e);break}catch(e){if(s+=1,s===t)throw e}const r=i.split('<h1 id="symbols-and-minimums">Symbols and minimums</h1>'),a=r.length,n=this.id+" fetchMarketsFromWeb() the "+this.name+" API doc HTML markup has changed, breaking the parser of order limits and precision info for "+this.name+" markets.";if(2!==a)throw new f(n);const o=r[1].split("tbody>");if(o.length<2)throw new f(n);const h=o[1].split("\n<tr>\n"),d=h.length;if(d<2)throw new f(n);const c=[];for(let e=1;e<d;e++){const t=h[e],i=t.split("</td>\n");if(i.length<5)throw new f(n);const s=i[0].replace("<td>",""),r=i[1].replace("<td>","").split(" "),a=this.safeNumber(r,0),o=i[2].replace("<td>","").split(" "),d=s.length-0,l=d-3,u=i[3].replace("<td>","").split(" "),p=this.safeStringLower(u,1,s.slice(l,d)),m=this.safeStringLower(o,1,s.replace(p,"")),g=this.safeCurrencyCode(m),y=this.safeCurrencyCode(p);c.push({id:s,symbol:g+"/"+y,base:g,quote:y,settle:void 0,baseId:m,quoteId:p,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(o,0),price:this.safeNumber(u,0)},limits:{leverage:{min:void 0,max:void 0},amount:{min:a,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return c}parseMarketActive(e){return this.safeValue({open:!0,closed:!1,cancel_only:!0,post_only:!0,limit_only:!0},e,!0)}async fetchUSDTMarkets(e={}){if("test"in this.urls)return[];const t=this.safeValue(this.options,"fetchUsdtMarkets",[]),i=[];for(let s=0;s<t.length;s++){const r={symbol:t[s]},a=await this.publicGetV1SymbolsDetailsSymbol(this.extend(r,e));i.push(this.parseMarket(a))}return i}async fetchMarketsFromAPI(e={}){const t=await this.publicGetV1Symbols(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r={symbol:s};i[s]=this.parseMarket(r)}const s=this.safeValue(this.options,"fetchMarketsFromAPI",{}),r=this.safeValue(s,"fetchDetailsForAllSymbols",!1),a=this.safeValue(s,"fetchDetailsForMarketIds",[]);let n=[],o=[];o=r?t:a;for(let t=0;t<o.length;t++){const i="publicGetV1SymbolsDetailsSymbol",s={symbol:o[t]};n.push(this[i](this.extend(s,e)))}n=await Promise.all(n);for(let e=0;e<n.length;e++){const t=n[e];i[this.safeStringLower(t,"symbol")]=this.parseMarket(t)}return this.toArray(i)}parseMarket(e){const t=this.safeStringLower(e,"symbol");let i=this.safeString(e,"base_currency"),s=this.safeString(e,"quote_currency");if(void 0===i){const e=t.length-0,r=-1!==t.indexOf("usdt")?4:3;i=t.slice(0,e-r),s=t.slice(e-r,e)}const r=this.safeCurrencyCode(i),a=this.safeCurrencyCode(s),n=this.safeString(e,"status");return{id:t,symbol:r+"/"+a,base:r,quote:a,settle:void 0,baseId:i,quoteId:s,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:this.parseMarketActive(n),contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{price:this.safeNumber(e,"quote_increment"),amount:this.safeNumber(e,"tick_size")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(e,"min_order_size"),max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:e}}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};void 0!==t&&(r.limit_bids=t,r.limit_asks=t);const a=await this.publicGetV1BookSymbol(this.extend(r,i));return this.parseOrderBook(a,s.symbol,void 0,"bids","asks","price","amount")}async fetchTickerV1(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetV1PubtickerSymbol(this.extend(s,t));return this.parseTicker(r,i)}async fetchTickerV2(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetV2TickerSymbol(this.extend(s,t));return this.parseTicker(r,i)}async fetchTickerV1AndV2(e,t={}){const i=await this.fetchTickerV1(e,t),s=await this.fetchTickerV2(e,t);return this.deepExtend(i,{open:s.open,high:s.high,low:s.low,change:s.change,percentage:s.percentage,average:s.average,info:s.info})}async fetchTicker(e,t={}){const i=this.safeValue(this.options,"fetchTickerMethod","fetchTickerV1");return await this[i](e,t)}parseTicker(e,t){const i=this.safeValue(e,"volume",{}),s=this.safeInteger(i,"timestamp");let r;const a=this.safeStringLower(e,"pair");let n,o,h,d;if(t=this.safeMarket(a,t),void 0!==a&&void 0===t){7===a.length-0?(n=a.slice(0,4),o=a.slice(4,7)):(n=a.slice(0,3),o=a.slice(3,6)),h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o),r=h+"/"+d}void 0===r&&void 0!==t&&(r=t.symbol,n=this.safeStringUpper(t,"baseId"),o=this.safeStringUpper(t,"quoteId"));const c=this.safeString(e,"price"),l=this.safeString2(e,"last","close",c),u=this.safeString(e,"percentChange24h"),f=this.safeString(e,"open"),p=this.safeString(i,n),m=this.safeString(i,o);return this.safeTicker({symbol:r,timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:f,close:l,last:l,previousClose:void 0,change:void 0,percentage:u,average:void 0,baseVolume:p,quoteVolume:m,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetV1Pricefeed(t);return this.parseTickers(i,e)}parseTrade(e,t){const i=this.safeInteger(e,"timestampms"),s=this.safeString(e,"tid"),r=this.safeString(e,"order_id"),a=this.safeString(e,"fee_currency"),n=this.safeCurrencyCode(a),o={cost:this.safeString(e,"fee_amount"),currency:n},h=this.safeString(e,"price"),d=this.safeString(e,"amount"),c=this.safeStringLower(e,"type"),l=this.safeSymbol(void 0,t);return this.safeTrade({id:s,order:r,info:e,timestamp:i,datetime:this.iso8601(i),symbol:l,type:void 0,side:c,takerOrMaker:void 0,price:h,cost:void 0,amount:d,fee:o},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.limit_trades=i),void 0!==t&&(a.timestamp=t);const n=await this.publicGetV1TradesSymbol(this.extend(a,s));return this.parseTrades(n,r,t,i)}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"available"),n.total=this.safeString(s,"amount"),t[a]=n}return this.safeBalance(t)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privatePostV1Notionalvolume(e),i=this.safeString(t,"api_maker_fee_bps"),s=this.safeString(t,"api_taker_fee_bps"),r=b.stringDiv(i,"10000"),a=b.stringDiv(s,"10000"),n=this.parseNumber(r),o=this.parseNumber(a),h={};for(let e=0;e<this.symbols.length;e++){const i=this.symbols[e];h[i]={info:t,symbol:i,maker:n,taker:o,percentage:!0,tierBased:!0}}return h}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostV1Balances(e);return this.parseBalance(t)}parseOrder(e,t){const i=this.safeInteger(e,"timestampms"),s=this.safeString(e,"original_amount"),r=this.safeString(e,"remaining_amount"),a=this.safeString(e,"executed_amount");let n="closed";e.is_live&&(n="open"),e.is_cancelled&&(n="canceled");const o=this.safeString(e,"price"),h=this.safeString(e,"avg_execution_price");let d=this.safeString(e,"type");d="exchange limit"===d?"limit":"market buy"===d||"market sell"===d?"market":e.type;const c=this.safeString(e,"symbol"),l=this.safeSymbol(c,t),u=this.safeString(e,"order_id"),f=this.safeStringLower(e,"side"),p=this.safeString(e,"client_order_id"),m=this.safeValue(e,"options",[]),g=this.safeString(m,0);let y="GTC",b=!1;return void 0!==g&&("immediate-or-cancel"===g?y="IOC":"fill-or-kill"===g?y="FOK":"maker-or-cancel"===g&&(y="PO",b=!0)),this.safeOrder({id:u,clientOrderId:p,info:e,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:void 0,status:n,symbol:l,type:d,timeInForce:y,postOnly:b,side:f,price:o,stopPrice:void 0,triggerPrice:void 0,average:h,cost:void 0,amount:s,filled:a,remaining:r,fee:undefined,trades:void 0},t)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={order_id:e},r=await this.privatePostV1OrderStatus(this.extend(s,i));return this.parseOrder(r)}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r=await this.privatePostV1Orders(s);let a;return void 0!==e&&(a=this.market(e)),this.parseOrders(r,a,t,i)}async createOrder(e,t,i,s,n,o={}){if(await this.loadMarkets(),"limit"!==t)throw new r(this.id+" createOrder() allows limit orders only");let h=this.safeString2(o,"clientOrderId","client_order_id");o=this.omit(o,["clientOrderId","client_order_id"]),void 0===h&&(h=this.milliseconds().toString());const d=this.market(e),c=this.amountToPrecision(e,s),l=this.priceToPrecision(e,n),u={client_order_id:h.toString(),symbol:d.id,amount:c,price:l,side:i,type:"exchange limit"};t=this.safeString(o,"type",t),o=this.omit(o,"type");const f=this.safeString2(o,"stop_price","stopPrice");if(o=this.omit(o,["stop_price","stopPrice","type"]),"stopLimit"===t)throw new a(this.id+" createOrder() requires a stopPrice parameter or a stop_price parameter for "+t+" orders");if(void 0!==f)u.stop_price=this.priceToPrecision(e,f),u.type="exchange stop limit";else{const e=this.safeString(o,"timeInForce");o=this.omit(o,"timeInForce"),void 0!==e&&("IOC"===e||"immediate-or-cancel"===e?u.options=["immediate-or-cancel"]:"FOK"===e||"fill-or-kill"===e?u.options=["fill-or-kill"]:"PO"===e&&(u.options=["maker-or-cancel"]));const t=this.safeValue(o,"postOnly",!1);o=this.omit(o,"postOnly"),t&&(u.options=["maker-or-cancel"]);const i=this.safeString(o,"options");void 0!==i&&(u.options=[i])}const p=await this.privatePostV1OrderNew(this.extend(u,o));return this.parseOrder(p)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={order_id:e},r=await this.privatePostV1OrderCancel(this.extend(s,i));return this.parseOrder(r)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={symbol:r.id};void 0!==i&&(n.limit_trades=i),void 0!==t&&(n.timestamp=parseInt(t/1e3));const o=await this.privatePostV1Mytrades(this.extend(n,s));return this.parseTrades(o,r,t,i)}async withdraw(e,t,i,s,a={}){[s,a]=this.handleWithdrawTagAndParams(s,a),this.checkAddress(i),await this.loadMarkets();const n=this.currency(e),o={currency:n.id,amount:t,address:i},h=await this.privatePostV1WithdrawCurrency(this.extend(o,a));if("error"===this.safeString(h,"result"))throw new r(this.id+" withdraw() failed: "+this.json(h));return this.parseTransaction(h,n)}nonce(){return"milliseconds"===this.safeString(this.options,"nonce","milliseconds")?this.milliseconds():this.seconds()}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();const r={};void 0!==i&&(r.limit_transfers=i),void 0!==t&&(r.timestamp=t);const a=await this.privatePostV1Transfers(this.extend(r,s));return this.parseTransactions(a)}parseTransaction(e,t){const i=this.safeInteger(e,"timestampms"),s=this.safeString(e,"currency"),r=this.safeCurrencyCode(s,t),a=this.safeString(e,"destination"),n=this.safeStringLower(e,"type"),o=this.safeString(e,"status");let h;const d=this.safeNumber(e,"feeAmount");return void 0!==d&&(h={cost:d,currency:r}),{info:e,id:this.safeString2(e,"eid","withdrawalId"),txid:this.safeString(e,"txHash"),timestamp:i,datetime:this.iso8601(i),network:void 0,address:a,addressTo:void 0,addressFrom:void 0,tag:void 0,tagTo:void 0,tagFrom:void 0,type:n,amount:this.safeNumber(e,"amount"),currency:r,status:this.parseTransactionStatus(o),updated:void 0,fee:h}}parseTransactionStatus(e){return this.safeString({Advanced:"ok",Complete:"ok"},e,e)}parseDepositAddress(e,t){const i=this.safeString(e,"address");return{currency:this.safeCurrencyCode(void 0,t),network:void 0,address:i,tag:void 0,info:e}}async fetchDepositAddressesByNetwork(e,t={}){await this.loadMarkets();const i=this.safeString(t,"network");if(void 0===i)throw new a(this.id+" fetchDepositAddressesByNetwork() requires a network parameter");t=this.omit(t,"network");const s=this.safeValue(this.options,"networks",{}),r=this.safeString(s,i,i),n=this.safeValue(this.options,"networkIds",{}),o=this.safeString(n,r,i),h={network:r},d=await this.privatePostV1AddressesNetwork(this.extend(h,t)),c=this.parseDepositAddresses(d,[e],!1,{network:o,currency:e});return this.groupBy(c,"network")}sign(e,t="public",i="GET",s={},r,a){let n="/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if("private"===t){this.checkRequiredCredentials();if(this.apiKey.indexOf("account")<0)throw new l(this.id+" sign() requires an account-key, master-keys are not-supported");const e=this.nonce(),t=this.extend({request:n,nonce:e},o);let i=this.json(t);i=this.stringToBase64(i);const s=this.hmac(i,this.encode(this.secret),"sha384");r={"Content-Type":"text/plain","X-GEMINI-APIKEY":this.apiKey,"X-GEMINI-PAYLOAD":this.decode(i),"X-GEMINI-SIGNATURE":s}}else Object.keys(o).length&&(n+="?"+this.urlencode(o));return n=this.urls.api[t]+n,"POST"!==i&&"DELETE"!==i||(a=this.json(o)),{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o){if("string"==typeof n){const e=this.id+" "+n;this.throwBroadlyMatchedException(this.exceptions.broad,n,e)}return}if("error"===this.safeString(o,"result")){const e=this.safeString(o,"reason"),t=this.safeString(o,"message"),i=this.id+" "+t;throw this.throwExactlyMatchedException(this.exceptions.exact,e,i),this.throwExactlyMatchedException(this.exceptions.exact,t,i),this.throwBroadlyMatchedException(this.exceptions.broad,t,i),new r(i)}}async createDepositAddress(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=await this.privatePostV1DepositCurrencyNewAddress(this.extend(i,t)),r=this.safeString(s,"address");return this.checkAddress(r),{currency:e,address:r,tag:void 0,info:s}}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={timeframe:this.safeString(this.timeframes,t,t),symbol:a.id},o=await this.publicGetV2CandlesSymbolTimeframe(this.extend(n,r));return this.parseOHLCVs(o,a,t,i,s)}}},28267:function(e,t,i){"use strict";const s=i(48819),{BadSymbol:r,PermissionDenied:a,ExchangeError:n,ExchangeNotAvailable:o,OrderNotFound:h,InsufficientFunds:d,InvalidOrder:c,RequestTimeout:l,AuthenticationError:u}=i(73449),{TRUNCATE:f,TICK_SIZE:p}=i(62115),m=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"hitbtc",name:"HitBTC",countries:["HK"],rateLimit:3.333,version:"2",pro:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createDepositAddress:!0,createOrder:!0,createReduceOnlyOrder:!1,editOrder:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDeposits:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrder:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchOrderTrades:!0,fetchPosition:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!1,fetchTransactions:!0,fetchWithdrawals:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!0,withdraw:!0},timeframes:{"1m":"M1","3m":"M3","5m":"M5","15m":"M15","30m":"M30","1h":"H1","4h":"H4","1d":"D1","1w":"D7","1M":"1M"},urls:{logo:"https://user-images.githubusercontent.com/1294454/27766555-8eaec20e-5edc-11e7-9c5b-6dc69fc42f5e.jpg",test:{public:"https://api.demo.hitbtc.com",private:"https://api.demo.hitbtc.com"},api:{public:"https://api.hitbtc.com",private:"https://api.hitbtc.com"},www:"https://hitbtc.com",referral:"https://hitbtc.com/?ref_id=5a5d39a65d466",doc:["https://api.hitbtc.com/v2"],fees:["https://hitbtc.com/fees-and-limits","https://support.hitbtc.com/hc/en-us/articles/115005148605-Fees-and-limits"]},api:{public:{get:{currency:3,"currency/{currency}":3,symbol:3,"symbol/{symbol}":3,ticker:3,"ticker/{symbol}":3,trades:3,"trades/{symbol}":3,orderbook:3,"orderbook/{symbol}":3,candles:3,"candles/{symbol}":3}},private:{get:{"trading/balance":15.0015,order:15.0015,"order/{clientOrderId}":15.0015,"trading/fee/all":15.0015,"trading/fee/{symbol}":15.0015,"margin/account":15.0015,"margin/account/{symbol}":15.0015,"margin/position":15.0015,"margin/position/{symbol}":15.0015,"margin/order":15.0015,"margin/order/{clientOrderId}":15.0015,"history/order":15.0015,"history/trades":15.0015,"history/order/{orderId}/trades":15.0015,"account/balance":15.0015,"account/crypto/address/{currency}":15.0015,"account/crypto/addresses/{currency}":15.0015,"account/crypto/used-addresses/{currency}":15.0015,"account/crypto/estimate-withdraw":15.0015,"account/crypto/is-mine/{address}":15.0015,"account/transactions":15.0015,"account/transactions/{id}":15.0015,"sub-acc":15.0015,"sub-acc/acl":15.0015,"sub-acc/balance/{subAccountUserID}":15.0015,"sub-acc/deposit-address/{subAccountUserId}/{currency}":15.0015},post:{order:1,"margin/order":1,"account/crypto/address/{currency}":1,"account/crypto/withdraw":1,"account/crypto/transfer-convert":1,"account/transfer":1,"account/transfer/internal":1,"sub-acc/freeze":1,"sub-acc/activate":1,"sub-acc/transfer":1},put:{"order/{clientOrderId}":1,"margin/account/{symbol}":1,"margin/order/{clientOrderId}":1,"account/crypto/withdraw/{id}":1,"sub-acc/acl/{subAccountUserId}":1},delete:{order:1,"order/{clientOrderId}":1,"margin/account":1,"margin/account/{symbol}":1,"margin/position":1,"margin/position/{symbol}":1,"margin/order":1,"margin/order/{clientOrderId}":1,"account/crypto/withdraw/{id}":1},patch:{"order/{clientOrderId}":1}}},precisionMode:p,fees:{trading:{tierBased:!1,percentage:!0,maker:this.parseNumber("0.001"),taker:this.parseNumber("0.002")}},options:{networks:{ETH:"T20",ERC20:"T20",TRX:"TTRX",TRC20:"TTRX",OMNI:""},defaultTimeInForce:"FOK",accountsByType:{funding:"bank",spot:"exchange"},fetchBalanceMethod:{account:"account",bank:"account",main:"account",funding:"account",exchange:"trading",spot:"trading",trade:"trading",trading:"trading"}},commonCurrencies:{AUTO:"Cube",BCC:"BCC",BDP:"BidiPass",BET:"DAO.Casino",BIT:"BitRewards",BOX:"BOX Token",CPT:"Cryptaur",GET:"Themis",GMT:"GMT Token",HSR:"HC",IQ:"IQ.Cash",LNC:"LinkerCoin",PLA:"PlayChip",PNT:"Penta",SBTC:"Super Bitcoin",STEPN:"GMT",STX:"STOX",TV:"Tokenville",USD:"USDT",XMT:"MTL",XPNT:"PNT"},exceptions:{504:l,1002:u,1003:a,2010:c,2001:r,2011:c,2020:c,20002:h,20001:d,20010:r,20045:c}})}feeToPrecision(e,t){return this.decimalToPrecision(t,f,1e-8,p)}async fetchMarkets(e={}){const t=await this.publicGetSymbol(e),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"id"),a=this.safeString(s,"baseCurrency"),n=this.safeString(s,"quoteCurrency"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n);let d=o+"/"+h;r.indexOf("_")>=0&&(d=r);const c=this.safeString(s,"quantityIncrement"),l=this.safeString(s,"tickSize"),u=this.parseNumber(c),f=this.parseNumber(l),p=this.safeString(s,"feeCurrency");i.push(this.extend(this.fees.trading,{id:r,symbol:d,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:!0,contract:!1,linear:void 0,inverse:void 0,taker:this.safeNumber(s,"takeLiquidityRate"),maker:this.safeNumber(s,"provideLiquidityRate"),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,feeCurrency:this.safeCurrencyCode(p),precision:{amount:u,price:f},limits:{leverage:{min:void 0,max:void 0},amount:{min:u,max:void 0},price:{min:f,max:void 0},cost:{min:this.parseNumber(m.stringMul(c,l)),max:void 0}},info:s}))}return i}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),o=this.currencyToPrecision(e,t),h={currency:a.id,amount:o};let d=this.safeString(r,"type");if(void 0===d){const e=this.safeValue(this.options,"accountsByType",{}),t=this.safeString(e,i,i),r=this.safeString(e,s,s);if(t===r)throw new n(this.id+" transfer() from and to cannot be the same account");d=t+"To"+this.capitalize(r)}h.type=d;const c=await this.privatePostAccountTransfer(this.extend(h,r));return this.parseTransfer(c,a)}parseTransfer(e,t){const i=this.milliseconds();return{id:this.safeString(e,"id"),timestamp:i,datetime:this.iso8601(i),currency:this.safeCurrencyCode(void 0,t),amount:void 0,fromAccount:void 0,toAccount:void 0,status:void 0,info:e}}async fetchCurrencies(e={}){const t=await this.publicGetCurrency(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"id"),a=this.safeString(s,"precisionTransfer","8"),n=this.safeCurrencyCode(r),o=this.safeValue(s,"payinEnabled"),h=this.safeValue(s,"payoutEnabled"),d=this.safeValue(s,"transferEnabled");let c=o&&h&&d;"disabled"in s&&s.disabled&&(c=!1);let l="fiat";"crypto"in s&&s.crypto&&(l="crypto");const u=this.safeString(s,"fullName");i[n]={id:r,code:n,type:l,payin:o,payout:h,transfer:d,info:s,name:u,active:c,deposit:o,withdraw:h,fee:this.safeNumber(s,"payoutFee"),precision:this.parseNumber(this.parsePrecision(a)),limits:{amount:{min:void 0,max:void 0},withdraw:{min:void 0,max:void 0}}}}return i}parseTradingFee(e,t){return{info:e,symbol:this.safeSymbol(void 0,t),maker:this.safeNumber(e,"provideLiquidityRate"),taker:this.safeNumber(e,"takeLiquidityRate"),percentage:!0,tierBased:!0}}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.privateGetTradingFeeSymbol(s);return this.parseTradingFee(r,i)}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"available"),n.used=this.safeString(s,"reserved"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=this.safeString(e,"type","trading"),i=this.safeValue(this.options,"fetchBalanceMethod",{}),s=this.safeString(i,t);if(void 0===s)throw new n(this.id+" fetchBalance() account type must be either main or trading");const r="privateGet"+this.capitalize(s)+"Balance",a=this.omit(e,"type"),o=await this[r](a);return this.parseBalance(o)}parseOHLCV(e,t){return[this.parse8601(this.safeString(e,"timestamp")),this.safeNumber(e,"open"),this.safeNumber(e,"max"),this.safeNumber(e,"min"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,period:this.safeString(this.timeframes,t,t)};void 0!==i&&(n.from=this.iso8601(i)),void 0!==s&&(n.limit=s);const o=await this.publicGetCandlesSymbol(this.extend(n,r));return this.parseOHLCVs(o,a,t,i,s)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};void 0!==t&&(r.limit=t);const a=await this.publicGetOrderbookSymbol(this.extend(r,i));return this.parseOrderBook(a,s.symbol,void 0,"bid","ask","price","size")}parseTicker(e,t){const i=this.parse8601(e.timestamp),s=this.safeSymbol(void 0,t),r=this.safeString(e,"volume"),a=this.safeString(e,"volumeQuote"),n=this.safeString(e,"open"),o=this.safeString(e,"last");return this.safeTicker({symbol:s,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:n,close:o,last:o,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:r,quoteVolume:a,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetTicker(t),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"symbol"),a=this.safeMarket(r);s[a.symbol]=this.parseTicker(t,a)}return this.filterByArray(s,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetTickerSymbol(this.extend(s,t));if("message"in r)throw new n(this.id+" "+r.message);return this.parseTicker(r,i)}parseTrade(e,t){const i=this.parse8601(e.timestamp),s=this.safeString(e,"symbol"),r=(t=this.safeMarket(s,t)).symbol;let a;const n=this.safeString(e,"fee");if(void 0!==n){a={cost:n,currency:t?t.feeCurrency:void 0}}const o=this.safeString(e,"clientOrderId"),h=this.safeString(e,"price"),d=this.safeString(e,"quantity"),c=this.safeString(e,"side"),l=this.safeString(e,"id");return this.safeTrade({info:e,id:l,order:o,timestamp:i,datetime:this.iso8601(i),symbol:r,type:void 0,side:c,takerOrMaker:void 0,price:h,amount:d,cost:void 0,fee:a},t)}async fetchTransactions(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.currency(e),a.asset=r.id),void 0!==t&&(a.startTime=t);const n=await this.privateGetAccountTransactions(this.extend(a,s));return this.parseTransactions(n,r,t,i)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=this.parse8601(this.safeString(e,"createdAt")),r=this.parse8601(this.safeString(e,"updatedAt")),a=this.safeString(e,"currency"),n=this.safeCurrencyCode(a,t),o=this.parseTransactionStatus(this.safeString(e,"status")),h=this.safeNumber(e,"amount"),d=this.safeString(e,"address"),c=this.safeString(e,"hash"),l={currency:void 0,cost:void 0,rate:void 0},u=this.safeNumber(e,"fee");void 0!==u&&(l.cost=u,l.currency=n);return{info:e,id:i,txid:c,type:this.parseTransactionType(this.safeString(e,"type")),currency:n,network:void 0,amount:h,status:o,timestamp:s,datetime:this.iso8601(s),address:d,addressFrom:void 0,addressTo:void 0,tag:void 0,tagFrom:void 0,tagTo:void 0,updated:r,comment:void 0,fee:l}}parseTransactionStatus(e){return this.safeString({pending:"pending",failed:"failed",success:"ok"},e,e)}parseTransactionType(e){return this.safeString({payin:"deposit",payout:"withdrawal",withdraw:"withdrawal"},e,e)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.limit=i),void 0!==t&&(a.sort="ASC",a.from=this.iso8601(t));const n=await this.publicGetTradesSymbol(this.extend(a,s));return this.parseTrades(n,r,t,i)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);let o=this.uuid().split("-").join("");o=o.slice(0,32),s=parseFloat(s);const h={clientOrderId:o,symbol:n.id,side:i,quantity:this.amountToPrecision(e,s),type:t};"limit"===t?h.price=this.priceToPrecision(e,r):h.timeInForce=this.options.defaultTimeInForce;const d=await this.privatePostOrder(this.extend(h,a)),l=this.parseOrder(d);if("rejected"===l.status)throw new c(this.id+" order was rejected by the exchange "+this.json(l));return l}async editOrder(e,t,i,s,r,a,n={}){await this.loadMarkets();let o=this.uuid().split("-").join("");o=o.slice(0,32);const h={clientOrderId:e,requestClientId:o};void 0!==r&&(h.quantity=this.amountToPrecision(t,r)),void 0!==a&&(h.price=this.priceToPrecision(t,a));const d=await this.privatePatchOrderClientOrderId(this.extend(h,n));return this.parseOrder(d)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={clientOrderId:e},r=await this.privateDeleteOrderClientOrderId(this.extend(s,i));return this.parseOrder(r)}parseOrderStatus(e){return this.safeString({new:"open",suspended:"open",partiallyFilled:"open",filled:"closed",canceled:"canceled",expired:"failed"},e,e)}parseOrder(e,t){const i=this.parse8601(this.safeString(e,"createdAt")),s=this.parse8601(this.safeString(e,"updatedAt")),r=this.safeString(e,"symbol"),a=(t=this.safeMarket(r,t)).symbol,n=this.safeString(e,"quantity"),o=this.safeString(e,"cumQuantity"),h=this.parseOrderStatus(this.safeString(e,"status")),d=this.safeString(e,"clientOrderId"),c=d,l=this.safeString(e,"price"),u=this.safeString(e,"type"),f=this.safeString(e,"side"),p=this.safeValue(e,"tradesReport"),m=this.safeString(e,"avgPrice"),g=this.safeString(e,"timeInForce");return this.safeOrder({id:d,clientOrderId:c,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:s,status:h,symbol:a,type:u,timeInForce:g,side:f,price:l,stopPrice:void 0,triggerPrice:void 0,average:m,amount:n,cost:void 0,filled:o,remaining:void 0,fee:undefined,trades:p,info:e},t)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={clientOrderId:e},r=await this.privateGetHistoryOrder(this.extend(s,i));if(r.length>0)return this.parseOrder(r[0]);throw new h(this.id+" order "+e+" not found")}async fetchOpenOrder(e,t,i={}){await this.loadMarkets();const s={clientOrderId:e},r=await this.privateGetOrderClientOrderId(this.extend(s,i));return this.parseOrder(r)}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.symbol=r.id);const n=await this.privateGetOrder(this.extend(a,s));return this.parseOrders(n,r,t,i)}async fetchClosedOrders(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.symbol=r.id),void 0!==i&&(a.limit=i),void 0!==t&&(a.from=this.iso8601(t));const n=await this.privateGetHistoryOrder(this.extend(a,s)),o=this.parseOrders(n,r),h=[];for(let e=0;e<o.length;e++){const t=o[e],i=t.status;"closed"!==i&&"canceled"!==i||h.push(t)}return this.filterBySinceLimit(h,t,i)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.symbol=a.id),void 0!==t&&(r.from=this.iso8601(t)),void 0!==i&&(r.limit=i);const n=await this.privateGetHistoryTrades(this.extend(r,s));return this.parseTrades(n,a,t,i)}async fetchOrderTrades(e,t,i,s,r={}){let a;await this.loadMarkets(),void 0!==t&&(a=this.market(t));const n={orderId:e},o=await this.privateGetHistoryOrderOrderIdTrades(this.extend(n,r));if(o.length>0)return this.parseTrades(o,a,i,s);throw new h(this.id+" order "+e+" not found, "+this.id+'.fetchOrderTrades() requires an exchange-specific order id, you need to grab it from order["info"]["id"]')}async createDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},r=await this.privatePostAccountCryptoAddressCurrency(this.extend(s,t)),a=this.safeString(r,"address");this.checkAddress(a);return{currency:i,address:a,tag:this.safeString(r,"paymentId"),info:r}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},r=this.safeString(t,"network");if(void 0!==r){t=this.omit(t,"network");const e=this.safeValue(this.options,"networks"),i=this.safeString(e,r,r);s.currency+=i}const a=await this.privateGetAccountCryptoAddressCurrency(this.extend(s,t)),n=this.safeString(a,"address");this.checkAddress(n);const o=this.safeString(a,"paymentId");return{currency:i.code,address:n,tag:o,network:void 0,info:a}}async convertCurrencyNetwork(e,t,i,s,r){await this.loadMarkets();const a=this.currency(e),o=this.safeValue(this.options,"networks",{});if((i=this.safeString(o,i,i))===(s=this.safeString(o,s,s)))throw new n(this.id+" convertCurrencyNetwork() fromNetwork cannot be the same as toNetwork");const h={fromCurrency:a.id+i,toCurrency:a.id+s,amount:parseFloat(this.currencyToPrecision(e,t))};return{info:await this.privatePostAccountCryptoTransferConvert(this.extend(h,r))}}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets(),this.checkAddress(i);const a=this.currency(e),n={currency:a.id,amount:parseFloat(t),address:i};s&&(n.paymentId=s);const o=this.safeValue(this.options,"networks",{});let h=this.safeStringUpper(r,"network");h=this.safeString(o,h,h),void 0!==h&&(n.currency+=h,r=this.omit(r,"network"));const d=await this.privatePostAccountCryptoWithdraw(this.extend(n,r));return this.parseTransaction(d,a)}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n="/api/"+this.version+"/";const o=this.omit(s,this.extractParams(e));if("public"===t)n+=t+"/"+this.implodeParams(e,s),Object.keys(o).length&&(n+="?"+this.urlencode(o));else{this.checkRequiredCredentials(),n+=this.implodeParams(e,s),"GET"===i?Object.keys(o).length&&(n+="?"+this.urlencode(o)):Object.keys(o).length&&(a=this.json(o));const t=this.encode(this.apiKey+":"+this.secret),h=this.stringToBase64(t);r={Authorization:"Basic "+this.decode(h),"Content-Type":"application/json"}}return n=this.urls.api[t]+n,{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,h,d,l){if(void 0!==h&&e>=400){const t=this.id+" "+a;if(503===e||504===e)throw new o(t);if(429===e)return;if("{"===a[0]&&"error"in h){const e=this.safeString(h.error,"code");this.throwExactlyMatchedException(this.exceptions,e,t);if("Duplicate clientOrderId"===this.safeString(h.error,"message"))throw new c(t)}throw new n(t)}}}},22683:function(e,t,i){const s=i(48819),{TICK_SIZE:r}=i(62115),a=i(6832),{BadSymbol:n,BadRequest:o,OnMaintenance:h,AccountSuspended:d,PermissionDenied:c,ExchangeError:l,RateLimitExceeded:u,ExchangeNotAvailable:f,OrderNotFound:p,InsufficientFunds:m,InvalidOrder:g,AuthenticationError:y,ArgumentsRequired:b,NotSupported:v}=i(73449);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"hitbtc3",name:"HitBTC",countries:["HK"],rateLimit:3.333,version:"3",pro:!1,has:{CORS:!1,spot:!0,margin:!0,swap:!0,future:!1,option:void 0,addMargin:!0,cancelAllOrders:!0,cancelOrder:!0,createDepositAddress:!0,createOrder:!0,createReduceOnlyOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,editOrder:!0,fetchBalance:!0,fetchBorrowRate:void 0,fetchBorrowRateHistories:void 0,fetchBorrowRateHistory:void 0,fetchBorrowRates:void 0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:void 0,fetchFundingRate:!0,fetchFundingRateHistory:!0,fetchFundingRates:!1,fetchIndexOHLCV:!0,fetchLeverage:!0,fetchLeverageTiers:void 0,fetchMarketLeverageTiers:void 0,fetchMarkets:!0,fetchMarkOHLCV:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrder:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderBooks:!0,fetchOrders:!1,fetchOrderTrades:!0,fetchPosition:!0,fetchPositions:!0,fetchPremiumIndexOHLCV:!0,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!0,fetchTransactions:!0,fetchWithdrawals:!0,reduceMargin:!0,setLeverage:!0,setMarginMode:!1,setPositionMode:!1,transfer:!0,withdraw:!0},precisionMode:r,urls:{logo:"https://user-images.githubusercontent.com/1294454/27766555-8eaec20e-5edc-11e7-9c5b-6dc69fc42f5e.jpg",test:{public:"https://api.demo.hitbtc.com/api/3",private:"https://api.demo.hitbtc.com/api/3"},api:{public:"https://api.hitbtc.com/api/3",private:"https://api.hitbtc.com/api/3"},www:"https://hitbtc.com",referral:"https://hitbtc.com/?ref_id=5a5d39a65d466",doc:["https://api.hitbtc.com","https://github.com/hitbtc-com/hitbtc-api/blob/master/APIv2.md"],fees:["https://hitbtc.com/fees-and-limits","https://support.hitbtc.com/hc/en-us/articles/115005148605-Fees-and-limits"]},api:{public:{get:{"public/currency":10,"public/symbol":10,"public/ticker":10,"public/price/rate":10,"public/trades":10,"public/orderbook":10,"public/candles":10,"public/futures/info":10,"public/futures/history/funding":10,"public/futures/candles/index_price":10,"public/futures/candles/mark_price":10,"public/futures/candles/premium_index":10,"public/futures/candles/open_interest":10}},private:{get:{"spot/balance":15,"spot/order":15,"spot/order/{client_order_id}":15,"spot/fee":15,"spot/fee/{symbol}":15,"spot/history/order":15,"spot/history/trade":15,"margin/account":15,"margin/account/isolated/{symbol}":15,"margin/order":15,"margin/order/{client_order_id}":15,"margin/history/clearing":15,"margin/history/order":15,"margin/history/positions":15,"margin/history/trade":15,"futures/balance":15,"futures/account":15,"futures/account/isolated/{symbol}":15,"futures/order":15,"futures/order/{client_order_id}":15,"futures/fee":15,"futures/fee/{symbol}":15,"futures/history/clearing":15,"futures/history/order":15,"futures/history/positions":15,"futures/history/trade":15,"wallet/balance":15,"wallet/crypto/address":15,"wallet/crypto/address/recent-deposit":15,"wallet/crypto/address/recent-withdraw":15,"wallet/crypto/address/check-mine":15,"wallet/transactions":15,"wallet/crypto/check-offchain-available":15,"wallet/crypto/fee/estimate":15,"sub-account":15,"sub-account/acl":15,"sub-account/balance/{subAccID}":15,"sub-account/crypto/address/{subAccID}/{currency}":15},post:{"spot/order":1,"margin/order":1,"futures/order":1,"wallet/convert":15,"wallet/crypto/address":15,"wallet/crypto/withdraw":15,"wallet/transfer":15,"sub-account/freeze":15,"sub-account/activate":15,"sub-account/transfer":15,"sub-account/acl":15},patch:{"spot/order/{client_order_id}":1,"margin/order/{client_order_id}":1,"futures/order/{client_order_id}":1},delete:{"spot/order":1,"spot/order/{client_order_id}":1,"margin/position":1,"margin/position/isolated/{symbol}":1,"margin/order":1,"margin/order/{client_order_id}":1,"futures/position":1,"futures/position/isolated/{symbol}":1,"futures/order":1,"futures/order/{client_order_id}":1,"wallet/crypto/withdraw/{id}":1},put:{"margin/account/isolated/{symbol}":1,"futures/account/isolated/{symbol}":1,"wallet/crypto/withdraw/{id}":1}}},fees:{trading:{tierBased:!0,percentage:!0,taker:this.parseNumber("0.0009"),maker:this.parseNumber("0.0009"),tiers:{maker:[[this.parseNumber("0"),this.parseNumber("0.0009")],[this.parseNumber("10"),this.parseNumber("0.0007")],[this.parseNumber("100"),this.parseNumber("0.0006")],[this.parseNumber("500"),this.parseNumber("0.0005")],[this.parseNumber("1000"),this.parseNumber("0.0003")],[this.parseNumber("5000"),this.parseNumber("0.0002")],[this.parseNumber("10000"),this.parseNumber("0.0001")],[this.parseNumber("20000"),this.parseNumber("0")],[this.parseNumber("50000"),this.parseNumber("-0.0001")],[this.parseNumber("100000"),this.parseNumber("-0.0001")]],taker:[[this.parseNumber("0"),this.parseNumber("0.0009")],[this.parseNumber("10"),this.parseNumber("0.0008")],[this.parseNumber("100"),this.parseNumber("0.0007")],[this.parseNumber("500"),this.parseNumber("0.0007")],[this.parseNumber("1000"),this.parseNumber("0.0006")],[this.parseNumber("5000"),this.parseNumber("0.0006")],[this.parseNumber("10000"),this.parseNumber("0.0005")],[this.parseNumber("20000"),this.parseNumber("0.0004")],[this.parseNumber("50000"),this.parseNumber("0.0003")],[this.parseNumber("100000"),this.parseNumber("0.0002")]]}}},timeframes:{"1m":"M1","3m":"M3","5m":"M5","15m":"M15","30m":"M30","1h":"H1","4h":"H4","1d":"D1","1w":"D7","1M":"1M"},exceptions:{exact:{429:u,500:l,503:f,504:f,600:c,800:l,1002:y,1003:c,1004:y,1005:y,2001:n,2002:o,2003:o,2010:o,2011:o,2012:o,2020:o,2022:o,10001:o,10021:d,10022:o,20001:m,20002:p,20003:l,20004:l,20005:l,20006:l,20007:l,20008:g,20009:g,20010:h,20011:l,20012:l,20014:l,20016:l,20031:l,20032:l,20033:l,20034:l,20040:l,20041:l,20042:l,20043:l,20044:c,20045:g,20080:l,21001:l,21003:d,21004:d},broad:{}},options:{networks:{ETH:"USDT20",ERC20:"USDT20",TRX:"USDTRX",TRC20:"USDTRX",OMNI:"USDT"},accountsByType:{spot:"spot",funding:"wallet",future:"derivatives"}},commonCurrencies:{AUTO:"Cube",BCC:"BCC",BDP:"BidiPass",BET:"DAO.Casino",BIT:"BitRewards",BOX:"BOX Token",CPT:"Cryptaur",GET:"Themis",GMT:"GMT Token",HSR:"HC",IQ:"IQ.Cash",LNC:"LinkerCoin",PLA:"PlayChip",PNT:"Penta",SBTC:"Super Bitcoin",STEPN:"GMT",STX:"STOX",TV:"Tokenville",USD:"USDT",XMT:"MTL",XPNT:"PNT"}})}nonce(){return this.milliseconds()}async fetchMarkets(e={}){const t=await this.publicGetPublicSymbol(e),i=[],s=Object.keys(t);for(let e=0;e<s.length;e++){const r=s[e],n=this.safeValue(t,r),o=this.safeString(n,"type"),h=this.safeInteger(n,"expiry"),d="futures"===o,c="spot"===o,l=this.safeValue(n,"margin_trading",!1),u=c&&l,f=void 0!==h,p=d&&!f,m=!1,g=this.safeString2(n,"base_currency","underlying"),y=this.safeString(n,"quote_currency"),b=this.safeString(n,"fee_currency"),v=this.safeCurrencyCode(g),w=this.safeCurrencyCode(y),S=this.safeCurrencyCode(b);let k,T,_,O,M,I=v+"/"+w,x="spot";d&&(_=this.parseNumber("1"),k=b,T=this.safeCurrencyCode(k),O=void 0!==w&&w===T,M=!O,I=I+":"+T,f?(I=I+"-"+h,x="future"):x="swap");const C=this.safeString(n,"quantity_increment"),P=this.safeString(n,"tick_size"),A=this.parseNumber(C),N=this.parseNumber(P);i.push({id:r,symbol:I,base:v,quote:w,settle:T,baseId:g,quoteId:y,settleId:k,type:x,spot:c,margin:u,swap:p,future:f,option:m,active:!0,contract:d,linear:O,inverse:M,taker:this.safeNumber(n,"take_rate"),maker:this.safeNumber(n,"make_rate"),contractSize:_,expiry:h,expiryDatetime:void 0,strike:void 0,optionType:void 0,feeCurrency:S,precision:{amount:A,price:N},limits:{leverage:{min:this.parseNumber("1"),max:this.safeNumber(n,"max_initial_leverage",1)},amount:{min:A,max:void 0},price:{min:N,max:void 0},cost:{min:this.parseNumber(a.stringMul(C,P)),max:void 0}},info:n})}return i}async fetchCurrencies(e={}){const t=await this.publicGetPublicCurrency(e),i={},s=Object.keys(t);for(let e=0;e<s.length;e++){const r=s[e],a=this.safeCurrencyCode(r),n=t[r],o=this.safeString(n,"full_name"),h=this.safeNumber(n,"precision_transfer"),d=this.safeValue(n,"payin_enabled",!1),c=this.safeValue(n,"payout_enabled",!1),l=this.safeValue(n,"transfer_enabled",!1),u=d&&c&&l,f=this.safeValue(n,"networks",[]),p={};let m,g,y;for(let e=0;e<f.length;e++){const t=f[e],i=this.safeString2(t,"protocol","network"),s=this.safeNetwork(i);m=this.safeNumber(t,"payout_fee");const r=this.safeNumber(t,"precision_payout"),a=this.safeValue(n,"payin_enabled",!1),o=this.safeValue(n,"payout_enabled",!1),h=a&&o;a&&!g?g=!0:a||(g=!1),o&&!y?y=!0:o||(y=!1),p[s]={info:t,id:i,network:s,fee:m,active:h,deposit:a,withdraw:o,precision:r,limits:{withdraw:{min:void 0,max:void 0}}}}const b=Object.keys(p).length;i[a]={info:n,code:a,id:r,precision:h,name:o,active:u,deposit:g,withdraw:y,networks:p,fee:b<=1?m:void 0,limits:{amount:{min:void 0,max:void 0}}}}return i}safeNetwork(e){return void 0===e?void 0:e.toUpperCase()}async createDepositAddress(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=this.safeStringUpper(t,"network");if(void 0!==s&&"USDT"===e){const e=this.safeValue(this.options,"networks"),r=this.safeString(e,s);void 0!==r&&(i.currency=r),t=this.omit(t,"network")}const r=await this.privatePostWalletCryptoAddress(this.extend(i,t)),a=this.safeString(r,"currency");return{currency:this.safeCurrencyCode(a),address:this.safeString(r,"address"),tag:this.safeString(r,"payment_id"),network:void 0,info:r}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=this.safeStringUpper(t,"network");if(void 0!==s&&"USDT"===e){const e=this.safeValue(this.options,"networks"),r=this.safeString(e,s);void 0!==r&&(i.currency=r),t=this.omit(t,"network")}const r=await this.privateGetWalletCryptoAddress(this.extend(i,t)),a=this.safeValue(r,0),n=this.safeString(a,"address"),o=this.safeString(a,"currency"),h=this.safeString(a,"payment_id"),d=this.safeCurrencyCode(o);return{info:r,address:n,tag:h,code:d,currency:d,network:void 0}}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"available"),n.used=this.safeString(s,"reserved"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){const t=this.safeStringLower(e,"type","spot");e=this.omit(e,["type"]);const i=this.safeValue(this.options,"accountsByType",{}),s=this.safeString(i,t,t);let r;if("wallet"===s)r=await this.privateGetWalletBalance(e);else if("spot"===s)r=await this.privateGetSpotBalance(e);else{if("derivatives"!==s){const e=Object.keys(i);throw new o(this.id+" fetchBalance() type parameter must be one of "+e.join(", "))}r=await this.privateGetFuturesBalance(e)}return this.parseBalance(r)}async fetchTicker(e,t={}){const i=await this.fetchTickers([e],t);return this.safeValue(i,e)}async fetchTickers(e,t={}){await this.loadMarkets();const i={};if(void 0!==(e=this.marketSymbols(e))){const t=this.marketIds(e).join(",");i.symbols=t}const s=await this.publicGetPublicTicker(this.extend(i,t)),r={},a=Object.keys(s);for(let e=0;e<a.length;e++){const t=a[e],i=this.safeMarket(t),n=i.symbol,o=s[t];r[n]=this.parseTicker(o,i)}return this.filterByArray(r,"symbol",e)}parseTicker(e,t){const i=this.parse8601(e.timestamp),s=this.safeSymbol(void 0,t),r=this.safeString(e,"volume"),a=this.safeString(e,"volume_quote"),n=this.safeString(e,"open"),o=this.safeString(e,"last");return this.safeTicker({symbol:s,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:n,close:o,last:o,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:r,quoteVolume:a,info:e},t)}async fetchTrades(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.symbols=r.id),void 0!==i&&(a.limit=i),void 0!==t&&(a.from=t);const n=await this.publicGetPublicTrades(this.extend(a,s)),o=Object.keys(n);let h=[];for(let e=0;e<o.length;e++){const t=o[e],i=this.market(t),s=n[t],r=this.parseTrades(s,i);h=this.arrayConcat(h,r)}return h}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets();const a={};let n;void 0!==e&&(r=this.market(e),a.symbol=r.id),void 0!==i&&(a.limit=i),void 0!==t&&(a.from=t),[n,s]=this.handleMarketTypeAndParams("fetchMyTrades",r,s);let o=this.getSupportedMapping(n,{spot:"privateGetSpotHistoryTrade",swap:"privateGetFuturesHistoryTrade",margin:"privateGetMarginHistoryTrade"});const[h,d]=this.handleMarginModeAndParams("fetchMyTrades",s);void 0!==h&&(o="privateGetMarginHistoryTrade");const c=await this[o](this.extend(a,d));return this.parseTrades(c,r,t,i)}parseTrade(e,t){const i=this.parse8601(e.timestamp),s=this.safeString(e,"symbol"),r=(t=this.safeMarket(s,t)).symbol;let a;const n=this.safeString(e,"fee"),o=this.safeValue(e,"taker");let h;if(void 0!==o&&(h=o?"taker":"maker"),void 0!==n){const e=this.safeValue(t,"info",{}),i=this.safeString(e,"fee_currency");a={cost:n,currency:this.safeCurrencyCode(i)}}const d=this.safeString2(e,"clientOrderId","client_order_id"),c=this.safeString(e,"price"),l=this.safeString2(e,"quantity","qty"),u=this.safeString(e,"side"),f=this.safeString(e,"id");return this.safeTrade({info:e,id:f,order:d,timestamp:i,datetime:this.iso8601(i),symbol:r,type:void 0,side:u,takerOrMaker:h,price:c,amount:l,cost:void 0,fee:a},t)}async fetchTransactionsHelper(e,t,i,s,r){await this.loadMarkets();const a={types:e};let n;void 0!==t&&(n=this.currency(t),a.currencies=n.id),void 0!==i&&(a.from=this.iso8601(i)),void 0!==s&&(a.limit=s);const o=await this.privateGetWalletTransactions(this.extend(a,r));return this.parseTransactions(o,n,i,s,r)}parseTransactionStatus(e){return this.safeString({PENDING:"pending",FAILED:"failed",SUCCESS:"ok"},e,e)}parseTransactionType(e){return this.safeString({DEPOSIT:"deposit",WITHDRAW:"withdrawal"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=this.parse8601(this.safeString(e,"created_at")),r=this.parse8601(this.safeString(e,"updated_at")),a=this.parseTransactionType(this.safeString(e,"type")),n=this.parseTransactionStatus(this.safeString(e,"status")),o=this.safeValue(e,"native",{}),h=this.safeString(o,"currency"),d=this.safeCurrencyCode(h),c=this.safeString(o,"hash"),l=this.safeString(o,"address"),u=l,f=this.safeString(o,"payment_id"),p=f,m=this.safeValue(o,"senders"),g=this.safeString(m,0),y=this.safeNumber(o,"amount"),b={currency:void 0,cost:void 0,rate:void 0},v=this.safeNumber(o,"fee");return void 0!==v&&(b.currency=d,b.cost=v),{info:e,id:i,txid:c,type:a,code:d,currency:d,network:void 0,amount:y,status:n,timestamp:s,datetime:this.iso8601(s),address:l,addressFrom:g,addressTo:u,tag:f,tagFrom:void 0,tagTo:p,updated:r,comment:void 0,fee:b}}async fetchTransactions(e,t,i,s={}){return await this.fetchTransactionsHelper("DEPOSIT,WITHDRAW",e,t,i,s)}async fetchDeposits(e,t,i,s={}){return await this.fetchTransactionsHelper("DEPOSIT",e,t,i,s)}async fetchWithdrawals(e,t,i,s={}){return await this.fetchTransactionsHelper("WITHDRAW",e,t,i,s)}async fetchOrderBooks(e,t,i={}){await this.loadMarkets();const s={};if(void 0!==e){const t=this.marketIds(e);s.symbols=t.join(",")}void 0!==t&&(s.depth=t);const r=await this.publicGetPublicOrderbook(this.extend(s,i)),a={},n=Object.keys(r);for(let e=0;e<n.length;e++){const t=n[e],i=r[t],s=this.safeSymbol(t),o=this.parse8601(this.safeString(i,"timestamp"));a[s]=this.parseOrderBook(r[t],s,o,"bid","ask")}return a}async fetchOrderBook(e,t,i={}){return(await this.fetchOrderBooks([e],t,i))[e]}parseTradingFee(e,t){const i=this.safeNumber(e,"take_rate"),s=this.safeNumber(e,"make_rate"),r=this.safeString(e,"symbol");return{info:e,symbol:this.safeSymbol(r,t),taker:i,maker:s}}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=this.getSupportedMapping(i.type,{spot:"privateGetSpotFeeSymbol",swap:"privateGetFuturesFeeSymbol"}),a=await this[r](this.extend(s,t));return this.parseTradingFee(a,i)}async fetchTradingFees(e,t={}){await this.loadMarkets();const[i,s]=this.handleMarketTypeAndParams("fetchTradingFees",void 0,t),r=this.getSupportedMapping(i,{spot:"privateGetSpotFee",swap:"privateGetFuturesFee"}),a=await this[r](s),n={};for(let e=0;e<a.length;e++){const t=this.parseTradingFee(a[e]);n[t.symbol]=t}return n}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbols:a.id,period:this.safeString(this.timeframes,t,t)};void 0!==i&&(n.from=this.iso8601(i)),void 0!==s&&(n.limit=s);const o=this.safeString(r,"price");r=this.omit(r,"price");let h="publicGetPublicCandles";"mark"===o?h="publicGetPublicFuturesCandlesMarkPrice":"index"===o?h="publicGetPublicFuturesCandlesIndexPrice":"premiumIndex"===o&&(h="publicGetPublicFuturesCandlesPremiumIndex");const d=await this[h](this.extend(n,r)),c=this.safeValue(d,a.id);return this.parseOHLCVs(c,a,t,i,s)}parseOHLCV(e,t){return[this.parse8601(this.safeString(e,"timestamp")),this.safeNumber(e,"open"),this.safeNumber(e,"max"),this.safeNumber(e,"min"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchClosedOrders(e,t,i,s={}){let r;await this.loadMarkets();const a={};let n;void 0!==e&&(r=this.market(e),a.symbol=r.id),void 0!==t&&(a.from=this.iso8601(t)),void 0!==i&&(a.limit=i),[n,s]=this.handleMarketTypeAndParams("fetchClosedOrders",r,s);let o=this.getSupportedMapping(n,{spot:"privateGetSpotHistoryOrder",swap:"privateGetFuturesHistoryOrder",margin:"privateGetMarginHistoryOrder"});const[h,d]=this.handleMarginModeAndParams("fetchClosedOrders",s);void 0!==h&&(o="privateGetMarginHistoryOrder");const c=await this[o](this.extend(a,d)),l=this.parseOrders(c,r,t,i);return this.filterByArray(l,"status",["closed","canceled"],!1)}async fetchOrder(e,t,i={}){let s,r;await this.loadMarkets(),void 0!==t&&(s=this.market(t)),[r,i]=this.handleMarketTypeAndParams("fetchOrder",s,i);let a=this.getSupportedMapping(r,{spot:"privateGetSpotHistoryOrder",swap:"privateGetFuturesHistoryOrder",margin:"privateGetMarginHistoryOrder"});const[n,o]=this.handleMarginModeAndParams("fetchOrder",i);void 0!==n&&(a="privateGetMarginHistoryOrder");const h={client_order_id:e},d=await this[a](this.extend(h,o)),c=this.safeValue(d,0);return this.parseOrder(c,s)}async fetchOrderTrades(e,t,i,s,r={}){let a;await this.loadMarkets(),void 0!==t&&(a=this.market(t));const n={order_id:e};let o;[o,r]=this.handleMarketTypeAndParams("fetchOrderTrades",a,r);let h=this.getSupportedMapping(o,{spot:"privateGetSpotHistoryTrade",swap:"privateGetFuturesHistoryTrade",margin:"privateGetMarginHistoryTrade"});const[d,c]=this.handleMarginModeAndParams("fetchOrderTrades",r);void 0!==d&&(h="privateGetMarginHistoryTrade");const l=await this[h](this.extend(n,c));return this.parseTrades(l,a,i,s)}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets();const a={};let n;void 0!==e&&(r=this.market(e),a.symbol=r.id),[n,s]=this.handleMarketTypeAndParams("fetchOpenOrders",r,s);let o=this.getSupportedMapping(n,{spot:"privateGetSpotOrder",swap:"privateGetFuturesOrder",margin:"privateGetMarginOrder"});const[h,d]=this.handleMarginModeAndParams("fetchOpenOrders",s);void 0!==h&&(o="privateGetMarginOrder");const c=await this[o](this.extend(a,d));return this.parseOrders(c,r,t,i)}async fetchOpenOrder(e,t,i={}){let s,r;await this.loadMarkets(),void 0!==t&&(s=this.market(t)),[r,i]=this.handleMarketTypeAndParams("fetchOpenOrder",s,i);let a=this.getSupportedMapping(r,{spot:"privateGetSpotOrderClientOrderId",swap:"privateGetFuturesOrderClientOrderId",margin:"privateGetMarginOrderClientOrderId"});const[n,o]=this.handleMarginModeAndParams("fetchOpenOrder",i);void 0!==n&&(a="privateGetMarginOrderClientOrderId");const h={client_order_id:e},d=await this[a](this.extend(h,o));return this.parseOrder(d,s)}async cancelAllOrders(e,t={}){let i;await this.loadMarkets();const s={};let r;void 0!==e&&(i=this.market(e),s.symbol=i.id),[r,t]=this.handleMarketTypeAndParams("cancelAllOrders",i,t);let a=this.getSupportedMapping(r,{spot:"privateDeleteSpotOrder",swap:"privateDeleteFuturesOrder",margin:"privateDeleteMarginOrder"});const[n,o]=this.handleMarginModeAndParams("cancelAllOrders",t);void 0!==n&&(a="privateDeleteMarginOrder");const h=await this[a](this.extend(s,o));return this.parseOrders(h,i)}async cancelOrder(e,t,i={}){let s;await this.loadMarkets();const r={client_order_id:e};let a;void 0!==t&&(s=this.market(t)),[a,i]=this.handleMarketTypeAndParams("cancelOrder",s,i);let n=this.getSupportedMapping(a,{spot:"privateDeleteSpotOrderClientOrderId",swap:"privateDeleteFuturesOrderClientOrderId",margin:"privateDeleteMarginOrderClientOrderId"});const[o,h]=this.handleMarginModeAndParams("cancelOrder",i);void 0!==o&&(n="privateDeleteMarginOrderClientOrderId");const d=await this[n](this.extend(r,h));return this.parseOrder(d,s)}async editOrder(e,t,i,s,r,a,n={}){let o;await this.loadMarkets();const h={client_order_id:e,quantity:this.amountToPrecision(t,r)};if("limit"===i||"stopLimit"===i){if(void 0===a)throw new l(this.id+" editOrder() limit order requires price");h.price=this.priceToPrecision(t,a)}let d;void 0!==t&&(o=this.market(t)),[d,n]=this.handleMarketTypeAndParams("editOrder",o,n);let c=this.getSupportedMapping(d,{spot:"privatePatchSpotOrderClientOrderId",swap:"privatePatchFuturesOrderClientOrderId",margin:"privatePatchMarginOrderClientOrderId"});const[u,f]=this.handleMarginModeAndParams("editOrder",n);void 0!==u&&(c="privatePatchMarginOrderClientOrderId");const p=await this[c](this.extend(h,f));return this.parseOrder(p,o)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={type:t,side:i,quantity:this.amountToPrecision(e,s),symbol:n.id},h=this.safeValue(a,"reduceOnly");if(void 0!==h&&"swap"!==n.type&&"margin"!==n.type)throw new g(this.id+" createOrder() does not support reduce_only for "+n.type+" orders, reduce_only orders are supported for swap and margin markets only");!0===h&&(o.reduce_only=h);const d=this.safeString2(a,"timeInForce","time_in_force"),c=this.safeString(a,"expire_time"),u=this.safeNumber2(a,"stopPrice","stop_price");if("limit"===t||"stopLimit"===t||"takeProfitLimit"===t){if(void 0===r)throw new l(this.id+" createOrder() requires a price argument for limit orders");o.price=this.priceToPrecision(e,r)}if("GTD"===d){if(void 0===c)throw new l(this.id+" createOrder() requires an expire_time parameter for a GTD order");o.expire_time=c}if("stopLimit"===t||"stopMarket"===t||"takeProfitLimit"===t||"takeProfitMarket"===t){if(void 0===u)throw new l(this.id+" createOrder() requires a stopPrice parameter for stop-loss and take-profit orders");o.stop_price=this.priceToPrecision(e,u)}let f;[f,a]=this.handleMarketTypeAndParams("createOrder",n,a);let p=this.getSupportedMapping(f,{spot:"privatePostSpotOrder",swap:"privatePostFuturesOrder",margin:"privatePostMarginOrder"});const[m,y]=this.handleMarginModeAndParams("createOrder",a);void 0!==m&&(p="privatePostMarginOrder");const b=await this[p](this.extend(o,y));return this.parseOrder(b,n)}parseOrderStatus(e){return this.safeString({new:"open",suspended:"open",partiallyFilled:"open",filled:"closed",canceled:"canceled",expired:"failed"},e,e)}parseOrder(e,t){const i=this.safeString(e,"client_order_id"),s=this.safeString(e,"side"),r=this.safeString(e,"type"),a=this.safeString(e,"quantity"),n=this.safeString(e,"price"),o=this.safeString(e,"price_average"),h=this.safeString(e,"created_at"),d=this.parse8601(h),c=this.safeString(e,"updated_at");let l;c!==h&&(l=this.parse8601(c));const u=this.safeString(e,"quantity_cumulative"),f=this.parseOrderStatus(this.safeString(e,"status")),p=this.safeString(e,"symbol"),m=(t=this.safeMarket(p,t)).symbol,g=this.safeValue(e,"post_only"),y=this.safeString(e,"time_in_force"),b=this.safeValue(e,"trades");return this.safeOrder({info:e,id:i,clientOrderId:i,timestamp:d,datetime:this.iso8601(d),lastTradeTimestamp:l,symbol:m,price:n,amount:a,type:r,side:s,timeInForce:y,postOnly:g,reduceOnly:this.safeValue(e,"reduce_only"),filled:u,remaining:void 0,cost:void 0,status:f,average:o,trades:b,fee:void 0},t)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n=this.currencyToPrecision(e,t),h=this.safeValue(this.options,"accountsByType",{});i=i.toLowerCase(),s=s.toLowerCase();const d=this.safeString(h,i,i),c=this.safeString(h,s,s);if(d===c)throw new o(this.id+" transfer() fromAccount and toAccount arguments cannot be the same account");const l={currency:a.id,amount:n,source:d,destination:c},u=await this.privatePostWalletTransfer(this.extend(l,r));return this.parseTransfer(u,a)}parseTransfer(e,t){const i=this.milliseconds();return{id:this.safeString(e,0),timestamp:i,datetime:this.iso8601(i),currency:this.safeCurrencyCode(void 0,t),amount:void 0,fromAccount:void 0,toAccount:void 0,status:void 0,info:e}}async convertCurrencyNetwork(e,t,i,s,r){if(await this.loadMarkets(),"USDT"!==e)throw new l(this.id+" convertCurrencyNetwork() only supports USDT currently");const a=this.safeValue(this.options,"networks",{});if(i=i.toUpperCase(),s=s.toUpperCase(),(i=this.safeString(a,i))===(s=this.safeString(a,s)))throw new o(this.id+" convertCurrencyNetwork() fromNetwork cannot be the same as toNetwork");if(void 0===i||void 0===s){const e=Object.keys(a);throw new b(this.id+" convertCurrencyNetwork() requires a fromNetwork parameter and a toNetwork parameter, supported networks are "+e.join(", "))}const n={from_currency:i,to_currency:s,amount:this.currencyToPrecision(e,t)};return{info:await this.privatePostWalletConvert(this.extend(n,r))}}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets(),this.checkAddress(i);const a=this.currency(e),n={currency:a.id,amount:t,address:i};void 0!==s&&(n.payment_id=s);const o=this.safeValue(this.options,"networks",{}),h=this.safeStringUpper(r,"network");if(void 0!==h&&"USDT"===e){const e=this.safeString(o,h);void 0!==e&&(n.currency=e),r=this.omit(r,"network")}const d=await this.privatePostWalletCryptoWithdraw(this.extend(n,r));return this.parseTransaction(d,a)}async fetchFundingRateHistory(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),e=r.symbol,a.symbols=r.id),void 0!==t&&(a.from=t),void 0!==i&&(a.limit=i);const n=await this.publicGetPublicFuturesHistoryFunding(this.extend(a,s)),o=Object.keys(n),h=[];for(let e=0;e<o.length;e++){const t=o[e],i=this.safeMarket(t),s=n[t];for(let e=0;e<s.length;e++){const t=s[e],r=this.safeSymbol(i.symbol),a=this.safeNumber(t,"funding_rate"),n=this.safeString(t,"timestamp");h.push({info:t,symbol:r,fundingRate:a,timestamp:this.parse8601(n),datetime:n})}}const d=this.sortBy(h,"timestamp");return this.filterBySymbolSinceLimit(d,e,t,i)}async fetchPositions(e,t={}){await this.loadMarkets();let i;[i,t]=this.handleMarketTypeAndParams("fetchPositions",void 0,t);let s=this.getSupportedMapping(i,{swap:"privateGetFuturesAccount",margin:"privateGetMarginAccount"});const[r,a]=this.handleMarginModeAndParams("fetchPositions",t);void 0!==r&&(s="privateGetMarginAccount");const n=await this[s](this.extend({},a)),o=[];for(let e=0;e<n.length;e++)o.push(this.parsePosition(n[e]));return o}async fetchPosition(e,t={}){let i;await this.loadMarkets(),[i,t]=this.handleMarketTypeAndParams("fetchPosition",void 0,t);let s=this.getSupportedMapping(i,{swap:"privateGetFuturesAccountIsolatedSymbol",margin:"privateGetMarginAccountIsolatedSymbol"});const[r,a]=this.handleMarginModeAndParams("fetchPosition",t);void 0!==r&&(s="privateGetMarginAccountIsolatedSymbol");const n=this.market(e),o={symbol:n.id},h=await this[s](this.extend(o,a));return this.parsePosition(h,n)}parsePosition(e,t){const i=this.safeString(e,"type"),s=this.safeNumber(e,"leverage"),r=this.safeString(e,"updated_at"),a=this.safeValue(e,"positions",[]);let n,o,h;for(let e=0;e<a.length;e++){const t=a[e];n=this.safeNumber(t,"price_liquidation"),o=this.safeNumber(t,"price_entry"),h=this.safeNumber(t,"quantity")}const d=this.safeValue(e,"currencies",[]);let c;for(let e=0;e<d.length;e++){const t=d[e];c=this.safeNumber(t,"margin_balance")}const l=this.safeString(e,"symbol");return{info:e,id:void 0,symbol:(t=this.safeMarket(l,t)).symbol,notional:void 0,marginMode:i,marginType:i,liquidationPrice:n,entryPrice:o,unrealizedPnl:void 0,percentage:void 0,contracts:h,contractSize:void 0,markPrice:void 0,side:void 0,hedged:void 0,timestamp:this.parse8601(r),datetime:r,maintenanceMargin:void 0,maintenanceMarginPercentage:void 0,collateral:c,initialMargin:void 0,initialMarginPercentage:void 0,leverage:s,marginRatio:void 0}}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.swap)throw new n(this.id+" fetchFundingRate() supports swap contracts only");const s={};void 0!==e&&(e=i.symbol,s.symbols=i.id);const r=await this.publicGetPublicFuturesInfo(this.extend(s,t)),a=this.safeValue(r,i.id,{});return this.parseFundingRate(a,i)}parseFundingRate(e,t){const i=this.safeString(e,"next_funding_time"),s=this.safeString(e,"timestamp");return{info:e,symbol:this.safeSymbol(void 0,t),markPrice:this.safeNumber(e,"mark_price"),indexPrice:this.safeNumber(e,"index_price"),interestRate:this.safeNumber(e,"interest_rate"),estimatedSettlePrice:void 0,timestamp:this.parse8601(s),datetime:s,fundingRate:this.safeNumber(e,"funding_rate"),fundingTimestamp:this.parse8601(i),fundingDatetime:i,nextFundingRate:this.safeNumber(e,"indicative_funding_rate"),nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async modifyMarginHelper(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a=this.safeString(s,"leverage");if("swap"===r.type&&void 0===a)throw new b(this.id+" modifyMarginHelper() requires a leverage parameter for swap markets");t=this.amountToPrecision(e,t);const n={symbol:r.id,margin_balance:t};let o;void 0!==a&&(n.leverage=a),[o,s]=this.handleMarketTypeAndParams("modifyMarginHelper",void 0,s);let h=this.getSupportedMapping(o,{swap:"privatePutFuturesAccountIsolatedSymbol",margin:"privatePutMarginAccountIsolatedSymbol"});const[d,c]=this.handleMarginModeAndParams("modifyMarginHelper",s);void 0!==d&&(h="privatePutMarginAccountIsolatedSymbol");const l=await this[h](this.extend(n,c));return this.extend(this.parseMarginModification(l,r),{amount:this.parseNumber(t),type:i})}parseMarginModification(e,t){const i=this.safeValue(e,"currencies",[]),s=this.safeValue(i,0);return{info:e,type:void 0,amount:void 0,code:this.safeString(s,"code"),symbol:t.symbol,status:void 0}}async reduceMargin(e,t,i={}){if(0!==t)throw new o(this.id+" reduceMargin() on hitbtc3 requires the amount to be 0 and that will remove the entire margin amount");return await this.modifyMarginHelper(e,t,"reduce",i)}async addMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,"add",i)}async fetchLeverage(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id};let r=this.getSupportedMapping(i.type,{spot:"privateGetMarginAccountIsolatedSymbol",margin:"privateGetMarginAccountIsolatedSymbol",swap:"privateGetFuturesAccountIsolatedSymbol"});const[a,n]=this.handleMarginModeAndParams("modifyMarginHelper",t);void 0!==a&&(r="privateGetMarginAccountIsolatedSymbol");const o=await this[r](this.extend(s,n));return this.safeNumber(o,"leverage")}async setLeverage(e,t,i={}){if(await this.loadMarkets(),void 0===t)throw new b(this.id+" setLeverage() requires a symbol argument");if(void 0===i.margin_balance)throw new b(this.id+" setLeverage() requires a margin_balance parameter that will transfer margin to the specified trading pair");const s=this.market(t),r=this.safeNumber(i,"margin_balance"),a=this.safeInteger(s.limits.leverage,"max",50);if("swap"!==s.type)throw new n(this.id+" setLeverage() supports swap contracts only");if(e<1||e>a)throw new o(this.id+" setLeverage() leverage should be between 1 and "+a.toString()+" for "+t);const h={symbol:s.id,leverage:e.toString(),margin_balance:this.amountToPrecision(t,r)};return await this.privatePutFuturesAccountIsolatedSymbol(this.extend(h,i))}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.publicGetPublicCurrency(t);return this.parseDepositWithdrawFees(i,e)}parseDepositWithdrawFee(e,t){const i=this.safeValue(e,"networks",[]),s=this.depositWithdrawFee(e);for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"network"),a=this.networkIdToCode(r),n=this.safeNumber(t,"payout_fee"),o={fee:n,percentage:void 0===n&&void 0};!0===this.safeValue(t,"default")&&(s.withdraw=o),s.networks[a]={withdraw:o,deposit:{fee:void 0,percentage:void 0}}}return s}handleMarginModeAndParams(e,t={},i){const s=this.safeString(this.options,"defaultType"),r=this.safeValue(t,"margin",!1);let a;if([a,t]=super.handleMarginModeAndParams(e,t,i),void 0!==a){if("isolated"!==a)throw new v(this.id+" only isolated margin is supported")}else"margin"!==s&&!0!==r||(a="isolated");return[a,t]}handleErrors(e,t,i,s,r,a,n,o,h){const d=this.safeValue(n,"error"),c=this.safeString(d,"code");if(void 0!==c){const e=this.id+" "+a,t=this.safeString2(d,"message","description");throw this.throwExactlyMatchedException(this.exceptions.exact,c,e),this.throwBroadlyMatchedException(this.exceptions.broad,t,e),new l(e)}}sign(e,t="public",i="GET",s={},r,a){const n=this.omit(s,this.extractParams(e)),o=this.implodeParams(e,s);let h,d=this.urls.api[t]+"/"+o;const c=Object.keys(n).length;if(r={"Content-Type":"application/json"},"GET"===i?c&&(h="?"+this.urlencode(n),d+=h):a=this.json(s),"private"===t){this.checkRequiredCredentials();const e=this.nonce().toString(),t=[i,"/api/3/"+o];"GET"===i?void 0!==h&&t.push(h):t.push(a),t.push(e);const s=t.join(""),n=this.hmac(this.encode(s),this.encode(this.secret),"sha256","hex"),d=this.apiKey+":"+n+":"+e,c=this.decode(this.stringToBase64(d));r.Authorization="HS256 "+c}return{url:d,method:i,body:a,headers:r}}}},94693:function(e,t,i){"use strict";const s=i(48819),{BadRequest:r,AuthenticationError:a,NetworkError:n,ArgumentsRequired:o,OrderImmediatelyFillable:h,OrderNotFound:d,InsufficientFunds:c}=i(73449),{TICK_SIZE:l}=i(62115),u=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"hollaex",name:"HollaEx",countries:["KR"],rateLimit:250,version:"v2",pro:!0,has:{CORS:void 0,spot:!0,margin:void 0,swap:!1,future:!1,option:!1,addMargin:!1,cancelAllOrders:!0,cancelOrder:!0,createLimitBuyOrder:!0,createLimitSellOrder:!0,createMarketBuyOrder:!0,createMarketSellOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:"emulated",fetchDepositAddresses:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrder:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderBooks:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactions:!1,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!0,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!0},timeframes:{"1m":"1m","5m":"5m","15m":"15m","1h":"1h","4h":"4h","1d":"1d","1w":"1w"},urls:{logo:"https://user-images.githubusercontent.com/1294454/75841031-ca375180-5ddd-11ea-8417-b975674c23cb.jpg",test:{rest:"https://api.sandbox.hollaex.com"},api:{rest:"https://api.hollaex.com"},www:"https://hollaex.com",doc:"https://apidocs.hollaex.com",referral:"https://pro.hollaex.com/signup?affiliation_code=QSWA6G"},precisionMode:l,requiredCredentials:{apiKey:!0,secret:!0},api:{public:{get:{health:1,constants:1,kit:1,tiers:1,ticker:1,tickers:1,orderbook:1,orderbooks:1,trades:1,chart:1,charts:1,"udf/config":1,"udf/history":1,"udf/symbols":1}},private:{get:{user:1,"user/balance":1,"user/deposits":1,"user/withdrawals":1,"user/withdrawal/fee":1,"user/trades":1,orders:1,order:1},post:{"user/withdrawal":1,order:1},delete:{"order/all":1,order:1}}},fees:{trading:{tierBased:!0,percentage:!0,taker:.001,maker:.001}},exceptions:{broad:{"Invalid token":a,"Order not found":d,"Insufficient balance":c,"Error 1001 - Order rejected. Order could not be submitted as this order was set to a post only order.":h},exact:{400:r,403:a,404:r,405:r,410:r,429:r,500:n,503:n}},options:{"api-expires":parseInt(this.timeout/1e3),networks:{BTC:"btc",ETH:"eth",ERC20:"eth",TRX:"trx",TRC20:"trx",XRP:"xrp",XLM:"xlm"}}})}async fetchMarkets(e={}){const t=await this.publicGetConstants(e),i=this.safeValue(t,"pairs",{}),s=Object.keys(i),r=[];for(let e=0;e<s.length;e++){const t=i[s[e]],a=this.safeString(t,"pair_base"),n=this.safeString(t,"pair_2"),o=this.commonCurrencyCode(a.toUpperCase()),h=this.commonCurrencyCode(n.toUpperCase());r.push({id:this.safeString(t,"name"),symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:this.safeValue(t,"active"),contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(t,"increment_size"),price:this.safeNumber(t,"increment_price")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"min_size"),max:this.safeNumber(t,"max_size")},price:{min:this.safeNumber(t,"min_price"),max:this.safeNumber(t,"max_price")},cost:{min:void 0,max:void 0}},info:t})}return r}async fetchCurrencies(e={}){const t=await this.publicGetConstants(e),i=this.safeValue(t,"coins",{}),s=Object.keys(i),r={};for(let e=0;e<s.length;e++){const t=i[s[e]],a=this.safeString(t,"symbol"),n=this.safeInteger(t,"id"),o=this.safeCurrencyCode(a),h=this.safeString(t,"fullname"),d=this.safeValue(t,"allow_deposit"),c=this.safeValue(t,"allow_withdrawal"),l=this.safeValue(t,"active")&&d&&c,u=this.safeNumber(t,"withdrawal_fee"),f=this.safeValue(t,"withdrawal_limits",[]);r[o]={id:a,numericId:n,code:o,info:t,name:h,active:l,deposit:d,withdraw:c,fee:u,precision:this.safeNumber(t,"increment_unit"),limits:{amount:{min:this.safeNumber(t,"min"),max:this.safeNumber(t,"max")},withdraw:{min:void 0,max:this.safeValue(f,0)}}}}return r}async fetchOrderBooks(e,t,i={}){await this.loadMarkets();const s=await this.publicGetOrderbooks(i),r={},a=Object.keys(s);for(let e=0;e<a.length;e++){const t=a[e],i=s[t],n=this.safeSymbol(t,void 0,"-"),o=this.parse8601(this.safeString(i,"timestamp"));r[n]=this.parseOrderBook(s[t],n,o)}return r}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id},a=await this.publicGetOrderbooks(this.extend(r,i)),n=this.safeValue(a,s.id),o=this.parse8601(this.safeString(n,"timestamp"));return this.parseOrderBook(n,s.symbol,o)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetTicker(this.extend(s,t));return this.parseTicker(r,i)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetTickers(this.extend(t));return this.parseTickers(i,e)}parseTickers(e,t,i={}){const s={},r=Object.keys(e);for(let t=0;t<r.length;t++){const a=r[t],n=e[a],o=this.safeString(n,"symbol",a),h=this.safeMarket(o,void 0,"-");s[h.symbol]=this.extend(this.parseTicker(n,h),i)}return this.filterByArray(s,"symbol",t)}parseTicker(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t,"-")).symbol,r=this.parse8601(this.safeString2(e,"time","timestamp")),a=this.safeString(e,"close");return this.safeTicker({symbol:s,info:e,timestamp:r,datetime:this.iso8601(r),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:this.safeString(e,"open"),close:a,last:this.safeString(e,"last",a),previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"volume"),quoteVolume:void 0},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id},n=await this.publicGetTrades(this.extend(a,s)),o=this.safeValue(n,r.id,[]);return this.parseTrades(o,r,t,i)}parseTrade(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t,"-")).symbol,r=this.safeString(e,"timestamp"),a=this.parse8601(r),n=this.safeString(e,"side"),o=this.safeString(e,"order_id"),h=this.safeString(e,"price"),d=this.safeString(e,"size"),c=this.safeString(e,"fee");let l;return void 0!==c&&(l={cost:c,currency:t.quote}),this.safeTrade({info:e,id:void 0,timestamp:a,datetime:r,symbol:s,order:o,type:void 0,side:n,takerOrMaker:void 0,price:h,amount:d,cost:void 0,fee:l},t)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.publicGetTiers(e),i=this.safeValue(t,"1",{}),s=this.safeValue(i,"fees",{}),r=this.safeValue(s,"maker",{}),a=this.safeValue(s,"taker",{}),n={};for(let e=0;e<this.symbols.length;e++){const t=this.symbols[e],i=this.market(t),o=this.safeString(r,i.id),h=this.safeString(a,i.id);n[t]={info:s,symbol:t,maker:this.parseNumber(u.stringDiv(o,"100")),taker:this.parseNumber(u.stringDiv(h,"100")),percentage:!0,tierBased:!0}}return n}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,resolution:this.safeString(this.timeframes,t,t)},o=this.parseTimeframe(t);if(void 0===i){void 0===s&&(s=1e3);const e=this.seconds(),t=e-o*s;n.to=e,n.from=t}else if(void 0===s)n.from=parseInt(i/1e3),n.to=this.seconds();else{const e=parseInt(i/1e3);n.from=e,n.to=this.sum(e,o*s)}const h=await this.publicGetChart(this.extend(n,r));return this.parseOHLCVs(h,a,t,i,s)}parseOHLCV(e,t,i="1h",s,r){return[this.parse8601(this.safeString(e,"time")),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}parseBalance(e){const t=this.parse8601(this.safeString(e,"updated_at")),i={info:e,timestamp:t,datetime:this.iso8601(t)},s=Object.keys(this.currencies_by_id);for(let t=0;t<s.length;t++){const r=s[t],a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(e,r+"_available"),n.total=this.safeString(e,r+"_balance"),i[a]=n}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetUserBalance(e);return this.parseBalance(t)}async fetchOpenOrder(e,t,i={}){await this.loadMarkets();const s={order_id:e},r=await this.privateGetOrder(this.extend(s,i));return this.parseOrder(r)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({open:!0},s))}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({open:!1},s))}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={order_id:e},r=await this.privateGetOrder(this.extend(s,i));if(void 0===r)throw new d(this.id+" fetchOrder() could not find order id "+e);return this.parseOrder(r)}async fetchOrders(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.symbol=r.id),void 0!==t&&(a.start_date=this.iso8601(t)),void 0!==i&&(a.limit=i);const n=await this.privateGetOrders(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseOrders(o,r,t,i)}parseOrderStatus(e){return this.safeString({new:"open",pfilled:"open",filled:"closed",canceled:"canceled"},e,e)}parseOrder(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t,"-"),r=this.safeString(e,"id"),a=this.parse8601(this.safeString(e,"created_at")),n=this.safeString(e,"type"),o=this.safeString(e,"side"),h=this.safeString(e,"price"),d=this.safeString(e,"stop"),c=this.safeString(e,"size"),l=this.safeString(e,"filled"),u=this.parseOrderStatus(this.safeString(e,"status")),f=this.safeValue(e,"meta",{}),p=this.safeValue(f,"post_only",!1);return this.safeOrder({id:r,clientOrderId:void 0,timestamp:a,datetime:this.iso8601(a),lastTradeTimestamp:void 0,status:u,symbol:s,type:n,timeInForce:void 0,postOnly:p,side:o,price:h,stopPrice:d,triggerPrice:d,amount:c,filled:l,remaining:void 0,cost:void 0,trades:void 0,fee:void 0,info:e,average:void 0},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=parseFloat(this.amountToPrecision(e,s)),h={symbol:n.id,side:i,size:this.normalizeNumberIfNeeded(o),type:t},d=this.safeNumberN(a,["triggerPrice","stopPrice","stop"]),c=this.safeValue(a,"meta",{}),l=this.safeValue(c,"post_only",!1),u="market"===t,f=this.isPostOnly(u,l,a);if(!u){const t=parseFloat(this.priceToPrecision(e,r));h.price=this.normalizeNumberIfNeeded(t)}void 0!==d&&(h.stop=this.normalizeNumberIfNeeded(parseFloat(this.priceToPrecision(e,d)))),f&&(h.meta={post_only:!0}),a=this.omit(a,["postOnly","timeInForce","stopPrice","triggerPrice","stop"]);const p=await this.privatePostOrder(this.extend(h,a));return this.parseOrder(p,n)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={order_id:e},r=await this.privateDeleteOrder(this.extend(s,i));return this.parseOrder(r)}async cancelAllOrders(e,t={}){if(void 0===e)throw new o(this.id+" cancelAllOrders() requires a 'symbol' argument");await this.loadMarkets();const i={};let s;s=this.market(e),i.symbol=s.id;const r=await this.privateDeleteOrderAll(this.extend(i,t));return this.parseOrders(r,s)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.symbol=a.id),void 0!==i&&(r.limit=i),void 0!==t&&(r.start_date=this.iso8601(t));const n=await this.privateGetUserTrades(this.extend(r,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,a,t,i)}parseDepositAddress(e,t){let i,s=this.safeString(e,"address");if(void 0!==s){const e=s.split(":");s=this.safeString(e,0),i=this.safeString(e,1)}this.checkAddress(s);const r=this.safeString(e,"currency");t=this.safeCurrency(r,t);const a=this.safeString(e,"network");return{currency:t.code,address:s,tag:i,network:a,info:e}}async fetchDepositAddresses(e,t={}){await this.loadMarkets();const i=this.safeString(t,"network");t=this.omit(t,"network");const s=await this.privateGetUser(t),r=this.safeValue(s,"wallet",[]),a=void 0===i?r:this.filterBy(r,"network",i);return this.parseDepositAddresses(a,e)}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==i&&(r.limit=i),void 0!==t&&(r.start_date=this.iso8601(t));const n=await this.privateGetUserDeposits(this.extend(r,s)),o=this.safeValue(n,"data",[]);return this.parseTransactions(o,a,t,i)}async fetchWithdrawal(e,t,i={}){await this.loadMarkets();const s={transaction_id:e};let r;void 0!==t&&(r=this.currency(t),s.currency=r.id);const a=await this.privateGetUserWithdrawals(this.extend(s,i)),n=this.safeValue(a,"data",[]),o=this.safeValue(n,0,{});return this.parseTransaction(o,r)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==i&&(r.limit=i),void 0!==t&&(r.start_date=this.iso8601(t));const n=await this.privateGetUserWithdrawals(this.extend(r,s)),o=this.safeValue(n,"data",[]);return this.parseTransactions(o,a,t,i)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"transaction_id"),r=this.parse8601(this.safeString(e,"created_at")),a=this.parse8601(this.safeString(e,"updated_at")),n=this.safeString(e,"type"),o=this.safeNumber(e,"amount");let h,d=this.safeString(e,"address");let c,l;if(void 0!==d){const e=d.split(":");d=this.safeString(e,0),c=this.safeString(e,1),h=d,l=c}const u=this.safeString(e,"currency");t=this.safeCurrency(u,t);let f=this.safeValue(e,"status");const p=this.safeValue(e,"dismissed"),m=this.safeValue(e,"rejected");f=f?"ok":p?"canceled":m?"failed":"pending";const g=this.safeString(e,"fee_coin"),y=this.safeCurrencyCode(g,t),b=this.safeNumber(e,"fee");let v;return void 0!==b&&(v={currency:y,cost:b}),{info:e,id:i,txid:s,timestamp:r,datetime:this.iso8601(r),network:void 0,addressFrom:undefined,address:d,addressTo:h,tagFrom:undefined,tag:c,tagTo:l,type:n,amount:o,currency:t.code,status:f,updated:a,fee:v}}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e);void 0!==s&&(i+=":"+s);const n=this.safeString(r,"network");if(void 0===n)throw new o(this.id+" withdraw() requires a network parameter");r=this.omit(r,"network");const h=this.safeValue(this.options,"networks",{}),d=this.safeStringLower2(h,n,e,n),c={currency:a.id,amount:t,address:i,network:d},l=await this.privatePostUserWithdrawal(this.extend(c,r));return this.parseTransaction(l,a)}normalizeNumberIfNeeded(e){return e%1==0&&(e=parseInt(e)),e}sign(e,t="public",i="GET",s={},r,a){const n=this.omit(s,this.extractParams(e));e="/"+this.version+"/"+this.implodeParams(e,s),"GET"!==i&&"DELETE"!==i||Object.keys(n).length&&(e+="?"+this.urlencode(n));const o=this.urls.api.rest+e;if("private"===t){this.checkRequiredCredentials();const t=this.safeInteger2(this.options,"api-expires","expires",parseInt(this.timeout/1e3)),s=this.sum(this.seconds(),t).toString();let o=i+e+s;r={"api-key":this.apiKey,"api-expires":s},"POST"===i&&(r["Content-type"]="application/json",Object.keys(n).length&&(o+=a=this.json(n)));const h=this.hmac(this.encode(o),this.encode(this.secret));r["api-signature"]=h}return{url:o,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,n,o,h){if(void 0!==n&&e>=400&&e<=503){const t=this.id+" "+a,i=this.safeString(n,"message");this.throwBroadlyMatchedException(this.exceptions.broad,i,t);const s=e.toString();this.throwExactlyMatchedException(this.exceptions.exact,s,t)}}}},68639:function(e,t,i){"use strict";const s=i(48819),{AccountNotEnabled:r,ArgumentsRequired:a,AuthenticationError:n,ExchangeError:o,PermissionDenied:h,ExchangeNotAvailable:d,OnMaintenance:c,InvalidOrder:l,OrderNotFound:u,InsufficientFunds:f,BadSymbol:p,BadRequest:m,RateLimitExceeded:g,RequestTimeout:y,NetworkError:b,NotSupported:v}=i(73449),{TICK_SIZE:w,TRUNCATE:S}=i(62115),k=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"huobi",name:"Huobi",countries:["CN"],rateLimit:100,userAgent:this.userAgents.chrome100,certified:!0,version:"v1",hostname:"api.huobi.pro",pro:!0,has:{CORS:void 0,spot:!0,margin:!0,swap:!0,future:!0,option:void 0,addMargin:void 0,borrowMargin:!0,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:!0,createDepositAddress:void 0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchAccounts:!0,fetchBalance:!0,fetchBidsAsks:void 0,fetchBorrowInterest:!0,fetchBorrowRate:void 0,fetchBorrowRateHistories:void 0,fetchBorrowRateHistory:void 0,fetchBorrowRates:!0,fetchBorrowRatesPerSymbol:!0,fetchCanceledOrders:void 0,fetchClosedOrder:void 0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposit:void 0,fetchDepositAddress:!0,fetchDepositAddresses:void 0,fetchDepositAddressesByNetwork:!0,fetchDeposits:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:!0,fetchFundingRate:!0,fetchFundingRateHistory:!0,fetchFundingRates:!0,fetchIndexOHLCV:!0,fetchL3OrderBook:void 0,fetchLedger:!0,fetchLedgerEntry:void 0,fetchLeverage:!1,fetchLeverageTiers:!0,fetchMarketLeverageTiers:!0,fetchMarkets:!0,fetchMarkOHLCV:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterest:!0,fetchOpenInterestHistory:!0,fetchOpenOrder:void 0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderBooks:void 0,fetchOrders:!0,fetchOrderTrades:!0,fetchPosition:!0,fetchPositions:!0,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!0,fetchSettlementHistory:!0,fetchStatus:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!1,fetchTradingLimits:!0,fetchTransactionFee:void 0,fetchTransactionFees:void 0,fetchTransactions:void 0,fetchTransfers:void 0,fetchWithdrawAddresses:!0,fetchWithdrawal:void 0,fetchWithdrawals:!0,fetchWithdrawalWhitelist:void 0,reduceMargin:void 0,repayMargin:!0,setLeverage:!0,setMarginMode:!1,setPositionMode:!1,signIn:void 0,transfer:!0,withdraw:!0},timeframes:{"1m":"1min","5m":"5min","15m":"15min","30m":"30min","1h":"60min","4h":"4hour","1d":"1day","1w":"1week","1M":"1mon","1y":"1year"},urls:{logo:"https://user-images.githubusercontent.com/1294454/76137448-22748a80-604e-11ea-8069-6e389271911d.jpg",hostnames:{contract:"api.hbdm.com",spot:"api.huobi.pro",status:{spot:"status.huobigroup.com",future:{inverse:"status-dm.huobigroup.com",linear:"status-linear-swap.huobigroup.com"},swap:{inverse:"status-swap.huobigroup.com",linear:"status-linear-swap.huobigroup.com"}}},api:{status:"https://{hostname}",contract:"https://{hostname}",spot:"https://{hostname}",public:"https://{hostname}",private:"https://{hostname}",v2Public:"https://{hostname}",v2Private:"https://{hostname}"},www:"https://www.huobi.com",referral:{url:"https://www.huobi.com/en-us/v/register/double-invite/?inviter_id=11343840&invite_code=6rmm2223",discount:.15},doc:["https://huobiapi.github.io/docs/spot/v1/en/","https://huobiapi.github.io/docs/dm/v1/en/","https://huobiapi.github.io/docs/coin_margined_swap/v1/en/","https://huobiapi.github.io/docs/usdt_swap/v1/en/"],fees:"https://www.huobi.com/about/fee/"},api:{v2Public:{get:{"reference/currencies":1,"market-status":1}},v2Private:{get:{"account/ledger":1,"account/withdraw/quota":1,"account/withdraw/address":1,"account/deposit/address":1,"account/repayment":5,"reference/transact-fee-rate":1,"account/asset-valuation":.2,"point/account":5,"sub-user/user-list":1,"sub-user/user-state":1,"sub-user/account-list":1,"sub-user/deposit-address":1,"sub-user/query-deposit":1,"user/api-key":1,"user/uid":1,"algo-orders/opening":1,"algo-orders/history":1,"algo-orders/specific":1,"c2c/offers":1,"c2c/offer":1,"c2c/transactions":1,"c2c/repayment":1,"c2c/account":1,"etp/reference":1,"etp/transactions":5,"etp/transaction":5,"etp/rebalance":1,"etp/limit":1},post:{"account/transfer":1,"account/repayment":5,"point/transfer":5,"sub-user/management":1,"sub-user/creation":1,"sub-user/tradable-market":1,"sub-user/transferability":1,"sub-user/api-key-generation":1,"sub-user/api-key-modification":1,"sub-user/api-key-deletion":1,"sub-user/deduct-mode":1,"algo-orders":1,"algo-orders/cancel-all-after":1,"algo-orders/cancellation":1,"c2c/offer":1,"c2c/cancellation":1,"c2c/cancel-all":1,"c2c/repayment":1,"c2c/transfer":1,"etp/creation":5,"etp/redemption":5,"etp/{transactId}/cancel":10,"etp/batch-cancel":50}},public:{get:{"common/symbols":1,"common/currencys":1,"common/timestamp":1,"common/exchange":1,"settings/currencys":1}},private:{get:{"account/accounts":.2,"account/accounts/{id}/balance":.2,"account/accounts/{sub-uid}":1,"account/history":4,"cross-margin/loan-info":1,"margin/loan-info":1,"fee/fee-rate/get":1,"order/openOrders":.4,"order/orders":.4,"order/orders/{id}":.4,"order/orders/{id}/matchresults":.4,"order/orders/getClientOrder":.4,"order/history":1,"order/matchresults":1,"query/deposit-withdraw":1,"margin/loan-orders":.2,"margin/accounts/balance":.2,"cross-margin/loan-orders":1,"cross-margin/accounts/balance":1,"points/actions":1,"points/orders":1,"subuser/aggregate-balance":10,"stable-coin/exchange_rate":1,"stable-coin/quote":1},post:{"account/transfer":1,"futures/transfer":1,"order/batch-orders":.4,"order/orders/place":.2,"order/orders/submitCancelClientOrder":.2,"order/orders/batchCancelOpenOrders":.4,"order/orders/{id}/submitcancel":.2,"order/orders/batchcancel":.4,"dw/withdraw/api/create":1,"dw/withdraw-virtual/{id}/cancel":1,"dw/transfer-in/margin":10,"dw/transfer-out/margin":10,"margin/orders":10,"margin/orders/{id}/repay":10,"cross-margin/transfer-in":1,"cross-margin/transfer-out":1,"cross-margin/orders":1,"cross-margin/orders/{id}/repay":1,"stable-coin/exchange":1,"subuser/transfer":10}},status:{public:{spot:{get:{"api/v2/summary.json":1}},future:{inverse:{get:{"api/v2/summary.json":1}},linear:{get:{"api/v2/summary.json":1}}},swap:{inverse:{get:{"api/v2/summary.json":1}},linear:{get:{"api/v2/summary.json":1}}}}},spot:{public:{get:{"v2/market-status":1,"v1/common/symbols":1,"v1/common/currencys":1,"v2/settings/common/currencies":1,"v2/reference/currencies":1,"v1/common/timestamp":1,"v1/common/exchange":1,"v1/settings/common/chains":1,"v1/settings/common/currencys":1,"v1/settings/common/symbols":1,"v2/settings/common/symbols":1,"v1/settings/common/market-symbols":1,"market/history/candles":1,"market/history/kline":1,"market/detail/merged":1,"market/tickers":1,"market/detail":1,"market/depth":1,"market/trade":1,"market/history/trade":1,"market/detail/":1,"market/etp":1,"v2/etp/reference":1,"v2/etp/rebalance":1}},private:{get:{"v1/account/accounts":.2,"v1/account/accounts/{account-id}/balance":.2,"v2/account/valuation":1,"v2/account/asset-valuation":.2,"v1/account/history":4,"v2/account/ledger":1,"v2/point/account":5,"v2/account/deposit/address":1,"v2/account/withdraw/quota":1,"v2/account/withdraw/address":1,"v2/reference/currencies":1,"v1/query/deposit-withdraw":1,"v1/query/withdraw/client-order-id":1,"v2/user/api-key":1,"v2/user/uid":1,"v2/sub-user/user-list":1,"v2/sub-user/user-state":1,"v2/sub-user/account-list":1,"v2/sub-user/deposit-address":1,"v2/sub-user/query-deposit":1,"v1/subuser/aggregate-balance":10,"v1/account/accounts/{sub-uid}":1,"v1/order/openOrders":.4,"v1/order/orders/{order-id}":.4,"v1/order/orders/getClientOrder":.4,"v1/order/orders/{order-id}/matchresult":.4,"v1/order/orders/{order-id}/matchresults":.4,"v1/order/orders":.4,"v1/order/history":1,"v1/order/matchresults":1,"v2/reference/transact-fee-rate":1,"v2/algo-orders/opening":1,"v2/algo-orders/history":1,"v2/algo-orders/specific":1,"v1/margin/loan-info":1,"v1/margin/loan-orders":.2,"v1/margin/accounts/balance":.2,"v1/cross-margin/loan-info":1,"v1/cross-margin/loan-orders":1,"v1/cross-margin/accounts/balance":1,"v2/account/repayment":5,"v1/stable-coin/quote":1,"v1/stable_coin/exchange_rate":1,"v2/etp/transactions":5,"v2/etp/transaction":5,"v2/etp/limit":1},post:{"v1/account/transfer":1,"v1/futures/transfer":1,"v2/point/transfer":5,"v2/account/transfer":1,"v1/dw/withdraw/api/create":1,"v1/dw/withdraw-virtual/{withdraw-id}/cancel":1,"v2/sub-user/deduct-mode":1,"v2/sub-user/creation":1,"v2/sub-user/management":1,"v2/sub-user/tradable-market":1,"v2/sub-user/transferability":1,"v2/sub-user/api-key-generation":1,"v2/sub-user/api-key-modification":1,"v2/sub-user/api-key-deletion":1,"v1/subuser/transfer":10,"v1/order/orders/place":.2,"v1/order/batch-orders":.4,"v1/order/orders/{order-id}/submitcancel":.2,"v1/order/orders/submitCancelClientOrder":.2,"v1/order/orders/batchCancelOpenOrders":.4,"v1/order/orders/batchcancel":.4,"v2/algo-orders/cancel-all-after":1,"v2/algo-orders":1,"v2/algo-orders/cancellation":1,"v2/account/repayment":5,"v1/dw/transfer-in/margin":10,"v1/dw/transfer-out/margin":10,"v1/margin/orders":10,"v1/margin/orders/{order-id}/repay":10,"v1/cross-margin/transfer-in":1,"v1/cross-margin/transfer-out":1,"v1/cross-margin/orders":1,"v1/cross-margin/orders/{order-id}/repay":1,"v1/stable-coin/exchange":1,"v2/etp/creation":5,"v2/etp/redemption":5,"v2/etp/{transactId}/cancel":10,"v2/etp/batch-cancel":50}}},contract:{public:{get:{"api/v1/timestamp":1,"heartbeat/":1,"api/v1/contract_contract_info":1,"api/v1/contract_index":1,"api/v1/contract_price_limit":1,"api/v1/contract_open_interest":1,"api/v1/contract_delivery_price":1,"market/depth":1,"market/bbo":1,"market/history/kline":1,"index/market/history/mark_price_kline":1,"market/detail/merged":1,"market/detail/batch_merged":1,"v2/market/detail/batch_merged":1,"market/trade":1,"market/history/trade":1,"api/v1/contract_risk_info":1,"api/v1/contract_insurance_fund":1,"api/v1/contract_adjustfactor":1,"api/v1/contract_his_open_interest":1,"api/v1/contract_ladder_margin":1,"api/v1/contract_api_state":1,"api/v1/contract_elite_account_ratio":1,"api/v1/contract_elite_position_ratio":1,"api/v1/contract_liquidation_orders":1,"api/v1/contract_settlement_records":1,"index/market/history/index":1,"index/market/history/basis":1,"api/v1/contract_estimated_settlement_price":1,"api/v3/contract_liquidation_orders":1,"swap-api/v1/swap_contract_info":1,"swap-api/v1/swap_index":1,"swap-api/v1/swap_price_limit":1,"swap-api/v1/swap_open_interest":1,"swap-ex/market/depth":1,"swap-ex/market/bbo":1,"swap-ex/market/history/kline":1,"index/market/history/swap_mark_price_kline":1,"swap-ex/market/detail/merged":1,"v2/swap-ex/market/detail/batch_merged":1,"index/market/history/swap_premium_index_kline":1,"swap-ex/market/detail/batch_merged":1,"swap-ex/market/trade":1,"swap-ex/market/history/trade":1,"swap-api/v1/swap_risk_info":1,"swap-api/v1/swap_insurance_fund":1,"swap-api/v1/swap_adjustfactor":1,"swap-api/v1/swap_his_open_interest":1,"swap-api/v1/swap_ladder_margin":1,"swap-api/v1/swap_api_state":1,"swap-api/v1/swap_elite_account_ratio":1,"swap-api/v1/swap_elite_position_ratio":1,"swap-api/v1/swap_estimated_settlement_price":1,"swap-api/v1/swap_liquidation_orders":1,"swap-api/v1/swap_settlement_records":1,"swap-api/v1/swap_funding_rate":1,"swap-api/v1/swap_batch_funding_rate":1,"swap-api/v1/swap_historical_funding_rate":1,"swap-api/v3/swap_liquidation_orders":1,"index/market/history/swap_estimated_rate_kline":1,"index/market/history/swap_basis":1,"linear-swap-api/v1/swap_contract_info":1,"linear-swap-api/v1/swap_index":1,"linear-swap-api/v1/swap_price_limit":1,"linear-swap-api/v1/swap_open_interest":1,"linear-swap-ex/market/depth":1,"linear-swap-ex/market/bbo":1,"linear-swap-ex/market/history/kline":1,"index/market/history/linear_swap_mark_price_kline":1,"linear-swap-ex/market/detail/merged":1,"linear-swap-ex/market/detail/batch_merged":1,"v2/linear-swap-ex/market/detail/batch_merged":1,"linear-swap-ex/market/trade":1,"linear-swap-ex/market/history/trade":1,"linear-swap-api/v1/swap_risk_info":1,"swap-api/v1/linear-swap-api/v1/swap_insurance_fund":1,"linear-swap-api/v1/swap_adjustfactor":1,"linear-swap-api/v1/swap_cross_adjustfactor":1,"linear-swap-api/v1/swap_his_open_interest":1,"linear-swap-api/v1/swap_ladder_margin":1,"linear-swap-api/v1/swap_cross_ladder_margin":1,"linear-swap-api/v1/swap_api_state":1,"linear-swap-api/v1/swap_cross_transfer_state":1,"linear-swap-api/v1/swap_cross_trade_state":1,"linear-swap-api/v1/swap_elite_account_ratio":1,"linear-swap-api/v1/swap_elite_position_ratio":1,"linear-swap-api/v1/swap_liquidation_orders":1,"linear-swap-api/v1/swap_settlement_records":1,"linear-swap-api/v1/swap_funding_rate":1,"linear-swap-api/v1/swap_batch_funding_rate":1,"linear-swap-api/v1/swap_historical_funding_rate":1,"linear-swap-api/v3/swap_liquidation_orders":1,"index/market/history/linear_swap_premium_index_kline":1,"index/market/history/linear_swap_estimated_rate_kline":1,"index/market/history/linear_swap_basis":1,"linear-swap-api/v1/swap_estimated_settlement_price":1}},private:{get:{"api/v1/contract_api_trading_status":1,"swap-api/v1/swap_api_trading_status":1,"linear-swap-api/v1/swap_api_trading_status":1,"linear-swap-api/v3/unified_account_info":1,"linear-swap-api/v3/swap_unified_account_type":1},post:{"api/v1/contract_balance_valuation":1,"api/v1/contract_account_info":1,"api/v1/contract_position_info":1,"api/v1/contract_sub_auth":1,"api/v1/contract_sub_account_list":1,"api/v1/contract_sub_account_info_list":1,"api/v1/contract_sub_account_info":1,"api/v1/contract_sub_position_info":1,"api/v1/contract_financial_record":1,"api/v1/contract_financial_record_exact":1,"api/v1/contract_user_settlement_records":1,"api/v1/contract_order_limit":1,"api/v1/contract_fee":1,"api/v1/contract_transfer_limit":1,"api/v1/contract_position_limit":1,"api/v1/contract_account_position_info":1,"api/v1/contract_master_sub_transfer":1,"api/v1/contract_master_sub_transfer_record":1,"api/v1/contract_available_level_rate":1,"api/v3/contract_financial_record":1,"api/v3/contract_financial_record_exact":1,"api/v1/contract_order":1,"v1/contract_batchorder":1,"api/v1/contract_cancel":1,"api/v1/contract_cancelall":1,"api/v1/contract_switch_lever_rate":1,"api/v1/lightning_close_position":1,"api/v1/contract_order_info":1,"api/v1/contract_order_detail":1,"api/v1/contract_openorders":1,"api/v1/contract_hisorders":1,"api/v1/contract_hisorders_exact":1,"api/v1/contract_matchresults":1,"api/v1/contract_matchresults_exact":1,"api/v3/contract_hisorders":1,"api/v3/contract_hisorders_exact":1,"api/v3/contract_matchresults":1,"api/v3/contract_matchresults_exact":1,"api/v1/contract_trigger_order":1,"api/v1/contract_trigger_cancel":1,"api/v1/contract_trigger_cancelall":1,"api/v1/contract_trigger_openorders":1,"api/v1/contract_trigger_hisorders":1,"api/v1/contract_tpsl_order":1,"api/v1/contract_tpsl_cancel":1,"api/v1/contract_tpsl_cancelall":1,"api/v1/contract_tpsl_openorders":1,"api/v1/contract_tpsl_hisorders":1,"api/v1/contract_relation_tpsl_order":1,"api/v1/contract_track_order":1,"api/v1/contract_track_cancel":1,"api/v1/contract_track_cancelall":1,"api/v1/contract_track_openorders":1,"api/v1/contract_track_hisorders":1,"swap-api/v1/swap_balance_valuation":1,"swap-api/v1/swap_account_info":1,"swap-api/v1/swap_position_info":1,"swap-api/v1/swap_account_position_info":1,"swap-api/v1/swap_sub_auth":1,"swap-api/v1/swap_sub_account_list":1,"swap-api/v1/swap_sub_account_info_list":1,"swap-api/v1/swap_sub_account_info":1,"swap-api/v1/swap_sub_position_info":1,"swap-api/v1/swap_financial_record":1,"swap-api/v1/swap_financial_record_exact":1,"swap-api/v1/swap_user_settlement_records":1,"swap-api/v1/swap_available_level_rate":1,"swap-api/v1/swap_order_limit":1,"swap-api/v1/swap_fee":1,"swap-api/v1/swap_transfer_limit":1,"swap-api/v1/swap_position_limit":1,"swap-api/v1/swap_master_sub_transfer":1,"swap-api/v1/swap_master_sub_transfer_record":1,"swap-api/v3/swap_financial_record":1,"swap-api/v3/swap_financial_record_exact":1,"swap-api/v1/swap_order":1,"swap-api/v1/swap_batchorder":1,"swap-api/v1/swap_cancel":1,"swap-api/v1/swap_cancelall":1,"swap-api/v1/swap_lightning_close_position":1,"swap-api/v1/swap_switch_lever_rate":1,"swap-api/v1/swap_order_info":1,"swap-api/v1/swap_order_detail":1,"swap-api/v1/swap_openorders":1,"swap-api/v1/swap_hisorders":1,"swap-api/v1/swap_hisorders_exact":1,"swap-api/v1/swap_matchresults":1,"swap-api/v1/swap_matchresults_exact":1,"swap-api/v3/swap_matchresults":1,"swap-api/v3/swap_matchresults_exact":1,"swap-api/v3/swap_hisorders":1,"swap-api/v3/swap_hisorders_exact":1,"swap-api/v1/swap_trigger_order":1,"swap-api/v1/swap_trigger_cancel":1,"swap-api/v1/swap_trigger_cancelall":1,"swap-api/v1/swap_trigger_openorders":1,"swap-api/v1/swap_trigger_hisorders":1,"swap-api/v1/swap_tpsl_order":1,"swap-api/v1/swap_tpsl_cancel":1,"swap-api/v1/swap_tpsl_cancelall":1,"swap-api/v1/swap_tpsl_openorders":1,"swap-api/v1/swap_tpsl_hisorders":1,"swap-api/v1/swap_relation_tpsl_order":1,"swap-api/v1/swap_track_order":1,"swap-api/v1/swap_track_cancel":1,"swap-api/v1/swap_track_cancelall":1,"swap-api/v1/swap_track_openorders":1,"swap-api/v1/swap_track_hisorders":1,"linear-swap-api/v1/swap_lever_position_limit":1,"linear-swap-api/v1/swap_cross_lever_position_limit":1,"linear-swap-api/v1/swap_balance_valuation":1,"linear-swap-api/v1/swap_account_info":1,"linear-swap-api/v1/swap_cross_account_info":1,"linear-swap-api/v1/swap_position_info":1,"linear-swap-api/v1/swap_cross_position_info":1,"linear-swap-api/v1/swap_account_position_info":1,"linear-swap-api/v1/swap_cross_account_position_info":1,"linear-swap-api/v1/swap_sub_auth":1,"linear-swap-api/v1/swap_sub_account_list":1,"linear-swap-api/v1/swap_cross_sub_account_list":1,"linear-swap-api/v1/swap_sub_account_info_list":1,"linear-swap-api/v1/swap_cross_sub_account_info_list":1,"linear-swap-api/v1/swap_sub_account_info":1,"linear-swap-api/v1/swap_cross_sub_account_info":1,"linear-swap-api/v1/swap_sub_position_info":1,"linear-swap-api/v1/swap_cross_sub_position_info":1,"linear-swap-api/v1/swap_financial_record":1,"linear-swap-api/v1/swap_financial_record_exact":1,"linear-swap-api/v1/swap_user_settlement_records":1,"linear-swap-api/v1/swap_cross_user_settlement_records":1,"linear-swap-api/v1/swap_available_level_rate":1,"linear-swap-api/v1/swap_cross_available_level_rate":1,"linear-swap-api/v1/swap_order_limit":1,"linear-swap-api/v1/swap_fee":1,"linear-swap-api/v1/swap_transfer_limit":1,"linear-swap-api/v1/swap_cross_transfer_limit":1,"linear-swap-api/v1/swap_position_limit":1,"linear-swap-api/v1/swap_cross_position_limit":1,"linear-swap-api/v1/swap_master_sub_transfer":1,"linear-swap-api/v1/swap_master_sub_transfer_record":1,"linear-swap-api/v1/swap_transfer_inner":1,"linear-swap-api/v3/swap_financial_record":1,"linear-swap-api/v3/swap_financial_record_exact":1,"linear-swap-api/v1/swap_order":1,"linear-swap-api/v1/swap_cross_order":1,"linear-swap-api/v1/swap_batchorder":1,"linear-swap-api/v1/swap_cross_batchorder":1,"linear-swap-api/v1/swap_cancel":1,"linear-swap-api/v1/swap_cross_cancel":1,"linear-swap-api/v1/swap_cancelall":1,"linear-swap-api/v1/swap_cross_cancelall":1,"linear-swap-api/v1/swap_switch_lever_rate":1,"linear-swap-api/v1/swap_cross_switch_lever_rate":1,"linear-swap-api/v1/swap_lightning_close_position":1,"linear-swap-api/v1/swap_cross_lightning_close_position":1,"linear-swap-api/v1/swap_order_info":1,"linear-swap-api/v1/swap_cross_order_info":1,"linear-swap-api/v1/swap_order_detail":1,"linear-swap-api/v1/swap_cross_order_detail":1,"linear-swap-api/v1/swap_openorders":1,"linear-swap-api/v1/swap_cross_openorders":1,"linear-swap-api/v1/swap_hisorders":1,"linear-swap-api/v1/swap_cross_hisorders":1,"linear-swap-api/v1/swap_hisorders_exact":1,"linear-swap-api/v1/swap_cross_hisorders_exact":1,"linear-swap-api/v1/swap_matchresults":1,"linear-swap-api/v1/swap_cross_matchresults":1,"linear-swap-api/v1/swap_matchresults_exact":1,"linear-swap-api/v1/swap_cross_matchresults_exact":1,"linear-swap-api/v1/swap_switch_position_mode":1,"linear-swap-api/v1/swap_cross_switch_position_mode":1,"linear-swap-api/v3/swap_matchresults":1,"linear-swap-api/v3/swap_cross_matchresults":1,"linear-swap-api/v3/swap_matchresults_exact":1,"linear-swap-api/v3/swap_cross_matchresults_exact":1,"linear-swap-api/v3/swap_hisorders":1,"linear-swap-api/v3/swap_cross_hisorders":1,"linear-swap-api/v3/swap_hisorders_exact":1,"linear-swap-api/v3/swap_cross_hisorders_exact":1,"linear-swap-api/v3/swap_switch_account_type":1,"linear-swap-api/v1/swap_trigger_order":1,"linear-swap-api/v1/swap_cross_trigger_order":1,"linear-swap-api/v1/swap_trigger_cancel":1,"linear-swap-api/v1/swap_cross_trigger_cancel":1,"linear-swap-api/v1/swap_trigger_cancelall":1,"linear-swap-api/v1/swap_cross_trigger_cancelall":1,"linear-swap-api/v1/swap_trigger_openorders":1,"linear-swap-api/v1/swap_cross_trigger_openorders":1,"linear-swap-api/v1/swap_trigger_hisorders":1,"linear-swap-api/v1/swap_cross_trigger_hisorders":1,"linear-swap-api/v1/swap_tpsl_order":1,"linear-swap-api/v1/swap_cross_tpsl_order":1,"linear-swap-api/v1/swap_tpsl_cancel":1,"linear-swap-api/v1/swap_cross_tpsl_cancel":1,"linear-swap-api/v1/swap_tpsl_cancelall":1,"linear-swap-api/v1/swap_cross_tpsl_cancelall":1,"linear-swap-api/v1/swap_tpsl_openorders":1,"linear-swap-api/v1/swap_cross_tpsl_openorders":1,"linear-swap-api/v1/swap_tpsl_hisorders":1,"linear-swap-api/v1/swap_cross_tpsl_hisorders":1,"linear-swap-api/v1/swap_relation_tpsl_order":1,"linear-swap-api/v1/swap_cross_relation_tpsl_order":1,"linear-swap-api/v1/swap_track_order":1,"linear-swap-api/v1/swap_cross_track_order":1,"linear-swap-api/v1/swap_track_cancel":1,"linear-swap-api/v1/swap_cross_track_cancel":1,"linear-swap-api/v1/swap_track_cancelall":1,"linear-swap-api/v1/swap_cross_track_cancelall":1,"linear-swap-api/v1/swap_track_openorders":1,"linear-swap-api/v1/swap_cross_track_openorders":1,"linear-swap-api/v1/swap_track_hisorders":1,"linear-swap-api/v1/swap_cross_track_hisorders":1}}}},fees:{trading:{feeSide:"get",tierBased:!1,percentage:!0,maker:this.parseNumber("0.002"),taker:this.parseNumber("0.002")}},exceptions:{broad:{"contract is restricted of closing positions on API.  Please contact customer service":c,maintain:c},exact:{403:n,1010:r,1003:n,1013:p,1017:u,1034:l,1036:l,1039:l,1041:l,1047:f,1048:f,1051:l,1066:p,1067:l,1094:l,1220:r,1303:m,1461:l,"bad-request":m,"validation-format-error":m,"validation-constraints-required":m,"base-date-limit-error":m,"api-not-support-temp-addr":h,timeout:y,"gateway-internal-error":d,"account-frozen-balance-insufficient-error":f,"invalid-amount":l,"order-limitorder-amount-min-error":l,"order-limitorder-amount-max-error":l,"order-marketorder-amount-min-error":l,"order-limitorder-price-min-error":l,"order-limitorder-price-max-error":l,"order-stop-order-hit-trigger":l,"order-value-min-error":l,"order-invalid-price":l,"order-holding-limit-failed":l,"order-orderprice-precision-error":l,"order-etp-nav-price-max-error":l,"order-orderstate-error":u,"order-queryorder-invalid":u,"order-update-error":d,"api-signature-check-failed":n,"api-signature-not-valid":n,"base-record-invalid":u,"base-symbol-trade-disabled":p,"base-symbol-error":p,"system-maintenance":c,"base-request-exceed-frequency-limit":g,"invalid symbol":p,"symbol trade not open now":p,"require-symbol":p,"invalid-address":m,"base-currency-chain-error":m,"dw-insufficient-balance":f,"base-withdraw-fee-error":m,"dw-withdraw-min-limit":m}},precisionMode:w,options:{fetchMarkets:{types:{spot:!0,future:{linear:!0,inverse:!0},swap:{linear:!0,inverse:!0}}},withdraw:{includeFee:!1},defaultType:"spot",defaultSubType:"linear",defaultNetwork:"ERC20",defaultNetworks:{ETH:"ERC20",BTC:"BTC",USDT:"TRC20"},networks:{ALGO:"ALGO",ALGORAND:"ALGO",BEP20:"BEP20",BSC:"BEP20",ERC20:"ERC20",ETH:"ERC20",AVALANCHE:"AVAXCCHAIN",AVAX:"AVAXCCHAIN",HRC20:"HECO",HECO:"HECO",TRC20:"TRC20",TRX:"TRC20",BTC:"BTC",BITCOIN:"BTC",ARBITRUM:"ARB",ARB:"ARB",SOLANA:"SOL",SOL:"SOL",SPL:"SOL",PRC20:"PRC20",POLYGON:"PRC20",MATIC:"PRC20"},networksById:{ALGO:"ALGO",BEP20:"BEP20",ERC20:"ERC20",AVAXCCHAIN:"AVALANCHE",HECO:"HRC20",TRC20:"TRC20",BTC:"BTC",ARB:"ARBITRUM",SOL:"SOLANA",PRC20:"POLYGON"},fetchOrdersByStatesMethod:"spot_private_get_v1_order_orders",createMarketBuyOrderRequiresPrice:!0,language:"en-US",broker:{id:"AA03022abc"},accountsByType:{spot:"pro",funding:"pro",future:"futures"},accountsById:{spot:"spot",margin:"margin",otc:"otc",point:"point","super-margin":"super-margin",investment:"investment",borrow:"borrow","grid-trading":"grid-trading","deposit-earning":"deposit-earning","otc-options":"otc-options"},marginAccounts:{cross:"super-margin",isolated:"margin"},typesByAccount:{pro:"spot",futures:"future"},spot:{stopOrderTypes:{"stop-limit":!0,"buy-stop-limit":!0,"sell-stop-limit":!0,"stop-limit-fok":!0,"buy-stop-limit-fok":!0,"sell-stop-limit-fok":!0},limitOrderTypes:{limit:!0,"buy-limit":!0,"sell-limit":!0,ioc:!0,"buy-ioc":!0,"sell-ioc":!0,"limit-maker":!0,"buy-limit-maker":!0,"sell-limit-maker":!0,"stop-limit":!0,"buy-stop-limit":!0,"sell-stop-limit":!0,"limit-fok":!0,"buy-limit-fok":!0,"sell-limit-fok":!0,"stop-limit-fok":!0,"buy-stop-limit-fok":!0,"sell-stop-limit-fok":!0}}},commonCurrencies:{GET:"Themis",GTC:"Game.com",HIT:"HitChain",HOT:"Hydro Protocol",PNT:"Penta",SBTC:"Super Bitcoin",SOUL:"Soulsaver",BIFI:"Bitcoin File"}})}async fetchStatus(e={}){let t;await this.loadMarkets(),[t,e]=this.handleMarketTypeAndParams("fetchMyTrades",void 0,e);let i="statusPublicSpotGetApiV2SummaryJson";if("spot"!==t){const s=this.safeString(e,"subType",this.options.defaultSubType);"swap"===t?"linear"===s?i="statusPublicSwapLinearGetApiV2SummaryJson":"inverse"===s&&(i="statusPublicSwapInverseGetApiV2SummaryJson"):"future"===t?"linear"===s?i="statusPublicFutureLinearGetApiV2SummaryJson":"inverse"===s&&(i="statusPublicFutureInverseGetApiV2SummaryJson"):"contract"===t&&(i="contractPublicGetHeartbeat")}const s=await this[i]();let r,a,n;if("contractPublicGetHeartbeat"===i){r="ok"===this.safeString(s,"status")?"ok":"maintenance",a=this.safeString(s,"ts")}else{const e=this.safeValue(s,"status",{});r="none"===this.safeString(e,"indicator")?"ok":"maintenance";const t=this.safeValue(s,"page",{}),i=this.safeString(t,"updated_at");a=this.parse8601(i),n=this.safeString(t,"url")}return{status:r,updated:a,eta:void 0,url:n,info:s}}async fetchTime(e={}){const t=this.safeValue(this.options,"fetchTime",{}),i=this.safeString(this.options,"defaultType","spot");let s=this.safeString(t,"type",i);s=this.safeString(e,"type",s);let r="spotPublicGetV1CommonTimestamp";"future"!==s&&"swap"!==s||(r="contractPublicGetApiV1Timestamp");const a=await this[r](e);return this.safeInteger2(a,"data","ts")}parseTradingFee(e,t){const i=this.safeString(e,"symbol");return{info:e,symbol:this.safeSymbol(i,t),maker:this.safeNumber(e,"actualMakerRate"),taker:this.safeNumber(e,"actualTakerRate")}}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbols:i.id},r=await this.spotPrivateGetV2ReferenceTransactFeeRate(this.extend(s,t)),a=this.safeValue(r,"data",[]),n=this.safeValue(a,0,{});return this.parseTradingFee(n,i)}async fetchTradingLimits(e,t={}){await this.loadMarkets(),void 0===e&&(e=this.symbols);const i={};for(let s=0;s<e.length;s++){const r=e[s];i[r]=await this.fetchTradingLimitsById(this.marketId(r),t)}return i}async fetchTradingLimitsById(e,t={}){const i={symbol:e},s=await this.spotPublicGetV1CommonExchange(this.extend(i,t));return this.parseTradingLimits(this.safeValue(s,"data",{}))}parseTradingLimits(e,t,i={}){return{info:e,limits:{amount:{min:this.safeNumber(e,"limit-order-must-greater-than"),max:this.safeNumber(e,"limit-order-must-less-than")}}}}costToPrecision(e,t){return this.decimalToPrecision(t,S,this.markets[e].precision.cost,this.precisionMode)}async fetchMarkets(e={}){const t=this.safeValue(this.options,"fetchMarkets",{}),i=this.safeValue(t,"types",{});let s=[],r=[];const a=Object.keys(i);for(let t=0;t<a.length;t++){const s=a[t],n=this.safeValue(i,s);if(!0===n)r.push(this.fetchMarketsByTypeAndSubType(s,void 0,e));else if(n){const t=Object.keys(n);for(let i=0;i<t.length;i++){const a=t[i];this.safeValue(n,a)&&r.push(this.fetchMarketsByTypeAndSubType(s,a,e))}}}r=await Promise.all(r);for(let e=0;e<r.length;e++)s=this.arrayConcat(s,r[e]);return s}async fetchMarketsByTypeAndSubType(e,t,i={}){let s="spotPublicGetV1CommonSymbols";const r=this.omit(i,["type","subType"]),a="spot"===e,n="spot"!==e,o="future"===e,h="swap"===e;let d,c;const l={};n&&(d="linear"===t,c="inverse"===t,d?(s="contractPublicGetLinearSwapApiV1SwapContractInfo",o&&(l.business_type="futures")):c&&(o?s="contractPublicGetApiV1ContractContractInfo":h&&(s="contractPublicGetSwapApiV1SwapContractInfo")));const u=await this[s](this.extend(l,r)),f=this.safeValue(u,"data",[]);if(f.length<1)throw new b(this.id+" fetchMarkets() returned an empty response: "+this.json(f));const p=[];for(let t=0;t<f.length;t++){const i=f[t];let s,r,l,u,m,g;if(n){if(u=this.safeString(i,"contract_code"),m=u.toLowerCase(),h){const e=u.split("-");s=this.safeString(i,"symbol"),g=s.toLowerCase(),r=this.safeStringLower(e,1),l=c?s:r}else if(o)if(s=this.safeString(i,"symbol"),g=s.toLowerCase(),c)r="USD",l=s;else{const e=this.safeString(i,"pair").split("-");r=this.safeString(e,1),l=r}}else s=this.safeString(i,"base-currency"),g=s.toLowerCase(),r=this.safeString(i,"quote-currency"),u=s+r,m=u.toLowerCase();const y=this.safeCurrencyCode(s),b=this.safeCurrencyCode(r),v=this.safeCurrencyCode(l);let w,S=y+"/"+b;n&&(c?S+=":"+y:d&&(S+=":"+b),o&&(w=this.safeInteger(i,"delivery_time"),S+="-"+this.yymmdd(w)));const T=this.safeNumber(i,"contract_size");let _=this.safeNumber(i,"min-order-value");const O=this.safeNumber(i,"max-order-amt");let M,I,x,C,P,A,N=this.safeNumber(i,"min-order-amt");if(n&&(d?N=T:c&&(_=T)),a?(M=this.parseNumber(this.parsePrecision(this.safeString(i,"price-precision"))),I=this.parseNumber(this.parsePrecision(this.safeString(i,"amount-precision"))),x=this.parseNumber(this.parsePrecision(this.safeString(i,"value-precision")))):(M=this.safeNumber(i,"price_tick"),I=this.parseNumber("1")),a&&(C="OMG"===y?this.parseNumber("0"):this.parseNumber("0.002"),P="OMG"===y?this.parseNumber("0"):this.parseNumber("0.002")),a){A="online"===this.safeString(i,"state")}else if(n){A=1===this.safeInteger(i,"contract_status")}const B=this.safeString(i,"leverage-ratio","1"),E=this.safeString(i,"super-margin-leverage-ratio","1"),V=k.stringGt(B,"1")||k.stringGt(E,"1");p.push({id:u,lowercaseId:m,symbol:S,base:y,quote:b,settle:v,baseId:s,lowercaseBaseId:g,quoteId:r,settleId:l,type:e,spot:a,margin:a&&V,swap:h,future:o,option:!1,active:A,contract:n,linear:d,inverse:c,taker:P,maker:C,contractSize:T,expiry:w,expiryDatetime:this.iso8601(w),strike:void 0,optionType:void 0,precision:{amount:I,price:M,cost:x},limits:{leverage:{min:this.parseNumber("1"),max:this.parseNumber(B),superMax:this.parseNumber(E)},amount:{min:N,max:O},price:{min:void 0,max:void 0},cost:{min:_,max:void 0}},info:i})}return p}parseTicker(e,t){const i=this.safeString2(e,"symbol","contract_code"),s=this.safeSymbol(i,t),r=this.safeInteger2(e,"ts","quoteTime");let a,n,o,h;"bid"in e&&(Array.isArray(e.bid)?(a=this.safeString(e.bid,0),n=this.safeString(e.bid,1)):(a=this.safeString(e,"bid"),n=this.safeString(e,"bidSize"))),"ask"in e&&(Array.isArray(e.ask)?(o=this.safeString(e.ask,0),h=this.safeString(e.ask,1)):(o=this.safeString(e,"ask"),h=this.safeString(e,"askSize")));const d=this.safeString(e,"open"),c=this.safeString(e,"close"),l=this.safeString(e,"amount"),u=this.safeString(e,"vol");return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:a,bidVolume:n,ask:o,askVolume:h,vwap:void 0,open:d,close:c,last:c,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:l,quoteVolume:u,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={};let r="symbol",a="spotPublicGetMarketDetailMerged";i.linear?(a="contractPublicGetLinearSwapExMarketDetailMerged",r="contract_code"):i.inverse&&(i.future?a="contractPublicGetMarketDetailMerged":i.swap&&(a="contractPublicGetSwapExMarketDetailMerged",r="contract_code")),s[r]=i.id;const n=await this[a](this.extend(s,t)),o=this.safeValue(n,"tick",{}),h=this.parseTicker(o,i),d=this.safeInteger(n,"ts");return h.timestamp=d,h.datetime=this.iso8601(d),h}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=this.safeString(e,0);let s,r,a;void 0!==i&&(s=this.market(i));let n="spotPublicGetMarketTickers";[r,t]=this.handleMarketTypeAndParams("fetchTickers",s,t),[a,t]=this.handleSubTypeAndParams("fetchTickers",s,t);const o={},h="future"===r,d="swap"===r,c="linear"===a,l="inverse"===a;(h||d)&&(c?(n="contractPublicGetLinearSwapExMarketDetailBatchMerged",h&&(o.business_type="futures")):l&&(h?n="contractPublicGetMarketDetailBatchMerged":d&&(n="contractPublicGetSwapExMarketDetailBatchMerged"))),t=this.omit(t,["type","subType"]);const u=await this[n](this.extend(o,t)),f=this.safeValue2(u,"data","ticks",[]),p=this.safeInteger(u,"ts"),m={};for(let e=0;e<f.length;e++){const t=this.parseTicker(f[e]);if(h&&c)for(let e=0;e<this.symbols.length;e++){const i=this.symbols[e],s=this.market(i),r=this.safeString(s.info,"contract_type");if("this_week"===r&&t.symbol===s.baseId+"-"+s.quoteId+"-CW"){t.symbol=s.symbol;break}if("next_week"===r&&t.symbol===s.baseId+"-"+s.quoteId+"-NW"){t.symbol=s.symbol;break}if("this_quarter"===r&&t.symbol===s.baseId+"-"+s.quoteId+"-CQ"){t.symbol=s.symbol;break}if("next_quarter"===r&&t.symbol===s.baseId+"-"+s.quoteId+"-NQ"){t.symbol=s.symbol;break}}const i=t.symbol;t.timestamp=p,t.datetime=this.iso8601(p),m[i]=t}return this.filterByArray(m,"symbol",e)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={type:"step0"};let a="symbol",n="spotPublicGetMarketDepth";if(s.linear)n="contractPublicGetLinearSwapExMarketDepth",a="contract_code";else if(s.inverse)s.future?n="contractPublicGetMarketDepth":s.swap&&(n="contractPublicGetSwapExMarketDepth",a="contract_code");else if(void 0!==t){if(5!==t&&10!==t&&20!==t&&150!==t)throw new m(this.id+" fetchOrderBook() limit argument must be undefined, 5, 10, 20, or 150, default is 150");150!==t&&(r.depth=t)}r[a]=s.id;const h=await this[n](this.extend(r,i));if("tick"in h){if(!h.tick)throw new p(this.id+" fetchOrderBook() returned empty response: "+this.json(h));const t=this.safeValue(h,"tick"),i=this.safeInteger(t,"ts",this.safeInteger(h,"ts")),s=this.parseOrderBook(t,e,i);return s.nonce=this.safeInteger(t,"version"),s}throw new o(this.id+" fetchOrderBook() returned unrecognized response: "+this.json(h))}parseTrade(e,t){const i=this.safeString2(e,"contract_code","symbol"),s=(t=this.safeMarket(i,t)).symbol;let r=this.safeInteger2(e,"ts","created-at");r=this.safeInteger2(e,"created_at","create_date",r);const a=this.safeString2(e,"order-id","order_id");let n=this.safeString(e,"direction"),o=this.safeString(e,"type");if(void 0!==o){const e=o.split("-");n=e[0],o=e[1]}const h=this.safeStringLower(e,"role"),d=this.safeString2(e,"price","trade_price");let c=this.safeString2(e,"filled-amount","amount");c=this.safeString(e,"trade_volume",c);const l=this.safeString(e,"trade_turnover");let u,f=this.safeString2(e,"filled-fees","trade_fee");const p=this.safeString2(e,"fee-currency","fee_asset");let m=this.safeCurrencyCode(p);const g=this.safeString(e,"filled-points");if(void 0!==g&&(void 0===f||k.stringEquals(f,"0"))){const t=this.safeString(e,"fee-deduct-currency");void 0!==t&&(f=g,m=this.safeCurrencyCode(t))}void 0!==f&&(u={cost:f,currency:m});const y=this.safeString2(e,"trade-id","tradeId"),b=this.safeString2(e,"trade_id","id",y);return this.safeTrade({id:b,info:e,order:a,timestamp:r,datetime:this.iso8601(r),symbol:s,type:o,side:n,takerOrMaker:h,price:d,amount:c,cost:l,fee:u},t)}async fetchOrderTrades(e,t,i,s,r={}){let a,n;void 0!==t&&(a=this.market(t)),[n,r]=this.handleMarketTypeAndParams("fetchOrderTrades",a,r);const o=this.getSupportedMapping(n,{spot:"fetchSpotOrderTrades"});return await this[o](e,t,i,s,r)}async fetchSpotOrderTrades(e,t,i,s,r={}){await this.loadMarkets();const a={"order-id":e},n=await this.spotPrivateGetV1OrderOrdersOrderIdMatchresults(this.extend(a,r));return this.parseTrades(n.data,void 0,i,s)}async fetchMyTrades(e,t,i,s={}){let r,n;await this.loadMarkets(),void 0!==e&&(r=this.market(e)),[n,s]=this.handleMarketTypeAndParams("fetchMyTrades",r,s);const o={};let h;if("spot"===n)void 0!==e&&(r=this.market(e),o.symbol=r.id),void 0!==i&&(o.size=i),void 0!==t&&(o["start-time"]=t),h="spotPrivateGetV1OrderMatchresults";else{if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a symbol for "+n+" orders");if(o.contract=r.id,o.trade_type=0,void 0!==t&&(o.start_time=t),void 0!==i&&(o.page_size=i),r.linear){let e;[e,s]=this.handleMarginModeAndParams("fetchMyTrades",s),e=void 0===e?"cross":e,"isolated"===e?h="contractPrivatePostLinearSwapApiV3SwapMatchresultsExact":"cross"===e&&(h="contractPrivatePostLinearSwapApiV3SwapCrossMatchresultsExact")}else if(r.inverse)if("future"===n)h="contractPrivatePostApiV3ContractMatchresultsExact",o.symbol=r.settleId;else{if("swap"!==n)throw new v(this.id+" fetchMyTrades() does not support "+n+" markets");h="contractPrivatePostSwapApiV3SwapMatchresultsExact"}}const d=await this[h](this.extend(o,s));let c=this.safeValue(d,"data");return Array.isArray(c)||(c=this.safeValue(c,"trades")),this.parseTrades(c,r,t,i)}async fetchTrades(e,t,i=1e3,s={}){await this.loadMarkets();const r=this.market(e),a={};let n="symbol",o="spotPublicGetMarketHistoryTrade";r.future?r.inverse?o="contractPublicGetMarketHistoryTrade":r.linear&&(o="contractPublicGetLinearSwapExMarketHistoryTrade",n="contract_code"):r.swap&&(r.inverse?o="contractPublicGetSwapExMarketHistoryTrade":r.linear&&(o="contractPublicGetLinearSwapExMarketHistoryTrade"),n="contract_code"),a[n]=r.id,void 0!==i&&(a.size=i);const h=await this[o](this.extend(a,s)),d=this.safeValue(h,"data",[]);let c=[];for(let e=0;e<d.length;e++){const t=this.safeValue(d[e],"data",[]);for(let e=0;e<t.length;e++){const i=this.parseTrade(t[e],r);c.push(i)}}return c=this.sortBy(c,"timestamp"),this.filterBySymbolSinceLimit(c,r.symbol,t,i)}parseOHLCV(e,t){return[this.safeTimestamp(e,"id"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"amount")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={period:this.safeString(this.timeframes,t,t)};let o="symbol";const h=this.safeString(r,"price");r=this.omit(r,"price");let d="spotPublicGetMarketHistoryCandles";if(a.spot)void 0!==i&&(n.from=parseInt(i/1e3)),void 0!==s&&(n.size=s);else if(a.future){if(a.inverse)if("mark"===h)d="contractPublicGetIndexMarketHistoryMarkPriceKline";else if("index"===h)d="contractPublicGetIndexMarketHistoryIndex";else{if("premiumIndex"===h)throw new m(this.id+" "+a.type+" has no api endpoint for "+h+" kline data");d="contractPublicGetMarketHistoryKline"}else if(a.linear){if("mark"===h)d="contractPublicGetIndexMarketHistoryLinearSwapMarkPriceKline";else{if("index"===h)throw new m(this.id+" "+a.type+" has no api endpoint for "+h+" kline data");d="premiumIndex"===h?"contractPublicGetIndexMarketHistoryLinearSwapPremiumIndexKline":"contractPublicGetLinearSwapExMarketHistoryKline"}o="contract_code"}}else if(a.swap){if(a.inverse)if("mark"===h)d="contractPublicGetIndexMarketHistorySwapMarkPriceKline";else{if("index"===h)throw new m(this.id+" "+a.type+" has no api endpoint for "+h+" kline data");d="premiumIndex"===h?"contractPublicGetIndexMarketHistorySwapPremiumIndexKline":"contractPublicGetSwapExMarketHistoryKline"}else if(a.linear)if("mark"===h)d="contractPublicGetIndexMarketHistoryLinearSwapMarkPriceKline";else{if("index"===h)throw new m(this.id+" "+a.type+" has no api endpoint for "+h+" kline data");d="premiumIndex"===h?"contractPublicGetIndexMarketHistoryLinearSwapPremiumIndexKline":"contractPublicGetLinearSwapExMarketHistoryKline"}o="contract_code"}if(a.contract&&(void 0===s&&(s=2e3),n.size=s,void 0===h)){const e=this.parseTimeframe(t);if(void 0===i){const t=this.seconds();n.from=t-e*(s-1),n.to=t}else{const t=parseInt(i/1e3);n.from=t,n.to=this.sum(t,e*(s-1))}}n[o]=a.id;const c=await this[d](this.extend(n,r)),l=this.safeValue(c,"data",[]);return this.parseOHLCVs(l,a,t,i,s)}async fetchAccounts(e={}){await this.loadMarkets();const t=await this.spotPrivateGetV1AccountAccounts(e),i=this.safeValue(t,"data");return this.parseAccounts(i)}parseAccount(e){const t=this.safeString(e,"type"),i=this.safeValue(this.options,"accountsById",{}),s=this.safeValue(i,t,t);return{info:e,id:this.safeString(e,"id"),type:s,code:void 0}}async fetchAccountIdByType(e,t={}){const i=await this.loadAccounts(),s=this.safeValue(t,"account-id");if(void 0!==s)return s;const r=this.indexBy(i,"type"),a=this.safeValue(i,0,{}),n=this.safeValue(r,e,a);return this.safeString(n,"id")}async fetchCurrencies(e={}){const t=await this.spotPublicGetV2ReferenceCurrencies(e),i=this.safeValue(t,"data",[]),s={};this.options.networkChainIdsByNames={},this.options.networkNamesByChainIds={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"currency"),a=this.safeCurrencyCode(r);this.options.networkChainIdsByNames[a]={};const n=this.safeValue(t,"chains",[]),o={},h="normal"===this.safeString(t,"instStatus");let d,c,l,u,f;for(let e=0;e<n.length;e++){const t=n[e],i=this.safeString(t,"chain"),s=this.safeString(t,"displayName");this.options.networkChainIdsByNames[a][s]=i,this.options.networkNamesByChainIds[i]=s;const r=this.networkIdToCode(s,a);c=this.safeNumber(t,"minWithdrawAmt"),l=this.safeNumber(t,"maxWithdrawAmt");const h="allowed"===this.safeString(t,"withdrawStatus"),p="allowed"===this.safeString(t,"depositStatus"),m=h&&p,g=this.parsePrecision(this.safeString(t,"withdrawPrecision"));void 0!==g&&(d=void 0===d?g:k.stringMin(g,d)),h&&!f?f=!0:h||(f=!1),p&&!u?u=!0:p||(u=!1);const y=this.safeNumber(t,"transactFeeWithdraw");o[r]={info:t,id:i,network:r,limits:{withdraw:{min:c,max:l}},active:m,deposit:p,withdraw:h,fee:y,precision:this.parseNumber(g)}}s[a]={info:t,code:a,id:r,active:h,deposit:u,withdraw:f,fee:void 0,name:void 0,limits:{amount:{min:void 0,max:void 0},withdraw:{min:c,max:l}},precision:this.parseNumber(d),networks:o}}return s}networkIdToCode(e,t){if(0===Object.keys(this.options.networkNamesByChainIds).length)throw new o(this.id+" networkIdToCode() - markets need to be loaded at first");const i=this.safeValue(this.options.networkNamesByChainIds,e,e);return super.networkIdToCode(i)}networkCodeToId(e,t){if(void 0===t)throw new a(this.id+" networkCodeToId() requires a currencyCode argument");if(0===Object.keys(this.options.networkChainIdsByNames).length)throw new o(this.id+" networkCodeToId() - markets need to be loaded at first");const i=this.safeValue(this.options.networkChainIdsByNames,t,{}),s=super.networkCodeToId(e);return this.safeValue(i,s,s)}async fetchBalance(e={}){let t;await this.loadMarkets(),[t,e]=this.handleMarketTypeAndParams("fetchBalance",void 0,e);const i=this.safeValue(this.options,"fetchBalance",{}),s={};let r;const a="spot"===t,n="future"===t,o="swap"===t,h=this.safeString2(this.options,"defaultSubType","subType","linear");let d=this.safeString2(i,"defaultSubType","subType",h);d=this.safeString2(e,"defaultSubType","subType",d);const c="inverse"===d,l="linear"===d;let u;[u,e]=this.handleMarginModeAndParams("fetchBalance",e),e=this.omit(e,["defaultSubType","subType"]);const f="isolated"===u,p="margin"===t||a&&("cross"===u||f);if(a||p)if(p)r=f?"spotPrivateGetV1MarginAccountsBalance":"spotPrivateGetV1CrossMarginAccountsBalance";else{await this.loadAccounts();const i=await this.fetchAccountIdByType(t,e);s["account-id"]=i,r="spotPrivateGetV1AccountAccountsAccountIdBalance"}else l?r=f?"contractPrivatePostLinearSwapApiV1SwapAccountInfo":"contractPrivatePostLinearSwapApiV1SwapCrossAccountInfo":c&&(n?r="contractPrivatePostApiV1ContractAccountInfo":o&&(r="contractPrivatePostSwapApiV1SwapAccountInfo"));const m=await this[r](this.extend(s,e));let g={info:m};const y=this.safeValue(m,"data");if(a||p)if(f)for(let e=0;e<y.length;e++){const t=y[e],i=this.safeSymbol(this.safeString(t,"symbol")),s=this.safeValue(t,"list"),r={};for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"currency"),a=this.safeCurrencyCode(i);r[a]=this.parseMarginBalanceHelper(t,a,r)}g[i]=this.safeBalance(r)}else{const e=this.safeValue(y,"list",[]);for(let t=0;t<e.length;t++){const i=e[t],s=this.safeString(i,"currency"),r=this.safeCurrencyCode(s);g[r]=this.parseMarginBalanceHelper(i,r,g)}g=this.safeBalance(g)}else if(l){const e=this.safeValue(y,0,{});if(f)for(let e=0;e<y.length;e++){const t=y[e],i=this.safeString2(t,"contract_code","margin_account"),s=this.safeMarket(i),r=this.safeString(t,"margin_asset"),a=this.safeCurrency(r),n=this.safeString(s,"settle",a.code);if(void 0!==n){const e=this.account();e.free=this.safeString(t,"margin_balance"),e.used=this.safeString(t,"margin_frozen");const i={};i[n]=e;g[s.symbol]=this.safeBalance(i)}}else{const t=this.account();t.free=this.safeString(e,"margin_balance","margin_available"),t.used=this.safeString(e,"margin_frozen");const i=this.safeString2(e,"margin_asset","symbol");g[this.safeCurrencyCode(i)]=t,g=this.safeBalance(g)}}else if(c){for(let e=0;e<y.length;e++){const t=y[e],i=this.safeString(t,"symbol"),s=this.safeCurrencyCode(i),r=this.account();r.free=this.safeString(t,"margin_available"),r.used=this.safeString(t,"margin_frozen"),g[s]=r}g=this.safeBalance(g)}return g}async fetchOrder(e,t,i={}){let s,r;await this.loadMarkets(),void 0!==t&&(s=this.market(t)),[r,i]=this.handleMarketTypeAndParams("fetchOrder",s,i);const n={};let o;if("spot"===r){o="spotPrivateGetV1OrderOrdersOrderId",void 0!==this.safeString(i,"clientOrderId")?o="spotPrivateGetV1OrderOrdersGetClientOrder":n["order-id"]=e}else{if(void 0===t)throw new a(this.id+" fetchOrder() requires a symbol for "+r+" orders");if(n.contract_code=s.id,s.linear){let e;[e,i]=this.handleMarginModeAndParams("fetchOrder",i),e=void 0===e?"cross":e,"isolated"===e?o="contractPrivatePostLinearSwapApiV1SwapOrderInfo":"cross"===e&&(o="contractPrivatePostLinearSwapApiV1SwapCrossOrderInfo")}else if(s.inverse)if("future"===r)o="contractPrivatePostApiV1ContractOrderInfo",n.symbol=s.settleId;else{if("swap"!==r)throw new v(this.id+" fetchOrder() does not support "+r+" markets");o="contractPrivatePostSwapApiV1SwapOrderInfo"}const h=this.safeString2(i,"client_order_id","clientOrderId");void 0===h?n.order_id=e:(n.client_order_id=h,i=this.omit(i,["client_order_id","clientOrderId"]))}const h=await this[o](this.extend(n,i));let d=this.safeValue(h,"data");return Array.isArray(d)&&(d=this.safeValue(d,0)),this.parseOrder(d)}parseMarginBalanceHelper(e,t,i){let s;return s=t in i?i[t]:this.account(),"trade"===e.type&&(s.free=this.safeString(e,"balance")),"frozen"===e.type&&(s.used=this.safeString(e,"balance")),s}async fetchSpotOrdersByStates(e,t,i,s,r={}){const n=this.safeString(this.options,"fetchOrdersByStatesMethod","spot_private_get_v1_order_orders");if("spot_private_get_v1_order_orders"===n&&void 0===t)throw new a(this.id+" fetchOrders() requires a symbol argument");let o;await this.loadMarkets();const h={states:e};void 0!==t&&(o=this.market(t),h.symbol=o.id),void 0!==i&&(h["start-time"]=i,h["end-time"]=this.sum(i,1728e5)),void 0!==s&&(h.size=s);const d=await this[n](this.extend(h,r)),c=this.safeValue(d,"data",[]);return this.parseOrders(c,o,i,s)}async fetchSpotOrders(e,t,i,s={}){return await this.fetchSpotOrdersByStates("pre-submitted,submitted,partial-filled,filled,partial-canceled,canceled",e,t,i,s)}async fetchClosedSpotOrders(e,t,i,s={}){return await this.fetchSpotOrdersByStates("filled,partial-canceled,canceled",e,t,i,s)}async fetchContractOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchContractOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e);let n;[n,s]=this.handleMarketTypeAndParams("fetchOrders",r,s);const o={contract:r.id,trade_type:0,type:1,status:"0"};let h;if(void 0!==t&&(o.start_time=t),r.linear){let e;[e,s]=this.handleMarginModeAndParams("fetchContractOrders",s),e=void 0===e?"cross":e,h=this.getSupportedMapping(e,{isolated:"contractPrivatePostLinearSwapApiV3SwapHisorders",cross:"contractPrivatePostLinearSwapApiV3SwapCrossHisorders"})}else r.inverse&&(h=this.getSupportedMapping(n,{future:"contractPrivatePostApiV3ContractHisorders",swap:"contractPrivatePostSwapApiV3SwapHisorders"}),"future"===n&&(o.symbol=r.settleId));void 0!==i&&(o.page_size=i);const d=await this[h](this.extend(o,s)),c=this.safeValue(d,"data",[]);return this.parseOrders(c,r,t,i)}async fetchClosedContractOrders(e,t,i,s={}){return await this.fetchContractOrders(e,t,i,this.extend({status:"5,6,7"},s))}async fetchOrders(e,t,i,s={}){let r,n;await this.loadMarkets(),void 0!==e&&(r=this.market(e)),[n,s]=this.handleMarketTypeAndParams("fetchOrders",r,s);const o=this.getSupportedMapping(n,{spot:"fetchSpotOrders",swap:"fetchContractOrders",future:"fetchContractOrders"});if(void 0===o)throw new v(this.id+" fetchOrders() does not support "+n+" markets yet");if(("swap"===n||"future"===n)&&void 0===e)throw new a(this.id+" fetchOrders() requires a symbol argument for "+n+" orders");return await this[o](e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){let r,a;await this.loadMarkets(),void 0!==e&&(r=this.market(e)),[a,s]=this.handleMarketTypeAndParams("fetchClosedOrders",r,s);const n=this.getSupportedMapping(a,{spot:"fetchClosedSpotOrders",swap:"fetchClosedContractOrders",future:"fetchClosedContractOrders"});if(void 0===n)throw new v(this.id+" fetchClosedOrders() does not support "+a+" markets yet");return await this[n](e,t,i,s)}async fetchOpenOrders(e,t,i,s={}){let r,n;await this.loadMarkets(),void 0!==e&&(r=this.market(e)),[n,s]=this.handleMarketTypeAndParams("fetchOpenOrders",r,s);const o={};let h;if("spot"===n){h="spotPrivateGetV1OrderOpenOrders",void 0!==e&&(r=this.market(e),o.symbol=r.id);let t=this.safeString(s,"account-id");if(void 0===t){await this.loadAccounts();for(let e=0;e<this.accounts.length;e++){const i=this.accounts[e];if("spot"===i.type&&(t=this.safeString(i,"id"),void 0!==t))break}}o["account-id"]=t,void 0!==i&&(o.size=i),s=this.omit(s,"account-id")}else{if(void 0===e)throw new a(this.id+" fetchOpenOrders() requires a symbol for "+n+" orders");const t=this.market(e);if(o.contract_code=t.id,t.linear){let e;[e,s]=this.handleMarginModeAndParams("fetchOpenOrders",s),e=void 0===e?"cross":e,"isolated"===e?h="contractPrivatePostLinearSwapApiV1SwapOpenorders":"cross"===e&&(h="contractPrivatePostLinearSwapApiV1SwapCrossOpenorders")}else t.inverse&&(t.future?(h="contractPrivatePostApiV1ContractOpenorders",o.symbol=t.settleId):t.swap&&(h="contractPrivatePostSwapApiV1SwapOpenorders"));void 0!==i&&(o.page_size=i)}const d=await this[h](this.extend(o,s));let c=this.safeValue(d,"data");return Array.isArray(c)||(c=this.safeValue(c,"orders",[])),this.parseOrders(c,r,t,i)}parseOrderStatus(e){return this.safeString({"partial-filled":"open","partial-canceled":"canceled",filled:"closed",canceled:"canceled",submitted:"open",created:"open",1:"open",2:"open",3:"open",4:"open",5:"canceled",6:"closed",7:"canceled",11:"canceling"},e,e)}parseOrder(e,t){const i=this.safeString2(e,"id","order_id_str");let s=this.safeString(e,"direction"),r=this.safeString(e,"order_price_type");if("type"in e){const t=e.type.split("-");s=t[0],r=t[1]}const a=this.parseOrderStatus(this.safeString2(e,"state","status")),n=this.safeString2(e,"contract_code","symbol");t=this.safeMarket(n,t);const o=this.safeIntegerN(e,["created_at","created-at","create_date"]),h=this.safeString2(e,"client_order_id","client-order-id");let d,c;void 0!==r&&r.indexOf("market")>=0?d="sell"===s?this.safeString(e,"field-cash-amount"):this.safeString(e,"amount"):(c=this.safeString2(e,"volume","amount"),d=this.safeStringN(e,["filled-cash-amount","field-cash-amount","trade_turnover"]));const l=this.safeStringN(e,["filled-amount","field-amount","trade_volume"]),u=this.safeString(e,"price");let f,p=this.safeString2(e,"filled-fees","field-fees");if(p=this.safeString(e,"fee",p),void 0!==p){let i;const r=this.safeString(e,"fee_asset");i=void 0!==r?this.safeCurrencyCode(r):"sell"===s?t.quote:t.base,f={cost:p,currency:i}}const m=this.safeString(e,"stop-price"),g=this.safeString(e,"trade_avg_price"),y=this.safeValue(e,"trades");return this.safeOrder({info:e,id:i,clientOrderId:h,timestamp:o,datetime:this.iso8601(o),lastTradeTimestamp:void 0,symbol:t.symbol,type:r,timeInForce:void 0,postOnly:void 0,side:s,price:u,stopPrice:m,triggerPrice:m,average:g,cost:d,amount:c,filled:l,remaining:void 0,status:a,fee:f,trades:y},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),[o,h]=this.handleMarketTypeAndParams("createOrder",n,a),d=this.getSupportedMapping(o,{spot:"createSpotOrder",swap:"createContractOrder",future:"createContractOrder"});if(void 0===d)throw new v(this.id+" createOrder() does not support "+o+" markets yet");return await this[d](e,t,i,s,r,h)}async createSpotOrder(e,t,i,s,r,n={}){await this.loadMarkets(),await this.loadAccounts();const o=this.market(e),h={"account-id":await this.fetchAccountIdByType(o.type),symbol:o.id};let d=t.replace("buy-","");d=d.replace("sell-","");const c=this.safeValue(this.options,o.type,{}),u=this.safeString2(n,"stopPrice","stop-price");if(void 0===u){if(d in this.safeValue(c,"stopOrderTypes",{}))throw new a(this.id+" createOrder() requires a stopPrice or a stop-price parameter for a stop order")}else{const i=this.safeString(n,"operator");if(void 0===i)throw new a(this.id+' createOrder() requires an operator parameter "gte" or "lte" for a stop order');if(n=this.omit(n,["stopPrice","stop-price"]),h["stop-price"]=this.priceToPrecision(e,u),h.operator=i,"limit"===d||"limit-fok"===d)d="stop-"+d;else if("stop-limit"!==d&&"stop-limit-fok"!==d)throw new v(this.id+" createOrder() does not support "+t+" orders")}this.safeValue(n,"postOnly",!1)&&(d="limit-maker"),h.type=i+"-"+d;const f=this.safeString2(n,"clientOrderId","client-order-id");if(void 0===f){const e=this.safeValue(this.options,"broker",{}),t=this.safeString(e,"id");h["client-order-id"]=t+this.uuid()}else h["client-order-id"]=f;if(n=this.omit(n,["clientOrderId","client-order-id","postOnly"]),"market"===d&&"buy"===i)if(this.options.createMarketBuyOrderRequiresPrice){if(void 0===r)throw new l(this.id+" market buy order requires price argument to calculate cost (total amount of quote currency to spend for buying, amount * price). To switch off this warning exception and specify cost in the amount argument, set .options['createMarketBuyOrderRequiresPrice'] = false. Make sure you know what you're doing.");{const t=this.numberToString(s),i=this.numberToString(r);h.amount=this.costToPrecision(e,k.stringMul(t,i))}}else h.amount=this.costToPrecision(e,s);else h.amount=this.amountToPrecision(e,s);d in this.safeValue(c,"limitOrderTypes",{})&&(h.price=this.priceToPrecision(e,r));const p=await this.spotPrivatePostV1OrderOrdersPlace(this.extend(h,n));return{info:p,id:this.safeString(p,"data"),timestamp:void 0,datetime:void 0,lastTradeTimestamp:void 0,status:void 0,symbol:void 0,type:void 0,side:void 0,price:void 0,amount:void 0,filled:void 0,remaining:void 0,cost:void 0,trades:void 0,fee:void 0,clientOrderId:void 0,average:void 0}}async createContractOrder(e,t,i,s,r,a={}){const n=this.safeString(a,"offset");if(void 0!==this.safeString(a,"stopPrice"))throw new v(this.id+" createOrder() supports tp_trigger_price + tp_order_price for take profit orders and/or sl_trigger_price + sl_order price for stop loss orders, stop orders are supported only with open long orders and open short orders");const o=this.market(e),h={contract_code:o.id,volume:this.amountToPrecision(e,s),direction:i,lever_rate:1},d=this.safeString(a,"sl_order_price"),c=this.safeString(a,"sl_trigger_price"),l=this.safeString(a,"tp_order_price"),u=this.safeString(a,"tp_trigger_price"),f="open"===n;let p=!1;if(void 0!==c&&(h.sl_trigger_price=this.priceToPrecision(e,c),p=!0,void 0!==r&&(h.sl_order_price=this.priceToPrecision(e,r))),void 0!==d&&(h.sl_order_price=this.priceToPrecision(e,d),p=!0),void 0!==u&&(h.tp_trigger_price=this.priceToPrecision(e,u),p=!0,void 0!==r&&(h.tp_order_price=this.priceToPrecision(e,r))),void 0!==l&&(h.tp_order_price=this.priceToPrecision(e,l),p=!0),p&&!f)throw new v(this.id+" createOrder() supports tp_trigger_price + tp_order_price for take profit orders and/or sl_trigger_price + sl_order price for stop loss orders, stop orders are supported only with open long orders and open short orders");a=this.omit(a,["sl_order_price","sl_trigger_price","tp_order_price","tp_trigger_price"]);this.safeValue(a,"postOnly",!1)&&(t="post_only"),"limit"!==t&&"ioc"!==t&&"fok"!==t&&"post_only"!==t||(h.price=this.priceToPrecision(e,r)),h.order_price_type=t;const m=this.safeValue(this.options,"broker",{}),g=this.safeString(m,"id");h.channel_code=g;const y=this.safeString2(a,"client_order_id","clientOrderId");let b;if(void 0!==y&&(h.client_order_id=y,a=this.omit(a,["client_order_id","clientOrderId"])),o.linear){let e;[e,a]=this.handleMarginModeAndParams("createOrder",a),e=void 0===e?"cross":e,"isolated"===e?b="contractPrivatePostLinearSwapApiV1SwapOrder":"cross"===e&&(b="contractPrivatePostLinearSwapApiV1SwapCrossOrder")}else o.inverse&&(o.swap?b="contractPrivatePostSwapApiV1SwapOrder":o.future&&(b="contractPrivatePostApiV1ContractOrder"));const w=await this[b](this.extend(h,a)),S=this.safeValue(w,"data",{});return this.parseOrder(S,o)}async cancelOrder(e,t,i={}){let s,r;await this.loadMarkets(),void 0!==t&&(s=this.market(t)),[r,i]=this.handleMarketTypeAndParams("cancelOrder",s,i);const n={};let o;if("spot"===r){const t=this.safeString2(i,"client-order-id","clientOrderId");o="spotPrivatePostV1OrderOrdersOrderIdSubmitcancel",void 0===t?n["order-id"]=e:(n["client-order-id"]=t,o="spotPrivatePostV1OrderOrdersSubmitCancelClientOrder",i=this.omit(i,["client-order-id","clientOrderId"]))}else{if(void 0===t)throw new a(this.id+" cancelOrder() requires a symbol for "+r+" orders");if(n.contract_code=s.id,s.linear){let e;[e,i]=this.handleMarginModeAndParams("cancelOrder",i),e=void 0===e?"cross":e,"isolated"===e?o="contractPrivatePostLinearSwapApiV1SwapCancel":"cross"===e&&(o="contractPrivatePostLinearSwapApiV1SwapCrossCancel")}else{if(!s.inverse)throw new v(this.id+" cancelOrder() does not support "+r+" markets");s.future?(o="contractPrivatePostApiV1ContractCancel",n.symbol=s.settleId):s.swap&&(o="contractPrivatePostSwapApiV1SwapCancel")}const h=this.safeString2(i,"client_order_id","clientOrderId");void 0===h?n.order_id=e:(n.client_order_id=h,i=this.omit(i,["client_order_id","clientOrderId"]))}const h=await this[o](this.extend(n,i));return this.extend(this.parseOrder(h,s),{id:e,status:"canceled"})}async cancelOrders(e,t,i={}){let s,r;await this.loadMarkets(),void 0!==t&&(s=this.market(t)),[r,i]=this.handleMarketTypeAndParams("cancelOrders",s,i);const n={};let o;if("spot"===r){let t=this.safeValue2(i,"client-order-id","clientOrderId");t=this.safeValue2(i,"client-order-ids","clientOrderIds",t),void 0===t?n["order-ids"]="string"==typeof t?e:e.join(","):(n["client-order-ids"]="string"==typeof t?t:t.join(","),i=this.omit(i,["client-order-id","client-order-ids","clientOrderId","clientOrderIds"])),o="spotPrivatePostV1OrderOrdersBatchcancel"}else{if(void 0===t)throw new a(this.id+" cancelOrders() requires a symbol for "+r+" orders");const s=this.market(t);if(n.contract_code=s.id,s.linear){let e;[e,i]=this.handleMarginModeAndParams("cancelOrders",i),e=void 0===e?"cross":e,"isolated"===e?o="contractPrivatePostLinearSwapApiV1SwapCancel":"cross"===e&&(o="contractPrivatePostLinearSwapApiV1SwapCrossCancel")}else if(s.inverse)if(s.future)o="contractPrivatePostApiV1ContractCancel",n.symbol=s.settleId;else{if(!s.swap)throw new v(this.id+" cancelOrders() does not support "+r+" markets");o="contractPrivatePostSwapApiV1SwapCancel"}let h=this.safeString2(i,"client_order_id","clientOrderId");h=this.safeString2(i,"client_order_ids","clientOrderIds",h),void 0===h?n.order_id=e.join(","):(n.client_order_id=h,i=this.omit(i,["client_order_id","client_order_ids","clientOrderId","clientOrderIds"]))}return await this[o](this.extend(n,i))}async cancelAllOrders(e,t={}){let i,s;await this.loadMarkets(),void 0!==e&&(i=this.market(e)),[s,t]=this.handleMarketTypeAndParams("cancelAllOrders",i,t);const r={};let n;if("spot"===s)void 0!==e&&(i=this.market(e),r.symbol=i.id),n="spotPrivatePostV1OrderOrdersBatchCancelOpenOrders";else{if(void 0===e)throw new a(this.id+" cancelAllOrders() requires a symbol for "+s+" orders");const i=this.market(e);if(r.contract_code=i.id,i.linear){let e;[e,t]=this.handleMarginModeAndParams("cancelAllOrders",t),e=void 0===e?"cross":e,"isolated"===e?n="contractPrivatePostLinearSwapApiV1SwapCancelallall":"cross"===e&&(n="contractPrivatePostLinearSwapApiV1SwapCrossCancelall")}else if(i.inverse)if("future"===s)n="contractPrivatePostApiV1ContractCancelall",r.symbol=i.settleId;else{if("swap"!==s)throw new v(this.id+" cancelAllOrders() does not support "+s+" markets");n="contractPrivatePostSwapApiV1SwapCancelall"}}return await this[n](this.extend(r,t))}parseDepositAddress(e,t){const i=this.safeString(e,"address"),s=this.safeString(e,"addressTag"),r=this.safeString(e,"currency");t=this.safeCurrency(r,t);const a=this.safeCurrencyCode(r,t),n=this.safeString(e,"note"),o=this.safeString(e,"chain");return this.checkAddress(i),{currency:a,address:i,tag:s,network:this.networkIdToCode(o,a),note:n,info:e}}async fetchDepositAddressesByNetwork(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=await this.spotPrivateGetV2AccountDepositAddress(this.extend(i,t)),r=this.safeValue(s,"data",[]),a=this.parseDepositAddresses(r,[e],!1);return this.indexBy(a,"network")}async fetchDepositAddress(e,t={}){await this.loadMarkets();const[i,s]=this.handleNetworkCodeAndParams(t),r=await this.fetchDepositAddressesByNetwork(e,s);return r[this.selectNetworkCodeFromUnifiedNetworks(e,i,r)]}async fetchWithdrawAddresses(e,t,i,s={}){await this.loadMarkets();const r={currency:this.currency(e).id},a=await this.spotPrivateGetV2AccountWithdrawAddress(this.extend(r,s)),n=this.safeValue(a,"data",[]),o=this.parseDepositAddresses(n,[e],!1),h=[];for(let e=0;e<o.length;e++){const s=o[e],r=void 0===t||s.note===t,a=void 0===i||s.network===i;r&&a&&h.push(s)}return h}async fetchDeposits(e,t,i,s={}){let r;(void 0===i||i>100)&&(i=100),await this.loadMarkets(),void 0!==e&&(r=this.currency(e));const a={type:"deposit",direct:"next",from:0};void 0!==r&&(a.currency=r.id),void 0!==i&&(a.size=i);const n=await this.spotPrivateGetV1QueryDepositWithdraw(this.extend(a,s));return this.parseTransactions(n.data,r,t,i)}async fetchWithdrawals(e,t,i,s={}){let r;(void 0===i||i>100)&&(i=100),await this.loadMarkets(),void 0!==e&&(r=this.currency(e));const a={type:"withdraw",direct:"next",from:0};void 0!==r&&(a.currency=r.id),void 0!==i&&(a.size=i);const n=await this.spotPrivateGetV1QueryDepositWithdraw(this.extend(a,s));return this.parseTransactions(n.data,r,t,i)}parseTransaction(e,t){const i=this.safeInteger(e,"created-at"),s=this.safeCurrencyCode(this.safeString(e,"currency"));let r=this.safeString(e,"type");"withdraw"===r&&(r="withdrawal");let a=this.safeString(e,"fee");void 0!==a&&(a=k.stringAbs(a));const n=this.safeString(e,"chain");return{info:e,id:this.safeString2(e,"id","data"),txid:this.safeString(e,"tx-hash"),timestamp:i,datetime:this.iso8601(i),network:this.networkIdToCode(n,s),address:this.safeString(e,"address"),addressTo:void 0,addressFrom:void 0,tag:this.safeString(e,"address-tag"),tagTo:void 0,tagFrom:void 0,type:r,amount:this.safeNumber(e,"amount"),currency:s,status:this.parseTransactionStatus(this.safeString(e,"state")),updated:this.safeInteger(e,"updated-at"),fee:{currency:s,cost:this.parseNumber(a),rate:void 0}}}parseTransactionStatus(e){return this.safeString({unknown:"failed",confirming:"pending",confirmed:"ok",safe:"ok",orphan:"failed",submitted:"pending",canceled:"canceled",reexamine:"pending",reject:"failed",pass:"pending","wallet-reject":"failed","confirm-error":"failed",repealed:"failed","wallet-transfer":"pending","pre-transfer":"pending"},e,e)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets(),this.checkAddress(i);const n=this.currency(e),o={address:i,currency:n.id.toLowerCase()};let h;void 0!==s&&(o["addr-tag"]=s),[h,r]=this.handleNetworkCodeAndParams(r),void 0!==h&&(o.chain=this.networkCodeToId(h,e)),t=parseFloat(this.currencyToPrecision(e,t,h));const d=this.safeValue(this.options,"withdraw",{});if(this.safeValue(d,"includeFee",!1)){let i=this.safeNumber(r,"fee");if(void 0===i){const e=await this.fetchCurrencies();this.currencies=this.deepExtend(this.currencies,e);const t=this.safeValue(n.networks,h,{});if(i=this.safeNumber(t,"fee"),void 0===i)throw new a(this.id+' withdraw() function can not find withdraw fee for chosen network. You need to re-load markets with "exchange.loadMarkets(true)", or provide the "fee" parameter')}const s=this.currencyToPrecision(e,i,h);r=this.omit(r,"fee");const d=this.numberToString(t),c=k.stringSub(d,s),l=parseFloat(c);o.fee=parseFloat(s),t=parseFloat(this.currencyToPrecision(e,l,h))}o.amount=t;const c=await this.spotPrivatePostV1DwWithdrawApiCreate(this.extend(o,r));return this.parseTransaction(c,n)}parseTransfer(e,t){return{info:e,id:this.safeString(e,"data"),timestamp:void 0,datetime:void 0,currency:this.safeCurrencyCode(void 0,t),amount:void 0,fromAccount:void 0,toAccount:void 0,status:void 0}}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n={currency:a.id,amount:parseFloat(this.currencyToPrecision(e,t))};let o,h;[o,r]=this.handleSubTypeAndParams("transfer",void 0,r);let d=this.convertTypeToAccount(i),c=this.convertTypeToAccount(s);const l="cross"===c,u="cross"===d,f=this.inArray(c,this.ids),p=this.inArray(d,this.ids),g="pro"===d,y="pro"===c;if(g&&y)throw new m(this.id+" transfer () cannot make a transfer between "+i+" and "+s);if("futures"===d||"futures"===c){let e=d+"-to-"+c;e=this.safeString(r,"type",e),n.type=e,h="spotPrivatePostV1FuturesTransfer"}else if(g&&l)h="privatePostCrossMarginTransferIn";else if(u&&y)h="privatePostCrossMarginTransferOut";else if(g&&f)n.symbol=c,h="privatePostDwTransferInMargin";else if(p&&y)n.symbol=d,h="privatePostDwTransferOutMargin";else{if(h="v2PrivatePostAccountTransfer","linear"===o){"swap"===d||"linear-swap"===i?d="linear-swap":c="linear-swap";let e=this.safeString(r,"symbol");r=this.omit(r,"symbol"),void 0!==e?(e=this.marketId(e),n["margin-account"]=e):n["margin-account"]="USDT"}n.from=g?"spot":d,n.to=y?"spot":c}const b=await this[h](this.extend(n,r));return this.parseTransfer(b,a)}async fetchBorrowRatesPerSymbol(e={}){await this.loadMarkets();const t=await this.spotPrivateGetV1MarginLoanInfo(e),i=this.milliseconds(),s=this.safeValue(t,"data",[]),r={info:t};for(let e=0;e<s.length;e++){const t=s[e],a=this.safeValue(t,"currencies",[]),n={};for(let e=0;e<a.length;e++){const t=a[e],s=this.safeString(t,"currency"),r=this.safeCurrencyCode(s,"currency");n[r]={currency:r,rate:this.safeNumber(t,"actual-rate"),span:864e5,timestamp:i,datetime:this.iso8601(i)}}const o=this.safeString(t,"symbol");r[this.safeSymbol(o)]=n}return r}async fetchBorrowRates(e={}){await this.loadMarkets();const t=await this.spotPrivateGetV1MarginLoanInfo(e),i=this.milliseconds(),s=this.safeValue(t,"data",[]),r={};for(let e=0;e<s.length;e++){const t=s[e],a=this.safeValue(t,"currencies",[]);for(let e=0;e<a.length;e++){const t=a[e],s=this.safeString(t,"currency"),n=this.safeCurrencyCode(s,"currency");r[n]={currency:n,rate:this.safeNumber(t,"actual-rate"),span:864e5,timestamp:i,datetime:this.iso8601(i),info:void 0}}}return r}async fetchFundingRateHistory(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchFundingRateHistory() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={contract_code:r.id};let o;if(r.inverse)o="contractPublicGetSwapApiV1SwapHistoricalFundingRate";else{if(!r.linear)throw new v(this.id+" fetchFundingRateHistory() supports inverse and linear swaps only");o="contractPublicGetLinearSwapApiV1SwapHistoricalFundingRate"}const h=await this[o](this.extend(n,s)),d=this.safeValue(h,"data"),c=this.safeValue(d,"data",[]),l=[];for(let e=0;e<c.length;e++){const t=c[e],i=this.safeString(t,"contract_code"),s=this.safeSymbol(i),r=this.safeInteger(t,"funding_time");l.push({info:t,symbol:s,fundingRate:this.safeNumber(t,"funding_rate"),timestamp:r,datetime:this.iso8601(r)})}const u=this.sortBy(l,"timestamp");return this.filterBySymbolSinceLimit(u,r.symbol,t,i)}parseFundingRate(e,t){const i=this.safeNumber(e,"estimated_rate"),s=this.safeInteger(e,"funding_time"),r=this.safeInteger(e,"next_funding_time"),a=this.safeString(e,"contract_code");return{info:e,symbol:this.safeSymbol(a,t),markPrice:void 0,indexPrice:void 0,interestRate:void 0,estimatedSettlePrice:void 0,timestamp:void 0,datetime:void 0,fundingRate:this.safeNumber(e,"funding_rate"),fundingTimestamp:s,fundingDatetime:this.iso8601(s),nextFundingRate:i,nextFundingTimestamp:r,nextFundingDatetime:this.iso8601(r),previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e);let s;if(i.inverse)s="contractPublicGetSwapApiV1SwapFundingRate";else{if(!i.linear)throw new v(this.id+" fetchFundingRate() supports inverse and linear swaps only");s="contractPublicGetLinearSwapApiV1SwapFundingRate"}const r={contract_code:i.id},a=await this[s](this.extend(r,t)),n=this.safeValue(a,"data",{});return this.parseFundingRate(n,i)}async fetchFundingRates(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=this.safeValue(this.options,"fetchFundingRates",{}),s=this.safeString(this.options,"defaultSubType","inverse");let r=this.safeString(i,"subType",s);r=this.safeString(t,"subType",r);const a=this.getSupportedMapping(r,{linear:"contractPublicGetLinearSwapApiV1SwapBatchFundingRate",inverse:"contractPublicGetSwapApiV1SwapBatchFundingRate"});t=this.omit(t,"subType");const n=await this[a](this.extend({},t)),o=this.safeValue(n,"data",[]),h=this.parseFundingRates(o);return this.filterByArray(h,"symbol",e)}async fetchBorrowInterest(e,t,i,s,r={}){let a;await this.loadMarkets(),[a,r]=this.handleMarginModeAndParams("fetchBorrowInterest",r),a=void 0===a?"cross":a;const n={};let o,h;if(void 0!==i&&(n["start-date"]=this.yyyymmdd(i)),void 0!==s&&(n.size=s),"isolated"===a)h="privateGetMarginLoanOrders",void 0!==t&&(o=this.market(t),n.symbol=o.id);else if(h="privateGetCrossMarginLoanOrders",void 0!==e){const t=this.currency(e);n.currency=t.id}const d=await this[h](this.extend(n,r)),c=this.safeValue(d,"data"),l=this.parseBorrowInterests(c,o);return this.filterByCurrencySinceLimit(l,e,i,s)}parseBorrowInterest(e,t){const i=this.safeString(e,"symbol"),s=void 0===i?"cross":"isolated";t=this.safeMarket(i);const r=this.safeString(t,"symbol"),a=this.safeNumber(e,"accrued-at");return{account:"isolated"===s?r:"cross",symbol:r,marginMode:s,currency:this.safeCurrencyCode(this.safeString(e,"currency")),interest:this.safeNumber(e,"interest-amount"),interestRate:this.safeNumber(e,"interest-rate"),amountBorrowed:this.safeNumber(e,"loan-amount"),timestamp:a,datetime:this.iso8601(a),info:e}}sign(e,t="public",i="GET",s={},r,a){let n="/";const o=this.omit(s,this.extractParams(e));if("string"==typeof t){if("public"===t||"private"===t?n+=this.version:"v2Public"!==t&&"v2Private"!==t||(n+="v2"),n+="/"+this.implodeParams(e,s),"private"===t||"v2Private"===t){this.checkRequiredCredentials();const e=this.ymdhms(this.milliseconds(),"T");let t={SignatureMethod:"HmacSHA256",SignatureVersion:"2",AccessKeyId:this.apiKey,Timestamp:e};"POST"!==i&&(t=this.extend(t,o)),t=this.keysort(t);let s=this.urlencode(t);const h=[i,this.hostname,n,s].join("\n"),d=this.hmac(this.encode(h),this.encode(this.secret),"sha256","base64");s+="&"+this.urlencode({Signature:d}),n+="?"+s,"POST"===i?(a=this.json(o),r={"Content-Type":"application/json"}):r={"Content-Type":"application/x-www-form-urlencoded"}}else Object.keys(o).length&&(n+="?"+this.urlencode(o));n=this.implodeParams(this.urls.api[t],{hostname:this.hostname})+n}else{const h=this.safeString(t,0),d=this.safeString(t,1),c=this.safeString(t,2),l=this.safeString(t,3);let u,f=this.safeValue(this.urls.hostnames,h);if("string"!=typeof f&&(f=this.safeValue(f,c),"string"!=typeof u&&void 0!==l&&(f=this.safeValue(f,l))),u=f,n+=this.implodeParams(e,s),"public"===d)Object.keys(o).length&&(n+="?"+this.urlencode(o));else if("private"===d){this.checkRequiredCredentials();const e=this.ymdhms(this.milliseconds(),"T");let t={SignatureMethod:"HmacSHA256",SignatureVersion:"2",AccessKeyId:this.apiKey,Timestamp:e};"POST"!==i&&(t=this.extend(t,o)),t=this.keysort(t);let s=this.urlencode(t);const h=[i,u,n,s].join("\n"),d=this.hmac(this.encode(h),this.encode(this.secret),"sha256","base64");s+="&"+this.urlencode({Signature:d}),n+="?"+s,"POST"===i?(2===(a=this.json(o)).length&&(a="{}"),r={"Content-Type":"application/json"}):r={"Content-Type":"application/x-www-form-urlencoded"}}n=this.implodeParams(this.urls.api[h],{hostname:u})+n}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,n,h,d){if(void 0!==n){if("status"in n){if("error"===this.safeString(n,"status")){const e=this.safeString2(n,"err-code","err_code"),t=this.id+" "+a;this.throwBroadlyMatchedException(this.exceptions.broad,a,t),this.throwExactlyMatchedException(this.exceptions.exact,e,t);const i=this.safeString2(n,"err-msg","err_msg");throw this.throwExactlyMatchedException(this.exceptions.exact,i,t),new o(t)}}if("code"in n){const e=this.id+" "+a,t=this.safeString(n,"code");this.throwExactlyMatchedException(this.exceptions.exact,t,e)}}}async fetchFundingHistory(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),[a,n]=this.handleMarketTypeAndParams("fetchFundingHistory",r,s);let o;const h={type:"30,31"};if(void 0!==t&&(h.start_date=t),r.linear){let e;o="contractPrivatePostLinearSwapApiV3SwapFinancialRecordExact",[e,s]=this.handleMarginModeAndParams("fetchFundingHistory",s),e=void 0===e?"cross":e,h.mar_acct="isolated"===e?r.id:r.quoteId}else"swap"===a?(o="contractPrivatePostSwapApiV3SwapFinancialRecordExact",h.contract=r.id):(o="contractPrivatePostApiV3ContractFinancialRecordExact",h.symbol=r.id);const d=await this[o](this.extend(h,n)),c=this.safeValue(d,"data",[]);return this.parseIncomes(c,r,t,i)}async setLeverage(e,t,i={}){if(void 0===t)throw new a(this.id+" setLeverage() requires a symbol argument");await this.loadMarkets();const s=this.market(t),[r,n]=this.handleMarketTypeAndParams("setLeverage",s,i);let o;if(s.linear){let e;[e,i]=this.handleMarginModeAndParams("setLeverage",i),e=void 0===e?"cross":e,o=this.getSupportedMapping(e,{isolated:"contractPrivatePostLinearSwapApiV1SwapSwitchLeverRate",cross:"contractPrivatePostLinearSwapApiV1SwapCrossSwitchLeverRate"})}else o=this.getSupportedMapping(r,{future:"contractPrivatePostApiV1ContractSwitchLeverRate",swap:"contractPrivatePostSwapApiV1SwapSwitchLeverRate"});const h={lever_rate:e};"future"===r&&s.inverse?h.symbol=s.settleId:h.contract_code=s.id;return await this[o](this.extend(h,n))}parseIncome(e,t){const i=this.safeString(e,"contract_code"),s=this.safeSymbol(i,t),r=this.safeNumber(e,"amount"),a=this.safeInteger(e,"ts"),n=this.safeString(e,"id"),o=this.safeString2(e,"symbol","asset");return{info:e,symbol:s,code:this.safeCurrencyCode(o),timestamp:a,datetime:this.iso8601(a),id:n,amount:r}}parsePosition(e,t){const i=(t=this.safeMarket(this.safeString(e,"contract_code"))).symbol,s=this.safeString(e,"volume"),r=this.safeValue(t,"contractSize"),a=this.numberToString(r),n=this.safeNumber(e,"cost_open"),o=this.safeString(e,"position_margin"),h="buy"===this.safeString(e,"direction")?"long":"short",d=this.safeNumber(e,"profit_unreal");let c=this.safeString(e,"margin_mode");const l=this.safeString(e,"lever_rate"),u=k.stringMul(this.safeString(e,"profit_rate"),"100"),f=this.safeString(e,"last_price"),p=k.stringMul(s,a);let m;t.linear?m=k.stringMul(p,f):(m=k.stringDiv(p,f),c="cross");const g=k.stringDiv(o,m),y=this.safeString(e,"margin_balance"),b=this.safeNumber(e,"liquidation_price"),v=this.safeString(e,"adjust_factor"),w=k.stringDiv(v,l),S=k.stringMul(w,m),T=k.stringDiv(S,y);return{info:e,id:void 0,symbol:i,contracts:this.parseNumber(s),contractSize:r,entryPrice:n,collateral:this.parseNumber(y),side:h,unrealizedProfit:d,leverage:this.parseNumber(l),percentage:this.parseNumber(u),marginMode:c,notional:this.parseNumber(m),markPrice:void 0,liquidationPrice:b,initialMargin:this.parseNumber(o),initialMarginPercentage:this.parseNumber(g),maintenanceMargin:this.parseNumber(S),maintenanceMarginPercentage:this.parseNumber(w),marginRatio:this.parseNumber(T),timestamp:void 0,datetime:void 0}}async fetchPositions(e,t={}){let i,s,r,a,n;if(await this.loadMarkets(),void 0!==(e=this.marketSymbols(e))){const t=this.safeString(e,0);i=this.market(t)}[s,t]=this.handleMarginModeAndParams("fetchPositions",t),s=void 0===s?"cross":s,[r,t]=this.handleSubTypeAndParams("fetchPositions",i,t,"linear"),[a,t]=this.handleMarketTypeAndParams("fetchPositions",i,t),"spot"===a&&(a="future"),n="linear"===r?this.getSupportedMapping(s,{isolated:"contractPrivatePostLinearSwapApiV1SwapPositionInfo",cross:"contractPrivatePostLinearSwapApiV1SwapCrossPositionInfo"}):this.getSupportedMapping(a,{future:"contractPrivatePostApiV1ContractPositionInfo",swap:"contractPrivatePostSwapApiV1SwapPositionInfo"});const o=await this[n](t),h=this.safeValue(o,"data",[]),d=this.safeInteger(o,"ts"),c=[];for(let e=0;e<h.length;e++){const t=h[e],i=this.parsePosition(t);c.push(this.extend(i,{timestamp:d,datetime:this.iso8601(d)}))}return this.filterByArray(c,"symbol",e,!1)}async fetchPosition(e,t={}){await this.loadMarkets();const i=this.market(e);let s;[s,t]=this.handleMarginModeAndParams("fetchPosition",t),s=void 0===s?"cross":s;const[r,a]=this.handleMarketTypeAndParams("fetchPosition",i,t);let n;n=i.linear?this.getSupportedMapping(s,{isolated:"contractPrivatePostLinearSwapApiV1SwapAccountPositionInfo",cross:"contractPrivatePostLinearSwapApiV1SwapCrossAccountPositionInfo"}):this.getSupportedMapping(r,{future:"contractPrivatePostApiV1ContractAccountPositionInfo",swap:"contractPrivatePostSwapApiV1SwapAccountPositionInfo"});const o={};i.future&&i.inverse?o.symbol=i.settleId:("cross"===s&&(o.margin_account="USDT"),o.contract_code=i.id);const h=await this[n](this.extend(o,a)),d=this.safeValue(h,"data");let c;c="cross"===s?d:this.safeValue(d,0);const l=this.omit(c,["positions"]),u=this.safeValue(c,"positions");let f;if(i.future&&i.inverse)for(let e=0;e<u.length;e++){const t=u[e];if(t.contract_code===i.id){f=t;break}}else f=this.safeValue(u,0);const p=this.safeInteger(h,"ts"),m=this.parsePosition(this.extend(f,l));return this.extend(m,{timestamp:p,datetime:this.iso8601(p)})}parseLedgerEntryType(e){return this.safeString({trade:"trade",etf:"trade","transact-fee":"fee","fee-deduction":"fee",transfer:"transfer",credit:"credit",liquidation:"trade",interest:"credit",deposit:"deposit",withdraw:"withdrawal","withdraw-fee":"fee",exchange:"exchange","other-types":"transfer",rebate:"rebate"},e,e)}parseLedgerEntry(e,t){const i=this.safeString(e,"transactId"),s=this.safeString(e,"currency"),r=this.safeCurrencyCode(s,t),a=this.safeNumber(e,"transactAmt"),n=this.safeString(e,"transferType"),o=this.parseLedgerEntryType(n),h=this.safeString(e,"direction"),d=this.safeInteger(e,"transactTime"),c=this.iso8601(d),l=this.safeString(e,"accountId");return{id:i,direction:h,account:l,referenceId:i,referenceAccount:l,type:o,currency:r,amount:a,timestamp:d,datetime:c,before:void 0,after:void 0,status:void 0,fee:void 0,info:e}}async fetchLedger(e,t,i,s={}){await this.loadMarkets();const r={accountId:await this.fetchAccountIdByType("spot",s)};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==t&&(r.startTime=t),void 0!==i&&(r.limit=i);const n=await this.spotPrivateGetV2AccountLedger(this.extend(r,s)),o=this.safeValue(n,"data",[]);return this.parseLedger(o,a,t,i)}async fetchLeverageTiers(e,t={}){await this.loadMarkets();const i=await this.contractPublicGetLinearSwapApiV1SwapAdjustfactor(t),s=this.safeValue(i,"data");return this.parseLeverageTiers(s,e,"contract_code")}async fetchMarketLeverageTiers(e,t={}){await this.loadMarkets();const i={};if(void 0!==e){const t=this.market(e);if(!t.contract)throw new m(this.id+" fetchMarketLeverageTiers() symbol supports contract markets only");i.contract_code=t.id}const s=await this.contractPublicGetLinearSwapApiV1SwapAdjustfactor(this.extend(i,t)),r=this.safeValue(s,"data"),a=this.parseLeverageTiers(r,[e],"contract_code");return this.safeValue(a,e)}parseLeverageTiers(e,t,i){const s={};for(let r=0;r<e.length;r++){const a=e[r],n=this.safeValue(a,"list",[]),o=[],h=this.safeString(a,"trade_partition"),d=this.safeString(a,i),c=this.safeSymbol(d);if(this.inArray(c,t)){for(let e=0;e<n.length;e++){const t=n[e],i=this.safeString(t,"lever_rate"),s=this.safeValue(t,"ladders",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"adjust_factor");o.push({tier:this.safeInteger(t,"ladder"),currency:this.safeCurrencyCode(h),minNotional:this.safeNumber(t,"min_size"),maxNotional:this.safeNumber(t,"max_size"),maintenanceMarginRate:this.parseNumber(k.stringDiv(r,i)),maxLeverage:this.parseNumber(i),info:t})}}s[c]=o}}return s}async fetchOpenInterestHistory(e,t="1h",i,s,r={}){if("1h"!==t&&"4h"!==t&&"12h"!==t&&"1d"!==t)throw new m(this.id+" fetchOpenInterestHistory cannot only use the 1h, 4h, 12h and 1d timeframe");await this.loadMarkets();const n=this.market(e),o=this.safeNumber2(r,"amount_type","amountType");if(void 0===o)throw new a(this.id+" fetchOpenInterestHistory requires parameter params.amountType to be either 1 (cont), or 2 (cryptocurrency)");const h={period:{"1h":"60min","4h":"4hour","12h":"12hour","1d":"1day"}[t],amount_type:o};let d;n.future?(h.contract_type=this.safeString(n.info,"contract_type"),h.symbol=n.baseId,d="contractPublicGetApiV1ContractHisOpenInterest"):n.linear?(h.contract_type="swap",h.contract_code=n.id,h.contract_code=n.id,d="contractPublicGetLinearSwapApiV1SwapHisOpenInterest"):(h.contract_code=n.id,d="contractPublicGetSwapApiV1SwapHisOpenInterest"),void 0!==s&&(h.size=s);const c=await this[d](this.extend(h,r)),l=this.safeValue(c,"data"),u=this.safeValue(l,"tick");return this.parseOpenInterests(u,n,i,s)}async fetchOpenInterest(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.contract)throw new m(this.id+" fetchOpenInterest() supports contract markets only");if(i.option)throw new v(this.id+" fetchOpenInterest() does not currently support option markets");const s={contract_code:i.id};let r;i.future?(s.contract_type=this.safeString(i.info,"contract_type"),s.symbol=i.baseId,r="contractPublicGetApiV1ContractOpenInterest"):i.linear?(s.contract_type="swap",r="contractPublicGetLinearSwapApiV1SwapOpenInterest"):r="contractPublicGetSwapApiV1SwapOpenInterest";const a=await this[r](this.extend(s,t)),n=this.safeValue(a,"data",[]),o=this.parseOpenInterest(n[0],i),h=this.safeInteger(a,"ts");return this.extend(o,{timestamp:h,datetime:this.iso8601(h)})}parseOpenInterest(e,t){const i=this.safeInteger(e,"ts"),s=this.safeNumber(e,"volume"),r=this.safeNumber(e,"value");return{symbol:this.safeString(t,"symbol"),baseVolume:s,quoteVolume:r,openInterestAmount:s,openInterestValue:r,timestamp:i,datetime:this.iso8601(i),info:e}}async borrowMargin(e,t,i,s={}){await this.loadMarkets();const r=this.currency(e),n={currency:r.id,amount:this.currencyToPrecision(e,t)};let o,h;if([o,s]=this.handleMarginModeAndParams("borrowMargin",s),o=void 0===o?"cross":o,"isolated"===o){if(void 0===i)throw new a(this.id+" borrowMargin() requires a symbol argument for isolated margin");const e=this.market(i);n.symbol=e.id,h="privatePostMarginOrders"}else"cross"===o&&(h="privatePostCrossMarginOrders");const d=await this[h](this.extend(n,s)),c=this.parseMarginLoan(d,r);return this.extend(c,{amount:t,symbol:i})}async repayMargin(e,t,i,s={}){await this.loadMarkets();const r=this.currency(e);let a;[a,s]=this.handleMarginModeAndParams("repayMargin",s),a=void 0===a?"cross":a;const n=this.safeValue(this.options,"marginAccounts",{}),o=this.getSupportedMapping(a,n),h=await this.fetchAccountIdByType(o,s),d={currency:r.id,amount:this.currencyToPrecision(e,t),accountId:h},c=await this.v2PrivatePostAccountRepayment(this.extend(d,s)),l=this.safeValue(c,"Data",[]),u=this.safeValue(l,0),f=this.parseMarginLoan(u,r);return this.extend(f,{amount:t,symbol:i})}parseMarginLoan(e,t){const i=this.safeInteger(e,"repayTime");return{id:this.safeInteger2(e,"repayId","data"),currency:this.safeCurrencyCode(void 0,t),amount:void 0,symbol:void 0,timestamp:i,datetime:this.iso8601(i),info:e}}async fetchSettlementHistory(e,t,i,s={}){const r=this.safeString(s,"code"),n=this.safeInteger2(s,"until","till");s=this.omit(s,["until","till"]);const o=void 0===e?void 0:this.market(e),[h,d]=this.handleMarketTypeAndParams("fetchSettlementHistory",o,s);if("future"===h){if(void 0===e&&void 0===r)throw new a(this.id+' requires a symbol argument or params["code"] for fetchSettlementHistory future')}else if(void 0===e)throw new a(this.id+" requires a symbol argument for fetchSettlementHistory swap");const c={};o.future?c.symbol=o.baseId:c.contract_code=o.id,void 0!==t&&(c.start_at=t),void 0!==i&&(c.page_size=i),void 0!==n&&(c.end_at=n);let l="contractPublicGetApiV1ContractSettlementRecords";o.swap&&(l=o.linear?"contractPublicGetLinearSwapApiV1SwapSettlementRecords":"contractPublicGetSwapApiV1SwapSettlementRecords");const u=await this[l](this.extend(c,d)),f=this.safeValue(u,"data"),p=this.safeValue(f,"settlement_record"),m=this.parseSettlements(p,o);return this.sortBy(m,"timestamp")}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.spotPublicGetV2ReferenceCurrencies(t),s=this.safeValue(i,"data");return this.parseDepositWithdrawFees(s,e,"currency")}parseDepositWithdrawFee(e,t){const i=this.safeValue(e,"chains",[]);let s=this.depositWithdrawFee(e);for(let e=0;e<i.length;e++){const r=i[e],a=this.safeString(r,"chain"),n=this.safeString(r,"withdrawFeeType"),o=this.networkIdToCode(a);let h,d;"fixed"===n?(h=this.safeNumber(r,"transactFeeWithdraw"),d={fee:h,percentage:!1}):(h=this.safeNumber(r,"transactFeeRateWithdraw"),d={fee:h,percentage:!0}),s.networks[o]={withdraw:d,deposit:{fee:void 0,percentage:void 0}},s=this.assignDefaultDepositWithdrawFees(s,t)}return s}parseSettlements(e,t){const i=[];for(let s=0;s<e.length;s++){const r=e[s],a=this.safeValue(r,"list");if(void 0!==a){const e=this.safeInteger(r,"settlement_time"),s={timestamp:e,datetime:this.iso8601(e)};for(let e=0;e<a.length;e++){const r=a[e],n=this.parseSettlement(r,t);i.push(this.extend(n,s))}}else i.push(this.parseSettlement(e[s],t))}return i}parseSettlement(e,t){const i=this.safeInteger(e,"settlement_time"),s=this.safeString(e,"contract_code");return{info:e,symbol:this.safeSymbol(s,t),price:this.safeNumber(e,"settlement_price"),timestamp:i,datetime:this.iso8601(i)}}}},54072:function(e,t,i){"use strict";const s=i(48819),{AuthenticationError:r,ExchangeError:a,PermissionDenied:n,ExchangeNotAvailable:o,OnMaintenance:h,InvalidOrder:d,OrderNotFound:c,InsufficientFunds:l,ArgumentsRequired:u,BadSymbol:f,BadRequest:p,RequestTimeout:m,NetworkError:g}=i(73449),{TRUNCATE:y,TICK_SIZE:b}=i(62115),v=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"huobijp",name:"Huobi Japan",countries:["JP"],rateLimit:100,userAgent:this.userAgents.chrome39,certified:!1,version:"v1",hostname:"api-cloud.huobi.co.jp",pro:!0,has:{CORS:void 0,spot:!0,margin:void 0,swap:!1,future:!1,option:!1,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:!0,createOrder:!0,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchAccounts:!0,fetchBalance:!0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!1,fetchDepositAddressesByNetwork:!1,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchOrderTrades:!0,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingLimits:!0,fetchWithdrawals:!0,withdraw:!0},timeframes:{"1m":"1min","5m":"5min","15m":"15min","30m":"30min","1h":"60min","4h":"4hour","1d":"1day","1w":"1week","1M":"1mon","1y":"1year"},urls:{logo:"https://user-images.githubusercontent.com/1294454/85734211-85755480-b705-11ea-8b35-0b7f1db33a2f.jpg",api:{market:"https://{hostname}",public:"https://{hostname}",private:"https://{hostname}",v2Public:"https://{hostname}",v2Private:"https://{hostname}"},www:"https://www.huobi.co.jp",referral:"https://www.huobi.co.jp/register/?invite_code=znnq3",doc:"https://api-doc.huobi.co.jp",fees:"https://www.huobi.co.jp/support/fee"},api:{v2Public:{get:{"reference/currencies":1,"market-status":1}},v2Private:{get:{"account/ledger":1,"account/withdraw/quota":1,"account/withdraw/address":1,"account/deposit/address":1,"account/repayment":5,"reference/transact-fee-rate":1,"account/asset-valuation":.2,"point/account":5,"sub-user/user-list":1,"sub-user/user-state":1,"sub-user/account-list":1,"sub-user/deposit-address":1,"sub-user/query-deposit":1,"user/api-key":1,"user/uid":1,"algo-orders/opening":1,"algo-orders/history":1,"algo-orders/specific":1,"c2c/offers":1,"c2c/offer":1,"c2c/transactions":1,"c2c/repayment":1,"c2c/account":1,"etp/reference":1,"etp/transactions":5,"etp/transaction":5,"etp/rebalance":1,"etp/limit":1},post:{"account/transfer":1,"account/repayment":5,"point/transfer":5,"sub-user/management":1,"sub-user/creation":1,"sub-user/tradable-market":1,"sub-user/transferability":1,"sub-user/api-key-generation":1,"sub-user/api-key-modification":1,"sub-user/api-key-deletion":1,"sub-user/deduct-mode":1,"algo-orders":1,"algo-orders/cancel-all-after":1,"algo-orders/cancellation":1,"c2c/offer":1,"c2c/cancellation":1,"c2c/cancel-all":1,"c2c/repayment":1,"c2c/transfer":1,"etp/creation":5,"etp/redemption":5,"etp/{transactId}/cancel":10,"etp/batch-cancel":50}},market:{get:{"history/kline":1,"detail/merged":1,depth:1,trade:1,"history/trade":1,detail:1,tickers:1,etp:1}},public:{get:{"common/symbols":1,"common/currencys":1,"common/timestamp":1,"common/exchange":1,"settings/currencys":1}},private:{get:{"account/accounts":.2,"account/accounts/{id}/balance":.2,"account/accounts/{sub-uid}":1,"account/history":4,"cross-margin/loan-info":1,"margin/loan-info":1,"fee/fee-rate/get":1,"order/openOrders":.4,"order/orders":.4,"order/orders/{id}":.4,"order/orders/{id}/matchresults":.4,"order/orders/getClientOrder":.4,"order/history":1,"order/matchresults":1,"query/deposit-withdraw":1,"margin/loan-orders":.2,"margin/accounts/balance":.2,"cross-margin/loan-orders":1,"cross-margin/accounts/balance":1,"points/actions":1,"points/orders":1,"subuser/aggregate-balance":10,"stable-coin/exchange_rate":1,"stable-coin/quote":1},post:{"account/transfer":1,"futures/transfer":1,"order/batch-orders":.4,"order/orders/place":.2,"order/orders/submitCancelClientOrder":.2,"order/orders/batchCancelOpenOrders":.4,"order/orders/{id}/submitcancel":.2,"order/orders/batchcancel":.4,"dw/withdraw/api/create":1,"dw/withdraw-virtual/{id}/cancel":1,"dw/transfer-in/margin":10,"dw/transfer-out/margin":10,"margin/orders":10,"margin/orders/{id}/repay":10,"cross-margin/transfer-in":1,"cross-margin/transfer-out":1,"cross-margin/orders":1,"cross-margin/orders/{id}/repay":1,"stable-coin/exchange":1,"subuser/transfer":10}}},fees:{trading:{feeSide:"get",tierBased:!1,percentage:!0,maker:this.parseNumber("0.002"),taker:this.parseNumber("0.002")}},precisionMode:b,exceptions:{broad:{"contract is restricted of closing positions on API.  Please contact customer service":h,maintain:h},exact:{"bad-request":p,"base-date-limit-error":p,"api-not-support-temp-addr":n,timeout:m,"gateway-internal-error":o,"account-frozen-balance-insufficient-error":l,"invalid-amount":d,"order-limitorder-amount-min-error":d,"order-limitorder-amount-max-error":d,"order-marketorder-amount-min-error":d,"order-limitorder-price-min-error":d,"order-limitorder-price-max-error":d,"order-holding-limit-failed":d,"order-orderprice-precision-error":d,"order-etp-nav-price-max-error":d,"order-orderstate-error":c,"order-queryorder-invalid":c,"order-update-error":o,"api-signature-check-failed":r,"api-signature-not-valid":r,"base-record-invalid":c,"base-symbol-trade-disabled":f,"base-symbol-error":f,"system-maintenance":h,"invalid symbol":f,"symbol trade not open now":f,"invalid-address":p,"base-currency-chain-error":p,"dw-insufficient-balance":l}},options:{defaultNetwork:"ERC20",networks:{ETH:"erc20",TRX:"trc20",HRC20:"hrc20",HECO:"hrc20",HT:"hrc20",ALGO:"algo",OMNI:""},fetchOrdersByStatesMethod:"private_get_order_orders",fetchOpenOrdersMethod:"fetch_open_orders_v1",createMarketBuyOrderRequiresPrice:!0,fetchMarketsMethod:"publicGetCommonSymbols",fetchBalanceMethod:"privateGetAccountAccountsIdBalance",createOrderMethod:"privatePostOrderOrdersPlace",language:"en-US",broker:{id:"AA03022abc"}},commonCurrencies:{GET:"Themis",GTC:"Game.com",HIT:"HitChain",HOT:"Hydro Protocol",PNT:"Penta",SBTC:"Super Bitcoin",BIFI:"Bitcoin File"}})}async fetchTime(e={}){const t=await this.publicGetCommonTimestamp(e);return this.safeInteger(t,"data")}async fetchTradingLimits(e,t={}){await this.loadMarkets(),void 0===e&&(e=this.symbols);const i={};for(let s=0;s<e.length;s++){const r=e[s];i[r]=await this.fetchTradingLimitsById(this.marketId(r),t)}return i}async fetchTradingLimitsById(e,t={}){const i={symbol:e},s=await this.publicGetCommonExchange(this.extend(i,t));return this.parseTradingLimits(this.safeValue(s,"data",{}))}parseTradingLimits(e,t,i={}){return{info:e,limits:{amount:{min:this.safeNumber(e,"limit-order-must-greater-than"),max:this.safeNumber(e,"limit-order-must-less-than")}}}}costToPrecision(e,t){return this.decimalToPrecision(t,y,this.markets[e].precision.cost,this.precisionMode)}async fetchMarkets(e={}){const t=this.options.fetchMarketsMethod,i=await this[t](e),s=this.safeValue(i,"data",[]);if(s.length<1)throw new g(this.id+" fetchMarkets() returned empty response: "+this.json(s));const r=[];for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"base-currency"),a=this.safeString(t,"quote-currency"),n=this.safeCurrencyCode(i),o=this.safeCurrencyCode(a),h=this.safeString(t,"state"),d=this.safeString(t,"leverage-ratio","1"),c=this.safeString(t,"super-margin-leverage-ratio","1"),l=v.stringGt(d,"1")||v.stringGt(c,"1"),u="OMG"===n?this.parseNumber("0"):this.parseNumber("0.002");r.push({id:i+a,symbol:n+"/"+o,base:n,quote:o,settle:void 0,baseId:i,quoteId:a,settleId:void 0,type:"spot",spot:!0,margin:l,swap:!1,future:!1,option:!1,active:"online"===h,contract:!1,linear:void 0,inverse:void 0,taker:u,maker:u,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{price:this.parseNumber(this.parsePrecision(this.safeString(t,"price-precision"))),amount:this.parseNumber(this.parsePrecision(this.safeString(t,"amount-precision"))),cost:this.parseNumber(this.parsePrecision(this.safeString(t,"value-precision")))},limits:{leverage:{min:this.parseNumber("1"),max:this.parseNumber(d),superMax:this.parseNumber(c)},amount:{min:this.safeNumber(t,"min-order-amt"),max:this.safeNumber(t,"max-order-amt")},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"min-order-value"),max:void 0}},info:t})}return r}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.safeInteger(e,"ts");let r,a,n,o;"bid"in e&&(Array.isArray(e.bid)?(r=this.safeString(e.bid,0),a=this.safeString(e.bid,1)):(r=this.safeString(e,"bid"),a=this.safeString(e,"bidSize"))),"ask"in e&&(Array.isArray(e.ask)?(n=this.safeString(e.ask,0),o=this.safeString(e.ask,1)):(n=this.safeString(e,"ask"),o=this.safeString(e,"askSize")));const h=this.safeString(e,"open"),d=this.safeString(e,"close"),c=this.safeString(e,"amount"),l=this.safeString(e,"vol");return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:r,bidVolume:a,ask:n,askVolume:o,vwap:void 0,open:h,close:d,last:d,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:c,quoteVolume:l,info:e},t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={symbol:this.market(e).id,type:"step0"},r=await this.marketGetDepth(this.extend(s,i));if("tick"in r){if(!r.tick)throw new f(this.id+" fetchOrderBook() returned empty response: "+this.json(r));const t=this.safeValue(r,"tick"),i=this.safeInteger(t,"ts",this.safeInteger(r,"ts")),s=this.parseOrderBook(t,e,i);return s.nonce=this.safeInteger(t,"version"),s}throw new a(this.id+" fetchOrderBook() returned unrecognized response: "+this.json(r))}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.marketGetDetailMerged(this.extend(s,t)),a=this.parseTicker(r.tick,i),n=this.safeInteger(r,"ts");return a.timestamp=n,a.datetime=this.iso8601(n),a}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.marketGetTickers(t),s=this.safeValue(i,"data",[]),r=this.safeInteger(i,"ts"),a={};for(let e=0;e<s.length;e++){const t=this.safeString(s[e],"symbol"),i=this.safeMarket(t),n=i.symbol,o=this.parseTicker(s[e],i);o.timestamp=r,o.datetime=this.iso8601(r),a[n]=o}return this.filterByArray(a,"symbol",e)}parseTrade(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t),r=this.safeInteger2(e,"ts","created-at"),a=this.safeString(e,"order-id");let n=this.safeString(e,"direction"),o=this.safeString(e,"type");if(void 0!==o){const e=o.split("-");n=e[0],o=e[1]}const h=this.safeString(e,"role"),d=this.safeString(e,"price"),c=this.safeString2(e,"filled-amount","amount"),l=this.parseNumber(d),u=this.parseNumber(c),f=this.parseNumber(v.stringMul(d,c));let p,m=this.safeNumber(e,"filled-fees"),g=this.safeCurrencyCode(this.safeString(e,"fee-currency"));const y=this.safeNumber(e,"filled-points");void 0!==y&&(void 0!==m&&0!==m||(m=y,g=this.safeCurrencyCode(this.safeString(e,"fee-deduct-currency")))),void 0!==m&&(p={cost:m,currency:g});const b=this.safeString2(e,"trade-id","tradeId");return{id:this.safeString(e,"id",b),info:e,order:a,timestamp:r,datetime:this.iso8601(r),symbol:s,type:o,side:n,takerOrMaker:h,price:l,amount:u,cost:f,fee:p}}async fetchOrderTrades(e,t,i,s,r={}){await this.loadMarkets();const a={id:e},n=await this.privateGetOrderOrdersIdMatchresults(this.extend(a,r));return this.parseTrades(n.data,void 0,i,s)}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.symbol=r.id),void 0!==i&&(a.size=i),void 0!==t&&(a["start-time"]=t);const n=await this.privateGetOrderMatchresults(this.extend(a,s));return this.parseTrades(n.data,r,t,i)}async fetchTrades(e,t,i=1e3,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.size=i);const n=await this.marketGetHistoryTrade(this.extend(a,s)),o=this.safeValue(n,"data",[]);let h=[];for(let e=0;e<o.length;e++){const t=this.safeValue(o[e],"data",[]);for(let e=0;e<t.length;e++){const i=this.parseTrade(t[e],r);h.push(i)}}return h=this.sortBy(h,"timestamp"),this.filterBySymbolSinceLimit(h,r.symbol,t,i)}parseOHLCV(e,t){return[this.safeTimestamp(e,"id"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"amount")]}async fetchOHLCV(e,t="1m",i,s=1e3,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,period:this.safeString(this.timeframes,t,t)};void 0!==s&&(n.size=s);const o=await this.marketGetHistoryKline(this.extend(n,r)),h=this.safeValue(o,"data",[]);return this.parseOHLCVs(h,a,t,i,s)}async fetchAccounts(e={}){await this.loadMarkets();return(await this.privateGetAccountAccounts(e)).data}async fetchCurrencies(e={}){const t={language:this.options.language},i=await this.publicGetSettingsCurrencys(this.extend(t,e)),s=this.safeValue(i,"data",[]),r={};for(let e=0;e<s.length;e++){const t=s[e],i=this.safeValue(t,"name"),a=this.safeCurrencyCode(i),n=this.safeValue(t,"deposit-enabled"),o=this.safeValue(t,"withdraw-enabled"),h=this.safeValue(t,"country-disabled"),d=this.safeValue(t,"visible",!1),c=this.safeString(t,"state"),l=d&&n&&o&&"online"===c&&!h,u=this.safeString(t,"display-name"),f=this.parseNumber(this.parsePrecision(this.safeString(t,"withdraw-precision")));r[a]={id:i,code:a,type:"crypto",name:u,active:l,deposit:n,withdraw:o,fee:void 0,precision:f,limits:{amount:{min:f,max:void 0},deposit:{min:this.safeNumber(t,"deposit-min-amount"),max:void 0},withdraw:{min:this.safeNumber(t,"withdraw-min-amount"),max:void 0}},info:t}}return r}parseBalance(e){const t=this.safeValue(e.data,"list",[]),i={info:e};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r);let n;n=a in i?i[a]:this.account(),"trade"===s.type&&(n.free=this.safeString(s,"balance")),"frozen"===s.type&&(n.used=this.safeString(s,"balance")),i[a]=n}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets(),await this.loadAccounts();const t=this.options.fetchBalanceMethod,i={id:this.accounts[0].id},s=await this[t](this.extend(i,e));return this.parseBalance(s)}async fetchOrdersByStates(e,t,i,s,r={}){await this.loadMarkets();const a={states:e};let n;void 0!==t&&(n=this.market(t),a.symbol=n.id);const o=this.safeString(this.options,"fetchOrdersByStatesMethod","private_get_order_orders"),h=await this[o](this.extend(a,r));return this.parseOrders(h.data,n,i,s)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privateGetOrderOrdersId(this.extend(s,i)),a=this.safeValue(r,"data");return this.parseOrder(a)}async fetchOrders(e,t,i,s={}){return await this.fetchOrdersByStates("pre-submitted,submitted,partial-filled,filled,partial-canceled,canceled",e,t,i,s)}async fetchOpenOrders(e,t,i,s={}){const r=this.safeString(this.options,"fetchOpenOrdersMethod","fetch_open_orders_v1");return await this[r](e,t,i,s)}async fetchOpenOrdersV1(e,t,i,s={}){if(void 0===e)throw new u(this.id+" fetchOpenOrdersV1() requires a symbol argument");return await this.fetchOrdersByStates("pre-submitted,submitted,partial-filled",e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersByStates("filled,partial-canceled,canceled",e,t,i,s)}async fetchOpenOrdersV2(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.symbol=a.id);let n=this.safeString(s,"account-id");if(void 0===n){await this.loadAccounts();for(let e=0;e<this.accounts.length;e++){const t=this.accounts[e];if("spot"===t.type&&(n=this.safeString(t,"id"),void 0!==n))break}}r["account-id"]=n,void 0!==i&&(r.size=i);const o=this.omit(s,"account-id"),h=await this.privateGetOrderOpenOrders(this.extend(r,o)),d=this.safeValue(h,"data",[]);return this.parseOrders(d,a,t,i)}parseOrderStatus(e){return this.safeString({"partial-filled":"open","partial-canceled":"canceled",filled:"closed",canceled:"canceled",submitted:"open"},e,e)}parseOrder(e,t){const i=this.safeString(e,"id");let s,r,a;if("type"in e){const t=e.type.split("-");s=t[0],r=t[1],a=this.parseOrderStatus(this.safeString(e,"state"))}const n=this.safeString(e,"symbol");t=this.safeMarket(n,t);const o=this.safeInteger(e,"created-at"),h=this.safeString(e,"client-order-id"),d=this.safeString(e,"amount"),c=this.safeString2(e,"filled-amount","field-amount"),l=this.safeString(e,"price"),u=this.safeString2(e,"filled-cash-amount","field-cash-amount"),f=this.safeString2(e,"filled-fees","field-fees");let p;if(void 0!==f){p={cost:f,currency:"sell"===s?t.quote:t.base}}return this.safeOrder({info:e,id:i,clientOrderId:h,timestamp:o,datetime:this.iso8601(o),lastTradeTimestamp:void 0,symbol:t.symbol,type:r,timeInForce:void 0,postOnly:void 0,side:s,price:l,stopPrice:void 0,triggerPrice:void 0,average:void 0,cost:u,amount:d,filled:c,remaining:void 0,status:a,fee:p,trades:void 0},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets(),await this.loadAccounts();const n=this.market(e),o={"account-id":this.accounts[0].id,symbol:n.id,type:i+"-"+t},h=this.safeString2(a,"clientOrderId","client-order-id");if(void 0===h){const e=this.safeValue(this.options,"broker",{}),t=this.safeString(e,"id");o["client-order-id"]=t+this.uuid()}else o["client-order-id"]=h;if(a=this.omit(a,["clientOrderId","client-order-id"]),"market"===t&&"buy"===i)if(this.options.createMarketBuyOrderRequiresPrice){if(void 0===r)throw new d(this.id+" market buy order requires price argument to calculate cost (total amount of quote currency to spend for buying, amount * price). To switch off this warning exception and specify cost in the amount argument, set .options['createMarketBuyOrderRequiresPrice'] = false. Make sure you know what you're doing.");{const t=this.numberToString(s),i=this.numberToString(r),a=v.stringMul(t,i);o.amount=this.costToPrecision(e,a)}}else o.amount=this.costToPrecision(e,s);else o.amount=this.amountToPrecision(e,s);"limit"!==t&&"ioc"!==t&&"limit-maker"!==t&&"stop-limit"!==t&&"stop-limit-fok"!==t||(o.price=this.priceToPrecision(e,r));const c=this.options.createOrderMethod,l=await this[c](this.extend(o,a)),u=this.milliseconds();return{info:l,id:this.safeString(l,"data"),timestamp:u,datetime:this.iso8601(u),lastTradeTimestamp:void 0,status:void 0,symbol:e,type:t,side:i,price:r,amount:s,filled:void 0,remaining:void 0,cost:void 0,trades:void 0,fee:void 0,clientOrderId:void 0,average:void 0}}async cancelOrder(e,t,i={}){const s=await this.privatePostOrderOrdersIdSubmitcancel({id:e});return this.extend(this.parseOrder(s),{id:e,status:"canceled"})}async cancelOrders(e,t,i={}){await this.loadMarkets();const s=this.safeValue2(i,"clientOrderIds","client-order-ids");i=this.omit(i,["clientOrderIds","client-order-ids"]);const r={};void 0===s?r["order-ids"]=e:r["client-order-ids"]=s;return await this.privatePostOrderOrdersBatchcancel(this.extend(r,i))}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};let s;void 0!==e&&(s=this.market(e),i.symbol=s.id);return await this.privatePostOrderOrdersBatchCancelOpenOrders(this.extend(i,t))}currencyToPrecision(e,t,i){return this.decimalToPrecision(t,0,this.currencies[e].precision,this.precisionMode)}safeNetwork(e){const t=e.length-1;"1"===e[t]&&(e=e.slice(0,t));return this.safeString({},e,e)}parseDepositAddress(e,t){const i=this.safeString(e,"address"),s=this.safeString(e,"addressTag"),r=this.safeString(e,"currency");t=this.safeCurrency(r,t);const a=this.safeCurrencyCode(r,t),n=this.safeString(e,"chain"),o=this.safeValue(t,"networks",{}),h=this.indexBy(o,"id"),d=this.safeValue(h,n,n),c=this.safeString(d,"network");return this.checkAddress(i),{currency:a,address:i,tag:s,network:c,info:e}}async fetchDeposits(e,t,i,s={}){let r;(void 0===i||i>100)&&(i=100),await this.loadMarkets(),void 0!==e&&(r=this.currency(e));const a={type:"deposit",from:0};void 0!==r&&(a.currency=r.id),void 0!==i&&(a.size=i);const n=await this.privateGetQueryDepositWithdraw(this.extend(a,s));return this.parseTransactions(n.data,r,t,i)}async fetchWithdrawals(e,t,i,s={}){let r;(void 0===i||i>100)&&(i=100),await this.loadMarkets(),void 0!==e&&(r=this.currency(e));const a={type:"withdraw",from:0};void 0!==r&&(a.currency=r.id),void 0!==i&&(a.size=i);const n=await this.privateGetQueryDepositWithdraw(this.extend(a,s));return this.parseTransactions(n.data,r,t,i)}parseTransaction(e,t){const i=this.safeInteger(e,"created-at"),s=this.safeCurrencyCode(this.safeString(e,"currency"));let r=this.safeString(e,"type");"withdraw"===r&&(r="withdrawal");let a=this.safeString(e,"fee");return void 0!==a&&(a=v.stringAbs(a)),{info:e,id:this.safeString2(e,"id","data"),txid:this.safeString(e,"tx-hash"),timestamp:i,datetime:this.iso8601(i),network:this.safeStringUpper(e,"chain"),address:this.safeString(e,"address"),addressTo:void 0,addressFrom:void 0,tag:this.safeString(e,"address-tag"),tagTo:void 0,tagFrom:void 0,type:r,amount:this.safeNumber(e,"amount"),currency:s,status:this.parseTransactionStatus(this.safeString(e,"state")),updated:this.safeInteger(e,"updated-at"),fee:{currency:s,cost:this.parseNumber(a),rate:void 0}}}parseTransactionStatus(e){return this.safeString({unknown:"failed",confirming:"pending",confirmed:"ok",safe:"ok",orphan:"failed",submitted:"pending",canceled:"canceled",reexamine:"pending",reject:"failed",pass:"pending","wallet-reject":"failed","confirm-error":"failed",repealed:"failed","wallet-transfer":"pending","pre-transfer":"pending"},e,e)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets(),this.checkAddress(i);const a=this.currency(e),n={address:i,amount:t,currency:a.id.toLowerCase()};void 0!==s&&(n["addr-tag"]=s);const o=this.safeValue(this.options,"networks",{});let h=this.safeStringUpper(r,"network");h=this.safeStringLower(o,h,h),void 0!==h&&(n.chain="erc20"===h?a.id+h:h+a.id,r=this.omit(r,"network"));const d=await this.privatePostDwWithdrawApiCreate(this.extend(n,r));return this.parseTransaction(d,a)}sign(e,t="public",i="GET",s={},r,a){let n="/";"market"===t?n+=t:"public"===t||"private"===t?n+=this.version:"v2Public"!==t&&"v2Private"!==t||(n+="v2"),n+="/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if("private"===t||"v2Private"===t){this.checkRequiredCredentials();const e=this.ymdhms(this.milliseconds(),"T");let t={SignatureMethod:"HmacSHA256",SignatureVersion:"2",AccessKeyId:this.apiKey,Timestamp:e};"POST"!==i&&(t=this.extend(t,o)),t=this.keysort(t);let s=this.urlencode(t);const h=[i,this.hostname,n,s].join("\n"),d=this.hmac(this.encode(h),this.encode(this.secret),"sha256","base64");s+="&"+this.urlencode({Signature:d}),n+="?"+s,"POST"===i?(a=this.json(o),r={"Content-Type":"application/json"}):r={"Content-Type":"application/x-www-form-urlencoded"}}else Object.keys(s).length&&(n+="?"+this.urlencode(s));return n=this.implodeParams(this.urls.api[t],{hostname:this.hostname})+n,{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,n,o,h,d){if(void 0!==o&&"status"in o){if("error"===this.safeString(o,"status")){const e=this.safeString(o,"err-code"),t=this.id+" "+n;this.throwBroadlyMatchedException(this.exceptions.broad,n,t),this.throwExactlyMatchedException(this.exceptions.exact,e,t);const i=this.safeString(o,"err-msg");throw this.throwExactlyMatchedException(this.exceptions.exact,i,t),new a(t)}}}}},53775:function(e,t,i){"use strict";const s=i(68639);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"huobipro",alias:!0,name:"Huobi Pro"})}}},22574:function(e,t,i){"use strict";const s=i(48819),{TICK_SIZE:r,PAD_WITH_ZERO:a,ROUND:n,TRUNCATE:o,DECIMAL_PLACES:h}=i(62115),{InvalidOrder:d,InsufficientFunds:c,ExchangeError:l,ExchangeNotAvailable:u,DDoSProtection:f,BadRequest:p,NotSupported:m,InvalidAddress:g,AuthenticationError:y}=i(73449),b=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"idex",name:"IDEX",countries:["US"],rateLimit:200,version:"v3",pro:!0,certified:!0,requiresWeb3:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:!1,createDepositAddress:!1,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposit:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactions:!1,fetchWithdrawal:!0,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!0},timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","6h":"6h","1d":"1d"},urls:{test:{MATIC:"https://api-sandbox-matic.idex.io"},logo:"https://user-images.githubusercontent.com/51840849/94481303-2f222100-01e0-11eb-97dd-bc14c5943a86.jpg",api:{MATIC:"https://api-matic.idex.io"},www:"https://idex.io",doc:["https://docs.idex.io/"]},api:{public:{get:{ping:1,time:1,exchange:1,assets:1,markets:1,tickers:1,candles:1,trades:1,orderbook:1}},private:{get:{user:1,wallets:1,balances:1,orders:1,fills:1,deposits:1,withdrawals:1,wsToken:1},post:{wallets:1,orders:1,"orders/test":1,withdrawals:1},delete:{orders:1}}},options:{defaultTimeInForce:"gtc",defaultSelfTradePrevention:"cn",network:"MATIC"},exceptions:{INVALID_ORDER_QUANTITY:d,INSUFFICIENT_FUNDS:c,SERVICE_UNAVAILABLE:u,EXCEEDED_RATE_LIMIT:f,INVALID_PARAMETER:p,WALLET_NOT_ASSOCIATED:g,INVALID_WALLET_SIGNATURE:y},requiredCredentials:{walletAddress:!0,privateKey:!0,apiKey:!0,secret:!0},precisionMode:r,paddingMode:a,commonCurrencies:{}})}priceToPrecision(e,t){const i=this.market(e),s=this.safeValue(i,"info",{}),r=this.safeInteger(s,"quoteAssetPrecision");return t=this.decimalToPrecision(t,n,i.precision.price,this.precisionMode),this.decimalToPrecision(t,o,r,h,a)}async fetchMarkets(e={}){const t=await this.publicGetMarkets(e),i=await this.publicGetExchange(),s=this.safeNumber(i,"makerFeeRate"),r=this.safeNumber(i,"takerFeeRate"),a=this.safeString(i,"makerTradeMinimum"),n=this.safeString(i,"takerTradeMinimum"),o=this.parseNumber(b.stringMin(a,n)),h=[];for(let e=0;e<t.length;e++){const i=t[e],a=this.safeString(i,"market"),n=this.safeString(i,"baseAsset"),d=this.safeString(i,"quoteAsset"),c=this.safeCurrencyCode(n),l=this.safeCurrencyCode(d),u=this.parseNumber(this.parsePrecision(this.safeString(i,"baseAssetPrecision"))),f=this.parseNumber(this.parsePrecision(this.safeString(i,"quoteAssetPrecision"))),p=this.safeString(i,"status");let m;"ETH"===l&&(m=o),h.push({id:a,symbol:c+"/"+l,base:c,quote:l,settle:void 0,baseId:n,quoteId:d,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:"inactive"!==p,contract:!1,linear:void 0,inverse:void 0,taker:r,maker:s,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:u,price:this.safeNumber(i,"tickSize")},limits:{leverage:{min:void 0,max:void 0},amount:{min:u,max:void 0},price:{min:f,max:void 0},cost:{min:m,max:void 0}},info:i})}return h}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={market:i.id},r=await this.publicGetTickers(this.extend(s,t)),a=this.safeValue(r,0);return this.parseTicker(a,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetTickers(t);return this.parseTickers(i,e)}parseTicker(e,t){const i=this.safeString(e,"market"),s=(t=this.safeMarket(i,t,"-")).symbol,r=this.safeInteger(e,"time"),a=this.safeString(e,"close");return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:this.safeString(e,"open"),close:a,last:a,previousClose:void 0,change:void 0,percentage:this.safeString(e,"percentChange"),average:void 0,baseVolume:this.safeString(e,"baseVolume"),quoteVolume:this.safeString(e,"quoteVolume"),info:e},t)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={market:a.id,interval:t};void 0!==i&&(n.start=i),void 0!==s&&(n.limit=s);const o=await this.publicGetCandles(this.extend(n,r));return Array.isArray(o)?this.parseOHLCVs(o,a,t,i,s):[]}parseOHLCV(e,t){return[this.safeInteger(e,"start"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={market:r.id};void 0!==t&&(a.start=t),void 0!==i&&(a.limit=i);const n=await this.publicGetTrades(this.extend(a,s));return this.parseTrades(n,r,t,i)}parseTrade(e,t){const i=this.safeString(e,"fillId"),s=this.safeString(e,"price"),r=this.safeString(e,"quantity"),a=this.safeString(e,"quoteQuantity"),n=this.safeInteger(e,"time"),o=this.safeString(e,"market"),h=this.safeSymbol(o,t,"-"),d="buy"===this.safeString(e,"makerSide")?"sell":"buy",c=this.safeString(e,"side",d),l=this.safeString(e,"liquidity","taker"),u=this.safeString(e,"fee");let f;if(void 0!==u){const t=this.safeString(e,"feeAsset");f={cost:u,currency:this.safeCurrencyCode(t)}}const p=this.safeString(e,"orderId");return this.safeTrade({info:e,timestamp:n,datetime:this.iso8601(n),symbol:h,id:i,order:p,type:"limit",side:c,takerOrMaker:l,price:s,amount:r,cost:a,fee:f},t)}async fetchTradingFees(e={}){this.checkRequiredCredentials(),await this.loadMarkets();const t={nonce:this.uuidv1()};let i;i=await this.privateGetUser(this.extend(t,e));const s=this.safeNumber(i,"makerFeeRate"),r=this.safeNumber(i,"takerFeeRate"),a={};for(let e=0;e<this.symbols.length;e++){const t=this.symbols[e];a[t]={info:i,symbol:t,maker:s,taker:r,percentage:!0,tierBased:!1}}return a}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={market:this.market(e).id,level:2};void 0!==t&&(s.limit=t);const r=await this.publicGetOrderbook(this.extend(s,i));return{symbol:e,timestamp:void 0,datetime:void 0,nonce:this.safeInteger(r,"sequence"),bids:this.parseSide(r,"bids"),asks:this.parseSide(r,"asks")}}parseSide(e,t){const i=this.safeValue(e,t,[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeNumber(t,0),a=this.safeNumber(t,1),n=this.safeInteger(t,2);s.push([r,a,n])}const r="bids"===t;return this.sortBy(s,0,r)}async fetchCurrencies(e={}){const t=await this.publicGetAssets(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"name"),a=this.safeString(s,"symbol"),n=this.safeCurrencyCode(a),o=this.parseNumber(this.parsePrecision(this.safeString(s,"exchangeDecimals")));i[n]={id:a,code:n,info:s,type:void 0,name:r,active:void 0,deposit:void 0,withdraw:void 0,fee:void 0,precision:o,limits:{amount:{min:o,max:void 0},withdraw:{min:o,max:void 0}}}}return i}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"asset"),a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(s,"quantity"),n.free=this.safeString(s,"availableForTrade"),n.used=this.safeString(s,"locked"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){this.checkRequiredCredentials(),await this.loadMarkets();const t={nonce:this.uuidv1(),wallet:this.walletAddress},i=this.extend(t,e);if(void 0===i.wallet)throw new p(this.id+' fetchBalance() wallet is undefined, set this.walletAddress or "address" in params');let s;try{s=await this.privateGetBalances(i)}catch(e){if(!(e instanceof g))throw e;{const e=i.wallet;await this.associateWallet(e),s=await this.privateGetBalances(i)}}return this.parseBalance(s)}async fetchMyTrades(e,t,i,s={}){let r;this.checkRequiredCredentials(),await this.loadMarkets();const a={nonce:this.uuidv1(),wallet:this.walletAddress};void 0!==e&&(r=this.market(e),a.market=r.id),void 0!==t&&(a.start=t),void 0!==i&&(a.limit=i);const n=this.extend(a,s);if(void 0===n.wallet)throw new p(this.id+' fetchMyTrades() walletAddress is undefined, set this.walletAddress or "address" in params');let o;try{o=await this.privateGetFills(n)}catch(e){if(!(e instanceof g))throw e;{const e=n.wallet;await this.associateWallet(e),o=await this.privateGetFills(n)}}return this.parseTrades(o,r,t,i)}async fetchOrder(e,t,i={}){const s={orderId:e};return await this.fetchOrdersHelper(t,void 0,void 0,this.extend(s,i))}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrdersHelper(e,t,i,this.extend({closed:!1},s))}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersHelper(e,t,i,this.extend({closed:!0},s))}async fetchOrdersHelper(e,t,i,s={}){await this.loadMarkets();const r={nonce:this.uuidv1(),wallet:this.walletAddress};let a;void 0!==e&&(a=this.market(e),r.market=a.id),void 0!==t&&(r.start=t),void 0!==i&&(r.limit=i);const n=await this.privateGetOrders(this.extend(r,s));return Array.isArray(n)?this.parseOrders(n,a,t,i):this.parseOrder(n,a)}parseOrderStatus(e){return this.safeString({active:"open",partiallyFilled:"open",rejected:"canceled",filled:"closed"},e,e)}parseOrder(e,t){const i=this.safeInteger(e,"time"),s=this.safeValue(e,"fills",[]),r=this.safeString(e,"orderId"),a=this.safeString(e,"clientOrderId"),n=this.safeString(e,"market"),o=this.safeString(e,"side"),h=this.safeSymbol(n,t,"-"),d=this.safeString(e,"type"),c=this.safeString(e,"originalQuantity"),l=this.safeString(e,"executedQuantity"),u=this.safeString(e,"avgExecutionPrice"),f=this.safeString(e,"price"),p=this.safeString(e,"status"),m=this.safeStringUpper(e,"timeInForce"),g=this.parseOrderStatus(p);return this.safeOrder({info:e,id:r,clientOrderId:a,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:void 0,symbol:h,type:d,timeInForce:m,postOnly:void 0,side:o,price:f,stopPrice:void 0,triggerPrice:void 0,amount:c,cost:void 0,average:u,filled:l,remaining:void 0,status:g,fee:void 0,trades:s},t)}async associateWallet(e,t={}){const i=this.uuidv1(),s=this.remove0xPrefix(e),r=[this.base16ToBinary(i),this.base16ToBinary(s)],a=this.binaryConcatArray(r),n=this.hash(a,"keccak","hex"),o={parameters:{nonce:i,wallet:e},signature:this.signMessageString(n,this.privateKey)};return await this.privatePostWallets(o)}async createOrder(e,t,i,s,r,a={}){this.checkRequiredCredentials(),await this.loadMarkets();const n=this.market(e),o=this.uuidv1();let h;const d={stopLoss:3,stopLossLimit:4,takeProfit:5,takeProfitLimit:6};let c;if("stopLossLimit"===t||"takeProfitLimit"===t||"stopPrice"in a){if(!("stopPrice"in a))throw new p(this.id+" createOrder() stopPrice is a required parameter for "+t+"orders");c=this.priceToPrecision(e,a.stopPrice)}const l={limit:1,limitMaker:2};let u;const f=t.toLowerCase().indexOf("limit")>=0;if(t in l)h=l[t],u=this.priceToPrecision(e,r);else if(t in d)h=d[t],u=this.priceToPrecision(e,r);else{if("market"!==t)throw new p(this.id+" "+t+" is not a valid order type");h=0}let g=0;if("quoteOrderQuantity"in a){if("market"!==t)throw new m(this.id+" createOrder() quoteOrderQuantity is not supported for "+t+" orders, only supported for market orders");g=1,s=this.safeNumber(a,"quoteOrderQuantity")}const y="buy"===i?0:1,b=this.remove0xPrefix(this.walletAddress),v=this.safeString(this.options,"network","ETH"),w=this.getSupportedMapping(v,{ETH:1,BSC:2,MATIC:4}),S=this.amountToPrecision(e,s),k={gtc:0,ioc:2,fok:3},T=this.safeString(this.options,"defaultTimeInForce","gtc"),_=this.safeString(a,"timeInForce",T);let O;if(!(_ in k)){const e=Object.keys(k).join(", ");throw new p(this.id+" "+_+" is not a valid timeInForce, please choose one of "+e)}O=k[_];const M={dc:0,co:1,cn:2,cb:3},I=this.safeString(this.options,"defaultSelfTradePrevention","cn"),x=this.safeString(a,"selfTradePrevention",I);let C;if(!(x in M)){const e=Object.keys(M).join(", ");throw new p(this.id+" "+x+" is not a valid selfTradePrevention, please choose one of "+e)}C=M[x];const P=[this.numberToBE(w,1),this.base16ToBinary(o),this.base16ToBinary(b),this.stringToBinary(this.encode(n.id)),this.numberToBE(h,1),this.numberToBE(y,1),this.stringToBinary(this.encode(S)),this.numberToBE(g,1)];if(f){const e=this.stringToBinary(this.encode(u));P.push(e)}if(t in d){const e=this.stringToBinary(this.encode(c||u));P.push(e)}const A=this.safeString(a,"clientOrderId");void 0!==A&&P.push(this.stringToBinary(this.encode(A)));const N=[this.numberToBE(O,1),this.numberToBE(C,1),this.numberToBE(0,8)],B=this.arrayConcat(P,N),E=this.binaryConcatArray(B),V=this.hash(E,"keccak","hex"),L=this.signMessageString(V,this.privateKey),R={parameters:{nonce:o,market:n.id,side:i,type:t,wallet:this.walletAddress,selfTradePrevention:x},signature:L};"market"!==t&&(R.parameters.timeInForce=_),f&&(R.parameters.price=u),t in d&&(R.parameters.stopPrice=c||u),0===g?R.parameters.quantity=S:R.parameters.quoteOrderQuantity=S,void 0!==A&&(R.parameters.clientOrderId=A);const D=await this.privatePostOrders(R);return this.parseOrder(D,n)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkRequiredCredentials(),await this.loadMarkets();const a=this.uuidv1(),n=this.currencyToPrecision(e,t),o=this.currency(e),h=this.remove0xPrefix(this.walletAddress),d=[this.base16ToBinary(a),this.base16ToBinary(h),this.stringToBinary(this.encode(o.id)),this.stringToBinary(this.encode(n)),this.numberToBE(1,1)],c=this.binaryConcatArray(d),l=this.hash(c,"keccak","hex"),u=this.signMessageString(l,this.privateKey),f={parameters:{nonce:a,wallet:i,asset:o.id,quantity:n},signature:u},p=await this.privatePostWithdrawals(f);return this.parseTransaction(p,o)}async cancelAllOrders(e,t={}){let i;this.checkRequiredCredentials(),await this.loadMarkets(),void 0!==e&&(i=this.market(e));const s=this.uuidv1(),r={parameters:{nonce:s,wallet:this.walletAddress}},a=this.remove0xPrefix(this.walletAddress),n=[this.base16ToBinary(s),this.base16ToBinary(a)];void 0!==i&&(n.push(this.stringToBinary(this.encode(i.id))),r.parameters.market=i.id);const o=this.binaryConcatArray(n),h=this.hash(o,"keccak","hex"),d=this.signMessageString(h,this.privateKey);r.signature=d;const c=await this.privateDeleteOrders(this.extend(r,t));return this.parseOrders(c,i)}async cancelOrder(e,t,i={}){let s;this.checkRequiredCredentials(),await this.loadMarkets(),void 0!==t&&(s=this.market(t));const r=this.uuidv1(),a=this.remove0xPrefix(this.walletAddress),n=[this.base16ToBinary(r),this.base16ToBinary(a),this.stringToBinary(this.encode(e))],o=this.binaryConcatArray(n),h=this.hash(o,"keccak","hex"),d=this.signMessageString(h,this.privateKey),c={parameters:{nonce:r,wallet:this.walletAddress,orderId:e},signature:d},l=await this.privateDeleteOrders(this.extend(c,i)),u=this.safeValue(l,0);return this.parseOrder(u,s)}handleErrors(e,t,i,s,r,a,n,o,h){const d=this.safeString(n,"code"),c=this.safeString(n,"message");if(d in this.exceptions){throw new(0,this.exceptions[d])(this.id+" "+c)}if(void 0!==d)throw new l(this.id+" "+c)}async fetchDeposit(e,t,i={}){await this.loadMarkets();const s={nonce:this.uuidv1(),wallet:this.walletAddress,depositId:e},r=await this.privateGetDeposits(this.extend(s,i));return this.parseTransaction(r,t)}async fetchDeposits(e,t,i,s={}){return s=this.extend({method:"privateGetDeposits"},s),this.fetchTransactionsHelper(e,t,i,s)}async fetchTime(e={}){const t=await this.publicGetTime(e);return this.safeNumber(t,"serverTime")}async fetchWithdrawal(e,t,i={}){await this.loadMarkets();const s={nonce:this.uuidv1(),wallet:this.walletAddress,withdrawalId:e},r=await this.privateGetWithdrawals(this.extend(s,i));return this.parseTransaction(r,t)}async fetchWithdrawals(e,t,i,s={}){return s=this.extend({method:"privateGetWithdrawals"},s),this.fetchTransactionsHelper(e,t,i,s)}async fetchTransactionsHelper(e,t,i,s={}){await this.loadMarkets();const r={nonce:this.uuidv1(),wallet:this.walletAddress};let a;void 0!==e&&(a=this.currency(e),r.asset=a.id),void 0!==t&&(r.start=t),void 0!==i&&(r.limit=i);const n=s.method;s=this.omit(s,"method");const o=await this[n](this.extend(r,s));return this.parseTransactions(o,a,t,i)}parseTransactionStatus(e){return this.safeString({mined:"ok"},e,e)}parseTransaction(e,t){let i;"depositId"in e?i="deposit":("withdrawId"in e||"withdrawalId"in e)&&(i="withdrawal");let s=this.safeString2(e,"depositId","withdrawId");s=this.safeString(e,"withdrawalId",s);const r=this.safeCurrencyCode(this.safeString(e,"asset"),t),a=this.safeNumber(e,"quantity"),n=this.safeString(e,"txId"),o=this.safeInteger2(e,"txTime","time");let h;"fee"in e&&(h={cost:this.safeNumber(e,"fee"),currency:"ETH"});const d=this.safeString(e,"txStatus"),c=this.parseTransactionStatus(d),l=this.safeInteger(e,"confirmationTime");return{info:e,id:s,txid:n,timestamp:o,datetime:this.iso8601(o),network:void 0,address:void 0,addressTo:void 0,addressFrom:void 0,tag:void 0,tagTo:void 0,tagFrom:void 0,type:i,amount:a,currency:r,status:c,updated:l,fee:h}}calculateRateLimiterCost(e,t,i,s,r={},a={}){const n=void 0!==this.apiKey,o=void 0!==this.secret,h=void 0!==this.walletAddress,d=void 0!==this.privateKey,c=this.safeValue(r,"cost",1);return n&&o&&h&&d?c/2:c}sign(e,t="public",i="GET",s={},r,a){const n=this.safeString(this.options,"network","ETH"),o=this.safeString(this.options,"version","v1");let h=this.urls.api[n]+"/"+o+"/"+e;let d;if(Object.keys(s).length>0&&("GET"===i?(d=this.urlencode(s),h=h+"?"+d):a=this.json(s)),r={"Content-Type":"application/json"},void 0!==this.apiKey&&(r["IDEX-API-Key"]=this.apiKey),"private"===t){let e;e="GET"===i?d:a,r["IDEX-HMAC-Signature"]=this.hmac(this.encode(e),this.encode(this.secret),"sha256","hex")}return{url:h,method:i,body:a,headers:r}}}},73585:function(e,t,i){"use strict";const s=i(48819),{TICK_SIZE:r}=i(62115),a=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"independentreserve",name:"Independent Reserve",countries:["AU","NZ"],rateLimit:1e3,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1},urls:{logo:"https://user-images.githubusercontent.com/51840849/87182090-1e9e9080-c2ec-11ea-8e49-563db9a38f37.jpg",api:{public:"https://api.independentreserve.com/Public",private:"https://api.independentreserve.com/Private"},www:"https://www.independentreserve.com",doc:"https://www.independentreserve.com/API"},api:{public:{get:["GetValidPrimaryCurrencyCodes","GetValidSecondaryCurrencyCodes","GetValidLimitOrderTypes","GetValidMarketOrderTypes","GetValidOrderTypes","GetValidTransactionTypes","GetMarketSummary","GetOrderBook","GetAllOrders","GetTradeHistorySummary","GetRecentTrades","GetFxRates","GetOrderMinimumVolumes","GetCryptoWithdrawalFees"]},private:{post:["GetOpenOrders","GetClosedOrders","GetClosedFilledOrders","GetOrderDetails","GetAccounts","GetTransactions","GetFiatBankAccounts","GetDigitalCurrencyDepositAddress","GetDigitalCurrencyDepositAddresses","GetTrades","GetBrokerageFees","GetDigitalCurrencyWithdrawal","PlaceLimitOrder","PlaceMarketOrder","CancelOrder","SynchDigitalCurrencyDepositAddressWithBlockchain","RequestFiatWithdrawal","WithdrawFiatCurrency","WithdrawDigitalCurrency"]}},fees:{trading:{taker:this.parseNumber("0.005"),maker:this.parseNumber("0.005"),percentage:!0,tierBased:!1}},commonCurrencies:{PLA:"PlayChip"},precisionMode:r})}async fetchMarkets(e={}){const t=await this.publicGetGetValidPrimaryCurrencyCodes(e),i=await this.publicGetGetValidSecondaryCurrencyCodes(e),s=await this.publicGetGetOrderMinimumVolumes(e),r=[];for(let e=0;e<t.length;e++){const a=t[e],n=this.safeCurrencyCode(a),o=this.safeNumber(s,a);for(let e=0;e<i.length;e++){const t=i[e],s=this.safeCurrencyCode(t),h=a+"/"+t;r.push({id:h,symbol:n+"/"+s,base:n,quote:s,settle:void 0,baseId:a,quoteId:t,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:void 0,price:void 0},limits:{leverage:{min:void 0,max:void 0},amount:{min:o,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:h})}}return r}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"CurrencyCode"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"AvailableBalance"),n.total=this.safeString(s,"TotalBalance"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostGetAccounts(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={primaryCurrencyCode:s.baseId,secondaryCurrencyCode:s.quoteId},a=await this.publicGetGetOrderBook(this.extend(r,i)),n=this.parse8601(this.safeString(a,"CreatedTimestampUtc"));return this.parseOrderBook(a,s.symbol,n,"BuyOrders","SellOrders","Price","Volume")}parseTicker(e,t){const i=this.parse8601(this.safeString(e,"CreatedTimestampUtc")),s=this.safeString(e,"PrimaryCurrencyCode"),r=this.safeString(e,"SecondaryCurrencyCode");let a;void 0!==s&&void 0!==r&&(a=s+"/"+r);const n=(t=this.safeMarket(a,t,"/")).symbol,o=this.safeString(e,"LastPrice");return this.safeTicker({symbol:n,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"DayHighestPrice"),low:this.safeString(e,"DayLowestPrice"),bid:this.safeString(e,"CurrentHighestBidPrice"),bidVolume:void 0,ask:this.safeString(e,"CurrentLowestOfferPrice"),askVolume:void 0,vwap:void 0,open:void 0,close:o,last:o,previousClose:void 0,change:void 0,percentage:void 0,average:this.safeString(e,"DayAvgPrice"),baseVolume:this.safeString(e,"DayVolumeXbtInSecondaryCurrrency"),quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={primaryCurrencyCode:i.baseId,secondaryCurrencyCode:i.quoteId},r=await this.publicGetGetMarketSummary(this.extend(s,t));return this.parseTicker(r,i)}parseOrder(e,t){let i;const s=this.safeString(e,"PrimaryCurrencyCode"),r=this.safeString(e,"SecondaryCurrencyCode");let n,o;void 0!==s&&void 0!==r?(n=this.safeCurrencyCode(s),o=this.safeCurrencyCode(r),i=n+"/"+o):void 0!==t&&(i=t.symbol,n=t.base,o=t.quote);let h,d=this.safeString2(e,"Type","OrderType");void 0!==d&&(d.indexOf("Bid")>=0?h="buy":d.indexOf("Offer")>=0&&(h="sell"),d.indexOf("Market")>=0?d="market":d.indexOf("Limit")>=0&&(d="limit"));const c=this.parse8601(this.safeString(e,"CreatedTimestampUtc")),l=this.safeString(e,"VolumeFilled"),u=this.safeString(e,"FeePercent");let f;return void 0!==u&&void 0!==l&&(f=a.stringMul(u,l)),this.safeOrder({info:e,id:this.safeString(e,"OrderGuid"),clientOrderId:void 0,timestamp:c,datetime:this.iso8601(c),lastTradeTimestamp:void 0,symbol:i,type:d,timeInForce:void 0,postOnly:void 0,side:h,price:this.safeString(e,"Price"),stopPrice:void 0,triggerPrice:void 0,cost:this.safeString(e,"Value"),average:this.safeString(e,"AvgPrice"),amount:this.safeString2(e,"VolumeOrdered","Volume"),filled:l,remaining:this.safeString(e,"Outstanding"),status:this.parseOrderStatus(this.safeString(e,"Status")),fee:{rate:u,cost:f,currency:n},trades:void 0},t)}parseOrderStatus(e){return this.safeString({Open:"open",PartiallyFilled:"open",Filled:"closed",PartiallyFilledAndCancelled:"canceled",Cancelled:"canceled",PartiallyFilledAndExpired:"canceled",Expired:"canceled"},e,e)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s=await this.privatePostGetOrderDetails(this.extend({orderGuid:e},i));let r;return void 0!==t&&(r=this.market(t)),this.parseOrder(s,r)}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r=this.ordered({});let a;void 0!==e&&(a=this.market(e),r.primaryCurrencyCode=a.baseId,r.secondaryCurrencyCode=a.quoteId),void 0===i&&(i=50),r.pageIndex=1,r.pageSize=i;const n=await this.privatePostGetOpenOrders(this.extend(r,s)),o=this.safeValue(n,"Data",[]);return this.parseOrders(o,a,t,i)}async fetchClosedOrders(e,t,i,s={}){await this.loadMarkets();const r=this.ordered({});let a;void 0!==e&&(a=this.market(e),r.primaryCurrencyCode=a.baseId,r.secondaryCurrencyCode=a.quoteId),void 0===i&&(i=50),r.pageIndex=1,r.pageSize=i;const n=await this.privatePostGetClosedOrders(this.extend(r,s)),o=this.safeValue(n,"Data",[]);return this.parseOrders(o,a,t,i)}async fetchMyTrades(e,t,i=50,s={}){await this.loadMarkets();const r=this.safeInteger(s,"pageIndex",1);void 0===i&&(i=50);const a=this.ordered({pageIndex:r,pageSize:i}),n=await this.privatePostGetTrades(this.extend(a,s));let o;return void 0!==e&&(o=this.market(e)),this.parseTrades(n.Data,o,t,i)}parseTrade(e,t){const i=this.parse8601(e.TradeTimestampUtc),s=this.safeString(e,"TradeGuid"),r=this.safeString(e,"OrderGuid"),n=this.safeString2(e,"Price","SecondaryCurrencyTradePrice"),o=this.safeString2(e,"VolumeTraded","PrimaryCurrencyAmount"),h=this.parseNumber(n),d=this.parseNumber(o),c=this.parseNumber(a.stringMul(n,o)),l=this.safeString(e,"PrimaryCurrencyCode"),u=this.safeString(e,"SecondaryCurrencyCode");let f;void 0!==l&&void 0!==u&&(f=l+"/"+u);const p=this.safeSymbol(f,t,"/");let m=this.safeString(e,"OrderType");return void 0!==m&&(m.indexOf("Bid")>=0?m="buy":m.indexOf("Offer")>=0&&(m="sell")),{id:s,info:e,timestamp:i,datetime:this.iso8601(i),symbol:p,order:r,type:void 0,side:m,takerOrMaker:void 0,price:h,amount:d,cost:c,fee:void 0}}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={primaryCurrencyCode:r.baseId,secondaryCurrencyCode:r.quoteId,numberOfRecentTradesToRetrieve:50},n=await this.publicGetGetRecentTrades(this.extend(a,s));return this.parseTrades(n.Trades,r,t,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privatePostGetBrokerageFees(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"CurrencyCode"),a=this.safeCurrencyCode(r),n=this.safeNumber(s,"Fee");i[a]={info:s,fee:n}}const s={};for(let e=0;e<this.symbols.length;e++){const t=this.symbols[e],r=this.market(t),a=this.safeValue(i,r.base,{});s[t]={info:this.safeValue(a,"info"),symbol:t,maker:this.safeNumber(a,"fee"),taker:this.safeNumber(a,"fee"),percentage:!0,tierBased:!0}}return s}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=this.capitalize(t),h="privatePostPlace"+o+"Order";let d=o;d+="sell"===i?"Offer":"Bid";const c=this.ordered({primaryCurrencyCode:n.baseId,secondaryCurrencyCode:n.quoteId,orderType:d});"limit"===t&&(c.price=r),c.volume=s;const l=await this[h](this.extend(c,a));return{info:l,id:l.OrderGuid}}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={orderGuid:e};return await this.privatePostCancelOrder(this.extend(s,i))}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t]+"/"+e;if("public"===t)Object.keys(s).length&&(n+="?"+this.urlencode(s));else{this.checkRequiredCredentials();const e=this.nonce(),t=[n,"apiKey="+this.apiKey,"nonce="+e.toString()],i=Object.keys(s);for(let e=0;e<i.length;e++){const r=i[e],a=s[r].toString();t.push(r+"="+a)}const o=t.join(","),h=this.hmac(this.encode(o),this.encode(this.secret)),d=this.ordered({});d.apiKey=this.apiKey,d.nonce=e,d.signature=h.toUpperCase();for(let e=0;e<i.length;e++){const t=i[e];d[t]=s[t]}a=this.json(d),r={"Content-Type":"application/json"}}return{url:n,method:i,body:a,headers:r}}}},14535:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,InsufficientFunds:n,InvalidOrder:o,OrderNotFound:h,AuthenticationError:d,BadSymbol:c}=i(73449),{TICK_SIZE:l}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"indodax",name:"INDODAX",countries:["ID"],rateLimit:100,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelAllOrders:!1,cancelOrder:!0,cancelOrders:!1,createDepositAddress:!1,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchDeposit:!1,fetchDeposits:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransactionFee:!0,fetchTransactionFees:!1,fetchTransactions:!0,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!1,fetchWithdrawals:!1,reduceMargin:!1,setLeverage:!1,setMargin:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!0},version:"2.0",urls:{logo:"https://user-images.githubusercontent.com/51840849/87070508-9358c880-c221-11ea-8dc5-5391afbbb422.jpg",api:{public:"https://indodax.com/api",private:"https://indodax.com/tapi"},www:"https://www.indodax.com",doc:"https://github.com/btcid/indodax-official-api-docs",referral:"https://indodax.com/ref/testbitcoincoid/1"},api:{public:{get:{server_time:5,pairs:5,price_increments:5,summaries:5,ticker_all:5,"{pair}/ticker":5,"{pair}/trades":5,"{pair}/depth":5}},private:{post:{getInfo:4,transHistory:4,trade:1,tradeHistory:4,openOrders:4,orderHistory:4,getOrder:4,cancelOrder:4,withdrawFee:4,withdrawCoin:4,listDownline:4,checkDownline:4,createVoucher:4}}},fees:{trading:{tierBased:!1,percentage:!0,maker:0,taker:.003}},exceptions:{exact:{invalid_pair:c,"Insufficient balance.":n,"invalid order.":h,"Invalid credentials. API not found or session has expired.":d,"Invalid credentials. Bad sign.":d},broad:{"Minimum price":o,"Minimum order":o}},options:{recvWindow:5e3,timeDifference:0,adjustForTimeDifference:!1},commonCurrencies:{STR:"XLM",BCHABC:"BCH",BCHSV:"BSV",DRK:"DASH",NEM:"XEM"},precisionMode:l})}nonce(){return this.milliseconds()-this.options.timeDifference}async fetchTime(e={}){const t=await this.publicGetServerTime(e);return this.safeInteger(t,"server_time")}async fetchMarkets(e={}){const t=await this.publicGetPairs(e),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"ticker_id"),a=this.safeString(s,"traded_currency"),n=this.safeString(s,"base_currency"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=this.safeInteger(s,"is_maintenance");i.push({id:r,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:!d,contract:!1,linear:void 0,inverse:void 0,taker:this.safeNumber(s,"trade_fee_percent"),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,percentage:!0,precision:{amount:this.parseNumber("1e-8"),price:this.parseNumber(this.parsePrecision(this.safeString(s,"price_round"))),cost:this.parseNumber(this.parsePrecision(this.safeString(s,"volume_precision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(s,"trade_min_traded_currency"),max:void 0},price:{min:this.safeNumber(s,"trade_min_base_currency"),max:void 0},cost:{min:void 0,max:void 0}},info:s})}return i}parseBalance(e){const t=this.safeValue(e,"return",{}),i=this.safeValue(t,"balance",{}),s=this.safeValue(t,"balance_hold",{}),r=this.safeTimestamp(t,"server_time"),a={info:e,timestamp:r,datetime:this.iso8601(r)},n=Object.keys(i);for(let e=0;e<n.length;e++){const t=n[e],r=this.safeCurrencyCode(t),o=this.account();o.free=this.safeString(i,t),o.used=this.safeString(s,t),a[r]=o}return this.safeBalance(a)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostGetInfo(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={pair:s.id},a=await this.publicGetPairDepth(this.extend(r,i));return this.parseOrderBook(a,s.symbol,void 0,"buy","sell")}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.safeTimestamp(e,"server_time"),r="vol_"+t.baseId.toLowerCase(),a="vol_"+t.quoteId.toLowerCase(),n=this.safeString(e,"last");return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"buy"),bidVolume:void 0,ask:this.safeString(e,"sell"),askVolume:void 0,vwap:void 0,open:void 0,close:n,last:n,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,r),quoteVolume:this.safeString(e,a),info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={pair:i.id},r=await this.publicGetPairTicker(this.extend(s,t)),a=this.safeValue(r,"ticker",{});return this.parseTicker(a,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetTickerAll(t),s=this.safeValue(i,"tickers");return this.parseTickers(s,e)}parseTrade(e,t){const i=this.safeTimestamp(e,"date");return this.safeTrade({id:this.safeString(e,"tid"),info:e,timestamp:i,datetime:this.iso8601(i),symbol:this.safeSymbol(void 0,t),type:void 0,side:this.safeString(e,"type"),order:void 0,takerOrMaker:void 0,price:this.safeString(e,"price"),amount:this.safeString(e,"amount"),cost:void 0,fee:void 0},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pair:r.id},n=await this.publicGetPairTrades(this.extend(a,s));return this.parseTrades(n,r,t,i)}parseOrderStatus(e){return this.safeString({open:"open",filled:"closed",cancelled:"canceled"},e,e)}parseOrder(e,t){let i;"type"in e&&(i=e.type);const s=this.parseOrderStatus(this.safeString(e,"status","open"));let r,a;const n=this.safeString(e,"price");let o,h;if(void 0!==t){r=t.symbol;let i=t.quoteId,s=t.baseId;"idr"===t.quoteId&&"order_rp"in e&&(i="rp"),"idr"===t.baseId&&"remain_rp"in e&&(s="rp"),a=this.safeString(e,"order_"+i),a||(o=this.safeString(e,"order_"+s),h=this.safeString(e,"remain_"+s))}const d=this.safeInteger(e,"submit_time"),c=this.safeString(e,"order_id");return this.safeOrder({info:e,id:c,clientOrderId:void 0,timestamp:d,datetime:this.iso8601(d),lastTradeTimestamp:void 0,symbol:r,type:"limit",timeInForce:void 0,postOnly:void 0,side:i,price:n,stopPrice:void 0,triggerPrice:void 0,cost:a,average:void 0,amount:o,filled:void 0,remaining:h,status:s,fee:undefined,trades:void 0})}async fetchOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" fetchOrder() requires a symbol");await this.loadMarkets();const s=this.market(t),r={pair:s.id,order_id:e},n=await this.privatePostGetOrder(this.extend(r,i)),o=n.return,h=this.parseOrder(this.extend({id:e},o.order),s);return this.extend({info:n},h)}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.pair=r.id);const n=(await this.privatePostOpenOrders(this.extend(a,s))).return.orders;if(!n)return[];if(void 0!==e)return this.parseOrders(n,r,t,i);const o=Object.keys(n);let h=[];for(let e=0;e<o.length;e++){const s=o[e],a=n[s];r=this.safeMarket(s);const d=this.parseOrders(a,r,t,i);h=this.arrayConcat(h,d)}return h}async fetchClosedOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchClosedOrders() requires a symbol argument");await this.loadMarkets();const r={};let n;void 0!==e&&(n=this.market(e),e=n.symbol,r.pair=n.id);const o=await this.privatePostOrderHistory(this.extend(r,s));let h=this.parseOrders(o.return.orders,n);return h=this.filterBy(h,"status","closed"),this.filterBySymbolSinceLimit(h,e,t,i)}async createOrder(e,t,i,s,a,n={}){if("limit"!==t)throw new r(this.id+" createOrder() allows limit orders only");await this.loadMarkets();const o=this.market(e),h={pair:o.id,type:i,price:a},d=o.baseId;"buy"===i?h[o.quoteId]=s*a:h[o.baseId]=s,h[d]=s;const c=await this.privatePostTrade(this.extend(h,n)),l=this.safeValue(c,"return",{});return{info:c,id:this.safeString(l,"order_id")}}async cancelOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" cancelOrder() requires a symbol argument");const s=this.safeValue(i,"side");if(void 0===s)throw new a(this.id+' cancelOrder() requires an extra "side" param');await this.loadMarkets();const r={order_id:e,pair:this.market(t).id,type:s};return await this.privatePostCancelOrder(this.extend(r,i))}async fetchTransactionFee(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},r=await this.privatePostWithdrawFee(this.extend(s,t)),a=this.safeValue(r,"return",{}),n=this.safeString(a,"currency");return{info:r,rate:this.safeNumber(a,"withdraw_fee"),currency:this.safeCurrencyCode(n,i)}}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();const r={};if(void 0!==t){const e=this.iso8601(t).slice(0,10);r.start=e,r.end=this.iso8601(this.milliseconds()).slice(0,10)}const a=await this.privatePostTransHistory(this.extend(r,s)),n=this.safeValue(a,"return",{}),o=this.safeValue(n,"withdraw",{}),h=this.safeValue(n,"deposit",{});let d,c=[];if(void 0===e){let e=Object.keys(o);for(let t=0;t<e.length;t++){const i=e[t];c=this.arrayConcat(c,o[i])}e=Object.keys(h);for(let t=0;t<e.length;t++){const i=e[t];c=this.arrayConcat(c,h[i])}}else{d=this.currency(e);const t=this.safeValue(o,d.id,[]),i=this.safeValue(h,d.id,[]);c=this.arrayConcat(t,i)}return this.parseTransactions(c,d,t,i)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n=this.milliseconds(),o={currency:a.id,withdraw_amount:t,withdraw_address:i,request_id:n.toString()};s&&(o.withdraw_memo=s);const h=await this.privatePostWithdrawCoin(this.extend(o,r));return this.parseTransaction(h,a)}parseTransaction(e,t){const i=this.safeString(e,"status"),s=this.safeTimestamp2(e,"success_time","submit_time"),r=this.safeString(e,"deposit_id"),a=this.safeNumber(e,"fee");let n;return void 0!==a&&(n={currency:this.safeCurrencyCode(void 0,t),cost:a,rate:void 0}),{id:this.safeString2(e,"withdraw_id","deposit_id"),txid:this.safeString2(e,"txid","tx"),timestamp:s,datetime:this.iso8601(s),network:void 0,addressFrom:void 0,address:this.safeString(e,"withdraw_address"),addressTo:void 0,amount:this.safeNumberN(e,["amount","withdraw_amount","deposit_amount"]),type:void 0===r?"withdraw":"deposit",currency:this.safeCurrencyCode(void 0,t),status:this.parseTransactionStatus(i),updated:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,comment:this.safeString(e,"withdraw_memo"),fee:n,info:e}}parseTransactionStatus(e){return this.safeString({success:"ok"},e,e)}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t];return"public"===t?n+="/"+this.implodeParams(e,s):(this.checkRequiredCredentials(),a=this.urlencode(this.extend({method:e,timestamp:this.nonce(),recvWindow:this.options.recvWindow},s)),r={"Content-Type":"application/x-www-form-urlencoded",Key:this.apiKey,Sign:this.hmac(this.encode(a),this.encode(this.secret),"sha512")}),{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;if(Array.isArray(o))return;const c=this.safeValue(o,"error","");if(!("success"in o)&&""===c)return;if(1===this.safeInteger(o,"success",0)){if("return"in o)return;throw new r(this.id+": malformed response: "+this.json(o))}const l=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,c,l),this.throwBroadlyMatchedException(this.exceptions.broad,c,l),new r(l)}}},21431:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,AuthenticationError:a,ArgumentsRequired:n}=i(73449),{TICK_SIZE:o}=i(62115),h=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"itbit",name:"itBit",countries:["US"],rateLimit:2e3,version:"v1",has:{CORS:!0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createMarketOrder:!1,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransactions:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1},urls:{logo:"https://user-images.githubusercontent.com/1294454/27822159-66153620-60ad-11e7-89e7-005f6d7f3de0.jpg",api:{rest:"https://api.itbit.com"},www:"https://www.itbit.com",doc:["https://api.itbit.com/docs","https://www.itbit.com/api"]},api:{public:{get:["markets/{symbol}/ticker","markets/{symbol}/order_book","markets/{symbol}/trades"]},private:{get:["wallets","wallets/{walletId}","wallets/{walletId}/balances/{currencyCode}","wallets/{walletId}/funding_history","wallets/{walletId}/trades","wallets/{walletId}/orders","wallets/{walletId}/orders/{id}"],post:["wallet_transfers","wallets","wallets/{walletId}/cryptocurrency_deposits","wallets/{walletId}/cryptocurrency_withdrawals","wallets/{walletId}/orders","wire_withdrawal"],delete:["wallets/{walletId}/orders/{id}"]}},markets:{"BTC/USD":{id:"XBTUSD",symbol:"BTC/USD",base:"BTC",quote:"USD",baseId:"XBT",quoteId:"USD",type:"spot",spot:!0},"BTC/SGD":{id:"XBTSGD",symbol:"BTC/SGD",base:"BTC",quote:"SGD",baseId:"XBT",quoteId:"SGD",type:"spot",spot:!0},"BTC/EUR":{id:"XBTEUR",symbol:"BTC/EUR",base:"BTC",quote:"EUR",baseId:"XBT",quoteId:"EUR",type:"spot",spot:!0},"ETH/USD":{id:"ETHUSD",symbol:"ETH/USD",base:"ETH",quote:"USD",baseId:"ETH",quoteId:"USD",type:"spot",spot:!0},"ETH/EUR":{id:"ETHEUR",symbol:"ETH/EUR",base:"ETH",quote:"EUR",baseId:"ETH",quoteId:"EUR",type:"spot",spot:!0},"ETH/SGD":{id:"ETHSGD",symbol:"ETH/SGD",base:"ETH",quote:"SGD",baseId:"ETH",quoteId:"SGD",type:"spot",spot:!0},PAXGUSD:{id:"PAXGUSD",symbol:"PAXG/USD",base:"PAXG",quote:"USD",baseId:"PAXG",quoteId:"USD",type:"spot",spot:!0},BCHUSD:{id:"BCHUSD",symbol:"BCH/USD",base:"BCH",quote:"USD",baseId:"BCH",quoteId:"USD",type:"spot",spot:!0},LTCUSD:{id:"LTCUSD",symbol:"LTC/USD",base:"LTC",quote:"USD",baseId:"LTC",quoteId:"USD",type:"spot",spot:!0}},fees:{trading:{maker:this.parseNumber("-0.0003"),taker:this.parseNumber("0.0035")}},commonCurrencies:{XBT:"BTC"},precisionMode:o})}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id},a=await this.publicGetMarketsSymbolOrderBook(this.extend(r,i));return this.parseOrderBook(a,s.symbol)}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.safeString(e,"serverTimeUTC");if(!s)throw new r(this.id+" fetchTicker() returned a bad response: "+this.json(e));const a=this.parse8601(s),n=this.safeString(e,"vwap24h"),o=this.safeString(e,"volume24h"),d=h.stringMul(o,n),c=this.safeString(e,"lastPrice");return this.safeTicker({symbol:i,timestamp:a,datetime:this.iso8601(a),high:this.safeString(e,"high24h"),low:this.safeString(e,"low24h"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:n,open:this.safeString(e,"openToday"),close:c,last:c,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:o,quoteVolume:d,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetMarketsSymbolTicker(this.extend(s,t));return this.parseTicker(r,i)}parseTrade(e,t){const i=this.safeString2(e,"executionId","matchNumber"),s=this.parse8601(this.safeString(e,"timestamp")),r=this.safeString(e,"direction"),a=this.safeString(e,"orderId");let n=this.safeNumber(e,"commissionPaid");const o=this.safeString(e,"commissionCurrency"),d=this.safeCurrencyCode(o);let c=this.safeNumber(e,"rebatesApplied");void 0!==c&&(c=-c);const l=this.safeString(e,"rebateCurrency"),u=this.safeCurrencyCode(l),f=this.safeString2(e,"price","rate"),p=this.safeString2(e,"currency1Amount","amount"),m=this.parseNumber(f),g=this.parseNumber(p),y=this.parseNumber(h.stringMul(f,p));let b;if(void 0!==this.safeString(e,"instrument")){const t=this.safeString(e,"currency1"),i=this.safeString(e,"currency2");b=this.safeCurrencyCode(t)+"/"+this.safeCurrencyCode(i)}const v={info:e,id:i,timestamp:s,datetime:this.iso8601(s),symbol:b,order:a,type:void 0,side:r,takerOrMaker:void 0,price:m,amount:g,cost:y,fee:void 0};return void 0!==n&&(void 0!==c?d===u?(n=this.sum(n,c),v.fee={cost:n,currency:d}):v.fees=[{cost:n,currency:d},{cost:c,currency:u}]:v.fee={cost:n,currency:d}),"fee"in v||"fees"in v||(v.fee=void 0),v}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();const r=this.safeString(s,"walletId");if(void 0===r)throw new n(this.id+" fetchTransactions() requires a walletId parameter");const a={walletId:r};void 0!==i&&(a.perPage=i);const o=(await this.privateGetWalletsWalletIdFundingHistory(this.extend(a,s))).fundingHistory,h=[];for(let e=0;e<o.length;e++){const t=o[e],i=this.safeString(t,"time"),s=this.parse8601(i),r=this.safeString(t,"currency"),a=this.safeString(t,"destinationAddress"),n=this.safeString(t,"txnHash"),d=this.safeStringLower(t,"transactionType"),c=this.safeString(t,"status"),l=this.parseTransferStatus(c);h.push({id:this.safeString(t,"withdrawalId"),timestamp:s,datetime:this.iso8601(s),currency:this.safeCurrencyCode(r),address:a,tag:void 0,txid:n,type:d,status:l,amount:this.safeNumber(t,"amount"),fee:void 0,info:t})}return h}parseTransferStatus(e){return this.safeString({cancelled:"canceled",completed:"ok"},e,"pending")}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const a=this.safeString(s,"walletId");if(void 0===a)throw new r(this.id+" fetchMyTrades() requires a walletId parameter");const n={walletId:a};void 0!==t&&(n.rangeStart=this.ymdhms(t,"T")),void 0!==i&&(n.perPage=i);const o=await this.privateGetWalletsWalletIdTrades(this.extend(n,s)),h=this.safeValue(o,"tradingHistory",[]);let d;return void 0!==e&&(d=this.market(e)),this.parseTrades(h,d,t,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id},n=await this.publicGetMarketsSymbolTrades(this.extend(a,s)),o=this.safeValue(n,"recentTrades",[]);return this.parseTrades(o,r,t,i)}parseBalance(e){const t=e[0].balances,i={info:e};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"availableBalance"),n.total=this.safeString(s,"totalBalance"),i[a]=n}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.fetchWallets(e);return this.parseBalance(t)}async fetchWallets(e={}){if(await this.loadMarkets(),!this.uid)throw new a(this.id+" fetchWallets() requires uid API credential");const t={userId:this.uid};return await this.privateGetWallets(this.extend(t,e))}async fetchWallet(e,t={}){await this.loadMarkets();const i={walletId:e};return await this.privateGetWalletsWalletId(this.extend(i,t))}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({status:"open"},s))}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({status:"filled"},s))}async fetchOrders(e,t,i,s={}){let a;await this.loadMarkets(),void 0!==e&&(a=this.market(e));if(!("walletId"in s))throw new r(this.id+" fetchOrders() requires a walletId parameter");const n={walletId:s.walletId},o=await this.privateGetWalletsWalletIdOrders(this.extend(n,s));return this.parseOrders(o,a,t,i)}parseOrderStatus(e){return this.safeString({submitted:"open",open:"open",filled:"closed",cancelled:"canceled",rejected:"canceled"},e,e)}parseOrder(e,t){const i=this.safeString(e,"side"),s=this.safeString(e,"type"),r=this.safeString(e,"instrument"),a=this.safeSymbol(r,t),n=this.safeString(e,"createdTime"),o=this.parse8601(n),h=this.safeString(e,"amount"),d=this.safeString(e,"amountFilled"),c=this.safeString(e,"price"),l=this.safeString(e,"volumeWeightedAveragePrice"),u=this.safeString(e,"clientOrderIdentifier"),f=this.safeString(e,"id"),p="True"===this.safeString(e,"postOnly");return this.safeOrder({id:f,clientOrderId:u,info:e,timestamp:o,datetime:this.iso8601(o),lastTradeTimestamp:void 0,status:this.parseOrderStatus(this.safeString(e,"status")),symbol:a,type:s,timeInForce:void 0,postOnly:p,side:i,price:c,stopPrice:void 0,triggerPrice:void 0,cost:void 0,average:l,amount:h,filled:d,remaining:void 0,fee:undefined,trades:void 0},t)}nonce(){return this.milliseconds()}async createOrder(e,t,i,s,a,n={}){if(await this.loadMarkets(),"market"===t)throw new r(this.id+" createOrder() allows limit orders only");if(!("walletId"in n))throw new r(this.id+" createOrder() requires a walletId parameter");s=s.toString(),a=a.toString();const o=this.market(e),h={side:i,type:t,currency:o.id.replace(o.quote,""),amount:s,display:s,price:a,instrument:o.id},d=await this.privatePostWalletsWalletIdOrders(this.extend(h,n));return{info:d,id:d.id}}async fetchOrder(e,t,i={}){await this.loadMarkets();if(!("walletId"in i))throw new r(this.id+" fetchOrder() requires a walletId parameter");const s={id:e},a=await this.privateGetWalletsWalletIdOrdersId(this.extend(s,i));return this.parseOrder(a)}async cancelOrder(e,t,i={}){if(!("walletId"in i))throw new r(this.id+" cancelOrder() requires a walletId parameter");const s={id:e};return await this.privateDeleteWalletsWalletIdOrdersId(this.extend(s,i))}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+this.version+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if("GET"===i&&Object.keys(o).length&&(n+="?"+this.urlencode(o)),"POST"===i&&Object.keys(o).length&&(a=this.json(o)),"private"===t){this.checkRequiredCredentials();const e=this.nonce().toString(),t=e,s=[i,n,"POST"===i?a:"",e,t],o=e+this.json(s).replace("\\/","/"),h=this.hash(this.encode(o),"sha256","binary"),d=this.stringToBinary(this.encode(n)),c=this.binaryConcat(d,h),l=this.hmac(c,this.encode(this.secret),"sha512","base64");r={Authorization:this.apiKey+":"+l,"Content-Type":"application/json","X-Auth-Timestamp":t,"X-Auth-Nonce":e}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;if(void 0!==this.safeString(o,"code"))throw new r(this.id+" "+this.json(o))}}},66594:function(e,t,i){"use strict";const s=i(48819),{BadSymbol:r,BadRequest:a,ExchangeNotAvailable:n,ArgumentsRequired:o,NotSupported:h,PermissionDenied:d,AuthenticationError:c,ExchangeError:l,OrderNotFound:u,DDoSProtection:f,InvalidNonce:p,InsufficientFunds:m,CancelPending:g,InvalidOrder:y,InvalidAddress:b,RateLimitExceeded:v,OnMaintenance:w,AccountSuspended:S}=i(73449),{TRUNCATE:k,TICK_SIZE:T}=i(62115),_=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"kraken",name:"Kraken",countries:["US"],version:"0",rateLimit:1e3,certified:!1,pro:!0,has:{CORS:void 0,spot:!0,margin:!0,swap:!1,future:!1,option:!1,addMargin:!1,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:!0,createDepositAddress:!0,createOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,editOrder:!0,fetchBalance:!0,fetchBorrowInterest:!1,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLedger:!0,fetchLedgerEntry:!0,fetchLeverageTiers:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderTrades:"emulated",fetchPositions:!0,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!1,fetchWithdrawals:!0,setLeverage:!1,setMarginMode:!1,withdraw:!0},timeframes:{"1m":1,"5m":5,"15m":15,"30m":30,"1h":60,"4h":240,"1d":1440,"1w":10080,"2w":21600},urls:{logo:"https://user-images.githubusercontent.com/51840849/76173629-fc67fb00-61b1-11ea-84fe-f2de582f58a3.jpg",api:{public:"https://api.kraken.com",private:"https://api.kraken.com",zendesk:"https://kraken.zendesk.com/api/v2/help_center/en-us/articles"},www:"https://www.kraken.com",doc:"https://www.kraken.com/features/api",fees:"https://www.kraken.com/en-us/features/fee-schedule"},fees:{trading:{tierBased:!0,percentage:!0,taker:this.parseNumber("0.0026"),maker:this.parseNumber("0.0016"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.0026")],[this.parseNumber("50000"),this.parseNumber("0.0024")],[this.parseNumber("100000"),this.parseNumber("0.0022")],[this.parseNumber("250000"),this.parseNumber("0.0020")],[this.parseNumber("500000"),this.parseNumber("0.0018")],[this.parseNumber("1000000"),this.parseNumber("0.0016")],[this.parseNumber("2500000"),this.parseNumber("0.0014")],[this.parseNumber("5000000"),this.parseNumber("0.0012")],[this.parseNumber("10000000"),this.parseNumber("0.0001")]],maker:[[this.parseNumber("0"),this.parseNumber("0.0016")],[this.parseNumber("50000"),this.parseNumber("0.0014")],[this.parseNumber("100000"),this.parseNumber("0.0012")],[this.parseNumber("250000"),this.parseNumber("0.0010")],[this.parseNumber("500000"),this.parseNumber("0.0008")],[this.parseNumber("1000000"),this.parseNumber("0.0006")],[this.parseNumber("2500000"),this.parseNumber("0.0004")],[this.parseNumber("5000000"),this.parseNumber("0.0002")],[this.parseNumber("10000000"),this.parseNumber("0.0")]]}}},handleContentTypeApplicationZip:!0,api:{zendesk:{get:["360000292886","201893608"]},public:{get:{Assets:1,AssetPairs:1,Depth:1,OHLC:1,Spread:1,Ticker:1,Time:1,Trades:1}},private:{post:{AddOrder:0,AddOrderBatch:0,AddExport:3,Balance:3,CancelAll:3,CancelOrder:0,CancelOrderBatch:0,ClosedOrders:6,DepositAddresses:3,DepositMethods:3,DepositStatus:3,EditOrder:0,ExportStatus:3,GetWebSocketsToken:3,Ledgers:6,OpenOrders:3,OpenPositions:3,QueryLedgers:3,QueryOrders:3,QueryTrades:3,RetrieveExport:3,RemoveExport:3,TradeBalance:3,TradesHistory:6,TradeVolume:3,Withdraw:3,WithdrawCancel:3,WithdrawInfo:3,WithdrawStatus:3,Stake:3,Unstake:3,"Staking/Assets":3,"Staking/Pending":3,"Staking/Transactions":3}}},commonCurrencies:{LUNA:"LUNC",LUNA2:"LUNA",REPV2:"REP",REP:"REPV1",UST:"USTC",XBT:"BTC","XBT.M":"BTC.M",XDG:"DOGE"},options:{marketsByAltname:{},delistedMarketsById:{},inactiveCurrencies:["CAD","USD","JPY","GBP"],networks:{ETH:"ERC20",TRX:"TRC20"},depositMethods:{"1INCH":"1inch (1INCH)",AAVE:"Aave",ADA:"ADA",ALGO:"Algorand",ANKR:"ANKR (ANKR)",ANT:"Aragon (ANT)",ATOM:"Cosmos",AXS:"Axie Infinity Shards (AXS)",BADGER:"Bager DAO (BADGER)",BAL:"Balancer (BAL)",BAND:"Band Protocol (BAND)",BAT:"BAT",BCH:"Bitcoin Cash",BNC:"Bifrost (BNC)",BNT:"Bancor (BNT)",BTC:"Bitcoin",CHZ:"Chiliz (CHZ)",COMP:"Compound (COMP)",CQT:"\tCovalent Query Token (CQT)",CRV:"Curve DAO Token (CRV)",CTSI:"Cartesi (CTSI)",DAI:"Dai",DASH:"Dash",DOGE:"Dogecoin",DOT:"Polkadot",DYDX:"dYdX (DYDX)",ENJ:"Enjin Coin (ENJ)",EOS:"EOS",ETC:"Ether Classic (Hex)",ETH:"Ether (Hex)",EWT:"Energy Web Token",FEE:"Kraken Fee Credit",FIL:"Filecoin",FLOW:"Flow",GHST:"Aavegotchi (GHST)",GNO:"GNO",GRT:"GRT",ICX:"Icon",INJ:"Injective Protocol (INJ)",KAR:"Karura (KAR)",KAVA:"Kava",KEEP:"Keep Token (KEEP)",KNC:"Kyber Network (KNC)",KSM:"Kusama",LINK:"Link",LPT:"Livepeer Token (LPT)",LRC:"Loopring (LRC)",LSK:"Lisk",LTC:"Litecoin",MANA:"MANA",MATIC:"Polygon (MATIC)",MINA:"Mina",MIR:"Mirror Protocol (MIR)",MKR:"Maker (MKR)",MLN:"MLN",MOVR:"Moonriver (MOVR)",NANO:"NANO",OCEAN:"OCEAN",OGN:"Origin Protocol (OGN)",OMG:"OMG",OXT:"Orchid (OXT)",OXY:"Oxygen (OXY)",PAXG:"PAX (Gold)",PERP:"Perpetual Protocol (PERP)",PHA:"Phala (PHA)",QTUM:"QTUM",RARI:"Rarible (RARI)",RAY:"Raydium (RAY)",REN:"Ren Protocol (REN)",REP:"REPv2",REPV1:"REP",SAND:"The Sandbox (SAND)",SC:"Siacoin",SDN:"Shiden (SDN)",SOL:"Solana",SNX:"Synthetix  Network (SNX)",SRM:"Serum",STORJ:"Storj (STORJ)",SUSHI:"Sushiswap (SUSHI)",TBTC:"tBTC",TRX:"Tron",UNI:"UNI",USDC:"USDC",USDT:"Tether USD (ERC20)","USDT-TRC20":"Tether USD (TRC20)",WAVES:"Waves",WBTC:"Wrapped Bitcoin (WBTC)",XLM:"Stellar XLM",XMR:"Monero",XRP:"Ripple XRP",XTZ:"XTZ",YFI:"YFI",ZEC:"Zcash (Transparent)",ZRX:"0x (ZRX)"}},precisionMode:T,exceptions:{"EQuery:Invalid asset pair":r,"EAPI:Invalid key":c,"EFunding:Unknown withdraw key":b,"EFunding:Invalid amount":m,"EService:Unavailable":n,"EDatabase:Internal error":n,"EService:Busy":n,"EQuery:Unknown asset":r,"EAPI:Rate limit exceeded":f,"EOrder:Rate limit exceeded":f,"EGeneral:Internal error":n,"EGeneral:Temporary lockout":f,"EGeneral:Permission denied":d,"EOrder:Unknown order":y,"EOrder:Order minimum not met":y,"EGeneral:Invalid arguments":a,"ESession:Invalid session":c,"EAPI:Invalid nonce":p,"EFunding:No funding method":a,"EFunding:Unknown asset":r,"EService:Market in post_only mode":w,"EGeneral:Too many requests":f,"ETrade:User Locked":S}})}feeToPrecision(e,t){return this.decimalToPrecision(t,k,this.markets[e].precision.amount,this.precisionMode)}async fetchMarkets(e={}){const t=await this.publicGetAssetPairs(e),i=this.safeValue(t,"result",{}),s=Object.keys(i);let r=[];for(let e=0;e<s.length;e++){const t=s[e],a=i[t],n=this.safeString(a,"base"),o=this.safeString(a,"quote"),h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o),c=t.indexOf(".d")>=0,l=this.safeString(a,"altname"),u=this.safeValue(a,"fees_maker",[]),f=this.safeValue(u,0,[]),p=this.safeString(f,1);let m;void 0!==p&&(m=this.parseNumber(_.stringDiv(p,"100")));const g=this.safeValue(a,"fees",[]),y=this.safeValue(g,0,[]),b=this.safeString(y,1);let v;void 0!==b&&(v=this.parseNumber(_.stringDiv(b,"100")));const w=this.safeValue(a,"leverage_buy",[]),S=w.length,k=this.parseNumber(this.parsePrecision(this.safeString(a,"pair_decimals")));r.push({id:t,symbol:c?l:h+"/"+d,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,darkpool:c,altname:a.altname,type:"spot",spot:!0,margin:S>0,swap:!1,future:!1,option:!1,active:!0,contract:!1,linear:void 0,inverse:void 0,taker:v,maker:m,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(a,"lot_decimals"))),price:k},limits:{leverage:{min:this.parseNumber("1"),max:this.safeNumber(w,S-1,1)},amount:{min:this.safeNumber(a,"ordermin"),max:void 0},price:{min:k,max:void 0},cost:{min:void 0,max:void 0}},info:a})}return r=this.appendInactiveMarkets(r),this.options.marketsByAltname=this.indexBy(r,"altname"),r}safeCurrency(e,t){if(void 0!==e&&e.length>3&&(0===e.indexOf("X")||0===e.indexOf("Z"))){if(e.indexOf(".")>0)return super.safeCurrency(e,t);e=e.slice(1)}return super.safeCurrency(e,t)}appendInactiveMarkets(e){const t={amount:this.parseNumber("1e-8"),price:this.parseNumber("1e-8")},i={darkpool:!1,info:void 0,maker:void 0,taker:void 0,active:!1,precision:t,limits:{amount:{min:t.amount,max:void 0},price:{min:t.price,max:void 0},cost:{min:void 0,max:void 0}}},s=[];for(let t=0;t<s.length;t++)e.push(this.extend(i,s[t]));return e}async fetchCurrencies(e={}){const t=await this.publicGetAssets(e),i=this.safeValue(t,"result",{}),s=Object.keys(i),r={};for(let e=0;e<s.length;e++){const t=s[e],a=i[t],n=this.safeCurrencyCode(this.safeString(a,"altname")),o=this.parseNumber(this.parsePrecision(this.safeString(a,"decimals"))),h=!this.inArray(n,this.options.inactiveCurrencies);r[n]={id:t,code:n,info:a,name:n,active:h,deposit:void 0,withdraw:void 0,fee:void 0,precision:o,limits:{amount:{min:o,max:void 0},withdraw:{min:void 0,max:void 0}}}}return r}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={pair:i.id,"fee-info":!0},r=await this.privatePostTradeVolume(this.extend(s,t)),a=this.safeValue(r,"result",{});return this.parseTradingFee(a,i)}parseTradingFee(e,t){const i=this.safeValue(e,"fees_maker",{}),s=this.safeValue(e,"fees",{}),r=this.safeValue(i,t.id,{}),a=this.safeValue(s,t.id,{});return{info:e,symbol:t.symbol,maker:this.safeNumber(r,"fee"),taker:this.safeNumber(a,"fee"),percentage:!0,tierBased:!0}}parseBidAsk(e,t=0,i=1){return[this.safeNumber(e,t),this.safeNumber(e,i),this.safeInteger(e,2)]}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);if(s.darkpool)throw new l(this.id+" fetchOrderBook() does not provide an order book for darkpool symbol "+e);const r={pair:s.id};void 0!==t&&(r.count=t);const a=await this.publicGetDepth(this.extend(r,i)),n=this.safeValue(a,"result",{});let o=this.safeValue(n,s.id);const h=this.safeValue(s,"info",{}),d=this.safeValue(h,"wsname");return void 0!==d&&(o=this.safeValue(n,d,o)),this.parseOrderBook(o,e)}parseTicker(e,t){const i=this.milliseconds(),s=this.safeSymbol(void 0,t),r=this.safeValue(e,"v",[]),a=this.safeString(r,1),n=this.safeValue(e,"p",[]),o=this.safeString(n,1),h=_.stringMul(a,o),d=this.safeValue(e,"c",[]),c=this.safeString(d,0),l=this.safeValue(e,"h",[]),u=this.safeValue(e,"l",[]),f=this.safeValue(e,"b",[]),p=this.safeValue(e,"a",[]);return this.safeTicker({symbol:s,timestamp:i,datetime:this.iso8601(i),high:this.safeString(l,1),low:this.safeString(u,1),bid:this.safeString(f,0),bidVolume:void 0,ask:this.safeString(p,0),askVolume:void 0,vwap:o,open:this.safeString(e,"o"),close:c,last:c,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:a,quoteVolume:h,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets();const i={};if(void 0!==e){e=this.marketSymbols(e);const t=[];for(let i=0;i<e.length;i++){const s=e[i],r=this.markets[s];r.active&&!r.darkpool&&t.push(r.id)}i.pair=t.join(",")}const s=(await this.publicGetTicker(this.extend(i,t))).result,r=Object.keys(s),a={};for(let e=0;e<r.length;e++){const t=r[e],i=this.safeMarket(t),n=i.symbol,o=s[t];a[n]=this.parseTicker(o,i)}return this.filterByArray(a,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();if(e.indexOf(".d")>=0)throw new l(this.id+" fetchTicker() does not provide a ticker for darkpool symbol "+e);const i=this.market(e),s={pair:i.id},r=(await this.publicGetTicker(this.extend(s,t))).result[i.id];return this.parseTicker(r,i)}parseOHLCV(e,t){return[this.safeTimestamp(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,6)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={pair:a.id,interval:this.safeInteger(this.timeframes,t,t)};void 0!==i&&(n.since=parseInt((i-1)/1e3));const o=await this.publicGetOHLC(this.extend(n,r)),h=this.safeValue(o,"result",{}),d=this.safeValue(h,a.id,[]);return this.parseOHLCVs(d,a,t,i,s)}parseLedgerEntryType(e){return this.safeString({trade:"trade",withdrawal:"transaction",deposit:"transaction",transfer:"transfer",margin:"margin"},e,e)}parseLedgerEntry(e,t){const i=this.safeString(e,"id");let s;const r=this.safeString(e,"refid"),a=this.parseLedgerEntryType(this.safeString(e,"type")),n=this.safeCurrencyCode(this.safeString(e,"asset"),t);let o=this.safeString(e,"amount");_.stringLt(o,"0")?(s="out",o=_.stringAbs(o)):s="in";const h=this.safeNumber(e,"time");let d;return void 0!==h&&(d=parseInt(1e3*h)),{info:e,id:i,direction:s,account:undefined,referenceId:r,referenceAccount:undefined,type:a,currency:n,amount:this.parseNumber(o),before:void 0,after:this.safeNumber(e,"balance"),status:"ok",timestamp:d,datetime:this.iso8601(d),fee:{cost:this.safeNumber(e,"fee"),currency:n}}}async fetchLedger(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.asset=a.id),void 0!==t&&(r.start=parseInt(t/1e3));const n=await this.privatePostLedgers(this.extend(r,s)),o=this.safeValue(n,"result",{}),h=this.safeValue(o,"ledger",{}),d=Object.keys(h),c=[];for(let e=0;e<d.length;e++){const t=d[e],i=h[t];i.id=t,c.push(i)}return this.parseLedger(c,a,t,i)}async fetchLedgerEntriesByIds(e,t,i={}){await this.loadMarkets(),e=e.join(",");const s=this.extend({id:e},i),r=(await this.privatePostQueryLedgers(s)).result,a=Object.keys(r),n=[];for(let e=0;e<a.length;e++){const t=a[e],i=r[t];i.id=t,n.push(i)}return this.parseLedger(n)}async fetchLedgerEntry(e,t,i={}){return(await this.fetchLedgerEntriesByIds([e],t,i))[0]}parseTrade(e,t){let i,s,r,a,n,o,h,d,c;if(Array.isArray(e)){i=this.safeTimestamp(e,2),s="s"===e[3]?"sell":"buy",r="l"===e[4]?"limit":"market",a=this.safeString(e,0),n=this.safeString(e,1);e.length>6&&(o=this.safeString(e,6))}else if("string"==typeof e)o=e;else if("ordertxid"in e){const c=this.safeString(e,"pair"),l=this.findMarketByAltnameOrId(c);if(void 0!==l?t=l:void 0!==c&&(t=this.getDelistedMarketById(c)),h=this.safeString(e,"ordertxid"),o=this.safeString2(e,"id","postxid"),i=this.safeTimestamp(e,"time"),s=this.safeString(e,"type"),r=this.safeString(e,"ordertype"),a=this.safeString(e,"price"),n=this.safeString(e,"vol"),"fee"in e){let i;void 0!==t&&(i=t.quote),d={cost:this.safeString(e,"fee"),currency:i}}}void 0!==t&&(c=t.symbol);const l=this.safeString(e,"cost");return this.safeTrade({id:o,order:h,info:e,timestamp:i,datetime:this.iso8601(i),symbol:c,type:r,side:s,takerOrMaker:void 0,price:a,amount:n,cost:l,fee:d},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a=r.id,n={pair:a};if(void 0!==t&&(n.since=1e6*t,n.since=t.toString()+"000000"),void 0!==i&&1e3!==i){if(this.safeValue(this.options,"fetchTradesWarning",!0))throw new l(this.id+" fetchTrades() cannot serve "+i.toString()+" trades without breaking the pagination, see https://github.com/ccxt/ccxt/issues/5698 for more details. Set exchange.options['fetchTradesWarning'] to acknowledge this warning and silence it.")}const o=(await this.publicGetTrades(this.extend(n,s))).result,h=o[a],d=h.length;if(d<=0)return[];const c=h[d-1],u=this.safeString(o,"last");return c.push(u),this.parseTrades(h,r,t,i)}parseBalance(e){const t=this.safeValue(e,"result",{}),i={info:e,timestamp:void 0,datetime:void 0},s=Object.keys(t);for(let e=0;e<s.length;e++){const r=s[e],a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(t,r),i[a]=n}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostBalance(e);return this.parseBalance(t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n={pair:this.market(e).id,type:i,ordertype:t,volume:this.amountToPrecision(e,s)},o=this.orderRequest("createOrder()",e,t,n,r,a),h=await this.privatePostAddOrder(this.extend(o[0],o[1])),d=this.safeValue(h,"result");return this.parseOrder(d)}findMarketByAltnameOrId(e){const t=this.safeValue(this.options,"marketsByAltname",{});return e in t?t[e]:this.safeMarket(e)}getDelistedMarketById(e){if(void 0===e)return e;let t=this.safeValue(this.options.delistedMarketsById,e);if(void 0!==t)return t;let i=3,s=3,r=6;8===e.length?(i=4,s=4,r=8):7===e.length&&(i=4,s=4,r=7);const a=e.slice(0,i),n=e.slice(s,r),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n);return t={symbol:o+"/"+h,base:o,quote:h,baseId:a,quoteId:n},this.options.delistedMarketsById[e]=t,t}parseOrderStatus(e){return this.safeString({pending:"open",open:"open",closed:"closed",canceled:"canceled",expired:"expired"},e,e)}parseOrder(e,t){const i=this.safeValue(e,"descr",{}),s=this.safeString(i,"order");let r,a,n,o,h,d;if(void 0!==s){const e=s.split(" ");r=this.safeString(e,0),h=this.safeString(e,1),n=this.safeString(e,2),a=this.safeString(e,4),"stop"===a?(d=this.safeString(e,6),o=this.safeString(e,9)):"limit"===a&&(o=this.safeString(e,5))}r=this.safeString(i,"type",r),a=this.safeString(i,"ordertype",a),n=this.safeString(i,"pair",n);const c=this.findMarketByAltnameOrId(n);let l;void 0!==c?t=c:void 0!==n&&(t=this.getDelistedMarketById(n));const u=this.safeTimestamp(e,"opentm");h=this.safeString(e,"vol",h);const f=this.safeString(e,"vol_exec");let p;o=this.safeString(i,"price",o),(void 0===o||_.stringEquals(o,"0"))&&(o=this.safeString(i,"price2")),(void 0===o||_.stringEquals(o,"0"))&&(o=this.safeString(e,"price",o));const m=this.safeNumber(e,"price");if(void 0!==t&&(l=t.symbol,"fee"in e)){const i=e.oflags;p={cost:this.safeString(e,"fee"),rate:void 0},i.indexOf("fciq")>=0?p.currency=t.quote:i.indexOf("fcib")>=0&&(p.currency=t.base)}const g=this.parseOrderStatus(this.safeString(e,"status"));let y=this.safeString2(e,"id","txid");if(void 0===y||"["===y.slice(0,1)){const t=this.safeValue(e,"txid");y=this.safeString(t,0)}const b=this.safeString(e,"userref"),v=this.safeValue(e,"trades");return d=this.safeNumber(e,"stopprice",d),this.safeOrder({id:y,clientOrderId:b,info:e,timestamp:u,datetime:this.iso8601(u),lastTradeTimestamp:void 0,status:g,symbol:l,type:a,timeInForce:void 0,postOnly:void 0,side:r,price:o,stopPrice:d,triggerPrice:d,cost:void 0,amount:h,filled:f,average:m,remaining:void 0,fee:p,trades:v},t)}orderRequest(e,t,i,s,r,a={}){const n=this.safeString2(a,"userref","clientOrderId");if(a=this.omit(a,["userref","clientOrderId"]),void 0!==n&&(s.userref=n),"limit"===i)s.price=this.priceToPrecision(t,r);else if("stop-loss"===i||"take-profit"===i){const n=this.safeNumber2(a,"price","stopPrice",r);if(void 0===n)throw new o(this.id+e+" requires a price argument or a price/stopPrice parameter for a "+i+" order");s.price=this.priceToPrecision(t,n)}else if("stop-loss-limit"===i||"take-profit-limit"===i){const n=this.safeNumber2(a,"price","stopPrice"),h=this.safeNumber(a,"price2"),d=void 0!==n,c=void 0!==h;if(d&&c)s.price=this.priceToPrecision(t,n),s.price2=this.priceToPrecision(t,h);else{if(void 0===r||!d&&!c)throw new o(this.id+e+" requires a price argument and/or price/stopPrice/price2 parameters for a "+i+" order");d?(s.price=this.priceToPrecision(t,n),s.price2=this.priceToPrecision(t,r)):c&&(s.price=this.priceToPrecision(t,r),s.price2=this.priceToPrecision(t,h))}}let h=this.safeValue(a,"close");if(void 0!==h){h=this.extend({},h);const e=this.safeValue(h,"price");void 0!==e&&(h.price=this.priceToPrecision(t,e));const i=this.safeValue(h,"price2");void 0!==i&&(h.price2=this.priceToPrecision(t,i)),s.close=h}return[s,a=this.omit(a,["price","stopPrice","price2","close"])]}async editOrder(e,t,i,s,r,a,n={}){await this.loadMarkets();const o=this.market(t);if(!o.spot)throw new h(this.id+" editOrder() does not support "+o.type+" orders, only spot orders are accepted");const d={txid:e,pair:o.id};void 0!==r&&(d.volume=this.amountToPrecision(t,r));const c=this.orderRequest("editOrder()",t,i,d,a,n),l=await this.privatePostEditOrder(this.extend(c[0],c[1])),u=this.safeValue(l,"result",{});return this.parseOrder(u,o)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s=this.safeValue2(i,"userref","clientOrderId"),r={trades:!0};let a=i;void 0!==s?(r.userref=s,a=this.omit(i,["userref","clientOrderId"])):r.txid=e;const n=await this.privatePostQueryOrders(this.extend(r,a)),o=this.safeValue(n,"result",[]);if(!(e in o))throw new u(this.id+" fetchOrder() could not find order id "+e);const h=this.parseOrder(this.extend({id:e},o[e]));return this.extend({info:n},h)}async fetchOrderTrades(e,t,i,s,r={}){const a=this.safeValue(r,"trades"),n=[];if(void 0===a)throw new o(this.id+" fetchOrderTrades() requires a unified order structure in the params argument or a 'trades' param (an array of trade id strings)");for(let e=0;e<a.length;e++){const t=a[e];"string"==typeof t?n.push(t):n.push(t.id)}await this.loadMarkets(),void 0!==t&&(t=this.symbol(t));const h=this.safeValue(this.options,"fetchOrderTrades",{}),d=this.safeInteger(h,"batchSize",20),c=n.length;let l=parseInt(c/d);l=this.sum(l,1);let u=[];for(let e=0;e<l;e++){const r=[];for(let t=0;t<d;t++){const i=this.sum(e*d,t);i<c&&r.push(n[i])}const a={txid:r.join(",")},o=await this.privatePostQueryTrades(a),h=this.safeValue(o,"result"),l=Object.keys(h);for(let e=0;e<l.length;e++)h[l[e]].id=l[e];const f=this.parseTrades(h,void 0,i,s),p=this.filterBySymbol(f,t);u=this.arrayConcat(u,p)}return u}async fetchOrdersByIds(e,t,i={}){await this.loadMarkets();const s=await this.privatePostQueryOrders(this.extend({trades:!0,txid:e.join(",")},i)),r=this.safeValue(s,"result",{}),a=[],n=Object.keys(r);for(let e=0;e<n.length;e++){const t=n[e],i=r[t],s=this.parseOrder(this.extend({id:t},i));a.push(s)}return a}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};void 0!==t&&(r.start=parseInt(t/1e3));const a=(await this.privatePostTradesHistory(this.extend(r,s))).result.trades,n=Object.keys(a);for(let e=0;e<n.length;e++)a[n[e]].id=n[e];let o;return void 0!==e&&(o=this.market(e)),this.parseTrades(a,o,t,i)}async cancelOrder(e,t,i={}){let s;await this.loadMarkets();const r={txid:this.safeValue2(i,"userref","clientOrderId",e)};i=this.omit(i,["userref","clientOrderId"]);try{s=await this.privatePostCancelOrder(this.extend(r,i))}catch(e){if(this.last_http_response&&this.last_http_response.indexOf("EOrder:Unknown order")>=0)throw new u(this.id+" cancelOrder() error "+this.last_http_response);throw e}return s}async cancelOrders(e,t,i={}){const s={orders:e};return await this.privatePostCancelOrderBatch(this.extend(s,i))}async cancelAllOrders(e,t={}){return await this.loadMarkets(),await this.privatePostCancelAll(t)}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};void 0!==t&&(r.start=parseInt(t/1e3));let a=s;const n=this.safeValue2(s,"userref","clientOrderId");void 0!==n&&(r.userref=n,a=this.omit(s,["userref","clientOrderId"]));const o=await this.privatePostOpenOrders(this.extend(r,a));let h;void 0!==e&&(h=this.market(e));const d=this.safeValue(o,"result",{}),c=this.safeValue(d,"open",[]);return this.parseOrders(c,h,t,i)}async fetchClosedOrders(e,t,i,s={}){await this.loadMarkets();const r={};void 0!==t&&(r.start=parseInt(t/1e3));let a=s;const n=this.safeValue2(s,"userref","clientOrderId");void 0!==n&&(r.userref=n,a=this.omit(s,["userref","clientOrderId"]));const o=await this.privatePostClosedOrders(this.extend(r,a));let h;void 0!==e&&(h=this.market(e));const d=this.safeValue(o,"result",{}),c=this.safeValue(d,"closed",[]);return this.parseOrders(c,h,t,i)}parseTransactionStatus(e){return this.safeString({Initial:"pending",Pending:"pending",Success:"ok",Settled:"pending",Failure:"failed",Partial:"ok"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"refid"),s=this.safeString(e,"txid"),r=this.safeTimestamp(e,"time"),a=this.safeString(e,"asset"),n=this.safeCurrencyCode(a,t),o=this.safeString(e,"info"),h=this.safeNumber(e,"amount");let d=this.parseTransactionStatus(this.safeString(e,"status"));const c=this.safeString(e,"status-prop");("on-hold"===c||"cancel-pending"===c||"onhold"===c)&&(d="pending");const l=this.safeString(e,"type");let u=this.safeNumber(e,"fee");return void 0===u&&"deposit"===l&&(u=0),{info:e,id:i,currency:n,amount:h,network:void 0,address:o,addressTo:void 0,addressFrom:void 0,tag:void 0,tagTo:void 0,tagFrom:void 0,status:d,type:l,updated:void 0,txid:s,timestamp:r,datetime:this.iso8601(r),fee:{currency:n,cost:u}}}parseTransactionsByType(e,t,i,s,r){const a=[];for(let i=0;i<t.length;i++){const s=this.parseTransaction(this.extend({type:e},t[i]));a.push(s)}return this.filterByCurrencySinceLimit(a,i,s,r)}async fetchDeposits(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchDeposits() requires a currency code argument");await this.loadMarkets();const r={asset:this.currency(e).id},a=await this.privatePostDepositStatus(this.extend(r,s));return this.parseTransactionsByType("deposit",a.result,e,t,i)}async fetchTime(e={}){const t=await this.publicGetTime(e),i=this.safeValue(t,"result",{});return this.safeTimestamp(i,"unixtime")}async fetchWithdrawals(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchWithdrawals() requires a currency code argument");await this.loadMarkets();const r={asset:this.currency(e).id},a=await this.privatePostWithdrawStatus(this.extend(r,s));return this.parseTransactionsByType("withdrawal",a.result,e,t,i)}async createDepositAddress(e,t={}){return await this.fetchDepositAddress(e,this.extend({new:"true"},t))}async fetchDepositMethods(e,t={}){await this.loadMarkets();const i={asset:this.currency(e).id},s=await this.privatePostDepositMethods(this.extend(i,t));return this.safeValue(s,"result")}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e);let s=this.safeStringUpper(t,"network");const r=this.safeValue(this.options,"networks",{});s=this.safeString(r,s,s),t=this.omit(t,"network"),"USDT"===e&&"TRC20"===s&&(e=e+"-"+s);const a=this.safeValue(this.options,"depositMethods",{}),n=this.safeString(a,e);let o=this.safeString(t,"method",n);if(void 0===o){const t=await this.fetchDepositMethods(e);if(void 0!==s)for(let e=0;e<t.length;e++){const i=this.safeString(t[e],"method");if(i.indexOf(s)>=0){o=i;break}}if(void 0===o){const e=this.safeValue(t,0,{});o=this.safeString(e,"method")}}const h={asset:i.id,method:o},d=await this.privatePostDepositAddresses(this.extend(h,t)),c=this.safeValue(d,"result",[]),l=this.safeValue(c,0,{});if(void 0===l)throw new b(this.id+" privatePostDepositAddresses() returned no addresses for "+e);return this.parseDepositAddress(l,i)}parseDepositAddress(e,t){const i=this.safeString(e,"address"),s=this.safeString(e,"tag"),r=(t=this.safeCurrency(void 0,t)).code;return this.checkAddress(i),{currency:r,address:i,tag:s,network:void 0,info:e}}async withdraw(e,t,i,s,r={}){if([s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),"key"in r){await this.loadMarkets();const i=this.currency(e),s={asset:i.id,amount:t},a=await this.privatePostWithdraw(this.extend(s,r)),n=this.safeValue(a,"result",{});return this.parseTransaction(n,i)}throw new l(this.id+" withdraw() requires a 'key' parameter (withdrawal key name, as set up on your account)")}async fetchPositions(e,t={}){await this.loadMarkets();const i=await this.privatePostOpenPositions(this.extend({},t));return this.safeValue(i,"result")}sign(e,t="public",i="GET",s={},r,a){let n="/"+this.version+"/"+t+"/"+e;if("public"===t)Object.keys(s).length&&(n+="?"+this.urlencodeNested(s));else if("private"===t){const t="CancelOrderBatch"===e;this.checkRequiredCredentials();const i=this.nonce().toString();a=t?this.json(this.extend({nonce:i},s)):this.urlencodeNested(this.extend({nonce:i},s));const o=this.encode(i+a),h=this.hash(o,"sha256","binary"),d=this.stringToBinary(this.encode(n)),c=this.binaryConcat(d,h),l=this.base64ToBinary(this.secret),u=this.hmac(c,l,"sha512","base64");(r={"API-Key":this.apiKey,"API-Sign":u})["Content-Type"]=t?"application/json":"application/x-www-form-urlencoded"}else n="/"+e;return n=this.urls.api[t]+n,{url:n,method:i,body:a,headers:r}}nonce(){return this.milliseconds()}handleErrors(e,t,i,s,r,a,o,h,d){if(520===e)throw new n(this.id+" "+e.toString()+" "+t);if(a.indexOf("Invalid order")>=0)throw new y(this.id+" "+a);if(a.indexOf("Invalid nonce")>=0)throw new p(this.id+" "+a);if(a.indexOf("Insufficient funds")>=0)throw new m(this.id+" "+a);if(a.indexOf("Cancel pending")>=0)throw new g(this.id+" "+a);if(a.indexOf("Invalid arguments:volume")>=0)throw new y(this.id+" "+a);if(a.indexOf("Rate limit exceeded")>=0)throw new v(this.id+" "+a);if(void 0!==o&&"{"===a[0]&&"string"!=typeof o&&"error"in o){if(o.error.length){const e=this.id+" "+a;for(let t=0;t<o.error.length;t++){const i=o.error[t];this.throwExactlyMatchedException(this.exceptions,i,e)}throw new l(e)}}}}},6987:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ExchangeNotAvailable:a,InsufficientFunds:n,OrderNotFound:o,InvalidOrder:h,AccountSuspended:d,InvalidNonce:c,NotSupported:l,BadRequest:u,AuthenticationError:f,BadSymbol:p,RateLimitExceeded:m,PermissionDenied:g,InvalidAddress:y}=i(73449),{TICK_SIZE:b}=i(62115),v=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"kucoin",name:"KuCoin",countries:["SC"],rateLimit:50,version:"v2",certified:!0,pro:!0,comment:"Platform 2.0",quoteJsonNumbers:!1,has:{CORS:void 0,spot:!0,margin:!0,swap:!1,future:!1,option:void 0,borrowMargin:!0,cancelAllOrders:!0,cancelOrder:!0,createDepositAddress:!0,createOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchAccounts:!0,fetchBalance:!0,fetchBorrowInterest:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!0,fetchBorrowRates:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDepositAddressesByNetwork:!0,fetchDeposits:!0,fetchDepositWithdrawFee:!0,fetchDepositWithdrawFees:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchL3OrderBook:!0,fetchLedger:!0,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrdersByStatus:!0,fetchOrderTrades:!0,fetchPositionMode:!1,fetchPremiumIndexOHLCV:!1,fetchStatus:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!1,fetchTransactionFee:!0,fetchWithdrawals:!0,repayMargin:!0,setMarginMode:!1,transfer:!0,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/51840849/87295558-132aaf80-c50e-11ea-9801-a2fb0c57c799.jpg",referral:"https://www.kucoin.com/ucenter/signup?rcode=E5wkqe",api:{public:"https://api.kucoin.com",private:"https://api.kucoin.com",futuresPrivate:"https://api-futures.kucoin.com",futuresPublic:"https://api-futures.kucoin.com"},test:{public:"https://openapi-sandbox.kucoin.com",private:"https://openapi-sandbox.kucoin.com",futuresPrivate:"https://api-sandbox-futures.kucoin.com",futuresPublic:"https://api-sandbox-futures.kucoin.com"},www:"https://www.kucoin.com",doc:["https://docs.kucoin.com"]},requiredCredentials:{apiKey:!0,secret:!0,password:!0},api:{public:{get:{timestamp:1,status:1,symbols:1,markets:1,"market/allTickers":1,"market/orderbook/level{level}_{limit}":1,"market/orderbook/level2_20":1,"market/orderbook/level2_100":1,"market/histories":1,"market/candles":1,"market/stats":1,currencies:1,"currencies/{currency}":1,prices:1,"mark-price/{symbol}/current":1,"margin/config":1,"margin/trade/last":1},post:{"bullet-public":1}},private:{get:{"market/orderbook/level{level}":1,"market/orderbook/level2":{v3:2},"market/orderbook/level3":1,accounts:1,"accounts/{accountId}":1,"accounts/ledgers":3.333,"accounts/{accountId}/holds":1,"accounts/transferable":1,"base-fee":1,"sub/user":1,"user-info":1,"sub/api-key":1,"sub-accounts":1,"sub-accounts/{subUserId}":1,"deposit-addresses":1,deposits:10,"hist-deposits":10,"hist-withdrawals":10,withdrawals:10,"withdrawals/quotas":1,orders:2,"order/client-order/{clientOid}":1,"orders/{orderId}":1,"limit/orders":1,fills:6.66667,"limit/fills":1,"isolated/accounts":2,"isolated/account/{symbol}":2,"isolated/borrow/outstanding":2,"isolated/borrow/repaid":2,"isolated/symbols":2,"margin/account":1,"margin/borrow":1,"margin/borrow/outstanding":1,"margin/borrow/repaid":1,"margin/lend/active":1,"margin/lend/done":1,"margin/lend/trade/unsettled":1,"margin/lend/trade/settled":1,"margin/lend/assets":1,"margin/market":1,"stop-order/{orderId}":1,"stop-order":1,"stop-order/queryOrderByClientOid":1,"trade-fees":1.3333},post:{accounts:1,"accounts/inner-transfer":{v2:1},"accounts/sub-transfer":{v2:25},"deposit-addresses":1,withdrawals:1,orders:4,"orders/multi":20,"isolated/borrow":2,"isolated/repay/all":2,"isolated/repay/single":2,"margin/borrow":1,"margin/order":1,"margin/repay/all":1,"margin/repay/single":1,"margin/lend":1,"margin/toggle-auto-lend":1,"bullet-private":1,"stop-order":1,"sub/user":1,"sub/api-key":1,"sub/api-key/update":1},delete:{"withdrawals/{withdrawalId}":1,orders:20,"order/client-order/{clientOid}":1,"orders/{orderId}":1,"margin/lend/{orderId}":1,"stop-order/cancelOrderByClientOid":1,"stop-order/{orderId}":1,"stop-order/cancel":1,"sub/api-key":1}},futuresPublic:{get:{"contracts/active":1.3953,"contracts/{symbol}":1.3953,ticker:1.3953,"level2/snapshot":2,"level2/depth20":1.3953,"level2/depth100":1.3953,"level2/message/query":1.3953,"level3/message/query":1.3953,"level3/snapshot":1.3953,"trade/history":1.3953,"interest/query":1.3953,"index/query":1.3953,"mark-price/{symbol}/current":1.3953,"premium/query":1.3953,"funding-rate/{symbol}/current":1.3953,timestamp:1.3953,status:1.3953,"kline/query":1.3953},post:{"bullet-public":1.3953}},futuresPrivate:{get:{"account-overview":2,"transaction-history":6.666,"deposit-address":1.3953,"deposit-list":1.3953,"withdrawals/quotas":1.3953,"withdrawal-list":1.3953,"transfer-list":1.3953,orders:1.3953,stopOrders:1.3953,recentDoneOrders:1.3953,"orders/{orderId}":1.3953,"orders/byClientOid":1.3953,fills:6.666,recentFills:6.666,openOrderStatistics:1.3953,position:1.3953,positions:6.666,"funding-history":6.666},post:{withdrawals:1.3953,"transfer-out":1.3953,orders:1.3953,"position/margin/auto-deposit-status":1.3953,"position/margin/deposit-margin":1.3953,"bullet-private":1.3953},delete:{"withdrawals/{withdrawalId}":1.3953,"cancel/transfer-out":1.3953,"orders/{orderId}":1.3953,orders:6.666,stopOrders:1.3953}}},timeframes:{"1m":"1min","3m":"3min","5m":"5min","15m":"15min","30m":"30min","1h":"1hour","2h":"2hour","4h":"4hour","6h":"6hour","8h":"8hour","12h":"12hour","1d":"1day","1w":"1week"},precisionMode:b,exceptions:{exact:{"order not exist":o,"order not exist.":o,order_not_exist:o,order_not_exist_or_not_allow_to_cancel:h,"Order size below the minimum requirement.":h,"The withdrawal amount is below the minimum requirement.":r,"Unsuccessful! Exceeded the max. funds out-transfer limit":n,400:u,401:f,403:l,404:l,405:l,429:m,500:a,503:a,101030:g,103e3:h,200004:n,210014:h,210021:n,230003:n,26e4:y,260100:n,3e5:h,4e5:p,400001:f,400002:c,400003:f,400004:f,400005:f,400006:f,400007:f,400008:l,400100:u,400200:h,400350:h,400370:h,400500:h,400600:p,400760:h,401e3:u,411100:d,415e3:u,5e5:a,260220:y,900014:u},broad:{"Exceeded the access frequency":m,"require more permission":g}},fees:{trading:{tierBased:!0,percentage:!0,taker:this.parseNumber("0.001"),maker:this.parseNumber("0.001"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.001")],[this.parseNumber("50"),this.parseNumber("0.001")],[this.parseNumber("200"),this.parseNumber("0.0009")],[this.parseNumber("500"),this.parseNumber("0.0008")],[this.parseNumber("1000"),this.parseNumber("0.0007")],[this.parseNumber("2000"),this.parseNumber("0.0007")],[this.parseNumber("4000"),this.parseNumber("0.0006")],[this.parseNumber("8000"),this.parseNumber("0.0005")],[this.parseNumber("15000"),this.parseNumber("0.00045")],[this.parseNumber("25000"),this.parseNumber("0.0004")],[this.parseNumber("40000"),this.parseNumber("0.00035")],[this.parseNumber("60000"),this.parseNumber("0.0003")],[this.parseNumber("80000"),this.parseNumber("0.00025")]],maker:[[this.parseNumber("0"),this.parseNumber("0.001")],[this.parseNumber("50"),this.parseNumber("0.0009")],[this.parseNumber("200"),this.parseNumber("0.0007")],[this.parseNumber("500"),this.parseNumber("0.0005")],[this.parseNumber("1000"),this.parseNumber("0.0003")],[this.parseNumber("2000"),this.parseNumber("0")],[this.parseNumber("4000"),this.parseNumber("0")],[this.parseNumber("8000"),this.parseNumber("0")],[this.parseNumber("15000"),this.parseNumber("-0.00005")],[this.parseNumber("25000"),this.parseNumber("-0.00005")],[this.parseNumber("40000"),this.parseNumber("-0.00005")],[this.parseNumber("60000"),this.parseNumber("-0.00005")],[this.parseNumber("80000"),this.parseNumber("-0.00005")]]}},funding:{tierBased:!1,percentage:!1,withdraw:{},deposit:{}}},commonCurrencies:{BIFI:"BIFIF",EDGE:"DADI",HOT:"HOTNOW",TRY:"Trias",VAI:"VAIOT",WAX:"WAXP"},options:{version:"v1",symbolSeparator:"-",fetchMyTradesMethod:"private_get_fills",fetchMarkets:{fetchTickersFees:!0},versions:{public:{GET:{"currencies/{currency}":"v2",status:"v1","market/orderbook/level2_20":"v1","market/orderbook/level2_100":"v1","market/orderbook/level{level}_{limit}":"v1"}},private:{GET:{"market/orderbook/level2":"v3","market/orderbook/level3":"v3","market/orderbook/level{level}":"v3","deposit-addresses":"v1"},POST:{"accounts/inner-transfer":"v2","accounts/sub-transfer":"v2",accounts:"v2"}},futuresPrivate:{GET:{"account-overview":"v1",positions:"v1"},POST:{"transfer-out":"v2"}},futuresPublic:{GET:{"level3/snapshot":"v2"}}},partner:{spot:{id:"ccxt",key:"9e58cc35-5b5e-4133-92ec-166e3f077cb8"},future:{id:"ccxtfutures",key:"1b327198-f30c-4f14-a0ac-918871282f15"}},accountsByType:{spot:"trade",margin:"margin",cross:"margin",isolated:"isolated",main:"main",funding:"main",future:"contract",swap:"contract",mining:"pool"},networks:{Native:"bech32","BTC-Segwit":"btc",ERC20:"eth",BEP20:"bsc",TRC20:"trx",TERRA:"luna",BNB:"bsc",HRC20:"heco",HT:"heco"},networksById:{BEP20:"BSC"},marginModes:{cross:"MARGIN_TRADE",isolated:"MARGIN_ISOLATED_TRADE",spot:"TRADE"}}})}nonce(){return this.milliseconds()}async fetchTime(e={}){const t=await this.publicGetTimestamp(e);return this.safeInteger(t,"data")}async fetchStatus(e={}){const t=await this.publicGetStatus(e),i=this.safeValue(t,"data",{});return{status:"open"===this.safeString(i,"status")?"ok":"maintenance",updated:void 0,eta:void 0,url:void 0,info:t}}async fetchMarkets(e={}){const t=await this.publicGetSymbols(e),i=this.safeValue(t,"data"),s=this.safeValue(this.options,"fetchMarkets",{});let r={};this.safeValue(s,"fetchTickersFees",!0)&&(r=await this.publicGetMarketAllTickers(e));const a=this.safeValue(r,"data",{}),n=this.safeValue(a,"ticker",[]),o=this.indexBy(n,"symbol"),h=[];for(let e=0;e<i.length;e++){const t=i[e],s=this.safeString(t,"symbol"),[r,a]=s.split("-"),n=this.safeCurrencyCode(r),d=this.safeCurrencyCode(a),c=this.safeValue(o,s,{}),l=this.safeString(c,"makerFeeRate"),u=this.safeString(c,"takerFeeRate"),f=this.safeString(c,"makerCoefficient"),p=this.safeString(c,"takerCoefficient");h.push({id:s,symbol:n+"/"+d,base:n,quote:d,settle:void 0,baseId:r,quoteId:a,settleId:void 0,type:"spot",spot:!0,margin:this.safeValue(t,"isMarginEnabled"),swap:!1,future:!1,option:!1,active:this.safeValue(t,"enableTrading"),contract:!1,linear:void 0,inverse:void 0,taker:this.parseNumber(v.stringMul(u,p)),maker:this.parseNumber(v.stringMul(l,f)),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(t,"baseIncrement"),price:this.safeNumber(t,"priceIncrement")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"baseMinSize"),max:this.safeNumber(t,"baseMaxSize")},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"quoteMinSize"),max:this.safeNumber(t,"quoteMaxSize")}},info:t})}return h}async fetchCurrencies(e={}){const t=await this.publicGetCurrencies(e),i=this.safeValue(t,"data",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"currency"),a=this.safeString(t,"fullName"),n=this.safeCurrencyCode(r),o=this.safeValue(t,"isWithdrawEnabled",!1),h=this.safeValue(t,"isDepositEnabled",!1),d=this.safeNumber(t,"withdrawalMinFee"),c=o&&h;s[n]={id:r,name:a,code:n,precision:this.parseNumber(this.parsePrecision(this.safeString(t,"precision"))),info:t,active:c,deposit:h,withdraw:o,fee:d,limits:this.limits}}return s}async fetchAccounts(e={}){const t=await this.privateGetAccounts(e),i=this.safeValue(t,"data",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"id"),a=this.safeString(t,"currency"),n=this.safeCurrencyCode(a),o=this.safeString(t,"type");s.push({id:r,type:o,currency:n,info:t})}return s}async fetchTransactionFee(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=this.safeValue(this.options,"networks",{});let r=this.safeStringUpper2(t,"network","chain");r=this.safeStringLower(s,r,r),void 0!==r&&(r=r.toLowerCase(),i.chain=r.toLowerCase(),t=this.omit(t,["network","chain"]));const a=await this.privateGetWithdrawalsQuotas(this.extend(i,t)),n=a.data,o={};return o[e]=this.safeNumber(n,"withdrawMinFee"),{info:a,withdraw:o,deposit:{}}}async fetchDepositWithdrawFee(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},r=this.safeStringUpper(t,"network"),a=this.networkCodeToId(r,e);void 0!==a&&(s.chain=a,t=this.omit(t,["network"]));const n=await this.privateGetWithdrawalsQuotas(this.extend(s,t)),o=this.safeValue(n,"data");return this.parseDepositWithdrawFee(o,i)}parseDepositWithdrawFee(e,t){const i=this.depositWithdrawFee(e);if(this.safeValue(e,"isWithdrawEnabled")){const s=this.safeString(e,"chain"),r=this.networkIdToCode(s,this.safeString(t,"code"));i.networks[r]={withdraw:{fee:this.safeNumber(e,"withdrawMinFee"),percentage:void 0},deposit:{fee:void 0,percentage:void 0}}}return this.assignDefaultDepositWithdrawFees(i)}isFuturesMethod(e,t){const i=this.safeString2(this.options,e,"defaultType","trade"),s=this.safeString(t,"type",i),a=this.safeValue(this.options,"accountsByType"),n=this.safeString(a,s);if(void 0===n){const e=Object.keys(a);throw new r(this.id+" isFuturesMethod() type must be one of "+e.join(", "))}return t=this.omit(t,"type"),"contract"===n||"future"===n||"futures"===n}parseTicker(e,t){let i=this.safeString(e,"changeRate");void 0!==i&&(i=v.stringMul(i,"100"));let s=this.safeString2(e,"last","lastTradedPrice");s=this.safeString(e,"price",s);const r=this.safeString(e,"symbol"),a=(t=this.safeMarket(r,t,"-")).symbol,n=this.safeString(e,"vol"),o=this.safeString(e,"volValue"),h=this.safeInteger2(e,"time","datetime");return this.safeTicker({symbol:a,timestamp:h,datetime:this.iso8601(h),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString2(e,"buy","bestBid"),bidVolume:this.safeString(e,"bestBidSize"),ask:this.safeString2(e,"sell","bestAsk"),askVolume:this.safeString(e,"bestAskSize"),vwap:void 0,open:this.safeString(e,"open"),close:s,last:s,previousClose:void 0,change:this.safeString(e,"changePrice"),percentage:i,average:this.safeString(e,"averagePrice"),baseVolume:n,quoteVolume:o,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetMarketAllTickers(t),s=this.safeValue(i,"data",{}),r=this.safeValue(s,"ticker",[]),a=this.safeInteger(s,"time"),n={};for(let e=0;e<r.length;e++){r[e].time=a;const t=this.parseTicker(r[e]),i=this.safeString(t,"symbol");void 0!==i&&(n[i]=t)}return this.filterByArray(n,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetMarketStats(this.extend(s,t));return this.parseTicker(r.data,i)}parseOHLCV(e,t){return[this.safeTimestamp(e,0),this.safeNumber(e,1),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,2),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,type:this.safeString(this.timeframes,t,t)},o=1e3*this.parseTimeframe(t);let h=this.milliseconds();void 0!==i?(n.startAt=parseInt(Math.floor(i/1e3)),void 0===s&&(s=this.safeInteger(this.options,"fetchOHLCVLimit",1500)),h=this.sum(i,s*o)):void 0!==s&&(i=h-s*o,n.startAt=parseInt(Math.floor(i/1e3))),n.endAt=parseInt(Math.floor(h/1e3));const d=await this.publicGetMarketCandles(this.extend(n,r)),c=this.safeValue(d,"data",[]);return this.parseOHLCVs(c,a,t,i,s)}async createDepositAddress(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=this.safeValue(this.options,"networks",{});let r=this.safeStringUpper2(t,"chain","network");r=this.safeStringLower(s,r,r),void 0!==r&&(r=r.toLowerCase(),i.chain=r,t=this.omit(t,["chain","network"]));const a=await this.privatePostDepositAddresses(this.extend(i,t)),n=this.safeValue(a,"data",{});let o=this.safeString(n,"address");void 0!==o&&(o=o.replace("bitcoincash:",""));const h=this.safeString(n,"memo");return"NIM"!==e&&this.checkAddress(o),{info:a,currency:e,network:this.safeString(n,"chain"),address:o,tag:h}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},r=this.safeValue(this.options,"networks",{});let a=this.safeStringUpper2(t,"chain","network");a=this.safeStringLower(r,a,a),void 0!==a&&(a=a.toLowerCase(),s.chain=a,t=this.omit(t,["chain","network"]));const n=this.options.versions.private.GET["deposit-addresses"];this.options.versions.private.GET["deposit-addresses"]="v1";const o=await this.privateGetDepositAddresses(this.extend(s,t));this.options.versions.private.GET["deposit-addresses"]=n;const h=this.safeValue(o,"data",{});return this.parseDepositAddress(h,i)}parseDepositAddress(e,t){const i=this.safeString(e,"address"),s=t.id;return"NIM"!==s&&this.checkAddress(i),{info:e,currency:s,address:i,tag:this.safeString(e,"memo"),network:this.safeString(e,"chain")}}async fetchDepositAddressesByNetwork(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},r=this.options.versions.private.GET["deposit-addresses"];this.options.versions.private.GET["deposit-addresses"]="v2";const a=await this.privateGetDepositAddresses(this.extend(s,t));this.options.versions.private.GET["deposit-addresses"]=r;const n=this.safeValue(a,"data",[]);return this.parseDepositAddressesByNetwork(n,i)}parseDepositAddressesByNetwork(e,t){const i=[];for(let s=0;s<e.length;s++){const r=e[s];i.push({info:r,currency:this.safeCurrencyCode(t.id,t),network:this.safeString(r,"chain"),address:this.safeString(r,"address"),tag:this.safeString(r,"memo")})}return i}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),a=this.safeInteger(i,"level",2),n={symbol:s.id};let o="publicGetMarketOrderbookLevelLevelLimit";let h;if(this.checkRequiredCredentials(!1)&&void 0===t)o="privateGetMarketOrderbookLevel2";else if(2===a){if(n.level=a,void 0!==t){if(20!==t&&100!==t)throw new r(this.id+" fetchOrderBook() limit argument must be 20 or 100");n.limit=t}n.limit=t||100}h=await this[o](this.extend(n,i));const d=this.safeValue(h,"data",{}),c=this.safeInteger(d,"time"),l=this.parseOrderBook(d,s.symbol,c,"bids","asks",a-2,a-1);return l.nonce=this.safeInteger(d,"sequence"),l}async createOrder(e,t,i,s,a,n={}){await this.loadMarkets();const o=this.market(e),h=this.safeString2(n,"clientOid","clientOrderId",this.uuid());n=this.omit(n,["clientOid","clientOrderId"]);const d={clientOid:h,side:i,symbol:o.id,type:t},c=this.safeNumber2(n,"cost","funds");let l,f,p;[p,n]=this.handleMarginModeAndParams("createOrder",n),"market"===t?void 0!==c?(n=this.omit(n,["cost","funds"]),f=this.amountToPrecision(e,c),d.funds=f):(l=this.amountToPrecision(e,s),d.size=this.amountToPrecision(e,s)):(l=this.amountToPrecision(e,s),d.size=l,d.price=this.priceToPrecision(e,a));const m=this.safeValue(n,"stopLossPrice"),g=this.safeValue2(n,"takeProfitPrice","stopPrice"),y=void 0!==m,b=void 0!==g;if(y&&b)throw new r(this.id+" createOrder() stopLossPrice and takeProfitPrice cannot both be defined");n=this.omit(n,["stopLossPrice","takeProfitPrice","stopPrice"]);const v=this.safeString(n,"tradeType");let w="privatePostOrders";if(y||b){d.stop=y?"entry":"loss";const t=y?m:g;if(d.stopPrice=this.priceToPrecision(e,t),w="privatePostStopOrder","isolated"===p)throw new u(this.id+" createOrder does not support isolated margin for stop orders");"cross"===p&&(d.tradeType=this.options.marginModes[p])}else"MARGIN_TRADE"!==v&&void 0===p||(w="privatePostMarginOrder","isolated"===p&&(d.marginModel="isolated"));const S=await this[w](this.extend(d,n)),k=this.safeValue(S,"data",{});return this.parseOrder(k,o)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={},r=this.safeString2(i,"clientOid","clientOrderId"),a=this.safeValue(i,"stop");let n="privateDeleteOrdersOrderId";return void 0!==r?(s.clientOid=r,n=a?"privateDeleteStopOrderCancelOrderByClientOid":"privateDeleteOrderClientOrderClientOid"):(a&&(n="privateDeleteStopOrderOrderId"),s.orderId=e),i=this.omit(i,["clientOid","clientOrderId","stop"]),await this[n](this.extend(s,i))}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={},s=this.safeValue(t,"stop"),[r,a]=this.handleMarginModeAndParams("cancelAllOrders",t);if(void 0!==e&&(i.symbol=this.marketId(e)),void 0!==r&&(i.tradeType=this.options.marginModes[r],"isolated"===r&&s))throw new u(this.id+" cancelAllOrders does not support isolated margin for stop orders");const n=s?"privateDeleteStopOrderCancel":"privateDeleteOrders";return await this[n](this.extend(i,a))}async fetchOrdersByStatus(e,t,i,s,r={}){await this.loadMarkets();let a=e.toLowerCase();const n=this.safeInteger2(r,"until","till"),o=this.safeValue(r,"stop");r=this.omit(r,["stop","till","until"]);const[h,d]=this.handleMarginModeAndParams("fetchOrdersByStatus",r);"open"===a?a="active":"closed"===a&&(a="done");const c={status:a};let l;void 0!==t&&(l=this.market(t),c.symbol=l.id),void 0!==i&&(c.startAt=i),void 0!==s&&(c.pageSize=s),n&&(c.endAt=n);let u="privateGetOrders";o&&(u="privateGetStopOrder"),c.tradeType=this.safeString(this.options.marginModes,h,"TRADE");const f=await this[u](this.extend(c,d)),p=this.safeValue(f,"data",{}),m=this.safeValue(p,"items",[]);return this.parseOrders(m,l,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("done",e,t,i,s)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("active",e,t,i,s)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={},r=this.safeString2(i,"clientOid","clientOrderId"),a=this.safeValue(i,"stop");let n;void 0!==t&&(n=this.market(t)),i=this.omit(i,"stop");let o="privateGetOrdersOrderId";if(void 0!==r)s.clientOid=r,a?(o="privateGetStopOrderQueryOrderByClientOid",void 0!==t&&(s.symbol=n.id)):o="privateGetOrderClientOrderClientOid";else{if(void 0===e)throw new h(this.id+" fetchOrder() requires an order id");a&&(o="privateGetStopOrderOrderId"),s.orderId=e}i=this.omit(i,["clientOid","clientOrderId"]);const d=await this[o](this.extend(s,i));let c=this.safeValue(d,"data");return"privateGetStopOrderQueryOrderByClientOid"===o&&(c=this.safeValue(c,0)),this.parseOrder(c,n)}parseOrder(e,t){const i=this.safeString(e,"symbol"),s=this.safeInteger(e,"createdAt"),r=this.safeString(e,"feeCurrency"),a=this.safeValue(e,"cancelExist",!1),n=void 0!==this.safeString(e,"stop"),o=this.safeValue(e,"stopTriggered",!1),h=this.safeValue(e,"isActive");let d;if(!0===h&&(d="open"),n){"NEW"===this.safeString(e,"status")?d="open":h||o||(d="cancelled")}a&&(d="canceled"),void 0===d&&(d="closed");const c=this.safeNumber(e,"stopPrice");return this.safeOrder({info:e,id:this.safeString2(e,"id","orderId"),clientOrderId:this.safeString(e,"clientOid"),symbol:this.safeSymbol(i,t,"-"),type:this.safeString(e,"type"),timeInForce:this.safeString(e,"timeInForce"),postOnly:this.safeValue(e,"postOnly"),side:this.safeString(e,"side"),amount:this.safeString(e,"size"),price:this.safeString(e,"price"),stopPrice:c,triggerPrice:c,cost:this.safeString(e,"dealFunds"),filled:this.safeString(e,"dealSize"),remaining:void 0,timestamp:s,datetime:this.iso8601(s),fee:{currency:this.safeCurrencyCode(r),cost:this.safeNumber(e,"fee")},status:d,lastTradeTimestamp:void 0,average:void 0,trades:void 0},t)}async fetchOrderTrades(e,t,i,s,r={}){const a={orderId:e};return await this.fetchMyTrades(t,i,s,this.extend(a,r))}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const a={};let n;void 0!==e&&(n=this.market(e),a.symbol=n.id),void 0!==i&&(a.pageSize=i);const o=this.options.fetchMyTradesMethod;let h=!1;if("private_get_fills"===o)void 0!==t&&(a.startAt=t);else if("private_get_limit_fills"===o)h=!0;else{if("private_get_hist_orders"!==o)throw new r(this.id+" fetchMyTradesMethod() invalid method");void 0!==t&&(a.startAt=parseInt(t/1e3))}const d=await this[o](this.extend(a,s)),c=this.safeValue(d,"data",{});let l;return l=h?c:this.safeValue(c,"items",[]),this.parseTrades(l,n,t,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id},n=await this.publicGetMarketHistories(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}parseTrade(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t,"-");const s=this.safeString2(e,"tradeId","id"),r=this.safeString(e,"orderId"),a=this.safeString(e,"liquidity");let n=this.safeInteger(e,"time");void 0!==n?n=parseInt(n/1e6):(n=this.safeInteger(e,"createdAt"),"dealValue"in e&&void 0!==n&&(n*=1e3));const o=this.safeString2(e,"price","dealPrice"),h=this.safeString2(e,"size","amount"),d=this.safeString(e,"side");let c;const l=this.safeString(e,"fee");if(void 0!==l){const i=this.safeString(e,"feeCurrency");let s=this.safeCurrencyCode(i);void 0===s&&(s="sell"===d?t.quote:t.base),c={cost:l,currency:s,rate:this.safeString(e,"feeRate")}}let u=this.safeString(e,"type");"match"===u&&(u=void 0);const f=this.safeString2(e,"funds","dealValue");return this.safeTrade({info:e,id:s,order:r,timestamp:n,datetime:this.iso8601(n),symbol:t.symbol,type:u,takerOrMaker:a,side:d,price:o,amount:h,cost:f,fee:c},t)}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbols:i.id},r=await this.privateGetTradeFees(this.extend(s,t)),a=this.safeValue(r,"data",[]),n=this.safeValue(a,0),o=this.safeString(n,"symbol");return{info:r,symbol:this.safeSymbol(o,i),maker:this.safeNumber(n,"makerFeeRate"),taker:this.safeNumber(n,"takerFeeRate"),percentage:!0,tierBased:!0}}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets(),this.checkAddress(i);const a=this.currency(e),n={currency:a.id,address:i,amount:t};void 0!==s&&(n.memo=s);const o=this.safeValue(this.options,"networks",{});let h=this.safeStringUpper(r,"network");h=this.safeStringLower(o,h,h),void 0!==h&&(h=h.toLowerCase(),n.chain=h,r=this.omit(r,"network"));const d=await this.privatePostWithdrawals(this.extend(n,r)),c=this.safeValue(d,"data",{});return this.parseTransaction(c,a)}parseTransactionStatus(e){return this.safeString({SUCCESS:"ok",PROCESSING:"ok",FAILURE:"failed"},e)}parseTransaction(e,t){const i=this.safeString(e,"currency"),s=this.safeCurrencyCode(i,t);let r=this.safeString(e,"address");const a=this.safeString(e,"amount");let n=this.safeString(e,"walletTxId");if(void 0!==n){const e=n.split("@");e.length>1&&void 0===r&&e[1].length>1&&(r=e[1]),n=e[0]}let o=void 0===n?"withdrawal":"deposit";const h=this.safeString(e,"status");let d;const c=this.safeString(e,"fee");if(void 0!==c){let e;void 0!==a&&(e=v.stringDiv(c,a)),d={cost:this.parseNumber(c),rate:this.parseNumber(e),currency:s}}let l=this.safeInteger2(e,"createdAt","createAt"),u=this.safeInteger(e,"updatedAt");!("createdAt"in e)&&(o="address"in e?"withdrawal":"deposit",void 0!==l&&(l*=1e3),void 0!==u&&(u*=1e3));const f=this.safeString(e,"memo"),p=this.safeString(e,"chain");return{info:e,id:this.safeString2(e,"id","withdrawalId"),timestamp:l,datetime:this.iso8601(l),network:p,address:r,addressTo:r,addressFrom:void 0,tag:f,tagTo:f,tagFrom:void 0,currency:s,amount:this.parseNumber(a),txid:n,type:o,status:this.parseTransactionStatus(h),comment:this.safeString(e,"remark"),fee:d,updated:u}}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==i&&(r.pageSize=i);let n="privateGetDeposits";void 0!==t&&(t<1550448e6?(r.startAt=parseInt(t/1e3),n="privateGetHistDeposits"):r.startAt=t);const o=(await this[n](this.extend(r,s))).data.items;return this.parseTransactions(o,a,t,i,{type:"deposit"})}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==i&&(r.pageSize=i);let n="privateGetWithdrawals";void 0!==t&&(t<1550448e6?(r.startAt=parseInt(t/1e3),n="privateGetHistWithdrawals"):r.startAt=t);const o=(await this[n](this.extend(r,s))).data.items;return this.parseTransactions(o,a,t,i,{type:"withdrawal"})}parseBalanceHelper(e){const t=this.account();t.used=this.safeString(e,"holdBalance"),t.free=this.safeString(e,"availableBalance"),t.total=this.safeString(e,"totalBalance");const i=this.safeString(e,"liability"),s=this.safeString(e,"interest");return t.debt=v.stringAdd(i,s),t}async fetchBalance(e={}){await this.loadMarkets();const t=this.safeString(e,"code");let i;void 0!==t&&(i=this.currency(t));const s=this.safeString2(this.options,"fetchBalance","defaultType","spot"),r=this.safeString(e,"type",s),a=this.safeValue(this.options,"accountsByType"),n=this.safeString(a,r,r);e=this.omit(e,"type");const[o,h]=this.handleMarginModeAndParams("fetchBalance",e);let d="privateGetAccounts";const c={},l="isolated"===o||"isolated"===n,u="cross"===o||"cross"===n;l?(d="privateGetIsolatedAccounts",void 0!==i&&(c.balanceCurrency=i.id)):u?d="privateGetMarginAccount":(void 0!==i&&(c.currency=i.id),c.type=n);const f=await this[d](this.extend(c,h)),p=this.safeValue(f,"data",[]),m={info:f,timestamp:void 0,datetime:void 0};if(l){const e=this.safeValue(p,"assets",[]);for(let t=0;t<e.length;t++){const i=e[t],s=this.safeString(i,"symbol"),r=this.safeSymbol(s,void 0,"_"),a=this.safeValue(i,"baseAsset",{}),n=this.safeValue(i,"quoteAsset",{}),o=this.safeCurrencyCode(this.safeString(a,"currency")),h=this.safeCurrencyCode(this.safeString(n,"currency")),d={};d[o]=this.parseBalanceHelper(a),d[h]=this.parseBalanceHelper(n),m[r]=this.safeBalance(d)}}else if(u){const e=this.safeValue(p,"accounts",[]);for(let t=0;t<e.length;t++){const i=e[t],s=this.safeString(i,"currency");m[this.safeCurrencyCode(s)]=this.parseBalanceHelper(i)}}else for(let e=0;e<p.length;e++){const t=p[e];if(this.safeString(t,"type")===n){const e=this.safeString(t,"currency"),i=this.safeCurrencyCode(e),s=this.account();s.total=this.safeString(t,"balance"),s.free=this.safeString(t,"available"),s.used=this.safeString(t,"holds"),m[i]=s}}return l?m:this.safeBalance(m)}async transfer(e,t,i,s,a={}){await this.loadMarkets();const n=this.currency(e),o=this.currencyToPrecision(e,t);let h=this.convertTypeToAccount(i),d=this.convertTypeToAccount(s);const c=this.inArray(h,this.ids),l=this.inArray(d,this.ids);if("contract"===h){if("main"!==d)throw new r(this.id+" transfer() only supports transferring from futures account to main account");const e={currency:n.id,amount:o};"bizNo"in a||(e.bizNo=this.uuid22());const t=await this.futuresPrivatePostTransferOut(this.extend(e,a)),i=this.safeValue(t,"data");return this.parseTransfer(i,n)}{const e={currency:n.id,amount:o};(c||l)&&(this.inArray(h,this.ids)&&(e.fromTag=h,h="isolated"),this.inArray(d,this.ids)&&(e.toTag=d,d="isolated")),e.from=h,e.to=d,"clientOid"in a||(e.clientOid=this.uuid());const t=await this.privatePostAccountsInnerTransfer(this.extend(e,a)),i=this.safeValue(t,"data");return this.parseTransfer(i,n)}}parseTransfer(e,t){const i=this.safeInteger(e,"createdAt"),s=this.safeString(e,"currency"),r=this.safeString(e,"status"),a=this.safeStringLower(e,"payAccountType"),n=this.safeStringLower(e,"recAccountType"),o=this.safeValue(this.options,"accountsByType"),h=this.safeString(o,a,a),d=this.safeString(o,n,n);return{id:this.safeString2(e,"applyId","orderId"),currency:this.safeCurrencyCode(s,t),timestamp:i,datetime:this.iso8601(i),amount:this.safeNumber(e,"amount"),fromAccount:h,toAccount:d,status:this.parseTransferStatus(r),info:e}}parseTransferStatus(e){return this.safeString({PROCESSING:"pending"},e,e)}parseLedgerEntryType(e){return this.safeString({"Assets Transferred in After Upgrading":"transfer",Deposit:"transaction",Withdrawal:"transaction",Transfer:"transfer",Trade_Exchange:"trade","KuCoin Bonus":"bonus","Referral Bonus":"referral",Rewards:"bonus","Airdrop/Fork":"airdrop","Other rewards":"bonus","Fee Rebate":"rebate","Buy Crypto":"trade","Sell Crypto":"sell","Public Offering Purchase":"trade","Refunded Fees":"fee","KCS Pay Fees":"fee","Margin Trade":"trade",Loans:"Loans","Instant Exchange":"trade","Sub-account transfer":"transfer","Liquidation Fees":"fee"},e,e)}parseLedgerEntry(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"currency"),r=this.safeCurrencyCode(s,t),a=this.safeNumber(e,"amount"),n=this.safeString(e,"bizType"),o=this.parseLedgerEntryType(n),h=this.safeString(e,"direction"),d=this.safeInteger(e,"createdAt"),c=this.iso8601(d),l=this.safeString(e,"accountType"),u=this.safeString(e,"context");let f,p;if(void 0!==u&&""!==u)try{const e=JSON.parse(u),t=this.safeString(e,"orderId"),i=this.safeString(e,"tradeId");f=void 0!==i?i:t}catch(e){f=u}const m=this.safeNumber(e,"fee");let g;return 0!==m&&(g=r,p={cost:m,currency:g}),{id:i,direction:h,account:l,referenceId:f,referenceAccount:l,type:o,currency:r,amount:a,timestamp:d,datetime:c,before:void 0,after:undefined,status:void 0,fee:p,info:e}}async fetchLedger(e,t,i,s={}){await this.loadMarkets(),await this.loadAccounts();const r={};let a;void 0!==t&&(r.startAt=t),void 0!==e&&(a=this.currency(e),r.currency=a.id);const n=await this.privateGetAccountsLedgers(this.extend(r,s)),o=this.safeValue(n,"data"),h=this.safeValue(o,"items");return this.parseLedger(h,a,t,i)}calculateRateLimiterCost(e,t,i,s,r={},a={}){const n=this.safeValue(this.options,"versions",{}),o=this.safeValue(n,e,{}),h=this.safeValue(o,t,{}),d=this.safeString(h,i,this.options.version),c=this.safeString(s,"version",d);return"v3"===c&&"v3"in r?r.v3:"v2"===c&&"v2"in r?r.v2:"v1"===c&&"v1"in r?r.v1:this.safeValue(r,"cost",1)}async fetchBorrowRateHistory(e,t,i,s={}){await this.loadMarkets();const r={currency:this.currency(e).id},a=await this.privateGetMarginTradeLast(this.extend(r,s)),n=this.safeValue(a,"data",{});return this.parseBorrowRateHistory(n,e)}parseBorrowRateHistory(e,t,i,s){const r=[];for(let t=0;t<e.length;t++){const i=e[t],s=this.parseBorrowRate(i);r.push(s)}const a=this.sortBy(r,"timestamp");return this.filterByCurrencySinceLimit(a,t,i,s)}parseBorrowRate(e,t){const i=this.safeString(e,"timestamp"),s=v.stringMul(i,"0.000001"),r=this.safeString(e,"currency");return{currency:this.safeCurrencyCode(r,t),rate:this.safeNumber(e,"dailyIntRate"),period:864e5,timestamp:s,datetime:this.iso8601(s),info:e}}async fetchBorrowInterest(e,t,i,s,r={}){let a;await this.loadMarkets(),[a,r]=this.handleMarginModeAndParams("fetchBorrowInterest",r),void 0===a&&(a="cross");const n={};let o="privateGetMarginBorrowOutstanding";if("isolated"===a){if(void 0!==e){const t=this.currency(e);n.balanceCurrency=t.id}o="privateGetIsolatedAccounts"}else if(void 0!==e){const t=this.currency(e);n.currency=t.id}const h=await this[o](this.extend(n,r)),d=this.safeValue(h,"data",{}),c="isolated"===a?this.safeValue(d,"assets",[]):this.safeValue(d,"items",[]);return this.parseBorrowInterests(c,void 0)}parseBorrowInterest(e,t){const i=this.safeString(e,"symbol"),s=void 0===i?"cross":"isolated";t=this.safeMarket(i,t);const r=this.safeString(t,"symbol"),a=this.safeInteger(e,"createdAt"),n=this.safeValue(e,"baseAsset",{});let o,h,d;return"isolated"===s?(o=this.safeNumber(n,"liability"),h=this.safeNumber(n,"interest"),d=this.safeString(n,"currency")):(o=this.safeNumber(e,"principal"),h=this.safeNumber(e,"accruedInterest"),d=this.safeString(e,"currency")),{symbol:r,marginMode:s,currency:this.safeCurrencyCode(d),interest:h,interestRate:this.safeNumber(e,"dailyIntRate"),amountBorrowed:o,timestamp:a,datetime:this.iso8601(a),info:e}}async borrowMargin(e,t,i,s={}){const r=this.safeString(s,"marginMode");s=this.omit(s,"marginMode"),this.checkRequiredMarginArgument("borrowMargin",i,r),await this.loadMarkets();const a=this.currency(e),n={currency:a.id,size:this.currencyToPrecision(e,t)};let o;const h=this.safeStringN(s,["timeInForce","type","borrowStrategy"],"IOC");let d;if(void 0===i)o="privatePostMarginBorrow",d="type";else{const e=this.market(i);n.symbol=e.id,d="borrowStrategy",o="privatePostIsolatedBorrow"}n[d]=h,s=this.omit(s,["timeInForce","type","borrowStrategy"]);const c=await this[o](this.extend(n,s)),l=this.safeValue(c,"data",{});return this.parseMarginLoan(l,a)}async repayMargin(e,t,i,s={}){const r=this.safeString(s,"marginMode");s=this.omit(s,"marginMode"),this.checkRequiredMarginArgument("repayMargin",i,r),await this.loadMarkets();const a=this.currency(e),n={currency:a.id,size:this.currencyToPrecision(e,t)};let o;const h=this.safeString2(s,"sequence","seqStrategy","RECENTLY_EXPIRE_FIRST");let d;if(void 0===i)o="privatePostMarginRepayAll",d="sequence";else{const e=this.market(i);n.symbol=e.id,d="seqStrategy",o="privatePostIsolatedRepayAll"}n[d]=h,s=this.omit(s,["sequence","seqStrategy"]);const c=await this[o](this.extend(n,s));return this.parseMarginLoan(c,a)}parseMarginLoan(e,t){const i=this.milliseconds(),s=this.safeString(e,"currency");return{id:this.safeString(e,"orderId"),currency:this.safeCurrencyCode(s,t),amount:this.safeNumber(e,"actualSize"),symbol:void 0,timestamp:i,datetime:this.iso8601(i),info:e}}sign(e,t="public",i="GET",s={},r,a){const n=this.safeValue(this.options,"versions",{}),o=this.safeValue(n,t,{}),h=this.safeValue(o,i,{}),d=this.safeString(h,e,this.options.version),c=this.safeString(s,"version",d);s=this.omit(s,"version");let l="/api/"+c+"/"+this.implodeParams(e,s);"webFront"===t&&(l="/"+this.implodeParams(e,s));const u=this.omit(s,this.extractParams(e));let f="";r=void 0!==r?r:{};let p=this.urls.api[t];const m=p.indexOf("sandbox")>=0;"symbols"!==e||m||(l="/api/v2/"+this.implodeParams(e,s)),Object.keys(u).length&&("GET"===i||"DELETE"===i?l+="?"+this.rawencode(u):(f=a=this.json(u),r["Content-Type"]="application/json")),p+=l;const g="futuresPrivate"===t;if("private"===t||g){this.checkRequiredCredentials();const e=this.nonce().toString();r=this.extend({"KC-API-KEY-VERSION":"2","KC-API-KEY":this.apiKey,"KC-API-TIMESTAMP":e},r);if("2"===this.safeString(r,"KC-API-KEY-VERSION")){const e=this.hmac(this.encode(this.password),this.encode(this.secret),"sha256","base64");r["KC-API-PASSPHRASE"]=e}else r["KC-API-PASSPHRASE"]=this.password;const t=e+i+l+f,s=this.hmac(this.encode(t),this.encode(this.secret),"sha256","base64");r["KC-API-SIGN"]=s;let a=this.safeValue(this.options,"partner",{});a=g?this.safeValue(a,"future",a):this.safeValue(a,"spot",a);const n=this.safeString(a,"id"),o=this.safeString2(a,"secret","key");if(void 0!==n&&void 0!==o){const t=e+n+this.apiKey,i=this.hmac(this.encode(t),this.encode(o),"sha256","base64");r["KC-API-PARTNER-SIGN"]=i,r["KC-API-PARTNER"]=n}}return{url:p,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,n,o,h){if(!n)return void this.throwBroadlyMatchedException(this.exceptions.broad,a,a);const d=this.safeString(n,"code"),c=this.safeString(n,"msg",""),l=this.id+" "+c;this.throwExactlyMatchedException(this.exceptions.exact,c,l),this.throwExactlyMatchedException(this.exceptions.exact,d,l),this.throwBroadlyMatchedException(this.exceptions.broad,a,l)}}},70514:function(e,t,i){"use strict";const{ArgumentsRequired:s,ExchangeNotAvailable:r,InvalidOrder:a,InsufficientFunds:n,AccountSuspended:o,InvalidNonce:h,NotSupported:d,OrderNotFound:c,BadRequest:l,AuthenticationError:u,RateLimitExceeded:f,PermissionDenied:p}=i(73449),m=i(6832),g=i(6987),{TICK_SIZE:y}=i(62115);e.exports=class extends g{describe(){return this.deepExtend(super.describe(),{id:"kucoinfutures",name:"KuCoin Futures",countries:["SC"],rateLimit:75,version:"v1",certified:!1,pro:!0,comment:"Platform 2.0",quoteJsonNumbers:!1,has:{CORS:void 0,spot:!1,margin:!1,swap:!0,future:!0,option:!1,addMargin:!0,cancelAllOrders:!0,cancelOrder:!0,createDepositAddress:!0,createOrder:!0,createReduceOnlyOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchAccounts:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchCurrencies:!1,fetchDepositAddress:!0,fetchDeposits:!0,fetchDepositWithdrawFee:!1,fetchDepositWithdrawFees:!1,fetchFundingHistory:!0,fetchFundingRate:!0,fetchFundingRateHistory:!1,fetchIndexOHLCV:!1,fetchL3OrderBook:!0,fetchLedger:!0,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarketLeverageTiers:!0,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPositionMode:!1,fetchPositions:!0,fetchPremiumIndexOHLCV:!1,fetchStatus:!0,fetchTicker:!0,fetchTickers:!1,fetchTime:!0,fetchTrades:!0,fetchTransactionFee:!1,fetchWithdrawals:!0,setMarginMode:!1,transfer:!0,withdraw:void 0},urls:{logo:"https://user-images.githubusercontent.com/1294454/147508995-9e35030a-d046-43a1-a006-6fabd981b554.jpg",doc:["https://docs.kucoin.com/futures","https://docs.kucoin.com"],www:"https://futures.kucoin.com/",referral:"https://futures.kucoin.com/?rcode=E5wkqe",api:{public:"https://openapi-v2.kucoin.com",private:"https://openapi-v2.kucoin.com",futuresPrivate:"https://api-futures.kucoin.com",futuresPublic:"https://api-futures.kucoin.com",webFront:"https://futures.kucoin.com/_api/web-front"},test:{public:"https://openapi-sandbox.kucoin.com",private:"https://openapi-sandbox.kucoin.com",futuresPrivate:"https://api-sandbox-futures.kucoin.com",futuresPublic:"https://api-sandbox-futures.kucoin.com"}},requiredCredentials:{apiKey:!0,secret:!0,password:!0},api:{futuresPublic:{get:{"contracts/active":1,"contracts/{symbol}":1,"contracts/risk-limit/{symbol}":1,ticker:1,"level2/snapshot":1.33,"level2/depth{limit}":1,"level2/message/query":1,"level3/message/query":1,"level3/snapshot":1,"trade/history":1,"interest/query":1,"index/query":1,"mark-price/{symbol}/current":1,"premium/query":1,"funding-rate/{symbol}/current":1,timestamp:1,status:1,"kline/query":1},post:{"bullet-public":1}},futuresPrivate:{get:{"account-overview":1.33,"transaction-history":4.44,"deposit-address":1,"deposit-list":1,"withdrawals/quotas":1,"withdrawal-list":1,"transfer-list":1,orders:1.33,stopOrders:1,recentDoneOrders:1,"orders/{orderId}":1,"orders/byClientOid":1,fills:4.44,recentFills:4.44,openOrderStatistics:1,position:1,positions:4.44,"funding-history":4.44},post:{withdrawals:1,"transfer-out":1,orders:1.33,"position/margin/auto-deposit-status":1,"position/margin/deposit-margin":1,"bullet-private":1},delete:{"withdrawals/{withdrawalId}":1,"cancel/transfer-out":1,"orders/{orderId}":1,orders:4.44,stopOrders:1}},webFront:{get:{"contract/{symbol}/funding-rates":1}}},precisionMode:y,exceptions:{exact:{400:l,401:u,403:d,404:d,405:d,415:l,429:f,500:r,503:r,100001:a,100004:l,101030:p,200004:n,230003:n,260100:n,300003:n,300012:a,400001:u,400002:h,400003:u,400004:u,400005:u,400006:u,400007:u,404e3:d,400100:l,411100:o,5e5:r},broad:{"Position does not exist":c}},fees:{trading:{tierBased:!0,percentage:!0,taker:this.parseNumber("0.0006"),maker:this.parseNumber("0.0002"),tiers:{taker:[[this.parseNumber("0"),this.parseNumber("0.0006")],[this.parseNumber("50"),this.parseNumber("0.0006")],[this.parseNumber("200"),this.parseNumber("0.0006")],[this.parseNumber("500"),this.parseNumber("0.0005")],[this.parseNumber("1000"),this.parseNumber("0.0004")],[this.parseNumber("2000"),this.parseNumber("0.0004")],[this.parseNumber("4000"),this.parseNumber("0.00038")],[this.parseNumber("8000"),this.parseNumber("0.00035")],[this.parseNumber("15000"),this.parseNumber("0.00032")],[this.parseNumber("25000"),this.parseNumber("0.0003")],[this.parseNumber("40000"),this.parseNumber("0.0003")],[this.parseNumber("60000"),this.parseNumber("0.0003")],[this.parseNumber("80000"),this.parseNumber("0.0003")]],maker:[[this.parseNumber("0"),this.parseNumber("0.02")],[this.parseNumber("50"),this.parseNumber("0.015")],[this.parseNumber("200"),this.parseNumber("0.01")],[this.parseNumber("500"),this.parseNumber("0.01")],[this.parseNumber("1000"),this.parseNumber("0.01")],[this.parseNumber("2000"),this.parseNumber("0")],[this.parseNumber("4000"),this.parseNumber("0")],[this.parseNumber("8000"),this.parseNumber("0")],[this.parseNumber("15000"),this.parseNumber("-0.003")],[this.parseNumber("25000"),this.parseNumber("-0.006")],[this.parseNumber("40000"),this.parseNumber("-0.009")],[this.parseNumber("60000"),this.parseNumber("-0.012")],[this.parseNumber("80000"),this.parseNumber("-0.015")]]}},funding:{tierBased:!1,percentage:!1,withdraw:{},deposit:{}}},commonCurrencies:{HOT:"HOTNOW",EDGE:"DADI",WAX:"WAXP",TRY:"Trias",VAI:"VAIOT",XBT:"BTC"},timeframes:{"1m":1,"3m":void 0,"5m":5,"15m":15,"30m":30,"1h":60,"2h":120,"4h":240,"6h":void 0,"8h":480,"12h":720,"1d":1440,"1w":10080},options:{version:"v1",symbolSeparator:"-",defaultType:"swap",code:"USDT",marginModes:{},marginTypes:{},versions:{futuresPrivate:{POST:{"transfer-out":"v2"}},futuresPublic:{GET:{"level3/snapshot":"v2"}}},networks:{OMNI:"omni",ERC20:"eth",TRC20:"trx"}}})}async fetchAccounts(e={}){throw new l(this.id+" fetchAccounts() is not supported yet")}async fetchStatus(e={}){const t=await this.futuresPublicGetStatus(e),i=this.safeValue(t,"data",{});return{status:"open"===this.safeString(i,"status")?"ok":"maintenance",updated:void 0,eta:void 0,url:void 0,info:t}}async fetchMarkets(e={}){const t=await this.futuresPublicGetContractsActive(e),i=[],s=this.safeValue(t,"data",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"symbol"),a=this.safeInteger(t,"expireDate"),n=!!a,o=!n,h=this.safeString(t,"baseCurrency"),d=this.safeString(t,"quoteCurrency"),c=this.safeString(t,"settleCurrency"),l=this.safeCurrencyCode(h),u=this.safeCurrencyCode(d),f=this.safeCurrencyCode(c);let p=l+"/"+u+":"+f,g="swap";n&&(p=p+"-"+this.yymmdd(a,""),g="future");const y=this.safeValue(t,"isInverse"),b=this.safeString(t,"status"),v=this.safeString(t,"multiplier"),w=this.safeNumber(t,"tickSize"),S=this.safeNumber(t,"lotSize");let k=S;void 0===k&&(k=this.safeNumber(t,"baseMinSize"));let T=this.safeNumber(t,"maxOrderQty");void 0===T&&(T=this.safeNumber(t,"baseMaxSize"));let _=this.safeNumber(t,"maxPrice");if(void 0===_){const e=this.safeString(t,"baseMinSize"),i=this.safeString(t,"quoteMaxSize");_=this.parseNumber(m.stringDiv(i,e))}i.push({id:r,symbol:p,base:l,quote:u,settle:f,baseId:h,quoteId:d,settleId:c,type:g,spot:!1,margin:!1,swap:o,future:n,option:!1,active:"Open"===b,contract:!0,linear:!y,inverse:y,taker:this.safeNumber(t,"takerFeeRate"),maker:this.safeNumber(t,"makerFeeRate"),contractSize:this.parseNumber(m.stringAbs(v)),expiry:a,expiryDatetime:this.iso8601(a),strike:void 0,optionType:void 0,precision:{amount:S,price:w},limits:{leverage:{min:this.parseNumber("1"),max:this.safeNumber(t,"maxLeverage")},amount:{min:k,max:T},price:{min:w,max:_},cost:{min:this.safeNumber(t,"quoteMinSize"),max:this.safeNumber(t,"quoteMaxSize")}},info:t})}return i}async fetchTime(e={}){const t=await this.futuresPublicGetTimestamp(e);return this.safeNumber(t,"data")}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,granularity:this.safeInteger(this.timeframes,t,t)},o=1e3*this.parseTimeframe(t);let h=this.milliseconds();void 0!==i?(n.from=i,void 0===s&&(s=this.safeInteger(this.options,"fetchOHLCVLimit",200)),h=this.sum(i,s*o)):void 0!==s&&(i=h-s*o,n.from=i),n.to=h;const d=await this.futuresPublicGetKlineQuery(this.extend(n,r)),c=this.safeValue(d,"data",[]);return this.parseOHLCVs(c,a,t,i,s)}parseOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async createDepositAddress(e,t={}){throw new l(this.id+" createDepositAddress() is not supported yet")}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e).id,s={currency:i},r=await this.futuresPrivateGetDepositAddress(this.extend(s,t)),a=this.safeValue(r,"data",{}),n=this.safeString(a,"address");return"NIM"!==i&&this.checkAddress(n),{info:r,currency:i,address:n,tag:this.safeString(a,"memo"),network:this.safeString(a,"chain")}}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.safeNumber(i,"level");if(2!==s&&void 0!==s)throw new l(this.id+" fetchOrderBook() can only return level 2");const r=this.market(e),a={symbol:r.id};if(void 0!==t){if(20!==t&&100!==t)throw new l(this.id+" fetchOrderBook() limit argument must be 20 or 100");a.limit=t}else a.limit=20;const n=await this.futuresPublicGetLevel2DepthLimit(this.extend(a,i)),o=this.safeValue(n,"data",{}),h=parseInt(this.safeInteger(o,"ts")/1e6),d=this.parseOrderBook(o,r.symbol,h,"bids","asks",0,1);return d.nonce=this.safeInteger(o,"sequence"),d}async fetchL3OrderBook(e,t,i={}){throw new l(this.id+" fetchL3OrderBook() is not supported yet")}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.futuresPublicGetTicker(this.extend(s,t));return this.parseTicker(r.data,i)}parseTicker(e,t){const i=this.safeString(e,"price"),s=this.safeString(e,"symbol");t=this.safeMarket(s,t,"-");const r=this.safeIntegerProduct(e,"ts",1e-6);return this.safeTicker({symbol:t.symbol,timestamp:r,datetime:this.iso8601(r),high:void 0,low:void 0,bid:this.safeString(e,"bestBidPrice"),bidVolume:this.safeString(e,"bestBidSize"),ask:this.safeString(e,"bestAskPrice"),askVolume:this.safeString(e,"bestAskSize"),vwap:void 0,open:void 0,close:i,last:i,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:void 0,quoteVolume:void 0,info:e},t)}async fetchFundingHistory(e,t,i,r={}){if(void 0===e)throw new s(this.id+" fetchFundingHistory() requires a symbol argument");await this.loadMarkets();const a={symbol:this.market(e).id};void 0!==t&&(a.startAt=t),void 0!==i&&(a.maxCount=i);const n=await this.futuresPrivateGetFundingHistory(this.extend(a,r)),o=this.safeValue(n,"data"),h=this.safeValue(o,"dataList",[]),d=[];for(let t=0;t<h.length;t++){const i=h[t],s=this.safeInteger(i,"timePoint");d.push({info:i,symbol:e,code:this.safeCurrencyCode(this.safeString(i,"settleCurrency")),timestamp:s,datetime:this.iso8601(s),id:this.safeNumber(i,"id"),amount:this.safeNumber(i,"funding"),fundingRate:this.safeNumber(i,"fundingRate"),markPrice:this.safeNumber(i,"markPrice"),positionQty:this.safeNumber(i,"positionQty"),positionCost:this.safeNumber(i,"positionCost")})}return d}async fetchPositions(e,t={}){await this.loadMarkets();const i=await this.futuresPrivateGetPositions(t),s=this.safeValue(i,"data");return this.parsePositions(s,e)}parsePosition(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t);const s=this.safeNumber(e,"currentTimestamp"),r=this.safeString(e,"currentQty");let a;m.stringGt(r,"0")?a="long":m.stringLt(r,"0")&&(a="short");const n=m.stringAbs(this.safeString(e,"posCost")),o=this.safeString(e,"posInit"),h=m.stringDiv(o,n),d=this.safeString(e,"unrealisedPnl"),c=this.safeValue(e,"crossMode")?"cross":"isolated";return{info:e,id:void 0,symbol:this.safeString(t,"symbol"),timestamp:s,datetime:this.iso8601(s),initialMargin:this.parseNumber(o),initialMarginPercentage:this.parseNumber(h),maintenanceMargin:this.safeNumber(e,"posMaint"),maintenanceMarginPercentage:this.safeNumber(e,"maintMarginReq"),entryPrice:this.safeNumber(e,"avgEntryPrice"),notional:this.parseNumber(n),leverage:this.safeNumber(e,"realLeverage"),unrealizedPnl:this.parseNumber(d),contracts:this.parseNumber(m.stringAbs(r)),contractSize:this.safeValue(t,"contractSize"),marginRatio:void 0,liquidationPrice:this.safeNumber(e,"liquidationPrice"),markPrice:this.safeNumber(e,"markPrice"),collateral:this.safeNumber(e,"maintMargin"),marginMode:c,side:a,percentage:this.parseNumber(m.stringDiv(d,o))}}async createOrder(e,t,i,r,n,o={}){await this.loadMarkets();const h=this.market(e),d=this.safeString2(o,"clientOid","clientOrderId",this.uuid());if(o=this.omit(o,["clientOid","clientOrderId"]),r<1)throw new a(this.id+" createOrder() minimum contract order amount is 1");const c=parseInt(this.amountToPrecision(e,r)),u={clientOid:d,side:i,symbol:h.id,type:t,size:c,leverage:1},f=this.safeValue2(o,"triggerPrice","stopPrice"),p=this.safeValue(o,"stopLossPrice"),m=this.safeValue(o,"takeProfitPrice"),g=void 0!==p,y=void 0!==m;f?(u.stop="buy"===i?"up":"down",u.stopPrice=this.priceToPrecision(e,f),u.stopPriceType="MP"):(g||y)&&(g?(u.stop="buy"===i?"up":"down",u.stopPrice=this.priceToPrecision(e,p)):(u.stop="buy"===i?"down":"up",u.stopPrice=this.priceToPrecision(e,m)),u.reduceOnly=!0,u.stopPriceType="MP");const b=t.toUpperCase(),v=this.safeStringUpper(o,"timeInForce");if("LIMIT"===b){if(void 0===n)throw new s(this.id+" createOrder() requires a price argument for limit orders");u.price=this.priceToPrecision(e,n),void 0!==v&&(u.timeInForce=v)}const w=this.safeValue(o,"postOnly",!1),S=this.safeValue(o,"hidden");if(w&&void 0!==S)throw new l(this.id+" createOrder() does not support the postOnly parameter together with a hidden parameter");if(this.safeValue(o,"iceberg")){if(void 0===this.safeValue(o,"visibleSize"))throw new s(this.id+" createOrder() requires a visibleSize parameter for iceberg orders")}o=this.omit(o,["timeInForce","stopPrice","triggerPrice","stopLossPrice","takeProfitPrice"]);const k=await this.futuresPrivatePostOrders(this.extend(u,o)),T=this.safeValue(k,"data",{});return{id:this.safeString(T,"orderId"),clientOrderId:void 0,timestamp:void 0,datetime:void 0,lastTradeTimestamp:void 0,symbol:void 0,type:void 0,side:void 0,price:void 0,amount:void 0,cost:void 0,average:void 0,filled:void 0,remaining:void 0,status:void 0,fee:void 0,trades:void 0,timeInForce:void 0,postOnly:void 0,stopPrice:void 0,triggerPrice:void 0,info:k}}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={orderId:e},r=await this.futuresPrivateDeleteOrdersOrderId(this.extend(s,i));return this.safeValue(r,"data")}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};void 0!==e&&(i.symbol=this.marketId(e));const s=this.safeValue(t,"stop")?"futuresPrivateDeleteStopOrders":"futuresPrivateDeleteOrders",r=await this[s](this.extend(i,t));return this.safeValue(r,"data")}async addMargin(e,t,i={}){await this.loadMarkets();const s=this.market(e),r=this.uuid(),a={symbol:s.id,margin:this.amountToPrecision(e,t),bizNo:r},n=await this.futuresPrivatePostPositionMarginDepositMargin(this.extend(a,i)),o=this.safeValue(n,"data");return this.extend(this.parseMarginModification(o,s),{amount:this.amountToPrecision(e,t),direction:"in"})}parseMarginModification(e,t){const i=this.safeString(e,"id");t=this.safeMarket(i,t);const s=this.safeString(e,"settleCurrency"),r=this.safeValue(e,"crossMode")?"cross":"isolated",a=this.safeString(t,"symbol");return{info:e,direction:void 0,mode:r,amount:void 0,code:this.safeCurrencyCode(s),symbol:this.safeSymbol(a,t),status:void 0}}async fetchOrdersByStatus(e,t,i,s,r={}){await this.loadMarkets();const a=this.safeValue(r,"stop"),n=this.safeInteger2(r,"until","till");r=this.omit(r,["stop","until","till"]),"closed"===e?e="done":"open"===e&&(e="active");const o={};if(a){if("active"!==e)throw new l(this.id+" fetchOrdersByStatus() can only fetch untriggered stop orders")}else o.status=e;let h;void 0!==t&&(h=this.market(t),o.symbol=h.id),void 0!==i&&(o.startAt=i),void 0!==n&&(o.endAt=n);const d=a?"futuresPrivateGetStopOrders":"futuresPrivateGetOrders",c=await this[d](this.extend(o,r)),u=this.safeValue(c,"data",{}),f=this.safeValue(u,"items",[]);return this.parseOrders(f,h,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("done",e,t,i,s)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={};let r="futuresPrivateGetOrdersOrderId";if(void 0===e){const e=this.safeString2(i,"clientOid","clientOrderId");if(void 0===e)throw new a(this.id+" fetchOrder() requires parameter id or params.clientOid");s.clientOid=e,r="futuresPrivateGetOrdersByClientOid",i=this.omit(i,["clientOid","clientOrderId"])}else s.orderId=e;const n=await this[r](this.extend(s,i)),o=void 0!==t?this.market(t):void 0,h=this.safeValue(n,"data");return this.parseOrder(h,o)}parseOrder(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeString(e,"id"),a=this.safeString(e,"type"),n=this.safeInteger(e,"createdAt"),o=this.iso8601(n),h=this.safeString(e,"price"),d=this.safeString(e,"side"),c=this.safeString(e,"feeCurrency"),l=this.safeCurrencyCode(c),u=this.safeNumber(e,"fee"),f=this.safeString(e,"size"),p=this.safeString(e,"dealSize"),g=this.safeString2(e,"dealFunds","filledValue"),y=this.safeString(e,"leverage"),b=m.stringDiv(g,y);let v;if(m.stringGt(p,"0")){const e=this.safeString(t,"contractSize");v=t.linear?m.stringDiv(g,m.stringMul(e,p)):m.stringDiv(m.stringMul(e,p),g)}let w=this.safeValue(e,"isActive",!1)?"open":"closed";w=this.safeValue(e,"cancelExist",!1)?"canceled":w;const S={currency:l,cost:u},k=this.safeString(e,"clientOid"),T=this.safeString(e,"timeInForce"),_=this.safeNumber(e,"stopPrice"),O=this.safeValue(e,"postOnly");return this.safeOrder({id:r,clientOrderId:k,symbol:s,type:a,timeInForce:T,postOnly:O,side:d,amount:f,price:h,stopPrice:_,triggerPrice:_,cost:b,filled:p,remaining:void 0,timestamp:n,datetime:o,fee:S,status:w,info:e,lastTradeTimestamp:void 0,average:v,trades:void 0},t)}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.futuresPublicGetFundingRateSymbolCurrent(this.extend(s,t)),a=this.safeValue(r,"data"),n=this.safeNumber(a,"timePoint");return{info:a,symbol:i.symbol,markPrice:void 0,indexPrice:void 0,interestRate:void 0,estimatedSettlePrice:void 0,timestamp:void 0,datetime:void 0,fundingRate:this.safeNumber(a,"predictedValue"),fundingTimestamp:void 0,fundingDatetime:void 0,nextFundingRate:void 0,nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:this.safeNumber(a,"value"),previousFundingTimestamp:n,previousFundingDatetime:this.iso8601(n)}}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0},i=this.safeValue(e,"data"),s=this.safeString(i,"currency"),r=this.safeCurrencyCode(s),a=this.account();return a.free=this.safeString(i,"availableBalance"),a.total=this.safeString(i,"accountEquity"),t[r]=a,this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();let t=this.safeString(this.options,"code");const i=this.safeValue(this.options,"fetchBalance",{});t=this.safeString(i,"code",t);const s=this.safeString(e,"code",t),r={currency:this.currency(s).id},a=await this.futuresPrivateGetAccountOverview(this.extend(r,e));return this.parseBalance(a)}async transfer(e,t,i,s,r={}){if("main"!==s&&"funding"!==s||"futures"!==i&&"future"!==i&&"contract"!==i)throw new l(this.id+" transfer() only supports transfers from contract(future) account to main(funding) account");await this.loadMarkets();const a=this.currency(e),n=this.currencyToPrecision(e,t),o={currency:this.safeString(a,"id"),amount:n},h=await this.futuresPrivatePostTransferOut(this.extend(o,r)),d=this.safeValue(h,"data");return this.extend(this.parseTransfer(d,a),{amount:this.parseNumber(n),fromAccount:"future",toAccount:"spot"})}parseTransfer(e,t){const i=this.safeInteger(e,"updatedAt");return{id:this.safeString(e,"applyId"),timestamp:i,datetime:this.iso8601(i),currency:this.safeCurrencyCode(void 0,t),amount:void 0,fromAccount:void 0,toAccount:void 0,status:this.safeString(e,"status"),info:e}}parseTransferStatus(e){return this.safeString({PROCESSING:"pending"},e,e)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.symbol=a.id),void 0!==t&&(r.startAt=t);const n=await this.futuresPrivateGetFills(this.extend(r,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"items",{});return this.parseTrades(h,a,t,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id},n=await this.futuresPublicGetTradeHistory(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}parseTrade(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t,"-");const s=this.safeString2(e,"tradeId","id"),r=this.safeString(e,"orderId"),a=this.safeString(e,"liquidity");let n=this.safeInteger(e,"ts");void 0!==n?n=parseInt(n/1e6):(n=this.safeInteger(e,"createdAt"),"dealValue"in e&&void 0!==n&&(n*=1e3));const o=this.safeString2(e,"price","dealPrice"),h=this.safeString2(e,"size","amount"),d=this.safeString(e,"side");let c;const l=this.safeString(e,"fee");if(void 0!==l){const i=this.safeString(e,"feeCurrency");let s=this.safeCurrencyCode(i);void 0===s&&(s="sell"===d?t.quote:t.base),c={cost:l,currency:s,rate:this.safeString(e,"feeRate")}}let u=this.safeString2(e,"type","orderType");"match"===u&&(u=void 0);let f=this.safeString2(e,"funds","value");if(void 0===f){const e=this.safeString(t,"contractSize"),i=m.stringMul(o,h);f=m.stringMul(i,e)}return this.safeTrade({info:e,id:s,order:r,timestamp:n,datetime:this.iso8601(n),symbol:t.symbol,type:u,takerOrMaker:a,side:d,price:o,amount:h,cost:f,fee:c},t)}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==i&&(r.pageSize=i),void 0!==t&&(r.startAt=t);const n=(await this.futuresPrivateGetDepositList(this.extend(r,s))).data.items;return this.parseTransactions(n,a,t,i,{type:"deposit"})}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==i&&(r.pageSize=i),void 0!==t&&(r.startAt=t);const n=(await this.futuresPrivateGetWithdrawalList(this.extend(r,s))).data.items;return this.parseTransactions(n,a,t,i,{type:"withdrawal"})}async fetchTransactionFee(e,t={}){throw new l(this.id+" fetchTransactionFee() is not supported")}async fetchDepositWithdrawFee(e,t={}){throw new l(this.id+" fetchDepositWithdrawFee() is not supported")}async fetchLedger(e,t,i,s={}){throw new l(this.id+" fetchLedger() is not supported yet")}async fetchMarketLeverageTiers(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.contract)throw new l(this.id+" fetchMarketLeverageTiers() supports contract markets only");const s={symbol:i.id},r=await this.futuresPublicGetContractsRiskLimitSymbol(this.extend(s,t)),a=this.safeValue(r,"data");return this.parseMarketLeverageTiers(a,i)}parseMarketLeverageTiers(e,t){const i=[];for(let s=0;s<e.length;s++){const r=e[s];i.push({tier:this.safeNumber(r,"level"),currency:t.base,minNotional:this.safeNumber(r,"minRiskLimit"),maxNotional:this.safeNumber(r,"maxRiskLimit"),maintenanceMarginRate:this.safeNumber(r,"maintainMargin"),maxLeverage:this.safeNumber(r,"maxLeverage"),info:r})}return i}async fetchFundingRateHistory(e,t,i,r={}){if(void 0===e)throw new s(this.id+" fetchFundingRateHistory() requires a symbol argument");await this.loadMarkets();const a=this.market(e),n={symbol:a.id};void 0!==i&&(n.maxCount=i);const o=await this.webFrontGetContractSymbolFundingRates(this.extend(n,r)),h=this.safeValue(o,"data"),d=this.safeValue(h,"dataList");return this.parseFundingRateHistories(d,a,t,i)}parseFundingRateHistory(e,t){const i=this.safeNumber(e,"timePoint"),s=this.safeString(e,"symbol");return{info:e,symbol:this.safeSymbol(s,t),fundingRate:this.safeNumber(e,"value"),timestamp:i,datetime:this.iso8601(i)}}}},14400:function(e,t,i){"use strict";const s=i(48819),{ArgumentsRequired:r,InsufficientFunds:a,OrderNotFound:n,NotSupported:o}=i(73449),{TICK_SIZE:h}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"kuna",name:"Kuna",countries:["UA"],rateLimit:1e3,version:"v2",has:{CORS:void 0,spot:!0,margin:void 0,swap:!1,future:!1,option:!1,cancelOrder:!0,createOrder:!0,fetchBalance:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchL3OrderBook:!0,fetchLeverage:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:"emulated",fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,reduceMargin:!1,setLeverage:!1,setPositionMode:!1},timeframes:void 0,urls:{extension:".json",referral:"https://kuna.io?r=kunaid-gvfihe8az7o4",logo:"https://user-images.githubusercontent.com/51840849/87153927-f0578b80-c2c0-11ea-84b6-74612568e9e1.jpg",api:{xreserve:"https://api.xreserve.fund",v3:"https://api.kuna.io",public:"https://kuna.io",private:"https://kuna.io"},www:"https://kuna.io",doc:"https://kuna.io/documents/api",fees:"https://kuna.io/documents/api"},api:{xreserve:{get:{nonce:1,fee:1,"delegated-transactions":1},post:{"delegate-transfer":1}},v3:{public:{get:{timestamp:1,currencies:1,markets:1,tickers:1,k:1,trades_history:1,fees:1,"exchange-rates":1,"exchange-rates/currency":1,"book/market":1,"kuna_codes/code/check":1,landing_page_statistic:1,"translations/locale":1,"trades/market/hist":1},post:{http_test:1,deposit_channels:1,withdraw_channels:1,subscription_plans:1,send_to:1,confirm_token:1,kunaid:1,"withdraw/prerequest":1,"deposit/prerequest":1,"deposit/exchange-rates":1}},sign:{get:{"reset_password/token":1},post:{"signup/google":1,"signup/resend_confirmation":1,signup:1,signin:1,"signin/two_factor":1,"signin/resend_confirm_device":1,"signin/confirm_device":1,reset_password:1,"cool-signin":1},put:{"reset_password/token":1,"signup/code/confirm":1}},private:{post:{"auth/w/order/submit":1,"auth/r/orders":1,"auth/r/orders/market":1,"auth/r/orders/markets":1,"auth/api_tokens/delete":1,"auth/api_tokens/create":1,"auth/api_tokens":1,"auth/signin_history/uniq":1,"auth/signin_history":1,"auth/disable_withdraw_confirmation":1,"auth/change_password":1,"auth/deposit_address":1,"auth/announcements/accept":1,"auth/announcements/unaccepted":1,"auth/otp/deactivate":1,"auth/otp/activate":1,"auth/otp/secret":1,"auth/r/order/market/:order_id/trades":1,"auth/r/orders/market/hist":1,"auth/r/orders/hist":1,"auth/r/orders/hist/markets":1,"auth/r/orders/details":1,"auth/assets-history":1,"auth/assets-history/withdraws":1,"auth/assets-history/deposits":1,"auth/r/wallets":1,"auth/markets/favorites":1,"auth/markets/favorites/list":1,"auth/me/update":1,"auth/me":1,"auth/fund_sources":1,"auth/fund_sources/list":1,"auth/withdraw/resend_confirmation":1,"auth/withdraw":1,"auth/withdraw/details":1,"auth/withdraw/info":1,"auth/payment_addresses":1,"auth/deposit/prerequest":1,"auth/deposit/exchange-rates":1,"auth/deposit":1,"auth/deposit/details":1,"auth/deposit/info":1,"auth/kuna_codes/count":1,"auth/kuna_codes/details":1,"auth/kuna_codes/edit":1,"auth/kuna_codes/send-pdf":1,"auth/kuna_codes":1,"auth/kuna_codes/redeemed-by-me":1,"auth/kuna_codes/issued-by-me":1,"auth/payment_requests/invoice":1,"auth/payment_requests/type":1,"auth/referral_program/weekly_earnings":1,"auth/referral_program/stats":1,"auth/merchant/payout_services":1,"auth/merchant/withdraw":1,"auth/merchant/payment_services":1,"auth/merchant/deposit":1,"auth/verification/auth_token":1,"auth/kunaid_purchase/create":1,"auth/devices/list":1,"auth/sessions/list":1,"auth/subscriptions/reactivate":1,"auth/subscriptions/cancel":1,"auth/subscriptions/prolong":1,"auth/subscriptions/create":1,"auth/subscriptions/list":1,"auth/kuna_ids/list":1,"order/cancel/multi":1,"order/cancel":1},put:{"auth/fund_sources/id":1,"auth/kuna_codes/redeem":1},delete:{"auth/markets/favorites":1,"auth/fund_sources":1,"auth/devices":1,"auth/devices/list":1,"auth/sessions/list":1,"auth/sessions":1}}},public:{get:["depth","k_with_pending_trades","k","markets","order_book","order_book/{market}","tickers","tickers/{market}","timestamp","trades","trades/{market}"]},private:{get:["members/me","deposits","deposit","deposit_address","orders","order","trades/my","withdraws","withdraw"],post:["orders","orders/multi","orders/clear","order/delete","withdraw"]}},fees:{trading:{tierBased:!1,percentage:!0,taker:this.parseNumber("0.0025"),maker:this.parseNumber("0.0025")},funding:{withdraw:{UAH:"1%",BTC:.001,BCH:.001,ETH:.01,WAVES:.01,GOL:0,GBG:0},deposit:{}}},commonCurrencies:{PLA:"Plair"},precisionMode:h,exceptions:{2002:a,2003:n}})}async fetchTime(e={}){return 1e3*await this.publicGetTimestamp(e)}async fetchMarkets(e={}){const t=["btc","rub","uah","usd","usdt","usdc"],i=[],s=await this.publicGetTickers(e),r=Object.keys(s);for(let e=0;e<r.length;e++){const s=r[e];for(let e=0;e<t.length;e++){const r=t[e],a=s.slice(1),n=a.indexOf(r),o=a.slice(n);if(n>0&&o===r){const e=s[0]+a.replace(r,""),t=this.safeCurrencyCode(e),n=this.safeCurrencyCode(r);i.push({id:s,symbol:t+"/"+n,base:t,quote:n,settle:void 0,baseId:e,quoteId:r,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:void 0,price:void 0},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:void 0})}}}return i}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={market:s.id};void 0!==t&&(r.limit=t);const a=await this.publicGetDepth(this.extend(r,i)),n=this.safeTimestamp(a,"timestamp");return this.parseOrderBook(a,s.symbol,n)}parseTicker(e,t){const i=this.safeTimestamp(e,"at");e=e.ticker;const s=this.safeSymbol(void 0,t),r=this.safeString(e,"last");return this.safeTicker({symbol:s,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"buy"),bidVolume:void 0,ask:this.safeString(e,"sell"),askVolume:void 0,vwap:void 0,open:this.safeString(e,"open"),close:r,last:r,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"vol"),quoteVolume:void 0,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetTickers(t),s=Object.keys(i),r={};for(let e=0;e<s.length;e++){const t=s[e],a=this.safeMarket(t);r[a.symbol]=this.parseTicker(i[t],a)}return this.filterByArray(r,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={market:i.id},r=await this.publicGetTickersMarket(this.extend(s,t));return this.parseTicker(r,i)}async fetchL3OrderBook(e,t,i={}){return await this.fetchOrderBook(e,t,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={market:r.id},n=await this.publicGetTrades(this.extend(a,s));return this.parseTrades(n,r,t,i)}parseTrade(e,t){const i=this.parse8601(this.safeString(e,"created_at"));let s;t&&(s=t.symbol);let r=this.safeString2(e,"side","trend");if(void 0!==r){const e={ask:"sell",bid:"buy"};r=this.safeString(e,r,r)}const a=this.safeString(e,"price"),n=this.safeString(e,"volume"),o=this.safeNumber(e,"funds"),h=this.safeString(e,"order_id"),d=this.safeString(e,"id");return this.safeTrade({id:d,info:e,timestamp:i,datetime:this.iso8601(i),symbol:s,type:void 0,side:r,order:h,takerOrMaker:void 0,price:a,amount:n,cost:o,fee:void 0},t)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=await this.fetchTrades(e,i,s,r),n=this.buildOHLCVC(a,t,i,s),o=[];for(let e=0;e<n.length;e++){const t=n[e];o.push([t[0],t[1],t[2],t[3],t[4],t[5]])}return o}parseBalance(e){const t=this.safeValue(e,"accounts",[]),i={info:t};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"balance"),n.used=this.safeString(s,"locked"),i[a]=n}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetMembersMe(e);return this.parseBalance(t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={market:n.id,side:i,volume:s.toString(),ord_type:t};"limit"===t&&(o.price=r.toString());const h=await this.privatePostOrders(this.extend(o,a));return this.parseOrder(h,n)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privatePostOrderDelete(this.extend(s,i)),a=this.parseOrder(r),o=a.status;if("closed"===o||"canceled"===o)throw new n(this.id+" "+this.json(a));return a}parseOrderStatus(e){return this.safeString({done:"closed",wait:"open",cancel:"canceled"},e,e)}parseOrder(e,t){const i=this.safeString(e,"market"),s=this.safeSymbol(i,t),r=this.parse8601(this.safeString(e,"created_at")),a=this.parseOrderStatus(this.safeString(e,"state")),n=this.safeString(e,"type"),o=this.safeString(e,"side"),h=this.safeString(e,"id");return this.safeOrder({id:h,clientOrderId:void 0,timestamp:r,datetime:this.iso8601(r),lastTradeTimestamp:void 0,status:a,symbol:s,type:n,timeInForce:void 0,postOnly:void 0,side:o,price:this.safeString(e,"price"),stopPrice:void 0,triggerPrice:void 0,amount:this.safeString(e,"volume"),filled:this.safeString(e,"executed_volume"),remaining:this.safeString(e,"remaining_volume"),trades:void 0,fee:void 0,info:e,cost:void 0,average:void 0},t)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={id:parseInt(e)},r=await this.privateGetOrder(this.extend(s,i));return this.parseOrder(r)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new r(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const a=this.market(e),n={market:a.id},o=await this.privateGetOrders(this.extend(n,s));return this.parseOrders(o,a,t,i)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new r(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const a=this.market(e),n={market:a.id},o=await this.privateGetTradesMy(this.extend(n,s));return this.parseTrades(o,a,t,i)}nonce(){return this.milliseconds()}encodeParams(e){if("orders"in e){const t=e.orders;let i=this.urlencode(this.keysort(this.omit(e,"orders")));for(let e=0;e<t.length;e++){const s=t[e],r=Object.keys(s);for(let e=0;e<r.length;e++){const t=r[e];i+="&orders%5B%5D%5B"+t+"%5D="+s[t].toString()}}return i}return this.urlencode(this.keysort(e))}sign(e,t="public",i="GET",s={},r,a){let n;if(Array.isArray(t)){const[h,d]=t;if(n=this.urls.api[h]+"/"+h+"/"+this.implodeParams(e,s),"public"===d)"GET"===i?Object.keys(s).length&&(n+="?"+this.urlencode(s)):"POST"!==i&&"PUT"!==i||(r={"Content-Type":"application/json"},a=this.json(s));else if("private"===d)throw new o(this.id+" private v3 API is not supported yet")}else{let o="/api/"+this.version+"/"+this.implodeParams(e,s);"extension"in this.urls&&(o+=this.urls.extension);const h=this.omit(s,this.extractParams(e));if(n=this.urls.api[t]+o,"public"===t)Object.keys(h).length&&(n+="?"+this.urlencode(h));else{this.checkRequiredCredentials();const e=this.nonce().toString(),t=this.encodeParams(this.extend({access_key:this.apiKey,tonce:e},s)),h=i+"|"+o+"|"+t,d=t+"&signature="+this.hmac(this.encode(h),this.encode(this.secret));"GET"===i?n+="?"+d:(a=d,r={"Content-Type":"application/x-www-form-urlencoded"})}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,n,o,h){if(void 0!==n&&400===e){const e=this.safeValue(n,"error"),t=this.safeString(e,"code"),i=this.id+" "+this.json(n);this.throwExactlyMatchedException(this.exceptions,t,i)}}}},22444:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,AuthenticationError:a,ArgumentsRequired:n,InvalidNonce:o,BadRequest:h,ExchangeNotAvailable:d,PermissionDenied:c,AccountSuspended:l,RateLimitExceeded:u,InsufficientFunds:f,BadSymbol:p,InvalidOrder:m}=i(73449),{TICK_SIZE:g}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"latoken",name:"Latoken",countries:["KY"],version:"v2",rateLimit:1e3,has:{CORS:void 0,spot:!0,margin:!1,swap:void 0,future:void 0,option:!1,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchCurrencies:!0,fetchDepositWithdrawFees:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMyTrades:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPositionMode:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!1,fetchTransactions:!0,fetchTransfer:!1,fetchTransfers:!0,transfer:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/61511972-24c39f00-aa01-11e9-9f7c-471f1d6e5214.jpg",api:{rest:"https://api.latoken.com"},www:"https://latoken.com",doc:["https://api.latoken.com"],fees:"https://latoken.com/fees",referral:"https://latoken.com/invite?r=mvgp2djk"},api:{public:{get:{"book/{currency}/{quote}":1,"chart/week":1,"chart/week/{currency}/{quote}":1,currency:1,"currency/available":1,"currency/quotes":1,"currency/{currency}":1,pair:1,"pair/available":1,ticker:1,"ticker/{base}/{quote}":1,time:1,"trade/history/{currency}/{quote}":1,"trade/fee/{currency}/{quote}":1,"trade/feeLevels":1,"transaction/bindings":1}},private:{get:{"auth/account":1,"auth/account/currency/{currency}/{type}":1,"auth/order":1,"auth/order/getOrder/{id}":1,"auth/order/pair/{currency}/{quote}":1,"auth/order/pair/{currency}/{quote}/active":1,"auth/stopOrder":1,"auth/stopOrder/getOrder/{id}":1,"auth/stopOrder/pair/{currency}/{quote}":1,"auth/stopOrder/pair/{currency}/{quote}/active":1,"auth/trade":1,"auth/trade/pair/{currency}/{quote}":1,"auth/trade/fee/{currency}/{quote}":1,"auth/transaction":1,"auth/transaction/bindings":1,"auth/transaction/bindings/{currency}":1,"auth/transaction/{id}":1,"auth/transfer":1},post:{"auth/order/cancel":1,"auth/order/cancelAll":1,"auth/order/cancelAll/{currency}/{quote}":1,"auth/order/place":1,"auth/spot/deposit":1,"auth/spot/withdraw":1,"auth/stopOrder/cancel":1,"auth/stopOrder/cancelAll":1,"auth/stopOrder/cancelAll/{currency}/{quote}":1,"auth/stopOrder/place":1,"auth/transaction/depositAddress":1,"auth/transaction/withdraw":1,"auth/transaction/withdraw/cancel":1,"auth/transaction/withdraw/confirm":1,"auth/transaction/withdraw/resendCode":1,"auth/transfer/email":1,"auth/transfer/id":1,"auth/transfer/phone":1}}},precisionMode:g,fees:{trading:{feeSide:"get",tierBased:!1,percentage:!0,maker:this.parseNumber("0.0049"),taker:this.parseNumber("0.0049")}},commonCurrencies:{BUX:"Buxcoin",CBT:"Community Business Token",CTC:"CyberTronchain",DMD:"Diamond Coin",FREN:"Frenchie",GDX:"GoldenX",GEC:"Geco One",GEM:"NFTmall",GMT:"GMT Token",IMC:"IMCoin",MT:"Monarch",TPAY:"Tetra Pay",TRADE:"Smart Trade Coin",TSL:"Treasure SL",UNO:"Unobtanium",WAR:"Warrior Token"},exceptions:{exact:{INTERNAL_ERROR:r,SERVICE_UNAVAILABLE:d,NOT_AUTHORIZED:a,FORBIDDEN:c,BAD_REQUEST:h,NOT_FOUND:r,ACCESS_DENIED:c,REQUEST_REJECTED:r,HTTP_MEDIA_TYPE_NOT_SUPPORTED:h,MEDIA_TYPE_NOT_ACCEPTABLE:h,METHOD_ARGUMENT_NOT_VALID:h,VALIDATION_ERROR:h,ACCOUNT_EXPIRED:l,BAD_CREDENTIALS:a,COOKIE_THEFT:a,CREDENTIALS_EXPIRED:l,INSUFFICIENT_AUTHENTICATION:a,UNKNOWN_LOCATION:a,TOO_MANY_REQUESTS:u,INSUFFICIENT_FUNDS:f,ORDER_VALIDATION:m,BAD_TICKS:m},broad:{"invalid API key, signature or digest":a,"The API key was revoked":a,"request expired or bad":o,"For input string":h,"Unable to resolve currency by tag":p,"Can't find currency with tag":p,"Unable to place order because pair is in inactive state":p,"API keys are not available for FROZEN user":l}},options:{defaultType:"spot",types:{wallet:"ACCOUNT_TYPE_WALLET",spot:"ACCOUNT_TYPE_SPOT"},accounts:{ACCOUNT_TYPE_WALLET:"wallet",ACCOUNT_TYPE_SPOT:"spot"},fetchTradingFee:{method:"fetchPrivateTradingFee"}}})}nonce(){return this.milliseconds()-this.options.timeDifference}async fetchTime(e={}){const t=await this.publicGetTime(e);return this.safeInteger(t,"serverTime")}async fetchMarkets(e={}){const t=await this.fetchCurrenciesFromCache(e),i=await this.publicGetPair(e);this.safeValue(this.options,"adjustForTimeDifference",!0)&&await this.loadTimeDifference();const s=this.indexBy(t,"id"),r=[];for(let e=0;e<i.length;e++){const t=i[e],a=this.safeString(t,"id"),n=this.safeString(t,"baseCurrency"),o=this.safeString(t,"quoteCurrency"),h=this.safeValue(s,n),d=this.safeValue(s,o);if(void 0!==h&&void 0!==d){const e=this.safeCurrencyCode(this.safeString(h,"tag")),i=this.safeCurrencyCode(this.safeString(d,"tag")),s=i.toLowerCase(),c=this.capitalize(s),l=this.safeString(t,"status");r.push({id:a,symbol:e+"/"+i,base:e,quote:i,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:"PAIR_STATUS_ACTIVE"===l,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(t,"quantityTick"),price:this.safeNumber(t,"priceTick")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"minOrderQuantity"),max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"minOrderCost"+c),max:this.safeNumber(t,"maxOrderCost"+c)}},info:t})}}return r}async fetchCurrenciesFromCache(e={}){const t=this.safeValue(this.options,"fetchCurrencies",{}),i=this.safeInteger(t,"timestamp"),s=this.safeInteger(t,"expires",1e3),r=this.milliseconds();if(void 0===i||r-i>s){const i=await this.publicGetCurrency(e);this.options.fetchCurrencies=this.extend(t,{response:i,timestamp:r})}return this.safeValue(this.options.fetchCurrencies,"response")}async fetchCurrencies(e={}){const t=await this.fetchCurrenciesFromCache(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"id"),a=this.safeString(s,"tag"),n=this.safeCurrencyCode(a),o=this.safeNumber(s,"fee"),h=this.safeString(s,"type").split("_"),d=h.length,c=this.safeValue(h,d-1).toLowerCase(),l="CURRENCY_STATUS_ACTIVE"===this.safeString(s,"status"),u=this.safeString(s,"name");i[n]={id:r,code:n,info:s,name:u,type:c,active:l,deposit:void 0,withdraw:void 0,fee:o,precision:this.parseNumber(this.parsePrecision(this.safeString(s,"decimals"))),limits:{amount:{min:this.safeNumber(s,"minTransferAmount"),max:void 0},withdraw:{min:void 0,max:void 0}}}}return i}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetAuthAccount(e),i={info:t,timestamp:void 0,datetime:void 0};let s;const r=this.safeString2(this.options,"fetchBalance","defaultType","spot"),a=this.safeString(e,"type",r),n=this.safeValue(this.options,"types",{}),o=this.safeString(n,a,a),h=this.groupBy(t,"type"),d=this.safeValue(h,o,[]);for(let e=0;e<d.length;e++){const t=d[e],r=this.safeString(t,"currency"),a=this.safeInteger(t,"timestamp");void 0!==a&&(s=void 0===s?a:Math.max(s,a));const n=this.safeCurrencyCode(r),o=this.account();o.free=this.safeString(t,"available"),o.used=this.safeString(t,"blocked"),i[n]=o}return i.timestamp=s,i.datetime=this.iso8601(s),this.safeBalance(i)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={currency:s.baseId,quote:s.quoteId};void 0!==t&&(r.limit=t);const a=await this.publicGetBookCurrencyQuote(this.extend(r,i));return this.parseOrderBook(a,e,void 0,"bid","ask","price","quantity")}parseTicker(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t),r=this.safeString(e,"lastPrice"),a=this.safeString(e,"change24h"),n=this.nonce();return this.safeTicker({symbol:s,timestamp:n,datetime:this.iso8601(n),low:this.safeString(e,"low"),high:this.safeString(e,"high"),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:void 0,close:r,last:r,previousClose:void 0,change:a,percentage:void 0,average:void 0,baseVolume:void 0,quoteVolume:this.safeString(e,"volume24h"),info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={base:i.baseId,quote:i.quoteId},r=await this.publicGetTickerBaseQuote(this.extend(s,t));return this.parseTicker(r,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetTicker(t);return this.parseTickers(i,e)}parseTrade(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeString(e,"price"),r=this.safeString(e,"quantity"),a=this.safeString(e,"cost"),n=this.safeValue(e,"makerBuyer");let o=this.safeString(e,"direction");void 0===o?o=n?"sell":"buy":"TRADE_DIRECTION_BUY"===o?o="buy":"TRADE_DIRECTION_SELL"===o&&(o="sell");const h=n&&"buy"===o?"maker":"taker",d=this.safeString(e,"baseCurrency"),c=this.safeString(e,"quoteCurrency"),l=this.safeCurrencyCode(d),u=this.safeCurrencyCode(c),f=l+"/"+u;f in this.markets&&(t=this.market(f));const p=this.safeString(e,"id"),m=this.safeString(e,"order"),g=this.safeString(e,"fee");let y;return void 0!==g&&(y={cost:g,currency:u}),this.safeTrade({info:e,timestamp:i,datetime:this.iso8601(i),symbol:f,id:p,order:m,type:undefined,takerOrMaker:h,side:o,price:s,amount:r,cost:a,fee:y},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={currency:r.baseId,quote:r.quoteId};void 0!==i&&(a.limit=i);const n=await this.publicGetTradeHistoryCurrencyQuote(this.extend(a,s));return this.parseTrades(n,r,t,i)}async fetchTradingFee(e,t={}){let i=this.safeString(t,"method");if(t=this.omit(t,"method"),void 0===i){const e=this.safeValue(this.options,"fetchTradingFee",{});i=this.safeString(e,"method","fetchPrivateTradingFee")}return await this[i](e,t)}async fetchPublicTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={currency:i.baseId,quote:i.quoteId},r=await this.publicGetTradeFeeCurrencyQuote(this.extend(s,t));return{info:r,symbol:i.symbol,maker:this.safeNumber(r,"makerFee"),taker:this.safeNumber(r,"takerFee")}}async fetchPrivateTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={currency:i.baseId,quote:i.quoteId},r=await this.privateGetAuthTradeFeeCurrencyQuote(this.extend(s,t));return{info:r,symbol:i.symbol,maker:this.safeNumber(r,"makerFee"),taker:this.safeNumber(r,"takerFee")}}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a,n="privateGetAuthTrade";void 0!==e&&(a=this.market(e),r.currency=a.baseId,r.quote=a.quoteId,n="privateGetAuthTradePairCurrencyQuote"),void 0!==i&&(r.limit=i);const o=await this[n](this.extend(r,s));return this.parseTrades(o,a,t,i)}parseOrderStatus(e){return this.safeString({ORDER_STATUS_PLACED:"open",ORDER_STATUS_CLOSED:"closed",ORDER_STATUS_CANCELLED:"canceled"},e,e)}parseOrderType(e){return this.safeString({ORDER_TYPE_MARKET:"market",ORDER_TYPE_LIMIT:"limit"},e,e)}parseTimeInForce(e){return this.safeString({ORDER_CONDITION_GOOD_TILL_CANCELLED:"GTC",ORDER_CONDITION_IMMEDIATE_OR_CANCEL:"IOC",ORDER_CONDITION_FILL_OR_KILL:"FOK"},e,e)}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.safeInteger(e,"timestamp"),r=this.safeString(e,"baseCurrency"),a=this.safeString(e,"quoteCurrency"),n=this.safeCurrencyCode(r),o=this.safeCurrencyCode(a);let h;void 0!==n&&void 0!==o&&(h=n+"/"+o,h in this.markets&&(t=this.market(h)));const d=this.safeString(e,"side");let c;if(void 0!==d){const e=d.split("_"),t=e.length;c=this.safeStringLower(e,t-1)}const l=this.parseOrderType(this.safeString(e,"type")),u=this.safeString(e,"price"),f=this.safeString(e,"quantity"),p=this.safeString(e,"filled"),m=this.safeString(e,"cost");let g=this.parseOrderStatus(this.safeString(e,"status"));const y=this.safeString(e,"message");void 0!==y&&(y.indexOf("cancel")>=0?g="canceled":y.indexOf("accept")>=0&&(g="open"));const b=this.safeString(e,"clientOrderId"),v=this.parseTimeInForce(this.safeString(e,"condition"));return this.safeOrder({id:i,clientOrderId:b,info:e,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:void 0,status:g,symbol:h,type:l,timeInForce:v,postOnly:void 0,side:c,price:u,stopPrice:void 0,triggerPrice:void 0,cost:m,amount:f,filled:p,average:void 0,remaining:void 0,fee:void 0,trades:void 0},t)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new n(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={currency:r.baseId,quote:r.quoteId},o=await this.privateGetAuthOrderPairCurrencyQuoteActive(this.extend(a,s));return this.parseOrders(o,r,t,i)}async fetchOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a,n="privateGetAuthOrder";void 0!==e&&(a=this.market(e),r.currency=a.baseId,r.quote=a.quoteId,n="privateGetAuthOrderPairCurrencyQuote"),void 0!==i&&(r.limit=i);const o=await this[n](this.extend(r,s));return this.parseOrders(o,a,t,i)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privateGetAuthOrderGetOrderId(this.extend(s,i));return this.parseOrder(r)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=t.toUpperCase(),h={baseCurrency:n.baseId,quoteCurrency:n.quoteId,side:i.toUpperCase(),condition:"GTC",type:o,clientOrderId:this.uuid()};"LIMIT"===o&&(h.price=this.priceToPrecision(e,r)),h.quantity=this.amountToPrecision(e,s),h.timestamp=this.seconds();const d=await this.privatePostAuthOrderPlace(this.extend(h,a));return this.parseOrder(d,n)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privatePostAuthOrderCancel(this.extend(s,i));return this.parseOrder(r)}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};let s,r="privatePostAuthOrderCancelAll";void 0!==e&&(s=this.market(e),i.currency=s.baseId,i.quote=s.quoteId,r="privatePostAuthOrderCancelAllCurrencyQuote");return await this[r](this.extend(i,t))}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();const r=await this.privateGetAuthTransaction(this.extend({},s));let a;void 0!==e&&(a=this.currency(e));const n=this.safeValue(r,"content",[]);return this.parseTransactions(n,a,t,i)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=this.safeInteger(e,"timestamp"),r=this.safeString(e,"currency"),a=this.safeCurrencyCode(r,t),n=this.parseTransactionStatus(this.safeString(e,"status")),o=this.safeNumber(e,"amount"),h=this.safeString(e,"senderAddress"),d=this.safeString(e,"recipientAddress"),c=this.safeString(e,"transactionHash"),l=this.safeString(e,"memo");let u;const f=this.safeNumber(e,"transactionFee");void 0!==f&&(u={cost:f,currency:a});const p=this.parseTransactionType(this.safeString(e,"type"));return{info:e,id:i,txid:c,timestamp:s,datetime:this.iso8601(s),network:void 0,addressFrom:h,addressTo:d,address:d,tagFrom:void 0,tagTo:l,tag:l,type:p,amount:o,currency:a,status:n,updated:void 0,fee:u}}parseTransactionStatus(e){return this.safeString({TRANSACTION_STATUS_CONFIRMED:"ok",TRANSACTION_STATUS_EXECUTED:"ok",TRANSACTION_STATUS_CANCELLED:"canceled"},e,e)}parseTransactionType(e){return this.safeString({TRANSACTION_TYPE_DEPOSIT:"deposit",TRANSACTION_TYPE_WITHDRAWAL:"withdrawal"},e,e)}async fetchTransfers(e,t,i,s={}){await this.loadMarkets();const r=this.currency(e),a=await this.privateGetAuthTransfer(s),n=this.safeValue(a,"content",[]);return this.parseTransfers(n,r,t,i)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e);let n;n=s.indexOf("@")>=0?"privatePostAuthTransferEmail":36===s.length?"privatePostAuthTransferId":"privatePostAuthTransferPhone";const o={currency:a.id,recipient:s,value:this.currencyToPrecision(e,t)},h=await this[n](this.extend(o,r));return this.parseTransfer(h)}parseTransfer(e,t){const i=this.safeTimestamp(e,"timestamp"),s=this.safeString(e,"currency"),r=this.safeString(e,"status");return{info:e,id:this.safeString(e,"id"),timestamp:this.safeInteger(e,"timestamp"),datetime:this.iso8601(i),currency:this.safeCurrencyCode(s,t),amount:this.safeNumber(e,"transferringFunds"),fromAccount:this.safeString(e,"fromAccount"),toAccount:this.safeString(e,"toAccount"),status:this.parseTransferStatus(r)}}parseTransferStatus(e){return this.safeString({TRANSFER_STATUS_COMPLETED:"ok",TRANSFER_STATUS_PENDING:"pending",TRANSFER_STATUS_REJECTED:"failed",TRANSFER_STATUS_UNVERIFIED:"pending",TRANSFER_STATUS_CANCELLED:"canceled"},e,e)}sign(e,t="public",i="GET",s,r,a){const n="/"+this.version+"/"+this.implodeParams(e,s);let o=n;const h=this.omit(s,this.extractParams(e)),d=this.urlencode(h);if("GET"===i&&Object.keys(h).length&&(o+="?"+d),"private"===t){this.checkRequiredCredentials();const e=i+n+d,t=this.hmac(this.encode(e),this.encode(this.secret),"sha512");r={"X-LA-APIKEY":this.apiKey,"X-LA-SIGNATURE":t,"X-LA-DIGEST":"HMAC-SHA512"},"POST"===i&&(r["Content-Type"]="application/json",a=this.json(h))}return{url:this.urls.api.rest+o,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(!o)return;const c=this.safeString(o,"message"),l=this.id+" "+n;void 0!==c&&(this.throwExactlyMatchedException(this.exceptions.exact,c,l),this.throwBroadlyMatchedException(this.exceptions.broad,c,l));const u=this.safeValue(o,"error"),f=this.safeString(u,"message");if(void 0!==u||void 0!==f)throw this.throwExactlyMatchedException(this.exceptions.exact,u,l),this.throwBroadlyMatchedException(this.exceptions.broad,n,l),new r(l)}}},31524:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,DDoSProtection:a,AuthenticationError:n,InvalidOrder:o}=i(73449),{TICK_SIZE:h}=i(62115),d=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"lbank",name:"LBank",countries:["CN"],version:"v1",has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!1,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,withdraw:!0},timeframes:{"1m":"minute1","5m":"minute5","15m":"minute15","30m":"minute30","1h":"hour1","2h":"hour2","4h":"hour4","6h":"hour6","8h":"hour8","12h":"hour12","1d":"day1","1w":"week1"},urls:{logo:"https://user-images.githubusercontent.com/1294454/38063602-9605e28a-3302-11e8-81be-64b1e53c4cfb.jpg",api:{rest:"https://api.lbank.info"},www:"https://www.lbank.info",doc:"https://github.com/LBank-exchange/lbank-official-api-docs",fees:"https://www.lbank.info/fees.html",referral:"https://www.lbank.info/invitevip?icode=7QCY"},api:{public:{get:["currencyPairs","ticker","depth","trades","kline","accuracy"]},private:{post:["user_info","create_order","cancel_order","orders_info","orders_info_history","withdraw","withdrawCancel","withdraws","withdrawConfigs"]}},fees:{trading:{maker:this.parseNumber("0.001"),taker:this.parseNumber("0.001")},funding:{withdraw:{}}},commonCurrencies:{GMT:"GMT Token",PNT:"Penta",SHINJA:"SHINJA(1M)",VET_ERC20:"VEN"},options:{cacheSecretAsPem:!0},precisionMode:h})}async fetchMarkets(e={}){const t=await this.publicGetAccuracy(e),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=s.symbol,a=r.split("_");let n,o;a.length>2?(n=a[0]+"_"+a[1],o=a[2]):(n=a[0],o=a[1]);const h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o);i.push({id:r,symbol:h+"/"+d,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:!0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(s,"quantityAccuracy"))),price:this.parseNumber(this.parsePrecision(this.safeString(s,"priceAccuracy")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeFloat(s,"minTranQua"),max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:r})}return i}parseTicker(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t,"_")).symbol,r=this.safeInteger(e,"timestamp"),a=e;e=a.ticker;const n=this.safeString(e,"latest"),o=this.safeString(e,"change");return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:void 0,close:n,last:n,previousClose:void 0,change:void 0,percentage:o,average:void 0,baseVolume:this.safeString(e,"vol"),quoteVolume:this.safeString(e,"turnover"),info:a},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetTicker(this.extend(s,t));return this.parseTicker(r,i)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetTicker(this.extend({symbol:"all"},t)),s={};for(let e=0;e<i.length;e++){const t=this.parseTicker(i[e]);s[t.symbol]=t}return this.filterByArray(s,"symbol",e)}async fetchOrderBook(e,t=60,i={}){await this.loadMarkets();let s=60;void 0!==t&&(s=Math.min(t,s));const r=this.market(e),a={symbol:r.id,size:s},n=await this.publicGetDepth(this.extend(a,i));return this.parseOrderBook(n,r.symbol)}parseTrade(e,t){t=this.safeMarket(void 0,t);const i=this.safeInteger(e,"date_ms"),s=this.safeString(e,"price"),r=this.safeString(e,"amount"),a=this.parseNumber(s),n=this.parseNumber(r),o=this.parseNumber(d.stringMul(s,r)),h=this.safeString(e,"tid");let c=this.safeString(e,"type");const l=c.split("_");return c=l[0],{id:h,info:this.safeValue(e,"info",e),timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,order:void 0,type:undefined,side:c,takerOrMaker:void 0,price:a,amount:n,cost:o,fee:void 0}}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id,size:100};void 0!==t&&(a.time=parseInt(t)),void 0!==i&&(a.size=i);const n=await this.publicGetTrades(this.extend(a,s));return this.parseTrades(n,r,t,i)}parseOHLCV(e,t){return[this.safeTimestamp(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s=1e3,r={}){await this.loadMarkets();const a=this.market(e);if(void 0===s&&(s=100),void 0===i){const e=this.parseTimeframe(t);i=this.milliseconds()-1e3*e*s}const n={symbol:a.id,type:this.safeString(this.timeframes,t,t),size:s,time:parseInt(i/1e3)},o=await this.publicGetKline(this.extend(n,r));return this.parseOHLCVs(o,a,t,i,s)}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0},i=this.safeValue(e,"info",{}),s=this.safeValue(i,"free",{}),r=this.safeValue(i,"freeze",{}),a=this.safeValue(i,"asset",{}),n=Object.keys(s);for(let e=0;e<n.length;e++){const i=n[e],o=this.safeCurrencyCode(i),h=this.account();h.free=this.safeString(s,i),h.used=this.safeString(r,i),h.total=this.safeString(a,i),t[o]=h}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostUserInfo(e);return this.parseBalance(t)}parseOrderStatus(e){return this.safeString({"-1":"cancelled",0:"open",1:"open",2:"closed",4:"closed"},e)}parseOrder(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t,"_"),r=this.safeInteger(e,"create_time"),a=this.safeString(e,"price"),n=this.safeString(e,"amount"),o=this.safeString(e,"deal_amount"),h=this.safeString(e,"avg_price"),d=this.parseOrderStatus(this.safeString(e,"status")),c=this.safeString(e,"order_id"),l=this.safeString(e,"order_type"),u=this.safeString(e,"type");return this.safeOrder({id:c,clientOrderId:void 0,datetime:this.iso8601(r),timestamp:r,lastTradeTimestamp:void 0,status:d,symbol:s,type:l,timeInForce:void 0,postOnly:void 0,side:u,price:a,stopPrice:void 0,triggerPrice:void 0,cost:void 0,amount:n,filled:o,remaining:void 0,trades:void 0,fee:void 0,info:this.safeValue(e,"info",e),average:h},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);let o={symbol:n.id,type:i,amount:s};"market"===t?o.type+="_market":o.price=r;const h=await this.privatePostCreateOrder(this.extend(o,a));return o=this.omit(o,"type"),o.order_id=h.order_id,o.type=i,o.order_type=t,o.create_time=this.milliseconds(),o.info=h,this.parseOrder(o,n)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={symbol:this.market(t).id,order_id:e};return await this.privatePostCancelOrder(this.extend(s,i))}async fetchOrder(e,t,i={}){await this.loadMarkets();const s=this.market(t),r={symbol:s.id,order_id:e},a=await this.privatePostOrdersInfo(this.extend(r,i)),n=this.safeValue(a,"orders",[]),o=this.parseOrders(n,s);return 1===o.length?o[0]:o}async fetchOrders(e,t,i,s={}){await this.loadMarkets(),void 0===i&&(i=100);const r={symbol:this.market(e).id,current_page:1,page_length:i},a=await this.privatePostOrdersInfoHistory(this.extend(r,s)),n=this.safeValue(a,"orders",[]);return this.parseOrders(n,void 0,t,i)}async fetchClosedOrders(e,t,i,s={}){if(await this.loadMarkets(),void 0!==e){e=this.market(e).symbol}const r=await this.fetchOrders(e,t,i,s),a=this.filterBy(r,"status","closed"),n=this.filterBy(r,"status","cancelled"),o=this.arrayConcat(a,n);return this.filterBySymbolSinceLimit(o,e,t,i)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={assetCode:a.id,amount:t,account:i};void 0!==s&&(n.memo=s);const o=this.privatePostWithdraw(this.extend(n,r));return this.parseTransaction(o,a)}parseTransaction(e,t){return t=this.safeCurrency(void 0,t),{id:this.safeString2(e,"id","withdrawId"),txid:void 0,timestamp:void 0,datetime:void 0,network:void 0,addressFrom:void 0,address:void 0,addressTo:void 0,amount:void 0,type:void 0,currency:t.code,status:void 0,updated:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,comment:void 0,fee:void 0,info:e}}convertSecretToPem(e){const t=e.length-0;let i=parseInt(t/64);i=this.sum(i,1);let s="-----BEGIN PRIVATE KEY-----\n";for(let e=0;e<i;e++){const t=64*e,i=this.sum(t,64);s+=this.secret.slice(t,i)+"\n"}return s+"-----END PRIVATE KEY-----"}sign(e,t="public",i="GET",s={},r,a){const n=this.omit(s,this.extractParams(e));let o=this.urls.api.rest+"/"+this.version+"/"+this.implodeParams(e,s);if(o+=".do","public"===t)Object.keys(n).length&&(o+="?"+this.urlencode(n));else{this.checkRequiredCredentials();const e=this.keysort(this.extend({api_key:this.apiKey},s)),t=this.rawencode(e),i=this.hash(this.encode(t)).toUpperCase();let n;this.safeValue(this.options,"cacheSecretAsPem",!0)?(n=this.safeValue(this.options,"pem"),void 0===n&&(n=this.convertSecretToPem(this.secret),this.options.pem=n)):n=this.convertSecretToPem(this.secret),e.sign=this.rsa(i,n,"RS256"),a=this.urlencode(e),r={"Content-Type":"application/x-www-form-urlencoded"}}return{url:o,method:i,body:a,headers:r}}handleErrors(e,t,i,s,h,d,c,l,u){if(void 0===c)return;if("false"===this.safeString(c,"result")){const e=this.safeString(c,"error_code"),t=this.safeString({1e4:"Internal error",10001:"The required parameters can not be empty",10002:"verification failed",10003:"Illegal parameters",10004:"User requests are too frequent",10005:"Key does not exist",10006:"user does not exist",10007:"Invalid signature",10008:"This currency pair is not supported",10009:"Limit orders can not be missing orders and the number of orders",10010:"Order price or order quantity must be greater than 0",10011:"Market orders can not be missing the amount of the order",10012:"market sell orders can not be missing orders",10013:"is less than the minimum trading position 0.001",10014:"Account number is not enough",10015:"The order type is wrong",10016:"Account balance is not enough",10017:"Abnormal server",10018:"order inquiry can not be more than 50 less than one",10019:"withdrawal orders can not be more than 3 less than one",10020:"less than the minimum amount of the transaction limit of 0.001",10022:"Insufficient key authority"},e,this.json(c));throw new(this.safeValue({10002:n,10004:a,10005:n,10006:n,10007:n,10009:o,10010:o,10011:o,10012:o,10013:o,10014:o,10015:o,10016:o,10022:n},e,r))(t)}}}},11044:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,InvalidAddress:a,DuplicateOrderId:n,ArgumentsRequired:o,InsufficientFunds:h,InvalidOrder:d,InvalidNonce:c,AuthenticationError:l,RateLimitExceeded:u,PermissionDenied:f,BadRequest:p,BadSymbol:m}=i(73449),{TICK_SIZE:g}=i(62115),y=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"lbank2",name:"LBank",countries:["CN"],version:"v2",rateLimit:20,has:{CORS:!1,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!1,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchIsolatedPositions:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFees:!0,fetchTransactionFees:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,withdraw:!1},timeframes:{"1m":"minute1","5m":"minute5","15m":"minute15","30m":"minute30","1h":"hour1","2h":"hour2","4h":"hour4","6h":"hour6","8h":"hour8","12h":"hour12","1d":"day1","1w":"week1"},urls:{logo:"https://user-images.githubusercontent.com/1294454/38063602-9605e28a-3302-11e8-81be-64b1e53c4cfb.jpg",api:{rest:"https://api.lbank.info"},api2:"https://api.lbkex.com",www:"https://www.lbank.info",doc:"https://www.lbank.info/en-US/docs/index.html",fees:"https://lbankinfo.zendesk.com/hc/en-gb/articles/360012072873-Trading-Fees",referral:"https://www.lbank.info/invitevip?icode=7QCY"},api:{public:{get:{currencyPairs:2.5,accuracy:2.5,usdToCny:2.5,withdrawConfigs:2.5,timestamp:2.5,"ticker/24hr":2.5,ticker:2.5,depth:2.5,incrDepth:2.5,trades:2.5,kline:2.5,"supplement/system_ping":2.5,"supplement/incrDepth":2.5,"supplement/trades":2.5,"supplement/ticker/price":2.5,"supplement/ticker/bookTicker":2.5},post:{"supplement/system_status":2.5}},private:{post:{user_info:2.5,"subscribe/get_key":2.5,"subscribe/refresh_key":2.5,"subscribe/destroy_key":2.5,get_deposit_address:2.5,deposit_history:2.5,create_order:1,batch_create_order:1,cancel_order:1,cancel_clientOrders:1,orders_info:2.5,orders_info_history:2.5,order_transaction_detail:2.5,transaction_history:2.5,orders_info_no_deal:2.5,withdraw:2.5,withdrawCancel:2.5,withdraws:2.5,"supplement/user_info":2.5,"supplement/withdraw":2.5,"supplement/deposit_history":2.5,"supplement/withdraws":2.5,"supplement/get_deposit_address":2.5,"supplement/asset_detail":2.5,"supplement/customer_trade_fee":2.5,"supplement/api_Restrictions":2.5,"supplement/system_ping":2.5,"supplement/create_order_test":1,"supplement/create_order":1,"supplement/cancel_order":1,"supplement/cancel_order_by_symbol":1,"supplement/orders_info":2.5,"supplement/orders_info_no_deal":2.5,"supplement/orders_info_history":2.5,"supplement/user_info_account":2.5,"supplement/transaction_history":2.5}}},fees:{trading:{maker:this.parseNumber("0.001"),taker:this.parseNumber("0.001")},funding:{withdraw:{}}},commonCurrencies:{VET_ERC20:"VEN",PNT:"Penta"},precisionMode:g,options:{cacheSecretAsPem:!0,createMarketBuyOrderRequiresPrice:!0,fetchTrades:{method:"publicGetTrades"},fetchTransactionFees:{method:"fetchPrivateTransactionFees"},fetchDepositWithdrawFees:{method:"fetchPrivateDepositWithdrawFees"},fetchDepositAddress:{method:"fetchDepositAddressDefault"},createOrder:{method:"privatePostSupplementCreateOrder"},fetchOrder:{method:"fetchOrderSupplement"},fetchBalance:{method:"privatePostSupplementUserInfo"},networks:{ERC20:"erc20",ETH:"erc20",TRC20:"trc20",TRX:"trc20",OMNI:"omni",ASA:"asa",BEP20:"bep20(bsc)",BSC:"bep20(bsc)",HT:"heco",BNB:"bep2",BTC:"btc",DOGE:"dogecoin",MATIC:"matic",POLYGON:"matic",OEC:"oec",BTCTRON:"btctron",XRP:"xrp"},"inverse-networks":{erc20:"ERC20",trc20:"TRC20",omni:"OMNI",asa:"ASA","bep20(bsc)":"BSC",bep20:"BSC",heco:"HT",bep2:"BNB",btc:"BTC",dogecoin:"DOGE",matic:"MATIC",oec:"OEC",btctron:"BTCTRON",xrp:"XRP"},defaultNetworks:{USDT:"TRC20"}}})}async fetchMarkets(e={}){const t=await this.publicGetAccuracy(),i=this.safeValue(t,"data"),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"symbol"),a=r.split("_"),n=a[0],o=a[1],h=n.toUpperCase(),d=o.toUpperCase();let c=h+"/"+d;const l={"3l":!0,"5l":!0,"3s":!0,"5s":!0},u=n.slice(-2),f=this.safeValue(l,u,!1);let p;f&&(c+=":"+d),!0===f&&(p=!0),s.push({id:r,symbol:c,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:f,future:!1,option:!1,active:!0,contract:f,linear:p,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"quantityAccuracy"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"priceAccuracy")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"minTranQua"),max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return s}parseTicker(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t),r=this.safeInteger(e,"timestamp"),a=this.safeValue(e,"ticker");return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeString(a,"high"),low:this.safeString(a,"low"),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:void 0,close:void 0,last:this.safeString(a,"latest"),previousClose:void 0,change:void 0,percentage:this.safeString(a,"change"),average:void 0,baseVolume:this.safeString(a,"vol"),quoteVolume:this.safeString(a,"turnover"),info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetTicker24hr(this.extend(s,t)),a=this.safeValue(r,"data",[]),n=this.safeValue(a,0,{});return this.parseTicker(n,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetTicker24hr(this.extend({symbol:"all"},t)),s=this.safeValue(i,"data",[]);return this.parseTickers(s,e)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);void 0===t&&(t=60);const r={symbol:s.id,size:t},a=(await this.publicGetDepth(this.extend(r,i))).data,n=this.milliseconds();return this.parseOrderBook(a,s.symbol,n)}parseTrade(e,t){let i=this.safeInteger2(e,"date_ms","time");void 0===i&&(i=this.safeInteger(e,"dealTime"));let s=this.safeString2(e,"amount","qty");void 0===s&&(s=this.safeString(e,"dealQuantity"));let r=this.safeString(e,"price");void 0===r&&(r=this.safeString(e,"dealPrice"));let a=this.safeString(e,"quoteQty");void 0===a&&(a=this.safeString(e,"dealVolumePrice"));let n,o,h=this.safeString2(e,"tradeType","type");if(void 0!==h){const e=h.split("_");h=this.safeString(e,0);const t=this.safeString(e,1);n="limit",o="taker",void 0!==t&&("market"===t?n="market":"maker"===t&&(o="maker"))}let d=this.safeString2(e,"tid","id");void 0===d&&(d=this.safeString(e,"txUuid"));const c=this.safeString(e,"orderUuid"),l=this.safeSymbol(void 0,t);let u;const f=this.safeString(e,"tradeFee");return void 0!==f&&(u={cost:f,currency:void 0,rate:this.safeString(e,"tradeFeeRate")}),this.safeTrade({timestamp:i,datetime:this.iso8601(i),symbol:l,id:d,order:c,type:n,takerOrMaker:o,side:h,price:r,amount:s,cost:a,fee:u,info:e},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==t&&(a.time=t),a.size=void 0!==i?i:600;let n=this.safeString(s,"method");if(s=this.omit(s,"method"),void 0===n){const e=this.safeValue(this.options,"fetchTrades",{});n=this.safeString(e,"method","publicGetTrades")}const o=await this[n](this.extend(a,s)),h=this.safeValue(o,"data",[]);return this.parseTrades(h,r,t,i)}parseOHLCV(e,t){return[this.safeTimestamp(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);if(void 0===s&&(s=100),void 0===i){const e=this.parseTimeframe(t);i=this.milliseconds()-1e3*e*s}const n={symbol:a.id,type:this.safeString(this.timeframes,t,t),time:parseInt(i/1e3),size:s},o=await this.publicGetKline(this.extend(n,r)),h=this.safeValue(o,"data",[]);return this.parseOHLCVs(h,a,t,i,s)}parseBalance(e){const t=this.safeInteger(e,"ts"),i={info:e,timestamp:t,datetime:this.iso8601(t)},s=this.safeValue(e,"data");if(void 0!==this.safeValue(s,"toBtc")){const e=this.safeValue(s,"freeze",{}),t=this.safeValue(s,"free",{}),r=Object.keys(t);for(let s=0;s<r.length;s++){const a=r[s],n=this.safeCurrencyCode(a),o=this.account();o.used=this.safeString(e,a),o.free=this.safeString(t,a),i[n]=o}return this.safeBalance(i)}const r=this.safeValue(s,"balances");if(void 0!==r){for(let e=0;e<r.length;e++){const t=r[e],s=this.safeString(t,"asset"),a=this.safeCurrencyCode(s),n=this.account();n.free=this.safeString(t,"free"),n.used=this.safeString(t,"locked"),i[a]=n}return this.safeBalance(i)}if(!0===Array.isArray(s)){for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"coin"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(t,"usableAmt"),n.used=this.safeString(t,"freezeAmt"),i[a]=n}return this.safeBalance(i)}}async fetchBalance(e={}){await this.loadMarkets();let t=this.safeString(e,"method");if(void 0===t){const e=this.safeValue(this.options,"fetchBalance",{});t=this.safeString(e,"method","privatePostSupplementUserInfo")}const i=await this[t]();return this.parseBalance(i)}parseTradingFee(e,t){const i=this.safeString(e,"symbol");return{info:e,symbol:this.safeSymbol(i),maker:this.safeNumber(e,"makerCommission"),taker:this.safeNumber(e,"takerCommission")}}async fetchTradingFee(e,t={}){const i=this.market(e);return await this.fetchTradingFees(this.extend(t,{category:i.id}))}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privatePostSupplementCustomerTradeFee(this.extend({},e)),i=this.safeValue(t,"data",[]),s={};for(let e=0;e<i.length;e++){const t=this.parseTradingFee(i[e]);s[t.symbol]=t}return s}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=this.safeString2(a,"custom_id","clientOrderId"),h=this.safeValue(a,"postOnly",!1),c=this.safeStringUpper(a,"timeInForce");a=this.omit(a,["custom_id","clientOrderId","timeInForce","postOnly"]);const l={symbol:n.id},u="IOC"===c,f="FOK"===c,p=h||"PO"===c;if("market"===t&&(u||f||p))throw new d(this.id+" createOrder () does not allow market FOK, IOC, or postOnly orders. Only limit IOC, FOK, and postOnly orders are allowed");if("limit"===t)l.type=i,l.price=this.priceToPrecision(e,r),l.amount=this.amountToPrecision(e,s),u?l.type=i+"_ioc":f?l.type=i+"_fok":p&&(l.type=i+"_maker");else if("market"===t)if("sell"===i)l.type=i+"_market",l.amount=this.amountToPrecision(e,s);else if("buy"===i)if(l.type=i+"_market",this.options.createMarketBuyOrderRequiresPrice){if(void 0===r)throw new d(this.id+" createOrder () requires the price argument with market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply the price argument to createOrder() call if you want the cost to be calculated for you from price and amount, or, alternatively, add .options['createMarketBuyOrderRequiresPrice'] = false to supply the cost in the amount argument (the exchange-specific behaviour)");{const t=this.numberToString(s),i=this.numberToString(r),a=y.stringMul(t,i),n=this.parseNumber(a);l.price=this.priceToPrecision(e,n)}}else l.price=s;let m;if(void 0!==o&&(l.custom_id=o),m=this.safeString(a,"method"),a=this.omit(a,"method"),void 0===m){const e=this.safeValue(this.options,"createOrder",{});m=this.safeString(e,"method","privatePostSupplementCreateOrder")}const g=await this[m](this.extend(l,a)),b=this.safeValue(g,"data",{});return{id:this.safeString(b,"order_id"),info:b}}parseOrderStatus(e){return this.safeString({"-1":"canceled",0:"open",1:"open",2:"closed",3:"canceled",4:"closed"},e,e)}parseOrder(e,t){const i=this.safeString2(e,"orderId","order_id"),s=this.safeString2(e,"clientOrderId","custom_id"),r=this.safeInteger2(e,"time","create_time"),a=this.safeString(e,"status"),n=this.safeString(e,"symbol");let o;t=this.safeMarket(n,t);let h=!1,d="limit";const c=this.safeString(e,"type"),l=c.split("_"),u=this.safeString(l,0),f=this.safeString(l,1);"market"===f&&(d="market"),"maker"===f&&(h=!0,o="PO"),"ioc"===f&&(o="IOC"),"fok"===f&&(o="FOK");const p=this.safeString(e,"price"),m=this.safeString(e,"cummulativeQuoteQty");let g;"buy_market"!==c&&(g=this.safeString2(e,"origQty","amount"));const y=this.safeString2(e,"executedQty","deal_amount");return this.safeOrder({id:i,clientOrderId:s,datetime:this.iso8601(r),timestamp:r,lastTradeTimestamp:void 0,status:this.parseOrderStatus(a),symbol:t.symbol,type:d,timeInForce:o,postOnly:h,side:u,price:p,stopPrice:void 0,triggerPrice:void 0,cost:m,amount:g,filled:y,remaining:void 0,trades:void 0,fee:void 0,info:e,average:void 0},t)}async fetchOrder(e,t,i={}){await this.loadMarkets();let s=this.safeString(i,"method");if(void 0===s){const e=this.safeValue(this.options,"fetchOrder",{});s=this.safeString(e,"method","fetchOrderSupplement")}return await this[s](e,t,i)}async fetchOrderSupplement(e,t,i={}){if(await this.loadMarkets(),void 0===t)throw new o(this.id+" fetchOrder () requires a symbol argument");const s={symbol:this.market(t).id,orderId:e},r=await this.privatePostSupplementOrdersInfo(this.extend(s,i)),a=this.safeValue(r,"data",{});return this.parseOrder(a)}async fetchOrderDefault(e,t,i={}){if(await this.loadMarkets(),void 0===t)throw new o(this.id+" fetchOrder () requires a symbol argument");const s={symbol:this.market(t).id,order_id:e},r=await this.privatePostOrdersInfo(this.extend(s,i)),a=this.safeValue(r,"data",[]),n=a.length;if(1===n)return this.parseOrder(a[0]);{const e=[];for(let t=0;t<n;t++){const i=this.parseOrder(a[t]);e.push(i)}return e}}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchMyTrades () requires a symbol argument");await this.loadMarkets();const r=this.market(e);t=this.safeValue(s,"start_date",t),s=this.omit(s,"start_date");const a={symbol:r.id};void 0!==i&&(a.size=i),void 0!==t&&(a.start_date=this.ymd(t,"-"));const n=await this.privatePostTransactionHistory(this.extend(a,s)),h=this.safeValue(n,"data",[]);return this.parseTrades(h,r,t,i)}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e);void 0===i&&(i=100);const a={symbol:r.id,current_page:1,page_length:i},n=await this.privatePostSupplementOrdersInfoHistory(this.extend(a,s)),h=this.safeValue(n,"data",{}),d=this.safeValue(h,"orders",[]);return this.parseOrders(d,r,t,i)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e);void 0===i&&(i=100);const a={symbol:r.id,current_page:1,page_length:i},n=await this.privatePostSupplementOrdersInfoNoDeal(this.extend(a,s)),h=this.safeValue(n,"data",{}),d=this.safeValue(h,"orders",[]);return this.parseOrders(d,r,t,i)}async cancelOrder(e,t,i={}){if(void 0===t)throw new o(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.safeString2(i,"origClientOrderId","clientOrderId");i=this.omit(i,["origClientOrderId","clientOrderId"]);const r={symbol:this.market(t).id};void 0!==s&&(r.origClientOrderId=s),r.orderId=e;const a=await this.privatePostSupplementCancelOrder(this.extend(r,i));return this.safeValue(a,"data",{})}async cancelAllOrders(e,t={}){if(void 0===e)throw new o(this.id+" cancelAllOrders() requires a symbol argument");await this.loadMarkets();const i={symbol:this.market(e).id},s=await this.privatePostSupplementCancelOrderBySymbol(this.extend(i,t));return this.safeValue(s,"data",[])}getNetworkCodeForCurrency(e,t){const i=this.safeValue(this.options,"defaultNetworks"),s=this.safeStringUpper(i,e),r=this.safeValue(this.options,"networks",{});let a=this.safeStringUpper(t,"network",s);return a=this.safeString(r,a,a),a}async fetchDepositAddress(e,t={}){await this.loadMarkets();let i=this.safeString(t,"method");if(t=this.omit(t,"method"),void 0===i){const e=this.safeValue(this.options,"fetchDepositAddress",{});i=this.safeString(e,"method","fetchPrivateTradingFees")}return await this[i](e,t)}async fetchDepositAddressDefault(e,t={}){await this.loadMarkets();const i={assetCode:this.currency(e).id},s=this.getNetworkCodeForCurrency(e,t);void 0!==s&&(i.netWork=s,t=this.omit(t,"network"));const r=await this.privatePostGetDepositAddress(this.extend(i,t)),a=this.safeValue(r,"data"),n=this.safeString(a,"address"),o=this.safeString(a,"memo"),h=this.safeString(a,"netWork"),d=this.safeValue(this.options,"inverse-networks",{});return{currency:e,address:n,tag:o,network:this.safeStringUpper(d,h,h),info:r}}async fetchDepositAddressSupplement(e,t={}){await this.loadMarkets();const i={coin:this.currency(e).id},s=this.safeValue(this.options,"networks");let r=this.safeStringUpper(t,"network");r=this.safeString(s,r,r),void 0!==r&&(i.networkName=r,t=this.omit(t,"network"));const a=await this.privatePostSupplementGetDepositAddress(this.extend(i,t)),n=this.safeValue(a,"data"),o=this.safeString(n,"address"),h=this.safeString(n,"memo"),d=this.safeValue(this.options,"inverse-networks",{});return{currency:e,address:o,tag:h,network:this.safeStringUpper(d,r,r),info:a}}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.safeString(r,"fee");if(r=this.omit(r,"fee"),void 0===a)throw new o(this.id+" withdraw () requires a fee argument to be supplied in params, the relevant coin network fee can be found by calling fetchDepositWithdrawFees (), note: if no network param is supplied then the default network will be used, this can also be found in fetchDepositWithdrawFees ()");const n={address:i,coin:this.currency(e).id,amount:t,fee:a};void 0!==s&&(n.memo=s);const h=this.safeStringUpper2(r,"network","networkName");r=this.omit(r,["network","networkName"]);const d=this.safeValue(this.options,"networks"),c=this.safeString(d,h,h);void 0!==c&&(n.networkName=c);const l=await this.privatePostSupplementWithdraw(this.extend(n,r)),u=this.safeValue(l,"data",{});return{info:u,id:this.safeString(u,"withdrawId")}}parseTransactionStatus(e,t){return this.safeString(this.safeValue({deposit:{1:"pending",2:"ok",3:"failed",4:"canceled",5:"transfer"},withdrawal:{1:"pending",2:"canceled",3:"failed",4:"ok"}},t,{}),e,e)}parseTransaction(e,t){const i=this.safeString(e,"id");let s;s=void 0===i?"deposit":"withdrawal";const r=this.safeString(e,"txId"),a=this.safeInteger2(e,"insertTime","applyTime"),n=this.safeValue(this.options,"inverse-networks",{}),o=this.safeString(e,"networkName"),h=this.safeString(n,o,o),d=this.safeString(e,"address");let c,l;"deposit"===s?c=d:l=d;const u=this.safeNumber(e,"amount"),f=this.safeString2(e,"coin","coid"),p=this.safeCurrencyCode(f,t),m=this.parseTransactionStatus(this.safeString(e,"status"),s);let g;const y=this.safeNumber(e,"fee");return void 0!==y&&(g={cost:y,currency:p}),{info:e,id:i,txid:r,timestamp:a,datetime:this.iso8601(a),network:h,address:d,addressTo:l,addressFrom:c,tag:void 0,tagTo:void 0,tagFrom:void 0,type:s,amount:u,currency:p,status:m,updated:void 0,comment:void 0,internal:"transfer"===m,fee:g}}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.coin=a.id),void 0!==t&&(r.startTime=t);const n=await this.privatePostSupplementDepositHistory(this.extend(r,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"depositOrders",[]);return this.parseTransactions(h,a,t,i)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.coin=a.id),void 0!==t&&(r.startTime=t);const n=await this.privatePostSupplementWithdraws(this.extend(r,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"withdraws",[]);return this.parseTransactions(h,a,t,i)}async fetchTransactionFees(e,t={}){await this.loadMarkets();let i;if(!0===this.checkRequiredCredentials(!1)){let e=this.safeString(t,"method");if(t=this.omit(t,"method"),void 0===e){const t=this.safeValue(this.options,"fetchTransactionFees",{});e=this.safeString(t,"method","fetchPrivateTransactionFees")}i=await this[e](t)}else i=await this.fetchPublicTransactionFees(t);return i}async fetchPrivateTransactionFees(e={}){await this.loadMarkets();const t=await this.privatePostSupplementUserInfo(),i=this.safeValue(t,"data",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"coin"),a=this.safeCurrencyCode(r),n=this.safeValue(t,"networkList",[]);s[a]={};for(let e=0;e<n.length;e++){const t=n[e],i=this.safeString(t,"name"),r=this.safeString(this.options["inverse-networks"],i,i),o=this.safeNumber(t,"withdrawFee");void 0!==o&&(s[a][r]=o)}}return{withdraw:s,deposit:{},info:t}}async fetchPublicTransactionFees(e={}){await this.loadMarkets();const t=this.safeString2(e,"coin","assetCode");e=this.omit(e,["coin","assetCode"]);const i={};if(void 0!==t){const e=this.currency(t);i.assetCode=e.id}const s=await this.publicGetWithdrawConfigs(this.extend(i,e)),r=this.safeValue(s,"data",[]),a={};for(let e=0;e<r.length;e++){const t=r[e];if("true"===this.safeValue(t,"canWithDraw")){const e=this.safeString(t,"assetCode"),i=this.safeCurrencyCode(e),s=this.safeString(t,"chain");let r=this.safeString(this.options["inverse-networks"],s,s);void 0===r&&(r=i);const n=this.safeString(t,"fee");void 0===a[i]&&(a[i]={}),a[i][r]=this.parseNumber(n)}}return{withdraw:a,deposit:{},info:s}}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();let i;if(!0===this.checkRequiredCredentials(!1)){if(i=this.safeString(t,"method"),t=this.omit(t,"method"),void 0===i){const e=this.safeValue(this.options,"fetchDepositWithdrawFees",{});i=this.safeString(e,"method","fetchPrivateDepositWithdrawFees")}}else i="fetchPublicDepositWithdrawFees";return await this[i](e,t)}async fetchPrivateDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.privatePostSupplementUserInfo(t),s=this.safeValue(i,"data",[]);return this.parseDepositWithdrawFees(s,e,"coin")}async fetchPublicDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.publicGetWithdrawConfigs(this.extend({},t)),s=this.safeValue(i,"data",[]);return this.parsePublicDepositWithdrawFees(s,e)}parsePublicDepositWithdrawFees(e,t){const i={};for(let s=0;s<e.length;s++){const r=e[s];if(!0===this.safeValue(r,"canWithDraw")){const e=this.safeString(r,"assetCode"),s=this.safeCurrencyCode(e);if(void 0===t||this.inArray(s,t)){const e=this.safeNumber(r,"fee");if(void 0!==e){void 0===this.safeValue(i,s)?i[s]=this.depositWithdrawFee([r]):i[s].info.push(r);const t=this.safeString(r,"chain"),a=this.safeString(this.options["inverse-networks"],t,t);void 0!==a?i[s].networks[a]={withdraw:{fee:e,percentage:void 0},deposit:{fee:void 0,percentage:void 0}}:i[s].withdraw={fee:e,percentage:void 0}}}}}return i}parseDepositWithdrawFee(e,t){const i=this.depositWithdrawFee(e),s=this.safeValue(e,"networkList",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"name"),a=this.safeStringUpper(this.options["inverse-networks"],r,r),n=this.safeNumber(t,"withdrawFee"),o=this.safeValue(t,"isDefault");void 0!==n&&(o&&(i.withdraw={fee:n,percentage:void 0}),i.networks[a]={withdraw:{fee:n,percentage:void 0},deposit:{fee:void 0,percentage:void 0}})}return i}sign(e,t="public",i="GET",s={},r,a){let n=this.omit(s,this.extractParams(e)),o=this.urls.api.rest+"/"+this.version+"/"+this.implodeParams(e,s);if(o+=".do","public"===t)Object.keys(n).length&&(o+="?"+this.urlencode(this.keysort(n)));else{this.checkRequiredCredentials();const e=this.milliseconds().toString(),t=this.uuid22()+this.uuid16();let i;n=this.extend({api_key:this.apiKey},n),i=this.secret.length>32?"RSA":"HmacSHA256";const s=this.rawencode(this.keysort(this.extend({echostr:t,signature_method:i,timestamp:e},n))),o=this.encode(s),h=this.hash(o).toUpperCase();let d;if("RSA"===i){let e;this.safeValue(this.options,"cacheSecretAsPem",!0)?(e=this.safeValue(this.options,"pem"),void 0===e&&(e=this.convertSecretToPem(this.encode(this.secret)),this.options.pem=e)):e=this.convertSecretToPem(this.encode(this.secret)),d=this.rsa(h,e)}else"HmacSHA256"===i&&(d=this.hmac(this.encode(h),this.encode(this.secret)));n.sign=d,a=this.urlencode(this.keysort(n)),r={"Content-Type":"application/x-www-form-urlencoded",timestamp:e,signature_method:i,echostr:t}}return{url:o,method:i,body:a,headers:r}}convertSecretToPem(e){const t=e.length-0;let i=parseInt(t/64);i=this.sum(i,1);let s="-----BEGIN PRIVATE KEY-----\n";for(let e=0;e<i;e++){const t=64*e,i=this.sum(t,64);s+=this.secret.slice(t,i)+"\n"}return s+"-----END PRIVATE KEY-----"}handleErrors(e,t,i,s,o,g,y,b,v){if(void 0===y)return;if("false"===this.safeString(y,"result")){const e=this.safeString(y,"error_code"),t=this.safeString({1e4:"Internal error",10001:"The required parameters can not be empty",10002:"Validation failed",10003:"Invalid parameter",10004:"Request too frequent",10005:"Secret key does not exist",10006:"User does not exist",10007:"Invalid signature",10008:"Invalid Trading Pair",10009:"Price and/or Amount are required for limit order",10010:"Price and/or Amount must be less than minimum requirement",10013:"The amount is too small",10014:"Insufficient amount of money in the account",10015:"Invalid order type",10016:"Insufficient account balance",10017:"Server Error",10018:"Page size should be between 1 and 50",10019:"Cancel NO more than 3 orders in one request",10020:"Volume < 0.001",10021:"Price < 0.01",10022:"Invalid authorization",10023:"Market Order is not supported yet",10024:"User cannot trade on this pair",10025:"Order has been filled",10026:"Order has been cancelld",10027:"Order is cancelling",10028:"Wrong query time",10029:"from is not in the query time",10030:"from do not match the transaction type of inqury",10031:"echostr length must be valid and length must be from 30 to 40",10033:"Failed to create order",10036:"customID duplicated",10100:"Has no privilege to withdraw",10101:"Invalid fee rate to withdraw",10102:"Too little to withdraw",10103:"Exceed daily limitation of withdraw",10104:"Cancel was rejected",10105:"Request has been cancelled",10106:"None trade time",10107:"Start price exception",10108:"can not create order",10109:"wallet address is not mapping",10110:"transfer fee is not mapping",10111:"mount > 0",10112:"fee is too lower",10113:"transfer fee is 0",10600:"intercepted by replay attacks filter, check timestamp",10601:"Interface closed unavailable",10701:"invalid asset code",10702:"not allowed deposit"},e,this.json(y));throw new(this.safeValue({10001:p,10002:l,10003:p,10004:u,10005:l,10006:l,10007:l,10008:m,10009:d,10010:d,10013:d,10014:h,10015:d,10016:h,10017:r,10018:p,10019:p,10020:p,10021:d,10022:f,10023:d,10024:f,10025:d,10026:d,10027:d,10028:p,10029:p,10030:p,10031:c,10033:r,10036:n,10100:f,10101:p,10102:h,10103:r,10104:r,10105:r,10106:p,10107:p,10108:r,10109:a,10110:r,10111:p,10112:p,10113:p,10600:p,10601:r,10701:m,10702:f},e,r))(t)}}}},85439:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a}=i(73449),{TICK_SIZE:n}=i(62115),o=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"luno",name:"luno",countries:["GB","SG","ZA"],rateLimit:200,version:"1",pro:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,fetchAccounts:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLedger:!0,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!1,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1},urls:{referral:"https://www.luno.com/invite/44893A",logo:"https://user-images.githubusercontent.com/1294454/27766607-8c1a69d8-5ede-11e7-930c-540b5eb9be24.jpg",api:{public:"https://api.luno.com/api",private:"https://api.luno.com/api",exchange:"https://api.luno.com/api/exchange"},www:"https://www.luno.com",doc:["https://www.luno.com/en/api","https://npmjs.org/package/bitx","https://github.com/bausmeier/node-bitx"]},api:{exchange:{get:{markets:1}},public:{get:{orderbook:1,orderbook_top:1,ticker:1,tickers:1,trades:1}},private:{get:{"accounts/{id}/pending":1,"accounts/{id}/transactions":1,balance:1,beneficiaries:1,fee_info:1,funding_address:1,listorders:1,listtrades:1,"orders/{id}":1,"quotes/{id}":1,withdrawals:1,"withdrawals/{id}":1,transfers:1},post:{accounts:1,"accounts/{id}/name":1,postorder:1,marketorder:1,stoporder:1,funding_address:1,withdrawals:1,send:1,quotes:1,"oauth2/grant":1},put:{"accounts/{id}/name":1,"quotes/{id}":1},delete:{"quotes/{id}":1,"withdrawals/{id}":1}}},fees:{trading:{tierBased:!0,percentage:!0,taker:this.parseNumber("0.001"),maker:this.parseNumber("0")}},precisionMode:n})}async fetchMarkets(e={}){const t=await this.exchangeGetMarkets(e),i=[],s=this.safeValue(t,"markets",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"market_id"),a=this.safeString(t,"base_currency"),n=this.safeString(t,"counter_currency"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=this.safeString(t,"trading_status");i.push({id:r,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:"ACTIVE"===d,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"volume_scale"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"price_scale")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"min_volume"),max:this.safeNumber(t,"max_volume")},price:{min:this.safeNumber(t,"min_price"),max:this.safeNumber(t,"max_price")},cost:{min:void 0,max:void 0}},info:t})}return i}async fetchAccounts(e={}){const t=await this.privateGetBalance(e),i=this.safeValue(t,"balance",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"account_id"),a=this.safeString(t,"asset"),n=this.safeCurrencyCode(a);s.push({id:r,type:void 0,currency:n,info:t})}return s}parseBalance(e){const t=this.safeValue(e,"balance",[]),i={info:e,timestamp:void 0,datetime:void 0};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"asset"),a=this.safeCurrencyCode(r),n=this.safeString(s,"reserved"),h=this.safeString(s,"unconfirmed"),d=this.safeString(s,"balance"),c=o.stringAdd(n,h),l=o.stringAdd(d,h);if(a in i)i[a].used=o.stringAdd(i[a].used,c),i[a].total=o.stringAdd(i[a].total,l);else{const e=this.account();e.used=c,e.total=l,i[a]=e}}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetBalance(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();let s="publicGetOrderbook";void 0!==t&&t<=100&&(s+="Top");const r=this.market(e),a={pair:r.id},n=await this[s](this.extend(a,i)),o=this.safeInteger(n,"timestamp");return this.parseOrderBook(n,r.symbol,o,"bids","asks","price","volume")}parseOrderStatus(e){return this.safeString({PENDING:"open"},e,e)}parseOrder(e,t){const i=this.safeInteger(e,"creation_timestamp");let s,r=this.parseOrderStatus(this.safeString(e,"state"));const a=this.safeString(e,"type");"ASK"===a||"SELL"===a?s="sell":"BID"!==a&&"BUY"!==a||(s="buy");const n=this.safeString(e,"pair");t=this.safeMarket(n,t);const o=this.safeString(e,"limit_price"),h=this.safeString(e,"limit_volume"),d=this.safeNumber(e,"fee_counter"),c=this.safeNumber(e,"fee_base"),l=this.safeString(e,"base"),u=this.safeString(e,"counter");let f;void 0!==d?f={cost:d,currency:t.quote}:void 0!==c&&(f={cost:c,currency:t.base});const p=this.safeString(e,"order_id");return this.safeOrder({id:p,clientOrderId:void 0,datetime:this.iso8601(i),timestamp:i,lastTradeTimestamp:void 0,status:r,symbol:t.symbol,type:void 0,timeInForce:void 0,postOnly:void 0,side:s,price:o,stopPrice:void 0,triggerPrice:void 0,amount:h,filled:l,cost:u,remaining:void 0,trades:void 0,fee:f,info:e,average:void 0},t)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privateGetOrdersId(this.extend(s,i));return this.parseOrder(r)}async fetchOrdersByState(e,t,i,s,r={}){await this.loadMarkets();const a={};let n;void 0!==e&&(a.state=e),void 0!==t&&(n=this.market(t),a.pair=n.id);const o=await this.privateGetListorders(this.extend(a,r)),h=this.safeValue(o,"orders",[]);return this.parseOrders(h,n,i,s)}async fetchOrders(e,t,i,s={}){return await this.fetchOrdersByState(void 0,e,t,i,s)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrdersByState("PENDING",e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersByState("COMPLETE",e,t,i,s)}parseTicker(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeString(e,"pair"),r=this.safeSymbol(s,t),a=this.safeString(e,"last_trade");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:void 0,low:void 0,bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:void 0,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"rolling_24_hour_volume"),quoteVolume:void 0,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetTickers(t),s=this.indexBy(i.tickers,"pair"),r=Object.keys(s),a={};for(let e=0;e<r.length;e++){const t=r[e],i=this.safeMarket(t),n=i.symbol,o=s[t];a[n]=this.parseTicker(o,i)}return this.filterByArray(a,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={pair:i.id},r=await this.publicGetTicker(this.extend(s,t));return this.parseTicker(r,i)}parseTrade(e,t){const i=this.safeString(e,"order_id"),s=this.safeString(e,"sequence");let r,a;if(void 0!==i){const t=this.safeString(e,"type");"ASK"===t||"SELL"===t?a="sell":"BID"!==t&&"BUY"!==t||(a="buy"),r="sell"===a&&e.is_buy?"maker":"buy"!==a||e.is_buy?"taker":"maker"}else a=e.is_buy?"buy":"sell";const n=this.safeString(e,"fee_base"),h=this.safeString(e,"fee_counter");let d,c;void 0!==n?o.stringEquals(n,"0.0")||(d=t.base,c=n):void 0!==h&&(o.stringEquals(h,"0.0")||(d=t.quote,c=h));const l=this.safeInteger(e,"timestamp");return this.safeTrade({info:e,id:s,timestamp:l,datetime:this.iso8601(l),symbol:t.symbol,order:i,type:void 0,side:a,takerOrMaker:r,price:this.safeString(e,"price"),amount:this.safeString2(e,"volume","base"),cost:this.safeString(e,"counter"),fee:{cost:c,currency:d}},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pair:r.id};void 0!==t&&(a.since=t);const n=await this.publicGetTrades(this.extend(a,s)),o=this.safeValue(n,"trades",[]);return this.parseTrades(o,r,t,i)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={pair:r.id};void 0!==t&&(n.since=t),void 0!==i&&(n.limit=i);const o=await this.privateGetListtrades(this.extend(n,s)),h=this.safeValue(o,"trades",[]);return this.parseTrades(h,r,t,i)}async fetchTradingFee(e,t={}){await this.loadMarkets();const i={symbol:this.market(e).id},s=await this.privateGetFeeInfo(this.extend(i,t));return{info:s,symbol:e,maker:this.safeNumber(s,"maker_fee"),taker:this.safeNumber(s,"taker_fee")}}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();let n="privatePost";const o=this.market(e),h={pair:o.id};"market"===t?(n+="Marketorder",h.type=i.toUpperCase(),"buy"===i?h.counter_volume=this.amountToPrecision(o.symbol,s):h.base_volume=this.amountToPrecision(o.symbol,s)):(n+="Postorder",h.volume=this.amountToPrecision(o.symbol,s),h.price=this.priceToPrecision(o.symbol,r),h.type="buy"===i?"BID":"ASK");const d=await this[n](this.extend(h,a));return{info:d,id:d.order_id}}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={order_id:e};return await this.privatePostStoporder(this.extend(s,i))}async fetchLedgerByEntries(e,t=-1,i=1,s={}){const r={min_row:t,max_row:this.sum(t,i)};return await this.fetchLedger(e,undefined,i,this.extend(r,s))}async fetchLedger(e,t,i,s={}){let n;await this.loadMarkets(),await this.loadAccounts();let o=this.safeString(s,"id"),h=this.safeValue(s,"min_row"),d=this.safeValue(s,"max_row");if(void 0===o){if(void 0===e)throw new a(this.id+" fetchLedger() requires a currency code argument if no account id specified in params");n=this.currency(e);const t=this.indexBy(this.accounts,"currency"),i=this.safeValue(t,e);if(void 0===i)throw new r(this.id+" fetchLedger() could not find account id for "+e);o=i.id}if(void 0===h&&void 0===d)d=0,h=-1e3;else if(void 0===h||void 0===d)throw new r(this.id+" fetchLedger() require both params 'max_row' and 'min_row' or neither to be defined");if(void 0!==i&&d-h>i&&(d<=0?h=d-i:h>0&&(d=h+i)),d-h>1e3)throw new r(this.id+" fetchLedger() requires the params 'max_row' - 'min_row' <= 1000");const c={id:o,min_row:h,max_row:d},l=await this.privateGetAccountsIdTransactions(this.extend(s,c)),u=this.safeValue(l,"transactions",[]);return this.parseLedger(u,n,t,i)}parseLedgerComment(e){const t=e.split(" ");let i;const s=this.safeString(t,0),r=this.safeString(t,2),a=this.safeString(t,3);let n=this.safeString({Withdrawal:"fee",Trading:"fee",Payment:"transaction",Sent:"transaction",Deposit:"transaction",Received:"transaction",Released:"released",Reserved:"reserved",Sold:"trade",Bought:"trade",Failure:"failed"},s,void 0);return void 0===n&&"fee"===r&&(n="fee"),"reserved"===n&&"order"===a&&(i=this.safeString(t,4)),{type:n,referenceId:i}}parseLedgerEntry(e,t){const i=this.safeString(e,"row_index"),s=this.safeString(e,"account_id"),r=this.safeValue(e,"timestamp"),a=this.safeString(e,"currency"),n=this.safeCurrencyCode(a,t),h=this.safeString(e,"available_delta"),d=this.safeString(e,"balance_delta"),c=this.safeString(e,"balance"),l=this.safeString(e,"description");let u=c,f="0.0";const p=this.parseLedgerComment(l),m=p.type,g=p.referenceId;let y,b;return o.stringEquals(d,"0.0")?o.stringLt(h,"0.0")?(b="pending",f=o.stringAbs(h)):o.stringGt(h,"0.0")&&(b="canceled",f=o.stringAbs(h)):(u=o.stringSub(c,d),b="ok",f=o.stringAbs(d)),o.stringGt(d,"0")||o.stringGt(h,"0")?y="in":(o.stringLt(d,"0")||o.stringLt(h,"0"))&&(y="out"),{id:i,direction:y,account:s,referenceId:g,referenceAccount:void 0,type:m,currency:n,amount:this.parseNumber(f),timestamp:r,datetime:this.iso8601(r),before:u,after:c,status:b,fee:void 0,info:e}}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t]+"/"+this.version+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if(Object.keys(o).length&&(n+="?"+this.urlencode(o)),"private"===t){this.checkRequiredCredentials();const e=this.stringToBase64(this.apiKey+":"+this.secret);r={Authorization:"Basic "+this.decode(e)}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;if(void 0!==this.safeValue(o,"error"))throw new r(this.id+" "+this.json(o))}}},25591:function(e,t,i){"use strict";const s=i(48819),{NotSupported:r,ExchangeError:a,BadRequest:n,InsufficientFunds:o,InvalidOrder:h,DuplicateOrderId:d}=i(73449),{TICK_SIZE:c}=i(62115),l=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"lykke",name:"Lykke",countries:["UK"],version:"2",rateLimit:200,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,editOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDeposits:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:"emulated",fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!1,fetchOrderTrades:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!1,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransactionFees:!1,fetchTransactions:!0,fetchWithdrawals:!1,setLeverage:!1,setMarginMode:!1,withdraw:!0},requiredCredentials:{apiKey:!0,secret:!1},urls:{logo:"https://user-images.githubusercontent.com/1294454/155840500-1ea4fdf0-47c0-4daa-9597-c6c1cd51b9ec.jpg",api:{public:"https://hft-apiv2.lykke.com/api",private:"https://hft-apiv2.lykke.com/api"},www:"https://www.lykke.com",doc:["https://hft-apiv2.lykke.com/swagger/ui/index.html","https://lykkecity.github.io/Trading-API"],fees:"https://support.lykke.com/hc/en-us/articles/115002141125-What-are-the-fees-and-charges-"},api:{public:{get:{assetpairs:2.5,"assetpairs/{id}":2.5,assets:2.5,"assets/{id}":2.5,isalive:2.5,orderbooks:2.5,tickers:2.5,prices:2.5,"trades/public/{assetPairId}":2.5}},private:{get:{balance:2.5,trades:2.5,"trades/order/{orderId}":2.5,"orders/active":1,"orders/closed":1,"orders/{orderId}":1,operations:2.5,"operations/deposits/addresses":2.5,"operations/deposits/addresses/{assetId}":2.5},post:{"orders/limit":1,"orders/market":1,"orders/bulk":1,"operations/withdrawals":2.5,"operations/deposits/addresses":2.5},delete:{orders:1,"orders/{orderId}":1}}},fees:{trading:{tierBased:!1,percentage:!0,maker:0,taker:0}},precisionMode:c,exceptions:{exact:{1001:a,1100:a,1101:a,2e3:n,2001:o,2202:d,2003:a,2004:r,2005:a,2006:o,2007:o,2008:o,2009:a,2010:o,2011:h,2012:h,2013:h,2014:h,2015:h,2016:h,2017:h,2018:h,2019:h,2020:h,2021:h,2022:h,2023:a},broad:{}},commonCurrencies:{}})}async fetchCurrencies(e={}){const t=await this.publicGetAssets(e),i=this.safeValue(t,"payload",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"assetId"),a=this.safeString(t,"symbol"),n=this.safeString(t,"name"),o=this.safeString(t,"type"),h=this.safeValue(t,"blockchainDepositEnabled"),d=this.safeValue(t,"blockchainWithdrawal"),c=!this.safeValue(t,"isDisabled");s[a]={id:r,code:a,info:t,type:o,name:n,active:c,deposit:h,withdraw:d,fee:void 0,precision:this.parseNumber(this.parsePrecision(this.safeString(t,"accuracy"))),limits:{withdraw:{min:this.safeValue(t,"cashoutMinimalAmount"),max:void 0},amount:{min:this.safeValue(t,"lowVolumeAmount"),max:void 0}}}}return s}async fetchMarkets(e={}){const t=await this.publicGetAssetpairs(e),i=this.safeValue(t,"payload",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"assetPairId"),a=this.safeString(t,"name"),n=this.safeString(t,"baseAssetId"),o=this.safeString(t,"quoteAssetId"),[h,d]=a.split("/"),c=this.safeCurrencyCode(h),l=this.safeCurrencyCode(d),u=c+"/"+l;s.push({id:r,symbol:u,base:c,quote:l,baseId:n,quoteId:o,settle:void 0,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,contract:!1,active:!0,info:t,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"baseAssetAccuracy"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"priceAccuracy")))},limits:{amount:{min:this.safeNumber(t,"minVolume"),max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"minOppositeVolume"),max:void 0},leverage:{min:void 0,max:void 0}}})}return s}parseTicker(e,t){const i=void 0,s=this.safeString(e,"assetPairId");t=this.safeMarket(s,t);const r=this.safeString(e,"lastPrice");return this.safeTicker({symbol:this.safeString(t,"symbol"),timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:void 0,close:r,last:r,previousClose:void 0,change:this.safeString(e,"priceChange"),percentage:void 0,average:void 0,baseVolume:this.safeString(e,"volumeBase"),quoteVolume:this.safeString(e,"volumeQuote"),info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={assetPairIds:i.id},r=this.safeString(this.options,"fetchTickerMethod","publicGetTickers"),a=await this[r](this.extend(s,t)),n=this.safeValue(a,"payload",[]);return this.parseTicker(this.safeValue(n,0,{}),i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetTickers(t),s=this.safeValue(i,"payload",[]);return this.parseTickers(s,e)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={assetPairId:s.id};void 0!==t&&(r.depth=t);const a=await this.publicGetOrderbooks(this.extend(r,i)),n=this.safeValue(a,"payload",[]),o=this.safeValue(n,0,{}),h=this.safeInteger(o,"timestamp");return this.parseOrderBook(o,s.symbol,h,"bids","asks","p","v")}parseTrade(e,t){const i=this.safeString(e,"assetPairId"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeString2(e,"id","id"),a=this.safeString(e,"orderId"),n=this.safeInteger(e,"timestamp"),o=this.safeString2(e,"price","price");let h=this.safeString2(e,"volume","amount");void 0===h&&(h=this.safeString2(e,"baseVolume","amount"));const d=this.safeStringLower(e,"side");return this.safeTrade({id:r,info:e,timestamp:n,datetime:this.iso8601(n),symbol:s,type:void 0,order:a,side:d,takerOrMaker:void 0,price:o,amount:h,cost:void 0,fee:void 0},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={assetPairId:r.id};void 0!==i&&(a.take=i);const n=await this.publicGetTradesPublicAssetPairId(this.extend(a,s)),o=this.safeValue(n,"payload",[]);return this.parseTrades(o,r,t,i)}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"assetId"),a=this.safeCurrencyCode(r),n=this.account(),o=this.safeString(s,"available"),h=this.safeString(s,"reserved");n.free=o,n.used=h,t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetBalance(e),i=this.safeValue(t,"payload",[]);return this.parseBalance(i)}parseOrderStatus(e){return this.safeString({Open:"open",Pending:"open",InOrderBook:"open",Processing:"open",Matched:"closed",Cancelled:"canceled",Rejected:"rejected",Replaced:"canceled",Placed:"open"},e,e)}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.parseOrderStatus(this.safeString(e,"status")),r=this.safeString(e,"assetPairId"),a=this.safeSymbol(r,t),n=this.safeStringLower(e,"type"),o=this.safeInteger(e,"lastTradeTimestamp"),h=this.safeInteger(e,"timestamp"),d=this.safeString(e,"price"),c=this.safeStringLower(e,"side"),l=this.safeString(e,"volume"),u=this.safeString(e,"remainingVolume"),f=this.safeString(e,"filledVolume"),p=this.safeString(e,"cost");return this.safeOrder({info:e,id:i,clientOrderId:void 0,timestamp:h,datetime:this.iso8601(h),lastTradeTimestamp:o,symbol:a,type:n,timeInForce:void 0,postOnly:void 0,side:c,price:d,stopPrice:void 0,triggerPrice:void 0,amount:l,cost:p,average:void 0,filled:f,remaining:u,status:s,fee:void 0,trades:void 0},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={assetPairId:n.id,side:this.capitalize(i),volume:parseFloat(this.amountToPrecision(n.symbol,s))};"limit"===t&&(o.price=parseFloat(this.priceToPrecision(n.symbol,r)));const h="privatePostOrders"+this.capitalize(t),d=await this[h](this.extend(o,a)),c=this.safeValue(d,"payload"),l=this.safeString(c,"orderId");return"market"===t&&(r=this.safeNumber(c,"price")),{id:l,info:d,clientOrderId:void 0,timestamp:void 0,datetime:void 0,lastTradeTimestamp:void 0,symbol:n.symbol,type:t,side:i,price:r,amount:s,cost:void 0,average:void 0,filled:void 0,remaining:void 0,status:void 0,fee:void 0,trades:void 0}}async cancelOrder(e,t,i={}){const s={orderId:e};return await this.privateDeleteOrdersOrderId(this.extend(s,i))}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};let s;return void 0!==e&&(s=this.market(e),i.assetPairId=s.id),await this.privateDeleteOrders(this.extend(i,t))}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={orderId:e},r=await this.privateGetOrdersOrderId(this.extend(s,i)),a=this.safeValue(r,"payload");return this.parseOrder(a)}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e));const a={};void 0!==i&&(a.take=i);const n=await this.privateGetOrdersActive(this.extend(a,s)),o=this.safeValue(n,"payload");return this.parseOrders(o,r,t,i)}async fetchClosedOrders(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e));const a={};void 0!==i&&(a.take=i);const n=await this.privateGetOrdersClosed(this.extend(a,s)),o=this.safeValue(n,"payload");return this.parseOrders(o,r,t,i)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==i&&(r.take=i),void 0!==e&&(a=this.market(e),r.assetPairId=a.id),void 0!==t&&(r.from=t);const n=await this.privateGetTrades(this.extend(r,s)),o=this.safeValue(n,"payload");return this.parseTrades(o,a,t,i)}parseBidAsk(e,t=0,i=1){const s=this.safeString(e,t),r=l.stringAbs(this.safeString(e,i));return[this.parseNumber(s),this.parseNumber(r)]}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={assetId:this.safeString(i,"id")},r=await this.privateGetOperationsDepositsAddressesAssetId(this.extend(s,t)),a=this.safeString(r,"baseAddress"),n=this.safeString(r,"addressExtension");return this.checkAddress(a),{currency:e,address:a,tag:n,network:void 0,info:r}}parseTransaction(e,t){let i,s,r,a,n,o,h;if("string"==typeof e)i=e;else{i=this.safeString(e,"operationId"),s=this.safeString(e,"assetId"),r=this.safeCurrencyCode(s,t),a=this.safeNumber(e,"totalVolume"),o=this.safeString(e,"type"),h=this.safeInteger(e,"timestamp");n={currency:r,cost:this.safeNumber(e,"fee")}}return{info:e,id:i,txid:void 0,timestamp:h,datetime:this.iso8601(h),network:void 0,addressFrom:void 0,address:void 0,addressTo:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,type:o,amount:a,currency:r,status:void 0,updated:void 0,fee:n}}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();const r={};void 0!==i&&(r.take=i);const a=await this.privateGetOperations(this.extend(r,s)),n=this.safeValue(a,"payload",[]);let o;return void 0!==e&&(o=this.currency(e)),this.parseTransactions(n,o,t,i)}async withdraw(e,t,i,s,r={}){await this.loadMarkets(),this.checkAddress(i);const a=this.currency(e),n={assetId:a.id,volume:parseFloat(this.currencyToPrecision(e,t)),destinationAddress:i};void 0!==s&&(n.destinationAddressExtension=s);const o=await this.privatePostOperationsWithdrawals(this.extend(n,r));return this.parseTransaction(o,a)}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t]+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));return r={Accept:"application/json","Content-Type":"application/json"},"public"===t?Object.keys(o).length&&(n+="?"+this.urlencode(o)):"private"===t&&("GET"!==i&&"DELETE"!==i||Object.keys(o).length&&(n+="?"+this.urlencode(o)),this.checkRequiredCredentials(),r.Authorization="Bearer "+this.apiKey,"POST"===i&&Object.keys(s).length&&(a=this.json(s)),"operations/withdrawals"===e&&(r["X-Request-ID"]=this.uuid())),{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,n,o,h,d){if(void 0===o)return;const c=this.safeValue(o,"error",{}),l=this.safeString(c,"code");if(void 0!==l&&"0"!==l){const e=this.id+" "+n,t=this.safeString(c,"message");throw this.throwExactlyMatchedException(this.exceptions.exact,l,e),this.throwBroadlyMatchedException(this.exceptions.broad,t,e),new a(e)}}}},47551:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,InvalidOrder:n}=i(73449),{TICK_SIZE:o}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"mercado",name:"Mercado Bitcoin",countries:["BR"],rateLimit:1e3,version:"v3",has:{CORS:!0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createMarketOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:"emulated",fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!1,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,withdraw:!0},timeframes:{"15m":"15m","1h":"1h","3h":"3h","1d":"1d","1w":"1w","1M":"1M"},urls:{logo:"https://user-images.githubusercontent.com/1294454/27837060-e7c58714-60ea-11e7-9192-f05e86adb83f.jpg",api:{public:"https://www.mercadobitcoin.net/api",private:"https://www.mercadobitcoin.net/tapi",v4Public:"https://www.mercadobitcoin.com.br/v4",v4PublicNet:"https://api.mercadobitcoin.net/api/v4"},www:"https://www.mercadobitcoin.com.br",doc:["https://www.mercadobitcoin.com.br/api-doc","https://www.mercadobitcoin.com.br/trade-api"]},api:{public:{get:["coins","{coin}/orderbook/","{coin}/ticker/","{coin}/trades/","{coin}/trades/{from}/","{coin}/trades/{from}/{to}","{coin}/day-summary/{year}/{month}/{day}/"]},private:{post:["cancel_order","get_account_info","get_order","get_withdrawal","list_system_messages","list_orders","list_orderbook","place_buy_order","place_sell_order","place_market_buy_order","place_market_sell_order","withdraw_coin"]},v4Public:{get:["{coin}/candle/"]},v4PublicNet:{get:["candles"]}},fees:{trading:{maker:.003,taker:.007}},options:{limits:{BTC:.001,BCH:.001,ETH:.01,LTC:.01,XRP:.1}},precisionMode:o})}async fetchMarkets(e={}){const t=await this.publicGetCoins(e),i=[],s=this.safeValue(this.options,"limits",{});for(let e=0;e<t.length;e++){const r=t[e],a=r,n="BRL",o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=h+o;i.push({id:d,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber("1e-8"),price:this.parseNumber("1e-5")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(s,a),max:void 0},price:{min:this.parseNumber("1e-5"),max:void 0},cost:{min:void 0,max:void 0}},info:r})}return i}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={coin:s.base},a=await this.publicGetCoinOrderbook(this.extend(r,i));return this.parseOrderBook(a,s.symbol)}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.safeTimestamp(e,"date"),r=this.safeString(e,"last");return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"buy"),bidVolume:void 0,ask:this.safeString(e,"sell"),askVolume:void 0,vwap:void 0,open:void 0,close:r,last:r,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"vol"),quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={coin:i.base},r=await this.publicGetCoinTicker(this.extend(s,t)),a=this.safeValue(r,"ticker",{});return this.parseTicker(a,i)}parseTrade(e,t){const i=this.safeTimestamp2(e,"date","executed_timestamp");t=this.safeMarket(void 0,t);const s=this.safeString2(e,"tid","operation_id"),r=this.safeString(e,"type"),a=this.safeString(e,"price"),n=this.safeString2(e,"amount","quantity"),o=this.safeString(e,"fee_rate");let h;return void 0!==o&&(h={cost:o,currency:void 0}),this.safeTrade({id:s,info:e,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,order:void 0,type:undefined,side:r,takerOrMaker:void 0,price:a,amount:n,cost:void 0,fee:h},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);let a="publicGetCoinTrades";const n={coin:r.base};void 0!==t&&(a+="From",n.from=parseInt(t/1e3));void 0!==this.safeInteger(s,"to")&&(a+="To");const o=await this[a](this.extend(n,s));return this.parseTrades(o,r,t,i)}parseBalance(e){const t=this.safeValue(e,"response_data",{}),i=this.safeValue(t,"balance",{}),s={info:e},r=Object.keys(i);for(let e=0;e<r.length;e++){const t=r[e],a=this.safeCurrencyCode(t);if(t in i){const e=this.safeValue(i,t,{}),r=this.account();r.free=this.safeString(e,"available"),r.total=this.safeString(e,"total"),s[a]=r}}return this.safeBalance(s)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostGetAccountInfo(e);return this.parseBalance(t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const o=this.market(e),h={coin_pair:o.id};let d=this.capitalize(i)+"Order";if("limit"===t)d="privatePostPlace"+d,h.limit_price=this.priceToPrecision(o.symbol,r),h.quantity=this.amountToPrecision(o.symbol,s);else if(d="privatePostPlaceMarket"+d,"buy"===i){if(void 0===r)throw new n(this.id+" createOrder() requires the price argument with market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount");h.cost=this.priceToPrecision(o.symbol,s*r)}else h.quantity=this.amountToPrecision(o.symbol,s);const c=await this[d](this.extend(h,a));return{info:c,id:c.response_data.order.order_id.toString()}}async cancelOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={coin_pair:s.id,order_id:e},n=await this.privatePostCancelOrder(this.extend(r,i)),o=this.safeValue(n,"response_data",{}),h=this.safeValue(o,"order",{});return this.parseOrder(h,s)}parseOrderStatus(e){return this.safeString({2:"open",3:"canceled",4:"closed"},e,e)}parseOrder(e,t){const i=this.safeString(e,"order_id"),s=this.safeString(e,"order_type");let r;"order_type"in e&&(r="1"===s?"buy":"sell");const a=this.parseOrderStatus(this.safeString(e,"status")),n=this.safeString(e,"coin_pair");t=this.safeMarket(n,t);const o=this.safeTimestamp(e,"created_timestamp"),h={cost:this.safeString(e,"fee"),currency:t.quote},d=this.safeString(e,"limit_price"),c=this.safeString(e,"executed_price_avg"),l=this.safeString(e,"quantity"),u=this.safeString(e,"executed_quantity"),f=this.safeTimestamp(e,"updated_timestamp"),p=this.safeValue(e,"operations",[]);return this.safeOrder({info:e,id:i,clientOrderId:void 0,timestamp:o,datetime:this.iso8601(o),lastTradeTimestamp:f,symbol:t.symbol,type:"limit",timeInForce:void 0,postOnly:void 0,side:r,price:d,stopPrice:void 0,triggerPrice:void 0,cost:void 0,average:c,amount:l,filled:u,remaining:void 0,status:a,fee:h,trades:p},t)}async fetchOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={coin_pair:s.id,order_id:parseInt(e)},n=await this.privatePostGetOrder(this.extend(r,i)),o=this.safeValue(n,"response_data",{}),h=this.safeValue(o,"order");return this.parseOrder(h,s)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const n=this.currency(e),o={coin:n.id,quantity:t.toFixed(10),address:i};if("BRL"===e){if(!("account_ref"in r))throw new a(this.id+" withdraw() requires account_ref parameter to withdraw "+e)}else if("LTC"!==e){if(!("tx_fee"in r))throw new a(this.id+" withdraw() requires tx_fee parameter to withdraw "+e);if("XRP"===e)if(void 0===s){if(!("destination_tag"in r))throw new a(this.id+" withdraw() requires a tag argument or destination_tag parameter to withdraw "+e)}else o.destination_tag=s}const h=await this.privatePostWithdrawCoin(this.extend(o,r)),d=this.safeValue(h,"response_data",{}),c=this.safeValue(d,"withdrawal");return this.parseTransaction(c,n)}parseTransaction(e,t){return t=this.safeCurrency(void 0,t),{id:this.safeString(e,"id"),txid:void 0,timestamp:void 0,datetime:void 0,network:void 0,addressFrom:void 0,address:void 0,addressTo:void 0,amount:void 0,type:void 0,currency:t.code,status:void 0,updated:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,comment:void 0,fee:void 0,info:e}}parseOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="15m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={resolution:this.safeString(this.timeframes,t,t),symbol:a.base+"-"+a.quote};void 0===s&&(s=100),void 0!==i?(n.from=parseInt(i/1e3),n.to=this.sum(n.from,s*this.parseTimeframe(t))):(n.to=this.seconds(),n.from=n.to-s*this.parseTimeframe(t));const o=await this.v4PublicNetGetCandles(this.extend(n,r)),h=this.convertTradingViewToOHLCV(o,"t","o","h","l","c","v");return this.parseOHLCVs(h,a,t,i,s)}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={coin_pair:r.id},o=await this.privatePostListOrders(this.extend(n,s)),h=this.safeValue(o,"response_data",{}),d=this.safeValue(h,"orders",[]);return this.parseOrders(d,r,t,i)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={coin_pair:r.id,status_list:"[2]"},o=await this.privatePostListOrders(this.extend(n,s)),h=this.safeValue(o,"response_data",{}),d=this.safeValue(h,"orders",[]);return this.parseOrders(d,r,t,i)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={coin_pair:r.id,has_fills:!0},o=await this.privatePostListOrders(this.extend(n,s)),h=this.safeValue(o,"response_data",{}),d=this.safeValue(h,"orders",[]),c=this.parseOrders(d,r,t,i),l=this.ordersToTrades(c);return this.filterBySymbolSinceLimit(l,r.symbol,t,i)}ordersToTrades(e){const t=[];for(let i=0;i<e.length;i++){const s=this.safeValue(e[i],"trades",[]);for(let e=0;e<s.length;e++)t.push(s[e])}return t}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t]+"/";const o=this.omit(s,this.extractParams(e));if("public"===t||"v4Public"===t||"v4PublicNet"===t)n+=this.implodeParams(e,s),Object.keys(o).length&&(n+="?"+this.urlencode(o));else{this.checkRequiredCredentials(),n+=this.version+"/";const t=this.nonce();a=this.urlencode(this.extend({tapi_method:e,tapi_nonce:t},s));const i="/tapi/"+this.version+"/?"+a;r={"Content-Type":"application/x-www-form-urlencoded","TAPI-ID":this.apiKey,"TAPI-MAC":this.hmac(this.encode(i),this.encode(this.secret),"sha512")}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;if(void 0!==this.safeValue(o,"error_message"))throw new r(this.id+" "+this.json(o))}}},10085:function(e,t,i){"use strict";const s=i(48819),{AccountNotEnabled:r,InvalidAddress:a,ExchangeError:n,BadRequest:o,AuthenticationError:h,RateLimitExceeded:d,BadSymbol:c,InvalidOrder:l,InsufficientFunds:u,ArgumentsRequired:f,OrderNotFound:p,PermissionDenied:m,NotSupported:g}=i(73449),{TICK_SIZE:y}=i(62115),b=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"mexc",name:"MEXC Global",countries:["SC"],rateLimit:50,version:"v2",certified:!0,pro:!0,has:{CORS:void 0,spot:!0,margin:void 0,swap:!0,future:!1,option:!1,addMargin:!0,cancelAllOrders:!0,cancelOrder:!0,createMarketOrder:!1,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!0,createStopMarketOrder:!1,createStopOrder:!0,fetchBalance:!0,fetchCanceledOrders:!0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDepositAddressesByNetwork:!0,fetchDeposits:!0,fetchFundingHistory:!0,fetchFundingRate:!0,fetchFundingRateHistory:!0,fetchFundingRates:!1,fetchIndexOHLCV:!0,fetchLeverage:void 0,fetchLeverageTiers:!0,fetchMarginMode:!1,fetchMarketLeverageTiers:"emulated",fetchMarkets:!0,fetchMarkOHLCV:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderTrades:!0,fetchPosition:!0,fetchPositionMode:!0,fetchPositions:!0,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!0,fetchStatus:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransfer:!0,fetchTransfers:!0,fetchWithdrawals:!0,reduceMargin:!0,setLeverage:!0,setMarginMode:!1,setPositionMode:!0,transfer:!0,withdraw:!0},timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","1d":"1d","1w":"1w","1M":"1M"},urls:{logo:"https://user-images.githubusercontent.com/1294454/137283979-8b2a818d-8633-461b-bfca-de89e8c446b2.jpg",api:{spot:{public:"https://www.mexc.com/open/api/v2",private:"https://www.mexc.com/open/api/v2"},contract:{public:"https://contract.mexc.com/api/v1/contract",private:"https://contract.mexc.com/api/v1/private"}},www:"https://www.mexc.com/",doc:["https://mxcdevelop.github.io/APIDoc/"],fees:["https://www.mexc.com/fee"],referral:"https://m.mexc.com/auth/signup?inviteCode=1FQ1G"},api:{contract:{public:{get:{ping:2,detail:2,support_currencies:2,"depth/{symbol}":2,"depth_commits/{symbol}/{limit}":2,"index_price/{symbol}":2,"fair_price/{symbol}":2,"funding_rate/{symbol}":2,"kline/{symbol}":2,"kline/index_price/{symbol}":2,"kline/fair_price/{symbol}":2,"deals/{symbol}":2,ticker:2,risk_reverse:2,"risk_reverse/history":2,"funding_rate/history":2}},private:{get:{"account/assets":2,"account/asset/{currency}":2,"account/transfer_record":2,"position/list/history_positions":2,"position/open_positions":2,"position/funding_records":2,"position/position_mode":2,"order/list/open_orders/{symbol}":2,"order/list/history_orders":2,"order/external/{symbol}/{external_oid}":2,"order/get/{order_id}":2,"order/batch_query":8,"order/deal_details/{order_id}":2,"order/list/order_deals":2,"planorder/list/orders":2,"stoporder/list/orders":2,"stoporder/order_details/{stop_order_id}":2,"account/risk_limit":2,"account/tiered_fee_rate":2},post:{"position/change_margin":2,"position/change_leverage":2,"position/change_position_mode":2,"order/submit":2,"order/submit_batch":40,"order/cancel":2,"order/cancel_with_external":2,"order/cancel_all":2,"account/change_risk_level":2,"planorder/place":2,"planorder/cancel":2,"planorder/cancel_all":2,"stoporder/cancel":2,"stoporder/cancel_all":2,"stoporder/change_price":2,"stoporder/change_plan_price":2}}},spot:{public:{get:{"market/symbols":1,"market/coin/list":2,"common/timestamp":1,"common/ping":1,"market/ticker":1,"market/depth":1,"market/deals":1,"market/kline":1,"market/api_default_symbols":2}},private:{get:{"account/info":1,"order/open_orders":1,"order/list":1,"order/query":1,"order/deals":1,"order/deal_detail":1,"asset/deposit/address/list":2,"asset/deposit/list":2,"asset/address/list":2,"asset/withdraw/list":2,"asset/internal/transfer/record":10,"account/balance":10,"asset/internal/transfer/info":10,"market/api_symbols":2},post:{"order/place":1,"order/place_batch":1,"asset/withdraw":2,"asset/internal/transfer":10},delete:{"order/cancel":1,"order/cancel_by_symbol":1,"asset/withdraw":2}}}},precisionMode:y,fees:{trading:{tierBased:!1,percentage:!0,maker:this.parseNumber("0.002"),taker:this.parseNumber("0.002")}},options:{timeframes:{spot:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","1d":"1d","1M":"1M"},contract:{"1m":"Min1","5m":"Min5","15m":"Min15","30m":"Min30","1h":"Min60","4h":"Hour4","8h":"Hour8","1d":"Day1","1w":"Week1","1M":"Month1"}},defaultType:"spot",networks:{TRX:"TRC20",ETH:"ERC20",BEP20:"BEP20(BSC)",BSC:"BEP20(BSC)"},accountsByType:{spot:"MAIN",swap:"CONTRACT"},transfer:{accountsById:{MAIN:"spot",CONTRACT:"swap"},status:{SUCCESS:"ok",FAILED:"failed",WAIT:"pending"}},fetchOrdersByState:{method:"spotPrivateGetOrderList"},cancelOrder:{method:"spotPrivateDeleteOrderCancel"},broker:"CCXT"},commonCurrencies:{BEYONDPROTOCOL:"BEYOND",BIFI:"BIFIF",BYN:"BeyondFi",COFI:"COFIX",DFI:"DfiStarter",DFT:"dFuture",DRK:"DRK",EGC:"Egoras Credit",FLUX1:"FLUX",FLUX:"FLUX1",FREE:"FreeRossDAO",GAS:"GASDAO",GMT:"GMT Token",HERO:"Step Hero",MIMO:"Mimosa",PROS:"Pros.Finance",SIN:"Sin City Token",SOUL:"Soul Swap",STEPN:"GMT"},exceptions:{exact:{400:o,401:h,402:h,403:m,429:d,703:m,1e3:r,1002:l,10072:h,10073:h,10075:m,10101:u,10216:a,10232:c,3e4:c,30001:l,30002:l,30003:l,30004:u,30005:l,30010:l,30014:c,30016:c,30019:l,30020:c,30021:c,33333:c},broad:{"price and quantity must be positive":l}}})}async fetchTime(e={}){const[t,i]=this.handleMarketTypeAndParams("fetchTime",void 0,e),s=this.getSupportedMapping(t,{spot:"spotPublicGetCommonTimestamp",swap:"contractPublicGetPing"}),r=await this[s](this.extend(i));return this.safeInteger(r,"data")}async fetchStatus(e={}){const t=await this.spotPublicGetCommonPing(e);return{status:200===this.safeInteger(t,"code")?"ok":"maintenance",updated:void 0,eta:void 0,url:void 0,info:t}}async fetchCurrencies(e={}){const t=await this.spotPublicGetMarketCoinList(e),i=this.safeValue(t,"data",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"currency"),a=this.safeCurrencyCode(r),n=this.safeString(t,"full_name");let o,h,d,c,l=!1;const u={},f=this.safeValue(t,"coins",[]);let p=!1,m=!1;for(let e=0;e<f.length;e++){const t=f[e],i=this.safeString(t,"chain"),s=this.safeNetwork(i),r=this.safeValue(t,"is_deposit_enabled",!1),a=this.safeValue(t,"is_withdraw_enabled",!1),n=r&&a;l=n||l;const h=this.safeString(t,"withdraw_limit_min"),g=this.safeString(t,"withdraw_limit_max");d=void 0===d?h:d,c=void 0===c?g:c,b.stringGt(d,h)&&(d=h),b.stringLt(c,g)&&(c=g),r&&(p=!0),a&&(m=!0);const y=this.parsePrecision(this.safeString(t,"precision"));void 0!==y&&(o=void 0===o?y:b.stringMin(y,o)),u[s]={info:t,id:i,network:s,active:n,deposit:r,withdraw:a,fee:this.safeNumber(t,"fee"),precision:this.parseNumber(o),limits:{withdraw:{min:h,max:g}}}}const g=Object.keys(u).length;if(1===g||"NONE"in u){const e=this.safeValue2(u,"NONE",g-1);void 0!==e&&(h=e.fee)}s[a]={id:r,code:a,info:t,name:n,active:l,deposit:p,withdraw:m,fee:h,precision:this.parseNumber(o),limits:{amount:{min:void 0,max:void 0},withdraw:{min:d,max:c}},networks:u}}return s}async fetchMarkets(e={}){const t=this.safeString2(this.options,"fetchMarkets","defaultType","spot"),i=this.safeString(e,"type",t),s=this.omit(e,"type"),r="spot"===i,a="swap"===i;if(!r&&!a)throw new n(this.id+" does not support '"+i+"' type, set exchange.options['defaultType'] to 'spot' or 'swap''");return r?await this.fetchSpotMarkets(s):a?await this.fetchContractMarkets(s):void 0}async fetchContractMarkets(e={}){const t=await this.contractPublicGetDetail(e),i=this.safeValue(t,"data",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"symbol"),a=this.safeString(t,"baseCoin"),n=this.safeString(t,"quoteCoin"),o=this.safeString(t,"settleCoin"),h=this.safeCurrencyCode(a),d=this.safeCurrencyCode(n),c=this.safeCurrencyCode(o),l=this.safeString(t,"state");s.push({id:r,symbol:h+"/"+d+":"+c,base:h,quote:d,settle:c,baseId:a,quoteId:n,settleId:o,type:"swap",spot:!1,margin:!1,swap:!0,future:!1,option:!1,active:"0"===l,contract:!0,linear:!0,inverse:!1,taker:this.safeNumber(t,"takerFeeRate"),maker:this.safeNumber(t,"makerFeeRate"),contractSize:this.safeNumber(t,"contractSize"),expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(t,"volUnit"),price:this.safeNumber(t,"priceUnit")},limits:{leverage:{min:this.safeNumber(t,"minLeverage"),max:this.safeNumber(t,"maxLeverage")},amount:{min:this.safeNumber(t,"minVol"),max:this.safeNumber(t,"maxVol")},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return s}async fetchSpotMarkets(e={}){const t=await this.spotPublicGetMarketSymbols(e),i=this.safeValue(t,"data",[]),s=await this.spotPublicGetMarketApiDefaultSymbols(e),r=this.safeValue(s,"data",{}),a=this.safeValue(r,"symbol",[]),n=[];for(let e=0;e<i.length;e++){const t=i[e],s=this.safeString(t,"symbol"),[r,o]=s.split("_"),h=this.safeCurrencyCode(r),d=this.safeCurrencyCode(o),c=this.safeString(t,"state");let l=!1;for(let e=0;e<a.length;e++)if(a[e]===s){"ENABLED"===c&&(l=!0);break}n.push({id:s,symbol:h+"/"+d,base:h,quote:d,settle:void 0,baseId:r,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:l,contract:!1,linear:void 0,inverse:void 0,taker:this.safeNumber(t,"taker_fee_rate"),maker:this.safeNumber(t,"maker_fee_rate"),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"quantity_scale"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"price_scale")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"min_amount"),max:this.safeNumber(t,"max_amount")}},info:t})}return n}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=this.safeString(e,0);let s;void 0!==i&&(s=this.market(i));const[r,a]=this.handleMarketTypeAndParams("fetchTickers",s,t),n=this.getSupportedMapping(r,{spot:"spotPublicGetMarketTicker",swap:"contractPublicGetTicker"}),o=await this[n](this.extend(a)),h=this.safeValue(o,"data",[]);return this.parseTickers(h,e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id};let r;i.spot?r="spotPublicGetMarketTicker":i.swap&&(r="contractPublicGetTicker");const a=await this[r](this.extend(s,t));if(i.spot){const e=this.safeValue(a,"data",[]),t=this.safeValue(e,0);return this.parseTicker(t,i)}if(i.swap){const e=this.safeValue(a,"data",{});return this.parseTicker(e,i)}}parseTicker(e,t){const i=this.safeInteger2(e,"time","timestamp"),s=this.safeString(e,"symbol"),r=this.safeSymbol(s,t,"_"),a=this.safeString2(e,"volume","volume24"),n=this.safeString(e,"amount24"),o=this.safeString(e,"open"),h=this.safeString2(e,"last","lastPrice"),d=this.safeString(e,"riseFallValue"),c=this.safeString(e,"riseFallRate"),l=b.stringAdd(c,"1");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString2(e,"high","high24Price"),low:this.safeString2(e,"low","lower24Price"),bid:this.safeString2(e,"bid","bid1"),bidVolume:void 0,ask:this.safeString2(e,"ask","ask1"),askVolume:void 0,vwap:void 0,open:o,close:h,last:h,previousClose:void 0,change:d,percentage:l,average:void 0,baseVolume:a,quoteVolume:n,info:e},t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};let a;s.spot?(a="spotPublicGetMarketDepth",void 0===t&&(t=100),r.depth=t):s.swap&&(a="contractPublicGetDepthSymbol",void 0!==t&&(r.limit=t));const n=await this[a](this.extend(r,i)),o=this.safeValue(n,"data",{}),h=s.spot?"price":0,d=s.spot?"quantity":1,c=this.safeInteger(o,"timestamp"),l=this.parseOrderBook(o,e,c,"bids","asks",h,d);return l.nonce=this.safeInteger(o,"version"),l}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};let n;void 0!==i&&(a.limit=i),r.spot?n="spotPublicGetMarketDeals":r.swap&&(n="contractPublicGetDealsSymbol");const o=await this[n](this.extend(a,s)),h=this.safeValue(o,"data",[]);return this.parseTrades(h,r,t,i)}parseTrade(e,t){let i=this.safeInteger2(e,"create_time","trade_time");i=this.safeInteger(e,"t",i);const s=this.safeString(e,"symbol"),r=(t=this.safeMarket(s,t,"_")).symbol;let a=this.safeString2(e,"price","trade_price");a=this.safeString(e,"p",a);let n=this.safeString2(e,"quantity","trade_quantity");n=this.safeString(e,"v",n);const o=this.safeString(e,"amount");let h=this.safeString2(e,"trade_type","T");"BID"===h||"1"===h?h="buy":"ASK"!==h&&"2"!==h||(h="sell");let d=this.safeString2(e,"id","trade_time");void 0===d&&(d=this.safeString(e,"t",d),void 0!==d&&(d+="-"+t.id+"-"+n));const c=this.safeString(e,"fee");let l;if(void 0!==c){const t=this.safeString(e,"fee_currency");l={cost:c,currency:this.safeCurrencyCode(t)}}const u=this.safeString(e,"order_id"),f=this.safeValue(e,"is_taker",!0)?"taker":"maker";return this.safeTrade({info:e,id:d,order:u,timestamp:i,datetime:this.iso8601(i),symbol:r,type:void 0,side:h,takerOrMaker:f,price:a,amount:n,cost:o,fee:l},t)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.spotPublicGetMarketSymbols(e),i=this.safeValue(t,"data",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"symbol"),a=this.safeMarket(r,void 0,"_").symbol;s[a]={info:t,symbol:a,maker:this.safeNumber(t,"maker_fee_rate"),taker:this.safeNumber(t,"taker_fee_rate"),percentage:!0,tierBased:!1}}return s}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.safeValue(this.options,"timeframes",{}),o=this.safeValue(n,a.type,{}),h=this.safeString(o,t);if(void 0===h)throw new g(this.id+" fetchOHLCV() does not support "+t+" timeframe for "+a.type+" markets");const d={symbol:a.id,interval:h};let c;a.spot?(c="spotPublicGetMarketKline",void 0!==i&&(d.start_time=parseInt(i/1e3)),void 0!==s&&(d.limit=s)):a.swap&&(c="contractPublicGetKlineSymbol",void 0!==i&&(d.start=parseInt(i/1e3)));const l=await this[c](this.extend(d,r));if(a.spot){const e=this.safeValue(l,"data",[]);return this.parseOHLCVs(e,a,t,i,s)}if(a.swap){const e=this.safeValue(l,"data",{}),r=this.convertTradingViewToOHLCV(e,"time","open","high","low","close","vol");return this.parseOHLCVs(r,a,t,i,s)}}parseOHLCV(e,t){return[this.safeTimestamp(e,0),this.safeNumber(e,1),this.safeNumber(e,t.spot?3:2),this.safeNumber(e,t.spot?4:3),this.safeNumber(e,t.spot?2:4),this.safeNumber(e,5)]}async fetchBalance(e={}){await this.loadMarkets();const[t,i]=this.handleMarketTypeAndParams("fetchBalance",void 0,e),s=this.getSupportedMapping(t,{spot:"spotPrivateGetAccountInfo",margin:"spotPrivateGetAccountInfo",swap:"contractPrivateGetAccountAssets"}),r="spot"===t,a=await this[s](i),n=this.safeValue(a,"data",{}),o=this.milliseconds(),h={info:a,timestamp:o,datetime:this.iso8601(o)};if(r){const e=Object.keys(n);for(let t=0;t<e.length;t++){const i=e[t],s=this.safeCurrencyCode(i),r=this.safeValue(n,i,{}),a=this.account();a.free=this.safeString(r,"available"),a.used=this.safeString(r,"frozen"),h[s]=a}}else for(let e=0;e<n.length;e++){const t=n[e],i=this.safeString(t,"currency"),s=this.safeCurrencyCode(i),r=this.account();r.free=this.safeString(t,"availableBalance"),r.used=this.safeString(t,"frozenBalance"),h[s]=r}return this.safeBalance(h)}safeNetwork(e){if(e.indexOf("BSC")>=0)return"BEP20";const t=e.split(" ");e=(e=t.join("")).replace("-20","20");return this.safeString({ETH:"ETH",ERC20:"ERC20","BEP20(BSC)":"BEP20",TRX:"TRC20"},e,e)}parseDepositAddress(e,t){const i=this.safeString(e,"address"),s=this.safeCurrencyCode(void 0,t),r=this.safeString(e,"chain"),a=this.safeNetwork(r);return this.checkAddress(i),{currency:s,address:i,tag:void 0,network:a,info:e}}async fetchDepositAddressesByNetwork(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},r=await this.spotPrivateGetAssetDepositAddressList(this.extend(s,t)),a=this.safeValue(r,"data",{}),n=this.safeValue(a,"chains",[]),o=[];for(let e=0;e<n.length;e++){const t=this.parseDepositAddress(n[e],i);o.push(t)}return this.indexBy(o,"network")}async fetchDepositAddress(e,t={}){const i=this.safeStringUpper(t,"network");t=this.omit(t,"network");const s=await this.fetchDepositAddressesByNetwork(e,t),r=this.safeValue(this.options,"networks",{}),n=this.safeString(r,i,i);let o;if(void 0===n){if(o=this.safeValue(s,e),void 0===o){const t=this.safeString(r,e,e);if(o=this.safeValue(s,t),void 0===o){const t=this.safeString(this.options,"defaultNetwork","ERC20");if(o=this.safeValue(s,t),void 0===o){const t=Object.values(s);if(o=this.safeValue(t,0),void 0===o)throw new a(this.id+" fetchDepositAddress() cannot find deposit address for "+e)}}}return o}if(o=this.safeValue(s,i),void 0===o)throw new a(this.id+" fetchDepositAddress() cannot find "+n+" deposit address for "+e);return o}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==t&&(r.start_time=t),void 0!==i&&(r.limit=i);const n=await this.spotPrivateGetAssetDepositList(this.extend(r,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"result_list",[]);return this.parseTransactions(h,a,t,i)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==t&&(r.start_time=t),void 0!==i&&(r.limit=i);const n=await this.spotPrivateGetAssetWithdrawList(this.extend(r,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"result_list",[]);return this.parseTransactions(h,a,t,i)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=void 0===i?"deposit":"withdrawal",r=this.parse8601(this.safeString(e,"create_time")),a=this.parse8601(this.safeString(e,"update_time"));let n,o=this.safeString(e,"currency");if(void 0!==o&&o.indexOf("-")>=0){const e=o.split("-");o=this.safeString(e,0);const t=this.safeString(e,1);n=this.safeNetwork(t)}const h=this.safeCurrencyCode(o,t),d=this.parseTransactionStatus(this.safeString(e,"state"));let c=this.safeString(e,"amount");const l=this.safeString(e,"address"),u=this.safeString(e,"tx_id");let f;const p=this.safeString(e,"fee");return void 0!==p&&(f={cost:this.parseNumber(p),currency:h}),"withdrawal"===s&&(c=b.stringSub(c,p)),{info:e,id:i,txid:u,timestamp:r,datetime:this.iso8601(r),network:n,address:l,addressTo:void 0,addressFrom:void 0,tag:void 0,tagTo:void 0,tagFrom:void 0,type:s,amount:this.parseNumber(c),currency:h,status:d,updated:a,fee:f}}parseTransactionStatus(e){return this.safeString({WAIT:"pending",WAIT_PACKAGING:"pending",SUCCESS:"ok"},e,e)}async fetchPosition(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.fetchPositions(this.extend(s,t)),a=this.safeValue(r,0);return this.parsePosition(a,i)}async fetchPositions(e,t={}){await this.loadMarkets();const i=await this.contractPrivateGetPositionOpenPositions(t),s=this.safeValue(i,"data",[]);return this.parsePositions(s,e)}parsePosition(e,t){const i=(t=this.safeMarket(this.safeString(e,"symbol"),t)).symbol,s=this.safeString(e,"holdVol"),r=this.safeNumber(e,"openAvgPrice"),a=this.safeString(e,"im"),n="1"===this.safeString(e,"positionType")?"long":"short",o="1"===this.safeString(e,"margin_mode")?"isolated":"cross",h=this.safeString(e,"leverage"),d=this.safeNumber(e,"liquidatePrice"),c=this.safeNumber(e,"updateTime");return{info:e,symbol:i,contracts:this.parseNumber(s),contractSize:void 0,entryPrice:r,collateral:void 0,side:n,unrealizedProfit:void 0,leverage:this.parseNumber(h),percentage:void 0,marginMode:o,notional:void 0,markPrice:void 0,liquidationPrice:d,initialMargin:this.parseNumber(a),initialMarginPercentage:void 0,maintenanceMargin:void 0,maintenanceMarginPercentage:void 0,marginRatio:void 0,timestamp:c,datetime:this.iso8601(c)}}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),[o,h]=this.handleMarketTypeAndParams("createOrder",n,a);return"spot"===o?await this.createSpotOrder(e,t,i,s,r,h):"swap"===o?await this.createSwapOrder(e,t,i,s,r,h):void 0}async createSpotOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);let o;"buy"===i?o="BID":"sell"===i&&(o="ASK");let h=t.toUpperCase();const d="MARKET"===h;if(d)throw new l(this.id+" createOrder () does not support market orders, only limit orders are allowed");"LIMIT"===h&&(h="LIMIT_ORDER");const c=this.isPostOnly(d,"POST_ONLY"===h,a),u=this.safeStringUpper(a,"timeInForce");if(c?h="POST_ONLY":"IOC"===u&&(h="IMMEDIATE_OR_CANCEL"),"FOK"===u)throw new l(this.id+" createOrder () does not support timeInForce FOK, only IOC, PO, and GTC are allowed");if("POST_ONLY"!==h&&"IMMEDIATE_OR_CANCEL"!==h&&"LIMIT_ORDER"!==h)throw new l(this.id+" createOrder () does not support "+t+" order type, only LIMIT, LIMIT_ORDER, POST_ONLY or IMMEDIATE_OR_CANCEL are allowed");const f={symbol:n.id,price:this.priceToPrecision(e,r),quantity:this.amountToPrecision(e,s),trade_type:o,order_type:h},p=this.safeString2(a,"clientOrderId","client_order_id");void 0!==p&&(f.client_order_id=p),a=this.omit(a,["type","clientOrderId","client_order_id","postOnly","timeInForce"]);const m=await this.spotPrivatePostOrderPlace(this.extend(f,a));return this.parseOrder(m,n)}async createSwapOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=this.safeInteger(a,"openType");if(void 0===o)throw new f(this.id+" createSwapOrder () requires an integer openType parameter, 1 for isolated margin, 2 for cross margin");if("limit"!==t&&"market"!==t&&1!==t&&2!==t&&3!==t&&4!==t&&5!==t&&6!==t)throw new l(this.id+" createSwapOrder () order type must either limit, market, or 1 for limit orders, 2 for post-only orders, 3 for IOC orders, 4 for FOK orders, 5 for market orders or 6 to convert market price to current price");const h="market"===t||5===t;this.isPostOnly(h,2===t,a)?t=2:"limit"===t?t=1:"market"===t&&(t=5);const d=this.safeStringUpper(a,"timeInForce");if("IOC"===d?t=3:"FOK"===d&&(t=4),1!==i&&2!==i&&3!==i&&4!==i)throw new l(this.id+" createSwapOrder () order side must be 1 open long, 2 close short, 3 open short or 4 close long");const c={symbol:n.id,vol:parseFloat(this.amountToPrecision(e,s)),side:i,type:t,openType:o};let u="contractPrivatePostOrderSubmit";const p=this.safeNumber2(a,"triggerPrice","stopPrice");if(a=this.omit(a,["stopPrice","triggerPrice","timeInForce","postOnly"]),void 0!==p&&(u="contractPrivatePostPlanorderPlace",c.triggerPrice=this.priceToPrecision(e,p),c.triggerType=this.safeInteger(a,"triggerType",1),c.executeCycle=this.safeInteger(a,"executeCycle",1),c.trend=this.safeInteger(a,"trend",1),c.orderType=this.safeInteger(a,"orderType",t)),5!==t&&6!==t&&"market"!==t&&(c.price=parseFloat(this.priceToPrecision(e,r))),1===o){if(void 0===this.safeInteger(a,"leverage"))throw new f(this.id+" createSwapOrder () requires a leverage parameter for isolated margin orders")}const m=this.safeString2(a,"clientOrderId","externalOid");void 0!==m&&(c.externalOid=m),a=this.omit(a,["clientOrderId","externalOid"]);const g=await this[u](this.extend(c,a));return this.parseOrder(g,n)}async cancelOrder(e,t,i={}){if(void 0===t)throw new f(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r=this.safeValue(this.options,"cancelOrder",{}),a=this.safeString(r,"method","spotPrivateDeleteOrderCancel");let n=this.safeString(i,"method",a);const o=this.safeValue(i,"stop");let h={};if("spot"===s.type){n="spotPrivateDeleteOrderCancel";const t=this.safeString2(i,"clientOrderId","client_order_ids");void 0!==t?(i=this.omit(i,["clientOrderId","client_order_ids"]),h.client_order_ids=t):h.order_ids=e}else if(o)if(n="contractPrivatePostPlanorderCancel",h=[],Array.isArray(e))for(let t=0;t<e.length;t++)h.push({symbol:s.id,orderId:e[t]});else"string"==typeof e&&h.push({symbol:s.id,orderId:e});else"swap"===s.type&&(n="contractPrivatePostOrderCancel",h=[e]);const d=await this[n](h);let c=this.safeValue(d,"data",[]);return o&&(c=d),this.parseOrder(c,s)}parseOrderStatus(e,t){let i={};return i="spot"===t.type?{NEW:"open",FILLED:"closed",PARTIALLY_FILLED:"open",CANCELED:"canceled",PARTIALLY_CANCELED:"canceled"}:"swap"===t.type?{2:"open",3:"closed",4:"canceled"}:{1:"open",2:"canceled",3:"closed"},this.safeString(i,e,e)}parseOrder(e,t){let i,s=this.safeString2(e,"data","id");if(void 0===s){const t=Object.keys(e);s=this.safeString(t,0);"success"===this.safeString(e,s)&&(i="canceled")}const r=this.safeString(e,"state"),a=this.safeInteger2(e,"create_time","createTime"),n=this.safeString(e,"price"),o=this.safeString2(e,"quantity","vol"),h=this.safeString(e,"remain_quantity"),d=this.safeString2(e,"deal_quantity","dealVol"),c=this.safeString(e,"deal_amount"),l=this.safeString(e,"symbol"),u=this.safeSymbol(l,t,"_"),f=this.safeInteger(e,"side");let p;const m=this.safeString(e,"type");"BID"===m?p="buy":"ASK"===m&&(p="sell"),1===f?p="open long":2===p?p="close short":3===p?p="open short":4===p&&(p="close long"),i=this.parseOrderStatus(r,t);const g=this.safeString2(e,"client_order_id","orderId"),y=this.safeString2(e,"orderType","order_type");let b,v,w;return void 0!==y&&(w=!1,"1"===y?(b="limit",v="GTC"):"2"===y?(b="limit",v="PO",w=!0):"3"===y?(b="limit",v="IOC"):"4"===y?(b="limit",v="FOK"):"5"===y||"6"===y?(b="market",v="GTC"):"LIMIT_ORDER"===y?(b="limit",v="GTC"):"POST_ONLY"===y?(b="limit",v="PO",w=!0):"IMMEDIATE_OR_CANCEL"===y&&(b="limit",v="IOC")),this.safeOrder({id:s,clientOrderId:g,timestamp:a,datetime:this.iso8601(a),lastTradeTimestamp:this.safeInteger(e,"updateTime"),status:i,symbol:u,type:b,timeInForce:v,postOnly:w,side:p,price:n,stopPrice:this.safeString(e,"triggerPrice"),triggerPrice:this.safeString(e,"triggerPrice"),average:this.safeString(e,"dealAvgPrice"),amount:o,cost:c,filled:d,remaining:h,fee:void 0,trades:void 0,info:e},t)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new f(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={symbol:r.id},[n,o]=this.handleMarketTypeAndParams("fetchOpenOrders",r,s),h=this.getSupportedMapping(n,{spot:"spotPrivateGetOrderOpenOrders",swap:"contractPrivateGetOrderListOpenOrdersSymbol"});if(this.safeValue(s,"stop"))return await this.fetchOrdersByState("1",e,t,i,s);const d=await this[h](this.extend(a,o)),c=this.safeValue(d,"data",[]);return this.parseOrders(c,r,t,i)}async fetchOrder(e,t,i={}){if(void 0===t)throw new f(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),[r,a]=this.handleMarketTypeAndParams("fetchOrder",s,i),n={order_ids:e},o=this.getSupportedMapping(r,{spot:"spotPrivateGetOrderQuery",swap:"contractPrivateGetOrderBatchQuery"}),h=await this[o](this.extend(n,a)),d=this.safeValue(h,"data",[]),c=this.safeValue(d,0);if(void 0===c)throw new p(this.id+" fetchOrder() could not find the order id "+e);return this.parseOrder(c,s)}async fetchOrdersByState(e,t,i,s,r={}){if(void 0===t)throw new f(this.id+" fetchOrdersByState() requires a symbol argument");await this.loadMarkets();const a=this.market(t),n={symbol:a.id,states:e},o=this.safeValue(r,"stop");void 0!==s&&(n[o?"page_size":"limit"]=s),void 0!==i&&(n.start_time=i);const h=this.safeValue(this.options,"fetchOrdersByState",{}),d=this.safeString(h,"method","spotPrivateGetOrderList");let c=this.safeString(r,"method",d);c=this.getSupportedMapping(a.type,{spot:"spotPrivateGetOrderList",swap:"contractPrivateGetOrderListHistoryOrders"}),o&&(c="contractPrivateGetPlanorderListOrders");const l=this.omit(r,["method","stop"]),u=await this[c](this.extend(n,l)),p=this.safeValue(u,"data",[]);return this.parseOrders(p,a,i,s)}async fetchCanceledOrders(e,t,i,s={}){if(void 0===e)throw new f(this.id+" fetchCanceledOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a=this.safeValue(s,"stop");let n="CANCELED";return"swap"===r.type?n="4":a&&(n="2"),await this.fetchOrdersByState(n,e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){if(void 0===e)throw new f(this.id+" fetchClosedOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e);let a="FILLED";return(this.safeValue(s,"stop")||"swap"===r.type)&&(a="3"),await this.fetchOrdersByState(a,e,t,i,s)}async cancelAllOrders(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id};let r=this.getSupportedMapping(i.type,{spot:"spotPrivateDeleteOrderCancelBySymbol",swap:"contractPrivatePostOrderCancelAll"});this.safeValue(t,"stop")&&(r="contractPrivatePostPlanorderCancelAll");const a=this.omit(t,["method","stop"]);return await this[r](this.extend(s,a))}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new f(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==t&&(a.start_time=t),void 0!==i&&(a.limit=i);const n=await this.spotPrivateGetOrderDeals(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}async fetchOrderTrades(e,t,i,s,r={}){let a;await this.loadMarkets(),void 0!==t&&(a=this.market(t));const n={order_id:e},o=await this.spotPrivateGetOrderDealDetail(this.extend(n,r)),h=this.safeValue(o,"data",[]);return this.parseTrades(h,a,i,s)}async modifyMarginHelper(e,t,i,s={}){const r=this.safeInteger(s,"positionId");if(void 0===r)throw new f(this.id+" modifyMarginHelper() requires a positionId parameter");await this.loadMarkets();const a=this.market(e),n={positionId:r,amount:t=this.amountToPrecision(e,t),type:i},o=await this.contractPrivatePostPositionChangeMargin(this.extend(n,s)),h="ADD"===i?"add":"reduce";return this.extend(this.parseMarginModification(o,a),{amount:this.parseNumber(t),type:h})}parseMarginModification(e,t){const i=!0===this.safeValue(e,"success")?"ok":"failed";return{info:e,type:void 0,amount:void 0,code:void 0,symbol:this.safeSymbol(void 0,t),status:i}}async reduceMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,"SUB",i)}async addMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,"ADD",i)}async setLeverage(e,t,i={}){await this.loadMarkets();const s={leverage:e},r=this.safeInteger(i,"positionId");if(void 0===r){const e=this.safeNumber(i,"openType"),r=this.safeNumber(i,"positionType"),a=void 0!==t?this.market(t):void 0;if(void 0===e||void 0===r||void 0===a)throw new f(this.id+" setLeverage() requires a positionId parameter or a symbol argument with openType and positionType parameters, use openType 1 or 2 for isolated or cross margin respectively, use positionType 1 or 2 for long or short positions");s.openType=e,s.symbol=a.id,s.positionType=r}else s.positionId=r;return await this.contractPrivatePostPositionChangeLeverage(this.extend(s,i))}async fetchTransfer(e,t,i={}){const s={transact_id:e},r=await this.spotPrivateGetAssetInternalTransferInfo(this.extend(s,i)),a=this.safeValue(r,"data",{});return this.parseTransfer(a)}async fetchTransfers(e,t,i,s={}){await this.loadMarkets();const r={};let a;if(void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==t&&(r.start_time=t),void 0!==i){if(i>50)throw new n("This exchange supports a maximum limit of 50");r["page-size"]=i}const o=await this.spotPrivateGetAssetInternalTransferRecord(this.extend(r,s)),h=this.safeValue(o,"data",{}),d=this.safeValue(h,"result_list",[]);return this.parseTransfers(d,a,t,i)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n=this.safeValue(this.options,"accountsByType",{}),o=this.safeString(n,i,i),h=this.safeString(n,s,s),d={currency:a.id,amount:t,from:o,to:h},c=await this.spotPrivatePostAssetInternalTransfer(this.extend(d,r)),l=this.safeValue(c,"data",{});return this.parseTransfer(l,a)}parseTransfer(e,t){const i=this.safeValue(this.options,"transfer",{}),s=this.safeValue(i,"status",{}),r=this.safeString(e,"currency"),a=this.safeString(e,"transact_id"),n=this.safeString(e,"from"),o=this.safeString(e,"to"),h=this.safeValue(i,"accountsById",{}),d=this.safeString(h,n),c=this.safeString(h,o),l=this.safeString(e,"transact_state");return{info:e,id:a,timestamp:void 0,datetime:void 0,currency:this.safeCurrencyCode(r,t),amount:this.safeNumber(e,"amount"),fromAccount:d,toAccount:c,status:this.safeString(s,l)}}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r);const a=this.safeValue(this.options,"networks",{});let n=this.safeStringUpper2(r,"network","chain");n=this.safeString(a,n,n),this.checkAddress(i),await this.loadMarkets();void 0!==s&&(i+=":"+s);const o={currency:this.currency(e).id,address:i,amount:t};void 0!==n&&(o.chain=n,r=this.omit(r,["network","chain"]));const h=await this.spotPrivatePostAssetWithdraw(this.extend(o,r)),d=this.safeValue(h,"data",{});return{info:d,id:this.safeString(d,"withdrawId")}}sign(e,t="public",i="GET",s={},r,a){const[n,o]=t;let h=this.urls.api[n][o]+"/"+this.implodeParams(e,s);if(s=this.omit(s,this.extractParams(e)),"public"===o)Object.keys(s).length&&(h+="?"+this.urlencode(s));else{this.checkRequiredCredentials();const e=this.milliseconds().toString();let t="";r={ApiKey:this.apiKey,"Request-Time":e,"Content-Type":"application/json",source:this.safeString(this.options,"broker","CCXT")},"POST"===i?(t=this.json(s),a=t):(s=this.keysort(s),Object.keys(s).length&&(t+=this.urlencode(s),h+="?"+t)),t=this.apiKey+e+t;const n=this.hmac(this.encode(t),this.encode(this.secret),"sha256");r.Signature=n}return{url:h,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,o,h,d){if(void 0===o)return;if(!0===this.safeValue(o,"success",!1))return;const c=this.safeString(o,"code");if("200"!==c&&"0"!==c){const e=this.id+" "+a;throw this.throwBroadlyMatchedException(this.exceptions.broad,a,e),this.throwExactlyMatchedException(this.exceptions.exact,c,e),new n(e)}}async fetchFundingHistory(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.symbol=r.id),void 0!==i&&(a.page_size=i);const n=await this.contractPrivateGetPositionFundingRecords(this.extend(a,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"resultList",[]),d=[];for(let t=0;t<h.length;t++){const i=h[t],s=this.safeInteger(i,"settleTime");d.push({info:i,symbol:e,code:void 0,timestamp:s,datetime:this.iso8601(s),id:this.safeNumber(i,"id"),amount:this.safeNumber(i,"funding")})}return d}parseFundingRate(e,t){const i=this.safeNumber(e,"fundingRate"),s=this.safeInteger(e,"nextSettleTime"),r=this.safeString(e,"symbol"),a=this.safeSymbol(r,t),n=this.safeInteger(e,"timestamp");return{info:e,symbol:a,markPrice:void 0,indexPrice:void 0,interestRate:void 0,estimatedSettlePrice:void 0,timestamp:n,datetime:this.iso8601(n),fundingRate:i,fundingTimestamp:s,fundingDatetime:this.iso8601(s),nextFundingRate:void 0,nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.contractPublicGetFundingRateSymbol(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseFundingRate(a,i)}async fetchFundingRateHistory(e,t,i,s={}){if(void 0===e)throw new f(this.id+" fetchFundingRateHistory() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.page_size=i);const n=await this.contractPublicGetFundingRateHistory(this.extend(a,s)),o=this.safeValue(n,"data"),h=this.safeValue(o,"resultList",[]),d=[];for(let e=0;e<h.length;e++){const t=h[e],i=this.safeString(t,"symbol"),s=this.safeSymbol(i),r=this.safeInteger(t,"settleTime");d.push({info:t,symbol:s,fundingRate:this.safeNumber(t,"fundingRate"),timestamp:r,datetime:this.iso8601(r)})}const c=this.sortBy(d,"timestamp");return this.filterBySymbolSinceLimit(c,r.symbol,t,i)}async fetchLeverageTiers(e,t={}){await this.loadMarkets();const i=await this.contractPublicGetDetail(t),s=this.safeValue(i,"data");return this.parseLeverageTiers(s,e,"symbol")}parseMarketLeverageTiers(e,t){let i=this.safeString(e,"maintenanceMarginRate"),s=this.safeString(e,"initialMarginRate");const r=this.safeString(e,"maxVol"),a=this.safeString(e,"riskIncrVol"),n=this.safeString(e,"riskIncrMmr"),o=this.safeString(e,"riskIncrImr");let h="0";const d=[],c=this.safeString(e,"quoteCoin");for(;b.stringLt(h,r);){const t=b.stringAdd(h,a);d.push({tier:this.parseNumber(b.stringDiv(t,a)),currency:this.safeCurrencyCode(c),minNotional:this.parseNumber(h),maxNotional:this.parseNumber(t),maintenanceMarginRate:this.parseNumber(i),maxLeverage:this.parseNumber(b.stringDiv("1",s)),info:e}),s=b.stringAdd(s,o),i=b.stringAdd(i,n),h=t}return d}async setPositionMode(e,t,i={}){const s={positionMode:e?1:2};return await this.contractPrivatePostPositionChangePositionMode(this.extend(s,i))}async fetchPositionMode(e,t={}){const i=await this.contractPrivateGetPositionPositionMode(t);return{info:i,hedged:1===this.safeInteger(i,"data")}}}},67737:function(e,t,i){"use strict";const s=i(48819),{BadRequest:r,InvalidNonce:a,BadSymbol:n,InvalidOrder:o,InvalidAddress:h,ExchangeError:d,ArgumentsRequired:c,NotSupported:l,InsufficientFunds:u,PermissionDenied:f}=i(73449),{TICK_SIZE:p}=i(62115),m=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"mexc3",name:"MEXC Global",countries:["SC"],rateLimit:50,version:"v3",has:{CORS:void 0,spot:!0,margin:!0,swap:!0,future:!0,option:void 0,addMargin:!0,borrowMargin:!0,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:void 0,createDepositAddress:void 0,createLimitOrder:void 0,createMarketOrder:void 0,createOrder:!0,createReduceOnlyOrder:!0,deposit:void 0,editOrder:void 0,fetchAccounts:!0,fetchBalance:!0,fetchBidsAsks:!0,fetchBorrowRate:void 0,fetchBorrowRateHistory:void 0,fetchBorrowRates:void 0,fetchBorrowRatesPerSymbol:void 0,fetchCanceledOrders:!0,fetchClosedOrder:void 0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposit:void 0,fetchDepositAddress:!0,fetchDepositAddresses:void 0,fetchDepositAddressesByNetwork:!0,fetchDeposits:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:!0,fetchFundingRate:!0,fetchFundingRateHistory:!0,fetchFundingRates:void 0,fetchIndexOHLCV:!0,fetchL2OrderBook:!0,fetchLedger:void 0,fetchLedgerEntry:void 0,fetchLeverageTiers:!0,fetchMarginMode:!1,fetchMarketLeverageTiers:void 0,fetchMarkets:!0,fetchMarkOHLCV:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrder:void 0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderBooks:void 0,fetchOrders:!0,fetchOrderTrades:!0,fetchPosition:!0,fetchPositionMode:!0,fetchPositions:!0,fetchPositionsRisk:void 0,fetchPremiumIndexOHLCV:!1,fetchStatus:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:void 0,fetchTradingFees:!0,fetchTradingLimits:void 0,fetchTransactionFee:"emulated",fetchTransactionFees:!0,fetchTransactions:void 0,fetchTransfer:!0,fetchTransfers:!0,fetchWithdrawal:void 0,fetchWithdrawals:!0,privateAPI:!0,publicAPI:!0,reduceMargin:!0,repayMargin:!0,setLeverage:!0,setMarginMode:void 0,setPositionMode:!0,signIn:void 0,transfer:void 0,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/137283979-8b2a818d-8633-461b-bfca-de89e8c446b2.jpg",api:{spot:{public:"https://api.mexc.com",private:"https://api.mexc.com"},spot2:{public:"https://www.mexc.com/open/api/v2",private:"https://www.mexc.com/open/api/v2"},contract:{public:"https://contract.mexc.com/api/v1/contract",private:"https://contract.mexc.com/api/v1/private"}},www:"https://www.mexc.com/",doc:["https://mxcdevelop.github.io/apidocs/spot_v3_en/","https://mxcdevelop.github.io/APIDoc/"],fees:["https://www.mexc.com/fee"],referral:"https://m.mexc.com/auth/signup?inviteCode=1FQ1G"},api:{spot:{public:{get:{ping:1,time:1,exchangeInfo:1,depth:1,trades:1,historicalTrades:1,aggTrades:1,klines:1,avgPrice:1,"ticker/24hr":1,"ticker/price":1,"ticker/bookTicker":1,"etf/info":1}},private:{get:{order:1,openOrders:1,allOrders:1,account:1,myTrades:1,"sub-account/list":1,"sub-account/apiKey":1,"capital/config/getall":1,"capital/deposit/hisrec":1,"capital/withdraw/history":1,"capital/deposit/address":1,"capital/transfer":1,"capital/sub-account/universalTransfer":1,"margin/loan":1,"margin/allOrders":1,"margin/myTrades":1,"margin/openOrders":1,"margin/maxTransferable":1,"margin/priceIndex":1,"margin/order":1,"margin/isolated/account":1,"margin/maxBorrowable":1,"margin/repay":1,"margin/isolated/pair":1,"margin/forceLiquidationRec":1,"margin/isolatedMarginData":1,"margin/isolatedMarginTier":1,"rebate/taxQuery":1,"rebate/detail":1,"rebate/detail/kickback":1,"rebate/referCode":1,"mxDeduct/enable":1},post:{order:1,"order/test":1,"sub-account/virtualSubAccount":1,"sub-account/apiKey":1,"sub-account/futures":1,"sub-account/margin":1,batchOrders:1,"capital/withdraw/apply":1,"capital/transfer":1,"capital/deposit/address":1,"capital/sub-account/universalTransfer":1,"margin/tradeMode":1,"margin/order":1,"margin/loan":1,"margin/repay":1,"mxDeduct/enable":1},delete:{order:1,openOrders:1,"sub-account/apiKey":1,"margin/order":1,"margin/openOrders":1}}},contract:{public:{get:{ping:2,detail:2,support_currencies:2,"depth/{symbol}":2,"depth_commits/{symbol}/{limit}":2,"index_price/{symbol}":2,"fair_price/{symbol}":2,"funding_rate/{symbol}":2,"kline/{symbol}":2,"kline/index_price/{symbol}":2,"kline/fair_price/{symbol}":2,"deals/{symbol}":2,ticker:2,risk_reverse:2,"risk_reverse/history":2,"funding_rate/history":2}},private:{get:{"account/assets":2,"account/asset/{currency}":2,"account/transfer_record":2,"position/list/history_positions":2,"position/open_positions":2,"position/funding_records":2,"position/position_mode":2,"order/list/open_orders/{symbol}":2,"order/list/history_orders":2,"order/external/{symbol}/{external_oid}":2,"order/get/{order_id}":2,"order/batch_query":8,"order/deal_details/{order_id}":2,"order/list/order_deals":2,"planorder/list/orders":2,"stoporder/list/orders":2,"stoporder/order_details/{stop_order_id}":2,"account/risk_limit":2,"account/tiered_fee_rate":2,"position/leverage":2},post:{"position/change_margin":2,"position/change_leverage":2,"position/change_position_mode":2,"order/submit":2,"order/submit_batch":40,"order/cancel":2,"order/cancel_with_external":2,"order/cancel_all":2,"account/change_risk_level":2,"planorder/place":2,"planorder/cancel":2,"planorder/cancel_all":2,"stoporder/cancel":2,"stoporder/cancel_all":2,"stoporder/change_price":2,"stoporder/change_plan_price":2}}},spot2:{public:{get:{"market/symbols":1,"market/coin/list":2,"common/timestamp":1,"common/ping":1,"market/ticker":1,"market/depth":1,"market/deals":1,"market/kline":1,"market/api_default_symbols":2}},private:{get:{"account/info":1,"order/open_orders":1,"order/list":1,"order/query":1,"order/deals":1,"order/deal_detail":1,"asset/deposit/address/list":2,"asset/deposit/list":2,"asset/address/list":2,"asset/withdraw/list":2,"asset/internal/transfer/record":10,"account/balance":10,"asset/internal/transfer/info":10,"market/api_symbols":2},post:{"order/place":1,"order/place_batch":1,"order/advanced/place_batch":1,"asset/withdraw":2,"asset/internal/transfer":10},delete:{"order/cancel":1,"order/cancel_by_symbol":1,"asset/withdraw":2}}}},precisionMode:p,timeframes:{"1m":"1m","3m":"3m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","2h":"2h","4h":"4h","6h":"6h","8h":"8h","12h":"12h","1d":"1d","3d":"3d","1w":"1w","1M":"1M"},fees:{trading:{tierBased:!1,percentage:!0,maker:this.parseNumber("0.002"),taker:this.parseNumber("0.002")}},options:{createMarketBuyOrderRequiresPrice:!0,unavailableContracts:{"BTC/USDT:USDT":!0,"LTC/USDT:USDT":!0,"ETH/USDT:USDT":!0},fetchMarkets:{types:{spot:!0,future:{linear:!1,inverse:!1},swap:{linear:!0,inverse:!1}}},timeframes:{spot:{"1m":"1m","3m":"3m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","2h":"2h","4h":"4h","6h":"6h","8h":"8h","12h":"12h","1d":"1d","3d":"3d","1w":"1w","1M":"1M"},swap:{"1m":"Min1","5m":"Min5","15m":"Min15","30m":"Min30","1h":"Min60","4h":"Hour4","8h":"Hour8","1d":"Day1","1w":"Week1","1M":"Month1"}},defaultType:"spot",networks:{TRX:"TRC20",ETH:"ERC20",BEP20:"BEP20(BSC)",BSC:"BEP20(BSC)"},networksById:{"BEP20(BSC)":"BSC"},networkAliases:{"BSC(BEP20)":"BSC"},recvWindow:5e3,maxTimeTillEnd:7775999999,broker:"CCXT"},commonCurrencies:{BEYONDPROTOCOL:"BEYOND",BIFI:"BIFIF",BYN:"BeyondFi",COFI:"COFIX",DFI:"DfiStarter",DFT:"dFuture",DRK:"DRK",EGC:"Egoras Credit",FLUX1:"FLUX",FLUX:"FLUX1",FREE:"FreeRossDAO",GMT:"GMT Token",STEPN:"GMT",HERO:"Step Hero",MIMO:"Mimosa",PROS:"Pros.Finance",SIN:"Sin City Token",SOUL:"Soul Swap"},exceptions:{exact:{"-1128":r,"-2011":r,"-1121":n,10101:u,2009:o,2011:r,30004:u,33333:r,44444:r,1002:o,30019:r,30005:o,2003:o,2005:u,600:r,70011:f,88004:u,88009:d,88013:o,88015:u,700003:a},broad:{"Order quantity error, please try to modify.":r,"Combination of optional parameters invalid":r,"api market order is disabled":r,"Contract not allow place order!":o,Oversold:o,"Insufficient position":u,"Insufficient balance!":u,"Bid price is great than max allow price":o,"Invalid symbol.":n,"Param error!":r}}})}async fetchStatus(e={}){const[t,i]=this.handleMarketTypeAndParams("fetchStatus",void 0,e);let s,r,a;return"spot"===t?(s=await this.spotPublicGetPing(i),r=Object.keys(s).length?this.json(s):"ok"):"swap"===t&&(s=await this.contractPublicGetPing(i),r=this.safeValue(s,"success")?"ok":this.json(s),a=this.safeInteger(s,"data")),{status:r,updated:a,url:void 0,eta:void 0,info:s}}async fetchTime(e={}){const[t,i]=this.handleMarketTypeAndParams("fetchTime",void 0,e);let s;return"spot"===t?(s=await this.spotPublicGetTime(i),this.safeInteger(s,"serverTime")):"swap"===t?(s=await this.contractPublicGetPing(i),this.safeInteger(s,"data")):void 0}async fetchCurrencies(e={}){if(!this.checkRequiredCredentials(!1))return;const t=await this.spotPrivateGetCapitalConfigGetall(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"coin"),a=this.safeCurrencyCode(r),n=this.safeString(s,"name");let o,h,d,c=!1,l=!1,u=!1;const f={},p=this.safeValue(s,"networkList",[]);for(let e=0;e<p.length;e++){const t=p[e],i=this.safeString(t,"network"),s=this.safeNetwork(i),r=this.safeValue(t,"depositEnable",!1),a=this.safeValue(t,"withdrawEnable",!1),n=r&&a;c=n||c;const g=this.safeString(t,"withdrawMin"),y=this.safeString(t,"withdrawMax");h=void 0===h?g:h,d=void 0===d?y:d;const b=this.safeNumber(t,"withdrawFee");o=void 0===o?b:o,m.stringGt(h,g)&&(h=g),m.stringLt(d,y)&&(d=y),r&&(l=!0),a&&(u=!0),f[s]={info:t,id:i,network:s,active:n,deposit:r,withdraw:a,fee:b,precision:void 0,limits:{withdraw:{min:g,max:y}}}}const g=Object.keys(f).length;if(1===g||"NONE"in f){const e=this.safeValue2(f,"NONE",g-1);void 0!==e&&(o=e.fee)}i[a]={info:s,id:r,code:a,name:n,active:c,deposit:l,withdraw:u,fee:o,precision:void 0,limits:{amount:{min:void 0,max:void 0},withdraw:{min:h,max:d}},networks:f}}return i}safeNetwork(e){if(e.indexOf("BSC")>=0)return"BEP20";const t=e.split(" ");e=(e=t.join("")).replace("-20","20");return this.safeString({ETH:"ETH",ERC20:"ERC20","BEP20(BSC)":"BEP20",TRX:"TRC20"},e,e)}async fetchMarkets(e={}){const t=await this.fetchSpotMarkets(e),i=await this.fetchSwapMarkets(e);return this.arrayConcat(t,i)}async fetchSpotMarkets(e={}){const t=await this.spotPublicGetExchangeInfo(e),i=this.safeValue(t,"symbols",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"symbol"),a=this.safeString(t,"baseAsset"),n=this.safeString(t,"quoteAsset"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=this.safeString(t,"status"),c=this.safeValue(t,"isSpotTradingAllowed");let l=!1;"ENABLED"===d&&c&&(l=!0);const u=this.safeValue(t,"isMarginTradingAllowed"),f=this.safeNumber(t,"makerCommission"),p=this.safeNumber(t,"takerCommission"),m=this.safeNumber(t,"maxQuoteAmount");s.push({id:r,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:u,swap:!1,future:!1,option:!1,active:l,contract:!1,linear:void 0,inverse:void 0,taker:p,maker:f,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"baseAssetPrecision"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"quoteAssetPrecision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"baseSizePrecision"),max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"quoteAmountPrecision"),max:m}},info:t})}return s}async fetchSwapMarkets(e={}){const t=await this.contractPublicGetDetail(e),i=this.safeValue(t,"data",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"symbol"),a=this.safeString(t,"baseCoin"),n=this.safeString(t,"quoteCoin"),o=this.safeString(t,"settleCoin"),h=this.safeCurrencyCode(a),d=this.safeCurrencyCode(n),c=this.safeCurrencyCode(o),l=this.safeString(t,"state");s.push({id:r,symbol:h+"/"+d+":"+c,base:h,quote:d,settle:c,baseId:a,quoteId:n,settleId:o,type:"swap",spot:!1,margin:!1,swap:!0,future:!1,option:!1,active:"0"===l,contract:!0,linear:!0,inverse:!1,taker:this.safeNumber(t,"takerFeeRate"),maker:this.safeNumber(t,"makerFeeRate"),contractSize:this.safeNumber(t,"contractSize"),expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(t,"volUnit"),price:this.safeNumber(t,"priceUnit")},limits:{leverage:{min:this.safeNumber(t,"minLeverage"),max:this.safeNumber(t,"maxLeverage")},amount:{min:this.safeNumber(t,"minVol"),max:this.safeNumber(t,"maxVol")},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return s}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};let a;if(void 0!==t&&(r.limit=t),s.spot){const t=await this.spotPublicGetDepth(this.extend(r,i));a=this.parseOrderBook(t,e),a.nonce=this.safeInteger(t,"lastUpdateId")}else if(s.swap){const t=await this.contractPublicGetDepthSymbol(this.extend(r,i)),s=this.safeValue(t,"data"),n=this.safeInteger(s,"timestamp");a=this.parseOrderBook(s,e,n),a.nonce=this.safeInteger(s,"version")}return a}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};let n;if(void 0!==i&&(a.limit=i),r.spot){let e=this.safeString(this.options,"fetchTradesMethod","spotPublicGetAggTrades");e=this.safeString(s,"method",e),n=await this[e](this.extend(a,s))}else if(r.swap){const e=await this.contractPublicGetDealsSymbol(this.extend(a,s));n=this.safeValue(e,"data")}return this.parseTrades(n,r,t,i)}parseTrade(e,t){let i,s,r,a,n;const o=void 0;let h,d,c,l,u;if("v"in e)s=this.safeInteger(e,"t"),a=(t=this.safeMarket(void 0,t)).symbol,c=this.safeString(e,"p"),l=this.safeString(e,"v"),h=this.parseOrderSide(this.safeString(e,"T")),d="taker";else{const o=this.safeString(e,"symbol");if(a=(t=this.safeMarket(o,t)).symbol,i=this.safeString2(e,"id","a"),c=this.safeString2(e,"price","p"),r=this.safeString(e,"orderId"),"positionMode"in e)s=this.safeInteger(e,"timestamp"),l=this.safeString(e,"vol"),h=this.parseOrderSide(this.safeString(e,"side")),n={cost:this.safeString(e,"fee"),currency:this.safeCurrencyCode(this.safeString(e,"feeCurrency"))},d=this.safeValue(e,"taker")?"taker":"maker";else{s=this.safeInteger2(e,"time","T"),l=this.safeString2(e,"qty","q"),u=this.safeString(e,"quoteQty");const t=this.safeValue(e,"isBuyer"),i=this.safeValue(e,"isMaker"),r=this.safeString2(e,"isBuyerMaker","m");void 0!==i&&(d=i?"maker":"taker"),void 0!==t&&(h=t?"buy":"sell"),void 0!==r&&(h=r?"sell":"buy",d="taker");const a=this.safeString(e,"commissionAsset");void 0!==a&&(n={cost:this.safeString(e,"commission"),currency:this.safeCurrencyCode(a)})}}return void 0===i&&(i=this.syntheticTradeId(t,s,h,l,c,o,d)),this.safeTrade({id:i,order:r,timestamp:s,datetime:this.iso8601(s),symbol:a,type:o,side:h,takerOrMaker:d,price:c,amount:l,cost:u,fee:n,info:e},t)}syntheticTradeId(e,t,i,s,r,a,n){let o="";return void 0!==t&&(o=this.numberToString(t)+"-"+this.safeString(e,"id","_"),void 0!==i&&(o+="-"+i),void 0!==s&&(o+="-"+this.numberToString(s)),void 0!==r&&(o+="-"+this.numberToString(r)),void 0!==n&&(o+="-"+n),void 0!==a&&(o+="-"+a)),o}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.safeValue(this.options,"timeframes",{}),o=this.safeValue(n,a.type,{}),h=this.safeString(o,t),d={symbol:a.id,interval:h};let c;if(a.spot){void 0!==i&&(d.startTime=i),void 0!==s&&(d.limit=s);c=await this.spotPublicGetKlines(this.extend(d,r))}else if(a.swap){void 0!==i&&(d.start=parseInt(i/1e3));const e=this.safeString(r,"price","default");r=this.omit(r,"price");const t=this.getSupportedMapping(e,{default:"contractPublicGetKlineSymbol",index:"contractPublicGetKlineIndexPriceSymbol",mark:"contractPublicGetKlineFairPriceSymbol"}),s=await this[t](this.extend(d,r)),a=this.safeValue(s,"data");c=this.convertTradingViewToOHLCV(a,"time","open","high","low","close","vol")}return this.parseOHLCVs(c,a,t,i,s)}parseOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchTickers(e,t={}){await this.loadMarkets();const i={};let s,r=!1;if(void 0!==e){r=1===e.length;const t=this.safeString(e,0);s=this.market(t)}const[a,n]=this.handleMarketTypeAndParams("fetchTickers",s,t);let o;if(r&&(i.symbol=s.id),"spot"===a)o=await this.spotPublicGetTicker24hr(this.extend(i,n));else if("swap"===a){const e=await this.contractPublicGetTicker(this.extend(i,n));o=this.safeValue(e,"data",[])}return r&&(o=[o]),this.parseTickers(o,e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),[s,r]=this.handleMarketTypeAndParams("fetchTicker",i,t);let a;const n={symbol:i.id};if("spot"===s)a=await this.spotPublicGetTicker24hr(this.extend(n,r));else if("swap"===s){const e=await this.contractPublicGetTicker(this.extend(n,r));a=this.safeValue(e,"data",{})}return this.parseTicker(a,i)}parseTicker(e,t){const i=this.safeString(e,"symbol");let s,r,a,n,o,h,d,c,l,u,f,p,g;t=this.safeMarket(i,t);return this.safeValue(t,"swap")||"timestamp"in e?(s=this.safeInteger(e,"timestamp"),r=this.safeString(e,"bid1"),a=this.safeString(e,"ask1"),h=this.safeString(e,"volume24"),d=this.safeString(e,"amount24"),l=this.safeString(e,"high24Price"),u=this.safeString(e,"lower24Price"),p=this.safeString(e,"riseFallValue"),f=this.safeString(e,"riseFallRate"),f=m.stringMul(f,"100")):(s=this.safeInteger(e,"closeTime"),r=this.safeString(e,"bidPrice"),a=this.safeString(e,"askPrice"),n=this.safeString(e,"bidQty"),o=this.safeString(e,"askQty"),m.stringEq(n,"0")&&(n=void 0),m.stringEq(o,"0")&&(o=void 0),h=this.safeString(e,"volume"),d=this.safeString(e,"quoteVolume"),c=this.safeString(e,"openPrice"),l=this.safeString(e,"highPrice"),u=this.safeString(e,"lowPrice"),g=this.safeString(e,"prevClosePrice"),p=this.safeString(e,"priceChange"),f=this.safeString(e,"priceChangePercent"),f=m.stringMul(f,"100")),this.safeTicker({symbol:t.symbol,timestamp:s,datetime:this.iso8601(s),open:c,high:l,low:u,close:this.safeString(e,"lastPrice"),bid:r,bidVolume:n,ask:a,askVolume:o,vwap:void 0,previousClose:g,change:p,percentage:f,average:void 0,baseVolume:h,quoteVolume:d,info:e},t)}async fetchBidsAsks(e,t={}){let i;await this.loadMarkets();let s=!1;if(void 0!==e){s=1===e.length,i=this.market(e[0])}const[r,a]=this.handleMarketTypeAndParams("fetchBidsAsks",i,t);let n;if("spot"===r)n=await this.spotPublicGetTickerBookTicker(a);else if("swap"===r)throw new l(this.id+" fetchBidsAsks() is not available for "+r+" markets");return s&&(n=[n]),this.parseTickers(n,e)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),[o,h]=this.handleMarginModeAndParams("createOrder",a);return n.spot?await this.createSpotOrder(n,t,i,s,r,o,h):n.swap?await this.createSwapOrder(n,t,i,s,r,o,h):void 0}async createSpotOrder(e,t,i,s,a,n,h={}){const d=e.symbol,c="buy"===i?"BUY":"SELL",l={symbol:e.id,side:c,type:t.toUpperCase()};if("BUY"===c&&"market"===t){const e=this.safeNumber(h,"quoteOrderQty");if(void 0!==e)s=e;else if(this.options.createMarketBuyOrderRequiresPrice){if(void 0===a)throw new o(this.id+" createOrder() requires the price argument with market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount, or, alternatively, add .options['createMarketBuyOrderRequiresPrice'] = false to supply the cost in the amount argument (the exchange-specific behaviour)");{const e=this.numberToString(s),t=this.numberToString(a),i=m.stringMul(e,t);s=this.parseNumber(i)}}l.quoteOrderQty=s}else l.quantity=this.amountToPrecision(d,s);void 0!==a&&(l.price=this.priceToPrecision(d,a));const u=this.safeString(h,"clientOrderId");void 0!==u&&(l.newClientOrderId=u,h=this.omit(h,["type","clientOrderId"]));let f="spotPrivatePostOrder";if(void 0!==n){if("isolated"!==n)throw new r(this.id+" createOrder() does not support marginMode "+n+" for spot-margin trading");f="spotPrivatePostMarginOrder"}const p=await this[f](this.extend(l,h));return this.extend(this.parseOrder(p,e),{side:i,type:t,price:a,amount:s})}async createSwapOrder(e,t,i,s,r,a,n={}){await this.loadMarkets();const h=e.symbol,d=this.safeValue(this.options,"unavailableContracts",{});if(this.safeValue(d,h,!1))throw new l(this.id+" createSwapOrder() does not support yet this symbol:"+h);let u;if(void 0!==a)if("cross"===a)u=2;else{if("isolated"!==a)throw new c(this.id+' createSwapOrder() marginMode parameter should be either "cross" or "isolated"');u=1}else u=this.safeInteger(n,"openType",2);if("limit"!==t&&"market"!==t&&1!==t&&2!==t&&3!==t&&4!==t&&5!==t&&6!==t)throw new o(this.id+" createSwapOrder() order type must either limit, market, or 1 for limit orders, 2 for post-only orders, 3 for IOC orders, 4 for FOK orders, 5 for market orders or 6 to convert market price to current price");this.safeValue(n,"postOnly",!1)?t=2:"limit"===t?t=1:"market"===t&&(t=6);const f={symbol:e.id,vol:parseFloat(this.amountToPrecision(h,s)),type:t,openType:u};let p="contractPrivatePostOrderSubmit";const m=this.safeNumber2(n,"triggerPrice","stopPrice");if(n=this.omit(n,["stopPrice","triggerPrice"]),m&&(p="contractPrivatePostPlanorderPlace",f.triggerPrice=this.priceToPrecision(h,m),f.triggerType=this.safeInteger(n,"triggerType",1),f.executeCycle=this.safeInteger(n,"executeCycle",1),f.trend=this.safeInteger(n,"trend",1),f.orderType=this.safeInteger(n,"orderType",1)),5!==t&&6!==t&&"market"!==t&&(f.price=parseFloat(this.priceToPrecision(h,r))),1===u){if(void 0===this.safeInteger(n,"leverage"))throw new c(this.id+" createSwapOrder() requires a leverage parameter for isolated margin orders")}const g=this.safeValue(n,"reduceOnly",!1);f.side=g?"buy"===i?2:4:"buy"===i?1:3;const y=this.safeString2(n,"clientOrderId","externalOid");void 0!==y&&(f.externalOid=y),n=this.omit(n,["clientOrderId","externalOid","postOnly"]);const b=await this[p](this.extend(f,n)),v=this.safeString(b,"data");return this.parseOrder(v,e)}async fetchOrder(e,t,i={}){if(void 0===t)throw new c(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),a={symbol:s.id};let n;if(s.spot){const t=this.safeString(i,"clientOrderId");void 0!==t?(i=this.omit(i,"clientOrderId"),a.origClientOrderId=t):a.orderId=e;const[s,o]=this.handleMarginModeAndParams("fetchOrder",i);let h="spotPrivateGetOrder";if(void 0!==s){if("isolated"!==s)throw new r(this.id+" fetchOrder() does not support marginMode "+s+" for spot-margin trading");h="spotPrivateGetMarginOrder"}n=await this[h](this.extend(a,o))}else if(s.swap){a.order_id=e;const t=await this.contractPrivateGetOrderGetOrderId(this.extend(a,i));n=this.safeValue(t,"data")}return this.parseOrder(n,s)}async fetchOrders(e,t,i,s={}){await this.loadMarkets();const a={};let n;void 0!==e&&(n=this.market(e),a.symbol=n.id);const[o,h]=this.handleMarketTypeAndParams("fetchOrders",n,s);if("spot"===o){if(void 0===e)throw new c(this.id+" fetchOrders() requires a symbol argument for spot market");const[o,h]=this.handleMarginModeAndParams("fetchOrders",s);let d="spotPrivateGetAllOrders";if(void 0!==o){if("isolated"!==o)throw new r(this.id+" fetchOrders() does not support marginMode "+o+" for spot-margin trading");d="spotPrivateGetMarginAllOrders"}void 0!==t&&(a.startTime=t),void 0!==i&&(a.limit=i);const l=await this[d](this.extend(a,h));return this.parseOrders(l,n,t,i)}{if(void 0!==t){a.start_time=t;void 0===this.safeInteger(s,"end_time")&&(a.end_time=this.sum(t,this.options.maxTimeTillEnd))}void 0!==i&&(a.page_size=i);let e=this.safeString(this.options,"fetchOrders","contractPrivateGetOrderListHistoryOrders");e=this.safeString(h,"method",e);let r=[],o=[];if("contractPrivateGetOrderListHistoryOrders"===e){const e=await this.contractPrivateGetOrderListHistoryOrders(this.extend(a,h));r=this.safeValue(e,"data")}else{const e=await this.contractPrivateGetPlanorderListOrders(this.extend(a,h));o=this.safeValue(e,"data")}const d=this.arrayConcat(o,r);return this.parseOrders(d,n,t,i,s)}}async fetchOrdersByIds(e,t,i={}){await this.loadMarkets();const s={};let a;void 0!==t&&(a=this.market(t),s.symbol=a.id);const[n,o]=this.handleMarketTypeAndParams("fetchOrdersByIds",a,i);if("spot"===n)throw new r(this.id+" fetchOrdersByIds() is not supported for "+n);{s.order_ids=e.join(",");const t=await this.contractPrivateGetOrderBatchQuery(this.extend(s,o)),i=this.safeValue(t,"data");return this.parseOrders(i,a)}}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const a={};let n,o;if(void 0!==e&&(n=this.market(e),a.symbol=n.id),[o,s]=this.handleMarketTypeAndParams("fetchOpenOrders",n,s),"spot"===o){if(void 0===e)throw new c(this.id+" fetchOpenOrders() requires a symbol argument for spot market");let o="spotPrivateGetOpenOrders";const[h,d]=this.handleMarginModeAndParams("fetchOpenOrders",s);if(void 0!==h){if("isolated"!==h)throw new r(this.id+" fetchOpenOrders() does not support marginMode "+h+" for spot-margin trading");o="spotPrivateGetMarginOpenOrders"}const l=await this[o](this.extend(a,d));return this.parseOrders(l,n,t,i)}return await this.fetchOrdersByState(2,e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersByState(3,e,t,i,s)}async fetchCanceledOrders(e,t,i,s={}){return await this.fetchOrdersByState(4,e,t,i,s)}async fetchOrdersByState(e,t,i,s,a={}){await this.loadMarkets();const n={};let o;void 0!==t&&(o=this.market(t),n.symbol=o.id);const[h]=this.handleMarketTypeAndParams("fetchOrdersByState",o,a);if("spot"===h)throw new r(this.id+" fetchOrdersByState() is not supported for "+h);return a.states=e,await this.fetchOrders(t,i,s,a)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={};let a,n;void 0!==t&&(a=this.market(t),s.symbol=a.id),[n,i]=this.handleMarketTypeAndParams("cancelOrder",a,i);const[h,d]=this.handleMarginModeAndParams("cancelOrder",i);let l;if("spot"===n){if(void 0===t)throw new c(this.id+" cancelOrder() requires a symbol argument");const s={symbol:a.id},n=this.safeString(i,"clientOrderId");void 0!==n?(i=this.omit(d,"clientOrderId"),s.origClientOrderId=n):s.orderId=e;let o="spotPrivateDeleteOrder";if(void 0!==h){if("isolated"!==h)throw new r(this.id+" cancelOrder() does not support marginMode "+h+" for spot-margin trading");o="spotPrivateDeleteMarginOrder"}l=await this[o](this.extend(s,d))}else{let t=this.safeString(this.options,"cancelOrder","contractPrivatePostOrderCancel");t=this.safeString(d,"method",t);const i=await this[t]([e]);l=this.safeValue(i,"data");const s=this.safeValue(l,0),r=this.safeValue(s,"errorMsg","");if("success"!==r)throw new o(this.id+" cancelOrder() the order with id "+e+" cannot be cancelled: "+r)}return this.parseOrder(l,a)}async cancelOrders(e,t,i={}){await this.loadMarkets();const s=void 0!==t?this.market(t):void 0,[a]=this.handleMarketTypeAndParams("cancelOrders",s,i);if("spot"===a)throw new r(this.id+" cancelOrders() is not supported for "+a);{const t=await this.contractPrivatePostOrderCancel(e),i=this.safeValue(t,"data");return this.parseOrders(i,s)}}async cancelAllOrders(e,t={}){await this.loadMarkets();const i=void 0!==e?this.market(e):void 0,s={};let a;[a,t]=this.handleMarketTypeAndParams("cancelAllOrders",i,t);const[n,o]=this.handleMarginModeAndParams("cancelAllOrders",t);if("spot"===a){if(void 0===e)throw new c(this.id+" cancelAllOrders() requires a symbol argument on spot");s.symbol=i.id;let t="spotPrivateDeleteOpenOrders";if(void 0!==n){if("isolated"!==n)throw new r(this.id+" cancelAllOrders() does not support marginMode "+n+" for spot-margin trading");t="spotPrivateDeleteMarginOpenOrders"}const a=await this[t](this.extend(s,o));return this.parseOrders(a,i)}{void 0!==e&&(s.symbol=i.id);let t=this.safeString(this.options,"cancelAllOrders","contractPrivatePostOrderCancelAll");t=this.safeString(o,"method",t);const r=await this[t](this.extend(s,o)),a=this.safeValue(r,"data",[]);return this.parseOrders(a,i)}}parseOrder(e,t){let i;i="string"==typeof e?e:this.safeString2(e,"orderId","id");const s=this.safeString(e,"symbol");t=this.safeMarket(s,t);const r=this.safeIntegerN(e,["time","createTime","transactTime"]);let a;const n=this.safeString(e,"feeCurrency");if(void 0!==n){const t=this.safeString(e,"takerFee"),i=this.safeString(e,"makerFee"),s=m.stringAdd(t,i);a={currency:n,cost:this.parseNumber(s)}}return this.safeOrder({id:i,clientOrderId:this.safeString(e,"clientOrderId"),timestamp:r,datetime:this.iso8601(r),lastTradeTimestamp:void 0,status:this.parseOrderStatus(this.safeString2(e,"status","state")),symbol:t.symbol,type:this.parseOrderType(this.safeString(e,"type")),timeInForce:this.parseOrderTimeInForce(this.safeString(e,"timeInForce")),side:this.parseOrderSide(this.safeString(e,"side")),price:this.safeNumber(e,"price"),stopPrice:this.safeNumber2(e,"stopPrice","triggerPrice"),triggerPrice:this.safeNumber2(e,"stopPrice","triggerPrice"),average:this.safeNumber(e,"dealAvgPrice"),amount:this.safeNumber2(e,"origQty","vol"),cost:this.safeNumber(e,"cummulativeQuoteQty"),filled:this.safeNumber2(e,"executedQty","dealVol"),remaining:void 0,fee:a,trades:void 0,info:e},t)}parseOrderSide(e){return this.safeString({BUY:"buy",SELL:"sell"},e,e)}parseOrderType(e){return this.safeString({MARKET:"market",LIMIT:"limit",LIMIT_MAKER:"limit"},e,e)}parseOrderStatus(e){return this.safeString({NEW:"open",FILLED:"closed",CANCELED:"canceled",PARTIALLY_FILLED:"open",PARTIALLY_CANCELED:"canceled",2:"open",3:"closed",4:"canceled"},e,e)}parseOrderTimeInForce(e){return this.safeString({GTC:"GTC",FOK:"FOK",IOC:"IOC"},e,e)}async fetchAccountHelper(e,t){if("spot"===e)return await this.spotPrivateGetAccount(t);if("swap"===e){const e=await this.contractPrivateGetAccountAssets(t);return this.safeValue(e,"data")}}async fetchAccounts(e={}){const[t,i]=this.handleMarketTypeAndParams("fetchAccounts",void 0,e);await this.loadMarkets();const s=await this.fetchAccountHelper(t,i),r=this.safeValue(s,"balances",[]),a=[];for(let e=0;e<r.length;e++){const t=r[e],i=this.safeString2(t,"asset","currency"),s=this.safeCurrencyCode(i);a.push({id:this.safeString(t,"id"),type:this.safeString(t,"type"),code:s,info:t})}return a}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.fetchAccountHelper("spot",e);let i=this.safeString(t,"makerCommission"),s=this.safeString(t,"takerCommission");i=m.stringDiv(i,"1000"),s=m.stringDiv(s,"1000");const r={};for(let e=0;e<this.symbols.length;e++){const a=this.symbols[e];r[a]={symbol:a,maker:this.parseNumber(i),taker:this.parseNumber(s),percentage:!0,tierBased:!1,info:t}}return r}parseBalance(e,t){let i;i="margin"===t?this.safeValue(e,"assets",[]):"swap"===t?this.safeValue(e,"data",[]):this.safeValue(e,"balances",[]);const s={info:e};if("margin"===t){for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"symbol"),a=this.safeSymbol(r,void 0),n=this.safeValue(t,"baseAsset",{}),o=this.safeValue(t,"quoteAsset",{}),h=this.safeCurrencyCode(this.safeString(n,"asset")),d=this.safeCurrencyCode(this.safeString(o,"asset")),c={};c[h]=this.parseBalanceHelper(n),c[d]=this.parseBalanceHelper(o),s[a]=this.safeBalance(c)}return s}if("swap"===t){for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(t,"availableBalance"),n.used=this.safeString(t,"frozenBalance"),s[a]=n}return this.safeBalance(s)}for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"asset"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(t,"free"),n.used=this.safeString(t,"locked"),s[a]=n}return this.safeBalance(s)}parseBalanceHelper(e){const t=this.account();t.used=this.safeString(e,"locked"),t.free=this.safeString(e,"free"),t.total=this.safeString(e,"totalAsset");const i=this.safeString(e,"borrowed"),s=this.safeString(e,"interest");return t.debt=m.stringAdd(i,s),t}async fetchBalance(e={}){let t;await this.loadMarkets();const i={};[t,e]=this.handleMarketTypeAndParams("fetchBalance",void 0,e);let s=this.getSupportedMapping(t,{spot:"spotPrivateGetAccount",swap:"contractPrivateGetAccountAssets",margin:"spotPrivateGetMarginIsolatedAccount"});const r=this.safeString(e,"marginMode"),a=this.safeValue(e,"margin",!1);if(void 0!==r||a||"margin"===t){let r;const a=this.safeString(e,"symbol");if(void 0===a){const t=this.safeValue(e,"symbols");void 0!==t&&(r=this.marketIds(t).join(","))}else{r=this.market(a).id}this.checkRequiredArgument("fetchBalance",r,"symbol or symbols"),s="spotPrivateGetMarginIsolatedAccount",t="margin",i.symbols=r}e=this.omit(e,["margin","marginMode","symbol","symbols"]);const n=await this[s](this.extend(i,e));return this.parseBalance(n,t)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new c(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),[a,n]=this.handleMarketTypeAndParams("fetchMyTrades",r,s),o={symbol:r.id};let h;if("spot"===a)void 0!==t&&(o.start_time=t),void 0!==i&&(o.limit=i),h=await this.spotPrivateGetMyTrades(this.extend(o,n));else{if(void 0!==t){o.start_time=t;void 0===this.safeInteger(s,"end_time")&&(o.end_time=this.sum(t,this.options.maxTimeTillEnd))}void 0!==i&&(o.page_size=i);const e=await this.contractPrivateGetOrderListOrderDeals(this.extend(o,n));h=this.safeValue(e,"data")}return this.parseTrades(h,r,t,i)}async fetchOrderTrades(e,t,i,s,r={}){await this.loadMarkets();const a={};let n;void 0!==t&&(n=this.market(t));const[o,h]=this.handleMarketTypeAndParams("fetchOrderTrades",n,r);let d;if("spot"===o){if(void 0===t)throw new c(this.id+" fetchOrderTrades() requires a symbol argument");a.symbol=n.id,a.orderId=e,d=await this.spotPrivateGetMyTrades(this.extend(a,h))}else{a.order_id=e;const t=await this.contractPrivateGetOrderDealDetailsOrderId(this.extend(a,h));d=this.safeValue(t,"data")}return this.parseTrades(d,n,i,s,h)}async modifyMarginHelper(e,t,i,s={}){const r=this.safeInteger(s,"positionId");if(void 0===r)throw new c(this.id+" modifyMarginHelper() requires a positionId parameter");await this.loadMarkets();const a={positionId:r,amount:t,type:i};return await this.contractPrivatePostPositionChangeMargin(this.extend(a,s))}async reduceMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,"SUB",i)}async addMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,"ADD",i)}async setLeverage(e,t,i={}){await this.loadMarkets();const s={leverage:e},r=this.safeInteger(i,"positionId");if(void 0===r){const e=this.safeNumber(i,"openType"),r=this.safeNumber(i,"positionType"),a=void 0!==t?this.market(t):void 0;if(void 0===e||void 0===r||void 0===a)throw new c(this.id+" setLeverage() requires a positionId parameter or a symbol argument with openType and positionType parameters, use openType 1 or 2 for isolated or cross margin respectively, use positionType 1 or 2 for long or short positions");s.openType=e,s.symbol=a.symbol,s.positionType=r}else s.positionId=r;return await this.contractPrivatePostPositionChangeLeverage(this.extend(s,i))}async fetchFundingHistory(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.symbol=r.id),void 0!==i&&(a.page_size=i);const n=await this.contractPrivateGetPositionFundingRecords(this.extend(a,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"resultList",[]),d=[];for(let t=0;t<h.length;t++){const i=h[t],s=this.safeInteger(i,"settleTime");d.push({info:i,symbol:e,code:void 0,timestamp:s,datetime:this.iso8601(s),id:this.safeNumber(i,"id"),amount:this.safeNumber(i,"funding")})}return d}parseFundingRate(e,t){const i=this.safeNumber(e,"fundingRate"),s=this.safeInteger(e,"nextSettleTime"),r=this.safeString(e,"symbol"),a=this.safeSymbol(r,t),n=this.safeInteger(e,"timestamp");return{info:e,symbol:a,markPrice:void 0,indexPrice:void 0,interestRate:void 0,estimatedSettlePrice:void 0,timestamp:n,datetime:this.iso8601(n),fundingRate:i,fundingTimestamp:s,fundingDatetime:this.iso8601(s),nextFundingRate:void 0,nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.contractPublicGetFundingRateSymbol(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseFundingRate(a,i)}async fetchFundingRateHistory(e,t,i,s={}){if(void 0===e)throw new c(this.id+" fetchFundingRateHistory() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.page_size=i);const n=await this.contractPublicGetFundingRateHistory(this.extend(a,s)),o=this.safeValue(n,"data"),h=this.safeValue(o,"resultList",[]),d=[];for(let e=0;e<h.length;e++){const t=h[e],i=this.safeString(t,"symbol"),s=this.safeSymbol(i),r=this.safeInteger(t,"settleTime");d.push({info:t,symbol:s,fundingRate:this.safeNumber(t,"fundingRate"),timestamp:r,datetime:this.iso8601(r)})}const l=this.sortBy(d,"timestamp");return this.filterBySymbolSinceLimit(l,r.symbol,t,i)}async fetchLeverageTiers(e,t={}){await this.loadMarkets();const i=await this.contractPublicGetDetail(t),s=this.safeValue(i,"data");return this.parseLeverageTiers(s,e,"symbol")}parseMarketLeverageTiers(e,t){let i=this.safeString(e,"maintenanceMarginRate"),s=this.safeString(e,"initialMarginRate");const r=this.safeString(e,"maxVol"),a=this.safeString(e,"riskIncrVol"),n=this.safeString(e,"riskIncrMmr"),o=this.safeString(e,"riskIncrImr");let h="0";const d=[],c=this.safeString(e,"quoteCoin");for(;m.stringLt(h,r);){const t=m.stringAdd(h,a);d.push({tier:this.parseNumber(m.stringDiv(t,a)),currency:this.safeCurrencyCode(c),notionalFloor:this.parseNumber(h),notionalCap:this.parseNumber(t),maintenanceMarginRate:this.parseNumber(i),maxLeverage:this.parseNumber(m.stringDiv("1",s)),info:e}),s=m.stringAdd(s,o),i=m.stringAdd(i,n),h=t}return d}parseDepositAddress(e,t){const i=this.safeString(e,"address"),s=this.safeCurrencyCode(void 0,t),r=this.safeString(e,"chain"),a=this.safeNetwork(r);return this.checkAddress(i),{currency:s,address:i,tag:void 0,network:a,info:e}}async fetchDepositAddressesByNetwork(e,t={}){await this.loadMarkets();const i={coin:this.currency(e).id},s=await this.spotPrivateGetCapitalDepositAddress(this.extend(i,t)),r=[];for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"coin"),a=this.currency(i),n=this.safeString(t,"network"),o=this.safeNetwork(n),h=this.safeString(t,"address",void 0),d=this.safeString2(t,"tag","memo",void 0);r.push({currency:a.id,network:o,address:h,tag:d})}return r}async fetchDepositAddress(e,t={}){const i=this.safeStringUpper(t,"network");t=this.omit(t,"network");const s=await this.fetchDepositAddressesByNetwork(e,t);if(void 0!==i)for(let e=0;e<s.length;e++){const t=s[e];if(i===this.safeStringUpper(t,"network"))return t}const r=this.safeValue(s,0);if(void 0===r)throw new h(this.id+" fetchDepositAddress() cannot find a deposit address for "+e+", consider creating one using the MEXC platform");return r}async fetchDeposits(e,t,i,s={}){if(void 0===e)throw new c(this.id+" fetchDeposits() requires a currency code argument");await this.loadMarkets();const r={};let a;const n=this.safeString(s,"network");if(s=this.omit(s,"network"),void 0===n)throw new c(this.id+" fetchDeposits() requires a network parameter when the currency is specified");if(a=this.currency(e),r.coin=a.id+"-"+n,void 0!==t&&(r.startTime=t),void 0!==i){if(i>1e3)throw new d("This exchange supports a maximum limit of 1000");r.limit=i}const o=await this.spotPrivateGetCapitalDepositHisrec(this.extend(r,s));return this.parseTransactions(o,a,t,i)}async fetchWithdrawals(e,t,i,s={}){if(void 0===e)throw new c(this.id+" fetchWithdrawals() requires a currency code argument");await this.loadMarkets();const r={},a=this.currency(e);if(r.coin=a.id,void 0!==t&&(r.startTime=t),void 0!==i){if(i>1e3)throw new d("This exchange supports a maximum limit of 1000");r.limit=i}const n=await this.spotPrivateGetCapitalWithdrawHistory(this.extend(r,s));return this.parseTransactions(n,a,t,i)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=void 0===i?"deposit":"withdrawal",r=this.safeInteger2(e,"insertTime","applyTime"),a=this.safeString(e,"currency"),n=this.safeString(e,"network"),o=this.safeCurrencyCode(a,t),h=this.parseTransactionStatus(this.safeString(e,"status"));let d=this.safeString(e,"amount");const c=this.safeString(e,"address"),l=this.safeString(e,"txId");let u;const f=this.safeString(e,"transactionFee");return void 0!==f&&(u={cost:this.parseNumber(f),currency:o}),"withdrawal"===s&&(d=m.stringSub(d,f)),{info:e,id:i,txid:l,timestamp:r,datetime:this.iso8601(r),network:n,address:c,addressTo:c,addressFrom:void 0,tag:this.safeString(e,"memo"),tagTo:void 0,tagFrom:void 0,type:s,amount:this.parseNumber(d),currency:o,status:h,updated:void 0,fee:u}}parseTransactionStatus(e){return this.safeString({WAIT:"pending",WAIT_PACKAGING:"pending",SUCCESS:"ok"},e,e)}async fetchPosition(e,t={}){await this.loadMarkets();const i={symbol:this.market(e).id},s=await this.fetchPositions(void 0,this.extend(i,t));return this.safeValue(s,0)}async fetchPositions(e,t={}){await this.loadMarkets();const i=await this.contractPrivateGetPositionOpenPositions(t),s=this.safeValue(i,"data",[]);return this.parsePositions(s,e)}parsePosition(e,t){const i=(t=this.safeMarket(this.safeString(e,"symbol"),t)).symbol,s=this.safeString(e,"holdVol"),r=this.safeNumber(e,"openAvgPrice"),a=this.safeString(e,"im"),n="1"===this.safeString(e,"positionType")?"long":"short",o="1"===this.safeString(e,"margin_mode")?"isolated":"cross",h=this.safeNumber(e,"leverage"),d=this.safeNumber(e,"liquidatePrice"),c=this.safeNumber(e,"updateTime");return{info:e,id:void 0,symbol:i,contracts:this.parseNumber(s),contractSize:void 0,entryPrice:r,collateral:void 0,side:n,unrealizedProfit:void 0,leverage:this.parseNumber(h),percentage:void 0,marginType:o,notional:void 0,markPrice:void 0,liquidationPrice:d,initialMargin:this.parseNumber(a),initialMarginPercentage:void 0,maintenanceMargin:void 0,maintenanceMarginPercentage:void 0,marginRatio:void 0,timestamp:c,datetime:this.iso8601(c)}}async fetchTransfer(e,t,i,s={}){const[a,n]=this.handleMarketTypeAndParams("fetchTransfer",void 0,s);if(await this.loadMarkets(),"spot"===a){const t={transact_id:e},i=await this.spot2PrivateGetAssetInternalTransferInfo(this.extend(t,n)),s=this.safeValue(i,"data",{});return this.parseTransfer(s)}if("swap"===a)throw new r(this.id+" fetchTransfer() is not supported for "+a)}async fetchTransfers(e,t,i,s={}){const[r,a]=this.handleMarketTypeAndParams("fetchTransfers",void 0,s);await this.loadMarkets();const n={};let o,h;if(void 0!==e&&(o=this.currency(e),n.currency=o.id),"spot"===r){if(void 0!==t&&(n.start_time=t),void 0!==i){if(i>50)throw new d("This exchange supports a maximum limit of 50");n["page-size"]=i}const e=await this.spot2PrivateGetAssetInternalTransferRecord(this.extend(n,a)),s=this.safeValue(e,"data",{});h=this.safeValue(s,"result_list",[])}else if("swap"===r){void 0!==i&&(n.page_size=i);const e=await this.contractPrivateGetAccountTransferRecord(this.extend(n,a)),t=this.safeValue(e,"data");h=this.safeValue(t,"resultList")}return this.parseTransfers(h,o,t,i)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n={spot:"SPOT",swap:"FUTURES",margin:"ISOLATED_MARGIN"},o=this.safeString(n,i),h=this.safeString(n,s);if(void 0===o){const e=Object.keys(n);throw new d(this.id+" fromAccount must be one of "+e.join(", "))}if(void 0===h){const e=Object.keys(n);throw new d(this.id+" toAccount must be one of "+e.join(", "))}const l={asset:a.id,amount:t,fromAccountType:o,toAccountType:h};if("ISOLATED_MARGIN"===o||"ISOLATED_MARGIN"===h){const e=this.safeString(r,"symbol");if(r=this.omit(r,"symbol"),void 0===e)throw new c(this.id+" transfer() requires a symbol argument for isolated margin");const t=this.market(e);l.symbol=t.id}const u=await this.spotPrivatePostCapitalTransfer(this.extend(l,r)),f=this.parseTransfer(u,a);return this.extend(f,{amount:t,fromAccount:i,toAccount:s})}parseTransfer(e,t){const i=this.safeString(e,"currency"),s=this.safeStringN(e,["transact_id","txid","tranId"]),r=this.safeInteger(e,"createTime"),a=void 0!==r?this.iso8601(r):void 0,n=this.safeString(e,"type");let o,h;return void 0!==n?(o="IN"===n?"MAIN":"CONTRACT",h="IN"===n?"CONTRACT":"MAIN"):(o=this.safeString(e,"from"),h=this.safeString(e,"to")),{info:e,id:s,timestamp:r,datetime:a,currency:this.safeCurrencyCode(i,t),amount:this.safeNumber(e,"amount"),fromAccount:this.parseAccountId(o),toAccount:this.parseAccountId(h),status:this.parseTransferStatus(this.safeString2(e,"transact_state","state"))}}parseAccountId(e){return this.safeString({MAIN:"spot",CONTRACT:"swap"},e,e)}parseTransferStatus(e){return this.safeString({SUCCESS:"ok",FAILED:"failed",WAIT:"pending"},e,e)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r);const a=this.safeValue(this.options,"networks",{});let n=this.safeStringUpper2(r,"network","chain");n=this.safeString(a,n,n),this.checkAddress(i),await this.loadMarkets();const o=this.currency(e),h={coin:o.id,address:i,amount:t};void 0!==s&&(h.memo=s),void 0!==n&&(h.network=n,r=this.omit(r,"network"));const d=await this.spotPrivatePostCapitalWithdrawApply(this.extend(h,r));return this.parseTransaction(d,o)}async setPositionMode(e,t,i={}){const s={positionMode:e?1:2};return await this.contractPrivatePostPositionChangePositionMode(this.extend(s,i))}async fetchPositionMode(e,t={}){const i=await this.contractPrivateGetPositionPositionMode(t);return{info:i,hedged:1===this.safeInteger(i,"data")}}async borrowMargin(e,t,i,s={}){if(await this.loadMarkets(),void 0===i)throw new c(this.id+" borrowMargin() requires a symbol argument for isolated margin");const r=this.market(i),a=this.currency(e),n={asset:a.id,amount:this.currencyToPrecision(e,t),symbol:r.id},o=await this.spotPrivatePostMarginLoan(this.extend(n,s)),h=this.parseMarginLoan(o,a);return this.extend(h,{amount:t,symbol:i})}async repayMargin(e,t,i,s={}){if(await this.loadMarkets(),void 0===i)throw new c(this.id+" repayMargin() requires a symbol argument for isolated margin");const r=this.safeString2(s,"id","borrowId");if(void 0===r)throw new c(this.id+" repayMargin() requires a borrowId argument in the params");const a=this.market(i),n=this.currency(e),o={asset:n.id,amount:this.currencyToPrecision(e,t),borrowId:r,symbol:a.id},h=await this.spotPrivatePostMarginRepay(this.extend(o,s)),d=this.parseMarginLoan(h,n);return this.extend(d,{amount:t,symbol:i})}async fetchTransactionFees(e,t={}){await this.loadMarkets();const i=await this.spotPrivateGetCapitalConfigGetall(t);return this.parseTransactionFees(i,e)}parseTransactionFees(e,t){const i={};for(let s=0;s<e.length;s++){const r=e[s],a=this.safeString(r,"coin"),n=this.safeCurrency(a),o=this.safeString(n,"code");(void 0===t||this.inArray(o,t))&&(i[o]=this.parseTransactionFee(r,n))}return{withdraw:i,deposit:{},info:e}}parseTransactionFee(e,t){const i=this.safeValue(e,"networkList",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"network"),a=this.safeString(this.options.networks,r,r),n=this.safeNumber(t,"withdrawFee");s[a]=n}return s}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.spotPrivateGetCapitalConfigGetall(t);return this.parseDepositWithdrawFees(i,e,"coin")}parseDepositWithdrawFee(e,t){const i=this.safeValue(e,"networkList",[]),s=this.depositWithdrawFee(e);for(let e=0;e<i.length;e++){const r=i[e],a=this.safeString(r,"network"),n=this.networkIdToCode(a,this.safeString(t,"code"));s.networks[n]={withdraw:{fee:this.safeNumber(r,"withdrawFee"),percentage:void 0},deposit:{fee:void 0,percentage:void 0}}}return this.assignDefaultDepositWithdrawFees(s)}parseMarginLoan(e,t){return{id:this.safeString(e,"tranId"),currency:this.safeCurrencyCode(void 0,t),amount:void 0,symbol:void 0,timestamp:void 0,datetime:void 0,info:e}}handleMarginModeAndParams(e,t={},i){const s=this.safeString(this.options,"defaultType"),r=this.safeValue(t,"margin",!1);let a;return[a,t]=super.handleMarginModeAndParams(e,t,i),"margin"!==s&&!0!==r||(a="isolated"),[a,t]}sign(e,t="public",i="GET",s={},r,a){const[n,o]=t;let h;if([e,s]=this.resolvePath(e,s),"spot"===n){h=this.urls.api[n][o]+"/api/"+this.version+"/"+e;let t="";if("private"===o&&(s.timestamp=this.milliseconds(),s.recvWindow=this.safeInteger(this.options,"recvWindow",5e3)),Object.keys(s).length&&(t=this.urlencode(s),h+="?"+t),"private"===o){this.checkRequiredCredentials();h+="&signature="+this.hmac(this.encode(t),this.encode(this.secret),"sha256"),r={"X-MEXC-APIKEY":this.apiKey,source:this.safeString(this.options,"broker","CCXT")}}"POST"===i&&(r["Content-Type"]="application/json")}else if("contract"===n||"spot2"===n)if(h=this.urls.api[n][o]+"/"+this.implodeParams(e,s),s=this.omit(s,this.extractParams(e)),"public"===o)Object.keys(s).length&&(h+="?"+this.urlencode(s));else{this.checkRequiredCredentials();const e=this.milliseconds().toString();let t="";r={ApiKey:this.apiKey,"Request-Time":e,"Content-Type":"application/json",source:this.safeString(this.options,"broker","CCXT")},"POST"===i?(t=this.json(s),a=t):(s=this.keysort(s),Object.keys(s).length&&(t+=this.urlencode(s),h+="?"+t)),t=this.apiKey+e+t;const n=this.hmac(this.encode(t),this.encode(this.secret),"sha256");r.Signature=n}return{url:h,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,n,o,h){if(void 0===n)return;if(!0===this.safeValue(n,"success",!1))return;const c=this.safeString(n,"code",void 0);if(void 0!==c&&"200"!==c&&"0"!==c){const e=this.id+" "+a;throw this.throwBroadlyMatchedException(this.exceptions.broad,a,e),this.throwExactlyMatchedException(this.exceptions.exact,c,e),new d(e)}}}},61985:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,AuthenticationError:a,InsufficientFunds:n,BadSymbol:o,OrderNotFound:h}=i(73449),{TICK_SIZE:d}=i(62115),c=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"ndax",name:"NDAX",countries:["CA"],rateLimit:1e3,pro:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelAllOrders:!0,cancelOrder:!0,createDepositAddress:!0,createOrder:!0,createReduceOnlyOrder:!1,editOrder:!0,fetchAccounts:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLedger:!0,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchOrderTrades:!0,fetchPosition:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!1,fetchTime:!1,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,signIn:!0,transfer:!1,withdraw:!0},timeframes:{"1m":"60","5m":"300","15m":"900","30m":"1800","1h":"3600","2h":"7200","4h":"14400","6h":"21600","12h":"43200","1d":"86400","1w":"604800","1M":"2419200","4M":"9676800"},urls:{logo:"https://user-images.githubusercontent.com/1294454/108623144-67a3ef00-744e-11eb-8140-75c6b851e945.jpg",test:{public:"https://ndaxmarginstaging.cdnhop.net:8443/AP",private:"https://ndaxmarginstaging.cdnhop.net:8443/AP"},api:{public:"https://api.ndax.io:8443/AP",private:"https://api.ndax.io:8443/AP"},www:"https://ndax.io",doc:["https://apidoc.ndax.io/"],fees:"https://ndax.io/fees",referral:"https://one.ndax.io/bfQiSL"},api:{public:{get:{Activate2FA:1,Authenticate2FA:1,AuthenticateUser:1,GetL2Snapshot:1,GetLevel1:1,GetValidate2FARequiredEndpoints:1,LogOut:1,GetTickerHistory:1,GetProduct:1,GetProducts:1,GetInstrument:1,GetInstruments:1,Ping:1,trades:1,GetLastTrades:1,SubscribeLevel1:1,SubscribeLevel2:1,SubscribeTicker:1,SubscribeTrades:1,SubscribeBlockTrades:1,UnsubscribeBlockTrades:1,UnsubscribeLevel1:1,UnsubscribeLevel2:1,UnsubscribeTicker:1,UnsubscribeTrades:1,Authenticate:1}},private:{get:{GetUserAccountInfos:1,GetUserAccounts:1,GetUserAffiliateCount:1,GetUserAffiliateTag:1,GetUserConfig:1,GetAllUnredactedUserConfigsForUser:1,GetUnredactedUserConfigByKey:1,GetUserDevices:1,GetUserReportTickets:1,GetUserReportWriterResultRecords:1,GetAccountInfo:1,GetAccountPositions:1,GetAllAccountConfigs:1,GetTreasuryProductsForAccount:1,GetAccountTrades:1,GetAccountTransactions:1,GetOpenTradeReports:1,GetAllOpenTradeReports:1,GetTradesHistory:1,GetOpenOrders:1,GetOpenQuotes:1,GetOrderFee:1,GetOrderHistory:1,GetOrdersHistory:1,GetOrderStatus:1,GetOmsFeeTiers:1,GetAccountDepositTransactions:1,GetAccountWithdrawTransactions:1,GetAllDepositRequestInfoTemplates:1,GetDepositInfo:1,GetDepositRequestInfoTemplate:1,GetDeposits:1,GetDepositTicket:1,GetDepositTickets:1,GetOMSWithdrawFees:1,GetWithdrawFee:1,GetWithdraws:1,GetWithdrawTemplate:1,GetWithdrawTemplateTypes:1,GetWithdrawTicket:1,GetWithdrawTickets:1},post:{AddUserAffiliateTag:1,CancelUserReport:1,RegisterNewDevice:1,SubscribeAccountEvents:1,UpdateUserAffiliateTag:1,GenerateTradeActivityReport:1,GenerateTransactionActivityReport:1,GenerateTreasuryActivityReport:1,ScheduleTradeActivityReport:1,ScheduleTransactionActivityReport:1,ScheduleTreasuryActivityReport:1,CancelAllOrders:1,CancelOrder:1,CancelQuote:1,CancelReplaceOrder:1,CreateQuote:1,ModifyOrder:1,SendOrder:1,SubmitBlockTrade:1,UpdateQuote:1,CancelWithdraw:1,CreateDepositTicket:1,CreateWithdrawTicket:1,SubmitDepositTicketComment:1,SubmitWithdrawTicketComment:1,GetOrderHistoryByOrderId:1}}},fees:{trading:{tierBased:!1,percentage:!0,maker:this.parseNumber("0.002"),taker:this.parseNumber("0.0025")}},requiredCredentials:{apiKey:!0,secret:!0,uid:!0,login:!0,password:!0},precisionMode:d,exceptions:{exact:{Not_Enough_Funds:n,"Server Error":r,"Resource Not Found":h},broad:{"Invalid InstrumentId":o,"This endpoint requires 2FACode along with the payload":a}},options:{omsId:1,orderTypes:{Market:1,Limit:2,StopMarket:3,StopLimit:4,TrailingStopMarket:5,TrailingStopLimit:6,BlockTrade:7}}})}async signIn(e={}){if(this.checkRequiredCredentials(),void 0===this.login||void 0===this.password)throw new a(this.id+" signIn() requires exchange.login, exchange.password");let t={grant_type:"client_credentials"};const i=await this.publicGetAuthenticate(this.extend(t,e));let s=this.safeString(i,"SessionToken");if(void 0!==s)return this.options.sessionToken=s,i;const r=this.safeString(i,"Pending2FaToken");if(void 0!==r){if(void 0===this.twofa)throw new a(this.id+" signIn() requires exchange.twofa credentials");this.options.pending2faToken=r,t={Code:this.oath()};const i=await this.publicGetAuthenticate2FA(this.extend(t,e));return s=this.safeString(i,"SessionToken"),this.options.sessionToken=s,i}return i}async fetchCurrencies(e={}){const t={omsId:this.safeInteger(this.options,"omsId",1)},i=await this.publicGetGetProducts(this.extend(t,e)),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"ProductId"),a=this.safeString(t,"ProductFullName"),n=this.safeString(t,"ProductType"),o=this.safeCurrencyCode(this.safeString(t,"Product")),h=!this.safeValue(t,"IsDisabled");s[o]={id:r,name:a,code:o,type:n,precision:this.safeNumber(t,"TickSize"),info:t,active:h,deposit:void 0,withdraw:void 0,fee:void 0,limits:{amount:{min:void 0,max:void 0},withdraw:{min:void 0,max:void 0}}}}return s}async fetchMarkets(e={}){const t={omsId:this.safeInteger(this.options,"omsId",1)},i=await this.publicGetGetInstruments(this.extend(t,e)),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"InstrumentId"),a=this.safeString(t,"Product1"),n=this.safeString(t,"Product2"),o=this.safeCurrencyCode(this.safeString(t,"Product1Symbol")),h=this.safeCurrencyCode(this.safeString(t,"Product2Symbol")),d=this.safeString(t,"SessionStatus"),c=this.safeValue(t,"IsDisable"),l="Running"===d;s.push({id:r,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:l&&!c,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(t,"QuantityIncrement"),price:this.safeNumber(t,"PriceIncrement")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"MinimumQuantity"),max:void 0},price:{min:this.safeNumber(t,"MinimumPrice"),max:void 0},cost:{min:void 0,max:void 0}},info:t})}return s}parseOrderBook(e,t,i,s="bids",r="asks",a=6,n=8){let o;const h={symbol:t,bids:[],asks:[],timestamp:void 0,datetime:void 0,nonce:void 0};for(let t=0;t<e.length;t++){const d=e[t];if(void 0===i)i=this.safeInteger(d,2);else{const e=this.safeInteger(d,2);i=Math.max(i,e)}if(void 0===o)o=this.safeInteger(d,0);else{const e=this.safeInteger(d,0);o=Math.max(o,e)}const c=this.parseBidAsk(d,a,n);h[this.safeInteger(d,9)?r:s].push(c)}return h.bids=this.sortBy(h.bids,0,!0),h.asks=this.sortBy(h.asks,0),h.timestamp=i,h.datetime=this.iso8601(i),h.nonce=o,h}async fetchOrderBook(e,t,i={}){const s=this.safeInteger(this.options,"omsId",1);await this.loadMarkets();t=void 0===t?100:t;const r={omsId:s,InstrumentId:this.market(e).id,Depth:t},a=await this.publicGetGetL2Snapshot(this.extend(r,i));return this.parseOrderBook(a,e)}parseTicker(e,t){const i=this.safeInteger(e,"TimeStamp"),s=this.safeString(e,"InstrumentId");t=this.safeMarket(s,t);const r=this.safeSymbol(s,t),a=this.safeString(e,"LastTradedPx"),n=this.safeString(e,"Rolling24HrPxChangePercent"),o=this.safeString(e,"Rolling24HrPxChange"),h=this.safeString(e,"SessionOpen"),d=this.safeString(e,"Rolling24HrVolume"),c=this.safeString(e,"Rolling24HrNotional");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"SessionHigh"),low:this.safeString(e,"SessionLow"),bid:this.safeString(e,"BestBid"),bidVolume:void 0,ask:this.safeString(e,"BestOffer"),askVolume:void 0,vwap:void 0,open:h,close:a,last:a,previousClose:void 0,change:o,percentage:n,average:void 0,baseVolume:d,quoteVolume:c,info:e},t)}async fetchTicker(e,t={}){const i=this.safeInteger(this.options,"omsId",1);await this.loadMarkets();const s=this.market(e),r={omsId:i,InstrumentId:s.id},a=await this.publicGetGetLevel1(this.extend(r,t));return this.parseTicker(a,s)}parseOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,3),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){const a=this.safeInteger(this.options,"omsId",1);await this.loadMarkets();const n=this.market(e),o={omsId:a,InstrumentId:n.id,Interval:this.safeString(this.timeframes,t,t)},h=this.parseTimeframe(t),d=this.milliseconds();void 0===i?void 0!==s&&(o.FromDate=this.ymdhms(d-h*s*1e3),o.ToDate=this.ymdhms(d)):(o.FromDate=this.ymdhms(i),o.ToDate=void 0===s?this.ymdhms(d):this.ymdhms(this.sum(i,h*s*1e3)));const c=await this.publicGetGetTickerHistory(this.extend(o,r));return this.parseOHLCVs(c,n,t,i,s)}parseTrade(e,t){let i,s,r,a,n,o,h,d,c,l,u;if(Array.isArray(e)){i=this.safeString(e,3),s=this.safeString(e,2),a=this.safeInteger(e,6),n=this.safeString(e,0),o=this.safeString(e,1);h=this.safeValue(e,8)?"sell":"buy",d=this.safeString(e,4)}else{a=this.safeInteger2(e,"TradeTimeMS","ReceiveTime"),n=this.safeString(e,"TradeId"),d=this.safeString2(e,"OrderId","OrigOrderId"),o=this.safeString2(e,"InstrumentId","Instrument"),i=this.safeString(e,"Price"),s=this.safeString(e,"Quantity"),r=this.safeString2(e,"Value","GrossValueExecuted"),c=this.safeStringLower(e,"MakerTaker"),h=this.safeStringLower(e,"Side"),u=this.safeStringLower(e,"OrderType");const t=this.safeString(e,"Fee");if(void 0!==t){const i=this.safeString(e,"FeeProductId");l={cost:t,currency:this.safeCurrencyCode(i)}}}const f=this.safeSymbol(o,t);return this.safeTrade({info:e,id:n,symbol:f,timestamp:a,datetime:this.iso8601(a),order:d,type:u,side:h,takerOrMaker:c,price:i,amount:s,cost:r,fee:l},t)}async fetchTrades(e,t,i,s={}){const r=this.safeInteger(this.options,"omsId",1);await this.loadMarkets();const a=this.market(e),n={omsId:r,InstrumentId:a.id};void 0!==i&&(n.Count=i);const o=await this.publicGetGetLastTrades(this.extend(n,s));return this.parseTrades(o,a,t,i)}async fetchAccounts(e={}){if(!this.login)throw new a(this.id+" fetchAccounts() requires exchange.login email credential");const t=this.safeInteger(this.options,"omsId",1);this.checkRequiredCredentials();const i={omsId:t,UserId:this.uid,UserName:this.login},s=await this.privateGetGetUserAccounts(this.extend(i,e)),r=[];for(let e=0;e<s.length;e++){const t=this.safeString(s,e);r.push({id:t,type:void 0,currency:void 0,info:t})}return r}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"ProductId");if(r in this.currencies_by_id){const e=this.safeCurrencyCode(r),i=this.account();i.total=this.safeString(s,"Amount"),i.used=this.safeString(s,"Hold"),t[e]=i}}return this.safeBalance(t)}async fetchBalance(e={}){const t=this.safeInteger(this.options,"omsId",1);await this.loadMarkets(),await this.loadAccounts();const i=this.safeInteger2(this.options,"accountId","AccountId",parseInt(this.accounts[0].id)),s=this.safeInteger2(e,"accountId","AccountId",i);e=this.omit(e,["accountId","AccountId"]);const r={omsId:t,AccountId:s},a=await this.privateGetGetAccountPositions(this.extend(r,e));return this.parseBalance(a)}parseLedgerEntryType(e){return this.safeString({Trade:"trade",Deposit:"transaction",Withdraw:"transaction",Transfer:"transfer",OrderHold:"trade",WithdrawHold:"transaction",DepositHold:"transaction",MarginHold:"trade",ManualHold:"trade",ManualEntry:"trade",MarginAcquisition:"trade",MarginRelinquish:"trade",MarginQuoteHold:"trade"},e,e)}parseLedgerEntry(e,t){const i=this.safeString(e,"ProductId"),s=this.safeString(e,"CR"),r=this.safeString(e,"DR");let a,n,o;c.stringLt(s,"0")?(a=s,n="in"):c.stringLt(r,"0")&&(a=r,n="out");const h=this.safeString(e,"Balance");"out"===n?o=c.stringAdd(h,a):"in"===n&&(o=c.stringMax("0",c.stringSub(h,a)));const d=this.safeInteger(e,"TimeStamp");return{info:e,id:this.safeString(e,"TransactionId"),direction:n,account:this.safeString(e,"AccountId"),referenceId:this.safeString(e,"ReferenceId"),referenceAccount:this.safeString(e,"Counterparty"),type:this.parseLedgerEntryType(this.safeString(e,"ReferenceType")),currency:this.safeCurrencyCode(i,t),amount:this.parseNumber(a),before:this.parseNumber(o),after:this.parseNumber(h),status:"ok",timestamp:d,datetime:this.iso8601(d),fee:void 0}}async fetchLedger(e,t,i,s={}){const r=this.safeInteger(this.options,"omsId",1);await this.loadMarkets(),await this.loadAccounts();const a=this.safeInteger2(this.options,"accountId","AccountId",parseInt(this.accounts[0].id)),n=this.safeInteger2(s,"accountId","AccountId",a);s=this.omit(s,["accountId","AccountId"]);const o={omsId:r,AccountId:n};void 0!==i&&(o.Depth=i);const h=await this.privateGetGetAccountTransactions(this.extend(o,s));let d;return void 0!==e&&(d=this.currency(e)),this.parseLedger(h,d,t,i)}parseOrderStatus(e){return this.safeString({Accepted:"open",Rejected:"rejected",Working:"open",Canceled:"canceled",Expired:"expired",FullyExecuted:"closed"},e,e)}parseOrder(e,t){const i=this.safeInteger(e,"ReceiveTime"),s=this.safeString(e,"Instrument");return this.safeOrder({id:this.safeString2(e,"ReplacementOrderId","OrderId"),clientOrderId:this.safeString2(e,"ReplacementClOrdId","ClientOrderId"),info:e,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:this.safeInteger(e,"LastUpdatedTime"),status:this.parseOrderStatus(this.safeString(e,"OrderState")),symbol:this.safeSymbol(s,t),type:this.safeStringLower(e,"OrderType"),timeInForce:void 0,postOnly:void 0,side:this.safeStringLower(e,"Side"),price:this.safeString(e,"Price"),stopPrice:this.parseNumber(this.omitZero(this.safeString(e,"StopPrice"))),cost:this.safeString(e,"GrossValueExecuted"),amount:this.safeString(e,"OrigQuantity"),filled:this.safeString(e,"QuantityExecuted"),average:this.safeString(e,"AvgPrice"),remaining:void 0,fee:void 0,trades:void 0},t)}async createOrder(e,t,i,s,r,a={}){const n=this.safeInteger(this.options,"omsId",1);await this.loadMarkets(),await this.loadAccounts();const o=this.safeInteger2(this.options,"accountId","AccountId",parseInt(this.accounts[0].id)),h=this.safeInteger2(a,"accountId","AccountId",o),d=this.safeInteger2(a,"ClientOrderId","clientOrderId");a=this.omit(a,["accountId","AccountId","clientOrderId","ClientOrderId"]);const c=this.market(e),l="buy"===i?0:1,u={InstrumentId:parseInt(c.id),omsId:n,AccountId:h,TimeInForce:1,Side:l,Quantity:parseFloat(this.amountToPrecision(e,s)),OrderType:this.safeInteger(this.options.orderTypes,this.capitalize(t))};void 0!==r&&(u.LimitPrice=parseFloat(this.priceToPrecision(e,r))),void 0!==d&&(u.ClientOrderId=d);const f=await this.privatePostSendOrder(this.extend(u,a));return this.parseOrder(f,c)}async editOrder(e,t,i,s,r,a,n={}){const o=this.safeInteger(this.options,"omsId",1);await this.loadMarkets(),await this.loadAccounts();const h=this.safeInteger2(this.options,"accountId","AccountId",parseInt(this.accounts[0].id)),d=this.safeInteger2(n,"accountId","AccountId",h),c=this.safeInteger2(n,"ClientOrderId","clientOrderId");n=this.omit(n,["accountId","AccountId","clientOrderId","ClientOrderId"]);const l=this.market(t),u="buy"===s?0:1,f={OrderIdToReplace:parseInt(e),InstrumentId:parseInt(l.id),omsId:o,AccountId:d,TimeInForce:1,Side:u,Quantity:parseFloat(this.amountToPrecision(t,r)),OrderType:this.safeInteger(this.options.orderTypes,this.capitalize(i))};void 0!==a&&(f.LimitPrice=parseFloat(this.priceToPrecision(t,a))),void 0!==c&&(f.ClientOrderId=c);const p=await this.privatePostCancelReplaceOrder(this.extend(f,n));return this.parseOrder(p,l)}async fetchMyTrades(e,t,i,s={}){const r=this.safeInteger(this.options,"omsId",1);await this.loadMarkets(),await this.loadAccounts();const a=this.safeInteger2(this.options,"accountId","AccountId",parseInt(this.accounts[0].id)),n=this.safeInteger2(s,"accountId","AccountId",a);s=this.omit(s,["accountId","AccountId"]);const o={omsId:r,AccountId:n};let h;void 0!==e&&(h=this.market(e),o.InstrumentId=h.id),void 0!==t&&(o.StartTimeStamp=parseInt(t/1e3)),void 0!==i&&(o.Depth=i);const d=await this.privateGetGetTradesHistory(this.extend(o,s));return this.parseTrades(d,h,t,i)}async cancelAllOrders(e,t={}){const i=this.safeInteger(this.options,"omsId",1);await this.loadMarkets(),await this.loadAccounts();const s=this.safeInteger2(this.options,"accountId","AccountId",parseInt(this.accounts[0].id)),r=this.safeInteger2(t,"accountId","AccountId",s);t=this.omit(t,["accountId","AccountId"]);const a={omsId:i,AccountId:r};if(void 0!==e){const t=this.market(e);a.IntrumentId=t.id}return await this.privatePostCancelAllOrders(this.extend(a,t))}async cancelOrder(e,t,i={}){const s=this.safeInteger(this.options,"omsId",1);let r;await this.loadMarkets(),await this.loadAccounts(),void 0!==t&&(r=this.market(t));const a={omsId:s},n=this.safeInteger2(i,"clientOrderId","ClOrderId");void 0!==n?a.ClOrderId=n:a.OrderId=parseInt(e),i=this.omit(i,["clientOrderId","ClOrderId"]);const o=await this.privatePostCancelOrder(this.extend(a,i)),h=this.parseOrder(o,r);return this.extend(h,{id:e,clientOrderId:n})}async fetchOpenOrders(e,t,i,s={}){const r=this.safeInteger(this.options,"omsId",1);await this.loadMarkets(),await this.loadAccounts();const a=this.safeInteger2(this.options,"accountId","AccountId",parseInt(this.accounts[0].id)),n=this.safeInteger2(s,"accountId","AccountId",a);let o;s=this.omit(s,["accountId","AccountId"]),void 0!==e&&(o=this.market(e));const h={omsId:r,AccountId:n},d=await this.privateGetGetOpenOrders(this.extend(h,s));return this.parseOrders(d,o,t,i)}async fetchOrders(e,t,i,s={}){const r=this.safeInteger(this.options,"omsId",1);await this.loadMarkets(),await this.loadAccounts();const a=this.safeInteger2(this.options,"accountId","AccountId",parseInt(this.accounts[0].id)),n=this.safeInteger2(s,"accountId","AccountId",a);s=this.omit(s,["accountId","AccountId"]);const o={omsId:r,AccountId:n};let h;void 0!==e&&(h=this.market(e),o.InstrumentId=h.id),void 0!==t&&(o.StartTimeStamp=parseInt(t/1e3)),void 0!==i&&(o.Depth=i);const d=await this.privateGetGetOrdersHistory(this.extend(o,s));return this.parseOrders(d,h,t,i)}async fetchOrder(e,t,i={}){const s=this.safeInteger(this.options,"omsId",1);await this.loadMarkets(),await this.loadAccounts();const r=this.safeInteger2(this.options,"accountId","AccountId",parseInt(this.accounts[0].id)),a=this.safeInteger2(i,"accountId","AccountId",r);let n;i=this.omit(i,["accountId","AccountId"]),void 0!==t&&(n=this.market(t));const o={omsId:s,AccountId:a,OrderId:parseInt(e)},h=await this.privateGetGetOrderStatus(this.extend(o,i));return this.parseOrder(h,n)}async fetchOrderTrades(e,t,i,s,r={}){const a=this.safeInteger(this.options,"omsId",1);let n;await this.loadMarkets(),await this.loadAccounts(),void 0!==t&&(n=this.market(t));const o={OMSId:parseInt(a),OrderId:parseInt(e)},h=await this.privatePostGetOrderHistoryByOrderId(this.extend(o,r)),d=this.groupBy(h,"ChangeReason"),c=this.safeValue(d,"Trade",[]);return this.parseTrades(c,n,i,s)}async fetchDepositAddress(e,t={}){const i=this.safeInteger(this.options,"omsId",1);await this.loadMarkets(),await this.loadAccounts();const s=this.safeInteger2(this.options,"accountId","AccountId",parseInt(this.accounts[0].id)),r=this.safeInteger2(t,"accountId","AccountId",s);t=this.omit(t,["accountId","AccountId"]);const a=this.currency(e),n={omsId:i,AccountId:r,ProductId:a.id,GenerateNewKey:!1},o=await this.privateGetGetDepositInfo(this.extend(n,t));return this.parseDepositAddress(o,a)}parseDepositAddress(e,t){const i=this.safeString(e,"DepositInfo"),s=JSON.parse(i),r=s.length,a=this.safeString(s,r-1).split("?memo="),n=this.safeString(a,0),o=this.safeString(a,1);let h;return void 0!==t&&(h=t.code),this.checkAddress(n),{currency:h,address:n,tag:o,network:void 0,info:e}}async createDepositAddress(e,t={}){return await this.fetchDepositAddress(e,this.extend({GenerateNewKey:!0},t))}async fetchDeposits(e,t,i,s={}){const r=this.safeInteger(this.options,"omsId",1);await this.loadMarkets(),await this.loadAccounts();const a=this.safeInteger2(this.options,"accountId","AccountId",parseInt(this.accounts[0].id)),n=this.safeInteger2(s,"accountId","AccountId",a);let o;s=this.omit(s,["accountId","AccountId"]),void 0!==e&&(o=this.currency(e));const h={omsId:r,AccountId:n},d=await this.privateGetGetDeposits(this.extend(h,s));return this.parseTransactions(d,o,t,i)}async fetchWithdrawals(e,t,i,s={}){const r=this.safeInteger(this.options,"omsId",1);await this.loadMarkets(),await this.loadAccounts();const a=this.safeInteger2(this.options,"accountId","AccountId",parseInt(this.accounts[0].id)),n=this.safeInteger2(s,"accountId","AccountId",a);let o;s=this.omit(s,["accountId","AccountId"]),void 0!==e&&(o=this.currency(e));const h={omsId:r,AccountId:n},d=await this.privateGetGetWithdraws(this.extend(h,s));return this.parseTransactions(d,o,t,i)}parseTransactionStatusByType(e,t){const i=this.safeValue({deposit:{New:"pending",AdminProcessing:"pending",Accepted:"pending",Rejected:"rejected",SystemProcessing:"pending",FullyProcessed:"ok",Failed:"failed",Pending:"pending",Confirmed:"pending",AmlProcessing:"pending",AmlAccepted:"pending",AmlRejected:"rejected",AmlFailed:"failed",LimitsAccepted:"pending",LimitsRejected:"rejected"},withdrawal:{New:"pending",AdminProcessing:"pending",Accepted:"pending",Rejected:"rejected",SystemProcessing:"pending",FullyProcessed:"ok",Failed:"failed",Pending:"pending",Pending2Fa:"pending",AutoAccepted:"pending",Delayed:"pending",UserCanceled:"canceled",AdminCanceled:"canceled",AmlProcessing:"pending",AmlAccepted:"pending",AmlRejected:"rejected",AmlFailed:"failed",LimitsAccepted:"pending",LimitsRejected:"rejected",Submitted:"pending",Confirmed:"pending",ManuallyConfirmed:"pending",Confirmed2Fa:"pending"}},t,{});return this.safeString(i,e,e)}parseTransaction(e,t){let i,s;const r=this.safeString(e,"ProductId"),a=this.safeCurrencyCode(r,t);let n,o;"DepositId"in e?(i=this.safeString(e,"DepositId"),o="deposit"):"WithdrawId"in e&&(i=this.safeString(e,"WithdrawId"),o="withdrawal");const h=this.safeString(e,"TemplateForm");let d,c=this.safeInteger(e,"LastUpdateTimeStamp");if(void 0!==h){const e=JSON.parse(h);d=this.safeString(e,"ExternalAddress"),s=this.safeString(e,"TxId"),n=this.safeInteger(e,"TimeSubmitted"),c=this.safeInteger(e,"LastUpdated",c)}const l=d,u=this.parseTransactionStatusByType(this.safeString(e,"TicketStatus"),o),f=this.safeNumber(e,"Amount"),p=this.safeNumber(e,"FeeAmount");let m;return void 0!==p&&(m={currency:a,cost:p}),{info:e,id:i,txid:s,timestamp:n,datetime:this.iso8601(n),address:d,addressTo:l,addressFrom:void 0,tag:void 0,tagTo:void 0,tagFrom:void 0,type:o,amount:f,currency:a,status:u,updated:c,fee:m}}async withdraw(e,t,i,s,n={}){[s,n]=this.handleWithdrawTagAndParams(s,n);if(void 0===this.safeString(this.options,"sessionToken"))throw new a(this.id+" call signIn() method to obtain a session token");if(void 0===this.twofa)throw new a(this.id+" withdraw() requires exchange.twofa credentials");this.checkAddress(i);const o=this.safeInteger(this.options,"omsId",1);await this.loadMarkets(),await this.loadAccounts();const h=this.safeInteger2(this.options,"accountId","AccountId",parseInt(this.accounts[0].id)),d=this.safeInteger2(n,"accountId","AccountId",h);n=this.omit(n,["accountId","AccountId"]);const c=this.currency(e),l={omsId:o,AccountId:d,ProductId:c.id},u=await this.privateGetGetWithdrawTemplateTypes(l),f=this.safeValue(u,"TemplateTypes",[]),p=this.safeValue(f,0);if(void 0===p)throw new r(this.id+" withdraw() could not find a withdraw template type for "+c.code);const m=this.safeString(p,"TemplateName"),g={omsId:o,AccountId:d,ProductId:c.id,TemplateType:m,AccountProviderId:p.AccountProviderId},y=await this.privateGetGetWithdrawTemplate(g),b=this.safeString(y,"Template");if(void 0===b)throw new r(this.id+" withdraw() could not find a withdraw template for "+c.code);const v=JSON.parse(b);v.ExternalAddress=i,void 0!==s&&"Memo"in v&&(v.Memo=s);const w={omsId:o,AccountId:d,ProductId:c.id,TemplateForm:this.json(v),TemplateType:m},S={TfaType:"Google",TFaCode:this.oath(),Payload:this.json(w)},k=await this.privatePostCreateWithdrawTicket(this.deepExtend(S,n));return this.parseTransaction(k,c)}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t]+"/"+this.implodeParams(e,s),o=this.omit(s,this.extractParams(e));if("public"===t){if("Authenticate"===e){const e=this.login+":"+this.password,t=this.stringToBase64(e);r={Authorization:"Basic "+this.decode(t)}}else if("Authenticate2FA"===e){const e=this.safeString(this.options,"pending2faToken");void 0!==e&&(r={Pending2FaToken:e},o=this.omit(o,"pending2faToken"))}Object.keys(o).length&&(n+="?"+this.urlencode(o))}else if("private"===t){this.checkRequiredCredentials();const e=this.safeString(this.options,"sessionToken");if(void 0===e){const e=this.nonce().toString(),t=e+this.uid+this.apiKey,i=this.hmac(this.encode(t),this.encode(this.secret));r={Nonce:e,APIKey:this.apiKey,Signature:i,UserId:this.uid}}else r={APToken:e};"POST"===i?(r["Content-Type"]="application/json",a=this.json(o)):Object.keys(o).length&&(n+="?"+this.urlencode(o))}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,n,o,h,d,c){if(404===e)throw new a(this.id+" "+o);if(void 0===h)return;const l=this.safeString(h,"errormsg");if(void 0!==l&&""!==l){const e=this.id+" "+o;throw this.throwExactlyMatchedException(this.exceptions.exact,l,e),this.throwBroadlyMatchedException(this.exceptions.broad,o,e),new r(e)}}}},11541:function(e,t,i){"use strict";const s=i(48819),{AuthenticationError:r,ExchangeError:a,PermissionDenied:n,BadRequest:o,CancelPending:h,OrderNotFound:d,InsufficientFunds:c,RateLimitExceeded:l,InvalidOrder:u,AccountSuspended:f,BadSymbol:p,OnMaintenance:m,ArgumentsRequired:g,AccountNotEnabled:y}=i(73449),{TICK_SIZE:b}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"novadax",name:"NovaDAX",countries:["BR"],rateLimit:16.6667,version:"v1",has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchAccounts:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchOrderTrades:!0,fetchPosition:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransactions:!0,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!0,withdraw:!0},timeframes:{"1m":"ONE_MIN","5m":"FIVE_MIN","15m":"FIFTEEN_MIN","30m":"HALF_HOU","1h":"ONE_HOU","1d":"ONE_DAY","1w":"ONE_WEE","1M":"ONE_MON"},urls:{logo:"https://user-images.githubusercontent.com/1294454/92337550-2b085500-f0b3-11ea-98e7-5794fb07dd3b.jpg",api:{public:"https://api.novadax.com",private:"https://api.novadax.com"},www:"https://www.novadax.com.br",doc:["https://doc.novadax.com/pt-BR/"],fees:"https://www.novadax.com.br/fees-and-limits",referral:"https://www.novadax.com.br/?s=ccxt"},api:{public:{get:{"common/symbol":1.2,"common/symbols":1.2,"common/timestamp":1.2,"market/tickers":1.2,"market/ticker":1.2,"market/depth":1.2,"market/trades":1.2,"market/kline/history":1.2}},private:{get:{"orders/get":3,"orders/list":3,"orders/fill":3,"orders/fills":3,"account/getBalance":3,"account/subs":3,"account/subs/balance":3,"account/subs/transfer/record":3,"wallet/query/deposit-withdraw":3},post:{"orders/create":3,"orders/cancel":3,"account/withdraw/coin":3,"account/subs/transfer":3}}},fees:{trading:{tierBased:!1,percentage:!0,taker:this.parseNumber("0.005"),maker:this.parseNumber("0.0025")}},requiredCredentials:{apiKey:!0,secret:!0},precisionMode:b,exceptions:{exact:{A99999:a,A10001:o,A10002:a,A10003:r,A10004:l,A10005:n,A10006:f,A10007:y,A10011:p,A10012:p,A10013:m,A30001:d,A30002:u,A30003:u,A30004:u,A30005:u,A30006:u,A30007:c,A30008:u,A30009:u,A30010:h,A30011:u,A30012:u,A40004:c},broad:{}},options:{fetchOHLCV:{volume:"amount"},transfer:{fillResponseFromRequest:!0}}})}async fetchTime(e={}){const t=await this.publicGetCommonTimestamp(e);return this.safeInteger(t,"data")}async fetchMarkets(e={}){const t=await this.publicGetCommonSymbols(e),i=[],s=this.safeValue(t,"data",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"baseCurrency"),a=this.safeString(t,"quoteCurrency"),n=this.safeString(t,"symbol"),o=this.safeCurrencyCode(r),h=this.safeCurrencyCode(a),d=this.safeString(t,"status");i.push({id:n,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:r,quoteId:a,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:"ONLINE"===d,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"amountPrecision"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"pricePrecision"))),cost:this.parseNumber(this.parsePrecision(this.safeString(t,"valuePrecision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"minOrderAmount"),max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"minOrderValue"),max:void 0}},info:t})}return i}parseTicker(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeString(e,"symbol"),r=this.safeSymbol(s,t,"_"),a=this.safeString(e,"open24h"),n=this.safeString(e,"lastPrice"),o=this.safeString(e,"baseVolume24h"),h=this.safeString(e,"quoteVolume24h");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high24h"),low:this.safeString(e,"low24h"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:a,close:n,last:n,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:o,quoteVolume:h,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetMarketTicker(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseTicker(a,i)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetMarketTickers(t),s=this.safeValue(i,"data",[]),r={};for(let e=0;e<s.length;e++){const t=this.parseTicker(s[e]);r[t.symbol]=t}return this.filterByArray(r,"symbol",e)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};void 0!==t&&(r.limit=t);const a=await this.publicGetMarketDepth(this.extend(r,i)),n=this.safeValue(a,"data",{}),o=this.safeInteger(n,"timestamp");return this.parseOrderBook(n,s.symbol,o,"bids","asks")}parseTrade(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"orderId"),r=this.safeInteger(e,"timestamp"),a=this.safeStringLower(e,"side"),n=this.safeString(e,"price"),o=this.safeString(e,"amount"),h=this.safeString(e,"symbol"),d=this.safeSymbol(h,t,"_"),c=this.safeStringLower(e,"role");let l;if(void 0!==this.safeString(e,"fee")){const t=this.safeString(e,"feeCurrency"),i=this.safeCurrencyCode(t);l={cost:this.safeString(e,"feeAmount"),currency:i}}return this.safeTrade({id:i,order:s,timestamp:r,datetime:this.iso8601(r),symbol:d,type:void 0,side:a,price:n,amount:o,cost:void 0,takerOrMaker:c,fee:l,info:e},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.limit=i);const n=await this.publicGetMarketTrades(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,unit:this.safeString(this.timeframes,t,t)},o=this.parseTimeframe(t),h=this.seconds();if(void 0===s&&(s=3e3),void 0===i)n.from=h-s*o,n.to=h;else{const e=parseInt(i/1e3);n.from=e,n.to=this.sum(e,s*o)}const d=await this.publicGetMarketKlineHistory(this.extend(n,r)),c=this.safeValue(d,"data",[]);return this.parseOHLCVs(c,a,t,i,s)}parseOHLCV(e,t){const i=this.safeValue(this.options,"fetchOHLCV",{}),s=this.safeString(i,"volume","amount");return[this.safeTimestamp(e,"score"),this.safeNumber(e,"openPrice"),this.safeNumber(e,"highPrice"),this.safeNumber(e,"lowPrice"),this.safeNumber(e,"closePrice"),this.safeNumber(e,s)]}parseBalance(e){const t=this.safeValue(e,"data",[]),i={info:e,timestamp:void 0,datetime:void 0};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(s,"balance"),n.free=this.safeString(s,"available"),n.used=this.safeString(s,"hold"),i[a]=n}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetAccountGetBalance(e);return this.parseBalance(t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);let o=t.toUpperCase();const h=i.toUpperCase(),d={symbol:n.id,side:h},c=this.safeValue2(a,"triggerPrice","stopPrice");if(void 0===c){if("STOP_LIMIT"===o||"STOP_MARKET"===o)throw new g(this.id+" createOrder() requires a stopPrice parameter for "+o+" orders")}else{"LIMIT"===o?o="STOP_LIMIT":"MARKET"===o&&(o="STOP_MARKET");const t="BUY"===h?"LTE":"GTE";d.operator=this.safeString(a,"operator",t),d.stopPrice=this.priceToPrecision(e,c),a=this.omit(a,["triggerPrice","stopPrice"])}if("LIMIT"===o||"STOP_LIMIT"===o)d.price=this.priceToPrecision(e,r),d.amount=this.amountToPrecision(e,s);else if("MARKET"===o||"STOP_MARKET"===o)if("SELL"===h)d.amount=this.amountToPrecision(e,s);else if("BUY"===h){let t=this.safeNumber(a,"value");if(this.safeValue(this.options,"createMarketBuyOrderRequiresPrice",!0)){if(void 0!==r)void 0===t&&(t=s*r);else if(void 0===t)throw new u(this.id+" createOrder() requires the price argument with market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount, or, alternatively, add .options['createMarketBuyOrderRequiresPrice'] = false and supply the total cost value in the 'amount' argument or in the 'value' extra parameter (the exchange-specific behaviour)")}else t=void 0===t?s:t;d.value=this.costToPrecision(e,t)}d.type=o;const l=await this.privatePostOrdersCreate(this.extend(d,a)),f=this.safeValue(l,"data",{});return this.parseOrder(f,n)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privatePostOrdersCancel(this.extend(s,i)),a=this.safeValue(r,"data",{});return this.parseOrder(a)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.privateGetOrdersGet(this.extend(s,i)),a=this.safeValue(r,"data",{});return this.parseOrder(a)}async fetchOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.symbol=a.id),void 0!==i&&(r.limit=i),void 0!==t&&(r.fromTimestamp=t);const n=await this.privateGetOrdersList(this.extend(r,s)),o=this.safeValue(n,"data",[]);return this.parseOrders(o,a,t,i)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({status:"SUBMITTED,PROCESSING,PARTIAL_FILLED,CANCELING"},s))}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({status:"FILLED,CANCELED,REJECTED"},s))}async fetchOrderTrades(e,t,i,s,r={}){await this.loadMarkets();const a={id:e},n=await this.privateGetOrdersFill(this.extend(a,r));let o;void 0!==t&&(o=this.market(t));const h=this.safeValue(n,"data",[]);return this.parseTrades(h,o,i,s)}parseOrderStatus(e){return this.safeString({SUBMITTED:"open",PROCESSING:"open",PARTIAL_FILLED:"open",CANCELING:"open",FILLED:"closed",CANCELED:"canceled",REJECTED:"rejected"},e,e)}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"amount"),r=this.safeString(e,"price"),a=this.safeString2(e,"filledValue","value"),n=this.safeStringLower(e,"type"),o=this.safeStringLower(e,"side"),h=this.parseOrderStatus(this.safeString(e,"status")),d=this.safeInteger(e,"timestamp"),c=this.safeString(e,"averagePrice"),l=this.safeString(e,"filledAmount");let u;const f=this.safeNumber(e,"filledFee");void 0!==f&&(u={cost:f,currency:void 0});const p=this.safeString(e,"symbol"),m=this.safeSymbol(p,t,"_"),g=this.safeNumber(e,"stopPrice");return this.safeOrder({id:i,clientOrderId:void 0,info:e,timestamp:d,datetime:this.iso8601(d),lastTradeTimestamp:void 0,symbol:m,type:n,timeInForce:void 0,postOnly:void 0,side:o,price:r,stopPrice:g,triggerPrice:g,amount:s,cost:a,average:c,filled:l,remaining:void 0,status:h,fee:u,trades:void 0},t)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const n=this.currency(e);if("main"!==i&&"main"!==s)throw new a(this.id+" transfer() supports transfers between main account and subaccounts only");const o="main"===i?"master-transfer-in":"master-transfer-out",h={transferAmount:this.currencyToPrecision(e,t),currency:n.id,subId:"master-transfer-in"===o?s:i,transferType:o},d=await this.privatePostAccountSubsTransfer(this.extend(h,r)),c=this.parseTransfer(d,n),l=this.safeValue(this.options,"transfer",{});return this.safeValue(l,"fillResponseFromRequest",!0)&&(c.fromAccount=i,c.toAccount=s,c.amount=t),c}parseTransfer(e,t){const i=this.safeString(e,"data"),s=this.safeString(e,"message"),r=this.safeCurrencyCode(void 0,t);return{info:e,id:i,amount:void 0,code:r,currency:r,fromAccount:void 0,toAccount:void 0,timestamp:void 0,datetime:void 0,status:s}}parseTransferStatus(e){return this.safeString({SUCCESS:"pending"},e,"failed")}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets();const a=this.currency(e),n={code:a.id,amount:this.currencyToPrecision(e,t),wallet:i};void 0!==s&&(n.tag=s);const o=await this.privatePostAccountWithdrawCoin(this.extend(n,r));return this.parseTransaction(o,a)}async fetchAccounts(e={}){const t=await this.privateGetAccountSubs(e),i=this.safeValue(t,"data",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"subId"),a=this.safeString(t,"subAccount");s.push({id:r,type:a,currency:void 0,info:t})}return s}async fetchDeposits(e,t,i,s={}){return await this.fetchTransactions(e,t,i,this.extend({type:"coin_in"},s))}async fetchWithdrawals(e,t,i,s={}){return await this.fetchTransactions(e,t,i,this.extend({type:"coin_out"},s))}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==i&&(r.size=i);const n=await this.privateGetWalletQueryDepositWithdraw(this.extend(r,s)),o=this.safeValue(n,"data",[]);return this.parseTransactions(o,a,t,i)}parseTransactionStatus(e){const t=e.split(" ");e=this.safeString(t,1,e);return this.safeString({Pending:"pending",confirming:"pending",SUCCESS:"ok",FAIL:"failed"},e,e)}parseTransaction(e,t){const i=this.safeString2(e,"id","data");let s=this.safeString(e,"type");"COIN_IN"===s?s="deposit":"COIN_OUT"===s&&(s="withdraw");const r=this.safeNumber(e,"amount"),a=this.safeString(e,"address"),n=this.safeString(e,"addressTag"),o=this.safeString(e,"txHash"),h=this.safeInteger(e,"createdAt"),d=this.safeInteger(e,"updatedAt"),c=this.safeString(e,"currency"),l=this.safeCurrencyCode(c,t),u=this.parseTransactionStatus(this.safeString(e,"state"));return{info:e,id:i,currency:l,amount:r,network:this.safeString(e,"chain"),address:a,addressTo:a,addressFrom:void 0,tag:n,tagTo:n,tagFrom:void 0,status:u,type:s,updated:d,txid:o,timestamp:h,datetime:this.iso8601(h),fee:void 0}}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.symbol=a.id),void 0!==i&&(r.limit=i),void 0!==t&&(r.fromTimestamp=t);const n=await this.privateGetOrdersFills(this.extend(r,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,a,t,i)}sign(e,t="public",i="GET",s={},r,a){const n="/"+this.version+"/"+this.implodeParams(e,s);let o=this.urls.api[t]+n;const h=this.omit(s,this.extractParams(e));if("public"===t)Object.keys(h).length&&(o+="?"+this.urlencode(h));else if("private"===t){this.checkRequiredCredentials();const e=this.milliseconds().toString();let t;r={"X-Nova-Access-Key":this.apiKey,"X-Nova-Timestamp":e},"POST"===i?(a=this.json(h),t=this.hash(this.encode(a),"md5"),r["Content-Type"]="application/json"):(Object.keys(h).length&&(o+="?"+this.urlencode(h)),t=this.urlencode(this.keysort(h)));const s=i+"\n"+n+"\n"+t+"\n"+e;r["X-Nova-Signature"]=this.hmac(this.encode(s),this.encode(this.secret))}return{url:o,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,n,o,h,d){if(void 0===o)return;const c=this.safeString(o,"code");if("A10000"!==c){const e=this.safeString(o,"message"),t=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,c,t),this.throwBroadlyMatchedException(this.exceptions.broad,e,t),new a(t)}}}},7426:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,AuthenticationError:a,ArgumentsRequired:n,BadRequest:o,InvalidOrder:h,InsufficientFunds:d,OrderNotFound:c,PermissionDenied:l}=i(73449),{TICK_SIZE:u}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"oceanex",name:"OceanEx",countries:["BS"],version:"v1",rateLimit:3e3,urls:{logo:"https://user-images.githubusercontent.com/1294454/58385970-794e2d80-8001-11e9-889c-0567cd79b78e.jpg",api:{rest:"https://api.oceanex.pro"},www:"https://www.oceanex.pro.com",doc:"https://api.oceanex.pro/doc/v1",referral:"https://oceanex.pro/signup?referral=VE24QX"},has:{CORS:void 0,spot:!0,margin:!1,swap:void 0,future:void 0,option:void 0,cancelAllOrders:!0,cancelOrder:!0,cancelOrders:!0,createMarketOrder:!0,createOrder:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchMarkets:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderBooks:!0,fetchOrders:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactionFees:void 0},timeframes:{"1m":"1","5m":"5","15m":"15","30m":"30","1h":"60","2h":"120","4h":"240","6h":"360","12h":"720","1d":"1440","3d":"4320","1w":"10080"},api:{public:{get:["markets","tickers/{pair}","tickers_multi","order_book","order_book/multi","fees/trading","trades","timestamp"],post:["k"]},private:{get:["key","members/me","orders","orders/filter"],post:["orders","orders/multi","order/delete","order/delete/multi","orders/clear"]}},fees:{trading:{tierBased:!1,percentage:!0,maker:this.parseNumber("0.001"),taker:this.parseNumber("0.001")}},commonCurrencies:{PLA:"Plair"},precisionMode:u,exceptions:{codes:{"-1":o,"-2":o,1001:o,1004:n,1006:a,1008:a,1010:a,1011:l,2001:a,2002:h,2004:c,9003:l},exact:{"market does not have a valid value":o,"side does not have a valid value":o,"Account::AccountError: Cannot lock funds":d,"The account does not exist":a}}})}async fetchMarkets(e={}){const t=await this.publicGetMarkets(this.extend({show_details:!0},e)),i=[],s=this.safeValue(t,"data",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeValue(t,"id"),a=this.safeValue(t,"name");let[n,o]=a.split("/");const h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o);n=n.toLowerCase(),o=o.toLowerCase();const c=h+"/"+d;i.push({id:r,symbol:c,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"amount_precision"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"price_precision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"minimum_trading_amount"),max:void 0}},info:t})}return i}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={pair:i.id},r=await this.publicGetTickersPair(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseTicker(a,i)}async fetchTickers(e,t={}){await this.loadMarkets(),void 0===(e=this.marketSymbols(e))&&(e=this.symbols);const i={markets:this.marketIds(e)},s=await this.publicGetTickersMulti(this.extend(i,t)),r=this.safeValue(s,"data",[]),a={};for(let e=0;e<r.length;e++){const t=r[e],i=this.safeString(t,"market"),s=this.safeMarket(i);a[s.symbol]=this.parseTicker(t,s)}return this.filterByArray(a,"symbol",e)}parseTicker(e,t){const i=this.safeValue(e,"ticker",{}),s=this.safeTimestamp(e,"at"),r=this.safeSymbol(void 0,t);return this.safeTicker({symbol:r,timestamp:s,datetime:this.iso8601(s),high:this.safeString(i,"high"),low:this.safeString(i,"low"),bid:this.safeString(i,"buy"),bidVolume:void 0,ask:this.safeString(i,"sell"),askVolume:void 0,vwap:void 0,open:void 0,close:this.safeString(i,"last"),last:this.safeString(i,"last"),previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(i,"volume"),quoteVolume:void 0,info:i},t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={market:this.market(e).id};void 0!==t&&(s.limit=t);const r=await this.publicGetOrderBook(this.extend(s,i)),a=this.safeValue(r,"data",{}),n=this.safeTimestamp(a,"timestamp");return this.parseOrderBook(a,e,n)}async fetchOrderBooks(e,t,i={}){await this.loadMarkets(),void 0===e&&(e=this.symbols);const s={markets:this.marketIds(e)};void 0!==t&&(s.limit=t);const r=await this.publicGetOrderBookMulti(this.extend(s,i)),a=this.safeValue(r,"data",[]),n={};for(let e=0;e<a.length;e++){const t=a[e],i=this.safeString(t,"market"),s=this.safeSymbol(i),r=this.safeTimestamp(t,"timestamp");n[s]=this.parseOrderBook(t,s,r)}return n}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={market:r.id};void 0!==i&&(a.limit=i);const n=await this.publicGetTrades(this.extend(a,s)),o=this.safeValue(n,"data");return this.parseTrades(o,r,t,i)}parseTrade(e,t){let i=this.safeValue(e,"side");"bid"===i?i="buy":"ask"===i&&(i="sell");const s=this.safeValue(e,"market"),r=this.safeSymbol(s,t);let a=this.safeTimestamp(e,"created_on");void 0===a&&(a=this.parse8601(this.safeString(e,"created_at")));const n=this.safeString(e,"price"),o=this.safeString(e,"volume");return this.safeTrade({info:e,timestamp:a,datetime:this.iso8601(a),symbol:r,id:this.safeString(e,"id"),order:void 0,type:"limit",takerOrMaker:void 0,side:i,price:n,amount:o,cost:void 0,fee:void 0},t)}async fetchTime(e={}){const t=await this.publicGetTimestamp(e);return this.safeTimestamp(t,"data")}async fetchTradingFees(e={}){const t=await this.publicGetFeesTrading(e),i=this.safeValue(t,"data",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeValue(t,"ask_fee",{}),a=this.safeValue(t,"bid_fee",{}),n=this.safeString(t,"market"),o=this.safeSymbol(n);s[o]={info:t,symbol:o,maker:this.safeNumber(r,"value"),taker:this.safeNumber(a,"value"),percentage:!0}}return s}async fetchKey(e={}){const t=await this.privateGetKey(e);return this.safeValue(t,"data")}parseBalance(e){const t=this.safeValue(e,"data"),i=this.safeValue(t,"accounts",[]),s={info:e};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeValue(t,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(t,"balance"),n.used=this.safeString(t,"locked"),s[a]=n}return this.safeBalance(s)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetMembersMe(e);return this.parseBalance(t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={market:n.id,side:i,ord_type:t,volume:this.amountToPrecision(e,s)};"limit"===t&&(o.price=this.priceToPrecision(e,r));const h=await this.privatePostOrders(this.extend(o,a)),d=this.safeValue(h,"data");return this.parseOrder(d,n)}async fetchOrder(e,t,i={}){let s,r=e;Array.isArray(e)||(r=[e]),await this.loadMarkets(),void 0!==t&&(s=this.market(t));const a={ids:r},n=await this.privateGetOrders(this.extend(a,i)),o=this.safeValue(n,"data"),h=o.length;if(void 0===o)throw new c(this.id+" could not found matching order");if(Array.isArray(e))return this.parseOrders(o,s);if(0===h)throw new c(this.id+" could not found matching order");return this.parseOrder(o[0],s)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({states:["wait"]},s))}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({states:["done","cancel"]},s))}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new n(this.id+" fetchOrders() requires a `symbol` argument");await this.loadMarkets();const r=this.market(e),a=this.safeValue(s,"states",["wait","done","cancel"]),o=this.omit(s,"states"),h={market:r.id,states:a,need_price:"True"};void 0!==i&&(h.limit=i);const d=await this.privateGetOrdersFilter(this.extend(h,o)),c=this.safeValue(d,"data",[]);let l=[];for(let e=0;e<c.length;e++){const s=this.safeValue(c[e],"orders",[]),a=this.parseOrderStatus(this.safeValue(c[e],"state")),n=this.parseOrders(s,r,t,i,{status:a});l=this.arrayConcat(l,n)}return l}parseOHLCV(e,t){return[this.safeTimestamp(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={market:a.id,period:this.safeString(this.timeframes,t,t)};void 0!==i&&(n.timestamp=i),void 0!==s&&(n.limit=s);const o=await this.publicPostK(this.extend(n,r)),h=this.safeValue(o,"data",[]);return this.parseOHLCVs(h,a,t,i,s)}parseOrder(e,t){const i=this.parseOrderStatus(this.safeValue(e,"state")),s=this.safeString2(e,"market","market_id"),r=this.safeSymbol(s,t);let a=this.safeTimestamp(e,"created_on");void 0===a&&(a=this.parse8601(this.safeString(e,"created_at")));const n=this.safeString(e,"price"),o=this.safeString(e,"avg_price"),h=this.safeString(e,"volume"),d=this.safeString(e,"remaining_volume"),c=this.safeString(e,"executed_volume");return this.safeOrder({info:e,id:this.safeString(e,"id"),clientOrderId:void 0,timestamp:a,datetime:this.iso8601(a),lastTradeTimestamp:void 0,symbol:r,type:this.safeValue(e,"ord_type"),timeInForce:void 0,postOnly:void 0,side:this.safeValue(e,"side"),price:n,stopPrice:void 0,triggerPrice:void 0,average:o,amount:h,remaining:d,filled:c,status:i,cost:void 0,trades:void 0,fee:void 0},t)}parseOrderStatus(e){return this.safeString({wait:"open",done:"closed",cancel:"canceled"},e,e)}async createOrders(e,t,i={}){await this.loadMarkets();const s={market:this.market(e).id,orders:t},r=(await this.privatePostOrdersMulti(this.extend(s,i))).data;return this.parseOrders(r)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s=await this.privatePostOrderDelete(this.extend({id:e},i)),r=this.safeValue(s,"data");return this.parseOrder(r)}async cancelOrders(e,t,i={}){await this.loadMarkets();const s=await this.privatePostOrderDeleteMulti(this.extend({ids:e},i)),r=this.safeValue(s,"data");return this.parseOrders(r)}async cancelAllOrders(e,t={}){await this.loadMarkets();const i=await this.privatePostOrdersClear(t),s=this.safeValue(i,"data");return this.parseOrders(s)}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+this.version+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if("public"===t)if("tickers_multi"===e||"order_book/multi"===e){let e="?";const t=this.safeValue(s,"markets");for(let i=0;i<t.length;i++)e+="markets[]="+t[i]+"&";const i=this.safeValue(s,"limit");void 0!==i&&(e+="limit="+i),n+=e}else Object.keys(o).length&&(n+="?"+this.urlencode(o));else if("private"===t){this.checkRequiredCredentials();const e={uid:this.apiKey,data:o};n+="?user_jwt="+this.jwt(e,this.encode(this.secret),"RS256")}return{url:n,method:i,body:a,headers:{"Content-Type":"application/json"}}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;const c=this.safeString(o,"code"),l=this.safeString(o,"message");if(void 0!==c&&"0"!==c){const e=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.codes,c,e),this.throwExactlyMatchedException(this.exceptions.exact,l,e),new r(e)}}}},21384:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ExchangeNotAvailable:a,OnMaintenance:n,ArgumentsRequired:o,BadRequest:h,AccountSuspended:d,InvalidAddress:c,PermissionDenied:l,DDoSProtection:u,InsufficientFunds:f,InvalidNonce:p,CancelPending:m,InvalidOrder:g,OrderNotFound:y,AuthenticationError:b,RequestTimeout:v,NotSupported:w,BadSymbol:S,RateLimitExceeded:k}=i(73449),{TICK_SIZE:T}=i(62115),_=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"okcoin",name:"OKCoin",countries:["CN","US"],version:"v3",rateLimit:20,pro:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:void 0,future:!0,option:void 0,cancelOrder:!0,createOrder:!0,fetchBalance:!0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchLedger:!0,fetchMarkets:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:void 0,fetchOrderTrades:!0,fetchPosition:!0,fetchPositions:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTransactions:void 0,fetchWithdrawals:!0,transfer:!0,withdraw:!0},timeframes:{"1m":"60","3m":"180","5m":"300","15m":"900","30m":"1800","1h":"3600","2h":"7200","4h":"14400","6h":"21600","12h":"43200","1d":"86400","1w":"604800","1M":"2678400","3M":"8035200","6M":"16070400","1y":"31536000"},hostname:"okcoin.com",urls:{logo:"https://user-images.githubusercontent.com/51840849/87295551-102fbf00-c50e-11ea-90a9-462eebba5829.jpg",api:{rest:"https://www.{hostname}"},www:"https://www.okcoin.com",doc:"https://www.okcoin.com/docs/en/",fees:"https://www.okcoin.com/coin-fees",referral:"https://www.okcoin.com/account/register?flag=activity&channelId=600001513",test:{rest:"https://testnet.okex.com"}},api:{general:{get:{time:8.3334}},account:{get:{wallet:8.3334,"sub-account":1e3,"asset-valuation":1e3,"wallet/{currency}":8.3334,"withdrawal/history":8.3334,"withdrawal/history/{currency}":8.3334,ledger:5,"deposit/address":8.3334,"deposit/history":8.3334,"deposit/history/{currency}":8.3334,currencies:8.3334,"withdrawal/fee":8.3334,"deposit-lightning":50,"withdrawal-lightning":50,"fiat/deposit/detail":5,"fiat/deposit/details":8.3334,"fiat/withdraw/detail":5,"fiat/withdraw/details":8.3334,"fiat/channel":8.3334},post:{transfer:100,withdrawal:8.3334,"fiat/cancel_deposit":1,"fiat/deposit":8.3334,"fiat/withdraw":8.3334,"fiat/cancel_withdrawal":1}},otc:{get:{"rfq/instruments":50,"rfq/trade":50,"rfq/history":50},post:{"rfq/quote":50,"rfq/trade":50}},users:{get:{"subaccount-info":20,"account-info":20,"subaccount/apikey":20},post:{"create-subaccount":5,"delete-subaccount":5,"subaccount/apikey":50,"subacount/delete-apikey":20,"subacount/modify-apikey":20}},earning:{get:{offers:5,orders:5,positions:8.3334},post:{purchase:5,redeem:5,cancel:5}},spot:{get:{accounts:5,"accounts/{currency}":5,"accounts/{currency}/ledger":5,orders:10,orders_pending:5,"orders/{order_id}":5,"orders/{client_oid}":5,trade_fee:5,fills:10,algo:5,instruments:5,"instruments/{instrument_id}/book":5,"instruments/ticker":5,"instruments/{instrument_id}/ticker":5,"instruments/{instrument_id}/trades":5,"instruments/{instrument_id}/candles":5},post:{order_algo:2.5,orders:1,batch_orders:2,"cancel_orders/{order_id}":1,"cancel_orders/{client_oid}":1,cancel_batch_algos:5,cancel_batch_orders:5,"amend_order/{instrument_id}":2.5,amend_batch_orders:5}},margin:{get:{accounts:5,"accounts/{instrument_id}":5,"accounts/{instrument_id}/ledger":5,"accounts/availability":5,"accounts/{instrument_id}/availability":5,"accounts/borrowed":5,"accounts/{instrument_id}/borrowed":5,orders:10,"accounts/{instrument_id}/leverage":1,"orders/{order_id}":5,"orders/{client_oid}":5,orders_pending:5,fills:10,"instruments/{instrument_id}/mark_price":5},post:{"accounts/borrow":1,"accounts/repayment":1,orders:1,batch_orders:2,cancel_orders:1,"cancel_orders/{order_id}":1,"cancel_orders/{client_oid}":1,cancel_batch_orders:2,"amend_order/{instrument_id}":2.5,amend_batch_orders:5,"accounts/{instrument_id}/leverage":1}},system:{get:{status:250}},market:{get:{oracle:250}},futures:{get:["position","{instrument_id}/position","accounts","accounts/{underlying}","accounts/{underlying}/leverage","accounts/{underlying}/ledger","order_algo/{instrument_id}","orders/{instrument_id}","orders/{instrument_id}/{order_id}","orders/{instrument_id}/{client_oid}","fills","trade_fee","accounts/{instrument_id}/holds","order_algo/{instrument_id}","instruments","instruments/{instrument_id}/book","instruments/ticker","instruments/{instrument_id}/ticker","instruments/{instrument_id}/trades","instruments/{instrument_id}/candles","instruments/{instrument_id}/history/candles","instruments/{instrument_id}/index","rate","instruments/{instrument_id}/estimated_price","instruments/{instrument_id}/open_interest","instruments/{instrument_id}/price_limit","instruments/{instrument_id}/mark_price","instruments/{instrument_id}/liquidation"],post:["accounts/{underlying}/leverage","order","amend_order/{instrument_id}","orders","cancel_order/{instrument_id}/{order_id}","cancel_order/{instrument_id}/{client_oid}","cancel_batch_orders/{instrument_id}","accounts/margin_mode","close_position","cancel_all","order_algo","cancel_algos"]},swap:{get:["position","{instrument_id}/position","accounts","{instrument_id}/accounts","accounts/{instrument_id}/settings","accounts/{instrument_id}/ledger","orders/{instrument_id}","orders/{instrument_id}/{order_id}","orders/{instrument_id}/{client_oid}","fills","accounts/{instrument_id}/holds","trade_fee","order_algo/{instrument_id}","instruments","instruments/{instrument_id}/depth","instruments/ticker","instruments/{instrument_id}/ticker","instruments/{instrument_id}/trades","instruments/{instrument_id}/candles","instruments/{instrument_id}/history/candles","instruments/{instrument_id}/index","rate","instruments/{instrument_id}/open_interest","instruments/{instrument_id}/price_limit","instruments/{instrument_id}/liquidation","instruments/{instrument_id}/funding_time","instruments/{instrument_id}/mark_price","instruments/{instrument_id}/historical_funding_rate"],post:["accounts/{instrument_id}/leverage","order","amend_order/{instrument_id}","orders","cancel_order/{instrument_id}/{order_id}","cancel_order/{instrument_id}/{client_oid}","cancel_batch_orders/{instrument_id}","order_algo","cancel_algos","close_position","cancel_all","order_algo","cancel_algos"]},option:{get:["accounts","position","{underlying}/position","accounts/{underlying}","orders/{underlying}","fills/{underlying}","accounts/{underlying}/ledger","trade_fee","orders/{underlying}/{order_id}","orders/{underlying}/{client_oid}","underlying","instruments/{underlying}","instruments/{underlying}/summary","instruments/{underlying}/summary/{instrument_id}","instruments/{instrument_id}/book","instruments/{instrument_id}/trades","instruments/{instrument_id}/ticker","instruments/{instrument_id}/candles"],post:["order","orders","cancel_order/{underlying}/{order_id}","cancel_order/{underlying}/{client_oid}","cancel_batch_orders/{underlying}","amend_order/{underlying}","amend_batch_orders/{underlying}"]},information:{get:["{currency}/long_short_ratio","{currency}/volume","{currency}/taker","{currency}/sentiment","{currency}/margin"]},index:{get:["{instrument_id}/constituents"]}},fees:{trading:{taker:.002,maker:.001},spot:{taker:.0015,maker:.001}},requiredCredentials:{apiKey:!0,secret:!0,password:!0},exceptions:{exact:{1:r,"failure to get a peer from the ring-balancer":a,"Server is busy, please try again.":a,"An unexpected error occurred":r,"System error":r,4010:l,4001:r,4002:r,30001:b,30002:b,30003:b,30004:b,30005:p,30006:b,30007:h,30008:v,30009:r,30010:b,30011:l,30012:b,30013:b,30014:u,30015:b,30016:r,30017:r,30018:r,30019:a,30020:h,30021:h,30022:l,30023:h,30024:S,30025:h,30026:u,30027:b,30028:l,30029:d,30030:a,30031:h,30032:S,30033:h,30034:r,30035:r,30036:r,30037:a,30038:n,30044:v,32001:d,32002:l,32003:m,32004:r,32005:g,32006:g,32007:g,32008:g,32009:g,32010:r,32011:r,32012:r,32013:r,32014:r,32015:r,32016:r,32017:r,32018:r,32019:r,32020:r,32021:r,32022:r,32023:r,32024:r,32025:r,32026:r,32027:r,32028:r,32029:r,32030:g,32031:o,32038:b,32040:r,32044:r,32045:r,32046:r,32047:r,32048:g,32049:r,32050:g,32051:g,32052:r,32053:r,32057:r,32054:r,32055:g,32056:r,32058:r,32059:g,32060:g,32061:g,32062:g,32063:g,32064:r,32065:r,32066:r,32067:r,32068:r,32069:r,32070:r,32071:r,32072:r,32073:r,32074:r,32075:r,32076:r,32077:r,32078:r,32079:r,32080:r,32083:r,33001:l,33002:d,33003:f,33004:r,33005:r,33006:r,33007:r,33008:f,33009:r,33010:r,33011:r,33012:r,33013:g,33014:y,33015:g,33016:r,33017:f,33018:r,33020:r,33021:h,33022:g,33023:r,33024:g,33025:g,33026:r,33027:g,33028:g,33029:g,33034:r,33035:r,33036:r,33037:r,33038:r,33039:r,33040:r,33041:r,33042:r,33043:r,33044:r,33045:r,33046:r,33047:r,33048:r,33049:r,33050:r,33051:r,33059:h,33060:h,33061:r,33062:r,33063:r,33064:r,33065:r,33085:g,21009:r,34001:l,34002:c,34003:r,34004:r,34005:r,34006:r,34007:r,34008:f,34009:r,34010:r,34011:r,34012:r,34013:r,34014:r,34015:r,34016:l,34017:d,34018:b,34019:l,34020:l,34021:c,34022:r,34023:l,34026:k,34036:r,34037:r,34038:r,34039:r,35001:r,35002:r,35003:r,35004:r,35005:b,35008:g,35010:g,35012:g,35014:g,35015:g,35017:r,35019:g,35020:g,35021:g,35022:h,35024:h,35025:f,35026:h,35029:y,35030:g,35031:g,35032:r,35037:r,35039:f,35040:g,35044:r,35046:f,35047:f,35048:r,35049:g,35050:g,35052:f,35053:r,35055:f,35057:r,35058:r,35059:h,35060:h,35061:h,35062:g,35063:g,35064:g,35066:g,35067:g,35068:g,35069:g,35070:g,35071:g,35072:g,35073:g,35074:g,35075:g,35076:g,35077:g,35078:g,35079:g,35080:g,35081:g,35082:g,35083:g,35084:g,35085:g,35086:g,35087:g,35088:g,35089:g,35090:r,35091:r,35092:r,35093:r,35094:r,35095:h,35096:r,35097:r,35098:r,35099:r,35102:k,36001:h,36002:h,36005:r,36101:b,36102:l,36103:l,36104:l,36105:l,36106:l,36107:l,36108:f,36109:l,36201:l,36202:l,36203:g,36204:r,36205:h,36206:h,36207:g,36208:g,36209:g,36210:g,36211:g,36212:g,36213:g,36214:r,36216:y,36217:g,36218:g,36219:g,36220:g,36221:g,36222:g,36223:g,36224:g,36225:g,36226:g,36227:g,36228:g,36229:g,36230:g},broad:{}},precisionMode:T,options:{fetchOHLCV:{type:"Candles"},createMarketBuyOrderRequiresPrice:!0,fetchMarkets:["spot"],defaultType:"spot",accountsByType:{spot:"1",funding:"6",main:"6"},accountsById:{1:"spot",6:"funding"},auth:{time:"public",currencies:"private",instruments:"public",rate:"public","{instrument_id}/constituents":"public"},warnOnFetchCurrenciesWithoutAuthorization:!1},commonCurrencies:{AE:"AET",BOX:"DefiBox",HOT:"Hydro Protocol",HSR:"HC",MAG:"Maggie",SBTC:"Super Bitcoin",TRADE:"Unitrade",YOYO:"YOYOW",WIN:"WinToken"}})}async fetchTime(e={}){const t=await this.generalGetTime(e);return this.parse8601(this.safeString(t,"iso"))}async fetchMarkets(e={}){const t=this.safeValue(this.options,"fetchMarkets");let i=[];for(let s=0;s<t.length;s++){const r=await this.fetchMarketsByType(t[s],e);i=this.arrayConcat(i,r)}return i}parseMarkets(e){const t=[];for(let i=0;i<e.length;i++)t.push(this.parseMarket(e[i]));return t}parseMarket(e){const t=this.safeString(e,"instrument_id");let i=this.safeValue(e,"option_type");const s=this.safeNumber(e,"contract_val"),r=void 0!==s,a=this.safeString(e,"alias");let n="spot";const o=!r,h=void 0!==i,d=!h&&void 0!==a,c=r&&!d&&!h;let l=this.safeString(e,"base_currency"),u=this.safeString(e,"quote_currency");const f=this.safeString(e,"settlement_currency");if(h){const t=this.safeString(e,"underlying").split("-");l=this.safeString(t,0),u=this.safeString(t,1),n="option"}else d?(l=this.safeString(e,"underlying_index"),n="futures"):c&&(n="swap");const p=this.safeCurrencyCode(l),m=this.safeCurrencyCode(u),g=this.safeCurrencyCode(f);let y,b=p+"/"+m,v=this.safeString(e,"delivery");const w=this.safeValue(e,"strike");r&&(b=b+":"+g,(d||h)&&(d&&(v+="T00:00:00Z"),y=this.parse8601(v),b=b+"-"+this.yymmdd(y),h&&(b=b+":"+w+":"+i,i="C"===i?"call":"put")));const S=this.safeNumber2(e,"lot_size","trade_increment"),k=this.safeString(e,"tick_size"),T=this.safeString2(e,"min_size","base_min_size"),O=this.parseNumber(T);let M;void 0!==O&&void 0!==k&&(M=this.parseNumber(_.stringMul(k,T)));const I=this.safeValue2(this.fees,n,"trading",{}),x=this.safeString(e,"max_leverage","1"),C=this.parseNumber(_.stringMax(x,"1")),P=this.parseNumber(k);return this.extend(I,{id:t,symbol:b,base:p,quote:m,settle:g,baseId:l,quoteId:u,settleId:f,type:n,spot:o,margin:!1,swap:c,future:d,futures:d,option:h,active:!0,contract:r,linear:r?m===g:void 0,inverse:r?p===g:void 0,contractSize:s,expiry:y,expiryDatetime:this.iso8601(y),strike:w,optionType:i,precision:{amount:this.safeNumber(e,"size_increment",S),price:P},limits:{leverage:{min:this.parseNumber("1"),max:this.parseNumber(C)},amount:{min:O,max:void 0},price:{min:P,max:void 0},cost:{min:M,max:void 0}},info:e})}async fetchMarketsByType(e,t={}){if("option"===e){const e=await this.optionGetUnderlying(t);let i=[];for(let t=0;t<e.length;t++){const s=await this.optionGetInstrumentsUnderlying({underlying:e[t]});i=this.arrayConcat(i,s)}return this.parseMarkets(i)}if("spot"===e||"futures"===e||"swap"===e){const i=e+"GetInstruments",s=await this[i](t);return this.parseMarkets(s)}throw new w(this.id+" fetchMarketsByType() does not support market type "+e)}async fetchCurrencies(e={}){if(this.checkRequiredCredentials(!1)){const t=await this.accountGetCurrencies(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.safeString(s,"name"),o=this.safeInteger(s,"can_deposit"),h=this.safeInteger(s,"can_withdraw"),d=1===o,c=1===h,l=!(!o||!h);i[a]={id:r,code:a,info:s,type:void 0,name:n,active:l,deposit:d,withdraw:c,fee:void 0,precision:this.parseNumber("1e-8"),limits:{amount:{min:void 0,max:void 0},withdraw:{min:this.safeNumber(s,"min_withdrawal"),max:void 0}}}}return i}if(this.options.warnOnFetchCurrenciesWithoutAuthorization)throw new r(this.id+' fetchCurrencies() is a private API endpoint that requires authentication with API keys. Set the API keys on the exchange instance or exchange.options["warnOnFetchCurrenciesWithoutAuthorization"] = false to suppress this warning message.')}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);let r=s.type+"GetInstrumentsInstrumentId";r+="swap"===s.type?"Depth":"Book";const a={instrument_id:s.id};void 0!==t&&(a.size=t);const n=await this[r](this.extend(a,i)),o=this.parse8601(this.safeString2(n,"timestamp","time"));return this.parseOrderBook(n,e,o)}parseTicker(e,t){const i=this.parse8601(this.safeString(e,"timestamp")),s=this.safeString(e,"instrument_id"),r=(t=this.safeMarket(s,t,"-")).symbol,a=this.safeString(e,"last"),n=this.safeString(e,"open_24h");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high_24h"),low:this.safeString(e,"low_24h"),bid:this.safeString(e,"best_bid"),bidVolume:this.safeString(e,"best_bid_size"),ask:this.safeString(e,"best_ask"),askVolume:this.safeString(e,"best_ask_size"),vwap:void 0,open:n,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"base_volume_24h"),quoteVolume:this.safeString(e,"quote_volume_24h"),info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s=i.type+"GetInstrumentsInstrumentIdTicker",r={instrument_id:i.id},a=await this[s](this.extend(r,t));return this.parseTicker(a)}async fetchTickersByType(e,t,i={}){await this.loadMarkets(),t=this.marketSymbols(t);const s=e+"GetInstrumentsTicker",r=await this[s](i),a={};for(let e=0;e<r.length;e++){const t=this.parseTicker(r[e]);a[t.symbol]=t}return this.filterByArray(a,"symbol",t)}async fetchTickers(e,t={}){e=this.marketSymbols(e);const i=this.safeString(e,0);let s,r;return void 0!==i&&(s=this.market(i)),[r,t]=this.handleMarketTypeAndParams("fetchTickers",s,t),await this.fetchTickersByType(r,e,this.omit(t,"type"))}parseTrade(e,t){const i=this.safeString(e,"instrument_id"),s=(t=this.safeMarket(i,t,"-")).symbol,r=this.parse8601(this.safeString2(e,"timestamp","created_at")),a=this.safeString(e,"price");let n=this.safeString2(e,"size","qty");n=this.safeString(e,"order_qty",n);let o=this.safeString2(e,"exec_type","liquidity");"M"===o?o="maker":"T"===o&&(o="taker");const h=this.safeString(e,"side"),d=this.safeString(e,"fee");let c;if(void 0!==d){const e="buy"===h?t.base:t.quote;c={cost:_.stringNeg(d),currency:e}}const l=this.safeString(e,"order_id");return this.safeTrade({info:e,timestamp:r,datetime:this.iso8601(r),symbol:s,id:this.safeString2(e,"trade_id","ledger_id"),order:l,type:void 0,takerOrMaker:o,side:h,price:a,amount:n,cost:void 0,fee:c},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a=r.type+"GetInstrumentsInstrumentIdTrades";(void 0===i||i>100)&&(i=100);const n={instrument_id:r.id,limit:i},o=await this[a](this.extend(n,s));return this.parseTrades(o,r,t,i)}parseOHLCV(e,t){if(Array.isArray(e)){const t=e.length>6?6:5;let i=this.safeValue(e,0);return"string"==typeof i&&(i=this.parse8601(i)),[i,this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,t)]}return[this.parse8601(this.safeString(e,"time")),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.parseTimeframe(t),o={instrument_id:a.id,granularity:this.safeString(this.timeframes,t,t)},h=this.safeValue(this.options,"fetchOHLCV",{}),d=this.safeString(h,"type","Candles"),c=this.safeString(r,"type",d);r=this.omit(r,"type");const l=a.type+"GetInstrumentsInstrumentId"+c;if("Candles"===c){if(void 0!==i)void 0!==s&&(o.end=this.iso8601(this.sum(i,s*n*1e3))),o.start=this.iso8601(i);else if(void 0!==s){const e=this.milliseconds();o.start=this.iso8601(e-s*n*1e3),o.end=this.iso8601(e)}}else if("HistoryCandles"===c){if(a.option)throw new w(this.id+" fetchOHLCV() does not have "+c+" for "+a.type+" markets");if(void 0!==i)void 0===s&&(s=300),o.start=this.iso8601(this.sum(i,s*n*1e3)),o.end=this.iso8601(i);else if(void 0!==s){const e=this.milliseconds();o.end=this.iso8601(e-s*n*1e3),o.start=this.iso8601(e)}}const u=await this[l](this.extend(o,r));return this.parseOHLCVs(u,a,t,i,s)}parseAccountBalance(e){const t={info:e,timestamp:void 0,datetime:void 0};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(s,"balance"),n.used=this.safeString(s,"hold"),n.free=this.safeString(s,"available"),t[a]=n}return this.safeBalance(t)}parseFuturesBalance(e){const t={info:e,timestamp:void 0,datetime:void 0},i=this.safeValue(e,"info",{}),s=Object.keys(i);for(let e=0;e<s.length;e++){const r=s[e],a=this.safeCurrencyCode(r),n=this.safeValue(i,r,{}),o=this.account(),h=this.safeString(n,"total_avail_balance");if("fixed"===this.safeString(n,"margin_mode")){const e=this.safeValue(n,"contracts",[]);let t=h;for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"fixed_balance"),a=this.safeString(s,"realized_pnl"),n=this.safeString(s,"margin_frozen"),o=this.safeString(s,"margin_for_unfilled"),h=_.stringSub(_.stringSub(_.stringAdd(r,a),n),o);t=_.stringAdd(t,h)}o.free=t}else{const e=this.safeString(n,"realized_pnl"),t=this.safeString(n,"unrealized_pnl"),i=this.safeString(n,"margin_frozen"),s=this.safeString(n,"margin_for_unfilled"),r=_.stringAdd(_.stringAdd(h,e),t);o.free=_.stringSub(_.stringSub(r,i),s)}o.total=this.safeString(n,"equity"),t[a]=o}return this.safeBalance(t)}parseSwapBalance(e){const t={info:e};let i;const s=this.safeValue(e,"info",[]);for(let e=0;e<s.length;e++){const r=s[e],a=this.safeString(r,"instrument_id"),n=this.safeSymbol(a),o=this.parse8601(this.safeString(r,"timestamp"));i=void 0===i?o:Math.max(i,o);const h=this.account();h.total=this.safeString(r,"equity"),h.free=this.safeString(r,"total_avail_balance"),t[n]=h}return t.timestamp=i,t.datetime=this.iso8601(i),this.safeBalance(t)}async fetchBalance(e={}){const t=this.safeString2(this.options,"fetchBalance","defaultType"),i=this.safeString(e,"type",t);if(void 0===i)throw new o(this.id+" fetchBalance() requires a type parameter (one of 'account', 'spot', 'futures', 'swap')");await this.loadMarkets();const s=i+"Get"+("account"===i?"Wallet":"Accounts"),r=this.omit(e,"type"),a=await this[s](r);return this.parseBalanceByType(i,a)}parseBalanceByType(e,t){if("account"===e||"spot"===e)return this.parseAccountBalance(t);if("futures"===e)return this.parseFuturesBalance(t);if("swap"===e)return this.parseSwapBalance(t);throw new w(this.id+" fetchBalance does not support the '"+e+"' type (the type must be one of 'account', 'spot', 'futures', 'swap')")}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);let o={instrument_id:n.id};const h=this.safeString2(a,"client_oid","clientOrderId");let d;if(void 0!==h&&(o.client_oid=h,a=this.omit(a,["client_oid","clientOrderId"])),n.futures||n.swap){const i=n.futures?this.numberToString(s):this.amountToPrecision(e,s);o=this.extend(o,{type:t,size:i});const h=this.safeString(a,"order_type");"market"===t||"4"===h?o.order_type="4":o.price=this.priceToPrecision(e,r),n.futures&&(o.leverage="10"),d=n.type+"PostOrder"}else{if(o=this.extend(o,{side:i,type:t}),"limit"===t)o.price=this.priceToPrecision(e,r),o.size=this.amountToPrecision(e,s);else if("market"===t)if("buy"===i){let t=this.safeNumber(a,"notional");if(this.safeValue(this.options,"createMarketBuyOrderRequiresPrice",!0)){if(void 0!==r)void 0===t&&(t=s*r);else if(void 0===t)throw new g(this.id+" createOrder() requires the price argument with market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount, or, alternatively, add .options['createMarketBuyOrderRequiresPrice'] = false and supply the total cost value in the 'amount' argument or in the 'notional' extra parameter (the exchange-specific behaviour)")}else t=void 0===t?s:t;o.notional=this.costToPrecision(e,t)}else o.size=this.amountToPrecision(e,s);d="spotPostOrders"}const c=await this[d](this.extend(o,a)),l=this.parseOrder(c,n);return this.extend(l,{type:t,side:i})}async cancelOrder(e,t,i={}){if(void 0===t)throw new o(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t);let r;if(s.futures||s.swap)r=s.type;else{const e=this.safeString2(this.options,"cancelOrder","defaultType",s.type);r=this.safeString(i,"type",e)}if(void 0===r)throw new o(this.id+" cancelOrder() requires a type parameter (one of 'spot', 'futures', 'swap').");let a=r+"PostCancelOrder";const n={instrument_id:s.id};s.futures||s.swap?a+="InstrumentId":a+="s";const h=this.safeString2(i,"client_oid","clientOrderId");void 0!==h?(a+="ClientOid",n.client_oid=h):(a+="OrderId",n.order_id=e);const d=this.omit(i,["type","client_oid","clientOrderId"]),c=await this[a](this.extend(n,d)),l="result"in c?c:this.safeValue(c,s.id,{});return this.parseOrder(l,s)}parseOrderStatus(e){return this.safeString({"-2":"failed","-1":"canceled",0:"open",1:"open",2:"closed",3:"open",4:"canceled"},e,e)}parseOrderSide(e){return this.safeString({1:"buy",2:"sell",3:"sell",4:"buy"},e,e)}parseOrder(e,t){const i=this.safeString(e,"order_id"),s=this.parse8601(this.safeString(e,"timestamp"));let r=this.safeString(e,"side");const a=this.safeString(e,"type");"buy"!==r&&"sell"!==r&&(r=this.parseOrderSide(a));const n=this.safeString(e,"instrument_id");t=this.safeMarket(n,t);let o=this.safeString(e,"size");const h=this.safeString2(e,"filled_size","filled_qty");let d;void 0!==o&&void 0!==h&&(o=_.stringMax(o,h),d=_.stringMax("0",_.stringSub(o,h))),"market"===a&&(d="0");let c=this.safeString2(e,"filled_notional","funds");const l=this.safeString(e,"price");let u=this.safeString(e,"price_avg");void 0===c?void 0!==h&&void 0!==u&&(c=_.stringMul(u,h)):void 0===u&&void 0!==h&&_.stringGt(h,"0")&&(u=_.stringDiv(c,h));const f=this.parseOrderStatus(this.safeString(e,"state")),p=this.safeNumber(e,"fee");let m;if(void 0!==p){m={cost:p,currency:void 0}}let g=this.safeString(e,"client_oid");void 0!==g&&g.length<1&&(g=void 0);const y=this.safeNumber(e,"trigger_price");return this.safeOrder({info:e,id:i,clientOrderId:g,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:void 0,symbol:t.symbol,type:a,timeInForce:void 0,postOnly:void 0,side:r,price:l,stopPrice:y,triggerPrice:y,average:u,cost:c,amount:o,filled:h,remaining:d,status:f,fee:m,trades:void 0},t)}async fetchOrder(e,t,i={}){if(void 0===t)throw new o(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r=this.safeString2(this.options,"fetchOrder","defaultType",s.type),a=this.safeString(i,"type",r);if(void 0===a)throw new o(this.id+" fetchOrder() requires a type parameter (one of 'spot', 'futures', 'swap').");let n=a+"GetOrders"+(s.futures||s.swap?"InstrumentId":"");const h={instrument_id:s.id},d=this.safeString(i,"client_oid");void 0!==d?(n+="ClientOid",h.client_oid=d):(n+="OrderId",h.order_id=e);const c=this.omit(i,"type"),l=await this[n](this.extend(h,c));return this.parseOrder(l)}async fetchOrdersByState(e,t,i,s,r={}){if(void 0===t)throw new o(this.id+" fetchOrdersByState() requires a symbol argument");await this.loadMarkets();const a=this.market(t);let n;if(a.futures||a.swap)n=a.type;else{const e=this.safeString2(this.options,"fetchOrder","defaultType",a.type);n=this.safeString(r,"type",e)}if(void 0===n)throw new o(this.id+" fetchOrdersByState() requires a type parameter (one of 'spot', 'futures', 'swap').");const h={instrument_id:a.id,state:e};let d=n+"GetOrders";(a.futures||a.swap)&&(d+="InstrumentId");const c=this.omit(r,"type"),l=await this[d](this.extend(h,c));let u;if(a.swap||a.futures)u=this.safeValue(l,"order_info",[]);else{u=l;const e=l.length;if(e<1)return[];if(e>1){void 0!==this.safeValue(l[1],"before")&&(u=l[0])}}return this.parseOrders(u,a,i,s)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrdersByState("6",e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersByState("7",e,t,i,s)}parseDepositAddress(e,t){const i=this.safeString(e,"address");let s=this.safeString2(e,"tag","payment_id");s=this.safeString2(e,"memo","Memo",s);const r=this.safeString(e,"currency"),a=this.safeCurrencyCode(r);return this.checkAddress(i),{currency:a,address:i,tag:s,info:e}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=e.split("-"),s={currency:this.currency(i[0]).id},r=await this.accountGetDepositAddress(this.extend(s,t)),a=this.parseDepositAddresses(r),n=this.safeValue(a,e);if(void 0===n)throw new c(this.id+" fetchDepositAddress() cannot return nonexistent addresses, you should create withdrawal addresses with the exchange website first");return n}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n=this.safeValue(this.options,"accountsByType",{}),o=this.safeString(n,i,i),h=this.safeString(n,s,s),d={amount:this.currencyToPrecision(e,t),currency:a.id,from:o,to:h,type:"0"};"main"===o?(d.type="1",d.sub_account=h,d.to="0"):"main"===h&&(d.type="2",d.sub_account=o,d.from="0",d.to="6");const c=await this.accountPostTransfer(this.extend(d,r));return this.parseTransfer(c,a)}parseTransfer(e,t){const i=this.safeValue(this.options,"accountsById",{});return{info:e,id:this.safeString(e,"transfer_id"),timestamp:void 0,datetime:void 0,currency:this.safeCurrencyCode(this.safeString(e,"currency"),t),amount:this.safeNumber(e,"amount"),fromAccount:this.safeString(i,this.safeString(e,"from")),toAccount:this.safeString(i,this.safeString(e,"to")),status:this.parseTransferStatus(this.safeString(e,"result"))}}parseTransferStatus(e){return this.safeString({true:"ok"},e,"failed")}async withdraw(e,t,i,s,a={}){[s,a]=this.handleWithdrawTagAndParams(s,a),this.checkAddress(i),await this.loadMarkets();const n=this.currency(e);s&&(i=i+":"+s);const h=this.safeString(a,"fee");if(void 0===h)throw new o(this.id+" withdraw() requires a 'fee' string parameter, network transaction fee must be ≥ 0. Withdrawals to OKCoin or OKEx are fee-free, please set '0'. Withdrawing to external digital asset address requires network transaction fee.");const d={currency:n.id,to_address:i,destination:"4",amount:this.numberToString(t),fee:h};"password"in a?d.trade_pwd=a.password:"trade_pwd"in a?d.trade_pwd=a.trade_pwd:this.password&&(d.trade_pwd=this.password);const c=this.omit(a,["fee","password","trade_pwd"]);if(!("trade_pwd"in d))throw new r(this.id+" withdraw() requires this.password set on the exchange instance or a password / trade_pwd parameter");const l=await this.accountPostWithdrawal(this.extend(d,c));return this.parseTransaction(l,n)}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a,n="accountGetDepositHistory";void 0!==e&&(a=this.currency(e),r.currency=a.id,n+="Currency");const o=await this[n](this.extend(r,s));return this.parseTransactions(o,a,t,i,s)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a,n="accountGetWithdrawalHistory";void 0!==e&&(a=this.currency(e),r.currency=a.id,n+="Currency");const o=await this[n](this.extend(r,s));return this.parseTransactions(o,a,t,i,s)}parseTransactionStatus(e){return this.safeString({"-3":"pending","-2":"canceled","-1":"failed",0:"pending",1:"pending",2:"ok",3:"pending",4:"pending",5:"pending"},e,e)}parseTransaction(e,t){let i,s,r;const a=this.safeString(e,"withdrawal_id"),n=this.safeString(e,"from"),o=this.safeString(e,"to"),h=this.safeString(e,"tag");void 0!==a?(i="withdrawal",s=a,r=o):(s=this.safeString2(e,"payment_id","deposit_id"),i="deposit",r=o);const d=this.safeString(e,"currency"),c=this.safeCurrencyCode(d),l=this.safeNumber(e,"amount"),u=this.parseTransactionStatus(this.safeString(e,"status")),f=this.safeString(e,"txid"),p=this.parse8601(this.safeString(e,"timestamp"));let m;if("deposit"===i)m=0;else if(void 0!==d){const t=this.safeString(e,"fee");if(void 0!==t){const e=d.toLowerCase(),i=t.replace(e,"");m=parseFloat(i)}}return{info:e,id:s,currency:c,amount:l,network:void 0,addressFrom:n,addressTo:o,address:r,tagFrom:void 0,tagTo:h,tag:h,status:u,type:i,updated:void 0,txid:f,timestamp:p,datetime:this.iso8601(p),fee:{currency:c,cost:m}}}parseMyTrade(e,t){const i=this.safeValue(e,1),s=this.safeValue(e,0),r=this.safeString(s,"instrument_id");if(r!==this.safeString(i,"instrument_id"))throw new w(this.id+" parseMyTrade() received unrecognized response format, differing instrument_ids in one fill, the exchange API might have changed, paste your verbose output: https://github.com/ccxt/ccxt/wiki/FAQ#what-is-required-to-get-help");const a=r,n=(t=this.safeMarket(a,t)).symbol,o=t.quoteId;let h,d,c;let l;this.safeString(i,"currency")===o?(h=this.safeString(s,"side"),d=this.safeString(s,"size"),c=this.safeString(i,"size"),l=this.safeString(s,"currency")):(h=this.safeString(i,"side"),d=this.safeString(i,"size"),c=this.safeString(s,"size"),l=this.safeString(i,"currency"));const u=this.safeString(i,"trade_id"),f=this.safeString(i,"price"),p=this.safeString(s,"fee"),m=this.safeString(i,"fee"),g=this.safeCurrencyCode(this.safeString(s,"currency")),y=this.safeCurrencyCode(this.safeString(i,"currency"));let b,v;void 0===p||_.stringEquals(p,"0")?b=void 0===m||_.stringEquals(m,"0")?{cost:"0",currency:this.safeCurrencyCode(l)}:{cost:_.stringNeg(m),currency:y}:void 0===m||_.stringEquals(m,"0")?b={cost:_.stringNeg(p),currency:g}:v=[{cost:_.stringNeg(p),currency:g},{cost:_.stringNeg(m),currency:y}];const S=this.parse8601(this.safeString2(i,"timestamp","created_at"));let k=this.safeString2(i,"exec_type","liquidity");"M"===k?k="maker":"T"===k&&(k="taker");const T=this.safeString(i,"order_id");return this.safeTrade({info:e,timestamp:S,datetime:this.iso8601(S),symbol:n,id:u,order:T,type:void 0,takerOrMaker:k,side:h,price:f,amount:d,cost:c,fee:b,fees:v},t)}parseMyTrades(e,t,i,s,r={}){const a=this.groupBy(e,"trade_id"),n=Object.keys(a),o=[];for(let e=0;e<n.length;e++){const t=a[n[e]];if(2===t.length){const e=this.parseMyTrade(t);o.push(e)}}return t=this.safeMarket(void 0,t),this.filterBySymbolSinceLimit(o,t.symbol,i,s)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e);void 0!==i&&i>100&&(i=100);const a={instrument_id:r.id},n=this.safeString2(this.options,"fetchMyTrades","defaultType"),h=this.safeString(s,"type",n),d=this.omit(s,"type"),c=h+"GetFills",l=await this[c](this.extend(a,d));return this.parseMyTrades(l,r,t,i,s)}async fetchOrderTrades(e,t,i,s,r={}){const a={order_id:e};return await this.fetchMyTrades(t,i,s,this.extend(a,r))}async fetchPosition(e,t={}){await this.loadMarkets();const i=this.market(e);let s;const r={instrument_id:i.id},a=i.type;if("futures"===a||"swap"===a)s=a+"GetInstrumentIdPosition";else{if("option"!==a)throw new w(this.id+" fetchPosition() does not support "+a+" market "+e+", supported market types are futures, swap or option");if(void 0===this.safeString(t,"underlying"))throw new o(this.id+" fetchPosition() requires an underlying parameter for "+a+" market "+e);s=a+"GetUnderlyingPosition"}return await this[s](this.extend(r,t))}async fetchPositions(e,t={}){let i;await this.loadMarkets();const s=this.safeString2(this.options,"fetchPositions","defaultType"),r=this.safeString(t,"type",s);if("futures"===r||"swap"===r)i=r+"GetPosition";else{if("option"!==r)throw new w(this.id+" fetchPositions() does not support "+r+" markets, supported market types are futures, swap or option");if(void 0===this.safeString(t,"underlying"))throw new o(this.id+" fetchPositions() requires an underlying parameter for "+r+" markets");i=r+"GetUnderlyingPosition"}t=this.omit(t,"type");return await this[i](t)}async fetchLedger(e,t,i,s={}){await this.loadMarkets();const r=this.safeString2(this.options,"fetchLedger","defaultType"),a=this.safeString(s,"type",r),n=this.omit(s,"type"),h="account"===a?"":"Accounts";let d="";const c={};let l;if(void 0!==i&&(c.limit=i),"spot"===a){if(void 0===e)throw new o(this.id+" fetchLedger() requires a currency code argument for '"+a+"' markets");d="Currency",l=this.currency(e),c.currency=l.id}else if("futures"===a){if(void 0===e)throw new o(this.id+" fetchLedger() requires an underlying symbol for '"+a+"' markets");d="Underlying";const t=this.market(e),i=this.safeValue(t,"info",{}),s=this.safeString(i,"settlement_currency"),r=this.safeCurrencyCode(s);l=this.currency(r);const n=this.safeString(i,"underlying");c.underlying=n}else if("swap"===a){if(void 0===e)throw new o(this.id+" fetchLedger() requires a code argument (a market symbol) for '"+a+"' markets");d="InstrumentId";const t=this.market(e);l=this.currency(t.base),c.instrument_id=t.id}else{if("account"!==a)throw new w(this.id+" fetchLedger does not support the '"+a+"' type (the type must be one of 'account', 'spot', 'margin', 'futures', 'swap')");void 0!==e&&(l=this.currency(e),c.currency=l.id)}const u=a+"Get"+h+d+"Ledger",f=await this[u](this.extend(c,n));if(f.length<1)return[];if("swap"===a){const s=this.parseLedger(f);return this.filterBySymbolSinceLimit(s,e,t,i)}return this.parseLedger(f,l,t,i)}parseLedgerEntryType(e){return this.safeString({transfer:"transfer",trade:"trade",rebate:"rebate",match:"trade",fee:"fee",settlement:"trade",liquidation:"trade",funding:"fee",margin:"margin"},e,e)}parseLedgerEntry(e,t){const i=this.safeString(e,"ledger_id"),s=this.safeValue(e,"details",{}),r=this.safeString(s,"order_id"),a=this.parseLedgerEntryType(this.safeString(e,"type")),n=this.safeCurrencyCode(this.safeString(e,"currency"),t),o=this.safeNumber(e,"amount"),h=this.parse8601(this.safeString(e,"timestamp")),d={cost:this.safeNumber(e,"fee"),currency:n},c=this.safeNumber(e,"balance"),l=this.safeString(e,"instrument_id");return{info:e,id:i,account:undefined,referenceId:r,referenceAccount:undefined,type:a,currency:n,symbol:this.safeSymbol(l),amount:o,before:undefined,after:c,status:"ok",timestamp:h,datetime:this.iso8601(h),fee:d}}sign(e,t="public",i="GET",s={},r,a){const n=Array.isArray(s);let o="/api/"+t+"/"+this.version+"/";o+=n?e:this.implodeParams(e,s);const h=n?s:this.omit(s,this.extractParams(e));let d=this.implodeHostname(this.urls.api.rest)+o;const c=this.getPathAuthenticationType(e);if("public"===c||"information"===c)Object.keys(h).length&&(d+="?"+this.urlencode(h));else if("private"===c){this.checkRequiredCredentials();const e=this.iso8601(this.milliseconds());r={"OK-ACCESS-KEY":this.apiKey,"OK-ACCESS-PASSPHRASE":this.password,"OK-ACCESS-TIMESTAMP":e};let t=e+i+o;if("GET"===i){if(Object.keys(h).length){const e="?"+this.urlencode(h);d+=e,t+=e}}else(n||Object.keys(h).length)&&(t+=a=this.json(h)),r["Content-Type"]="application/json";const s=this.hmac(this.encode(t),this.encode(this.secret),"sha256","base64");r["OK-ACCESS-SIGN"]=s}return{url:d,method:i,body:a,headers:r}}getPathAuthenticationType(e){if("underlying"===e)return"public";const t=this.safeValue(this.options,"auth",{}),i=this.findBroadlyMatchedKey(t,e);return this.safeString(t,i,"private")}handleErrors(e,t,i,s,n,o,h,d,c){if(!h)return;const l=this.id+" "+o;if(503===e)throw new a(l);const u=this.safeString(h,"message"),f=this.safeString2(h,"code","error_code"),p=void 0!==u&&""!==u,m=void 0!==f&&"0"!==f;if(p&&(this.throwExactlyMatchedException(this.exceptions.exact,u,l),this.throwBroadlyMatchedException(this.exceptions.broad,u,l)),m&&this.throwExactlyMatchedException(this.exceptions.exact,f,l),m||p)throw new r(l)}}},58579:function(e,t,i){"use strict";const s=i(89352);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"okex",alias:!0})}}},62597:function(e,t,i){"use strict";const s=i(58579);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"okex5",alias:!0})}}},89352:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ExchangeNotAvailable:a,OnMaintenance:n,ArgumentsRequired:o,BadRequest:h,AccountSuspended:d,InvalidAddress:c,PermissionDenied:l,InsufficientFunds:u,InvalidNonce:f,InvalidOrder:p,OrderNotFound:m,AuthenticationError:g,RequestTimeout:y,BadSymbol:b,RateLimitExceeded:v,NetworkError:w,CancelPending:S,NotSupported:k,AccountNotEnabled:T}=i(73449),{TICK_SIZE:_}=i(62115),O=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"okx",name:"OKX",countries:["CN","US"],version:"v5",rateLimit:100,pro:!0,certified:!0,has:{CORS:void 0,spot:!0,margin:!0,swap:!0,future:!0,option:void 0,addMargin:!0,borrowMargin:!0,cancelAllOrders:!1,cancelOrder:!0,cancelOrders:!0,createDepositAddress:!1,createOrder:!0,createPostOnlyOrder:!0,createReduceOnlyOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchAccounts:!0,fetchBalance:!0,fetchBidsAsks:void 0,fetchBorrowInterest:!0,fetchBorrowRate:!0,fetchBorrowRateHistories:!0,fetchBorrowRateHistory:!0,fetchBorrowRates:!0,fetchBorrowRatesPerSymbol:!1,fetchCanceledOrders:!0,fetchClosedOrder:void 0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposit:!0,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDepositAddressesByNetwork:!0,fetchDeposits:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:!0,fetchFundingRate:!0,fetchFundingRateHistory:!0,fetchFundingRates:!1,fetchIndexOHLCV:!0,fetchL3OrderBook:!1,fetchLedger:!0,fetchLedgerEntry:void 0,fetchLeverage:!0,fetchLeverageTiers:!1,fetchMarketLeverageTiers:!0,fetchMarkets:!0,fetchMarkOHLCV:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterest:!0,fetchOpenInterestHistory:!0,fetchOpenOrder:void 0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderBooks:!1,fetchOrders:!1,fetchOrderTrades:!0,fetchPermissions:void 0,fetchPosition:!0,fetchPositions:!0,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchStatus:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!1,fetchTradingLimits:!1,fetchTransactionFee:!1,fetchTransactionFees:!1,fetchTransactions:!1,fetchTransfer:!0,fetchTransfers:!1,fetchWithdrawal:!0,fetchWithdrawals:!0,fetchWithdrawalWhitelist:!1,reduceMargin:!0,repayMargin:!0,setLeverage:!0,setMargin:!1,setMarginMode:!0,setPositionMode:!0,signIn:!1,transfer:!0,withdraw:!0},timeframes:{"1m":"1m","3m":"3m","5m":"5m","15m":"15m","30m":"30m","1h":"1H","2h":"2H","4h":"4H","6h":"6H","12h":"12H","1d":"1D","1w":"1W","1M":"1M","3M":"3M"},hostname:"www.okx.com",urls:{logo:"https://user-images.githubusercontent.com/1294454/152485636-38b19e4a-bece-4dec-979a-5982859ffc04.jpg",api:{rest:"https://{hostname}"},www:"https://www.okx.com",doc:"https://www.okx.com/docs-v5/en/",fees:"https://www.okx.com/pages/products/fees.html",referral:"https://www.okx.com/join/1888677",test:{rest:"https://{hostname}"}},api:{public:{get:{"market/tickers":1,"market/ticker":1,"market/index-tickers":1,"market/books":1,"market/books-lite":1.66,"market/candles":.5,"market/history-candles":1,"market/history-mark-price-candles":2,"market/history-index-candles":2,"market/index-candles":1,"market/mark-price-candles":1,"market/trades":1,"market/platform-24-volume":10,"market/open-oracle":40,"market/index-components":1,"market/option/instrument-family-trades":1,"public/instruments":1,"public/delivery-exercise-history":.5,"public/open-interest":1,"public/funding-rate":1,"public/funding-rate-history":1,"public/price-limit":1,"public/opt-summary":1,"public/estimated-price":2,"public/discount-rate-interest-free-quota":10,"public/time":2,"public/liquidation-orders":.5,"public/mark-price":2,"public/option-trades":1,"public/position-tiers":2,"public/underlying":1,"public/interest-rate-loan-quota":10,"public/vip-interest-rate-loan-quota":10,"rubik/stat/trading-data/support-coin":4,"rubik/stat/taker-volume":4,"rubik/stat/margin/loan-ratio":4,"rubik/stat/contracts/long-short-account-ratio":4,"rubik/stat/contracts/open-interest-volume":4,"rubik/stat/option/open-interest-volume":4,"rubik/stat/option/open-interest-volume-ratio":4,"rubik/stat/option/open-interest-volume-expiry":4,"rubik/stat/option/open-interest-volume-strike":4,"rubik/stat/option/taker-block-volume":4,"system/status":100,"asset/lending-rate-summary":5/3,"asset/lending-rate-history":5/3,"market/exchange-rate":20}},private:{get:{"account/account-position-risk":2,"account/balance":2,"account/positions":2,"account/bills":5/3,"account/bills-archive":5/3,"account/config":4,"account/max-size":1,"account/max-avail-size":1,"account/leverage-info":1,"account/max-loan":1,"account/trade-fee":4,"account/interest-accrued":4,"account/interest-rate":4,"account/max-withdrawal":1,"account/risk-state":2,"account/borrow-repay-history":4,"account/quick-margin-borrow-repay-history":4,"account/interest-limits":4,"account/vip-interest-accrued":4,"account/vip-loan-order-list":4,"account/vip-loan-order-detail":4,"asset/asset-valuation":.2,"asset/deposit-address":5/3,"asset/balances":5/3,"asset/transfer-state":10,"asset/deposit-history":5/3,"asset/withdrawal-history":5/3,"asset/deposit-withdraw-status":20,"asset/currencies":5/3,"asset/bills":5/3,"asset/piggy-balance":5/3,"asset/deposit-lightning":5,"asset/lending-history":5/3,"asset/saving-balance":5/3,"asset/non-tradable-assets":5/3,"trade/order":1/3,"trade/orders-pending":1,"trade/orders-history":.5,"trade/orders-history-archive":1,"trade/fills":1/3,"trade/fills-history":2,"trade/orders-algo-pending":1,"trade/orders-algo-history":1,"account/subaccount/balances":10,"asset/subaccount/bills":5/3,"users/subaccount/list":10,"users/subaccount/apikey":10,"users/entrust-subaccount-list":10,"broker/nd/info":10,"broker/nd/subaccount-info":10,"asset/broker/nd/subaccount-deposit-address":4,"asset/broker/nd/subaccount-deposit-history":4,"broker/nd/rebate-daily":1,"broker/nd/subaccount/apikey":10,"broker/nd/rebate-per-orders":300,"asset/broker/nd/subaccount-withdrawal-history":4,"asset/convert/currencies":5/3,"asset/convert/currency-pair":5/3,"asset/convert/estimate-quote":5,"asset/convert/trade":5,"asset/convert/history":5/3,"account/greeks":2,"finance/staking-defi/offers":1,"finance/staking-defi/orders-active":1,"finance/staking-defi/orders-history":1,"rfq/counterparties":4,"rfq/maker-instrument-settings":4,"rfq/rfqs":10,"rfq/quotes":10,"rfq/trades":4,"rfq/public-trades":4,"copytrading/current-subpositions":10,"copytrading/subpositions-history":10,"copytrading/instruments":10,"copytrading/profit-sharing-details":10,"copytrading/total-profit-sharing":10,"copytrading/unrealized-profit-sharing-details":10,"tradingBot/grid/orders-algo-pending":1,"tradingBot/grid/orders-algo-history":1,"tradingBot/grid/orders-algo-details":1,"tradingBot/grid/sub-orders":1,"tradingBot/grid/positions":1,"tradingBot/grid/ai-param":1},post:{"account/set-position-mode":4,"account/set-leverage":1,"account/position/margin-balance":1,"account/set-greeks":4,"account/set-isolated-mode":4,"account/set-riskOffset-type":2,"account/simulated_margin":10,"account/borrow-repay":5/3,"account/quick-margin-borrow-repay":4,"account/activate-option":4,"asset/transfer":10,"asset/withdrawal":5/3,"asset/purchase_redempt":5/3,"asset/withdrawal-lightning":5,"asset/set-lending-rate":5/3,"asset/cancel-withdrawal":5/3,"asset/convert-dust-assets":10,"trade/order":1/3,"trade/batch-orders":1/15,"trade/cancel-order":1/3,"trade/cancel-batch-orders":1/15,"trade/amend-order":1/3,"trade/amend-batch-orders":1/3,"trade/close-position":1,"trade/order-algo":1,"trade/cancel-algos":1,"trade/cancel-advance-algos":1,"users/subaccount/delete-apikey":10,"users/subaccount/modify-apikey":10,"users/subaccount/apikey":10,"users/subaccount/set-transfer-out":10,"asset/subaccount/transfer":10,"broker/nd/create-subaccount":10,"broker/nd/delete-subaccount":10,"broker/nd/set-subaccount-level":4,"broker/nd/set-subaccount-fee-rate":4,"asset/broker/nd/subaccount-deposit-address":4,"broker/nd/subaccount/apikey":10,"broker/nd/subaccount/delete-apikey":10,"broker/nd/subaccount/modify-apikey":10,"broker/nd/rebate-per-orders":36e3,"finance/staking-defi/purchase":3,"finance/staking-defi/redeem":3,"finance/staking-defi/cancel":3,"rfq/create-rfq":4,"rfq/cancel-rfq":4,"rfq/cancel-batch-rfqs":10,"rfq/cancel-all-rfqs":10,"rfq/execute-quote":10,"rfq/maker-instrument-settings":4,"rfq/mmp-reset":4,"rfq/create-quote":.4,"rfq/cancel-quote":.4,"rfq/cancel-batch-quotes":10,"rfq/cancel-all-quotes":10,"copytrading/algo-order":20,"copytrading/close-subposition":10,"copytrading/set-instruments":10,"tradingBot/grid/order-algo":1,"tradingBot/grid/amend-order-algo":1,"tradingBot/grid/stop-order-algo":1,"tradingBot/grid/withdraw-income":1,"tradingBot/grid/compute-margin-balance":1,"tradingBot/grid/margin-balance":1}}},fees:{trading:{taker:this.parseNumber("0.0015"),maker:this.parseNumber("0.0010")},spot:{taker:this.parseNumber("0.0015"),maker:this.parseNumber("0.0010")},future:{taker:this.parseNumber("0.0005"),maker:this.parseNumber("0.0002")},swap:{taker:this.parseNumber("0.00050"),maker:this.parseNumber("0.00020")}},requiredCredentials:{apiKey:!0,secret:!0,password:!0},exceptions:{exact:{1:r,2:r,5e4:h,50001:n,50002:h,50004:y,50005:a,50006:h,50007:d,50008:g,50009:d,50010:r,50011:v,50012:r,50013:a,50014:h,50015:r,50016:r,50017:r,50018:r,50019:r,50020:r,50021:r,50022:r,50023:r,50024:h,50025:r,50026:a,50027:l,50028:r,50044:h,50100:r,50101:g,50102:f,50103:g,50104:g,50105:g,50106:g,50107:g,50108:r,50109:r,50110:l,50111:g,50112:g,50113:g,50114:g,50115:h,51e3:h,51001:b,51002:b,51003:h,51004:p,51005:p,51006:p,51007:p,51008:u,51009:d,51010:T,51011:p,51012:b,51014:b,51015:b,51016:p,51017:r,51018:r,51019:r,51020:p,51021:b,51022:b,51023:r,51024:d,51025:r,51026:b,51027:b,51028:b,51029:b,51030:b,51031:p,51100:p,51101:p,51102:p,51103:p,51104:p,51105:p,51106:p,51107:p,51108:p,51109:p,51110:p,51111:h,51112:p,51113:v,51115:p,51116:p,51117:p,51118:p,51119:u,51120:p,51121:p,51122:p,51124:p,51125:p,51126:p,51127:u,51128:p,51129:p,51130:b,51131:u,51132:p,51133:p,51134:p,51135:p,51136:p,51137:p,51138:p,51139:p,51156:h,51159:h,51162:p,51163:p,51166:p,51201:p,51202:p,51203:p,51204:p,51205:p,51250:p,51251:p,51252:p,51253:p,51254:p,51255:p,51256:p,51257:p,51258:p,51259:p,51260:p,51261:p,51262:p,51263:p,51264:p,51265:p,51267:p,51268:p,51269:p,51270:p,51271:p,51272:p,51273:p,51274:p,51275:p,51276:p,51277:p,51278:p,51279:p,51280:p,51321:p,51322:p,51323:h,51324:h,51325:p,51327:p,51328:p,51329:p,51330:p,51400:m,51401:m,51402:m,51403:p,51404:p,51405:r,51406:r,51407:h,51408:r,51409:r,51410:S,51500:r,51501:r,51502:u,51503:r,51506:r,51508:r,51509:r,51510:r,51511:r,51600:r,51601:r,51602:r,51603:m,51732:g,51733:g,51734:g,51735:r,51736:u,52e3:r,54e3:r,54001:r,58e3:r,58001:g,58002:l,58003:r,58004:d,58005:r,58006:r,58007:r,58100:r,58101:d,58102:v,58103:r,58104:r,58105:r,58106:r,58107:r,58108:r,58109:r,58110:r,58111:r,58112:r,58114:r,58115:r,58116:r,58117:r,58125:h,58126:h,58200:r,58201:r,58202:r,58203:c,58204:d,58205:r,58206:r,58207:c,58208:r,58209:r,58210:r,58211:r,58212:r,58213:g,58221:h,58222:h,58224:h,58227:h,58228:h,58229:u,58300:r,58350:u,59e3:r,59001:r,59100:r,59101:r,59102:r,59103:u,59104:r,59105:r,59106:r,59107:r,59108:u,59109:r,59128:p,59200:u,59201:u,59216:h,59300:r,59301:r,59313:r,59401:r,59500:r,59501:r,59502:r,59503:r,59504:r,59505:r,59506:r,59507:r,59508:d,60001:g,60002:g,60003:g,60004:g,60005:g,60006:f,60007:g,60008:g,60009:g,60010:g,60011:g,60012:h,60013:h,60014:v,60015:w,60016:a,60017:h,60018:h,60019:h,63999:r,70010:h,70013:h,70016:h},broad:{"Internal Server Error":a,"server error":a}},httpExceptions:{429:a},precisionMode:_,options:{defaultNetwork:"ERC20",networks:{BTC:"Bitcoin",OMNI:"Omni",SOL:"Solana",LTC:"Litecoin",MATIC:"Polygon",OP:"Optimism",ARB:"Arbitrum one",AVAX:"Avalanche C-Chain"},networksById:{Bitcoin:"BTC",Omni:"OMNI",Solana:"SOL",Litecoin:"LTC",Polygon:"MATIC",Optimism:"OP","Arbitrum one":"ARB","Avalanche C-Chain":"AVAX"},fetchOpenInterestHistory:{timeframes:{"5m":"5m","1h":"1H","1d":"1D","5M":"5m","1H":"1H","1D":"1D"}},fetchOHLCV:{timezone:"UTC"},createOrder:"privatePostTradeBatchOrders",createMarketBuyOrderRequiresPrice:!1,fetchMarkets:["spot","future","swap","option"],defaultType:"spot",fetchLedger:{method:"privateGetAccountBills"},fetchOrder:{method:"privateGetTradeOrder"},fetchOpenOrders:{method:"privateGetTradeOrdersPending"},cancelOrders:{method:"privatePostTradeCancelBatchOrders"},fetchCanceledOrders:{method:"privateGetTradeOrdersHistory"},fetchClosedOrders:{method:"privateGetTradeOrdersHistory"},algoOrderTypes:{conditional:!0,trigger:!0,oco:!0,move_order_stop:!0,iceberg:!0,twap:!0},accountsByType:{spot:"1",future:"3",futures:"3",margin:"5",funding:"6",swap:"9",option:"12",trading:"18"},accountsById:{1:"spot",3:"future",5:"margin",6:"funding",9:"swap",12:"option",18:"trading"},exchangeType:{spot:"SPOT",margin:"MARGIN",swap:"SWAP",future:"FUTURES",futures:"FUTURES",option:"OPTION",SPOT:"SPOT",MARGIN:"MARGIN",SWAP:"SWAP",FUTURES:"FUTURES",OPTION:"OPTION"},brokerId:"e847386590ce4dBC"},commonCurrencies:{AE:"AET",BOX:"DefiBox",HOT:"Hydro Protocol",HSR:"HC",MAG:"Maggie",SBTC:"Super Bitcoin",TRADE:"Unitrade",YOYO:"YOYOW",WIN:"WinToken"}})}handleMarketTypeAndParams(e,t,i={}){const s=this.safeString(i,"instType");i=this.omit(i,"instType");return void 0===this.safeString(i,"type")&&void 0!==s&&(i.type=s),super.handleMarketTypeAndParams(e,t,i)}convertToInstrumentType(e){const t=this.safeValue(this.options,"exchangeType",{});return this.safeString(t,e,e)}async fetchStatus(e={}){const t=await this.publicGetSystemStatus(e),i=this.safeValue(t,"data",[]),s={updated:void 0,status:0===i.length?"ok":"maintenance",eta:void 0,url:void 0,info:t};for(let e=0;e<i.length;e++){const t=i[e];"ongoing"===this.safeString(t,"state")&&(s.eta=this.safeInteger(t,"end"),s.status="maintenance")}return s}async fetchTime(e={}){const t=await this.publicGetPublicTime(e),i=this.safeValue(t,"data",[]),s=this.safeValue(i,0,{});return this.safeInteger(s,"ts")}async fetchAccounts(e={}){const t=await this.privateGetAccountConfig(e),i=this.safeValue(t,"data",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"uid"),a=this.safeString(t,"acctLv");s.push({id:r,type:a,currency:void 0,info:t})}return s}async fetchMarkets(e={}){const t=this.safeValue(this.options,"fetchMarkets");let i=[],s=[];for(let s=0;s<t.length;s++)i.push(this.fetchMarketsByType(t[s],e));i=await Promise.all(i);for(let e=0;e<i.length;e++)s=this.arrayConcat(s,i[e]);return s}parseMarkets(e){const t=[];for(let i=0;i<e.length;i++)t.push(this.parseMarket(e[i]));return t}parseMarket(e){const t=this.safeString(e,"instId");let i=this.safeStringLower(e,"instType");"futures"===i&&(i="future");const s="spot"===i,r="future"===i,a="swap"===i,n="option"===i,o=a||r||n;let h=this.safeString(e,"baseCcy"),d=this.safeString(e,"quoteCcy");const c=this.safeString(e,"settleCcy"),l=this.safeCurrencyCode(c),u=this.safeString(e,"uly");if(void 0!==u&&!s){const e=u.split("-");h=this.safeString(e,0),d=this.safeString(e,1)}const f=this.safeCurrencyCode(h),p=this.safeCurrencyCode(d);let m,g,y,b=f+"/"+p;if(o)if(b=b+":"+l,m=this.safeInteger(e,"expTime"),r){b=b+"-"+this.yymmdd(m)}else if(n){g=this.safeString(e,"stk"),y=this.safeString(e,"optType");b=b+"-"+this.yymmdd(m)+"-"+g+"-"+y,y="P"===y?"put":"call"}const v=this.safeString(e,"tickSz"),w=this.safeString(e,"minSz"),S=this.parseNumber(w),k=this.safeValue2(this.fees,i,"trading",{}),T=this.parseNumber(v);let _=this.safeString(e,"lever","1");return _=O.stringMax(_,"1"),this.extend(k,{id:t,symbol:b,base:f,quote:p,settle:l,baseId:h,quoteId:d,settleId:c,type:i,spot:s,margin:s&&O.stringGt(_,"1"),swap:a,future:r,option:n,active:!0,contract:o,linear:o?d===c:void 0,inverse:o?h===c:void 0,contractSize:o?this.safeNumber(e,"ctVal"):void 0,expiry:m,expiryDatetime:this.iso8601(m),strike:g,optionType:y,precision:{amount:this.safeNumber(e,"lotSz"),price:T},limits:{leverage:{min:this.parseNumber("1"),max:this.parseNumber(_)},amount:{min:S,max:void 0},price:{min:T,max:void 0},cost:{min:void 0,max:void 0}},info:e})}async fetchMarketsByType(e,t={}){const i={instType:this.convertToInstrumentType(e)};if("option"===e){const e=this.safeValue(this.options,"defaultUnderlying","BTC-USD"),s=this.safeString2(t,"uly","marketId",e);if(void 0===s)throw new o(this.id+" fetchMarketsByType() requires an underlying uly or marketId parameter for options markets");i.uly=s}const s=await this.publicGetPublicInstruments(this.extend(i,t)),r=this.safeValue(s,"data",[]);return this.parseMarkets(r)}safeNetwork(e){return this.safeString({Bitcoin:"BTC",Omni:"OMNI",TRON:"TRC20"},e,e)}async fetchCurrencies(e={}){if(!this.checkRequiredCredentials(!1))return;const t=await this.privateGetAssetCurrencies(e),i=this.safeValue(t,"data",[]),s={},r=this.groupBy(i,"ccy"),a=Object.keys(r);for(let e=0;e<a.length;e++){const t=a[e],i=this.safeCurrency(t).code,n=r[t],o={};let h,d,c,l=!1;for(let e=0;e<n.length;e++){const t=n[e],i=this.safeValue(t,"canDep"),s=this.safeValue(t,"canWd"),r=this.safeValue(t,"canInternal"),a=!!(i&&s&&r);l=void 0===l?a:l;const u=this.safeString(t,"chain");if(i&&!h?h=!0:i||(h=!1),s&&!d?d=!0:s||(d=!1),void 0!==u&&u.indexOf("-")>=0){const e=u.split("-"),r=this.safeString(e,1,u),n=this.safeNetwork(r),h=this.parsePrecision(this.safeString(t,"wdTickSz"));c=void 0===c?h:O.stringMin(c,h),o[n]={id:u,network:n,active:a,deposit:i,withdraw:s,fee:this.safeNumber(t,"minFee"),precision:this.parseNumber(h),limits:{withdraw:{min:this.safeNumber(t,"minWd"),max:this.safeNumber(t,"maxWd")}},info:t}}}const u=this.safeValue(n,0);s[i]={info:void 0,code:i,id:t,name:this.safeString(u,"name"),active:l,deposit:h,withdraw:d,fee:void 0,precision:this.parseNumber(c),limits:{amount:{min:void 0,max:void 0}},networks:o}}return s}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={instId:this.market(e).id};void 0!==(t=void 0===t?20:t)&&(s.sz=t);const r=await this.publicGetMarketBooks(this.extend(s,i)),a=this.safeValue(r,"data",[]),n=this.safeValue(a,0,{}),o=this.safeInteger(n,"ts");return this.parseOrderBook(n,e,o)}parseTicker(e,t){const i=this.safeInteger(e,"ts"),s=this.safeString(e,"instId"),r=(t=this.safeMarket(s,t,"-")).symbol,a=this.safeString(e,"last"),n=this.safeString(e,"open24h"),o=this.safeValue(t,"spot",!1)?this.safeString(e,"volCcy24h"):void 0,h=this.safeString(e,"vol24h"),d=this.safeString(e,"high24h"),c=this.safeString(e,"low24h");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:d,low:c,bid:this.safeString(e,"bidPx"),bidVolume:this.safeString(e,"bidSz"),ask:this.safeString(e,"askPx"),askVolume:this.safeString(e,"askSz"),vwap:void 0,open:n,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:h,quoteVolume:o,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={instId:i.id},r=await this.publicGetMarketTicker(this.extend(s,t)),a=this.safeValue(r,"data",[]),n=this.safeValue(a,0,{});return this.parseTicker(n,i)}async fetchTickersByType(e,t,i={}){await this.loadMarkets();const s={instType:this.convertToInstrumentType(e)};if("option"===e){const e=this.safeValue(this.options,"defaultUnderlying","BTC-USD"),t=this.safeString2(i,"uly","marketId",e);if(void 0===t)throw new o(this.id+" fetchTickersByType() requires an underlying uly or marketId parameter for options markets");s.uly=t}const r=await this.publicGetMarketTickers(this.extend(s,i)),a=this.safeValue(r,"data",[]);return this.parseTickers(a,t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=this.safeString(e,0);let s;void 0!==i&&(s=this.market(i));const[r,a]=this.handleMarketTypeAndParams("fetchTickers",s,t);return await this.fetchTickersByType(r,e,a)}parseTrade(e,t){const i=this.safeString(e,"tradeId"),s=this.safeString(e,"instId"),r=(t=this.safeMarket(s,t,"-")).symbol,a=this.safeInteger(e,"ts"),n=this.safeString2(e,"fillPx","px"),o=this.safeString2(e,"fillSz","sz"),h=this.safeString(e,"side"),d=this.safeString(e,"ordId"),c=this.safeString(e,"fee");let l;if(void 0!==c){const t=O.stringNeg(c),i=this.safeString(e,"feeCcy");l={cost:t,currency:this.safeCurrencyCode(i)}}let u=this.safeString(e,"execType");return"T"===u?u="taker":"M"===u&&(u="maker"),this.safeTrade({info:e,timestamp:a,datetime:this.iso8601(a),symbol:r,id:i,order:d,type:void 0,takerOrMaker:u,side:h,price:n,amount:o,cost:void 0,fee:l},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={instId:r.id};void 0!==i&&(a.limit=i);const n=await this.publicGetMarketTrades(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}parseOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.safeString(r,"price");r=this.omit(r,"price");const o=this.safeValue(this.options,"fetchOHLCV",{}),h=this.safeString(o,"timezone","UTC");void 0===s&&(s=100);const d=this.parseTimeframe(t);let c=this.safeString(this.timeframes,t,t);"UTC"===h&&d>=21600&&(c+=h.toLowerCase());const l={instId:a.id,bar:c,limit:s};let u="Candles";if(void 0!==i){this.milliseconds()-i>1440*d*1e3&&(u="HistoryCandles");const e=1e3*d,t=Math.max(i-1,0);l.before=t,l.after=this.sum(t,e*s)}const f=this.safeInteger(r,"until");void 0!==f&&(l.after=f,r=this.omit(r,"until")),u=this.safeString(o,"type",u);const p=this.safeString(r,"type",u);r=this.omit(r,"type");let m="publicGetMarket"+p;const g="HistoryCandles"===p;"mark"===n?m=g?"publicGetMarketHistoryMarkPriceCandles":"publicGetMarketMarkPriceCandles":"index"===n&&(m=g?"publicGetMarketHistoryIndexCandles":"publicGetMarketIndexCandles");const y=await this[m](this.extend(l,r)),b=this.safeValue(y,"data",[]);return this.parseOHLCVs(b,a,t,i,s)}async fetchFundingRateHistory(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchFundingRateHistory() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={instId:r.id};void 0!==t&&(a.before=Math.max(t-1,0)),void 0!==i&&(a.limit=i);const n=await this.publicGetPublicFundingRateHistory(this.extend(a,s)),h=[],d=this.safeValue(n,"data",[]);for(let e=0;e<d.length;e++){const t=d[e],i=this.safeNumber(t,"fundingTime");h.push({info:t,symbol:this.safeSymbol(this.safeString(t,"instId")),fundingRate:this.safeNumber(t,"realizedRate"),timestamp:i,datetime:this.iso8601(i)})}const c=this.sortBy(h,"timestamp");return this.filterBySymbolSinceLimit(c,r.symbol,t,i)}parseBalanceByType(e,t){return"funding"===e?this.parseFundingBalance(t):this.parseTradingBalance(t)}parseTradingBalance(e){const t={info:e},i=this.safeValue(e,"data",[]),s=this.safeValue(i,0,{}),r=this.safeInteger(s,"uTime"),a=this.safeValue(s,"details",[]);for(let e=0;e<a.length;e++){const i=a[e],s=this.safeString(i,"ccy"),r=this.safeCurrencyCode(s),n=this.account(),o=this.safeString(i,"eq"),h=this.safeString(i,"availEq");void 0===o||void 0===h?(n.free=this.safeString(i,"availBal"),n.used=this.safeString(i,"frozenBal")):(n.total=o,n.free=h),t[r]=n}return t.timestamp=r,t.datetime=this.iso8601(r),this.safeBalance(t)}parseFundingBalance(e){const t={info:e},i=this.safeValue(e,"data",[]);for(let e=0;e<i.length;e++){const s=i[e],r=this.safeString(s,"ccy"),a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(s,"bal"),n.free=this.safeString(s,"availBal"),n.used=this.safeString(s,"frozenBal"),t[a]=n}return this.safeBalance(t)}parseTradingFee(e,t){return{info:e,symbol:this.safeSymbol(void 0,t),maker:this.parseNumber(O.stringNeg(this.safeString2(e,"maker","makerU"))),taker:this.parseNumber(O.stringNeg(this.safeString2(e,"taker","takerU")))}}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={instType:this.convertToInstrumentType(i.type)};if(i.spot)s.instId=i.id;else{if(!(i.swap||i.future||i.option))throw new k(this.id+" fetchTradingFee() supports spot, swap, future or option markets only");s.uly=i.baseId+"-"+i.quoteId}const r=await this.privateGetAccountTradeFee(this.extend(s,t)),a=this.safeValue(r,"data",[]),n=this.safeValue(a,0,{});return this.parseTradingFee(n,i)}async fetchBalance(e={}){await this.loadMarkets();const[t,i]=this.handleMarketTypeAndParams("fetchBalance",void 0,e);let s;s="funding"===t?"privateGetAssetBalances":"privateGetAccountBalance";const r=await this[s](this.extend({},i));return this.parseBalanceByType(t,r)}async createOrder(e,t,i,s,a,n={}){await this.loadMarkets();const o=this.market(e),h={instId:o.id,side:i,ordType:t,sz:this.amountToPrecision(e,s)},d=o.spot,c=o.contract,l=this.safeValueN(n,["triggerPrice","stopPrice","triggerPx"]),u=this.safeString(n,"timeInForce","GTC"),f=this.safeValue2(n,"takeProfitPrice","tpTriggerPx"),m=this.safeValue(n,"tpOrdPx",a),g=this.safeString(n,"tpTriggerPxType","last"),y=this.safeValue2(n,"stopLossPrice","slTriggerPx"),b=this.safeValue(n,"slOrdPx",a),v=this.safeString(n,"slTriggerPxType","last"),w=this.safeString2(n,"clOrdId","clientOrderId"),S=this.safeString2(this.options,"defaultMarginMode","marginMode","cross");let k=this.safeString2(n,"marginMode","tdMode"),T=!1;if(void 0!==k&&"cash"!==k?T=!0:(k=S,T=this.safeValue(n,"margin",!1)),d){if(T){const e="buy"===i?o.quote:o.base,t=this.safeString(n,"ccy",e);h.ccy=this.safeCurrencyCode(t)}const e=T?k:"cash";h.tdMode=e}else c&&(h.tdMode=k);const _="market"===t,M=this.isPostOnly(_,"post_only"===t,n);n=this.omit(n,["currency","ccy","marginMode","timeInForce","stopPrice","triggerPrice","clientOrderId","stopLossPrice","takeProfitPrice","slOrdPx","tpOrdPx","margin"]);const I="IOC"===u||"ioc"===t,x="FOK"===u||"fok"===t,C=void 0!==l||"trigger"===t,P=void 0!==y||void 0!==f||"conditional"===t,A=_&&I||"optimal_limit_ioc"===t,N=this.safeString(this.options,"createOrder","privatePostTradeBatchOrders"),B=this.safeString(this.options,"tgtCcy","base_ccy"),E=this.safeString(n,"tgtCcy",B);c||T||(h.tgtCcy=E);let V,L=N;if(_||A){if(h.ordType="market",d&&"buy"===i&&"quote_ccy"===E){let t=this.safeNumber2(n,"cost","sz");if(this.safeValue(this.options,"createMarketBuyOrderRequiresPrice",!0)){if(void 0!==a){if(void 0===t){const e=this.numberToString(s),i=this.numberToString(a),r=O.stringMul(e,i);t=this.parseNumber(r)}}else if(void 0===t)throw new p(this.id+" createOrder() requires the price argument with market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount, or, alternatively, add .options['createMarketBuyOrderRequiresPrice'] = false and supply the total cost value in the 'amount' argument or in the 'cost' unified extra parameter or in exchange-specific 'sz' extra parameter (the exchange-specific behaviour)")}else t=void 0===t?s:t;h.sz=this.costToPrecision(e,t),n=this.omit(n,["cost","sz"])}A&&c&&(h.ordType="optimal_limit_ioc")}else C||P||(h.px=this.priceToPrecision(e,a));if(M)L=N,h.ordType="post_only";else if(I&&!A)L=N,h.ordType="ioc";else if(x)L=N,h.ordType="fok";else if(C)L="privatePostTradeOrderAlgo",h.ordType="trigger",h.triggerPx=this.priceToPrecision(e,l),h.orderPx=_?"-1":this.priceToPrecision(e,a);else if(P){L="privatePostTradeOrderAlgo",h.ordType="conditional";void 0!==f&&void 0!==y&&(h.ordType="oco"),void 0!==f&&(h.tpTriggerPx=this.priceToPrecision(e,f),h.tpOrdPx=void 0===m?"-1":this.priceToPrecision(e,m),h.tpTriggerPxType=g),void 0!==y&&(h.slTriggerPx=this.priceToPrecision(e,y),h.slOrdPx=void 0===b?"-1":this.priceToPrecision(e,b),h.slTriggerPxType=v)}if("oco"!==t&&"move_order_stop"!==t&&"iceberg"!==t&&"twap"!==t||(L="privatePostTradeOrderAlgo"),void 0===w){const e=this.safeString(this.options,"brokerId");void 0!==e&&(h.clOrdId=e+this.uuid16(),h.tag=e)}else h.clOrdId=w,n=this.omit(n,["clOrdId","clientOrderId"]);if("privatePostTradeOrder"===L||"privatePostTradeOrderAlgo"===L)V=this.extend(h,n);else{if("privatePostTradeBatchOrders"!==L)throw new r(this.id+' createOrder() this.options["createOrder"] must be either privatePostTradeBatchOrders or privatePostTradeOrder');V=[this.extend(h,n)]}const R=await this[L](V),D=this.safeValue(R,"data",[]),F=this.safeValue(D,0),q=this.parseOrder(F,o);return this.extend(q,{type:t,side:i})}async cancelOrder(e,t,i={}){if(this.safeValue(i,"stop")){const s=await this.cancelOrders([e],t,i);return this.safeValue(s,0)}if(void 0===t)throw new o(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={instId:s.id},a=this.safeString2(i,"clOrdId","clientOrderId");void 0!==a?r.clOrdId=a:r.ordId=e;const n=this.omit(i,["clOrdId","clientOrderId"]),h=await this.privatePostTradeCancelOrder(this.extend(r,n)),d=this.safeValue(h,"data",[]),c=this.safeValue(d,0);return this.parseOrder(c,s)}parseIds(e){return"string"==typeof e?e.split(","):e}async cancelOrders(e,t,i={}){if(void 0===t)throw new o(this.id+" cancelOrders() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r=[],a=this.safeValue(this.options,"cancelOrders",{}),n=this.safeString(a,"method","privatePostTradeCancelBatchOrders");let h=this.safeString(i,"method",n);const d=this.parseIds(this.safeValue2(i,"clOrdId","clientOrderId")),c=this.parseIds(this.safeValue(i,"algoId")),l=this.safeValue(i,"stop");if(l&&(h="privatePostTradeCancelAlgos"),void 0===d){if(e=this.parseIds(e),void 0!==c)for(let e=0;e<c.length;e++)r.push({algoId:c[e],instId:s.id});for(let t=0;t<e.length;t++)l?r.push({algoId:e[t],instId:s.id}):r.push({ordId:e[t],instId:s.id})}else for(let e=0;e<d.length;e++)r.push({instId:s.id,clOrdId:d[e]});const u=await this[h](r),f=this.safeValue(u,"data",[]);return this.parseOrders(f,s,void 0,void 0,i)}parseOrderStatus(e){return this.safeString({canceled:"canceled",live:"open",partially_filled:"open",filled:"closed",effective:"closed"},e,e)}parseOrder(e,t){const i=this.safeString2(e,"algoId","ordId"),s=this.safeInteger(e,"cTime"),r=this.safeInteger(e,"fillTime"),a=this.safeString(e,"side");let n,o,h=this.safeString(e,"ordType");"post_only"===h?(n=!0,h="limit"):"fok"===h?(o="FOK",h="limit"):"ioc"===h&&(o="IOC",h="limit");const d=this.safeString(e,"instId"),c=this.safeSymbol(d,t,"-"),l=this.safeString(e,"accFillSz"),u=this.safeString2(e,"px","ordPx"),f=this.safeString(e,"avgPx"),p=this.parseOrderStatus(this.safeString(e,"state")),m=this.safeString(e,"fee");let g,y;const b=this.safeString(this.options,"tgtCcy","base_ccy"),v=this.safeString(e,"tgtCcy",b),w=this.safeString(e,"instType");let S;if("buy"===a&&"market"===h&&"SPOT"===w&&"quote_ccy"===v?y=this.safeString(e,"sz"):g=this.safeString(e,"sz"),void 0!==m){const t=O.stringNeg(m),i=this.safeString(e,"feeCcy"),s=this.safeCurrencyCode(i);S={cost:this.parseNumber(t),currency:s}}let k=this.safeString(e,"clOrdId");void 0!==k&&k.length<1&&(k=void 0);const T=this.safeNumberN(e,["tpTriggerPx","triggerPx","slTriggerPx"]);let _=this.safeString(e,"reduceOnly");return void 0!==_&&(_="true"===_),this.safeOrder({info:e,id:i,clientOrderId:k,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:r,symbol:c,type:h,timeInForce:o,postOnly:n,side:a,price:u,stopPrice:T,triggerPrice:T,average:f,cost:y,amount:g,filled:l,remaining:void 0,status:p,fee:S,trades:void 0,reduceOnly:_},t)}async fetchOrder(e,t,i={}){if(void 0===t)throw new o(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={instId:s.id},a=this.safeString2(i,"clOrdId","clientOrderId"),n=this.safeValue(this.options,"fetchOrder",{}),h=this.safeString(n,"method","privateGetTradeOrder"),d=this.safeString(i,"method",h);if(this.safeValue(i,"stop"))throw new k(this.id+" fetchOrder() does not support stop orders, use fetchOpenOrders() fetchCanceledOrders() or fetchClosedOrders()");void 0!==a?r.clOrdId=a:r.ordId=e;const c=this.omit(i,["method","clOrdId","clientOrderId"]),l=await this[d](this.extend(r,c)),u=this.safeValue(l,"data",[]),f=this.safeValue(u,0);return this.parseOrder(f,s)}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.instId=a.id),void 0!==i&&(r.limit=i);const n=this.safeValue(this.options,"fetchOpenOrders",{}),h=this.safeValue(this.options,"algoOrderTypes",{}),d=this.safeString(n,"method","privateGetTradeOrdersPending");let c=this.safeString(s,"method",d);const l=this.safeString(s,"ordType"),u=this.safeValue(s,"stop");if((u||l in h)&&(c="privateGetTradeOrdersAlgoPending",u&&void 0===l))throw new o(this.id+' fetchOpenOrders() requires an "ordType" string parameter, "conditional", "oco", "trigger", "move_order_stop", "iceberg", or "twap"');const f=this.omit(s,["method","stop"]),p=await this[c](this.extend(r,f)),m=this.safeValue(p,"data",[]);return this.parseOrders(m,a,t,i)}async fetchCanceledOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a,n,h;void 0!==e&&(a=this.market(e),r.instId=a.id),[n,h]=this.handleMarketTypeAndParams("fetchCanceledOrders",a,s),r.instType=this.convertToInstrumentType(n),void 0!==i&&(r.limit=i),r.state="canceled";const d=this.safeValue(this.options,"fetchCanceledOrders",{}),c=this.safeValue(this.options,"algoOrderTypes",{}),l=this.safeString(d,"method","privateGetTradeOrdersHistory");let u=this.safeString(s,"method",l);const f=this.safeString(s,"ordType"),p=this.safeValue(s,"stop");if(p||f in c){u="privateGetTradeOrdersAlgoHistory";const e=this.safeString(s,"algoId");if(void 0!==e&&(r.algoId=e,s=this.omit(s,"algoId")),p){if(void 0===f)throw new o(this.id+' fetchCanceledOrders() requires an "ordType" string parameter, "conditional", "oco", "trigger", "move_order_stop", "iceberg", or "twap"');r.ordType=f}}else{void 0!==t&&(r.begin=t);const e=this.safeInteger2(h,"till","until");void 0!==e&&(r.end=e,h=this.omit(h,["until","till"]))}const m=this.omit(h,["method","stop","ordType"]),g=await this[u](this.extend(r,m)),y=this.safeValue(g,"data",[]);return this.parseOrders(y,a,t,i)}async fetchClosedOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a,n,h;void 0!==e&&(a=this.market(e),r.instId=a.id),[n,h]=this.handleMarketTypeAndParams("fetchClosedOrders",a,s),r.instType=this.convertToInstrumentType(n),void 0!==i&&(r.limit=i);const d=this.safeValue(this.options,"fetchClosedOrders",{}),c=this.safeValue(this.options,"algoOrderTypes",{}),l=this.safeString(d,"method","privateGetTradeOrdersHistory");let u=this.safeString(s,"method",l);const f=this.safeString(s,"ordType"),p=this.safeValue(s,"stop");if(p||f in c){if(u="privateGetTradeOrdersAlgoHistory",p&&void 0===f)throw new o(this.id+' fetchClosedOrders() requires an "ordType" string parameter, "conditional", "oco", "trigger", "move_order_stop", "iceberg", or "twap"');r.state="effective"}else{void 0!==t&&(r.begin=t);const e=this.safeInteger2(h,"till","until");void 0!==e&&(r.end=e,h=this.omit(h,["until","till"])),r.state="filled"}const m=this.omit(h,["method","stop"]),g=await this[u](this.extend(r,m)),y=this.safeValue(g,"data",[]);return this.parseOrders(y,a,t,i)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.instId=a.id);const[n,o]=this.handleMarketTypeAndParams("fetchMyTrades",a,s);r.instType=this.convertToInstrumentType(n),void 0!==i&&(r.limit=i);const h=await this.privateGetTradeFillsHistory(this.extend(r,o)),d=this.safeValue(h,"data",[]);return this.parseTrades(d,a,t,i,o)}async fetchOrderTrades(e,t,i,s,r={}){const a={ordId:e};return await this.fetchMyTrades(t,i,s,this.extend(a,r))}async fetchLedger(e,t,i,s={}){await this.loadMarkets();const r=this.safeValue(this.options,"fetchLedger",{});let a=this.safeString(r,"method");a=this.safeString(s,"method",a),s=this.omit(s,"method");const n={};let o;[o,s]=this.handleMarginModeAndParams("fetchLedger",s),void 0===o&&(o=this.safeString(s,"mgnMode")),"privateGetAssetBills"!==a&&void 0!==o&&(n.mgnMode=o);const[h,d]=this.handleMarketTypeAndParams("fetchLedger",void 0,s);let c;void 0!==h&&(n.instType=this.convertToInstrumentType(h)),void 0!==i&&(n.limit=i),void 0!==e&&(c=this.currency(e),n.ccy=c.id);const l=await this[a](this.extend(n,d)),u=this.safeValue(l,"data",[]);return this.parseLedger(u,c,t,i)}parseLedgerEntryType(e){return this.safeString({1:"transfer",2:"trade",3:"trade",4:"rebate",5:"trade",6:"transfer",7:"trade",8:"fee",9:"trade",10:"trade",11:"trade"},e,e)}parseLedgerEntry(e,t){const i=this.safeString(e,"billId"),s=this.safeString(e,"ordId"),r=this.parseLedgerEntryType(this.safeString(e,"type")),a=this.safeCurrencyCode(this.safeString(e,"ccy"),t),n=this.safeString(e,"balChg"),o=this.parseNumber(n),h=this.safeInteger(e,"ts"),d=this.safeString(e,"fee");let c;void 0!==d&&(c={cost:this.parseNumber(O.stringNeg(d)),currency:a});const l=this.safeString(e,"bal"),u=this.parseNumber(l),f=this.safeString(e,"instId"),p=this.safeSymbol(f,void 0,"-");return{id:i,info:e,timestamp:h,datetime:this.iso8601(h),account:undefined,referenceId:s,referenceAccount:undefined,type:r,currency:a,symbol:p,amount:o,before:undefined,after:u,status:"ok",fee:c}}parseDepositAddress(e,t){const i=this.safeString(e,"addr");let s=this.safeString2(e,"tag","pmtId");s=this.safeString(e,"memo",s);const r=this.safeString(e,"ccy"),a=(t=this.safeCurrency(r,t)).code,n=this.safeString(e,"chain"),o=this.safeValue(t,"networks",{}),h=this.indexBy(o,"id");let d=this.safeValue(h,n);"USDT-Polygon"===n&&(d=this.safeValue(h,"USDT-Polygon-Bridge"));const c=this.safeString(d,"network");return this.checkAddress(i),{currency:a,address:i,tag:s,network:c,info:e}}async fetchDepositAddressesByNetwork(e,t={}){await this.loadMarkets();const i={ccy:this.currency(e).id},s=await this.privateGetAssetDepositAddress(this.extend(i,t)),r=this.safeValue(s,"data",[]),a=this.filterBy(r,"selected",!0),n=this.parseDepositAddresses(a,[e],!1);return this.indexBy(n,"network")}async fetchDepositAddress(e,t={}){const i=this.safeStringUpper(t,"network"),s=this.safeValue(this.options,"networks",{}),r=this.safeString(s,i,i);t=this.omit(t,"network");const a=await this.fetchDepositAddressesByNetwork(e,t);let n;if(void 0===r){if(n=this.safeValue(a,e),void 0===n){const t=this.safeString(s,e,e);if(n=this.safeValue(a,t),void 0===n){const t=this.safeString(this.options,"defaultNetwork","ERC20");if(n=this.safeValue(a,t),void 0===n){const t=Object.values(a);if(n=this.safeValue(t,0),void 0===n)throw new c(this.id+" fetchDepositAddress() cannot find deposit address for "+e)}}}return n}if(n=this.safeValue(a,r),void 0===n)throw new c(this.id+" fetchDepositAddress() cannot find "+r+" deposit address for "+e);return n}async withdraw(e,t,i,s,a={}){[s,a]=this.handleWithdrawTagAndParams(s,a),this.checkAddress(i),await this.loadMarkets();const n=this.currency(e);void 0!==s&&s.length>0&&(i=i+":"+s);const h=this.safeString(a,"fee");if(void 0===h)throw new o(this.id+" withdraw() requires a 'fee' string parameter, network transaction fee must be ≥ 0. Withdrawals to OKCoin or OKX are fee-free, please set '0'. Withdrawing to external digital asset address requires network transaction fee.");const d={ccy:n.id,toAddr:i,dest:"4",amt:this.numberToString(t),fee:this.numberToString(h)};"password"in a?d.pwd=a.password:"pwd"in a&&(d.pwd=a.pwd);const c=this.safeValue(this.options,"networks",{});let l=this.safeStringUpper(a,"network");l=this.safeString(c,l,l),void 0!==l&&(d.chain=n.id+"-"+l,a=this.omit(a,"network"));const u=this.omit(a,["fee","password","pwd"]);if(!("pwd"in d))throw new r(this.id+" withdraw() requires a password parameter or a pwd parameter, it must be the funding password, not the API passphrase");const f=await this.privatePostAssetWithdrawal(this.extend(d,u)),p=this.safeValue(f,"data",[]),m=this.safeValue(p,0);return this.parseTransaction(m,n)}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.ccy=a.id),void 0!==t&&(r.before=Math.max(t-1,0)),void 0!==i&&(r.limit=i);const n=await this.privateGetAssetDepositHistory(this.extend(r,s)),o=this.safeValue(n,"data",[]);return this.parseTransactions(o,a,t,i,s)}async fetchDeposit(e,t,i={}){await this.loadMarkets();const s={depId:e};let r;void 0!==t&&(r=this.currency(t),s.ccy=r.id);const a=await this.privateGetAssetDepositHistory(this.extend(s,i)),n=this.safeValue(a,"data"),o=this.safeValue(n,0,{});return this.parseTransaction(o,r)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.ccy=a.id),void 0!==t&&(r.before=Math.max(t-1,0)),void 0!==i&&(r.limit=i);const n=await this.privateGetAssetWithdrawalHistory(this.extend(r,s)),o=this.safeValue(n,"data",[]);return this.parseTransactions(o,a,t,i,s)}async fetchWithdrawal(e,t,i={}){await this.loadMarkets();const s={wdId:e};let r;void 0!==t&&(r=this.currency(t),s.ccy=r.id);const a=await this.privateGetAssetWithdrawalHistory(this.extend(s,i)),n=this.safeValue(a,"data"),o=this.safeValue(n,0,{});return this.parseTransaction(o)}parseTransactionStatus(e){return this.safeString({"-3":"pending","-2":"canceled","-1":"failed",0:"pending",1:"pending",2:"ok",3:"pending",4:"pending",5:"pending"},e,e)}parseTransaction(e,t){let i,s;const r=this.safeString(e,"wdId"),a=this.safeString(e,"from"),n=this.safeString(e,"to"),o=n;let h=this.safeString2(e,"tag","memo");h=this.safeString2(e,"pmtId",h),void 0!==r?(i="withdrawal",s=r):(s=this.safeString(e,"depId"),i="deposit");const d=this.safeString(e,"ccy"),c=this.safeCurrencyCode(d),l=this.safeNumber(e,"amt"),u=this.parseTransactionStatus(this.safeString(e,"state")),f=this.safeString(e,"txId"),p=this.safeInteger(e,"ts");let m;return m="deposit"===i?0:this.safeNumber(e,"fee"),{info:e,id:s,currency:c,amount:l,network:void 0,addressFrom:a,addressTo:n,address:o,tagFrom:void 0,tagTo:h,tag:h,status:u,type:i,updated:void 0,txid:f,timestamp:p,datetime:this.iso8601(p),fee:{currency:c,cost:m}}}async fetchLeverage(e,t={}){let i;if(await this.loadMarkets(),[i,t]=this.handleMarginModeAndParams("fetchLeverage",t),void 0===i&&(i=this.safeString(t,"mgnMode","cross")),"cross"!==i&&"isolated"!==i)throw new h(this.id+" fetchLeverage() requires a marginMode parameter that must be either cross or isolated");const s={instId:this.market(e).id,mgnMode:i};return await this.privateGetAccountLeverageInfo(this.extend(s,t))}async fetchPosition(e,t={}){await this.loadMarkets();const i=this.market(e),[s,r]=this.handleMarketTypeAndParams("fetchPosition",i,t),a={instId:i.id};void 0!==s&&(a.instType=this.convertToInstrumentType(s));const n=await this.privateGetAccountPositions(this.extend(a,r)),o=this.safeValue(n,"data",[]),h=this.safeValue(o,0);return void 0===h?h:this.parsePosition(h)}async fetchPositions(e,t={}){await this.loadMarkets();const i={};if(void 0!==e){const t=[];for(let i=0;i<e.length;i++){const s=e[i],r=this.market(s);t.push(r.id)}t.length>0&&(i.instId=t.join(","))}const s=await this.privateGetAccountPositions(this.extend(i,t)),r=this.safeValue(s,"data",[]),a=[];for(let e=0;e<r.length;e++)a.push(this.parsePosition(r[e]));return this.filterByArray(a,"symbol",e,!1)}parsePosition(e,t){const i=this.safeString(e,"instId"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeString(e,"pos"),a=O.stringAbs(r);let n=this.safeString(e,"posSide");const o="net"!==n,h=this.parseNumber(a);if(t.margin){if("net"===n){const i=this.safeString(e,"posCcy"),s=this.safeCurrencyCode(i);void 0!==s&&(n=t.base===s?"long":"short")}}else void 0!==r&&"net"===n&&(n=O.stringGt(r,"0")?"long":O.stringLt(r,"0")?"short":void 0);const d=this.safeNumber(t,"contractSize"),c=this.numberToString(d),l=this.safeString(e,"markPx");let u=this.safeString(e,"notionalUsd");t.inverse&&(u=O.stringDiv(O.stringMul(a,c),l));const f=this.parseNumber(u),p=this.safeString(e,"mgnMode");let m;const g=this.safeString(e,"avgPx"),y=this.safeString(e,"upl"),b=this.safeString(e,"lever");let v,w;"cross"===p?(m=this.safeString(e,"imr"),w=O.stringAdd(m,y)):"isolated"===p&&(v=O.stringDiv("1",b),w=this.safeString(e,"margin"));const S=this.safeString(e,"mmr"),k=this.parseNumber(S);let T=O.stringDiv(S,u);void 0===v?v=this.parseNumber(O.stringDiv(m,u,4)):void 0===m&&(m=O.stringMul(v,u));T=this.parseNumber(O.stringDiv(O.stringAdd(T,"0.00005"),"1",4));const _=this.safeNumber(e,"liqPx"),M=this.safeString(e,"uplRatio"),I=this.parseNumber(O.stringMul(M,"100")),x=this.safeInteger(e,"uTime"),C=this.parseNumber(O.stringDiv(S,w,4));return{info:e,id:void 0,symbol:s,notional:f,marginMode:p,liquidationPrice:_,entryPrice:this.parseNumber(g),unrealizedPnl:this.parseNumber(y),percentage:I,contracts:h,contractSize:d,markPrice:this.parseNumber(l),side:n,hedged:o,timestamp:x,datetime:this.iso8601(x),maintenanceMargin:k,maintenanceMarginPercentage:T,collateral:this.parseNumber(w),initialMargin:this.parseNumber(m),initialMarginPercentage:this.parseNumber(v),leverage:this.parseNumber(b),marginRatio:C}}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n=this.safeValue(this.options,"accountsByType",{}),o=this.safeString(n,i,i),h=this.safeString(n,s,s),d={ccy:a.id,amt:this.currencyToPrecision(e,t),type:"0",from:o,to:h};"master"===o?(d.type="1",d.subAcct=h,d.from=this.safeString(r,"from","6"),d.to=this.safeString(r,"to","6")):"master"===h&&(d.type="2",d.subAcct=o,d.from=this.safeString(r,"from","6"),d.to=this.safeString(r,"to","6"));const c=await this.privatePostAssetTransfer(this.extend(d,r)),l=this.safeValue(c,"data",[]),u=this.safeValue(l,0,{});return this.parseTransfer(u,a)}parseTransfer(e,t){const i=this.safeString(e,"transId"),s=this.safeString(e,"ccy"),r=this.safeCurrencyCode(s,t),a=this.safeNumber(e,"amt"),n=this.safeString(e,"from"),o=this.safeString(e,"to"),h=this.safeValue(this.options,"accountsById",{}),d=this.safeString(h,n),c=this.safeString(h,o),l=this.milliseconds(),u=this.safeString(e,"state");return{info:e,id:i,timestamp:l,datetime:this.iso8601(l),currency:r,amount:a,fromAccount:d,toAccount:c,status:u}}async fetchTransfer(e,t,i={}){await this.loadMarkets();const s={transId:e},r=await this.privateGetAssetTransferState(this.extend(s,i)),a=this.safeValue(r,"data",[]),n=this.safeValue(a,0);return this.parseTransfer(n)}sign(e,t="public",i="GET",s={},r,a){const n=Array.isArray(s),o="/api/"+this.version+"/"+this.implodeParams(e,s),h=this.omit(s,this.extractParams(e));let d=this.implodeHostname(this.urls.api.rest)+o;if("public"===t)Object.keys(h).length&&(d+="?"+this.urlencode(h));else if("private"===t){this.checkRequiredCredentials();const e=this.iso8601(this.milliseconds());r={"OK-ACCESS-KEY":this.apiKey,"OK-ACCESS-PASSPHRASE":this.password,"OK-ACCESS-TIMESTAMP":e};let t=e+i+o;if("GET"===i){if(Object.keys(h).length){const e="?"+this.urlencode(h);d+=e,t+=e}}else(n||Object.keys(h).length)&&(t+=a=this.json(h)),r["Content-Type"]="application/json";const s=this.hmac(this.encode(t),this.encode(this.secret),"sha256","base64");r["OK-ACCESS-SIGN"]=s}return{url:d,method:i,body:a,headers:r}}parseFundingRate(e,t){const i=this.safeInteger(e,"nextFundingTime"),s=this.safeString(e,"instId"),r=this.safeSymbol(s,t),a=this.safeNumber(e,"nextFundingRate"),n=this.safeInteger(e,"fundingTime");return{info:e,symbol:r,markPrice:void 0,indexPrice:void 0,interestRate:this.parseNumber("0"),estimatedSettlePrice:void 0,timestamp:void 0,datetime:void 0,fundingRate:this.safeNumber(e,"fundingRate"),fundingTimestamp:n,fundingDatetime:this.iso8601(n),nextFundingRate:a,nextFundingTimestamp:i,nextFundingDatetime:this.iso8601(i),previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.swap)throw new r(this.id+" fetchFundingRate() is only valid for swap markets");const s={instId:i.id},a=await this.publicGetPublicFundingRate(this.extend(s,t)),n=this.safeValue(a,"data",[]),o=this.safeValue(n,0,{});return this.parseFundingRate(o,i)}async fetchFundingHistory(e,t,i,s={}){await this.loadMarkets();const r={type:"8"};let a;void 0!==i&&(r.limit=i.toString()),void 0!==e&&(a=this.market(e),e=a.symbol,a.contract&&(a.linear?(r.ctType="linear",r.ccy=a.quoteId):(r.ctType="inverse",r.ccy=a.baseId)));const[n,o]=this.handleMarketTypeAndParams("fetchFundingHistory",a,s);"swap"===n&&(r.instType=this.convertToInstrumentType(n));const h=await this.privateGetAccountBillsArchive(this.extend(r,o)),d=this.safeValue(h,"data",[]),c=[];for(let e=0;e<d.length;e++){const t=d[e],i=this.safeInteger(t,"ts"),s=this.safeString(t,"instId"),r=this.safeMarket(s),a=this.safeString(t,"ccy"),n=this.safeCurrencyCode(a);c.push({info:t,symbol:r.symbol,code:n,timestamp:i,datetime:this.iso8601(i),id:this.safeString(t,"billId"),amount:this.safeNumber(t,"balChg")})}const l=this.sortBy(c,"timestamp");return this.filterBySymbolSinceLimit(l,e,t,i)}async setLeverage(e,t,i={}){if(void 0===t)throw new o(this.id+" setLeverage() requires a symbol argument");if(e<1||e>125)throw new h(this.id+" setLeverage() leverage should be between 1 and 125");await this.loadMarkets();const s=this.market(t);let r;if([r,i]=this.handleMarginModeAndParams("setLeverage",i),void 0===r&&(r=this.safeString(i,"mgnMode","cross")),"cross"!==r&&"isolated"!==r)throw new h(this.id+" setLeverage() requires a marginMode parameter that must be either cross or isolated");const a={lever:e,mgnMode:r,instId:s.id},n=this.safeString(i,"posSide");if("isolated"===r){if(void 0===n)throw new o(this.id+" setLeverage() requires a posSide argument for isolated margin");if("long"!==n&&"short"!==n&&"net"!==n)throw new h(this.id+' setLeverage() requires the posSide argument to be either "long", "short" or "net"')}return await this.privatePostAccountSetLeverage(this.extend(a,i))}async setPositionMode(e,t,i={}){let s;s=e?"long_short_mode":"net_mode";const r={posMode:s};return await this.privatePostAccountSetPositionMode(this.extend(r,i))}async setMarginMode(e,t,i={}){if(void 0===t)throw new o(this.id+" setMarginMode() requires a symbol argument");if("cross"!==(e=e.toLowerCase())&&"isolated"!==e)throw new h(this.id+" setMarginMode() marginMode must be either cross or isolated");await this.loadMarkets();const s=this.market(t),r=this.safeInteger(i,"lever");if(void 0===r||r<1||r>125)throw new h(this.id+' setMarginMode() params["lever"] should be between 1 and 125');i=this.omit(i,["lever"]);const a={lever:r,mgnMode:e,instId:s.id};return await this.privatePostAccountSetLeverage(this.extend(a,i))}async fetchBorrowRates(e={}){await this.loadMarkets();const t=await this.privateGetAccountInterestRate(e),i=this.milliseconds(),s=this.safeValue(t,"data"),r={};for(let e=0;e<s.length;e++){const t=s[e],a=this.safeCurrencyCode(this.safeString(t,"ccy"));r[a]={currency:a,rate:this.safeNumber(t,"interestRate"),period:864e5,timestamp:i,datetime:this.iso8601(i),info:t}}return r}async fetchBorrowRate(e,t={}){await this.loadMarkets();const i={ccy:this.currency(e).id},s=await this.privateGetAccountInterestRate(this.extend(i,t)),r=this.safeValue(s,"data"),a=this.safeValue(r,0);return this.parseBorrowRate(a)}parseBorrowRate(e,t){const i=this.safeString(e,"ccy"),s=this.safeInteger(e,"ts");return{currency:this.safeCurrencyCode(i),rate:this.safeNumber2(e,"interestRate","rate"),period:864e5,timestamp:s,datetime:this.iso8601(s),info:e}}parseBorrowRateHistories(e,t,i,s){const r={};for(let i=0;i<e.length;i++){const s=e[i],a=this.safeCurrencyCode(this.safeString(s,"ccy"));if(void 0===t||this.inArray(a,t)){a in r||(r[a]=[]);const e=this.parseBorrowRate(s);r[a].push(e)}}const a=Object.keys(r);for(let e=0;e<a.length;e++){const t=a[e];r[t]=this.filterByCurrencySinceLimit(r[t],t,i,s)}return r}parseBorrowRateHistory(e,t,i,s){const r=[];for(let t=0;t<e.length;t++){const i=e[t],s=this.parseBorrowRate(i);r.push(s)}const a=this.sortBy(r,"timestamp");return this.filterByCurrencySinceLimit(a,t,i,s)}async fetchBorrowRateHistories(e,t,i,s={}){await this.loadMarkets();const r={};void 0!==t&&(r.before=t),void 0!==i&&(r.limit=i);const a=await this.publicGetAssetLendingRateHistory(this.extend(r,s)),n=this.safeValue(a,"data");return this.parseBorrowRateHistories(n,e,t,i)}async fetchBorrowRateHistory(e,t,i,s={}){await this.loadMarkets();const r={ccy:this.currency(e).id};void 0!==t&&(r.before=t),void 0!==i&&(r.limit=i);const a=await this.publicGetAssetLendingRateHistory(this.extend(r,s)),n=this.safeValue(a,"data");return this.parseBorrowRateHistory(n,e,t,i)}async modifyMarginHelper(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a=this.safeString(s,"posSide","net");s=this.omit(s,["posSide"]);const n={instId:r.id,amt:t,type:i,posSide:a},o=await this.privatePostAccountPositionMarginBalance(this.extend(n,s));return this.parseMarginModification(o,r)}parseMarginModification(e,t){const i=this.safeValue(e,"data",[]),s=this.safeValue(i,0,{}),r="0"===this.safeString(e,"code")?"ok":"failed",a=this.safeNumber(s,"amt"),n="reduce"===this.safeString(s,"type")?"reduce":"add",o=this.safeString(s,"instId"),h=this.safeMarket(o,t);return{info:e,type:n,amount:a,code:h.inverse?h.base:h.quote,symbol:h.symbol,status:r}}async reduceMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,"reduce",i)}async addMargin(e,t,i={}){return await this.modifyMarginHelper(e,t,"add",i)}async fetchMarketLeverageTiers(e,t={}){await this.loadMarkets();const i=this.market(e),s=i.spot?"MARGIN":this.convertToInstrumentType(i.type),r=this.safeString(i.info,"uly");if(!r&&"MARGIN"!==s)throw new h(this.id+" fetchMarketLeverageTiers() cannot fetch leverage tiers for "+e);let a;[a,t]=this.handleMarginModeAndParams("fetchMarketLeverageTiers",t),void 0===a&&(a=this.safeString(t,"tdMode","cross"));const n={instType:s,tdMode:a,uly:r};"MARGIN"===s&&(n.instId=i.id);const o=await this.publicGetPublicPositionTiers(this.extend(n,t)),d=this.safeValue(o,"data");return this.parseMarketLeverageTiers(d,i)}parseMarketLeverageTiers(e,t){const i=[];for(let s=0;s<e.length;s++){const r=e[s];i.push({tier:this.safeInteger(r,"tier"),currency:t.quote,minNotional:this.safeNumber(r,"minSz"),maxNotional:this.safeNumber(r,"maxSz"),maintenanceMarginRate:this.safeNumber(r,"mmr"),maxLeverage:this.safeNumber(r,"maxLever"),info:r})}return i}async fetchBorrowInterest(e,t,i,s,r={}){let a;await this.loadMarkets(),[a,r]=this.handleMarginModeAndParams("fetchBorrowInterest",r),void 0===a&&(a=this.safeString(r,"mgnMode","cross"));const n={mgnMode:a};let o;if(void 0!==e){const t=this.currency(e);n.ccy=t.id}void 0!==i&&(n.before=i-1),void 0!==s&&(n.limit=s),void 0!==t&&(o=this.market(t),n.instId=o.id);const h=await this.privateGetAccountInterestAccrued(this.extend(n,r)),d=this.safeValue(h,"data"),c=this.parseBorrowInterests(d);return this.filterByCurrencySinceLimit(c,e,i,s)}parseBorrowInterest(e,t){const i=this.safeString(e,"instId");void 0!==i&&(t=this.safeMarket(i,t));const s=this.safeInteger(e,"ts");return{symbol:this.safeString(t,"symbol"),marginMode:this.safeString(e,"mgnMode"),currency:this.safeCurrencyCode(this.safeString(e,"ccy")),interest:this.safeNumber(e,"interest"),interestRate:this.safeNumber(e,"interestRate"),amountBorrowed:this.safeNumber(e,"liab"),timestamp:s,datetime:this.iso8601(s),info:e}}async borrowMargin(e,t,i,s={}){await this.loadMarkets();const r=this.currency(e),a={ccy:r.id,amt:this.currencyToPrecision(e,t),side:"borrow"},n=await this.privatePostAccountBorrowRepay(this.extend(a,s)),o=this.safeValue(n,"data",[]),h=this.safeValue(o,0),d=this.parseMarginLoan(h,r);return this.extend(d,{symbol:i})}async repayMargin(e,t,i,s={}){await this.loadMarkets();const r=this.currency(e),a={ccy:r.id,amt:this.currencyToPrecision(e,t),side:"repay"},n=await this.privatePostAccountBorrowRepay(this.extend(a,s)),o=this.safeValue(n,"data",[]),h=this.safeValue(o,0),d=this.parseMarginLoan(h,r);return this.extend(d,{symbol:i})}parseMarginLoan(e,t){const i=this.safeString(e,"ccy");return{id:void 0,currency:this.safeCurrencyCode(i,t),amount:this.safeNumber(e,"amt"),symbol:void 0,timestamp:void 0,datetime:void 0,info:e}}async fetchOpenInterest(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.contract)throw new h(this.id+" fetchOpenInterest() supports contract markets only");const s={instType:this.convertToInstrumentType(i.type),uly:this.safeString(i.info,"uly"),instId:i.id},r=await this.publicGetPublicOpenInterest(this.extend(s,t)),a=this.safeValue(r,"data",[]);return this.parseOpenInterest(a[0],i)}async fetchOpenInterestHistory(e,t="5m",i,s,r={}){const a=this.safeValue(this.options,"fetchOpenInterestHistory",{}),n=this.safeValue(a,"timeframes",{});if("5m"!==(t=this.safeString(n,t,t))&&"1H"!==t&&"1D"!==t)throw new h(this.id+" fetchOpenInterestHistory cannot only use the 5m, 1h, and 1d timeframe");await this.loadMarkets();const o={ccy:this.currency(e).id,period:t};void 0!==i&&(o.begin=i);const d=this.safeInteger2(r,"till","until");void 0!==d&&(o.end=d,r=this.omit(r,["until","till"]));const c=await this.publicGetRubikStatContractsOpenInterestVolume(this.extend(o,r)),l=this.safeValue(c,"data");return this.parseOpenInterests(l,void 0,i,s)}parseOpenInterest(e,t){const i=this.safeString(e,"instId");t=this.safeMarket(i,t);const s=this.safeInteger(e,"ts"),r=this.safeNumber(e,0,s),a=this.safeNumber(e,"oi"),n=this.safeNumber(e,"oiCcy"),o=this.safeNumber(e,1,n);return{symbol:this.safeSymbol(i),baseVolume:void 0,quoteVolume:o,openInterestAmount:a,openInterestValue:o,timestamp:r,datetime:this.iso8601(r),info:e}}setSandboxMode(e){super.setSandboxMode(e),e?this.headers["x-simulated-trading"]="1":"x-simulated-trading"in this.headers&&(this.headers=this.omit(this.headers,"x-simulated-trading"))}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.privateGetAssetCurrencies(t),s=this.safeValue(i,"data");return this.parseDepositWithdrawFees(s,e)}parseDepositWithdrawFees(e,t,i){const s={};t=this.marketCodes(t);for(let i=0;i<e.length;i++){const r=e[i],a=this.safeString(r,"ccy"),n=this.safeCurrencyCode(a);if(void 0===t||this.inArray(n,t)){void 0===this.safeValue(s,n)&&(s[n]=this.depositWithdrawFee({})),s[n].info[a]=r;const e=this.safeString(r,"chain").split("-"),t=this.safeValue(e,1),i=this.safeNumber(r,"minFee"),o={fee:i,percentage:void 0===i&&void 0},h={fee:void 0,percentage:void 0},d=this.networkIdToCode(t,n);s[n].networks[d]={withdraw:o,deposit:h}}}const r=Object.keys(s);for(let e=0;e<r.length;e++){const t=r[e],i=this.currency(t);s[t]=this.assignDefaultDepositWithdrawFees(s[t],i)}return s}handleErrors(e,t,i,s,a,n,o,h,d){if(!o)return;const c=this.safeString(o,"code");if("0"!==c){const e=this.id+" "+n,t=this.safeValue(o,"data",[]);for(let i=0;i<t.length;i++){const s=t[i],r=this.safeString(s,"sCode"),a=this.safeString(s,"sMsg");this.throwExactlyMatchedException(this.exceptions.exact,r,e),this.throwBroadlyMatchedException(this.exceptions.broad,a,e)}throw this.throwExactlyMatchedException(this.exceptions.exact,c,e),new r(e)}}}},30757:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r}=i(73449),{TICK_SIZE:a}=i(62115),n=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"paymium",name:"Paymium",countries:["FR","EU"],rateLimit:2e3,version:"v1",has:{CORS:!0,spot:!0,margin:void 0,swap:!1,future:!1,option:!1,cancelOrder:!0,createDepositAddress:!0,createOrder:!0,fetchBalance:!0,fetchDepositAddress:!0,fetchDepositAddresses:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchMarkOHLCV:!1,fetchOpenInterestHistory:!1,fetchOrderBook:!0,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,transfer:!0},urls:{logo:"https://user-images.githubusercontent.com/51840849/87153930-f0f02200-c2c0-11ea-9c0a-40337375ae89.jpg",api:{rest:"https://paymium.com/api"},www:"https://www.paymium.com",fees:"https://www.paymium.com/page/help/fees",doc:["https://github.com/Paymium/api-documentation","https://www.paymium.com/page/developers","https://paymium.github.io/api-documentation/"],referral:"https://www.paymium.com/page/sign-up?referral=eDAzPoRQFMvaAB8sf-qj"},api:{public:{get:["countries","data/{currency}/ticker","data/{currency}/trades","data/{currency}/depth","bitcoin_charts/{id}/trades","bitcoin_charts/{id}/depth"]},private:{get:["user","user/addresses","user/addresses/{address}","user/orders","user/orders/{uuid}","user/price_alerts","merchant/get_payment/{uuid}"],post:["user/addresses","user/orders","user/withdrawals","user/email_transfers","user/payment_requests","user/price_alerts","merchant/create_payment"],delete:["user/orders/{uuid}","user/orders/{uuid}/cancel","user/price_alerts/{id}"]}},markets:{"BTC/EUR":{id:"eur",symbol:"BTC/EUR",base:"BTC",quote:"EUR",baseId:"btc",quoteId:"eur",type:"spot",spot:!0}},fees:{trading:{maker:this.parseNumber("-0.001"),taker:this.parseNumber("0.005")}},precisionMode:a})}parseBalance(e){const t={info:e},i=Object.keys(this.currencies);for(let s=0;s<i.length;s++){const r=i[s],a=this.currency(r).id,n="balance_"+a;if(n in e){const i=this.account(),s="locked_"+a;i.free=this.safeString(e,n),i.used=this.safeString(e,s),t[r]=i}}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetUser(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={currency:s.id},a=await this.publicGetDataCurrencyDepth(this.extend(r,i));return this.parseOrderBook(a,s.symbol,void 0,"bids","asks","price","amount")}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.safeTimestamp(e,"at"),r=this.safeString(e,"vwap"),a=this.safeString(e,"volume"),o=n.stringMul(a,r),h=this.safeString(e,"price");return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:r,open:this.safeString(e,"open"),close:h,last:h,previousClose:void 0,change:void 0,percentage:this.safeString(e,"variation"),average:void 0,baseVolume:a,quoteVolume:o,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={currency:i.id},r=await this.publicGetDataCurrencyTicker(this.extend(s,t));return this.parseTicker(r,i)}parseTrade(e,t){const i=this.safeTimestamp(e,"created_at_int"),s=this.safeString(e,"uuid");t=this.safeMarket(void 0,t);const r=this.safeString(e,"side"),a=this.safeString(e,"price"),n="traded_"+t.base.toLowerCase(),o=this.safeString(e,n);return this.safeTrade({info:e,id:s,order:void 0,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,type:void 0,side:r,takerOrMaker:void 0,price:a,amount:o,cost:void 0,fee:void 0},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={currency:r.id},n=await this.publicGetDataCurrencyTrades(this.extend(a,s));return this.parseTrades(n,r,t,i)}async createDepositAddress(e,t={}){await this.loadMarkets();const i=await this.privatePostUserAddresses(t);return this.parseDepositAddress(i)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={address:e},s=await this.privateGetUserAddressesAddress(this.extend(i,t));return this.parseDepositAddress(s)}async fetchDepositAddresses(e,t={}){await this.loadMarkets();const i=await this.privateGetUserAddresses(t);return this.parseDepositAddresses(i,e)}parseDepositAddress(e,t){const i=this.safeString(e,"address"),s=this.safeString(e,"currency");return{info:e,currency:this.safeCurrencyCode(s,t),address:i,tag:void 0,network:void 0}}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={type:this.capitalize(t)+"Order",currency:n.id,direction:i,amount:s};"market"!==t&&(o.price=r);const h=await this.privatePostUserOrders(this.extend(o,a));return{info:h,id:h.uuid}}async cancelOrder(e,t,i={}){const s={uuid:e};return await this.privateDeleteUserOrdersUuidCancel(this.extend(s,i))}async transfer(e,t,i,s,a={}){await this.loadMarkets();const n=this.currency(e);if(s.indexOf("@")<0)throw new r(this.id+" transfer() only allows transfers to an email address");if("BTC"!==e&&"EUR"!==e)throw new r(this.id+" transfer() only allows BTC or EUR");const o={currency:n.id,amount:this.currencyToPrecision(e,t),email:s},h=await this.privatePostUserEmailTransfers(this.extend(o,a));return this.parseTransfer(h,n)}parseTransfer(e,t){const i=this.safeString(e,"currency"),s=this.safeString(e,"updated_at"),r=this.parseDate(s),a=this.safeValue(e,"account_operations"),n=this.safeValue(a,0,{}),o=this.safeString(e,"state");return{info:e,id:this.safeString(e,"uuid"),timestamp:r,datetime:this.iso8601(r),currency:this.safeCurrencyCode(i,t),amount:this.safeNumber(e,"amount"),fromAccount:void 0,toAccount:this.safeString(n,"address"),status:this.parseTransferStatus(o)}}parseTransferStatus(e){return this.safeString({executed:"ok"},e,e)}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+this.version+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if("public"===t)Object.keys(o).length&&(n+="?"+this.urlencode(o));else{this.checkRequiredCredentials();const e=this.nonce().toString();let t=e+n;if(r={"Api-Key":this.apiKey,"Api-Nonce":e},"POST"===i)Object.keys(o).length&&(t+=a=this.json(o),r["Content-Type"]="application/json");else if(Object.keys(o).length){const e=this.urlencode(o);t+=e,n+="?"+e}r["Api-Signature"]=this.hmac(this.encode(t),this.encode(this.secret))}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;if(void 0!==this.safeValue(o,"errors"))throw new r(this.id+" "+this.json(o))}}},50788:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,BadSymbol:a,AuthenticationError:n,InsufficientFunds:o,InvalidOrder:h,ArgumentsRequired:d,OrderNotFound:c,BadRequest:l,PermissionDenied:u,AccountSuspended:f,CancelPending:p,DDoSProtection:m,DuplicateOrderId:g,RateLimitExceeded:y}=i(73449),{TICK_SIZE:b}=i(62115),v=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"phemex",name:"Phemex",countries:["CN"],rateLimit:100,version:"v1",certified:!1,pro:!0,hostname:"api.phemex.com",has:{CORS:void 0,spot:!0,margin:!1,swap:!0,future:!1,option:!1,addMargin:!1,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,editOrder:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchFundingHistory:!0,fetchFundingRate:!0,fetchFundingRateHistories:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!0,fetchMarketLeverageTiers:"emulated",fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPositions:!0,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransfers:!0,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!0,setMargin:!0,setMarginMode:!0,setPositionMode:!1,transfer:!0,withdraw:void 0},urls:{logo:"https://user-images.githubusercontent.com/1294454/85225056-221eb600-b3d7-11ea-930d-564d2690e3f6.jpg",test:{v1:"https://testnet-api.phemex.com/v1",public:"https://testnet-api.phemex.com/exchange/public",private:"https://testnet-api.phemex.com"},api:{v1:"https://{hostname}/v1",v2:"https://{hostname}",public:"https://{hostname}/exchange/public",private:"https://{hostname}"},www:"https://phemex.com",doc:"https://github.com/phemex/phemex-api-docs",fees:"https://phemex.com/fees-conditions",referral:{url:"https://phemex.com/register?referralCode=EDNVJ",discount:.1}},timeframes:{"1m":"60","3m":"180","5m":"300","15m":"900","30m":"1800","1h":"3600","2h":"7200","3h":"10800","4h":"14400","6h":"21600","12h":"43200","1d":"86400","1w":"604800","1M":"2592000","3M":"7776000","1Y":"31104000"},api:{public:{get:["cfg/v2/products","cfg/fundingRates","products","nomics/trades","md/kline","md/v2/kline/list","md/v2/kline/last"]},v1:{get:["md/orderbook","md/trade","md/ticker/24hr","md/ticker/24hr/all","md/spot/ticker/24hr","md/spot/ticker/24hr/all","exchange/public/products"]},v2:{get:["md/v2/orderbook","md/v2/trade","md/v2/ticker/24hr","md/v2/ticker/24hr/all"]},private:{get:["spot/orders/active","spot/orders","spot/wallets","exchange/spot/order","exchange/spot/order/trades","accounts/accountPositions","accounts/positions","api-data/futures/funding-fees","orders/activeList","exchange/order/list","exchange/order","exchange/order/trade","phemex-user/users/children","phemex-user/wallets/v2/depositAddress","phemex-user/wallets/tradeAccountDetail","phemex-user/order/closedPositionList","exchange/margins/transfer","exchange/wallets/confirm/withdraw","exchange/wallets/withdrawList","exchange/wallets/depositList","exchange/wallets/v2/depositAddress","api-data/spots/funds","assets/convert","assets/transfer","assets/spots/sub-accounts/transfer","assets/futures/sub-accounts/transfer","assets/quote","assets/convert"],post:["spot/orders","orders","positions/assign","exchange/wallets/transferOut","exchange/wallets/transferIn","exchange/margins","exchange/wallets/createWithdraw","exchange/wallets/cancelWithdraw","exchange/wallets/createWithdrawAddress","assets/transfer","assets/spots/sub-accounts/transfer","assets/futures/sub-accounts/transfer","assets/universal-transfer","assets/convert"],put:["spot/orders","orders/replace","positions/leverage","positions/riskLimit"],delete:["spot/orders","spot/orders/all","orders/cancel","orders","orders/all"]}},precisionMode:b,fees:{trading:{tierBased:!1,percentage:!0,taker:this.parseNumber("0.001"),maker:this.parseNumber("0.001")}},requiredCredentials:{apiKey:!0,secret:!0},exceptions:{exact:{412:l,6001:l,19999:l,10001:g,10002:c,10003:p,10004:p,10005:p,11001:o,11002:h,11003:o,11004:h,11005:o,11006:r,11007:r,11008:r,11009:r,11010:o,11011:h,11012:h,11013:h,11014:h,11015:h,11016:l,11017:r,11018:r,11019:r,11020:r,11021:r,11022:f,11023:r,11024:r,11025:l,11026:r,11027:a,11028:a,11029:r,11030:r,11031:m,11032:m,11033:g,11034:h,11035:h,11036:h,11037:h,11038:h,11039:h,11040:h,11041:h,11042:h,11043:h,11044:h,11045:h,11046:h,11047:h,11048:h,11049:h,11050:h,11051:h,11052:h,11053:h,11054:h,11055:h,11056:h,11057:h,11058:h,11059:h,11060:h,11061:p,11062:h,11063:h,11064:h,11065:h,11066:h,11067:h,11068:h,11069:r,11070:a,11071:h,11072:h,11073:h,11074:h,11075:h,11076:h,11077:h,11078:h,11079:h,11080:h,11081:h,11082:o,11083:h,11084:h,11085:g,11086:h,11087:h,11088:h,11089:h,11090:h,11091:h,11092:h,11093:h,11094:h,11095:h,11096:h,11097:l,11098:l,11099:r,11100:o,11101:o,11102:l,11103:l,11104:l,11105:o,11106:o,11107:r,11108:h,11109:h,11110:h,11111:h,11112:h,11113:l,11114:h,11115:h,11116:h,11117:h,11118:h,11119:h,11120:h,11121:h,11122:h,11123:h,11124:h,11125:h,11126:h,11128:h,11129:h,11130:h,11131:h,11132:h,11133:h,11134:h,3e4:l,30018:l,34003:u,35104:o,39995:y,39996:u},broad:{"401 Insufficient privilege":u,"401 Request IP mismatch":u,"Failed to find api-key":n,"Missing required parameter":l,"API Signature verification failed":n,"Api key not found":n}},options:{brokerId:"ccxt2022","x-phemex-request-expiry":60,createOrderByQuoteRequiresPrice:!0,networks:{TRC20:"TRX",ERC20:"ETH"},defaultNetworks:{USDT:"ETH"},defaultSubType:"linear",accountsByType:{spot:"spot",swap:"future"},transfer:{fillResponseFromRequest:!0}}})}parseSafeNumber(e){if(void 0===e)return e;let t=e.split(",");return e=t.join(""),t=e.split(" "),this.safeNumber(t,0)}parseSwapMarket(e){const t=this.safeString(e,"symbol"),i=this.safeString2(e,"baseCurrency","contractUnderlyingAssets"),s=this.safeString(e,"quoteCurrency"),r=this.safeString(e,"settleCurrency"),a=this.safeCurrencyCode(i),n=this.safeCurrencyCode(s),o=this.safeCurrencyCode(r);let h=!1;r!==s&&(h=!0);const d=this.safeInteger(e,"priceScale"),c=this.safeInteger(e,"ratioScale"),l=this.safeInteger(e,"valueScale"),u=this.safeString(e,"minPriceEp"),f=this.safeString(e,"maxPriceEp"),p=this.safeString(e,"makerFeeRateEr"),m=this.safeString(e,"takerFeeRateEr"),g=this.safeString(e,"status"),y=this.safeString(e,"contractSize"," ");let b;if(y.indexOf(" ")){const e=y.split(" ");b=this.parseNumber(e[0])}else b=this.parseNumber(y);return{id:t,symbol:a+"/"+n+":"+o,base:a,quote:n,settle:o,baseId:i,quoteId:s,settleId:r,type:"swap",spot:!1,margin:!1,swap:!0,future:!1,option:!1,active:"Listed"===g,contract:!0,linear:!h,inverse:h,taker:this.parseNumber(this.fromEn(m,c)),maker:this.parseNumber(this.fromEn(p,c)),contractSize:b,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,priceScale:d,valueScale:l,ratioScale:c,precision:{amount:this.safeNumber(e,"lotSize"),price:this.safeNumber(e,"tickSize")},limits:{leverage:{min:this.parseNumber("1"),max:this.safeNumber(e,"maxLeverage")},amount:{min:void 0,max:void 0},price:{min:this.parseNumber(this.fromEn(u,d)),max:this.parseNumber(this.fromEn(f,d))},cost:{min:void 0,max:this.parseNumber(this.safeString(e,"maxOrderQty"))}},info:e}}parseSpotMarket(e){const t=this.safeStringLower(e,"type"),i=this.safeString(e,"symbol"),s=this.safeString(e,"quoteCurrency"),r=this.safeString(e,"baseCurrency"),a=this.safeCurrencyCode(r),n=this.safeCurrencyCode(s),o=this.safeString(e,"status"),h=this.parseSafeNumber(this.safeString(e,"baseTickSize")),d=this.parseSafeNumber(this.safeString(e,"quoteTickSize"));return{id:i,symbol:a+"/"+n,base:a,quote:n,settle:void 0,baseId:r,quoteId:s,settleId:void 0,type:t,spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:"Listed"===o,contract:!1,linear:void 0,inverse:void 0,taker:this.safeNumber(e,"defaultTakerFee"),maker:this.safeNumber(e,"defaultMakerFee"),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,priceScale:8,valueScale:8,ratioScale:8,precision:{amount:h,price:d},limits:{leverage:{min:void 0,max:void 0},amount:{min:h,max:this.parseSafeNumber(this.safeString(e,"maxBaseOrderSize"))},price:{min:d,max:void 0},cost:{min:this.parseSafeNumber(this.safeString(e,"minOrderValue")),max:this.parseSafeNumber(this.safeString(e,"maxOrderValue"))}},info:e}}async fetchMarkets(e={}){const t=await this.publicGetCfgV2Products(e),i=await this.v1GetExchangePublicProducts(e),s=this.safeValue(i,"data",[]),r=this.safeValue(t,"data",{}),a=this.safeValue(r,"products",[]),n=this.safeValue(r,"riskLimits",[]),o=this.indexBy(n,"symbol"),h=this.indexBy(s,"symbol"),d=[];for(let e=0;e<a.length;e++){let t=a[e];const i=this.safeStringLower(t,"type");if("perpetual"===i||"perpetualv2"===i){const e=this.safeString(t,"symbol"),i=this.safeValue(o,e,{});t=this.extend(t,i);const s=this.safeValue(h,e,{});t=this.extend(t,s),t=this.parseSwapMarket(t)}else t=this.parseSpotMarket(t);d.push(t)}return d}async fetchCurrencies(e={}){const t=await this.publicGetCfgV2Products(e),i=this.safeValue(t,"data",{}),s=this.safeValue(i,"currencies",[]),r={};for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"currency"),a=this.safeString(t,"name"),n=this.safeCurrencyCode(i),o=this.safeString(t,"valueScale"),h=parseInt(o),d=this.safeString(t,"minValueEv"),c=this.safeString(t,"maxValueEv");let l,u,f;if(void 0!==h){const e=this.parsePrecision(o);f=this.parseNumber(e),l=this.parseNumber(v.stringMul(d,e)),u=this.parseNumber(v.stringMul(c,e))}r[n]={id:i,info:t,code:n,name:a,active:void 0,deposit:void 0,withdraw:void 0,fee:void 0,precision:f,limits:{amount:{min:l,max:u},withdraw:{min:void 0,max:void 0}},valueScale:h}}return r}parseBidAsk(e,t=0,i=1,s){if(void 0===s)throw new d(this.id+" parseBidAsk() requires a market argument");let r=this.safeString(e,i);return s.spot&&(r=this.fromEv(r,s)),[this.parseNumber(this.fromEp(this.safeString(e,t),s)),this.parseNumber(r)]}parseOrderBook(e,t,i,s="bids",r="asks",a=0,n=1,o){const h={symbol:t,timestamp:i,datetime:this.iso8601(i),nonce:void 0},d=[s,r];for(let t=0;t<d.length;t++){const i=d[t],s=[],r=this.safeValue(e,i);for(let e=0;e<r.length;e++)s.push(this.parseBidAsk(r[e],a,n,o));h[i]=s}return h[s]=this.sortBy(h[s],0,!0),h[r]=this.sortBy(h[r],0),h}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};let a="v1GetMdOrderbook";s.linear&&"USDT"===s.settle&&(a="v2GetMdV2Orderbook");const n=await this[a](this.extend(r,i)),o=this.safeValue(n,"result",{}),h=this.safeValue2(o,"book","orderbook_p",{}),d=this.safeIntegerProduct(o,"timestamp",1e-6),c=this.parseOrderBook(h,e,d,"bids","asks",0,1,s);return c.nonce=this.safeInteger(o,"sequence"),c}toEn(e,t){const i=e.toString(),s=new v(i);s.decimals=s.decimals-t,s.reduce();const r=s.toString();return parseInt(parseFloat(r))}toEv(e,t){return void 0===e||void 0===t?e:this.toEn(e,t.valueScale)}toEp(e,t){return void 0===e||void 0===t?e:this.toEn(e,t.priceScale)}fromEn(e,t){if(void 0===e)return;const i=new v(e);return i.decimals=this.sum(i.decimals,t),i.reduce(),i.toString()}fromEp(e,t){return void 0===e||void 0===t?e:this.fromEn(e,this.safeInteger(t,"priceScale"))}fromEv(e,t){return void 0===e||void 0===t?e:this.fromEn(e,this.safeInteger(t,"valueScale"))}fromEr(e,t){return void 0===e||void 0===t?e:this.fromEn(e,this.safeInteger(t,"ratioScale"))}parseOHLCV(e,t){let i;return i=void 0!==t&&t.spot?this.parseNumber(this.fromEv(this.safeString(e,7),t)):this.safeNumber(e,7),[this.safeTimestamp(e,0),this.parseNumber(this.fromEp(this.safeString(e,3),t)),this.parseNumber(this.fromEp(this.safeString(e,4),t)),this.parseNumber(this.fromEp(this.safeString(e,5),t)),this.parseNumber(this.fromEp(this.safeString(e,6),t)),i]}async fetchOHLCV(e,t="1m",i,s,r={}){const a={resolution:this.safeString(this.timeframes,t,t)},n=this.parseTimeframe(t),o=this.seconds(),h=[5,10,50,100,500,1e3];void 0===s&&(s=100),s=Math.min(s,1e3),void 0!==i?(i=parseInt(i/1e3),a.from=i,a.to=Math.min(o,this.sum(i,n*s))):(this.inArray(s,h)||(s=100),a.limit=s),await this.loadMarkets();const d=this.market(e);a.symbol=d.id;let c="publicGetMdKline";(d.linear||"USDT"===d.settle)&&(c="publicGetMdV2KlineLast");const l=await this[c](this.extend(a,r)),u=this.safeValue(l,"data",{}),f=this.safeValue(u,"rows",[]);return this.parseOHLCVs(f,d,t,i,s)}parseTicker(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeIntegerProduct(e,"timestamp",1e-6),a=this.fromEp(this.safeString2(e,"lastEp","closeRp"),t),n=this.fromEv(this.safeString2(e,"turnoverEv","turnoverRv"),t);let o=this.safeString(e,"volume");void 0===o&&(o=this.fromEv(this.safeString2(e,"volumeEv","volumeRq"),t));const h=this.fromEp(this.safeString(e,"openEp"),t);return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.fromEp(this.safeString2(e,"highEp","highRp"),t),low:this.fromEp(this.safeString2(e,"lowEp","lowRp"),t),bid:this.fromEp(this.safeString(e,"bidEp"),t),bidVolume:void 0,ask:this.fromEp(this.safeString(e,"askEp"),t),askVolume:void 0,vwap:void 0,open:h,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:o,quoteVolume:n,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id};let r="v1GetMdSpotTicker24hr";i.swap&&(r=i.inverse||"USD"===i.settle?"v1GetMdTicker24hr":"v2GetMdV2Ticker24hr");const a=await this[r](this.extend(s,t)),n=this.safeValue(a,"result",{});return this.parseTicker(n,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};let n="v1GetMdTrade";r.linear&&"USDT"===r.settle&&(n="v2GetMdV2Trade");const o=await this[n](this.extend(a,s)),h=this.safeValue(o,"result",{}),d=this.safeValue2(h,"trades","trades_p",[]);return this.parseTrades(d,r,t,i)}parseTrade(e,t){let i,s,r,a,n,o,h,d;const c=this.safeString(e,"symbol"),l=(t=this.safeMarket(c,t)).symbol;let u,f;if(Array.isArray(e)){const o=e.length;r=this.safeIntegerProduct(e,0,1e-6),o>4&&(a=this.safeString(e,o-4)),n=this.safeStringLower(e,o-3),i=this.safeString(e,o-2),s=this.safeString(e,o-1),"number"==typeof e[o-2]&&(i=this.fromEp(i,t),s=this.fromEv(s,t))}else{r=this.safeIntegerProduct(e,"transactTimeNs",1e-6),a=this.safeString2(e,"execId","execID"),u=this.safeString(e,"orderID"),n=this.safeStringLower(e,"side"),h=this.parseOrderType(this.safeString(e,"ordType"));"MakerFill"===this.safeString(e,"execStatus")&&(f="maker"),i=this.fromEp(this.safeString(e,"execPriceEp"),t),s=this.fromEv(this.safeString(e,"execBaseQtyEv"),t),s=this.safeString(e,"execQty",s),o=this.fromEv(this.safeString2(e,"execQuoteQtyEv","execValueEv"),t);const c=this.fromEv(this.safeString(e,"execFeeEv"),t);if(void 0!==c){const i=this.fromEr(this.safeString(e,"feeRateEr"),t);let s;if(t.spot)s="buy"===n?t.base:t.quote;else{const e=this.safeValue(t,"info");if(void 0!==e){const t=this.safeString(e,"settlementCurrency");s=this.safeCurrencyCode(t)}}d={cost:c,rate:i,currency:s}}}return this.safeTrade({info:e,id:a,symbol:l,timestamp:r,datetime:this.iso8601(r),order:u,type:h,side:n,takerOrMaker:f,price:i,amount:s,cost:o,fee:d},t)}parseSpotBalance(e){let t;const i={info:e},s=this.safeValue(e,"data",[]);for(let e=0;e<s.length;e++){const r=s[e],a=this.safeString(r,"currency"),n=this.safeCurrencyCode(a),o=this.safeValue(this.currencies,n,{}),h=this.safeInteger(o,"valueScale",8),d=this.account(),c=this.safeString(r,"balanceEv"),l=this.safeString(r,"lockedTradingBalanceEv"),u=this.safeString(r,"lockedWithdrawEv"),f=this.fromEn(c,h),p=this.fromEn(l,h),m=this.fromEn(u,h),g=v.stringAdd(p,m),y=this.safeIntegerProduct(r,"lastUpdateTimeNs",1e-6);t=void 0===t?y:Math.max(t,y),d.total=f,d.used=g,i[n]=d}return i.timestamp=t,i.datetime=this.iso8601(t),this.safeBalance(i)}parseSwapBalance(e){const t={info:e},i=this.safeValue(e,"data",{}),s=this.safeValue(i,"account",{}),r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.currency(a),o=this.account(),h=this.safeString(s,"accountBalanceEv"),d=this.safeString(s,"totalUsedBalanceEv"),c=this.safeInteger(n,"valueScale",8);return o.total=this.fromEn(h,c),o.used=this.fromEn(d,c),t[a]=o,this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=this.safeString2(this.options,"defaultType","fetchBalance","spot"),i=this.safeString(e,"type",t);let s="privateGetSpotWallets";const r={};if("swap"===i){const t=this.safeString(e,"code");if(void 0!==t){const i=this.currency(t);r.currency=i.id,e=this.omit(e,"code")}else{if(void 0===this.safeString(e,"currency"))throw new d(this.id+" fetchBalance() requires a code parameter or a currency parameter for "+i+" type")}s="privateGetAccountsAccountPositions"}e=this.omit(e,"type");const a=await this[s](this.extend(r,e));return"swap"===i?this.parseSwapBalance(a):this.parseSpotBalance(a)}parseOrderStatus(e){return this.safeString({Created:"open",Untriggered:"open",Deactivated:"closed",Triggered:"open",Rejected:"rejected",New:"open",PartiallyFilled:"open",Filled:"closed",Canceled:"canceled"},e,e)}parseOrderType(e){return this.safeString({Limit:"limit",Market:"market"},e,e)}parseTimeInForce(e){return this.safeString({GoodTillCancel:"GTC",PostOnly:"PO",ImmediateOrCancel:"IOC",FillOrKill:"FOK"},e,e)}parseSpotOrder(e,t){const i=this.safeString(e,"orderID");let s=this.safeString(e,"clOrdID");void 0!==s&&s.length<1&&(s=void 0);const r=this.safeString(e,"symbol"),a=this.safeSymbol(r,t),n=this.fromEp(this.safeString(e,"priceEp"),t),o=this.fromEv(this.safeString(e,"baseQtyEv"),t),h=this.omitZero(this.fromEv(this.safeString(e,"leavesBaseQtyEv"),t)),d=this.fromEv(this.safeString2(e,"cumBaseQtyEv","cumBaseValueEv"),t),c=this.fromEv(this.safeString2(e,"cumQuoteValueEv","quoteQtyEv"),t),l=this.fromEp(this.safeString(e,"avgPriceEp"),t),u=this.parseOrderStatus(this.safeString(e,"ordStatus")),f=this.safeStringLower(e,"side"),p=this.parseOrderType(this.safeString(e,"ordType")),m=this.safeIntegerProduct2(e,"actionTimeNs","createTimeNs",1e-6);let g;const y=this.fromEv(this.safeString(e,"cumFeeEv"),t);void 0!==y&&(g={cost:y,currency:void 0});const b=this.parseTimeInForce(this.safeString(e,"timeInForce")),v=this.parseNumber(this.omitZero(this.fromEp(this.safeString(e,"stopPxEp",t)))),w="PO"===b;return this.safeOrder({info:e,id:i,clientOrderId:s,timestamp:m,datetime:this.iso8601(m),lastTradeTimestamp:void 0,symbol:a,type:p,timeInForce:b,postOnly:w,side:f,price:n,stopPrice:v,triggerPrice:v,amount:o,cost:c,average:l,filled:d,remaining:h,status:u,fee:g,trades:void 0},t)}parseSwapOrder(e,t){const i=this.safeString(e,"orderID");let s=this.safeString(e,"clOrdID");void 0!==s&&s.length<1&&(s=void 0);const r=this.safeString(e,"symbol"),a=this.safeSymbol(r,t),n=this.parseOrderStatus(this.safeString(e,"ordStatus")),o=this.safeStringLower(e,"side"),h=this.parseOrderType(this.safeString(e,"orderType")),d=this.parseNumber(this.fromEp(this.safeString(e,"priceEp"),t)),c=this.safeNumber(e,"orderQty"),l=this.safeNumber(e,"cumQty"),u=this.safeNumber(e,"leavesQty"),f=this.safeIntegerProduct(e,"actionTimeNs",1e-6),p=this.safeNumber(e,"cumValue");let m=this.safeIntegerProduct(e,"transactTimeNs",1e-6);0===m&&(m=void 0);const g=this.parseTimeInForce(this.safeString(e,"timeInForce")),y=this.safeNumber(e,"stopPx"),b="PO"===g;let v=this.safeValue(e,"reduceOnly");return"ReduceOnly"===this.safeString(e,"execInst")&&(v=!0),{info:e,id:i,clientOrderId:s,datetime:this.iso8601(f),timestamp:f,lastTradeTimestamp:m,symbol:a,type:h,timeInForce:g,postOnly:b,reduceOnly:v,side:o,price:d,stopPrice:y,triggerPrice:y,amount:c,filled:l,remaining:u,cost:p,average:void 0,status:n,fee:void 0,trades:void 0}}parseOrder(e,t){return"closedPnl"in e?this.parseSwapOrder(e,t):this.parseSpotOrder(e,t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);i=this.capitalize(i),t=this.capitalize(t);const o=this.safeValue(a,"reduceOnly"),h={symbol:n.id,side:i,ordType:t},c=this.safeString2(a,"clOrdID","clientOrderId");if(void 0===c){const e=this.safeString(this.options,"brokerId");void 0!==e&&(h.clOrdID=e+this.uuid16())}else h.clOrdID=c,a=this.omit(a,["clOrdID","clientOrderId"]);const l=this.safeString2(a,"stopPx","stopPrice");if(void 0!==l&&(h.stopPxEp=this.toEp(l,n)),a=this.omit(a,["stopPx","stopPrice"]),n.spot){let e=this.safeValue(a,"qtyType","ByBase");if("Market"!==t&&"Stop"!==t&&"MarketIfTouched"!==t||void 0!==r&&(e="ByQuote"),h.qtyType=e,"ByQuote"===e){let t=this.safeNumber(a,"cost");if(a=this.omit(a,"cost"),this.options.createOrderByQuoteRequiresPrice)if(void 0!==r){const e=this.numberToString(s),i=this.numberToString(r),a=v.stringMul(e,i);t=this.parseNumber(a)}else if(void 0===t)throw new d(this.id+" createOrder() "+e+" requires a price argument or a cost parameter");t=void 0===t?s:t;const i=t.toString();h.quoteQtyEv=this.toEv(i,n)}else{const e=s.toString();h.baseQtyEv=this.toEv(e,n)}}else if(n.swap&&(void 0!==o&&(h.reduceOnly=o),h.orderQty=parseInt(s),void 0!==l)){const e=this.safeString(a,"triggerType","ByMarkPrice");h.triggerType=e}if("Limit"===t||"StopLimit"===t||"LimitIfTouched"===t){const e=r.toString();h.priceEp=this.toEp(e,n)}const u=this.safeString(a,"takeProfitPrice");void 0!==u&&(h.takeProfitEp=this.toEp(u,n),a=this.omit(a,"takeProfitPrice"));const f=this.safeString(a,"stopLossPrice");void 0!==f&&(h.stopLossEp=this.toEp(f,n),a=this.omit(a,"stopLossPrice"));const p=n.spot?"privatePostSpotOrders":"privatePostOrders";a=this.omit(a,"reduceOnly");const m=await this[p](this.extend(h,a)),g=this.safeValue(m,"data",{});return this.parseOrder(g,n)}async editOrder(e,t,i,s,r,a,n={}){if(void 0===t)throw new d(this.id+" editOrder() requires a symbol argument");if(void 0!==i)throw new d(this.id+" editOrder() type changing is not implemented. Try to cancel & recreate order for that purpose");if(void 0!==s)throw new d(this.id+" editOrder() side changing is not implemented. Try to cancel & recreate order for that purpose");await this.loadMarkets();const o=this.market(t),h={symbol:o.id},c=this.safeString2(n,"clientOrderId","clOrdID");n=this.omit(n,["clientOrderId","clOrdID"]),void 0!==c?h.clOrdID=c:h.orderID=e,void 0!==a&&(h.priceEp=this.toEp(a,o));const l=this.safeString(n,"baseQtyEv");n=this.omit(n,["baseQtyEv"]),void 0!==l?h.baseQtyEV=l:void 0!==r&&(h.baseQtyEV=this.toEv(r,o));const u=this.safeString2(n,"stopPx","stopPrice");void 0!==u&&(h.stopPxEp=this.toEp(u,o)),n=this.omit(n,["stopPx","stopPrice"]);const f=o.spot?"privatePutSpotOrders":"privatePutOrdersReplace",p=await this[f](this.extend(h,n)),m=this.safeValue(p,"data",{});return this.parseOrder(m,o)}async cancelOrder(e,t,i={}){if(void 0===t)throw new d(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={symbol:s.id},a=this.safeString2(i,"clientOrderId","clOrdID");i=this.omit(i,["clientOrderId","clOrdID"]),void 0!==a?r.clOrdID=a:r.orderID=e;const n=s.spot?"privateDeleteSpotOrders":"privateDeleteOrdersCancel",o=await this[n](this.extend(r,i)),h=this.safeValue(o,"data",{});return this.parseOrder(h,s)}async cancelAllOrders(e,t={}){if(void 0===e)throw new d(this.id+" cancelAllOrders() requires a symbol argument");await this.loadMarkets();const i={},s=this.market(e);let r="privateDeleteSpotOrdersAll";return s.swap&&(r="privateDeleteOrdersAll"),i.symbol=s.id,await this[r](this.extend(i,t))}async fetchOrder(e,t,i={}){if(void 0===t)throw new d(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r=s.spot?"privateGetSpotOrdersActive":"privateGetExchangeOrder",a={symbol:s.id},n=this.safeString2(i,"clientOrderId","clOrdID");i=this.omit(i,["clientOrderId","clOrdID"]),void 0!==n?a.clOrdID=n:a.orderID=e;const o=await this[r](this.extend(a,i)),h=this.safeValue(o,"data",{});let l=h;if(Array.isArray(h)){if(h.length<1)throw new c(void 0!==n?this.id+" fetchOrder() "+t+" order with clientOrderId "+n+" not found":this.id+" fetchOrder() "+t+" order with id "+e+" not found");l=this.safeValue(h,0,{})}return this.parseOrder(l,s)}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new d(this.id+" fetchOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a=r.spot?"privateGetSpotOrders":"privateGetExchangeOrderList",n={symbol:r.id};void 0!==t&&(n.start=t),void 0!==i&&(n.limit=i);const o=await this[a](this.extend(n,s)),h=this.safeValue(o,"data",{}),c=this.safeValue(h,"rows",[]);return this.parseOrders(c,r,t,i)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new d(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a=r.spot?"privateGetSpotOrders":"privateGetOrdersActiveList",n={symbol:r.id};let o;try{o=await this[a](this.extend(n,s))}catch(e){if(e instanceof c)return[]}const h=this.safeValue(o,"data",{});if(Array.isArray(h))return this.parseOrders(h,r,t,i);{const e=this.safeValue(h,"rows",[]);return this.parseOrders(e,r,t,i)}}async fetchClosedOrders(e,t,i,s={}){if(void 0===e)throw new d(this.id+" fetchClosedOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a=r.spot?"privateGetExchangeSpotOrder":"privateGetExchangeOrderList",n={symbol:r.id};void 0!==t&&(n.start=t),void 0!==i&&(n.limit=i);const o=await this[a](this.extend(n,s)),h=this.safeValue(o,"data",{});if(Array.isArray(h))return this.parseOrders(h,r,t,i);{const e=this.safeValue(h,"rows",[]);return this.parseOrders(e,r,t,i)}}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new d(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a=r.spot?"privateGetExchangeSpotOrderTrades":"privateGetExchangeOrderTrade",n={symbol:r.id};void 0!==t&&(n.start=t),r.swap&&void 0!==i&&(n.limit=i);const o=await this[a](this.extend(n,s)),h=this.safeValue(o,"data",{}),c=this.safeValue(h,"rows",[]);return this.parseTrades(c,r,t,i)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},r=this.safeValue(this.options,"defaultNetworks"),a=this.safeStringUpper(r,e),n=this.safeValue(this.options,"networks",{});let o=this.safeStringUpper(t,"network",a);o=this.safeString(n,o,o),void 0===o?s.chainName=i.id:(s.chainName=o,t=this.omit(t,"network"));const h=await this.privateGetPhemexUserWalletsV2DepositAddress(this.extend(s,t)),d=this.safeValue(h,"data",{}),c=this.safeString(d,"address"),l=this.safeString(d,"tag");return this.checkAddress(c),{currency:e,address:c,tag:l,network:void 0,info:h}}async fetchDeposits(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.currency(e));const a=await this.privateGetExchangeWalletsDepositList(s),n=this.safeValue(a,"data",{});return this.parseTransactions(n,r,t,i)}async fetchWithdrawals(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.currency(e));const a=await this.privateGetExchangeWalletsWithdrawList(s),n=this.safeValue(a,"data",{});return this.parseTransactions(n,r,t,i)}parseTransactionStatus(e){return this.safeString({Success:"ok",Succeed:"ok"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"address"),r=void 0,a=this.safeString(e,"txHash"),n=this.safeString(e,"currency"),o=(t=this.safeCurrency(n,t)).code,h=this.safeInteger2(e,"createdAt","submitedAt");let d=this.safeStringLower(e,"type");const c=this.parseNumber(this.fromEn(this.safeString(e,"feeEv"),t.valueScale));let l;void 0!==c&&(d="withdrawal",l={cost:c,currency:o});const u=this.parseTransactionStatus(this.safeString(e,"status")),f=this.parseNumber(this.fromEn(this.safeString(e,"amountEv"),t.valueScale));return{info:e,id:i,txid:a,timestamp:h,datetime:this.iso8601(h),network:void 0,address:s,addressTo:s,addressFrom:void 0,tag:r,tagTo:r,tagFrom:void 0,type:d,amount:f,currency:o,status:u,updated:void 0,fee:l}}async fetchPositions(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=this.safeString(this.options,"defaultSubType","linear");let s=this.safeString(t,"code");void 0===s?s="linear"===i?"USD":"BTC":t=this.omit(t,"code");const r={currency:this.currency(s).id},a=await this.privateGetAccountsAccountPositions(this.extend(r,t)),n=this.safeValue(a,"data",{}),o=this.safeValue(n,"positions",[]),h=[];for(let e=0;e<o.length;e++){const t=o[e];h.push(this.parsePosition(t))}return this.filterByArray(h,"symbol",e,!1)}parsePosition(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeString(e,"positionMargin"),a=this.safeString(e,"value"),n=this.safeString(e,"maintMarginReq"),o=v.stringMul(a,n),h=this.safeString(e,"assignedPosBalance"),d=v.stringDiv(h,a),c=this.safeNumber(e,"liquidationPrice"),l=this.safeString(e,"markPrice"),u=this.safeString(e,"size"),f=this.safeValue(t,"contractSize"),p=this.numberToString(f),m=this.safeNumber(e,"leverage"),g=this.safeString(e,"avgEntryPrice"),y=this.safeString(e,"side");let b,w;void 0!==y&&(b="Buy"===y?"long":"short");w="USD"===this.safeString(e,"currency")?"long"===b?v.stringSub(l,g):v.stringSub(g,l):"long"===b?v.stringSub(v.stringDiv("1",g),v.stringDiv("1",l)):v.stringSub(v.stringDiv("1",l),v.stringDiv("1",g));const S=v.stringMul(v.stringMul(w,u),p),k=v.stringMul(v.stringDiv(S,h),"100"),T=v.stringDiv(o,r);return{info:e,id:void 0,symbol:s,contracts:this.parseNumber(u),contractSize:f,unrealizedPnl:this.parseNumber(S),leverage:m,liquidationPrice:c,collateral:this.parseNumber(r),notional:this.parseNumber(a),markPrice:this.parseNumber(l),entryPrice:this.parseNumber(g),timestamp:void 0,initialMargin:this.parseNumber(h),initialMarginPercentage:this.parseNumber(d),maintenanceMargin:this.parseNumber(o),maintenanceMarginPercentage:this.parseNumber(n),marginRatio:this.parseNumber(T),datetime:void 0,marginMode:void 0,side:b,hedged:!1,percentage:this.parseNumber(k)}}async fetchFundingHistory(e,t,i,s={}){if(await this.loadMarkets(),void 0===e)throw new d(this.id+" fetchFundingHistory() requires a symbol argument");const r=this.market(e),a={symbol:r.id};if(i>200)throw new l(this.id+" fetchFundingHistory() limit argument cannot exceed 200");void 0!==i&&(a.limit=i);const n=await this.privateGetApiDataFuturesFundingFees(this.extend(a,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"rows",[]),c=[];for(let e=0;e<h.length;e++){const t=h[e],i=this.safeInteger(t,"createTime");c.push({info:t,symbol:this.safeString(t,"symbol"),code:this.safeCurrencyCode(this.safeString(t,"currency")),timestamp:i,datetime:this.iso8601(i),id:void 0,amount:this.fromEv(this.safeString(t,"execFeeEv"),r)})}return c}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.swap)throw new a(this.id+" fetchFundingRate() supports swap contracts only");const s={symbol:i.id};let r={};r=i.linear?await this.v2GetMdV2Ticker24hr(this.extend(s,t)):await this.v1GetMdTicker24hr(this.extend(s,t));const n=this.safeValue(r,"result",{});return this.parseFundingRate(n,i)}parseFundingRate(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t),r=this.safeIntegerProduct(e,"timestamp",1e-6);return{info:e,symbol:s,markPrice:this.fromEp(this.safeString2(e,"markEp","markPriceRp"),t),indexPrice:this.fromEp(this.safeString2(e,"indexEp","indexPriceRp"),t),interestRate:void 0,estimatedSettlePrice:void 0,timestamp:r,datetime:this.iso8601(r),fundingRate:this.fromEr(this.safeString(e,"fundingRateEr"),t),fundingTimestamp:void 0,fundingDatetime:void 0,nextFundingRate:this.fromEr(this.safeString2(e,"predFundingRateEr","predFundingRateRr"),t),nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async setMargin(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id,posBalanceEv:this.toEv(t,s)},a=await this.privatePostPositionsAssign(this.extend(r,i));return this.extend(this.parseMarginModification(a,s),{amount:t})}parseMarginStatus(e){return this.safeString({0:"ok"},e,e)}parseMarginModification(e,t){return{info:e,type:"set",amount:void 0,total:void 0,code:(t=this.safeMarket(void 0,t))[this.safeValue(t,"inverse")?"base":"quote"],symbol:this.safeSymbol(void 0,t),status:this.parseMarginStatus(this.safeString(e,"code"))}}async setMarginMode(e,t,i={}){if(void 0===t)throw new d(this.id+" setMarginMode() requires a symbol argument");if("isolated"!==(e=e.toLowerCase())&&"cross"!==e)throw new l(this.id+" setMarginMode() marginMode argument should be isolated or cross");await this.loadMarkets();const s=this.market(t);if("swap"!==s.type)throw new a(this.id+" setMarginMode() supports swap contracts only");let r=this.safeInteger(i,"leverage");if("cross"===e&&(r=0),void 0===r)throw new d(this.id+" setMarginMode() requires a leverage parameter");const n={symbol:s.id,leverage:r};return await this.privatePutPositionsLeverage(this.extend(n,i))}async fetchLeverageTiers(e,t={}){await this.loadMarkets();const i=await this.publicGetCfgV2Products(t),s=this.safeValue(i,"data",{}),r=this.safeValue(s,"riskLimits");return this.parseLeverageTiers(r,e,"symbol")}parseMarketLeverageTiers(e,t){const i=(t=this.safeMarket(void 0,t)).info.riskLimits,s=[];let r=0;for(let e=0;e<i.length;e++){const a=i[e],n=this.safeInteger(a,"limit");s.push({tier:this.sum(e,1),currency:t.settle,minNotional:r,maxNotional:n,maintenanceMarginRate:this.safeString(a,"maintenanceMargin"),maxLeverage:void 0,info:a}),r=n}return s}sign(e,t="public",i="GET",s={},r,a){const n=this.omit(s,this.extractParams(e)),o="/"+this.implodeParams(e,s);let h=o,d="";if("GET"!==i&&"DELETE"!==i&&"PUT"!==i&&"/positions/assign"!==h||Object.keys(n).length&&(d=this.urlencodeWithArrayRepeat(n),h+="?"+d),"private"===t){this.checkRequiredCredentials();const e=this.seconds(),t=this.safeInteger(this.options,"x-phemex-request-expiry",60),n=this.sum(e,t).toString();r={"x-phemex-access-token":this.apiKey,"x-phemex-request-expiry":n};let h="";"POST"===i&&(h=this.json(s),a=h,r["Content-Type"]="application/json");const c=o+d+n+h;r["x-phemex-request-signature"]=this.hmac(this.encode(c),this.encode(this.secret))}return h=this.implodeHostname(this.urls.api[t])+h,{url:h,method:i,body:a,headers:r}}async setLeverage(e,t,i={}){if(void 0===t)throw new d(this.id+" setLeverage() requires a symbol argument");if(e<1||e>100)throw new l(this.id+" setLeverage() leverage should be between 1 and 100");await this.loadMarkets();const s={symbol:this.market(t).id,leverage:e};return await this.privatePutPositionsLeverage(this.extend(s,i))}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n=this.safeValue(this.options,"accountsByType",{}),o=this.safeString(n,i,i),h=this.safeString(n,s,s),d=this.toEv(t,a);let c,l;if("spot"===o&&"future"===h?c=2:"future"===o&&"spot"===h&&(c=1),void 0!==c){const e={currency:a.id,moveOp:c,amountEv:d},t=await this.privatePostAssetsTransfer(this.extend(e,r)),i=this.safeValue(t,"data",{});l=this.parseTransfer(i,a)}else{const e={fromUserId:o,toUserId:h,amountEv:d,currency:a.id,bizType:this.safeString(r,"bizType","SPOT")},t=await this.privatePostAssetsUniversalTransfer(this.extend(e,r));l=this.parseTransfer(t)}const u=this.safeValue(this.options,"transfer",{});return this.safeValue(u,"fillResponseFromRequest",!0)&&(void 0===l.fromAccount&&(l.fromAccount=i),void 0===l.toAccount&&(l.toAccount=s),void 0===l.amount&&(l.amount=t),void 0===l.currency&&(l.currency=e)),l}async fetchTransfers(e,t,i,s={}){if(await this.loadMarkets(),void 0===e)throw new d(this.id+" fetchTransfers() requires a code argument");const r=this.currency(e),a={currency:r.id};void 0!==t&&(a.start=t),void 0!==i&&(a.limit=i);const n=await this.privateGetAssetsTransfer(this.extend(a,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"rows",[]);return this.parseTransfers(h,r,t,i)}parseTransfer(e,t){const i=this.safeString(e,"linkKey"),s=this.safeString(e,"status"),r=this.safeString(e,"amountEv"),a=this.fromEv(r,t),n=this.safeString(e,"currency"),o=this.safeCurrencyCode(n,t),h=this.safeInteger(e,"side");let d,c;1===h?(d="swap",c="spot"):2===h&&(d="spot",c="swap");const l=this.safeInteger(e,"createTime");return{info:e,id:i,timestamp:l,datetime:this.iso8601(l),currency:o,amount:a,fromAccount:d,toAccount:c,status:this.parseTransferStatus(s)}}parseTransferStatus(e){return this.safeString({3:"rejected",6:"canceled",10:"ok",11:"failed"},e,e)}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;const c=this.safeValue(o,"error",o),l=this.safeString(c,"code"),u=this.safeString(c,"msg");if(void 0!==l&&"0"!==l){const e=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,l,e),this.throwBroadlyMatchedException(this.exceptions.broad,u,e),new r(e)}}}},67497:function(e,t,i){"use strict";const s=i(48819),{ArgumentsRequired:r,ExchangeError:a,ExchangeNotAvailable:n,NotSupported:o,RequestTimeout:h,AuthenticationError:d,PermissionDenied:c,RateLimitExceeded:l,InsufficientFunds:u,OrderNotFound:f,InvalidOrder:p,AccountSuspended:m,CancelPending:g,InvalidNonce:y,OnMaintenance:b,BadSymbol:v}=i(73449),{TICK_SIZE:w}=i(62115),S=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"poloniex",name:"Poloniex",countries:["US"],rateLimit:5,certified:!1,pro:!1,has:{CORS:void 0,spot:!0,margin:void 0,swap:void 0,future:void 0,option:void 0,cancelAllOrders:!0,cancelOrder:!0,createDepositAddress:!0,createOrder:!0,editOrder:!0,fetchBalance:!0,fetchClosedOrder:!1,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchMarginMode:!1,fetchMarkets:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrder:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderBooks:!1,fetchOrderTrades:!0,fetchPosition:!1,fetchPositionMode:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactions:!0,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawals:!0,transfer:!0,withdraw:!0},timeframes:{"1m":"MINUTE_1","5m":"MINUTE_5","10m":"MINUTE_10","15m":"MINUTE_15","30m":"MINUTE_30","1h":"HOUR_1","2h":"HOUR_2","4h":"HOUR_4","6h":"HOUR_6","12h":"HOUR_12","1d":"DAY_1","3d":"DAY_3","1w":"WEEK_1","1M":"MONTH_1"},urls:{logo:"https://user-images.githubusercontent.com/1294454/27766817-e9456312-5ee6-11e7-9b3c-b628ca5626a5.jpg",api:"https://api.poloniex.com",test:"https://sand-spot-api-gateway.poloniex.com",www:"https://www.poloniex.com",doc:"https://docs.poloniex.com",fees:"https://poloniex.com/fees",referral:"https://poloniex.com/signup?c=UBFZJRPJ"},api:{public:{get:{markets:20,"markets/{symbol}":1,currencies:20,"currencies/{currency}":20,timestamp:1,"markets/price":1,"markets/{symbol}/price":1,"markets/{symbol}/orderBook":1,"markets/{symbol}/candles":1,"markets/{symbol}/trades":20,"markets/ticker24h":20,"markets/{symbol}/ticker24h":20}},private:{get:{accounts:4,"accounts/activity":4,"accounts/balances":4,"accounts/{id}/balances":4,"accounts/transfer":20,"accounts/transfer/{id}":4,subaccounts:4,"subaccounts/balances":20,"subaccounts/{id}/balances":4,"subaccounts/transfer":20,"subaccounts/transfer/{id}":4,feeinfo:20,"wallets/addresses":20,"wallets/activity":20,"wallets/addresses/{currency}":20,orders:20,"orders/{id}":4,"orders/history":20,"orders/killSwitchStatus":4,smartorders:20,"smartorders/{id}":4,"smartorders/history":20,trades:20,"orders/{id}/trades":4},post:{"accounts/transfer":4,"subaccounts/transfer":20,"wallets/address":20,"wallets/withdraw":20,orders:4,"orders/killSwitch":4,"orders/batch":20,smartorders:4},delete:{"orders/{id}":4,"orders/cancelByIds":20,orders:20,"smartorders/{id}":4,"smartorders/cancelByIds":20,smartorders:20},put:{"orders/{id}":4,"smartorders/{id}":4}}},fees:{trading:{feeSide:"get",maker:this.parseNumber("0.0009"),taker:this.parseNumber("0.0009")},funding:{}},commonCurrencies:{AIR:"AirCoin",APH:"AphroditeCoin",BCC:"BTCtalkcoin",BCHABC:"BCHABC",BDG:"Badgercoin",BTM:"Bitmark",CON:"Coino",GOLD:"GoldEagles",GPUC:"GPU",HOT:"Hotcoin",ITC:"Information Coin",KEY:"KEYCoin",MASK:"NFTX Hashmasks Index",MEME:"Degenerator Meme",PLX:"ParallaxCoin",REPV2:"REP",STR:"XLM",SOC:"SOCC",TRADE:"Unitrade",XAP:"API Coin",USDTTRON:"USDT",USDTETH:"USDT",UST:"USTC"},options:{networks:{BEP20:"BSC",ERC20:"ETH",TRC20:"TRON"},networksById:{BSC:"BEP20",ETH:"ERC20",TRON:"TRC20"},limits:{cost:{min:{BTC:1e-4,ETH:1e-4,USDT:1,TRX:100,BNB:.06,USDC:1,USDJ:1,TUSD:1e-4,DAI:1,PAX:1,BUSD:1}}},accountsByType:{spot:"spot",future:"futures"},accountsById:{exchange:"spot",futures:"future"}},precisionMode:w,exceptions:{exact:{"You may only place orders that reduce your position.":p,"Invalid order number, or you are not the person who placed the order.":f,"Permission denied":c,"Permission denied.":c,"Connection timed out. Please try again.":h,"Internal error. Please try again.":n,"Currently in maintenance mode.":b,"Order not found, or you are not the person who placed it.":f,"Invalid API key/secret pair.":d,"Please do not make more than 8 API calls per second.":l,"This IP has been temporarily throttled. Please ensure your requests are valid and try again in one minute.":l,"Rate must be greater than zero.":p,"Invalid currency pair.":v,"Invalid currencyPair parameter.":v,"Trading is disabled in this market.":v,"Invalid orderNumber parameter.":f,"Order is beyond acceptable bounds.":p,"This account is closed.":m},broad:{"Total must be at least":p,"This account is frozen":m,"This account is locked.":m,"Not enough":u,"Nonce must be greater":y,"You have already called cancelOrder":g,"Amount must be at least":p,"is either completed or does not exist":f,"Error pulling ":a}}})}parseOHLCV(e,t){return[this.safeInteger(e,12),this.safeNumber(e,2),this.safeNumber(e,1),this.safeNumber(e,0),this.safeNumber(e,3),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,interval:this.safeString(this.timeframes,t,t)};void 0!==i&&(n.startTime=i),void 0!==s&&(n.limit=s);const o=await this.publicGetMarketsSymbolCandles(this.extend(n,r));return this.parseOHLCVs(o,a,t,i,s)}async loadMarkets(e=!1,t={}){const i=await super.loadMarkets(e,t);return(void 0===this.safeValue(this.options,"currenciesByNumericId")||e)&&(this.options.currenciesByNumericId=this.indexBy(this.currencies,"numericId")),i}async fetchMarkets(e={}){const t=await this.publicGetMarkets(e),i=[];for(let e=0;e<t.length;e++){const s=this.safeValue(t,e),r=this.safeString(s,"symbol"),a=this.safeString(s,"baseCurrencyName"),n=this.safeString(s,"quoteCurrencyName"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d="NORMAL"===this.safeString(s,"state"),c=this.safeValue(s,"symbolTradeLimit");i.push({id:r,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:d,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(c,"quantityScale"))),price:this.parseNumber(this.parsePrecision(this.safeString(c,"priceScale")))},limits:{amount:{min:this.safeNumber(c,"minQuantity"),max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(c,"minAmount"),max:void 0}},info:s})}return i}async fetchTime(e={}){const t=await this.publicGetTimestamp(e);return this.safeInteger(t,"serverTime")}parseTicker(e,t){const i=this.safeInteger(e,"ts"),s=this.safeString(e,"symbol");t=this.safeMarket(s);const r=this.safeString(e,"close"),a=this.safeString(e,"percentChange"),n=S.stringMul(a,"100");return this.safeTicker({id:s,symbol:t.symbol,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:this.safeString(e,"open"),close:r,last:r,previousClose:void 0,change:void 0,percentage:n,average:void 0,baseVolume:this.safeString(e,"quantity"),quoteVolume:this.safeString(e,"amount"),info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetMarketsTicker24h(t);return this.parseTickers(i,e)}async fetchCurrencies(e={}){const t=await this.publicGetCurrencies(e),i={};for(let e=0;e<t.length;e++){const s=this.safeValue(t,e),r=Object.keys(s),a=this.safeValue(r,0),n=this.safeValue(s,a),o=this.safeCurrencyCode(a),h=this.safeValue(n,"delisted"),d=this.safeString(n,"walletState"),c=!h&&"ENABLED"===d,l=this.safeInteger(n,"id"),u=this.safeNumber(n,"withdrawalFee");i[o]={id:a,numericId:l,code:o,info:n,name:n.name,active:c,deposit:void 0,withdraw:void 0,fee:u,precision:void 0,limits:{amount:{min:void 0,max:void 0},withdraw:{min:u,max:void 0}}}}return i}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetMarketsSymbolTicker24h(this.extend(s,t));return this.parseTicker(r,i)}parseTrade(e,t){const i=this.safeString2(e,"id","tradeID"),s=this.safeString(e,"orderId"),r=this.safeInteger2(e,"ts","createTime"),a=this.safeString(e,"symbol"),n=(t=this.safeMarket(a,t,"_")).symbol,o=this.safeStringLower(e,"side");let h;const d=this.safeString(e,"price"),c=this.safeString(e,"quantity"),l=this.safeString(e,"amount"),u=this.safeString(e,"feeCurrency"),f=this.safeString(e,"feeAmount");if(void 0!==f){h={cost:f,currency:this.safeCurrencyCode(u)}}return this.safeTrade({id:i,info:e,timestamp:r,datetime:this.iso8601(r),symbol:n,order:s,type:this.safeStringLower(e,"type"),side:o,takerOrMaker:this.safeStringLower(e,"matchRole"),price:d,amount:c,cost:l,fee:h},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.limit=i);const n=await this.publicGetMarketsSymbolTrades(this.extend(a,s));return this.parseTrades(n,r,t,i)}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e));const a={};void 0!==t&&(a.startTime=t),void 0!==i&&(a.limit=parseInt(i));const n=await this.privateGetTrades(this.extend(a,s)),o=this.parseTrades(n,r);return this.filterBySinceLimit(o,t,i)}parseOrderStatus(e){return this.safeString({NEW:"open",PARTIALLY_FILLED:"open",FILLED:"closed",PENDING_CANCEL:"canceled",PARTIALLY_CANCELED:"canceled",CANCELED:"canceled",FAILED:"canceled"},e,e)}parseOrder(e,t){let i=this.safeInteger2(e,"timestamp","createTime");void 0===i&&(i=this.parse8601(this.safeString(e,"date")));const s=this.safeString(e,"symbol"),r=(t=this.safeMarket(s,t,"_")).symbol;let a=this.safeValue(e,"resultingTrades");Array.isArray(a)||(a=this.safeValue(a,this.safeString(t,"id",s)));const n=this.safeString2(e,"price","rate"),o=this.safeString(e,"quantity"),h=this.safeString(e,"filledQuantity"),d=this.parseOrderStatus(this.safeString(e,"state")),c=this.safeStringLower(e,"side"),l=this.safeString(e,"type"),u=this.parseOrderType(l),f=this.safeString2(e,"orderNumber","id");let p;const m=this.safeString(e,"tokenFeeCurrency");let g,y;const b=this.safeString(e,"fee");void 0===m?y="buy"===c?t.base:t.quote:(y=this.safeCurrencyCode(m),g=this.safeString(e,"tokenFee")),void 0!==g&&(p={rate:b,cost:g,currency:y});const v=this.safeString(e,"clientOrderId");return this.safeOrder({info:e,id:f,clientOrderId:v,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:this.safeInteger(e,"updateTime"),status:d,symbol:r,type:u,timeInForce:this.safeString(e,"timeInForce"),postOnly:void 0,side:c,price:n,stopPrice:void 0,triggerPrice:void 0,cost:void 0,average:this.safeString(e,"avgPrice"),amount:o,filled:h,remaining:void 0,trades:a,fee:p},t)}parseOrderType(e){return this.safeString({MARKET:"market",LIMIT:"limit","STOP-LIMIT":"limit","STOP-MARKET":"market"},e,e)}parseOpenOrders(e,t,i){for(let s=0;s<e.length;s++){const r=e[s],a=this.extend(r,{status:"open",type:"limit",side:r.type,price:r.rate});i.push(this.parseOrder(a,t))}return i}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.symbol=r.id),void 0!==i&&(a.limit=i);const n=await this.privateGetOrders(this.extend(a,s));return this.parseOrders(n,r,t,i,{status:"open"})}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e);if(!n.spot)throw new o(this.id+" createOrder() does not support "+n.type+" orders, only spot orders are accepted");const h={symbol:n.id,side:i},d=this.orderRequest(e,t,i,s,h,r,a);let c=await this.privatePostOrders(this.extend(d[0],d[1]));return c=this.extend(c,{type:i}),this.parseOrder(c,n)}orderRequest(e,t,i,s,r,a,n={}){const o=this.market(e);let h=t.toUpperCase();const d="MARKET"===h;this.isPostOnly(d,"LIMIT_MAKER"===h,n)&&(h="LIMIT_MAKER",n=this.omit(n,"postOnly")),r.type=h,d?"buy"===i?r.amount=this.currencyToPrecision(o.quote,s):r.quantity=this.amountToPrecision(e,s):(r.quantity=this.amountToPrecision(e,s),r.price=this.priceToPrecision(e,a));const c=this.safeString(n,"clientOrderId");return void 0!==c&&(r.clientOrderId=c,n=this.omit(n,"clientOrderId")),[r,n]}async editOrder(e,t,i,s,r,a,n={}){await this.loadMarkets();const h=this.market(t);if(!h.spot)throw new o(this.id+" editOrder() does not support "+h.type+" orders, only spot orders are accepted");const d={id:e},c=this.orderRequest(t,i,s,r,d,a,n);let l=await this.privatePutOrdersId(this.extend(c[0],c[1]));return l=this.extend(l,{type:s}),this.parseOrder(l,h)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={},r=this.safeValue(i,"clientOrderId");return void 0!==r&&(e=r),s.id=e,i=this.omit(i,"clientOrderId"),await this.privateDeleteOrdersId(this.extend(s,i))}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};let s;void 0!==e&&(s=this.market(e),i.symbols=[s.id]);return await this.privateDeleteOrders(this.extend(i,t))}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={id:e=e.toString()},r=await this.privateGetOrdersId(this.extend(s,i));return this.extend(this.parseOrder(r),{id:e})}async fetchOrderStatus(e,t,i={}){await this.loadMarkets();const s=await this.fetchOpenOrders(t,void 0,void 0,i);return e in this.indexBy(s,"id")?"open":"closed"}async fetchOrderTrades(e,t,i,s,r={}){await this.loadMarkets();const a={id:e},n=await this.privateGetOrdersIdTrades(this.extend(a,r));return this.parseTrades(n)}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0};for(let i=0;i<e.length;i++){const s=this.safeValue(e,i,{}),r=this.safeValue(s,"balances");for(let e=0;e<r.length;e++){const i=this.safeValue(r,e),s=this.safeString(i,"currency"),a=this.safeCurrencyCode(s),n=this.account();n.free=this.safeString(i,"available"),n.used=this.safeString(i,"hold"),t[a]=n}}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetAccountsBalances(this.extend({accountType:"SPOT"},e));return this.parseBalance(t)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.privateGetFeeinfo(e),i={};for(let e=0;e<this.symbols.length;e++){const s=this.symbols[e];i[s]={info:t,symbol:s,maker:this.safeNumber(t,"makerRate"),taker:this.safeNumber(t,"takerRate"),percentage:!0,tierBased:!0}}return i}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id};void 0!==t&&(r.limit=t);const a=await this.publicGetMarketsSymbolOrderBook(this.extend(r,i)),n=this.safeInteger(a,"time"),o=this.safeValue(a,"asks"),h=this.safeValue(a,"bids"),d=[],c=[];for(let e=0;e<o.length;e++)if(e%2<1){const t=this.safeNumber(o,e),i=this.safeNumber(o,this.sum(e,1));d.push([t,i])}for(let e=0;e<h.length;e++)if(e%2<1){const t=this.safeNumber(h,e),i=this.safeNumber(h,this.sum(e,1));c.push([t,i])}return{symbol:s.symbol,bids:this.sortBy(c,0,!0),asks:this.sortBy(d,0),timestamp:n,datetime:this.iso8601(n),nonce:void 0}}async createDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},a=this.safeValue(this.options,"networks",{});let n=this.safeStringUpper(t,"network");if(n=this.safeString(a,n,n),void 0!==n)s.currency+=n,t=this.omit(t,"network");else if("USDT"===i.id)throw new r(this.id+" createDepositAddress requires a network parameter for "+e+".");const o=await this.privatePostWalletsAddress(this.extend(s,t));let h,d=this.safeString(o,"address");if(this.checkAddress(d),void 0!==i){const e=this.safeString(i.info,"depositAddress");void 0!==e&&(h=d,d=e)}return{currency:e,address:d,tag:h,network:n,info:o}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},a=this.safeValue(this.options,"networks",{});let n=this.safeStringUpper(t,"network");if(n=this.safeString(a,n,n),void 0!==n)s.currency+=n,t=this.omit(t,"network");else if("USDT"===i.id)throw new r(this.id+" fetchDepositAddress requires a network parameter for "+e+".");const o=await this.privateGetWalletsAddresses(this.extend(s,t));let h,d=this.safeString(o,s.currency);if(this.checkAddress(d),void 0!==i){const e=this.safeString(i.info,"depositAddress");void 0!==e&&(h=d,d=e)}return{currency:e,address:d,tag:h,network:n,info:o}}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e);t=this.currencyToPrecision(e,t);const n=this.safeValue(this.options,"accountsByType",{}),o=this.safeString(n,i,i),h=this.safeString(n,s,i),d={amount:t,currency:a.id,fromAccount:o,toAccount:h},c=await this.privatePostAccountsTransfer(this.extend(d,r));return this.parseTransfer(c,a)}parseTransferStatus(e){return this.safeString({1:"ok"},e,e)}parseTransfer(e,t){const i=this.safeString(e,"message").split(" "),s=this.safeNumber(i,1),r=this.safeString(i,2),a=this.safeString(i,4),n=this.safeString(i,6),o=this.safeValue(this.options,"accountsById",{});return{info:e,id:void 0,timestamp:void 0,datetime:void 0,currency:this.safeCurrencyCode(r,t),amount:s,fromAccount:this.safeString(o,a),toAccount:this.safeString(o,n),status:this.parseOrderStatus(this.safeString(e,"success","failed"))}}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={currency:a.id,amount:t,address:i};void 0!==s&&(n.paymentId=s);const o=this.safeValue(this.options,"networks",{});let h=this.safeStringUpper(r,"network");h=this.safeString(o,h,h),void 0!==h&&(n.currency+=h,r=this.omit(r,"network"));const d=await this.privatePostWalletsWithdraw(this.extend(n,r));return this.parseTransaction(d,a)}async fetchTransactionsHelper(e,t,i,s={}){await this.loadMarkets();const r=this.seconds(),a={start:void 0!==t?parseInt(t/1e3):r-31104e4,end:r};return await this.privateGetWalletsActivity(this.extend(a,s))}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();const r=await this.fetchTransactionsHelper(e,t,i,s);let a;void 0!==e&&(a=this.currency(e));const n=this.safeValue(r,"withdrawals",[]),o=this.safeValue(r,"deposits",[]),h=this.parseTransactions(n,a,t,i),d=this.parseTransactions(o,a,t,i),c=this.arrayConcat(d,h);return this.filterByCurrencySinceLimit(this.sortBy(c,"timestamp"),e,t,i)}async fetchWithdrawals(e,t,i,s={}){const r=await this.fetchTransactionsHelper(e,t,i,s);let a;void 0!==e&&(a=this.currency(e));const n=this.safeValue(r,"withdrawals",[]),o=this.parseTransactions(n,a,t,i);return this.filterByCurrencySinceLimit(o,e,t,i)}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.publicGetCurrencies(this.extend(t,{includeMultiChainCurrencies:!0})),s={};for(let e=0;e<i.length;e++){const t=i[e],r=Object.keys(t),a=this.safeString(r,0);s[a]=t[a]}return this.parseDepositWithdrawFees(s,e)}parseDepositWithdrawFees(e,t,i){const s={};t=this.marketCodes(t);const r=Object.keys(e);for(let i=0;i<r.length;i++){const a=r[i],n=this.safeCurrencyCode(a),o=e[a];if(void 0===t||this.inArray(n,t)){s[n]=this.parseDepositWithdrawFee(o,n);const t=this.safeValue(o,"childChains");if(t.length>0)for(let i=0;i<t.length;i++){let r=t[i];r=r.replace(n,"");const a=this.networkIdToCode(r),o=this.safeValue(e,r),h={},d=this.safeNumber(o,"withdrawalFee");h[a]={withdraw:{fee:d,percentage:void 0===d&&void 0},deposit:{fee:void 0,percentage:void 0}},s[n].networks=this.extend(s[n].networks,h)}}}return s}parseDepositWithdrawFee(e,t){const i=this.depositWithdrawFee({});i.info[t]=e;const s=this.safeString(e,"blockchain"),r=this.safeNumber(e,"withdrawalFee"),a={fee:r,percentage:void 0===r&&void 0},n={fee:void 0,percentage:void 0};i.withdraw=a,i.deposit=n;const o=this.networkIdToCode(s);return i.networks[o]={withdraw:a,deposit:n},i}async fetchDeposits(e,t,i,s={}){const r=await this.fetchTransactionsHelper(e,t,i,s);let a;void 0!==e&&(a=this.currency(e));const n=this.safeValue(r,"deposits",[]),o=this.parseTransactions(n,a,t,i);return this.filterByCurrencySinceLimit(o,e,t,i)}parseTransactionStatus(e){return this.safeString({COMPLETE:"ok",COMPLETED:"ok","AWAITING APPROVAL":"pending",AWAITING_APPROVAL:"pending",PENDING:"pending",PROCESSING:"pending","COMPLETE ERROR":"failed",COMPLETE_ERROR:"failed"},e,e)}parseTransaction(e,t){const i=this.safeTimestamp(e,"timestamp"),s=this.safeString(e,"currency"),r=this.safeCurrencyCode(s);let a=this.safeString(e,"status","pending");a=this.parseTransactionStatus(a);const n=this.safeString(e,"txid"),o="withdrawalRequestsId"in e?"withdrawal":"deposit",h=this.safeString2(e,"withdrawalRequestsId","depositNumber"),d=this.safeString(e,"address"),c=this.safeString(e,"paymentID");let l=this.safeString(e,"amount");const u=this.safeString(e,"fee");return"withdrawal"===o&&(l=S.stringSub(l,u)),{info:e,id:h,currency:r,amount:this.parseNumber(l),network:void 0,address:d,addressTo:void 0,addressFrom:void 0,tag:c,tagTo:void 0,tagFrom:void 0,status:a,type:o,updated:void 0,txid:n,timestamp:i,datetime:this.iso8601(i),fee:{currency:r,cost:this.parseNumber(u)}}}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api;const o=this.omit(s,this.extractParams(e)),h=this.implodeParams(e,s);if("public"===t)n+="/"+h,Object.keys(o).length&&(n+="?"+this.urlencode(o));else{this.checkRequiredCredentials();const e=this.nonce().toString();let t=i+"\n";if(n+="/"+h,t+="/"+h,"POST"===i||"PUT"===i||"DELETE"===i)t+="\n",Object.keys(o).length&&(t+="requestBody="+(a=this.json(o))+"&"),t+="signTimestamp="+e;else{let i=this.extend({signTimestamp:e},o);i=this.keysort(i),t+="\n"+this.urlencode(i),Object.keys(o).length&&(n+="?"+this.urlencode(o))}const s=this.hmac(this.encode(t),this.encode(this.secret),"sha256","base64");r={"Content-Type":"application/json",key:this.apiKey,signTimestamp:e,signature:s}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,n,o,h,d){if(void 0!==o&&"error"in o){const e=o.error,t=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,e,t),this.throwBroadlyMatchedException(this.exceptions.broad,e,t),new a(t)}}}},8908:function(e,t,i){"use strict";const{BadRequest:s,ArgumentsRequired:r,InvalidOrder:a,AuthenticationError:n,NotSupported:o,RateLimitExceeded:h,ExchangeNotAvailable:d,InvalidNonce:c,AccountSuspended:l,OrderNotFound:u}=i(73449),f=i(6832),p=i(48819),{TICK_SIZE:m}=i(62115);e.exports=class extends p{describe(){return this.deepExtend(super.describe(),{id:"poloniexfutures",name:"Poloniex Futures",countries:["US"],rateLimit:33.3,certified:!1,pro:!1,version:"v1",has:{CORS:void 0,spot:!1,margin:!0,swap:!0,future:!1,option:void 0,createOrder:!0,fetchBalance:!0,fetchClosedOrders:!0,fetchCurrencies:!1,fetchFundingRate:!0,fetchL3OrderBook:!0,fetchMarkets:!0,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrdersByStatus:!0,fetchPositions:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,setMarginMode:!0},timeframes:{"1m":1,"5m":5,"15m":15,"30m":30,"1h":60,"2h":120,"4h":480,"12h":720,"1d":1440,"1w":10080},urls:{logo:"https://user-images.githubusercontent.com/1294454/27766817-e9456312-5ee6-11e7-9b3c-b628ca5626a5.jpg",api:{public:"https://futures-api.poloniex.com",private:"https://futures-api.poloniex.com"},www:"https://www.poloniex.com",doc:"https://futures-docs.poloniex.com",fees:"https://poloniex.com/fee-schedule",referral:"https://poloniex.com/signup?c=UBFZJRPJ"},api:{public:{get:{"contracts/active":10,"contracts/{symbol}":10,ticker:10,tickers:10,"level2/snapshot":180.002,"level2/depth":180.002,"level2/message/query":180.002,"level3/snapshot":180.002,"trade/history":10,"interest/query":10,"index/query":10,"mark-price/{symbol}/current":10,"premium/query":10,"funding-rate/{symbol}/current":10,timestamp:10,status:10,"kline/query":10},post:{"bullet-public":10}},private:{get:{"account-overview":1,"transaction-history":1,orders:1,stopOrders:1,recentDoneOrders:1,"orders/{order-id}":1,fills:1,openOrderStatistics:1,position:1.5,positions:1.5,"funding-history":1,"marginType/query":1},post:{orders:1.5,batchOrders:1.5,"position/margin/auto-deposit-status":1.5,"position/margin/deposit-margin":1.5,"bullet-private":1,"marginType/change":1},delete:{"orders/{order-id}":1.5,orders:150.016,stopOrders:150.016}}},precisionMode:m,fees:{trading:{tierBased:!1,percentage:!0,taker:this.parseNumber("0.00075"),maker:this.parseNumber("0.0001")},funding:{tierBased:!1,percentage:!1,withdraw:{},deposit:{}}},commonCurrencies:{},requiredCredentials:{apiKey:!0,secret:!0,password:!0},options:{networks:{OMNI:"omni",ERC20:"eth",TRC20:"trx"},versions:{public:{GET:{ticker:"v2",tickers:"v2","level3/snapshot":"v2"}}}},exceptions:{exact:{400:s,401:n,403:o,404:o,405:o,415:s,429:h,500:d,503:d,400001:n,400002:c,400003:n,400004:n,400005:n,400006:n,400007:n,404e3:o,400100:s,411100:l,5e5:d},broad:{"Position does not exist":u}}})}async fetchMarkets(e={}){const t=await this.publicGetContractsActive(e),i=[],s=this.safeValue(t,"data",[]),r=s.length;for(let e=0;e<r;e++){const t=s[e],r=this.safeString(t,"symbol"),a=this.safeString(t,"baseCurrency"),n=this.safeString(t,"quoteCurrency"),o=this.safeString(t,"rootSymbol"),h=this.safeCurrencyCode(a),d=this.safeCurrencyCode(n),c=this.safeCurrencyCode(o),l=h+"/"+d+":"+c,u=this.safeValue(t,"isInverse"),p=this.safeString(t,"status"),m=this.safeString(t,"multiplier"),g=this.safeNumber(t,"indexPriceTickSize"),y=this.safeNumber(t,"lotSize"),b=this.safeNumber(t,"maxOrderQty"),v=this.safeNumber(t,"maxPrice");i.push({id:r,symbol:l,base:h,quote:d,settle:c,baseId:a,quoteId:n,settleId:o,type:"swap",spot:!1,margin:!1,swap:!0,future:!1,option:!1,active:"Open"===p,contract:!0,linear:!u,inverse:u,taker:this.safeNumber(t,"takerFeeRate"),maker:this.safeNumber(t,"makerFeeRate"),contractSize:this.parseNumber(f.stringAbs(m)),expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:y,price:g},limits:{leverage:{min:this.parseNumber("1"),max:this.safeNumber(t,"maxLeverage")},amount:{min:y,max:b},price:{min:g,max:v},cost:{min:void 0,max:void 0}},info:t})}return i}parseTicker(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t),r=this.safeIntegerProduct(e,"ts",1e-6),a=this.safeString(e,"price");return this.safeTicker({symbol:s,timestamp:r,datetime:this.iso8601(r),high:void 0,low:void 0,bid:this.safeString(e,"bestBidPrice"),bidVolume:this.safeString(e,"bestBidSize"),ask:this.safeString(e,"bestAskPrice"),askVolume:this.safeString(e,"bestAskSize"),vwap:void 0,open:void 0,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"size"),quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetTicker(this.extend(s,t));return this.parseTicker(this.safeValue(r,"data",{}),i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetTickers(t);return this.parseTickers(this.safeValue(i,"data",[]),e)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const r=this.safeNumber(i,"level");if(i=this.omit(i,"level"),void 0!==r&&2!==r&&3!==r)throw new s(this.id+" fetchOrderBook() can only return level 2 & 3");const a=this.market(e),n={symbol:a.id};let o;o=3===r?await this.publicGetLevel3Snapshot(this.extend(n,i)):await this.publicGetLevel2Snapshot(this.extend(n,i));const h=this.safeValue(o,"data",{}),d=this.safeIntegerProduct(h,"ts",1e-6);let c;return c=3===r?this.parseOrderBook(h,a.symbol,d,"bids","asks",1,2):this.parseOrderBook(h,a.symbol,d,"bids","asks",0,1),c.nonce=this.safeInteger(h,"sequence"),c}async fetchL3OrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);return this.fetchOrderBook(s.id,void 0,{level:3})}parseTrade(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t,"-");const s=this.safeString(e,"tradeId"),r=this.safeString(e,"orderId"),a=this.safeString(e,"liquidity");let n=this.safeInteger(e,"ts");void 0!==n?n=parseInt(n/1e6):(n=this.safeInteger(e,"createdAt"),"dealValue"in e&&void 0!==n&&(n*=1e3));const o=this.safeString(e,"price"),h=this.safeString(e,"size"),d=this.safeString(e,"side");let c;const l=this.safeString(e,"fee");if(void 0!==l){const i=this.safeString(e,"feeCurrency");let s=this.safeCurrencyCode(i);void 0===s&&(s="sell"===d?t.quote:t.base),c={cost:l,currency:s,rate:this.safeString(e,"feeRate")}}let u=this.safeString(e,"orderType");"match"===u&&(u=void 0);const f=this.safeString(e,"value");return this.safeTrade({info:e,id:s,order:r,timestamp:n,datetime:this.iso8601(n),symbol:t.symbol,type:u,takerOrMaker:a,side:d,price:o,amount:h,cost:f,fee:c},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id},n=await this.publicGetTradeHistory(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}async fetchTime(e={}){const t=await this.publicGetTimestamp(e);return this.safeInteger(t,"data")}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,granularity:this.safeInteger(this.timeframes,t,t)},o=1e3*this.parseTimeframe(t);let h=this.milliseconds();void 0!==i?(n.from=i,void 0===s&&(s=this.safeInteger(this.options,"fetchOHLCVLimit",200)),h=this.sum(i,s*o),n.to=h):void 0!==s&&(i=h-s*o,n.from=i);const d=await this.publicGetKlineQuery(this.extend(n,r)),c=this.safeValue(d,"data",[]);return this.parseOHLCVs(c,a,t,i,s)}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0},i=this.safeValue(e,"data"),s=this.safeString(i,"currency"),r=this.safeCurrencyCode(s),a=this.account();return a.free=this.safeString(i,"availableBalance"),a.total=this.safeString(i,"accountEquity"),t[r]=a,this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=this.safeString(e,"currency");let i={};if(void 0!==t){i={currency:this.currency(t).id}}const s=await this.privateGetAccountOverview(this.extend(i,e));return this.parseBalance(s)}async createOrder(e,t,i,n,o,h={}){await this.loadMarkets();const d=this.market(e),c=this.safeString2(h,"clientOid","clientOrderId",this.uuid());if(h=this.omit(h,["clientOid","clientOrderId"]),n<1)throw new a(this.id+" createOrder() minimum contract order amount is 1");const l=parseInt(this.amountToPrecision(e,n)),u={clientOid:c,side:i,symbol:d.id,type:t,size:l,leverage:1},f=this.safeValue2(h,"triggerPrice","stopPrice");if(f){u.stop="buy"===i?"up":"down";const t=this.safeString(h,"stopPriceType","TP");u.stopPriceType=t,u.stopPrice=this.priceToPrecision(e,f)}const p=this.safeStringUpper(h,"timeInForce");if("limit"===t){if(void 0===o)throw new r(this.id+" createOrder() requires a price argument for limit orders");u.price=this.priceToPrecision(e,o),void 0!==p&&(u.timeInForce=p)}const m=this.safeValue(h,"postOnly",!1),g=this.safeValue(h,"hidden");if(m&&void 0!==g)throw new s(this.id+" createOrder() does not support the postOnly parameter together with a hidden parameter");if(this.safeValue(h,"iceberg")){if(void 0===this.safeValue(h,"visibleSize"))throw new r(this.id+" createOrder() requires a visibleSize parameter for iceberg orders")}h=this.omit(h,["timeInForce","stopPrice","triggerPrice"]);const y=await this.privatePostOrders(this.extend(u,h)),b=this.safeValue(y,"data",{});return{id:this.safeString(b,"orderId"),clientOrderId:void 0,timestamp:void 0,datetime:void 0,lastTradeTimestamp:void 0,symbol:void 0,type:void 0,side:void 0,price:void 0,amount:void 0,cost:void 0,average:void 0,filled:void 0,remaining:void 0,status:void 0,fee:void 0,trades:void 0,timeInForce:void 0,postOnly:void 0,stopPrice:void 0,info:y}}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={"order-id":e},r=await this.privateDeleteOrdersOrderId(this.extend(s,i)),n=this.safeValue(r,"data"),o=this.safeValue(n,"cancelledOrderIds");if(0===o.length)throw new a(this.id+" cancelOrder() order already cancelled");return{id:this.safeString(o,0),clientOrderId:void 0,timestamp:void 0,datetime:void 0,lastTradeTimestamp:void 0,symbol:void 0,type:void 0,side:void 0,price:void 0,amount:void 0,cost:void 0,average:void 0,filled:void 0,remaining:void 0,status:void 0,fee:void 0,trades:void 0,timeInForce:void 0,postOnly:void 0,stopPrice:void 0,info:r}}async fetchPositions(e,t={}){await this.loadMarkets();const i=await this.privateGetPositions(t),s=this.safeValue(i,"data");return this.parsePositions(s,e)}parsePosition(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t);const s=this.safeInteger(e,"currentTimestamp"),r=this.safeString(e,"currentQty");let a;f.stringGt(r,"0")?a="long":f.stringLt(r,"0")&&(a="short");const n=f.stringAbs(this.safeString(e,"posCost")),o=this.safeString(e,"posInit"),h=f.stringDiv(o,n),d=this.safeString(e,"unrealisedPnl"),c=this.safeValue(e,"crossMode")?"cross":"isolated";return{info:e,id:void 0,symbol:this.safeString(t,"symbol"),timestamp:s,datetime:this.iso8601(s),initialMargin:this.parseNumber(o),initialMarginPercentage:this.parseNumber(h),maintenanceMargin:this.safeNumber(e,"posMaint"),maintenanceMarginPercentage:this.safeNumber(e,"maintMarginReq"),entryPrice:this.safeNumber(e,"avgEntryPrice"),notional:this.parseNumber(n),leverage:this.safeNumber(e,"realLeverage"),unrealizedPnl:this.parseNumber(d),contracts:this.parseNumber(f.stringAbs(r)),contractSize:this.safeValue(t,"contractSize"),marginRatio:void 0,liquidationPrice:this.safeNumber(e,"liquidationPrice"),markPrice:this.safeNumber(e,"markPrice"),collateral:this.safeNumber(e,"maintMargin"),marginMode:c,side:a,percentage:this.parseNumber(f.stringDiv(d,o))}}async fetchFundingHistory(e,t,i,s={}){if(void 0===e)throw new r(this.id+" fetchFundingHistory() requires a symbol argument");await this.loadMarkets();const a={symbol:this.market(e).id};void 0!==t&&(a.startAt=t),void 0!==i&&(a.maxCount=i);const n=await this.privateGetFundingHistory(this.extend(a,s)),o=this.safeValue(n,"data"),h=this.safeValue(o,"dataList",[]),d=h.length,c=[];for(let t=0;t<d;t++){const i=h[t],s=this.safeInteger(i,"timePoint");c.push({info:i,symbol:e,code:this.safeCurrencyCode(this.safeString(i,"settleCurrency")),timestamp:s,datetime:this.iso8601(s),id:this.safeNumber(i,"id"),amount:this.safeNumber(i,"funding"),fundingRate:this.safeNumber(i,"fundingRate"),markPrice:this.safeNumber(i,"markPrice"),positionQty:this.safeNumber(i,"positionQty"),positionCost:this.safeNumber(i,"positionCost")})}return c}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};void 0!==e&&(i.symbol=this.marketId(e));const s=this.safeValue(t,"stop")?"privateDeleteStopOrders":"privateDeleteOrders",r=await this[s](this.extend(i,t)),a=this.safeValue(r,"data"),n=[],o=this.safeValue(a,"cancelledOrderIds"),h=o.length;for(let e=0;e<h;e++){const t=this.safeString(o,e);n.push({id:t,clientOrderId:void 0,timestamp:void 0,datetime:void 0,lastTradeTimestamp:void 0,symbol:void 0,type:void 0,side:void 0,price:void 0,amount:void 0,cost:void 0,average:void 0,filled:void 0,remaining:void 0,status:void 0,fee:void 0,trades:void 0,timeInForce:void 0,postOnly:void 0,stopPrice:void 0,info:r})}return n}async fetchOrdersByStatus(e,t,i,r,a={}){await this.loadMarkets();const n=this.safeValue(a,"stop"),o=this.safeInteger2(a,"until","till");a=this.omit(a,["stop","until","till"]),"closed"===e?e="done":"open"===e&&(e="active");const h={};if(n){if("active"!==e)throw new s(this.id+" fetchOrdersByStatus() can only fetch untriggered stop orders")}else h.status=e;let d;void 0!==t&&(d=this.market(t),h.symbol=d.id),void 0!==i&&(h.startAt=i),void 0!==o&&(h.endAt=o);const c=n?"privateGetStopOrders":"privateGetOrders",l=await this[c](this.extend(h,a)),u=this.safeValue(l,"data",{}),f=this.safeValue(u,"items",[]),p=f.length,m=[];if("done"===e)for(let e=0;e<p;e++)f[e].cancelExist||m.push(f[e]);return this.parseOrders(m,d,i,r)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("active",e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersByStatus("closed",e,t,i,s)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={};let r="privateGetOrdersOrderId";if(void 0===e){const e=this.safeString2(i,"clientOid","clientOrderId");if(void 0===e)throw new a(this.id+" fetchOrder() requires parameter id or params.clientOid");s.clientOid=e,r="privateGetOrdersByClientOid",i=this.omit(i,["clientOid","clientOrderId"])}else s["order-id"]=e;const n=await this[r](this.extend(s,i)),o=void 0!==t?this.market(t):void 0,h=this.safeValue(n,"data");return this.parseOrder(h,o)}parseOrder(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeString(e,"id"),a=this.safeString(e,"type"),n=this.safeInteger(e,"createdAt"),o=this.iso8601(n),h=this.safeString(e,"price"),d=this.safeString(e,"side"),c=this.safeString(e,"feeCurrency"),l=this.safeCurrencyCode(c),u=this.safeNumber(e,"fee"),p=this.safeString(e,"size"),m=this.safeString(e,"dealSize"),g=this.safeString2(e,"dealFunds","filledValue"),y=this.safeString(e,"leverage"),b=f.stringDiv(g,y);let v;if(f.stringGt(m,"0")){const e=this.safeString(t,"contractSize");v=t.linear?f.stringDiv(g,f.stringMul(e,m)):f.stringDiv(f.stringMul(e,m),g)}let w=this.safeValue(e,"isActive",!1)?"open":"closed";w=this.safeValue(e,"cancelExist",!1)?"canceled":w;const S={currency:l,cost:u},k=this.safeString(e,"clientOid"),T=this.safeString(e,"timeInForce"),_=this.safeNumber(e,"stopPrice"),O=this.safeValue(e,"postOnly");return this.safeOrder({id:r,clientOrderId:k,symbol:s,type:a,timeInForce:T,postOnly:O,side:d,amount:p,price:h,stopPrice:_,cost:b,filled:m,remaining:void 0,timestamp:n,datetime:o,fee:S,status:w,info:e,lastTradeTimestamp:void 0,average:v,trades:void 0},t)}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetFundingRateSymbolCurrent(this.extend(s,t)),a=this.safeValue(r,"data"),n=this.safeInteger(a,"timePoint");return{info:a,symbol:i.symbol,markPrice:void 0,indexPrice:void 0,interestRate:void 0,estimatedSettlePrice:void 0,timestamp:void 0,datetime:void 0,fundingRate:this.safeNumber(a,"predictedValue"),fundingTimestamp:void 0,fundingDatetime:void 0,nextFundingRate:void 0,nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:this.safeNumber(a,"value"),previousFundingTimestamp:n,previousFundingDatetime:this.iso8601(n)}}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.symbol=a.id),void 0!==t&&(r.startAt=t);const n=await this.privateGetFills(this.extend(r,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"items",{});return this.parseTrades(h,a,t,i)}async setMarginMode(e,t,i={}){if(void 0===t)throw new r(this.id+" setMarginMode() requires a symbol argument");if(0!==e&&1!==e)throw new r(this.id+" setMarginMode() marginMode must be 0 (isolated) or 1 (cross)");await this.loadMarkets();const s={symbol:this.market(t).id,marginType:e};return await this.privatePostMarginTypeChange(s)}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t];const o=this.safeValue(this.options,"versions",{}),h=this.safeValue(o,t,{}),d=this.safeValue(h,i,{}),c=this.safeString(d,e,this.version);n+="/api/"+this.safeString(s,"version",c)+"/"+this.implodeParams(e,s);const l=this.omit(s,e),u=Object.keys(l).length;if("public"===t)u&&(n+="?"+this.urlencode(l));else{this.checkRequiredCredentials();let t="/api/v1/"+this.implodeParams(e,s);const o=this.urlencode(l);"GET"!==i&&"HEAD"!==i?a=l:u&&""!==o&&(n+="?"+o,t+="?"+o);const h=this.milliseconds().toString();let d="";void 0!==a&&(d=a=this.json(l));const c=h+i+t+d;(r={"PF-API-SIGN":this.hmac(this.encode(c),this.encode(this.secret),"sha256","base64"),"PF-API-TIMESTAMP":h,"PF-API-KEY":this.apiKey,"PF-API-PASSPHRASE":this.password})["Content-Type"]="application/json"}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,n,o,h){if(!n)return void this.throwBroadlyMatchedException(this.exceptions.broad,a,a);const d=this.safeString(n,"code"),c=this.safeString(n,"msg",""),l=this.id+" "+c;this.throwExactlyMatchedException(this.exceptions.exact,c,l),this.throwExactlyMatchedException(this.exceptions.exact,d,l),this.throwBroadlyMatchedException(this.exceptions.broad,a,l)}}},87882:function(e,t,i){"use strict";const s=i(61454),{ExchangeError:r,AuthenticationError:a}=i(73449),{ArrayCache:n,ArrayCacheBySymbolById:o,ArrayCacheByTimestamp:h}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!1,watchMyTrades:!0,watchOHLCV:!0,watchOrderBook:!0,watchOrders:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0,watchPosition:!1},urls:{api:{ws:{crypto:"wss://stream.data.alpaca.markets/v1beta2/crypto",trading:"wss://api.alpaca.markets/stream"}},test:{ws:{crypto:"wss://stream.data.alpaca.markets/v1beta2/crypto",trading:"wss://paper-api.alpaca.markets/stream"}}},options:{},streaming:{},exceptions:{ws:{exact:{}}}})}async watchTicker(e,t={}){const i=this.urls.api.ws.crypto;await this.authenticate(i),await this.loadMarkets();const s=this.market(e),r="ticker:"+s.symbol,a={action:"subscribe",quotes:[s.id]};return await this.watch(i,r,this.extend(a,t),r)}handleTicker(e,t){const i=this.parseTicker(t),s=i.symbol,r="ticker:"+s;this.tickers[s]=i,e.resolve(this.tickers[s],r)}parseTicker(e,t){const i=this.safeString(e,"S"),s=this.safeString(e,"t");return this.safeTicker({symbol:this.safeSymbol(i,t),timestamp:this.parse8601(s),datetime:s,high:void 0,low:void 0,bid:this.safeString(e,"bp"),bidVolume:this.safeString(e,"bs"),ask:this.safeString(e,"ap"),askVolume:this.safeString(e,"as"),vwap:void 0,open:void 0,close:void 0,last:void 0,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:void 0,quoteVolume:void 0,info:e},t)}async watchOHLCV(e,t="1m",i,s,r={}){const a=this.urls.api.ws.crypto;await this.authenticate(a),await this.loadMarkets();const n=this.market(e);e=n.symbol;const o={action:"subscribe",bars:[n.id]},h="ohlcv:"+e,d=await this.watch(a,h,this.extend(o,r),h);return this.newUpdates&&(s=d.getLimit(e,s)),this.filterBySinceLimit(d,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeString(t,"S"),s=this.safeSymbol(i);let r=this.safeValue(this.ohlcvs,s);if(void 0===r){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);r=new h(e),this.ohlcvs[s]=r}const a=this.parseOHLCV(t);r.append(a);const n="ohlcv:"+s;e.resolve(r,n)}async watchOrderBook(e,t,i={}){const s=this.urls.api.ws.crypto;await this.authenticate(s),await this.loadMarkets();const r=this.market(e),a="orderbook:"+(e=r.symbol),n={action:"subscribe",orderbooks:[r.id]};return(await this.watch(s,a,this.extend(n,i),a)).limit()}handleOrderBook(e,t){const i=this.safeString(t,"S"),s=this.safeSymbol(i),r=this.safeString(t,"t"),a=this.parse8601(r),n=this.safeValue(t,"r",!1);let o=this.safeValue(this.orderbooks,s);if(void 0===o&&(o=this.orderBook()),n){const e=this.parseOrderBook(t,s,a,"b","a","p","s");o.reset(e)}else{const e=this.safeValue(t,"a",[]),i=this.safeValue(t,"b",[]);this.handleDeltas(o.asks,e),this.handleDeltas(o.bids,i),o.timestamp=a,o.datetime=r}const h="orderbook:"+s;this.orderbooks[s]=o,e.resolve(o,h)}handleDelta(e,t){const i=this.parseBidAsk(t,"p","s");e.storeArray(i)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}async watchTrades(e,t,i,s={}){const r=this.urls.api.ws.crypto;await this.authenticate(r),await this.loadMarkets();const a=this.market(e),n="trade:"+(e=a.symbol),o={action:"subscribe",trades:[a.id]},h=await this.watch(r,n,this.extend(o,s),n);return this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySinceLimit(h,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeString(t,"S"),s=this.safeSymbol(i);let r=this.safeValue(this.trades,s);if(void 0===r){const e=this.safeInteger(this.options,"tradesLimit",1e3);r=new n(e),this.trades[s]=r}const a=this.parseTrade(t);r.append(a);const o="trade:"+s;e.resolve(r,o)}async watchMyTrades(e,t,i,s={}){const r=this.urls.api.ws.trading;await this.authenticate(r);let a="myTrades";await this.loadMarkets(),void 0!==e&&(a+=":"+(e=this.symbol(e)));const n=await this.watch(r,a,this.extend({action:"listen",data:{streams:["trade_updates"]}},s),a);return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySinceLimit(n,t,i,"timestamp",!0)}async watchOrders(e,t,i,s={}){const r=this.urls.api.ws.trading;await this.authenticate(r),await this.loadMarkets();let a="orders";if(void 0!==e){a="orders:"+(e=this.market(e).symbol)}const n=await this.watch(r,a,this.extend({action:"listen",data:{streams:["trade_updates"]}},s),a);return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySymbolSinceLimit(n,e,t,i,!0)}handleTradeUpdate(e,t){this.handleOrder(e,t),this.handleMyTrade(e,t)}handleOrder(e,t){const i=this.safeValue(t,"data",{}),s=this.safeValue(i,"order",{});if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new o(e)}const r=this.orders,a=this.parseOrder(s);r.append(a);let n="orders";e.resolve(r,n),n="orders:"+a.symbol,e.resolve(r,n)}handleMyTrade(e,t){const i=this.safeValue(t,"data",{}),s=this.safeString(i,"event");if("fill"!==s&&"partial_fill"!==s)return;const r=this.safeValue(i,"order",{});let a=this.myTrades;if(void 0===a){const e=this.safeInteger(this.options,"tradesLimit",1e3);a=new o(e)}const n=this.parseMyTrade(r);a.append(n);let h="myTrades:"+n.symbol;e.resolve(a,h),h="myTrades",e.resolve(a,h)}parseMyTrade(e,t){const i=this.safeString(e,"symbol"),s=this.safeString(e,"filled_at");let r=this.safeString(e,"type");return r.indexOf("limit")>=0&&(r="limit"),this.safeTrade({id:this.safeString(e,"i"),info:e,timestamp:this.parse8601(s),datetime:s,symbol:this.safeSymbol(i,void 0,"/"),order:this.safeString(e,"id"),type:r,side:this.safeString(e,"side"),takerOrMaker:"market"===r?"taker":"maker",price:this.safeString(e,"filled_avg_price"),amount:this.safeString(e,"filled_qty"),cost:void 0,fee:void 0},t)}async authenticate(e,t={}){this.checkRequiredCredentials();const i="authenticated",s=this.client(e);let r=this.safeValue(s.subscriptions,i);if(void 0===r){r=s.future("authenticated");let t={action:"auth",key:this.apiKey,secret:this.secret};e===this.urls.api.ws.trading&&(t={action:"authenticate",data:{key_id:this.apiKey,secret_key:this.secret}}),this.spawn(this.watch,e,i,t,i,r)}return await r}handleErrorMessage(e,t){const i=this.safeString(t,"code"),s=this.safeValue(t,"msg",{});throw new r(this.id+" code: "+i+" message: "+s)}handleConnected(e,t){return t}handleCryptoMessage(e,t){for(let i=0;i<t.length;i++){const s=t[i],r=this.safeString(s,"T"),a=this.safeValue(s,"msg",{});if("subscription"===r)return this.handleSubscription(e,s);if("success"===r&&"connected"===a)return this.handleConnected(e,s);if("success"===r&&"authenticated"===a)return this.handleAuthenticate(e,s);const n={error:this.handleErrorMessage,b:this.handleOHLCV,q:this.handleTicker,t:this.handleTrades,o:this.handleOrderBook},o=this.safeValue(n,r);void 0!==o&&o.call(this,e,s)}}handleTradingMessage(e,t){const i=this.safeString(t,"stream"),s={authorization:this.handleAuthenticate,listening:this.handleSubscription,trade_updates:this.handleTradeUpdate},r=this.safeValue(s,i);void 0!==r&&r.call(this,e,t)}handleMessage(e,t){if(Array.isArray(t))return this.handleCryptoMessage(e,t);this.handleTradingMessage(e,t)}handleAuthenticate(e,t){const i=this.safeString(t,"T"),s=this.safeValue(t,"data",{}),r=this.safeString(s,"status");if("success"!==i&&"authorized"!==r)throw new a(this.id+" failed to authenticate.");e.resolve(t,"authenticated")}handleSubscription(e,t){return t}}},70425:function(e,t,i){"use strict";const s=i(32300),{AuthenticationError:r}=i(73449),{ArrayCache:a,ArrayCacheByTimestamp:n,ArrayCacheBySymbolById:o}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchOHLCV:!0,watchOrderBook:!0,watchOrders:!0,watchTicker:!1,watchTrades:!0},urls:{api:{ws:{public:"wss://ascendex.com:443/api/pro/v2/stream",private:"wss://ascendex.com:443/{accountGroup}/api/pro/v2/stream"}},test:{ws:{public:"wss://api-test.ascendex-sandbox.com:443/api/pro/v2/stream",private:"wss://api-test.ascendex-sandbox.com:443/{accountGroup}/api/pro/v2/stream"}}},options:{tradesLimit:1e3,ordersLimit:1e3,OHLCVLimit:1e3,categoriesAccount:{cash:"spot",futures:"swap",margin:"margin"}}})}async watchPublic(e,t={}){const i=this.urls.api.ws.public,s={id:this.nonce().toString(),op:"sub"},r=this.extend(s,t);return await this.watch(i,e,r,e)}async watchPrivate(e,t,i={}){await this.loadAccounts();const s=this.safeString(this.options,"account-group");let r=this.urls.api.ws.private;r=this.implodeParams(r,{accountGroup:s});const a={id:this.nonce().toString(),op:"sub",ch:e},n=this.extend(a,i);return await this.authenticate(r,i),await this.watch(r,t,n,e)}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol,(void 0===s||s>1440)&&(s=100);const n="bar:"+this.safeString(this.timeframes,t,t)+":"+a.id;r={ch:n};const o=await this.watchPublic(n,r);return this.newUpdates&&(s=o.getLimit(e,s)),this.filterBySinceLimit(o,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeString(t,"s"),s=this.safeSymbol(i),r=this.safeString(t,"m"),a=this.safeValue(t,"data",{}),o=this.safeString(a,"i"),h=r+":"+o+":"+i,d=this.findTimeframe(o),c=this.market(s),l=this.parseOHLCV(t,c);this.ohlcvs[s]=this.safeValue(this.ohlcvs,s,{});let u=this.safeValue(this.ohlcvs[s],d);if(void 0===u){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);u=new n(e),this.ohlcvs[s][d]=u}return u.append(l),e.resolve(u,h),t}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);e=r.symbol;const a="trades:"+r.id;s=this.extend(s,{ch:a});const n=await this.watchPublic(a,s);return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySinceLimit(n,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeString(t,"symbol"),s=this.safeSymbol(i),r=this.safeString(t,"m")+":"+i,n=this.market(s);let o=this.safeValue(t,"data");void 0===o&&(o=[]);const h=this.parseTrades(o,n);let d=this.safeValue(this.trades,s);if(void 0===d){const e=this.safeInteger(this.options,"tradesLimit",1e3);d=new a(e)}for(let e=0;e<h.length;e++)d.append(h[e]);this.trades[s]=d,e.resolve(d,r)}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s="depth-realtime:"+this.market(e).id;i=this.extend(i,{ch:s});return(await this.watchPublic(s,i)).limit()}async watchOrderBookSnapshot(e,t,i={}){await this.loadMarkets();const s=this.market(e),r="depth-snapshot-realtime",a=r+":"+s.id;i=this.extend(i,{action:r,args:{symbol:s.id},op:"req"});return(await this.watchPublic(a,i)).limit()}handleOrderBookSnapshot(e,t){const i=this.safeString(t,"symbol"),s=this.safeSymbol(i),r=this.safeString(t,"m")+":"+s,a=this.orderbooks[s],n=this.safeValue(t,"data"),o=this.parseOrderBook(n,s);o.nonce=this.safeInteger(n,"seqnum"),a.reset(o);const h=a.cache;for(let t=0;t<h.length;t++){const i=h[t];this.handleOrderBookMessage(e,i,a)}this.orderbooks[s]=a,e.resolve(a,r)}handleOrderBook(e,t){const i=this.safeString(t,"m"),s=this.safeString(t,"symbol"),r=this.safeSymbol(s),a=i+":"+s;let n=this.safeValue(this.orderbooks,r);void 0===n&&(n=this.orderBook({})),void 0===n.nonce?n.cache.push(t):(this.handleOrderBookMessage(e,t,n),e.resolve(n,a))}handleDelta(e,t){const i=this.safeFloat(t,0),s=this.safeFloat(t,1);e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleOrderBookMessage(e,t,i){const s=this.safeValue(t,"data",{}),r=this.safeInteger(s,"seqnum");if(r>i.nonce){const e=this.safeValue(s,"asks",[]),t=this.safeValue(s,"bids",[]);this.handleDeltas(i.asks,e),this.handleDeltas(i.bids,t),i.nonce=r;const a=this.safeInteger(s,"ts");i.timestamp=a,i.datetime=this.iso8601(a)}return i}async watchBalance(e={}){await this.loadMarkets();const[t,i]=this.handleMarketTypeAndParams("watchBalance",void 0,e);let s,r;if("spot"===t||"margin"===t){const e=this.safeValue(this.options,"accountCategories",{});let i=this.safeString(e,t,"cash");i=i.toUpperCase(),s="order:"+i,r="balance:"+t}else s="futures-account-update",r="balance:swap";return await this.watchPrivate(s,r,i)}handleBalance(e,t){const i=this.safeString(t,"m");let s,r;if("order"===i||"futures-order"===i){const e=this.safeValue(t,"data"),i=this.safeString(e,"s"),a=this.safeMarket(i),n=this.account();n.free=this.safeString(e,"bab"),n.total=this.safeString(e,"btb");const o=this.account();o.free=this.safeString(e,"qab"),o.total=this.safeString(e,"qtb"),a.contract?(r="swap",s=this.safeValue(this.balance,r,{})):(r=a.type,s=this.safeValue(this.balance,r,{})),s[a.base]=n,s[a.quote]=o}else{const e=this.safeStringLower2(t,"ac","at"),i=this.safeValue(this.options,"categoriesAccount");r=this.safeString(i,e,"spot"),s=this.safeValue(this.balance,r,{});const a=this.safeValue(t,"data");let n;n=void 0===a?this.safeValue(t,"col"):[a];for(let e=0;e<n.length;e++){const t=n[e],i=this.safeCurrencyCode(this.safeString(t,"a")),r=this.account();r.free=this.safeString(t,"ab"),r.total=this.safeString2(t,"tb","b"),s[i]=r}}const a="balance:"+r;e.resolve(this.safeBalance(s),a)}async watchOrders(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e),e=r.symbol);const[a,n]=this.handleMarketTypeAndParams("watchOrders",r,s);let o,h;if("spot"!==a)h="futures-order",o="order:FUTURES";else{const e=this.safeValue(this.options,"accountCategories",{});let t=this.safeString(e,a,"cash");t=t.toUpperCase(),o="order:"+t,h=o}void 0!==e&&(o=o+":"+e);const d=await this.watchPrivate(h,o,n);return this.newUpdates&&(i=d.getLimit(e,i)),this.filterBySymbolSinceLimit(d,e,t,i,!0)}handleOrder(e,t){const i="order:"+this.safeString(t,"ac"),s=this.safeValue(t,"data",t),r=this.parseWsOrder(s);if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new o(e)}const a=this.orders;a.append(r);const n=i+":"+r.symbol;e.resolve(a,n),e.resolve(a,i)}parseWsOrder(e,t){const i=this.parseOrderStatus(this.safeString(e,"st")),s=this.safeString(e,"s"),r=this.safeInteger(e,"t"),a=this.safeSymbol(s,t,"/"),n=this.safeInteger(e,"t"),o=this.safeString(e,"p"),h=this.safeString(e,"q"),d=this.safeString(e,"ap"),c=this.safeString(e,"cfq"),l=this.safeString(e,"orderId"),u=this.safeStringLower(e,"ot"),f=this.safeStringLower(e,"sd"),p=this.safeNumber(e,"cf");let m;if(void 0!==p){const t=this.safeString(e,"fa");m={cost:p,currency:this.safeCurrencyCode(t)}}const g=this.parseNumber(this.omitZero(this.safeString(e,"sp")));return this.safeOrder({info:e,id:l,clientOrderId:void 0,timestamp:r,datetime:this.iso8601(r),lastTradeTimestamp:n,symbol:a,type:u,timeInForce:void 0,postOnly:void 0,side:f,price:o,stopPrice:g,triggerPrice:g,amount:h,cost:void 0,average:d,filled:c,remaining:void 0,status:i,fee:m,trades:void 0},t)}handleErrorMessage(e,t){const i=this.safeInteger(t,"code");try{if(void 0!==i){const e=this.id+" "+this.json(t);this.throwExactlyMatchedException(this.exceptions.exact,i,e);const s=this.safeValue(t,"message");void 0!==s&&this.throwBroadlyMatchedException(this.exceptions.broad,s,e)}return!1}catch(t){if(t instanceof r){const i="authenticated";e.reject(t,i),i in e.subscriptions&&delete e.subscriptions[i]}else e.reject(t);return!0}}handleAuthenticate(e,t){e.resolve(t,"authenticated")}handleMessage(e,t){if(this.handleErrorMessage(e,t))return;const i=this.safeString(t,"m"),s={ping:this.handlePing,auth:this.handleAuthenticate,sub:this.handleSubscriptionStatus,"depth-realtime":this.handleOrderBook,"depth-snapshot-realtime":this.handleOrderBookSnapshot,trades:this.handleTrades,bar:this.handleOHLCV,balance:this.handleBalance,"futures-account-update":this.handleBalance},r=this.safeValue(s,i);return void 0!==r&&r.call(this,e,t),"order"!==i&&"futures-order"!==i||(this.handleOrder(e,t),"order"===i&&this.handleBalance(e,t)),t}handleSubscriptionStatus(e,t){return this.safeString(t,"ch","").indexOf("depth-realtime")>-1&&this.handleOrderBookSubscription(e,t),t}handleOrderBookSubscription(e,t){const i=this.safeString(t,"ch").split(":")[1],s=this.safeSymbol(i);s in this.orderbooks&&delete this.orderbooks[s],this.orderbooks[s]=this.orderBook({}),this.spawn(this.watchOrderBookSnapshot,s)}async pong(e,t){await e.send({op:"pong",hp:this.safeInteger(t,"hp")})}handlePing(e,t){this.spawn(this.pong,e,t)}authenticate(e,t={}){this.checkRequiredCredentials();const i="authenticated",s=this.client(e);let r=this.safeValue(s.futures,i);if(void 0===r){const a=this.milliseconds().toString(),n=e.split("/"),o=n.length,h=this.safeString(n,o-1),d=a+"+"+this.safeString(n,o-2)+"/"+h,c=this.base64ToBinary(this.secret),l=this.hmac(this.encode(d),c,"sha256","base64"),u={op:"auth",id:this.nonce().toString(),t:a,key:this.apiKey,sig:l};r=this.watch(e,i,this.extend(u,t)),s.subscriptions[i]=r}return r}}},56062:function(e){"use strict";class t extends Array{constructor(e){super(),Object.defineProperty(this,"maxSize",{__proto__:null,value:e,writable:!0})}clear(){this.length=0}}class i extends t{constructor(e){super(e),Object.defineProperty(this,"nestedNewUpdatesBySymbol",{__proto__:null,value:!1,writable:!0}),Object.defineProperty(this,"newUpdatesBySymbol",{__proto__:null,value:{},writable:!0}),Object.defineProperty(this,"clearUpdatesBySymbol",{__proto__:null,value:{},writable:!0}),Object.defineProperty(this,"allNewUpdates",{__proto__:null,value:0,writable:!0}),Object.defineProperty(this,"clearAllUpdates",{__proto__:null,value:!1,writable:!0})}getLimit(e,t){let i;return void 0===e?(i=this.allNewUpdates,this.clearAllUpdates=!0):(i=this.newUpdatesBySymbol[e],void 0!==i&&this.nestedNewUpdatesBySymbol&&(i=i.size),this.clearUpdatesBySymbol[e]=!0),void 0===i?t:void 0!==t?Math.min(i,t):i}append(e){this.maxSize&&this.length===this.maxSize&&this.shift(),this.push(e),this.clearAllUpdates&&(this.clearAllUpdates=!1,this.clearUpdatesBySymbol={},this.allNewUpdates=0,this.newUpdatesBySymbol={}),this.clearUpdatesBySymbol[e.symbol]&&(this.clearUpdatesBySymbol[e.symbol]=!1,this.newUpdatesBySymbol[e.symbol]=0),this.newUpdatesBySymbol[e.symbol]=(this.newUpdatesBySymbol[e.symbol]||0)+1,this.allNewUpdates=(this.allNewUpdates||0)+1}}e.exports={ArrayCache:i,ArrayCacheByTimestamp:class extends t{constructor(e){super(e),Object.defineProperty(this,"hashmap",{__proto__:null,value:{},writable:!0}),Object.defineProperty(this,"sizeTracker",{__proto__:null,value:new Set,writable:!0}),Object.defineProperty(this,"newUpdates",{__proto__:null,value:0,writable:!0}),Object.defineProperty(this,"clearUpdates",{__proto__:null,value:!1,writable:!0})}getLimit(e,t){return this.clearUpdates=!0,void 0===t?this.newUpdates:Math.min(this.newUpdates,t)}append(e){if(e[0]in this.hashmap){const t=this.hashmap[e[0]];if(t!==e)for(const i in e)t[i]=e[i]}else{if(this.hashmap[e[0]]=e,this.maxSize&&this.length===this.maxSize){const e=this.shift();delete this.hashmap[e[0]]}this.push(e)}this.clearUpdates&&(this.clearUpdates=!1,this.sizeTracker.clear()),this.sizeTracker.add(e[0]),this.newUpdates=this.sizeTracker.size}},ArrayCacheBySymbolById:class extends i{constructor(e){super(e),this.nestedNewUpdatesBySymbol=!0,Object.defineProperty(this,"hashmap",{__proto__:null,value:{},writable:!0})}append(e){const t=this.hashmap[e.symbol]=this.hashmap[e.symbol]||{};if(e.id in t){const i=t[e.id];if(i!==e)for(const t in e)i[t]=e[t];e=i;const s=this.findIndex((t=>t.id===e.id));this.splice(s,1)}else t[e.id]=e;if(this.maxSize&&this.length===this.maxSize){const e=this.shift();delete this.hashmap[e.symbol][e.id]}this.push(e),this.clearAllUpdates&&(this.clearAllUpdates=!1,this.clearUpdatesBySymbol={},this.allNewUpdates=0,this.newUpdatesBySymbol={}),void 0===this.newUpdatesBySymbol[e.symbol]&&(this.newUpdatesBySymbol[e.symbol]=new Set),this.clearUpdatesBySymbol[e.symbol]&&(this.clearUpdatesBySymbol[e.symbol]=!1,this.newUpdatesBySymbol[e.symbol].clear());const i=this.newUpdatesBySymbol[e.symbol],s=i.size;i.add(e.id);const r=i.size;this.allNewUpdates=(this.allNewUpdates||0)+(r-s)}}}},68674:function(e,t,i){"use strict";var s=i(48764).Buffer;const r=i(73449),a=i(85806),{isNode:n,isJsonEncodedObject:o,deepExtend:h,milliseconds:d}=a,{RequestTimeout:c,NetworkError:l,NotSupported:u,BaseError:f}=r,{inflate:p,gunzip:m}=i(91497),g=i(5111);e.exports=class{constructor(e,t,i,s,r,a={}){const n={url:e,onMessageCallback:t,onErrorCallback:i,onCloseCallback:s,onConnectedCallback:r,verbose:!1,protocols:void 0,options:void 0,futures:{},subscriptions:{},rejections:{},connected:void 0,error:void 0,connectionStarted:void 0,connectionEstablished:void 0,isConnected:!1,connectionTimer:void 0,connectionTimeout:1e4,pingInterval:void 0,ping:void 0,keepAlive:3e4,maxPingPongMisses:2,connection:void 0,startedConnecting:!1,gunzip:!1,inflate:!1};Object.assign(this,h(n,a)),this.connected=g()}future(e){e in this.futures||(this.futures[e]=g());const t=this.futures[e];return e in this.rejections&&(t.reject(this.rejections[e]),delete this.rejections[e]),t}resolve(e,t){if(this.verbose&&void 0===t&&this.log(new Date,"resolve received undefined messageHash"),t in this.futures){this.futures[t].resolve(e),delete this.futures[t]}return e}reject(e,t){if(t)if(t in this.futures){this.futures[t].reject(e),delete this.futures[t]}else this.rejections[t]=e;else{const t=Object.keys(this.futures);for(let i=0;i<t.length;i++)this.reject(e,t[i])}return e}log(...e){console.log(...e)}connect(e=0){throw new u("connect() not implemented yet")}isOpen(){throw new u("isOpen() not implemented yet")}reset(e){this.clearConnectionTimeout(),this.clearPingInterval(),this.reject(e)}onConnectionTimeout(){if(!this.isOpen()){const e=new c("Connection to "+this.url+" failed due to a connection timeout");this.onError(e),this.connection.close(1006)}}setConnectionTimeout(){if(this.connectionTimeout){const e=this.onConnectionTimeout.bind(this);this.connectionTimer=setTimeout(e,this.connectionTimeout)}}clearConnectionTimeout(){this.connectionTimer&&(this.connectionTimer=clearTimeout(this.connectionTimer))}setPingInterval(){if(this.keepAlive){const e=this.onPingInterval.bind(this);this.pingInterval=setInterval(e,this.keepAlive)}}clearPingInterval(){this.pingInterval&&(this.pingInterval=clearInterval(this.pingInterval))}onPingInterval(){if(this.keepAlive&&this.isOpen()){const e=d();this.lastPong=this.lastPong||e,this.lastPong+this.keepAlive*this.maxPingPongMisses<e?this.onError(new c("Connection to "+this.url+" timed out due to a ping-pong keepalive missing on time")):this.ping?this.send(this.ping(this)):n?this.connection.ping():this.lastPong=e}}onOpen(){this.verbose&&this.log(new Date,"onOpen"),this.connectionEstablished=d(),this.isConnected=!0,this.connected.resolve(this.url),this.clearConnectionTimeout(),this.setPingInterval(),this.onConnectedCallback(this)}onPing(){this.verbose&&this.log(new Date,"onPing")}onPong(){this.lastPong=d(),this.verbose&&this.log(new Date,"onPong")}onError(e){this.verbose&&this.log(new Date,"onError",e.message),e instanceof f||(e=new l(e.message)),this.error=e,this.reset(this.error),this.onErrorCallback(this,this.error)}onClose(e){this.verbose&&this.log(new Date,"onClose",e),this.error||this.reset(new l("connection closed by remote server, closing code "+String(e.code))),this.onCloseCallback(this,e)}onUpgrade(e){this.verbose&&this.log(new Date,"onUpgrade")}send(e){this.verbose&&this.log(new Date,"sending",e),e="string"==typeof e?e:JSON.stringify(e),this.connection.send(e)}close(){throw new u("close() not implemented yet")}onMessage(e){void 0!==(e=e.data).byteLength&&(this.gunzip?e=m(e):this.inflate&&(e=p(e)));try{e instanceof s&&(e=e.toString()),o(e)&&(e=JSON.parse(e.replace(/:(\d{15,}),/g,':"$1",'))),this.verbose&&this.log(new Date,"onMessage",e)}catch(e){this.log(new Date,"onMessage JSON.parse",e)}this.onMessageCallback(this,e)}}},73901:function(e,t,i){"use strict";const s=i(48819),r=i(85806).throttle,a=i(82404),{OrderBook:n,IndexedOrderBook:o,CountedOrderBook:h}=i(87611),d=i(91497),{ExchangeError:c,NotSupported:l}=i(73449),u=i(5111);e.exports=class extends s{constructor(e={}){super(e),this.newUpdates=void 0===e.newUpdates||e.newUpdates}inflate(e){return d.inflate(e)}inflate64(e){return d.inflate64(e)}gunzip(e){return d.gunzip(e)}orderBook(e={},t=Number.MAX_SAFE_INTEGER){return new n(e,t)}indexedOrderBook(e={},t=Number.MAX_SAFE_INTEGER){return new o(e,t)}countedOrderBook(e={},t=Number.MAX_SAFE_INTEGER){return new h(e,t)}client(e){if(this.clients=this.clients||{},!this.clients[e]){const t=this.handleMessage.bind(this),i=this.onError.bind(this),s=this.onClose.bind(this),n=this.onConnected.bind(this),o=this.safeValue(this.options,"ws",{}),h=this.deepExtend(this.streaming,{log:this.log?this.log.bind(this):this.log,ping:this.ping?this.ping.bind(this):this.ping,verbose:this.verbose,throttle:r(this.tokenBucket),options:{agent:this.agent||this.httpsAgent||this.httpAgent}},o);this.clients[e]=new a(e,t,i,s,n,h)}return this.clients[e]}spawn(e,...t){const i=u();return e.apply(this,t).then(i.resolve).catch(i.reject),i}delay(e,t,...i){setTimeout((()=>{this.spawn(t,...i)}),e)}watch(e,t,i,s,r){const a=this.client(e),n=a.future(t);return a.connect(0).then((()=>{if(!a.subscriptions[s]){a.subscriptions[s]=r||!0;const e=this.safeValue(this.options,"ws"),t=this.safeValue(e,"cost",1);i&&(this.enableRateLimit&&a.throttle?a.throttle(t).then((()=>{a.send(i)})).catch((e=>{throw e})):a.send(i))}})),n}onConnected(e,t){}onError(e,t){e.url in this.clients&&this.clients[e.url].error&&delete this.clients[e.url]}onClose(e,t){e.error||this.clients[e.url]&&delete this.clients[e.url]}async close(){const e=Object.values(this.clients||{});for(let t=0;t<e.length;t++){const i=e[t];delete this.clients[i.url],await i.close()}}findTimeframe(e,t){t=t||this.timeframes;const i=Object.keys(t);for(let s=0;s<i.length;s++){const r=i[s];if(t[r]===e)return r}}async loadOrderBook(e,t,i,s,r={}){if(!(i in this.orderbooks))return void e.reject(new c(this.id+" loadOrderBook() orderbook is not initiated"),t);const a=this.handleOption("watchOrderBook","maxRetries",3);let n=0;try{const o=this.orderbooks[i];for(;n<a;){const a=o.cache,h=await this.fetchOrderBook(i,s,r),d=this.getCacheIndex(h,a);if(d>=0)return o.reset(h),this.handleDeltas(o,a.slice(d)),o.cache.length=0,void e.resolve(o,t);n++}e.reject(new c(this.id+" nonce is behind the cache after "+a.toString()+" tries."),t),delete this.clients[e.url]}catch(a){e.reject(a,t),await this.loadOrderBook(e,t,i,s,r)}}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}getCacheIndex(e,t){return-1}}},5111:function(e){"use strict";e.exports=function(){let e,t;const i=new Promise(((i,s)=>{e=i,t=s}));return i.resolve=function(){e.apply(this,arguments)},i.reject=function(){t.apply(this,arguments)},i}},87611:function(e,t,i){"use strict";const{iso8601:s}=i(39764),{extend:r,deepExtend:a}=i(65206),{Asks:n,Bids:o,CountedAsks:h,CountedBids:d,IndexedAsks:c,IndexedBids:l,IncrementalAsks:u,IncrementalBids:f,IncrementalIndexedAsks:p,IncrementalIndexedBids:m}=i(10591);class g{constructor(e={},t){Object.defineProperty(this,"cache",{__proto__:null,value:[],writable:!0}),t=t||Number.MAX_SAFE_INTEGER;const i={bids:[],asks:[],timestamp:void 0,datetime:void 0,nonce:void 0,symbol:void 0},a=Object.entries(r(i,e));for(let e=0;e<a.length;e++){const[t,i]=a[e];this[t]=i}"Array"===this.asks.constructor.name&&(this.asks=new n(this.asks,t)),"Array"===this.bids.constructor.name&&(this.bids=new o(this.bids,t)),this.timestamp&&(this.datetime=s(this.timestamp))}limit(){return this.asks.limit(),this.bids.limit(),this}update(e){return void 0!==e.nonce&&void 0!==this.nonce&&e.nonce<=this.nonce?this:(this.nonce=e.nonce,this.timestamp=e.timestamp,this.datetime=s(this.timestamp),this.reset(e))}reset(e={}){if(this.asks.index.fill(Number.MAX_VALUE),this.asks.length=0,e.asks)for(let t=0;t<e.asks.length;t++)this.asks.storeArray(e.asks[t]);if(this.bids.index.fill(Number.MAX_VALUE),this.bids.length=0,e.bids)for(let t=0;t<e.bids.length;t++)this.bids.storeArray(e.bids[t]);return this.nonce=e.nonce,this.timestamp=e.timestamp,this.datetime=s(this.timestamp),this.symbol=e.symbol,this}}e.exports={OrderBook:g,CountedOrderBook:class extends g{constructor(e={},t){super(r(e,{asks:new h(e.asks||[],t),bids:new d(e.bids||[],t)}))}},IndexedOrderBook:class extends g{constructor(e={},t){super(r(e,{asks:new c(e.asks||[],t),bids:new l(e.bids||[],t)}))}},IncrementalOrderBook:class extends g{constructor(e={},t){super(r(e,{asks:new u(e.asks||[],t),bids:new f(e.bids||[],t)}))}},IncrementalIndexedOrderBook:class extends g{constructor(e={},t){super(r(e,{asks:new p(e.asks||[],t),bids:new m(e.bids||[],t)}))}}}},10591:function(e){"use strict";function t(e,t){let i=0,s=e.length-1;for(;i<=s;){const r=i+s>>>1;e[r]-t<0?i=r+1:s=r-1}return i}const i=new Float64Array(new Array(1024).fill(Number.MAX_VALUE));class s extends Array{constructor(e=[],t){super(),Object.defineProperty(this,"index",{__proto__:null,value:new Float64Array(i),writable:!0}),Object.defineProperty(this,"depth",{__proto__:null,value:t||Number.MAX_SAFE_INTEGER,writable:!0}),this.length=0;for(let t=0;t<e.length;t++)this.storeArray(e[t].slice())}storeArray(e){const i=e[0],s=e[1],r=this.side?-i:i,a=t(this.index,r);if(s){if(this.index[a]===r)this[a][1]=s;else if(this.length++,this.index.copyWithin(a+1,a,this.index.length),this.index[a]=r,this.copyWithin(a+1,a,this.length),this[a]=e,this.length>this.index.length-1){const e=Array.from(this.index);e.length=2*this.length,e.fill(Number.MAX_VALUE,this.index.length),this.index=new Float64Array(e)}}else this.index[a]===r&&(this.index.copyWithin(a,a+1,this.index.length),this.index[this.length-1]=Number.MAX_VALUE,this.copyWithin(a,a+1,this.length),this.length--)}store(e,t){this.storeArray([e,t])}limit(){if(this.length>this.depth){for(let e=this.depth;e<this.length;e++)this.index[e]=Number.MAX_VALUE;this.length=this.depth}}}class r extends s{store(e,t,i){this.storeArray([e,t,i])}storeArray(e){const i=e[0],s=e[1],r=e[2],a=this.side?-i:i,n=t(this.index,a);if(s&&r){if(this.index[n]===a){const e=this[n];e[1]=s,e[2]=r}else if(this.length++,this.index.copyWithin(n+1,n,this.index.length),this.index[n]=a,this.copyWithin(n+1,n,this.length),this[n]=e,this.length>this.index.length-1){const e=Array.from(this.index);e.length=2*this.length,e.fill(Number.MAX_VALUE,this.index.length),this.index=new Float64Array(e)}}else this.index[n]===a&&(this.index.copyWithin(n,n+1,this.index.length),this.index[this.length-1]=Number.MAX_VALUE,this.copyWithin(n,n+1,this.length),this.length--)}}class a extends Array{constructor(e=[],t=Number.MAX_SAFE_INTEGER){super(e.length),Object.defineProperty(this,"hashmap",{__proto__:null,value:new Map,writable:!0}),Object.defineProperty(this,"index",{__proto__:null,value:new Float64Array(i),writable:!0}),Object.defineProperty(this,"depth",{__proto__:null,value:t||Number.MAX_SAFE_INTEGER,writable:!0});for(let t=0;t<e.length;t++)this.length=t,this.storeArray(e[t].slice())}store(e,t,i){this.storeArray([e,t,i])}storeArray(e){const i=e[0],s=e[1],r=e[2];let a;if(a=void 0!==i?this.side?-i:i:void 0,s){if(this.hashmap.has(r)){const i=this.hashmap.get(r);if(a=a||i,e[0]=Math.abs(a),a===i){const i=t(this.index,a);return this.index[i]=a,void(this[i]=e)}{const e=t(this.index,i);this.index.copyWithin(e,e+1,this.index.length),this.index[this.length-1]=Number.MAX_VALUE,this.copyWithin(e,e+1,this.length),this.length--}}this.hashmap.set(r,a);const i=t(this.index,a);if(this.length++,this.index.copyWithin(i+1,i,this.index.length),this.index[i]=a,this.copyWithin(i+1,i,this.length),this[i]=e,this.length>this.index.length-1){const e=Array.from(this.index);e.length=2*this.length,e.fill(Number.MAX_VALUE,this.index.length),this.index=new Float64Array(e)}}else if(this.hashmap.has(r)){const e=this.hashmap.get(r),i=t(this.index,e);this.index.copyWithin(i,i+1,this.index.length),this.index[this.length-1]=Number.MAX_VALUE,this.copyWithin(i,i+1,this.length),this.length--,this.hashmap.delete(r)}}limit(){if(this.length>this.depth){for(let e=this.depth;e<this.length;e++)this.hashmap.delete(this.index[e]),this.index[e]=Number.MAX_VALUE;this.length=this.depth}}}e.exports={Asks:class extends s{get side(){return!1}},Bids:class extends s{get side(){return!0}},OrderBookSide:s,CountedAsks:class extends r{get side(){return!1}},CountedBids:class extends r{get side(){return!0}},CountedOrderBookSide:r,IndexedAsks:class extends a{get side(){return!1}},IndexedBids:class extends a{get side(){return!0}},IndexedOrderBookSide:a}},82404:function(e,t,i){"use strict";const s=i(85806),{sleep:r,isNode:a,milliseconds:n}=s,o=i(68674),h=a?i(69988):self.WebSocket;e.exports=class extends o{createConnection(){this.verbose&&this.log(new Date,"connecting to",this.url),this.connectionStarted=n(),this.setConnectionTimeout(),this.connection=a?new h(this.url,this.protocols,this.options):new h(this.url,this.protocols),this.connection.onopen=this.onOpen.bind(this),this.connection.onmessage=this.onMessage.bind(this),this.connection.onerror=this.onError.bind(this),this.connection.onclose=this.onClose.bind(this),a&&this.connection.on("ping",this.onPing.bind(this)).on("pong",this.onPong.bind(this)).on("upgrade",this.onUpgrade.bind(this))}connect(e=0){return this.startedConnecting||(this.startedConnecting=!0,e?r(e).then(this.createConnection.bind(this)):this.createConnection()),this.connected}isOpen(){return this.connection.readyState===h.OPEN}close(){if(this.connection instanceof h)return this.connection.close()}}},91497:function(e,t,i){"use strict";var s=i(48764).Buffer;const{inflateRawSync:r,gunzipSync:a}=i(42635);function n(e){return r(e).toString()}e.exports={inflate:n,inflate64:function(e){return n(s.from(e,"base64"))},gunzip:function(e){return a(e).toString()}}},25134:function(e,t,i){"use strict";const s=i(59306);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bequant",name:"Bequant",countries:["MT"],pro:!0,urls:{logo:"https://user-images.githubusercontent.com/1294454/55248342-a75dfe00-525a-11e9-8aa2-05e9dca943c6.jpg",api:{public:"https://api.bequant.io",private:"https://api.bequant.io"},www:"https://bequant.io",doc:["https://api.bequant.io/"],fees:["https://bequant.io/fees-and-limits"],referral:"https://bequant.io"}})}}},77934:function(e,t,i){"use strict";const s=i(96056),r=i(6832),{ExchangeError:a,ArgumentsRequired:n}=i(73449),{ArrayCache:o,ArrayCacheByTimestamp:h,ArrayCacheBySymbolById:d}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchMyTrades:!0,watchOHLCV:!0,watchOrderBook:!0,watchOrders:!0,watchTicker:!0,watchTickers:!0,watchTrades:!0},urls:{test:{ws:{spot:"wss://testnet.binance.vision/ws",margin:"wss://testnet.binance.vision/ws",future:"wss://stream.binancefuture.com/ws",delivery:"wss://dstream.binancefuture.com/ws"}},api:{ws:{spot:"wss://stream.binance.com:9443/ws",margin:"wss://stream.binance.com:9443/ws",future:"wss://fstream.binance.com/ws",delivery:"wss://dstream.binance.com/ws"}}},options:{streamLimits:{spot:50,margin:50,future:50,delivery:50},streamBySubscriptionsHash:{},streamIndex:-1,watchOrderBookRate:100,tradesLimit:1e3,ordersLimit:1e3,OHLCVLimit:1e3,requestId:{},watchOrderBookLimit:1e3,watchTrades:{name:"trade"},watchTicker:{name:"ticker"},watchTickers:{name:"ticker"},watchBalance:{fetchBalanceSnapshot:!1,awaitBalanceSnapshot:!0},wallet:"wb",listenKeyRefreshRate:12e5,ws:{cost:5}}})}requestId(e){const t=this.safeValue(this.options,"requestId",{}),i=this.safeInteger(t,e,0),s=this.sum(i,1);return this.options.requestId[e]=s,s}stream(e,t){const i=this.safeValue(this.options,"streamBySubscriptionsHash",{});let s=this.safeString(i,t);if(void 0===s){let i=this.safeInteger(this.options,"streamIndex",-1);const r=this.safeValue(this.options,"streamLimits");i+=1;const a=i%this.safeInteger(r,e);this.options.streamIndex=i,s=this.numberToString(a),this.options.streamBySubscriptionsHash[t]=s}return s}onError(e,t){this.options.streamBySubscriptionsHash={},this.options.streamIndex=-1,super.onError(e,t)}onClose(e,t){this.options.streamBySubscriptionsHash={},this.options.streamIndex=-1,super.onClose(e,t)}async watchOrderBook(e,t,i={}){if(void 0!==t&&5!==t&&10!==t&&20!==t&&50!==t&&100!==t&&500!==t&&1e3!==t)throw new a(this.id+" watchOrderBook limit argument must be undefined, 5, 10, 20, 50, 100, 500 or 1000");await this.loadMarkets();const s=this.market(e);let r=s.type;s.contract&&(r=s.linear?"future":"delivery");const n="depth",o=s.lowercaseId+"@"+n,h=this.urls.api.ws[r]+"/"+this.stream(r,o),d=this.requestId(h),c={method:"SUBSCRIBE",params:[o+"@"+this.safeString(this.options,"watchOrderBookRate","100")+"ms"],id:d},l={id:d.toString(),messageHash:o,name:n,symbol:s.symbol,method:this.handleOrderBookSubscription,limit:t,type:r,params:i},u=this.extend(c,i);return(await this.watch(h,o,u,o,l)).limit()}async fetchOrderBookSnapshot(e,t,i){const s=this.safeInteger(this.options,"watchOrderBookLimit",1e3),r=this.safeValue(i,"type"),a=this.safeString(i,"symbol"),n=this.safeString(i,"messageHash"),o=this.safeInteger(i,"limit",s),h=this.safeValue(i,"params"),d=await this.fetchOrderBook(a,o,h),c=this.safeValue(this.orderbooks,a);if(void 0===c)return;c.reset(d);const l=c.cache;for(let t=0;t<l.length;t++){const i=l[t],s=this.safeInteger(i,"U"),a=this.safeInteger(i,"u"),n=this.safeInteger(i,"pu");if("future"===r){if(a<c.nonce)continue;(s<=c.nonce&&a>=c.nonce||n===c.nonce)&&this.handleOrderBookMessage(e,i,c)}else{if(a<=c.nonce)continue;s-1<=c.nonce&&a-1>=c.nonce&&this.handleOrderBookMessage(e,i,c)}}this.orderbooks[a]=c,e.resolve(c,n)}handleDelta(e,t){const i=this.safeFloat(t,0),s=this.safeFloat(t,1);e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleOrderBookMessage(e,t,i){const s=this.safeInteger(t,"u");this.handleDeltas(i.asks,this.safeValue(t,"a",[])),this.handleDeltas(i.bids,this.safeValue(t,"b",[])),i.nonce=s;const r=this.safeInteger(t,"E");return i.timestamp=r,i.datetime=this.iso8601(r),i}handleOrderBook(e,t){const i=e.url.indexOf("/stream")>=0?"spot":"contract",s=this.safeString(t,"s"),r=this.safeMarket(s,void 0,void 0,i),n=r.symbol,o=r.lowercaseId+"@depth",h=this.safeValue(this.orderbooks,n);if(void 0===h)return;const d=this.safeInteger(h,"nonce");if(void 0===d)h.cache.push(t);else try{const i=this.safeInteger(t,"U"),s=this.safeInteger(t,"u"),r=this.safeInteger(t,"pu");if(void 0===r){if(s>h.nonce){let r;if(r=void 0===this.safeInteger(h,"timestamp")?i-1<=h.nonce&&s-1>=h.nonce:i-1===h.nonce,!r)throw new a(this.id+" handleOrderBook received an out-of-order nonce");this.handleOrderBookMessage(e,t,h),d<h.nonce&&e.resolve(h,o)}}else if(s>=h.nonce){if(!(i<=h.nonce||r===h.nonce))throw new a(this.id+" handleOrderBook received an out-of-order nonce");this.handleOrderBookMessage(e,t,h),d<=h.nonce&&e.resolve(h,o)}}catch(t){delete this.orderbooks[n],delete e.subscriptions[o],e.reject(t,o)}}handleOrderBookSubscription(e,t,i){const s=this.safeInteger(this.options,"watchOrderBookLimit",1e3),r=this.safeString(i,"symbol"),a=this.safeInteger(i,"limit",s);r in this.orderbooks&&delete this.orderbooks[r],this.orderbooks[r]=this.orderBook({},a),this.spawn(this.fetchOrderBookSnapshot,e,t,i)}handleSubscriptionStatus(e,t){const i=this.safeString(t,"id"),s=this.indexBy(e.subscriptions,"id"),r=this.safeValue(s,i,{}),a=this.safeValue(r,"method");return void 0!==a&&a.call(this,e,t,r),t}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a=this.safeValue(this.options,"watchTrades",{}),n=this.safeString(a,"name","trade"),o=r.lowercaseId+"@"+n;let h=r.type;r.contract&&(h=r.linear?"future":"delivery");const d=this.omit(s,"type"),c=this.urls.api.ws[h]+"/"+this.stream(h,o),l=this.requestId(c),u={method:"SUBSCRIBE",params:[o],id:l},f={id:l},p=await this.watch(c,o,this.extend(u,d),o,f);return this.newUpdates&&(i=p.getLimit(r.symbol,i)),this.filterBySinceLimit(p,t,i,"timestamp",!0)}parseTrade(e,t){const i="TRADE"===this.safeString(e,"x");if(!i)return super.parseTrade(e,t);const s=this.safeString2(e,"t","a"),a=this.safeInteger(e,"T"),n=this.safeString2(e,"L","p");let o=this.safeString(e,"q");i&&(o=this.safeString(e,"l",o));let h=this.safeString(e,"Y");void 0===h&&void 0!==n&&void 0!==o&&(h=r.stringMul(n,o));const d=this.safeString(e,"s"),c="ps"in e?"contract":"spot",l=this.safeSymbol(d,void 0,void 0,c);let u,f=this.safeStringLower(e,"S");const p=this.safeString(e,"i");let m;"m"in e&&(void 0===f&&(f=e.m?"sell":"buy"),u=e.m?"maker":"taker");const g=this.safeString(e,"n");if(void 0!==g){const t=this.safeString(e,"N");m={cost:g,currency:this.safeCurrencyCode(t)}}const y=this.safeStringLower(e,"o");return this.safeTrade({info:e,timestamp:a,datetime:this.iso8601(a),symbol:l,id:s,order:p,type:y,takerOrMaker:u,side:f,price:n,amount:o,cost:h,fee:m})}handleTrade(e,t){const i=e.url.indexOf("/stream")>=0?"spot":"contract",s=this.safeString(t,"s"),r=this.safeMarket(s,void 0,void 0,i),a=r.symbol,n=this.safeStringLower(t,"s")+"@"+this.safeString(t,"e"),h=this.parseTrade(t,r);let d=this.safeValue(this.trades,a);if(void 0===d){const e=this.safeInteger(this.options,"tradesLimit",1e3);d=new o(e)}d.append(h),this.trades[a]=d,e.resolve(d,n)}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=a.lowercaseId+"@kline_"+this.safeString(this.timeframes,t,t);let o=a.type;a.contract&&(o=a.linear?"future":"delivery");const h=this.urls.api.ws[o]+"/"+this.stream(o,n),d=this.requestId(h),c={method:"SUBSCRIBE",params:[n],id:d},l={id:d},u=await this.watch(h,n,this.extend(c,r),n,l);return this.newUpdates&&(s=u.getLimit(e,s)),this.filterBySinceLimit(u,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeString(t,"s"),s=this.safeStringLower(t,"s"),r=this.safeString(t,"e"),a=this.safeValue(t,"k"),n=this.safeString(a,"i"),o=this.findTimeframe(n),d=s+"@"+r+"_"+n,c=[this.safeInteger(a,"t"),this.safeFloat(a,"o"),this.safeFloat(a,"h"),this.safeFloat(a,"l"),this.safeFloat(a,"c"),this.safeFloat(a,"v")],l=e.url.indexOf("/stream")>=0?"spot":"contract",u=this.safeSymbol(i,void 0,void 0,l);this.ohlcvs[u]=this.safeValue(this.ohlcvs,u,{});let f=this.safeValue(this.ohlcvs[u],o);if(void 0===f){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);f=new h(e),this.ohlcvs[u][o]=f}f.append(c),e.resolve(f,d)}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s=i.lowercaseId;let r=i.type;i.contract&&(r=i.linear?"future":"delivery");const a=this.safeValue(this.options,"watchTicker",{});let n=this.safeString(a,"name","ticker");n=this.safeString(t,"name",n),t=this.omit(t,"name");const o=s+"@"+n,h=this.urls.api.ws[r]+"/"+this.stream(r,o),d=this.requestId(h),c={method:"SUBSCRIBE",params:[o],id:d},l={id:d};return await this.watch(h,o,this.extend(c,t),o,l)}async watchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=this.marketIds(e);let s,r,a;[r,t]=this.handleMarketTypeAndParams("watchTickers",s,t),void 0!==i&&(s=this.safeMarket(i[0],void 0,void 0,r)),[a,t]=this.handleSubTypeAndParams("watchTickers",s,t),this.isLinear(r,a)?r="future":this.isInverse(r,a)&&(r="delivery");const o=this.safeValue(this.options,"watchTickers",{});let h=this.safeString(o,"name","ticker");h=this.safeString(t,"name",h);const d=t;t=this.omit(t,"name");let c=[];const l="!"+h+"@arr";if("bookTicker"===h){if(void 0===i)throw new n(this.id+" watchTickers() requires symbols for bookTicker");for(let e=0;e<i.length;e++)c.push(i[e].toLowerCase()+"@bookTicker")}else c=[l];const u=this.urls.api.ws[r]+"/"+this.stream(r,l),f=this.requestId(u),p={method:"SUBSCRIBE",params:c,id:f},m={id:f},g=await this.watch(u,l,this.extend(p,t),l,m),y={};for(let t=0;t<g.length;t++){const i=g[t],s=i.symbol;(void 0===e||this.inArray(s,e))&&(y[s]=i)}return Object.keys(y).length>0?this.newUpdates?y:this.filterByArray(this.tickers,"symbol",e):await this.watchTickers(e,d)}parseWsTicker(e,t){let i,s=this.safeString(e,"e","bookTicker");"24hrTicker"===s&&(s="ticker");const r=this.milliseconds();i="bookTicker"===s?this.safeInteger(e,"E",r):this.safeInteger(e,"C",r);const a=this.safeString(e,"s"),n=this.safeSymbol(a,void 0,void 0,t),o=this.safeFloat(e,"c");return{symbol:n,timestamp:i,datetime:this.iso8601(i),high:this.safeFloat(e,"h"),low:this.safeFloat(e,"l"),bid:this.safeFloat(e,"b"),bidVolume:this.safeFloat(e,"B"),ask:this.safeFloat(e,"a"),askVolume:this.safeFloat(e,"A"),vwap:this.safeFloat(e,"w"),open:this.safeFloat(e,"o"),close:o,last:o,previousClose:this.safeFloat(e,"x"),change:this.safeFloat(e,"p"),percentage:this.safeFloat(e,"P"),average:void 0,baseVolume:this.safeFloat(e,"v"),quoteVolume:this.safeFloat(e,"q"),info:e}}handleTicker(e,t){let i=this.safeString(t,"e","bookTicker");"24hrTicker"===i?i="ticker":"24hrMiniTicker"===i&&(i="miniTicker");const s=this.safeStringLower(t,"s")+"@"+i,r=e.url.indexOf("/stream")>=0?"spot":"contract",a=this.parseWsTicker(t,r),n=a.symbol;this.tickers[n]=a,e.resolve(a,s),"bookTicker"===i&&e.resolve([a],"!bookTicker@arr")}handleTickers(e,t){let i;const s=e.url.indexOf("/stream")>=0?"spot":"contract";for(let r=0;r<t.length;r++){const a=t[r];i=this.safeString(a,"e"),"24hrTicker"===i?i="ticker":"24hrMiniTicker"===i&&(i="miniTicker");const n=this.safeStringLower(a,"s")+"@"+i,o=this.parseWsTicker(a,s),h=o.symbol;this.tickers[h]=o,e.resolve(o,n)}const r=Object.values(this.tickers);e.resolve(r,"!"+i+"@arr")}async authenticate(e={}){const t=this.milliseconds();let i,s,r=this.safeString2(this.options,"defaultType","authenticate","spot");r=this.safeString(e,"type",r),[i,e]=this.handleSubTypeAndParams("authenticate",void 0,e),this.isLinear(r,i)?r="future":this.isInverse(r,i)&&(r="delivery"),[s,e]=this.handleMarginModeAndParams("authenticate",e);const a="isolated"===s,o="cross"===s||void 0===s,h=this.safeString(e,"symbol");e=this.omit(e,"symbol");const d=this.safeValue(this.options,r,{}),c=this.safeInteger(d,"lastAuthenticatedTime",0),l=this.safeInteger(this.options,"listenKeyRefreshRate",12e5);if(t-c>this.sum(l,1e4)){let i="publicPostUserDataStream";if("future"===r)i="fapiPrivatePostListenKey";else if("delivery"===r)i="dapiPrivatePostListenKey";else if("margin"===r&&o)i="sapiPostUserDataStream";else if(a){if(i="sapiPostUserDataStreamIsolated",void 0===h)throw new n(this.id+" authenticate() requires a symbol argument for isolated margin mode");const t=this.marketId(h);e.symbol=t}const s=await this[i](e);this.options[r]=this.extend(d,{listenKey:this.safeString(s,"listenKey"),lastAuthenticatedTime:t}),this.delay(l,this.keepAliveListenKey,e)}}async keepAliveListenKey(e={}){let t,i=this.safeString2(this.options,"defaultType","authenticate","spot");i=this.safeString(e,"type",i),[t,e]=this.handleSubTypeAndParams("keepAliveListenKey",void 0,e),this.isLinear(i,t)?i="future":this.isInverse(i,t)&&(i="delivery");const s=this.safeValue(this.options,i,{}),r=this.safeString(s,"listenKey");if(void 0===r)return;let a="publicPutUserDataStream";"future"===i?a="fapiPrivatePutListenKey":"delivery"===i?a="dapiPrivatePutListenKey":"margin"===i&&(a="sapiPutUserDataStream");const n={listenKey:r},o=this.milliseconds(),h=this.omit(e,"type");try{await this[a](this.extend(n,h))}catch(e){const t=this.urls.api.ws[i]+"/"+this.options[i].listenKey,r=this.client(t),a=Object.keys(r.futures);for(let t=0;t<a.length;t++){const i=a[t];r.reject(e,i)}return void(this.options[i]=this.extend(s,{listenKey:void 0,lastAuthenticatedTime:0}))}this.options[i]=this.extend(s,{listenKey:r,lastAuthenticatedTime:o});const d=Object.values(this.clients),c=this.safeInteger(this.options,"listenKeyRefreshRate",12e5);for(let t=0;t<d.length;t++){const s=d[t],r=Object.keys(s.subscriptions);for(let t=0;t<r.length;t++){if(r[t]===i)return this.delay(c,this.keepAliveListenKey,e)}}}setBalanceCache(e,t){if(t in e.subscriptions)return;const i=this.safeValue(this.options,"watchBalance");if(this.safeValue(i,"fetchBalanceSnapshot",!1)){const i=t+":fetchBalanceSnapshot";i in e.futures||(e.future(i),this.spawn(this.loadBalanceSnapshot,e,i,t))}else this.balance[t]={}}async loadBalanceSnapshot(e,t,i){const s=await this.fetchBalance({type:i});this.balance[i]=this.extend(s,this.safeValue(this.balance,i,{}));e.futures[t].resolve(),e.resolve(this.balance[i],i+":balance")}async watchBalance(e={}){await this.loadMarkets(),await this.authenticate(e);const t=this.safeString(this.options,"defaultType","spot");let i,s=this.safeString(e,"type",t);[i,e]=this.handleSubTypeAndParams("watchBalance",void 0,e),this.isLinear(s,i)?s="future":this.isInverse(s,i)&&(s="delivery");const r=this.urls.api.ws[s]+"/"+this.options[s].listenKey,a=this.client(r);this.setBalanceCache(a,s);const n=this.safeValue(this.options,"watchBalance"),o=this.safeValue(n,"fetchBalanceSnapshot",!1),h=this.safeValue(n,"awaitBalanceSnapshot",!0);o&&h&&await a.future(s+":fetchBalanceSnapshot");const d=s+":balance";return await this.watch(r,d,undefined,s)}handleBalance(e,t){const i=this.safeValue(this.options,"wallet","wb"),s=Object.keys(e.subscriptions)[0],a=s+":balance";this.balance[s].info=t;if("balanceUpdate"===this.safeString(t,"e")){const e=this.safeString(t,"a"),i=this.safeCurrencyCode(e),a=this.account(),n=this.safeString(t,"d");if(i in this.balance[s]){let e=this.balance[s][i].free;"string"!=typeof e&&(e=this.numberToString(e)),a.free=r.stringAdd(e,n)}else a.free=n;this.balance[s][i]=a}else{t=this.safeValue(t,"a",t);const e=this.safeValue(t,"B");for(let t=0;t<e.length;t++){const r=e[t],a=this.safeString(r,"a"),n=this.safeCurrencyCode(a),o=this.account();o.free=this.safeString(r,"f"),o.used=this.safeString(r,"l"),o.total=this.safeString(r,i),this.balance[s][n]=o}}const n=this.safeInteger(t,"E");this.balance[s].timestamp=n,this.balance[s].datetime=this.iso8601(n),this.balance[s]=this.safeBalance(this.balance[s]),e.resolve(this.balance[s],a)}async watchOrders(e,t,i,s={}){await this.loadMarkets();let r,a,n,o="orders";void 0!==e&&(r=this.market(e),o+=":"+(e=r.symbol),s.symbol=e),await this.authenticate(s),[a,s]=this.handleMarketTypeAndParams("watchOrders",r,s),[n,s]=this.handleSubTypeAndParams("watchOrders",r,s),this.isLinear(a,n)?a="future":this.isInverse(a,n)&&(a="delivery");const h=this.urls.api.ws[a]+"/"+this.options[a].listenKey,d=this.client(h);this.setBalanceCache(d,a);const c=await this.watch(h,o,undefined,a);return this.newUpdates&&(i=c.getLimit(e,i)),this.filterBySymbolSinceLimit(c,e,t,i,!0)}parseWsOrder(e,t){const i=this.safeString(e,"x"),s=this.safeString(e,"i"),r=this.safeString(e,"s"),a="ps"in e?"contract":"spot",n=this.safeSymbol(r,void 0,void 0,a);let o=this.safeInteger(e,"O");const h=this.safeInteger(e,"T");let d,c;"NEW"===i?void 0===o&&(o=h):"TRADE"===i&&(d=h);const l=this.safeFloat(e,"n");if(void 0!==l&&l>0){const t=this.safeString(e,"N");c={cost:l,currency:this.safeCurrencyCode(t)}}const u=this.safeString(e,"p"),f=this.safeString(e,"q"),p=this.safeStringLower(e,"S"),m=this.safeStringLower(e,"o"),g=this.safeString(e,"z"),y=this.safeString(e,"Z"),b=this.safeString(e,"ap"),v=this.safeString(e,"X"),w=this.parseOrderStatus(v);let S=this.safeString(e,"C");void 0!==S&&0!==S.length||(S=this.safeString(e,"c"));const k=this.safeString2(e,"P","sp");let T=this.safeString(e,"f");return"GTX"===T&&(T="PO"),this.safeOrder({info:e,symbol:n,id:s,clientOrderId:S,timestamp:o,datetime:this.iso8601(o),lastTradeTimestamp:d,type:m,timeInForce:T,postOnly:void 0,side:p,price:u,stopPrice:k,triggerPrice:k,amount:f,cost:y,average:b,filled:g,remaining:void 0,status:w,fee:c,trades:undefined})}handleOrderUpdate(e,t){"ORDER_TRADE_UPDATE"===this.safeString(t,"e")&&(t=this.safeValue(t,"o",t)),this.handleMyTrade(e,t),this.handleOrder(e,t)}async watchMyTrades(e,t,i,s={}){await this.loadMarkets();const r=this.safeString2(this.options,"watchMyTrades","defaultType","spot");let a,n=this.safeString(s,"type",r);[a,s]=this.handleSubTypeAndParams("watchMyTrades",void 0,s),this.isLinear(n,a)?n="future":this.isInverse(n,a)&&(n="delivery");let o="myTrades";void 0!==e&&(o+=":"+(e=this.symbol(e)),s.symbol=e),await this.authenticate(s);const h=this.urls.api.ws[n]+"/"+this.options[n].listenKey,d=this.client(h);this.setBalanceCache(d,n);const c=await this.watch(h,o,undefined,n);return this.newUpdates&&(i=c.getLimit(e,i)),this.filterBySymbolSinceLimit(c,e,t,i,!0)}handleMyTrade(e,t){const i="myTrades";if("TRADE"===this.safeString(t,"x")){const s=this.parseTrade(t),r=this.safeString(s,"order"),a=this.safeValue(s,"fee"),n=this.safeString(s,"symbol");if(void 0!==r&&void 0!==a&&void 0!==n){const e=this.orders;if(void 0!==e){const t=this.safeValue(e.hashmap,n,{}),i=this.safeValue(t,r);if(void 0!==i){const e=this.safeValue(i,"fees"),t=this.safeValue(i,"fee");if(void 0!==e){let t=!0;for(let s=0;s<e.length;s++){const r=e[s];if(r.currency===a.currency){const e=this.sum(a.cost,r.cost);i.fees[s].cost=parseFloat(this.currencyToPrecision(a.currency,e)),t=!1;break}}t&&i.fees.push(a)}else if(void 0!==t)if(t.currency===a.currency){const e=this.sum(t.cost,a.cost);i.fee.cost=parseFloat(this.currencyToPrecision(a.currency,e))}else void 0===t.currency?i.fee=a:(i.fees=[t,a],i.fee=void 0);else i.fee=a;const r=this.safeValue(i,"trades",[]);r.push(s),i.trades=r}}}if(void 0===this.myTrades){const e=this.safeInteger(this.options,"tradesLimit",1e3);this.myTrades=new d(e)}this.myTrades.append(s),e.resolve(this.myTrades,i);const o=i+":"+n;e.resolve(this.myTrades,o)}}handleOrder(e,t){const i="orders",s=this.parseWsOrder(t),r=this.safeString(s,"symbol"),a=this.safeString(s,"id");if(void 0!==r){if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new d(e)}const t=this.orders,n=this.safeValue(t.hashmap,r,{}),o=this.safeValue(n,a);if(void 0!==o){const e=this.safeValue(o,"fee");void 0!==e&&(s.fee=e);const t=this.safeValue(o,"fees");void 0!==t&&(s.fees=t),s.trades=this.safeValue(o,"trades"),s.timestamp=this.safeInteger(o,"timestamp"),s.datetime=this.safeString(o,"datetime")}t.append(s),e.resolve(this.orders,i);const h=i+":"+r;e.resolve(this.orders,h)}}handleMessage(e,t){const i={depthUpdate:this.handleOrderBook,trade:this.handleTrade,aggTrade:this.handleTrade,kline:this.handleOHLCV,"24hrTicker@arr":this.handleTickers,"24hrMiniTicker@arr":this.handleTickers,"24hrTicker":this.handleTicker,"24hrMiniTicker":this.handleTicker,bookTicker:this.handleTicker,outboundAccountPosition:this.handleBalance,balanceUpdate:this.handleBalance,ACCOUNT_UPDATE:this.handleBalance,executionReport:this.handleOrderUpdate,ORDER_TRADE_UPDATE:this.handleOrderUpdate};let s=this.safeString(t,"e");if(Array.isArray(t)){const e=t[0];s=this.safeString(e,"e")+"@arr"}const r=this.safeValue(i,s);if(void 0!==r)return r.call(this,e,t);if(void 0!==this.safeString(t,"id"))return this.handleSubscriptionStatus(e,t);void 0===s&&this.handleTicker(e,t)}}},96019:function(e,t,i){"use strict";const s=i(77934);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"binancecoinm",name:"Binance COIN-M",urls:{logo:"https://user-images.githubusercontent.com/1294454/117738721-668c8d80-b205-11eb-8c49-3fad84c4a07f.jpg"},options:{fetchMarkets:["inverse"],defaultSubType:"inverse"}})}}},77752:function(e,t,i){"use strict";const s=i(77934);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"binanceus",name:"Binance US",countries:["US"],certified:!1,urls:{logo:"https://user-images.githubusercontent.com/1294454/65177307-217b7c80-da5f-11e9-876e-0b748ba0a358.jpg",api:{ws:{spot:"wss://stream.binance.us:9443/ws"},web:"https://www.binance.us",wapi:"https://api.binance.us/wapi/v3",public:"https://api.binance.us/api/v1",private:"https://api.binance.us/api/v3",v3:"https://api.binance.us/api/v3",v1:"https://api.binance.us/api/v1"},www:"https://www.binance.us",referral:"https://www.binance.us/?ref=35005074",doc:"https://github.com/binance-us/binance-official-api-docs",fees:"https://www.binance.us/en/fee/schedule"},options:{fetchCurrencies:!1,quoteOrderQty:!1,defaultType:"spot",fetchMarkets:["spot"]},fees:{trading:{tierBased:!1,percentage:!0,taker:0,maker:0}}})}}},88390:function(e,t,i){"use strict";const s=i(77934);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"binanceusdm",name:"Binance USDⓈ-M",urls:{logo:"https://user-images.githubusercontent.com/1294454/117738721-668c8d80-b205-11eb-8c49-3fad84c4a07f.jpg"},options:{fetchMarkets:["linear"],defaultSubType:"linear"}})}}},12294:function(e,t,i){"use strict";const s=i(59306);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"bitcoincom",name:"bitcoin.com",countries:["KN"],urls:{logo:"https://user-images.githubusercontent.com/1294454/97296144-514fa300-1861-11eb-952b-3d55d492200b.jpg",api:{ws:"wss://api.fmfw.io/api/2/ws"}},fees:{trading:{maker:this.parseNumber("0.0015"),taker:this.parseNumber("0.002")}}})}}},8129:function(e,t,i){"use strict";const s=i(17965),{ExchangeError:r,AuthenticationError:a}=i(73449),{ArrayCache:n,ArrayCacheBySymbolById:o}=i(56062),h=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchTicker:!0,watchTickers:!1,watchOrderBook:!0,watchTrades:!0,watchBalance:!1,watchOHLCV:!1},urls:{api:{ws:{public:"wss://api-pub.bitfinex.com/ws/1",private:"wss://api.bitfinex.com/ws/1"}}},options:{watchOrderBook:{prec:"P0",freq:"F0"},ordersLimit:1e3}})}async subscribe(e,t,i={}){await this.loadMarkets();const s=this.market(t).id,r=this.urls.api.ws.public,a=e+":"+s,n={event:"subscribe",channel:e,symbol:s,messageHash:a};return await this.watch(r,a,this.deepExtend(n,i),a)}async watchTrades(e,t,i,s={}){await this.loadMarkets(),e=this.symbol(e);const r=await this.subscribe("trades",e,s);return this.newUpdates&&(i=r.getLimit(e,i)),this.filterBySinceLimit(r,t,i,"timestamp",!0)}async watchTicker(e,t={}){return await this.subscribe("ticker",e,t)}handleTrades(e,t,i){const s=this.safeValue(i,"channel"),r=this.safeString(i,"pair"),a=s+":"+r,o=this.safeInteger(this.options,"tradesLimit",1e3),h=this.safeMarket(r),d=h.symbol,c=this.safeValue(t,1);let l=this.safeValue(this.trades,d);if(void 0===l&&(l=new n(o),this.trades[d]=l),Array.isArray(c)){const e=this.parseTrades(c,h);for(let t=0;t<e.length;t++)l.append(e[t])}else{if("tu"!==this.safeString(t,1))return;const e=this.parseTrade(t,h);l.append(e)}return e.resolve(l,a),t}parseTrade(e,t){if(!Array.isArray(e))return super.parseTrade(e,t);const i=e.length;let s;"tu"===this.safeString(e,1)&&(s=this.safeString(e,i-4));const r=this.safeTimestamp(e,i-3),a=this.safeFloat(e,i-2);let n,o,h=this.safeFloat(e,i-1);void 0!==h&&(n=h>0?"buy":"sell",h=Math.abs(h)),void 0!==a&&void 0!==h&&(o=a*h);const d=this.safeString(e,2).split("-");let c=this.safeString(d,1);void 0!==c&&(c=c.replace("t",""));const l=this.safeSymbol(c,t);return{info:e,timestamp:r,datetime:this.iso8601(r),symbol:l,id:s,order:undefined,type:void 0,takerOrMaker:undefined,side:n,price:a,amount:h,cost:o,fee:void 0}}handleTicker(e,t,i){const s=this.milliseconds(),r=this.safeString(i,"pair"),a=this.safeSymbol(r),n="ticker:"+r,o=this.safeString(t,7),d=this.safeString(t,5);let c;void 0!==o&&void 0!==d&&(c=h.stringSub(o,d));const l={symbol:a,timestamp:s,datetime:this.iso8601(s),high:this.safeFloat(t,9),low:this.safeFloat(t,10),bid:this.safeFloat(t,1),bidVolume:void 0,ask:this.safeFloat(t,3),askVolume:void 0,vwap:void 0,open:this.parseNumber(c),close:this.parseNumber(o),last:this.parseNumber(o),previousClose:void 0,change:this.parseNumber(d),percentage:this.safeFloat(t,6),average:void 0,baseVolume:this.safeFloat(t,8),quoteVolume:void 0,info:t};this.tickers[a]=l,e.resolve(l,n)}async watchOrderBook(e,t,i={}){if(void 0!==t&&25!==t&&100!==t)throw new r(this.id+" watchOrderBook limit argument must be undefined, 25 or 100");const s=this.safeValue(this.options,"watchOrderBook",{}),a={prec:this.safeString(s,"prec","P0"),freq:this.safeString(s,"freq","F0"),len:t};return(await this.subscribe("book",e,this.deepExtend(a,i))).limit()}handleOrderBook(e,t,i){const s=this.safeString(i,"pair"),r=this.safeSymbol(s),a="book:"+s,n="R0"===this.safeString(i,"prec","P0");if(Array.isArray(t[1])){const s=this.safeInteger(i,"len");this.orderbooks[r]=n?this.indexedOrderBook({},s):this.countedOrderBook({},s);const o=this.orderbooks[r];if(n){const e=t[1];for(let t=0;t<e.length;t++){const i=e[t],s=this.safeString(i,0),r=this.safeFloat(i,1),a=i[2]<0?-i[2]:i[2];o[i[2]<0?"asks":"bids"].store(r,a,s)}}else{const e=t[1];for(let t=0;t<e.length;t++){const i=e[t],s=i[2]<0?-i[2]:i[2];o[i[2]<0?"asks":"bids"].store(i[0],s,i[1])}}e.resolve(o,a)}else{const i=this.orderbooks[r];if(n){const e=this.safeString(t,1),s=this.safeFloat(t,2),r=t[3]<0?-t[3]:t[3],a=s>0?r:0;i[t[3]<0?"asks":"bids"].store(s,a,e)}else{const e=t[3]<0?-t[3]:t[3];i[t[3]<0?"asks":"bids"].store(t[1],e,t[2])}e.resolve(i,a)}}handleHeartbeat(e,t){const i=this.safeString(t,"event");e.resolve(t,i)}handleSystemStatus(e,t){return t}handleSubscriptionStatus(e,t){const i=this.safeString(t,"chanId");return e.subscriptions[i]=t,t}async authenticate(e={}){const t=this.urls.api.ws.private,i=this.client(t),s=i.future("authenticated"),r="auth";if(void 0===this.safeValue(i.subscriptions,r)){const e=this.milliseconds(),i="AUTH"+e.toString(),s=this.hmac(this.encode(i),this.encode(this.secret),"sha384","hex"),a={apiKey:this.apiKey,authSig:s,authNonce:e,authPayload:i,event:r,filter:["trading","wallet"]};this.spawn(this.watch,t,r,a,1)}return await s}handleAuthenticationMessage(e,t){if("OK"===this.safeString(t,"status")){this.safeValue(e.futures,"authenticated").resolve(!0)}else{const i=new a(this.json(t));e.reject(i,"authenticated");const s=this.safeString(t,"event");s in e.subscriptions&&delete e.subscriptions[s]}}async watchOrder(e,t,i={}){await this.loadMarkets();const s=this.urls.api.ws.private;return await this.authenticate(),await this.watch(s,e,void 0,1)}async watchOrders(e,t,i,s={}){await this.loadMarkets(),await this.authenticate(),void 0!==e&&(e=this.symbol(e));const r=this.urls.api.ws.private,a=await this.watch(r,"os",void 0,1);return this.newUpdates&&(i=a.getLimit(e,i)),this.filterBySymbolSinceLimit(a,e,t,i,!0)}handleOrders(e,t,i){const s=this.safeValue(t,2,[]);if("os"===this.safeString(t,1))for(let t=0;t<s.length;t++){const i=s[t];this.handleOrder(e,i)}else this.handleOrder(e,s);void 0!==this.orders&&e.resolve(this.orders,"os")}parseWsOrderStatus(e){return this.safeString({ACTIVE:"open",CANCELED:"canceled"},e,e)}handleOrder(e,t){const i=this.safeString(t,0),s=this.safeString(t,1),r=this.safeSymbol(s);let a=this.safeString(t,2),n=this.safeString(t,3),d="buy";h.stringLt(a,"0")&&(a=h.stringAbs(a),n=h.stringAbs(n),d="sell");let c=this.safeString(t,4);c.indexOf("LIMIT")>-1?c="limit":c.indexOf("MARKET")>-1&&(c="market");const l=this.parseWsOrderStatus(this.safeString(t,5)),u=this.safeString(t,6),f=this.safeString(t,8),p=this.parse8601(f),m=this.safeOrder({info:t,id:i,clientOrderId:void 0,timestamp:p,datetime:this.iso8601(p),lastTradeTimestamp:void 0,symbol:r,type:c,side:d,price:u,stopPrice:void 0,triggerPrice:void 0,average:void 0,amount:a,remaining:n,filled:void 0,status:l,fee:void 0,cost:void 0,trades:void 0});if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new o(e)}return this.orders.append(m),e.resolve(m,i),m}handleMessage(e,t){if(Array.isArray(t)){const i=this.safeString(t,0);if("hb"===t[1])return t;const s=this.safeValue(e.subscriptions,i,{}),r=this.safeString(s,"channel"),a=this.safeString(t,1),n={book:this.handleOrderBook,ticker:this.handleTicker,trades:this.handleTrades,os:this.handleOrders,on:this.handleOrders,oc:this.handleOrders},o=this.safeValue2(n,r,a);return void 0===o?t:o.call(this,e,t,s)}{const i=this.safeString(t,"event");if(void 0!==i){const s={info:this.handleSystemStatus,subscribed:this.handleSubscriptionStatus,auth:this.handleAuthenticationMessage},r=this.safeValue(s,i);return void 0===r?t:r.call(this,e,t)}}}}},43501:function(e,t,i){"use strict";const s=i(5328),r=i(6832),{ExchangeError:a,AuthenticationError:n,InvalidNonce:o}=i(73449),{ArrayCache:h,ArrayCacheBySymbolById:d,ArrayCacheByTimestamp:c}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchTicker:!0,watchTickers:!1,watchOrderBook:!0,watchTrades:!0,watchMyTrades:!0,watchBalance:!0,watchOHLCV:!0,watchOrders:!0},urls:{api:{ws:{public:"wss://api-pub.bitfinex.com/ws/2",private:"wss://api.bitfinex.com/ws/2"}}},options:{watchOrderBook:{prec:"P0",freq:"F0"},ordersLimit:1e3,checksum:!0}})}async subscribe(e,t,i={}){await this.loadMarkets();const s=this.market(t).id,r=this.urls.api.ws.public,a=this.client(r),n=e+":"+s,o={event:"subscribe",channel:e,symbol:s},h=await this.watch(r,n,this.deepExtend(o,i),n,{checksum:!1});return this.safeValue(this.options,"checksum",!0)&&!a.subscriptions[n].checksum&&"book"===e&&(a.subscriptions[n].checksum=!0,a.send({event:"conf",flags:131072})),h}async subscribePrivate(e){await this.loadMarkets(),await this.authenticate();const t=this.urls.api.ws.private;return await this.watch(t,e,void 0,1)}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;const n=this.safeString(this.timeframes,t,t),o="candles",h="trade:"+n+":"+a.id,d=o+":"+n+":"+a.id,c={event:"subscribe",channel:o,key:h},l=this.urls.api.ws.public,u=await this.watch(l,d,this.deepExtend(c,r),d);return this.newUpdates&&(s=u.getLimit(e,s)),this.filterBySinceLimit(u,i,s,0,!0)}handleOHLCV(e,t,i){const s=this.safeValue(t,1,[]);let r;const a=this.safeValue(s,0);r=Array.isArray(a)?s:[s];const n=this.safeValue(i,"channel"),o=this.safeString(i,"key"),h=o.split(":"),d=this.safeString(h,1);let l=o;l=l.replace("trade:",""),l=l.replace(d+":","");const u=this.safeMarket(l),f=this.findTimeframe(d),p=u.symbol,m=n+":"+d+":"+l;this.ohlcvs[p]=this.safeValue(this.ohlcvs,p,{});let g=this.safeValue(this.ohlcvs[p],f);if(void 0===g){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);g=new c(e),this.ohlcvs[p][f]=g}const y=r.length;for(let e=0;e<y;e++){const t=r[y-e-1],i=this.parseOHLCV(t,u);g.append(i)}e.resolve(g,m)}async watchTrades(e,t,i,s={}){const r=await this.subscribe("trades",e,s);return this.newUpdates&&(i=r.getLimit(e,i)),this.filterBySinceLimit(r,t,i,"timestamp",!0)}async watchMyTrades(e,t,i,s={}){await this.loadMarkets();let r="myTrade";if(void 0!==e){r+=":"+this.market(e).id}const a=await this.subscribePrivate(r);return this.newUpdates&&(i=a.getLimit(e,i)),this.filterBySymbolSinceLimit(a,e,t,i,!0)}async watchTicker(e,t={}){return await this.subscribe("ticker",e,t)}handleMyTrade(e,t,i={}){const s="myTrade",r=this.safeValue(t,2),a=this.parseWsTrade(r,!1),n=a.symbol,o=s+":"+this.market(n).id;if(void 0===this.myTrades){const e=this.safeInteger(this.options,"tradesLimit",1e3);this.myTrades=new d(e)}const h=this.myTrades;h.append(a),this.myTrades=h,e.resolve(h,s),e.resolve(h,o)}handleTrades(e,t,i){const s=this.safeValue(i,"channel"),r=this.safeString(i,"symbol"),a=this.safeMarket(r),n=s+":"+r,o=this.safeInteger(this.options,"tradesLimit",1e3),d=a.symbol;let c=this.safeValue(this.trades,d);void 0===c&&(c=new h(o),this.trades[d]=c);if(2===t.length){const e=this.safeValue(t,1,[]);for(let t=0;t<e.length;t++){const i=this.parseWsTrade(e[t],true,a);c.append(i)}}else{if("tu"===this.safeString(t,1))return;const e=this.safeValue(t,2,[]),i=this.parseWsTrade(e,true,a);c.append(i)}return e.resolve(c,n),t}parseWsTrade(e,t=!1,i){let s=t?void 0:this.safeString(e,1);const a=t?1:2,n=t?3:5,o=t?2:4;s=(i=this.safeMarket(s,i)).id;let h=this.safeString(e,6);void 0!==h&&(h.indexOf("LIMIT")>-1?h="limit":h.indexOf("MARKET")>-1&&(h="market"));const d=t?void 0:this.safeString(e,3),c=this.safeString(e,0),l=this.safeInteger(e,a),u=this.safeString(e,n),f=this.safeString(e,o),p=this.parseNumber(r.stringAbs(f));let m;void 0!==p&&(m=r.stringGt(f,"0")?"buy":"sell");const g=this.safeSymbol(s,i),y=this.safeString(e,9);let b;if(void 0!==y){const t=this.safeString(e,10);b={cost:y,currency:this.safeCurrencyCode(t)}}const v=this.safeInteger(e,8);let w;return void 0!==v&&(w=-1===v?"taker":"maker"),this.safeTrade({info:e,timestamp:l,datetime:this.iso8601(l),symbol:g,id:c,order:d,type:h,takerOrMaker:w,side:m,price:u,amount:p,cost:void 0,fee:b},i)}handleTicker(e,t,i){const s=this.safeValue(t,1),r=this.safeString(i,"symbol"),a=this.safeMarket(r),n=this.safeSymbol(r),o=this.parseWsTicker(s,a),h="ticker:"+r;this.tickers[n]=o,e.resolve(o,h)}parseWsTicker(e,t){const i=(t=this.safeMarket(void 0,t)).symbol,s=this.safeString(e,6),r=this.safeString(e,4);return this.safeTicker({symbol:i,timestamp:void 0,datetime:void 0,high:this.safeString(e,8),low:this.safeString(e,9),bid:this.safeString(e,0),bidVolume:this.safeString(e,1),ask:this.safeString(e,2),askVolume:this.safeString(e,3),vwap:void 0,open:void 0,close:s,last:s,previousClose:void 0,change:r,percentage:this.safeString(e,5),average:void 0,baseVolume:this.safeString(e,7),quoteVolume:void 0,info:e},t)}async watchOrderBook(e,t,i={}){if(void 0!==t&&25!==t&&100!==t)throw new a(this.id+" watchOrderBook limit argument must be undefined, 25 or 100");const s=this.safeValue(this.options,"watchOrderBook",{}),r={prec:this.safeString(s,"prec","P0"),freq:this.safeString(s,"freq","F0")};void 0!==t&&(r.len=t);return(await this.subscribe("book",e,this.deepExtend(r,i))).limit()}handleOrderBook(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeSymbol(s),a="book:"+s,n="R0"===this.safeString(i,"prec","P0"),o=this.safeString(t,0);let h=this.safeValue(this.orderbooks,r);if(void 0===h){const s=this.safeInteger(i,"len");if(this.orderbooks[r]=n?this.indexedOrderBook({},s):this.countedOrderBook({},s),h=this.orderbooks[r],n){const e=t[1];for(let t=0;t<e.length;t++){const i=e[t],s=i[2]<0?-i[2]:i[2],r=h[i[2]<0?"asks":"bids"],a=this.safeString(i,0),n=this.safeFloat(i,1);r.store(n,s,a)}}else{const e=t[1];for(let t=0;t<e.length;t++){const i=e[t],s=this.safeNumber(i,2),r=this.safeNumber(i,1),a=this.safeNumber(i,0),n=s<0?-s:s;h[s<0?"asks":"bids"].store(a,n,r)}}e.resolve(h,a)}else{const i=t[1],s=this.orderbooks[r];if(n){const e=this.safeFloat(i,1),t=i[2]<0?-i[2]:i[2],r=e>0?t:0;s[i[2]<0?"asks":"bids"].store(e,r,o)}else{const e=this.safeNumber(i,2),t=this.safeNumber(i,1),r=this.safeNumber(i,0),a=e<0?-e:e;s[e<0?"asks":"bids"].store(r,a,t)}e.resolve(s,a)}}handleChecksum(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeSymbol(s),a="book:"+s,n=this.safeValue(this.orderbooks,r);if(void 0===n)return;const h=this.safeInteger(i,"len"),d=[],c=n.bids,l=n.asks;for(let e=0;e<h;e++)d.push(c[e][0]),d.push(c[e][1]),d.push(l[e][0]),d.push(-l[e][1]);const u=d.join(":"),f=this.crc32(u,!0);if(this.safeInteger(t,2)!==f){const t=new o(this.id+" invalid checksum");e.reject(t,a)}}async watchBalance(e={}){await this.loadMarkets();const t=this.safeString(e,"wallet","exchange");e=this.omit(e,"wallet");const i="balance:"+t;return await this.subscribePrivate(i)}handleBalance(e,t,i){let s;s="ws"===this.safeValue(t,1)?this.safeValue(t,2):[this.safeValue(t,2)];const r={};for(let e=0;e<s.length;e++){const i=s[e],a=this.safeString(i,1),n=this.safeCurrencyCode(a),o=this.parseWsBalance(i),h=this.safeString(i,0),d=this.safeValue(this.balance,h,{});d[n]=o,d.info=t,this.balance[h]=this.safeBalance(d),r[h]=!0}const a=Object.keys(r);for(let t=0;t<a.length;t++){const i=a[t],s="balance:"+i;e.resolve(this.balance[i],s)}}parseWsBalance(e){const t=this.safeString(e,2),i=this.safeString(e,4),s=this.account();return void 0!==i&&(s.free=i),s.total=t,s}handleSystemStatus(e,t){return t}handleSubscriptionStatus(e,t){const i=this.safeString(t,"chanId");return e.subscriptions[i]=t,t}authenticate(e={}){const t=this.urls.api.ws.private,i=this.client(t),s="authenticate";let r=this.safeValue(i.subscriptions,s);if(void 0===r){const a=this.milliseconds(),n="AUTH"+a.toString(),o=this.hmac(this.encode(n),this.encode(this.secret),"sha384","hex"),h="auth",d={apiKey:this.apiKey,authSig:o,authNonce:a,authPayload:n,event:h},c=this.extend(d,e);r=this.watch(t,s,c),i.subscriptions[s]=r}return r}handleAuthenticationMessage(e,t){const i="authenticated";if("OK"===this.safeString(t,"status"))e.resolve(t,i);else{const s=new n(this.json(t));e.reject(s,i),i in e.subscriptions&&delete e.subscriptions[i]}}async watchOrders(e,t,i,s={}){await this.loadMarkets();let r="orders";if(void 0!==e){r+=":"+this.market(e).id}const a=await this.subscribePrivate(r);return this.newUpdates&&(i=a.getLimit(e,i)),this.filterBySymbolSinceLimit(a,e,t,i,!0)}handleOrders(e,t,i){const s=this.safeValue(t,2,[]),r=this.safeString(t,1);if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new d(e)}const a=this.orders,n={};if("os"===r){if(0===s.length)return;for(let e=0;e<s.length;e++){const t=s[e],i=this.parseWsOrder(t);n[i.symbol]=!0,a.append(i)}}else{const e=this.parseWsOrder(s);a.append(e)}const o="orders";e.resolve(this.orders,o);const h=Object.keys(n);for(let t=0;t<h.length;t++){const i=h[t],s=o+":"+this.safeMarket(i).id;e.resolve(this.orders,s)}}parseWsOrderStatus(e){return this.safeString({ACTIVE:"open",CANCELED:"canceled",EXECUTED:"closed","PARTIALLY FILLED":"open"},e,e)}parseWsOrder(e,t){const i=this.safeString(e,0),s=this.safeString(e,1),a=this.safeString(e,3),n=this.safeSymbol(a);t=this.safeMarket(n);let o=this.safeNumber(e,7),h="buy";o<0&&(o=Math.abs(o),h="sell");const d=r.stringAbs(this.safeString(e,6));let c=this.safeString(e,8);c.indexOf("LIMIT")>-1?c="limit":c.indexOf("MARKET")>-1&&(c="market");const l=this.safeString(e,13).split(" "),u=this.safeString(l,0),f=this.parseWsOrderStatus(u),p=this.safeString(e,16),m=this.safeInteger(e,4),g=this.safeString(e,17),y=this.omitZero(this.safeString(e,18));return this.safeOrder({info:e,id:i,clientOrderId:s,timestamp:m,datetime:this.iso8601(m),lastTradeTimestamp:void 0,symbol:n,type:c,side:h,price:p,stopPrice:y,triggerPrice:y,average:g,amount:o,remaining:d,filled:void 0,status:f,fee:void 0,cost:void 0,trades:void 0},t)}handleMessage(e,t){const i=this.safeString(t,0);if(Array.isArray(t)){if("hb"===t[1])return t;const s=this.safeValue(e.subscriptions,i,{}),r=this.safeString(s,"channel"),a=this.safeString(t,1),n={book:this.handleOrderBook,cs:this.handleChecksum,candles:this.handleOHLCV,ticker:this.handleTicker,trades:this.handleTrades},o={os:this.handleOrders,ou:this.handleOrders,on:this.handleOrders,oc:this.handleOrders,wu:this.handleBalance,ws:this.handleBalance,tu:this.handleMyTrade};let h;return h="0"===i?this.safeValue(o,a):this.safeValue2(n,a,r),void 0===h?t:h.call(this,e,t,s)}{const i=this.safeString(t,"event");if(void 0!==i){const s={info:this.handleSystemStatus,subscribed:this.handleSubscriptionStatus,auth:this.handleAuthenticationMessage},r=this.safeValue(s,i);return void 0===r?t:r.call(this,e,t)}}}}},96085:function(e,t,i){"use strict";const s=i(20829),{AuthenticationError:r,BadRequest:a,ArgumentsRequired:n,NotSupported:o,InvalidNonce:h}=i(73449),d=i(6832),{ArrayCache:c,ArrayCacheBySymbolById:l,ArrayCacheByTimestamp:u}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchMyTrades:!0,watchOHLCV:!0,watchOrderBook:!0,watchOrders:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0},urls:{api:{ws:"wss://ws.bitget.com/spot/v1/stream"}},options:{tradesLimit:1e3,OHLCVLimit:1e3,timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1H","4h":"4H","6h":"6H","12h":"12H","1d":"1D","1w":"1W"}},streaming:{ping:this.ping},exceptions:{ws:{exact:{30001:a,30015:r}}}})}getWsMarketId(e){const t=this.safeValue(this.options,"sandboxMode",!1);return e.spot?e.info.symbolName:t?e.id.replace("_SUMCBL",""):e.id.replace("_UMCBL","")}getMarketIdFromArg(e){const t=this.safeString(e,"instType"),i=this.safeValue(this.options,"sandboxMode",!1);let s=this.safeString(e,"instId");return s+="sp"===t?"_SPBL":i?"_SUMCBL":"_UMCBL",s}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s="ticker:"+(e=i.symbol),r={instType:i.spot?"sp":"mc",channel:"ticker",instId:this.getWsMarketId(i)};return await this.watchPublic(s,r,t)}handleTicker(e,t){const i=this.parseWsTicker(t),s=i.symbol;this.tickers[s]=i;const r="ticker:"+s;return e.resolve(i,r),t}parseWsTicker(e,t){const i=this.safeValue(e,"arg",{}),s=this.safeValue(e,"data",[]),r=this.safeValue(s,0,{}),a=this.safeInteger2(r,"ts","systemTime"),n=this.getMarketIdFromArg(i);t=this.safeMarket(n,t);const o=this.safeString(r,"last"),h=this.safeString(r,"open24h"),d=this.safeString(r,"high24h"),c=this.safeString(r,"low24h"),l=this.safeString(r,"baseVolume"),u=this.safeString(r,"quoteVolume"),f=this.safeString(r,"bestBid"),p=this.safeString(r,"bestAsk");return this.safeTicker({symbol:t.symbol,timestamp:a,datetime:this.iso8601(a),high:d,low:c,bid:f,bidVolume:void 0,ask:p,askVolume:void 0,vwap:void 0,open:h,close:o,last:o,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:l,quoteVolume:u,info:r},t)}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;const n=this.safeValue(this.options,"timeframes"),o=this.safeString(n,t),h="candles:"+t+":"+e,d={instType:a.spot?"sp":"mc",channel:"candle"+o,instId:this.getWsMarketId(a)},c=await this.watchPublic(h,d,r);return this.newUpdates&&(s=c.getLimit(e,s)),this.filterBySinceLimit(c,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeValue(t,"arg",{}),s=this.getMarketIdFromArg(i),r=this.safeString(i,"channel").replace("candle",""),a=this.safeValue(this.options,"timeframes"),n=this.findTimeframe(r,a),o=this.safeMarket(s).symbol;this.ohlcvs[o]=this.safeValue(this.ohlcvs,o,{});let h=this.safeValue(this.ohlcvs[o],n);if(void 0===h){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);h=new u(e),this.ohlcvs[o][n]=h}const d=this.safeValue(t,"data",[]);for(let e=0;e<d.length;e++){const t=this.parseWsOHLCV(d[e]);h.append(t)}const c="candles:"+n+":"+o;e.resolve(h,c)}parseWsOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r="orderbook:"+(e=s.symbol),a=s.spot?"sp":"mc";let n="books",o=!0;5!==t&&15!==t||(n+=t.toString(),o=!1);const h={instType:a,channel:n,instId:this.getWsMarketId(s)},d=await this.watchPublic(r,h,i);return o?d.limit():d}handleOrderBook(e,t){const i=this.safeValue(t,"arg"),s=this.safeString(i,"channel"),r=this.getMarketIdFromArg(i),a=this.safeMarket(r).symbol,n="orderbook:"+a,o=this.safeValue(t,"data"),d=this.safeValue(o,0),c=this.safeInteger(d,"ts");let l;if("books"===s){l=this.safeValue(this.orderbooks,a),void 0===l&&(l=this.countedOrderBook({}));const t=this.safeValue(d,"asks",[]),i=this.safeValue(d,"bids",[]);this.handleDeltas(l.asks,t),this.handleDeltas(l.bids,i),l.timestamp=c,l.datetime=this.iso8601(c);if(this.safeValue(this.options,"checksum",!0)){const t=l.asks,i=l.bids,s=t.length,r=i.length,a=[];for(let e=0;e<25;e++)e<r&&(a.push(i[e][2][0]),a.push(i[e][2][1])),e<s&&(a.push(t[e][2][0]),a.push(t[e][2][1]));const o=a.join(":");if(this.crc32(o,!0)!==this.safeInteger(d,"checksum")){const t=new h(this.id+" invalid checksum");e.reject(t,n)}}}else l=this.parseOrderBook(d,a,c);this.orderbooks[a]=l,e.resolve(l,n)}handleDelta(e,t){const i=this.parseBidAsk(t,0,1);i.push(t),e.storeArray(i)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a="trade:"+(e=r.symbol),n={instType:r.spot?"sp":"mc",channel:"trade",instId:this.getWsMarketId(r)},o=await this.watchPublic(a,n,s);return this.newUpdates&&(i=o.getLimit(e,i)),this.filterBySinceLimit(o,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeValue(t,"arg",{}),s=this.getMarketIdFromArg(i),r=this.safeMarket(s),a=r.symbol;let n=this.safeValue(this.trades,a);if(void 0===n){const e=this.safeInteger(this.options,"tradesLimit",1e3);n=new c(e),this.trades[a]=n}const o=this.safeValue(t,"data",[]);for(let e=0;e<o.length;e++){const t=o[e],i=this.parseWsTrade(t,r);n.append(i)}const h="trade:"+a;e.resolve(n,h)}parseWsTrade(e,t){t=this.safeMarket(void 0,t);const i=this.safeInteger(e,0),s=this.safeString(e,3),r=this.safeString(e,1),a=this.safeString(e,2);return this.safeTrade({info:e,id:void 0,order:void 0,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,type:void 0,side:s,takerOrMaker:void 0,price:r,amount:a,cost:void 0,fee:void 0},t)}async watchOrders(e,t,i,s={}){let r,a;await this.loadMarkets();let o="order";let h;if(void 0!==e&&(r=this.market(e),e=r.symbol,a=r.id,o=o+":"+e),[h,s]=this.handleMarketTypeAndParams("watchOrders",r,s),"spot"===h&&void 0===e)throw new n(this.id+" watchOrders requires a symbol argument for "+h+" markets.");const d=this.safeValue(this.options,"sandboxMode",!1);let c;c="spot"===h?"spbl":d?"SUMCBL":"UMCBL";const l={instType:c,channel:"orders",instId:"spot"===h?a:"default"},u=await this.watchPrivate(o,"order:trades",l,s);return this.newUpdates&&(i=u.getLimit(e,i)),this.filterBySymbolSinceLimit(u,e,t,i,!0)}handleOrder(e,t,i){const s=this.safeValue(t,"arg",{}),r=this.safeString(s,"instType"),a=this.safeValue(this.options,"sandboxMode",!1)?"sumcbl"===r:"umcbl"===r,n=this.safeValue(t,"data",[]);if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new l(e)}const o=this.orders,h={};for(let t=0;t<n.length;t++){const i=n[t];"T"===this.safeString(i,"execType")&&a&&this.handleMyTrades(e,i);const s=this.parseWsOrder(i);o.append(s);h[s.symbol]=!0}const d=Object.keys(h);for(let t=0;t<d.length;t++){const i="order:"+d[t];e.resolve(o,i)}e.resolve(o,"order")}parseWsOrder(e,t){const i=this.safeString(e,"instId");t=this.safeMarket(i,t);const s=this.safeString(e,"ordId"),r=this.safeString(e,"clOrdId"),a=this.safeString(e,"px"),n=this.safeString(e,"fillSz"),o=this.safeString(e,"sz"),h=this.safeString2(e,"notional","notionalUsd"),c=this.omitZero(this.safeString(e,"avgPx")),l=this.safeString(e,"ordType"),u=this.safeInteger(e,"cTime"),f=t.symbol;let p=this.safeString2(e,"side","posSide");"open_long"===p||"close_short"===p?p="buy":"close_long"!==p&&"open_short"!==p||(p="sell");const m=this.safeString(e,"status","state"),g=this.safeString(e,"force"),y=this.parseWsOrderStatus(m),b=this.safeValue(e,"orderFee",[]),v=this.safeValue(b,0),w=this.safeString(v,"fee");let S;if(void 0!==w){const e=this.safeString(v,"feeCcy");S={cost:d.stringAbs(w),currency:this.safeCurrencyCode(e)}}return this.safeOrder({info:e,symbol:f,id:s,clientOrderId:r,timestamp:u,datetime:this.iso8601(u),lastTradeTimestamp:void 0,type:l,timeInForce:g,postOnly:void 0,side:p,price:a,stopPrice:void 0,triggerPrice:void 0,amount:o,cost:h,average:c,filled:n,remaining:void 0,status:y,fee:S,trades:void 0},t)}parseWsOrderStatus(e){return this.safeString({new:"open","partial-fill":"open","full-fill":"closed",filled:"closed",cancelled:"canceled"},e,e)}async watchMyTrades(e,t,i,s={}){let r;await this.loadMarkets();let a,n="myTrades";if(void 0!==e&&(r=this.market(e),n=n+":"+(e=r.symbol)),[a,s]=this.handleMarketTypeAndParams("watchMyTrades",r,s),"spot"===a)throw new o(this.id+" watchMyTrades is not supported for "+a+" markets.");const h={instType:this.safeValue(this.options,"sandboxMode",!1)?"sumcbl":"umcbl",channel:"orders",instId:"default"},d=await this.watchPrivate(n,"order:trades",h,s);return this.newUpdates&&(i=d.getLimit(e,i)),this.filterBySymbolSinceLimit(d,e,t,i,!0)}handleMyTrades(e,t){if(void 0===this.myTrades){const e=this.safeInteger(this.options,"tradesLimit",1e3);this.myTrades=new c(e)}const i=this.myTrades,s=this.parseWsMyTrade(t);i.append(s);const r=s.symbol;e.resolve(i,"myTrades");const a="myTrades:"+r;e.resolve(i,a)}parseWsMyTrade(e,t){const i=this.safeString(e,"tradeId"),s=this.safeString(e,"ordId"),r=this.safeString(e,"instId");t=this.safeMarket(r,t);const a=this.safeInteger(e,"fillTime"),n=this.safeString(e,"side"),o=this.safeString(e,"fillPx"),h=this.safeString(e,"fillSz"),c=this.safeString(e,"ordType"),l=this.safeString(e,"notional"),u=this.safeString(e,"fillFeeCcy"),f=d.stringAbs(this.safeString(e,"fillFee")),p={code:this.safeCurrencyCode(u),cost:f};return this.safeTrade({info:e,id:i,order:s,timestamp:a,datetime:this.iso8601(a),symbol:t.symbol,type:c,side:n,takerOrMaker:void 0,price:o,amount:h,cost:l,fee:p},t)}async watchBalance(e={}){let t;[t,e]=this.handleMarketTypeAndParams("watchOrders",void 0,e);const i="spot"===t?"spbl":"umcbl",s={instType:i,channel:"account",instId:"default"},r="balance:"+i;return await this.watchPrivate(r,r,s,e)}handleBalance(e,t){const i=this.safeValue(t,"data",[]);for(let e=0;e<i.length;e++){const t=i[e],s=this.safeString(t,"coinName"),r=this.safeCurrencyCode(s),a=r in this.balance?this.balance[r]:this.account();a.free=this.safeString(t,"available"),this.balance[r]=a}this.balance=this.safeBalance(this.balance);const s=this.safeValue(t,"arg"),r="balance:"+this.safeStringLower(s,"instType");e.resolve(this.balance,r)}async watchPublic(e,t,i={}){const s=this.urls.api.ws,r={op:"subscribe",args:[t]},a=this.extend(r,i);return await this.watch(s,e,a,e)}authenticate(e={}){this.checkRequiredCredentials();const t=this.urls.api.ws,i=this.client(t),s="authenticated";let r=this.safeValue(i.subscriptions,s);if(void 0===r){const a=this.seconds().toString(),n=a+"GET/user/verify",o=this.hmac(this.encode(n),this.encode(this.secret),"sha256","base64"),h={op:"login",args:[{apiKey:this.apiKey,passphrase:this.password,timestamp:a,sign:o}]},d=this.extend(h,e);r=this.watch(t,s,d),i.subscriptions[s]=r}return r}async watchPrivate(e,t,i,s={}){await this.authenticate();const r=this.urls.api.ws,a={op:"subscribe",args:[i]},n=this.extend(a,s);return await this.watch(r,e,n,t)}handleAuthenticate(e,t){e.resolve(t,"authenticated")}handleErrorMessage(e,t){const i=this.safeString(t,"event");try{if("error"===i){const e=this.safeString(t,"code"),i=this.id+" "+this.json(t);this.throwExactlyMatchedException(this.exceptions.ws.exact,e,i)}return!1}catch(t){if(t instanceof r){const i="authenticated";e.reject(t,i),i in e.subscriptions&&delete e.subscriptions[i]}return!0}}handleMessage(e,t){if(this.handleErrorMessage(e,t))return;if("pong"===this.safeString(t,"message"))return void this.handlePong(e,t);if("pong"===t)return void this.handlePong(e,t);const i=this.safeString(t,"event");if("login"===i)return void this.handleAuthenticate(e,t);if("subscribe"===i)return void this.handleSubscriptionStatus(e,t);const s={ticker:this.handleTicker,trade:this.handleTrades,orders:this.handleOrder,account:this.handleBalance},r=this.safeValue(t,"arg",{}),a=this.safeValue(r,"channel",""),n=this.safeValue(s,a);void 0!==n&&n.call(this,e,t),a.indexOf("candle")>=0&&this.handleOHLCV(e,t),a.indexOf("books")>=0&&this.handleOrderBook(e,t)}ping(e){return"ping"}handlePong(e,t){return e.lastPong=this.milliseconds(),t}handleSubscriptionStatus(e,t){return t}}},72410:function(e,t,i){"use strict";const s=i(69102),{ArgumentsRequired:r,AuthenticationError:a}=i(73449),{ArrayCache:n,ArrayCacheByTimestamp:o,ArrayCacheBySymbolById:h}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchTicker:!0,watchOrderBook:!0,watchOrders:!0,watchTrades:!0,watchOHLCV:!0},urls:{api:{ws:{public:"wss://ws-manager-compress.{hostname}/api?protocol=1.1",private:"wss://ws-manager-compress.{hostname}/user?protocol=1.1"}}},options:{defaultType:"spot",watchOrderBook:{depth:"depth5"},ws:{inflate:!0},timeframes:{"1m":"1m","3m":"3m","5m":"5m","15m":"15m","30m":"30m","45m":"45m","1h":"1H","2h":"2H","3h":"3H","4h":"4H","1d":"1D","1w":"1W","1M":"1M"}},streaming:{keepAlive:15e3}})}async subscribe(e,t,i={}){await this.loadMarkets();const s=this.market(t),r=this.implodeHostname(this.urls.api.ws.public),a=s.type+"/"+e+":"+s.id,n={op:"subscribe",args:[a]};return await this.watch(r,a,this.deepExtend(n,i),a)}async subscribePrivate(e,t,i={}){await this.loadMarkets();const s=this.market(t),r=this.implodeHostname(this.urls.api.ws.private),a=e+":"+s.id;await this.authenticate();const n={op:"subscribe",args:[a]};return await this.watch(r,a,this.deepExtend(n,i),a)}async watchTrades(e,t,i,s={}){await this.loadMarkets(),e=this.symbol(e);const r=await this.subscribe("trade",e,s);return this.newUpdates&&(i=r.getLimit(e,i)),this.filterBySinceLimit(r,t,i,"timestamp",!0)}async watchTicker(e,t={}){return await this.subscribe("ticker",e,t)}async watchOrders(e,t,i,s={}){if(void 0===e)throw new r(this.id+" watchOrders requires a symbol argument");await this.loadMarkets();const a=this.market(e);if(e=a.symbol,"spot"!==a.type)throw new r(this.id+" watchOrders supports spot markets only");const n=await this.subscribePrivate("spot/user/order",e,s);return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySymbolSinceLimit(n,e,t,i,!0)}handleOrders(e,t){const i=this.safeString(t,"table"),s=this.safeValue(t,"data",[]);if(s.length>0){const t=this.safeInteger(this.options,"ordersLimit",1e3);void 0===this.orders&&(this.orders=new h(t));const r=this.orders,a=[];for(let e=0;e<s.length;e++){const t=this.parseWsOrder(s[e]);r.append(t);const i=t.symbol,n=this.market(i);a.push(n.id)}for(let t=0;t<a.length;t++){const s=i+":"+a[t];e.resolve(this.orders,s)}}}parseWsOrder(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t);const s=this.safeString(e,"order_id"),r=this.safeString(e,"clientOid"),a=this.safeString(e,"price"),n=this.safeString(e,"filled_size"),o=this.safeString(e,"size"),h=this.safeString(e,"type"),d=this.safeString(e,"state"),c=this.parseOrderStatusByType(t.type,d),l=this.safeInteger(e,"ms_t"),u=t.symbol,f=this.safeStringLower(e,"side");return this.safeOrder({info:e,symbol:u,id:s,clientOrderId:r,timestamp:void 0,datetime:void 0,lastTradeTimestamp:l,type:h,timeInForce:void 0,postOnly:void 0,side:f,price:a,stopPrice:void 0,triggerPrice:void 0,amount:o,cost:void 0,average:void 0,filled:n,remaining:void 0,status:c,fee:void 0,trades:void 0},t)}handleTrade(e,t){const i=this.safeString(t,"table"),s=this.safeValue(t,"data",[]),r=this.safeInteger(this.options,"tradesLimit",1e3);for(let t=0;t<s.length;t++){const a=this.parseTrade(s[t]),o=a.symbol,h=i+":"+this.safeString(a.info,"symbol");let d=this.safeValue(this.trades,o);void 0===d&&(d=new n(r),this.trades[o]=d),d.append(a),e.resolve(d,h)}return t}handleTicker(e,t){const i=this.safeString(t,"table"),s=this.safeValue(t,"data",[]);for(let t=0;t<s.length;t++){const r=this.parseTicker(s[t]),a=r.symbol,n=i+":"+this.safeString(r.info,"symbol");this.tickers[a]=r,e.resolve(r,n)}return t}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets(),e=this.symbol(e);const a=this.safeValue(this.options,"timeframes",{}),n="kline"+this.safeString(a,t),o=await this.subscribe(n,e,r);return this.newUpdates&&(s=o.getLimit(e,s)),this.filterBySinceLimit(o,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeString(t,"table"),s=this.safeValue(t,"data",[]),r=i.split("/"),a=this.safeString(r,1).replace("kline",""),n=this.safeValue(this.options,"timeframes",{}),h=this.findTimeframe(a,n),d=1e3*this.parseTimeframe(h);for(let t=0;t<s.length;t++){const r=this.safeString(s[t],"symbol"),a=this.safeValue(s[t],"candle"),n=this.safeMarket(r),c=n.symbol,l=this.parseOHLCV(a,n);l[0]=parseInt(l[0]/d)*d,this.ohlcvs[c]=this.safeValue(this.ohlcvs,c,{});let u=this.safeValue(this.ohlcvs[c],h);if(void 0===u){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);u=new o(e),this.ohlcvs[c][h]=u}u.append(l);const f=i+":"+r;e.resolve(u,f)}}async watchOrderBook(e,t,i={}){const s=this.safeValue(this.options,"watchOrderBook",{}),r=this.safeString(s,"depth","depth50");return(await this.subscribe(r,e,i)).limit()}handleDelta(e,t){const i=this.safeFloat(t,0),s=this.safeFloat(t,1);e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleOrderBookMessage(e,t,i){const s=this.safeValue(t,"asks",[]),r=this.safeValue(t,"bids",[]);this.handleDeltas(i.asks,s),this.handleDeltas(i.bids,r);const a=this.safeInteger(t,"ms_t"),n=this.safeString(t,"symbol"),o=this.safeSymbol(n);return i.symbol=o,i.timestamp=a,i.datetime=this.iso8601(a),i}handleOrderBook(e,t){const i=this.safeValue(t,"data",[]),s=this.safeString(t,"table"),r=s.split("/"),a=this.safeString(r,1).replace("depth",""),n=parseInt(a);for(let t=0;t<i.length;t++){const r=i[t],a=this.safeString(r,"symbol"),o=this.safeSymbol(a);let h=this.safeValue(this.orderbooks,o);void 0===h&&(h=this.orderBook({},n),this.orderbooks[o]=h),h.reset({}),this.handleOrderBookMessage(e,r,h);const d=s+":"+a;e.resolve(h,d)}return t}authenticate(e={}){this.checkRequiredCredentials();const t=this.implodeHostname(this.urls.api.ws.private),i="authenticated",s=this.client(t);let r=this.safeValue(s.subscriptions,i);if(void 0===r){const a=this.milliseconds().toString(),n=a+"#"+this.uid+"#"+"bitmart.WebSocket",o=this.hmac(this.encode(n),this.encode(this.secret),"sha256"),h={op:"login",args:[this.apiKey,a,o]},d=this.extend(h,e);r=this.watch(t,i,d),s.subscriptions[i]=r}return r}handleSubscriptionStatus(e,t){return t}handleAuthenticate(e,t){e.resolve(t,"authenticated")}handleErrorMessage(e,t){const i=this.safeString(t,"errorCode");try{if(void 0!==i){const e=this.id+" "+this.json(t);this.throwExactlyMatchedException(this.exceptions.exact,i,e);const s=this.safeValue(t,"message");void 0!==s&&this.throwBroadlyMatchedException(this.exceptions.broad,s,e)}return!1}catch(t){if(t instanceof a){const i="authenticated";e.reject(t,i),i in e.subscriptions&&delete e.subscriptions[i]}return!0}}handleMessage(e,t){if(this.handleErrorMessage(e,t))return;const i=this.safeString(t,"table");if(void 0!==i){const s=i.split("/"),r=this.safeString(s,1),a={depth:this.handleOrderBook,depth5:this.handleOrderBook,depth20:this.handleOrderBook,depth50:this.handleOrderBook,ticker:this.handleTicker,trade:this.handleTrade};let n=this.safeValue(a,r);r.indexOf("kline")>=0&&(n=this.handleOHLCV);return"order"===this.safeString(s,2)&&(n=this.handleOrders),void 0===n?t:n.call(this,e,t)}{const i=this.safeString(t,"event");if(void 0!==i){const s={login:this.handleAuthenticate,subscribe:this.handleSubscriptionStatus},r=this.safeValue(s,i);return void 0===r?t:r.call(this,e,t)}}}}},62052:function(e,t,i){"use strict";const s=i(87763),{AuthenticationError:r,ExchangeError:a,RateLimitExceeded:n}=i(73449),{ArrayCache:o,ArrayCacheByTimestamp:h,ArrayCacheBySymbolById:d}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchMyTrades:!0,watchOHLCV:!0,watchOrderBook:!0,watchOrders:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0},urls:{test:{ws:"wss://ws.testnet.bitmex.com/realtime"},api:{ws:"wss://ws.bitmex.com/realtime"}},options:{watchOrderBookLevel:"orderBookL2",tradesLimit:1e3,OHLCVLimit:1e3},exceptions:{ws:{exact:{},broad:{"Rate limit exceeded":n}}}})}async watchTicker(e,t={}){await this.loadMarkets();const i="instrument:"+this.market(e).id,s=this.urls.api.ws,r={op:"subscribe",args:[i]};return await this.watch(s,i,this.extend(r,t),i)}handleTicker(e,t){const i=this.safeString(t,"table"),s=this.safeValue(t,"data",[]);for(let t=0;t<s.length;t++){const r=s[t],a=this.safeValue(r,"symbol"),n=this.safeMarket(a),o=n.symbol,h=i+":"+a;let d=this.safeValue(this.tickers,o,{});const c=this.safeValue(d,"info",{});d=this.parseTicker(this.extend(c,r),n),this.tickers[o]=d,e.resolve(d,h)}return t}async watchBalance(e={}){await this.loadMarkets(),await this.authenticate();const t="margin",i=this.urls.api.ws,s={op:"subscribe",args:[t]};return await this.watch(i,t,this.extend(s,e),t)}handleBalance(e,t){const i=this.safeValue(t,"data"),s=this.parseBalance(i);this.balance=this.extend(this.balance,s);const r=this.safeString(t,"table");e.resolve(this.balance,r)}handleTrades(e,t){const i=this.safeValue(t,"data",[]),s=this.groupBy(i,"symbol"),r=Object.keys(s);for(let t=0;t<r.length;t++){const i=r[t],a=this.safeMarket(i),n="trade:"+i,h=a.symbol,d=this.parseTrades(s[i],a);let c=this.safeValue(this.trades,h);if(void 0===c){const e=this.safeInteger(this.options,"tradesLimit",1e3);c=new o(e),this.trades[h]=c}for(let e=0;e<d.length;e++)c.append(d[e]);e.resolve(c,n)}}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);e=r.symbol;const a="trade:"+r.id,n=this.urls.api.ws,o={op:"subscribe",args:[a]},h=await this.watch(n,a,this.extend(o,s),a);return this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySinceLimit(h,t,i,"timestamp",!0)}async authenticate(e={}){const t=this.urls.api.ws,i=this.client(t),s=i.future("authenticated"),r="authKeyExpires";if(void 0===this.safeValue(i.subscriptions,r))try{this.checkRequiredCredentials();const e=this.milliseconds(),i="GET/realtime"+e.toString(),s=this.hmac(this.encode(i),this.encode(this.secret)),a={op:r,args:[this.apiKey,e,s]};this.spawn(this.watch,t,r,a,r)}catch(e){i.reject(e,"authenticated"),r in i.subscriptions&&delete i.subscriptions[r]}return await s}handleAuthenticationMessage(e,t){if(this.safeValue(t,"success",!1)){this.safeValue(e.futures,"authenticated").resolve(!0)}else{const i=new r(this.json(t));e.reject(i,"authenticated");const s="authKeyExpires";s in e.subscriptions&&delete e.subscriptions[s]}}async watchOrders(e,t,i,s={}){await this.loadMarkets(),await this.authenticate();const r="order",a=r;let n=r;void 0!==e&&(n+=":"+(e=this.symbol(e)));const o=this.urls.api.ws,h={op:"subscribe",args:[a]},d=await this.watch(o,n,h,a);return this.newUpdates&&(i=d.getLimit(e,i)),this.filterBySymbolSinceLimit(d,e,t,i,!0)}handleOrders(e,t){const i=this.safeValue(t,"data",[]),s="order",r=i.length;if(r>0){if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new d(e)}const t=this.orders,a={};for(let e=0;e<r;e++){const s=i[e],r=this.safeString(s,"orderID"),n=this.safeValue(t.hashmap,r);let o=s;void 0!==n&&(o=this.extend(n.info,s));const h=this.parseOrder(o);t.append(h);a[h.symbol]=!0}e.resolve(this.orders,s);const n=Object.keys(a);for(let t=0;t<n.length;t++){const i=n[t];e.resolve(this.orders,s+":"+i)}}}async watchMyTrades(e,t,i,s={}){await this.loadMarkets(),await this.authenticate();const r="execution",a=r;let n=r;void 0!==e&&(n+=":"+(e=this.symbol(e)));const o=this.urls.api.ws,h={op:"subscribe",args:[a]},d=await this.watch(o,n,h,a);return this.newUpdates&&(i=d.getLimit(e,i)),this.filterBySymbolSinceLimit(d,e,t,i,!0)}handleMyTrades(e,t){const i=this.safeString(t,"table"),s=this.safeValue(t,"data",[]),r=this.groupBy(s,"execType"),a=this.safeValue(r,"Trade",[]),n=this.parseTrades(a);if(void 0===this.myTrades){const e=this.safeInteger(this.options,"tradesLimit",1e3);this.myTrades=new d(e)}const o=this.myTrades,h={};for(let e=0;e<n.length;e++){const t=n[e],i=t.symbol;o.append(t),h[i]=t}n.length>0&&e.resolve(o,i);const c=Object.keys(h);for(let t=0;t<c.length;t++)e.resolve(o,i+":"+c[t])}async watchOrderBook(e,t,i={}){let s;if(void 0===t)s=this.safeString(this.options,"watchOrderBookLevel","orderBookL2");else if(25===t)s="orderBookL2_25";else{if(10!==t)throw new a(this.id+" watchOrderBook limit argument must be undefined (L2), 25 (L2) or 10 (L3)");s="orderBookL10"}await this.loadMarkets();const r=s+":"+this.market(e).id,n=this.urls.api.ws,o={op:"subscribe",args:[r]};return(await this.watch(n,r,this.deepExtend(o,i),r)).limit()}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;const n="tradeBin"+this.safeString(this.timeframes,t,t)+":"+a.id,o=this.urls.api.ws,h={op:"subscribe",args:[n]},d=await this.watch(o,n,this.extend(h,r),n);return this.newUpdates&&(s=d.getLimit(e,s)),this.filterBySinceLimit(d,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeString(t,"table"),s=i.replace("tradeBin",""),r=this.findTimeframe(s),a=this.parseTimeframe(r),n=this.safeValue(t,"data",[]),o={};for(let e=0;e<n.length;e++){const t=n[e],s=this.safeString(t,"symbol"),d=this.safeMarket(s),c=d.symbol,l=i+":"+d.id,u=[this.parse8601(this.safeString(t,"timestamp"))-1e3*a,this.safeFloat(t,"open"),this.safeFloat(t,"high"),this.safeFloat(t,"low"),this.safeFloat(t,"close"),this.safeFloat(t,"volume")];this.ohlcvs[c]=this.safeValue(this.ohlcvs,c,{});let f=this.safeValue(this.ohlcvs[c],r);if(void 0===f){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);f=new h(e),this.ohlcvs[c][r]=f}f.append(u),o[l]=f}const d=Object.keys(o);for(let t=0;t<d.length;t++){const i=d[t];e.resolve(o[i],i)}}async watchHeartbeat(e={}){await this.loadMarkets();const t=this.urls.api.ws;return await this.watch(t,"heartbeat")}handleOrderBook(e,t){const i=this.safeString(t,"action"),s=this.safeString(t,"table"),r=this.safeValue(t,"data",[]);if("partial"===i){const i=this.safeValue(t,"filter",{}),a=this.safeValue(i,"symbol"),n=this.safeMarket(a).symbol;"orderBookL2"===s?this.orderbooks[n]=this.indexedOrderBook():"orderBookL2_25"===s?this.orderbooks[n]=this.indexedOrderBook({},25):"orderBook10"===s&&(this.orderbooks[n]=this.indexedOrderBook({},10));const o=this.orderbooks[n];for(let e=0;e<r.length;e++){const t=this.safeFloat(r[e],"price"),i=this.safeFloat(r[e],"size"),s=this.safeString(r[e],"id");let a=this.safeString(r[e],"side");a="Buy"===a?"bids":"asks";o[a].store(t,i,s)}const h=s+":"+a;e.resolve(o,h)}else{const t={};for(let e=0;e<r.length;e++){const i=this.safeValue(r[e],"symbol");i in t||(t[i]=0),t[i]=this.sum(t,1);const s=this.safeMarket(i).symbol,a=this.orderbooks[s],n=this.safeFloat(r[e],"price"),o=this.safeFloat(r[e],"size",0),h=this.safeString(r[e],"id");let d=this.safeString(r[e],"side");d="Buy"===d?"bids":"asks";a[d].store(n,o,h)}const i=Object.keys(t);for(let t=0;t<i.length;t++){const r=i[t],a=s+":"+r,n=this.safeMarket(r).symbol,o=this.orderbooks[n];e.resolve(o,a)}}}handleSystemStatus(e,t){return t}handleSubscriptionStatus(e,t){return t}handleErrorMessage(e,t){const i=this.safeValue(t,"error");if(void 0!==i){const s=this.safeValue(t,"request",{}),r=this.safeString(s,"args",[]);if(r.length>0){const t=r[0],s=this.exceptions.ws.broad,n=this.findBroadlyMatchedKey(s,i);let o;return o=void 0===n?new a(i):new s[n](i),e.reject(o,t),!1}}return!0}handleMessage(e,t){if(this.handleErrorMessage(e,t)){const i=this.safeString(t,"table"),s={orderBookL2:this.handleOrderBook,orderBookL2_25:this.handleOrderBook,orderBook10:this.handleOrderBook,instrument:this.handleTicker,trade:this.handleTrades,tradeBin1m:this.handleOHLCV,tradeBin5m:this.handleOHLCV,tradeBin1h:this.handleOHLCV,tradeBin1d:this.handleOHLCV,order:this.handleOrders,execution:this.handleMyTrades,margin:this.handleBalance},r=this.safeValue(s,i);if(void 0===r){const i=this.safeValue(t,"request",{});return"authKeyExpires"===this.safeValue(i,"op")?this.handleAuthenticationMessage.call(this,e,t):t}return r.call(this,e,t)}}}},87823:function(e,t,i){"use strict";const s=i(84070),{ExchangeError:r}=i(73449),{ArrayCache:a}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchMyTrades:!1,watchOHLCV:!1,watchOrderBook:!0,watchOrders:!1,watchTicker:!0,watchTickers:!1,watchTrades:!0},urls:{ws:{public:"wss://stream.bitopro.com:9443/ws/v1/pub",private:"wss://stream.bitopro.com:9443/ws/v1/pub/auth"}},requiredCredentials:{apiKey:!0,secret:!0,login:!0},options:{tradesLimit:1e3,ordersLimit:1e3,ws:{options:{headers:{}}}}})}async watchPublic(e,t,i){const s=this.urls.ws.public+"/"+e+"/"+i;return await this.watch(s,t,void 0,t)}async watchOrderBook(e,t,i={}){if(void 0!==t&&5!==t&&10!==t&&20!==t&&50!==t&&100!==t&&500!==t&&1e3!==t)throw new r(this.id+" watchOrderBook limit argument must be undefined, 5, 10, 20, 50, 100, 500 or 1000");await this.loadMarkets();const s=this.market(e),a="ORDER_BOOK:"+(e=s.symbol);let n;n=void 0===t?s.id:s.id+":"+t;return(await this.watchPublic("order-books",a,n)).limit()}handleOrderBook(e,t){const i=this.safeString(t,"pair"),s=this.safeMarket(i,void 0,"_").symbol,r=this.safeString(t,"event")+":"+s;let a=this.safeValue(this.orderbooks,s);void 0===a&&(a=this.orderBook({}));const n=this.safeInteger(t,"timestamp"),o=this.parseOrderBook(t,s,n,"bids","asks","price","amount");a.reset(o),e.resolve(a,r)}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a="TRADE:"+(e=r.symbol),n=await this.watchPublic("trades",a,r.id,i);return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySinceLimit(n,t,i,"timestamp",!0)}handleTrade(e,t){const i=this.safeString(t,"pair"),s=this.safeMarket(i,void 0,"_"),r=s.symbol,n=this.safeString(t,"event")+":"+r,o=this.safeValue(t,"data",[]),h=this.parseTrades(o,s);let d=this.safeValue(this.trades,r);if(void 0===d){const e=this.safeInteger(this.options,"tradesLimit",1e3);d=new a(e)}for(let e=0;e<h.length;e++)d.append(h[e]);this.trades[r]=d,e.resolve(d,n)}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s="TICKER:"+(e=i.symbol);return await this.watchPublic("tickers",s,i.id)}handleTicker(e,t){const i=this.safeString(t,"pair"),s=this.safeMarket(i,void 0,"_").symbol,r=this.safeString(t,"event")+":"+s,a=this.parseTicker(t),n=this.safeInteger(t,"timestamp"),o=this.safeString(t,"datetime");a.timestamp=n,a.datetime=o,this.tickers[s]=a,e.resolve(a,r)}authenticate(e){if(void 0!==this.clients&&e in this.clients)return;this.checkRequiredCredentials();const t=this.milliseconds(),i=this.json({nonce:t,identity:this.login}),s=this.stringToBase64(i),r=this.hmac(s,this.encode(this.secret),"sha384");this.options=this.extend({ws:{options:{headers:{}}}},this.options);const a=this.options.ws.options.headers;this.options.ws.options.headers={"X-BITOPRO-API":"ccxt","X-BITOPRO-APIKEY":this.apiKey,"X-BITOPRO-PAYLOAD":s,"X-BITOPRO-SIGNATURE":r},this.client(e),this.options.ws.options.headers=a}async watchBalance(e={}){this.checkRequiredCredentials(),await this.loadMarkets();const t="ACCOUNT_BALANCE",i=this.urls.ws.private+"/account-balance";return this.authenticate(i),await this.watch(i,t,void 0,t)}handleBalance(e,t){const i=this.safeString(t,"event"),s=this.safeValue(t,"data"),r=Object.keys(s),a={};for(let e=0;e<r.length;e++){const t=this.safeString(r,e),i=this.safeValue(s,t),n=this.safeString(i,"currency"),o=this.safeCurrencyCode(n),h=this.account();h.free=this.safeString(i,"available"),h.total=this.safeString(i,"amount"),a[o]=h}this.balance=this.safeBalance(a),e.resolve(this.balance,i)}handleMessage(e,t){const i={TRADE:this.handleTrade,TICKER:this.handleTicker,ORDER_BOOK:this.handleOrderBook,ACCOUNT_BALANCE:this.handleBalance},s=this.safeString(t,"event"),r=this.safeValue(i,s);return void 0===r?t:r.call(this,e,t)}}},86169:function(e,t,i){"use strict";const s=i(68120),{ArrayCacheBySymbolById:r}=i(56062),{ArgumentsRequired:a}=i(73449);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchTicker:!1,watchTickers:!1,watchTrades:!1,watchMyTrades:!1,watchOrders:!0,watchOrderBook:!1,watchOHLCV:!1},urls:{api:{open:"https://open.bitrue.com",ws:{public:"wss://ws.bitrue.com/market/ws",private:"wss://wsapi.bitrue.com"}}},api:{open:{private:{post:{"poseidon/api/v1/listenKey":1},put:{"poseidon/api/v1/listenKey/{listenKey}":1},delete:{"poseidon/api/v1/listenKey/{listenKey}":1}}}},options:{listenKeyRefreshRate:18e5,ws:{gunzip:!0}}})}async watchBalance(e={}){const t=await this.authenticate(),i="balance",s=this.deepExtend({event:"sub",params:{channel:"user_balance_update"}},e);return await this.watch(t,i,s,i)}handleBalance(e,t){const i=this.safeValue(t,"B",[]);this.parseWSBalances(i);e.resolve(this.balance,"balance")}parseWSBalances(e){for(let t=0;t<e.length;t++){const i=e[t],s=this.safeString(i,"a"),r=this.safeCurrencyCode(s),a=this.account(),n=this.safeString(i,"F"),o=this.safeString(i,"L"),h=0!==this.safeInteger(i,"T",0),d=0!==this.safeInteger(i,"t",0);(h||d)&&(h&&(a.free=n),d&&(a.used=o),this.balance[r]=a)}this.balance=this.safeBalance(this.balance)}async watchOrders(e,t,i,s={}){if(await this.loadMarkets(),void 0!==e){e=this.market(e).symbol}const r=await this.authenticate(),a="orders",n=this.deepExtend({event:"sub",params:{channel:"user_order_update"}},s),o=await this.watch(r,a,n,a);return this.newUpdates&&(i=o.getLimit(e,i)),this.filterBySymbolSinceLimit(o,e,t,i,!0)}handleOrder(e,t){const i=this.parseWSOrder(t);if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new r(e)}this.orders.append(i);e.resolve(this.orders,"orders")}parseWSOrder(e,t){const i=this.safeInteger(e,"E"),s=this.safeStringUpper(e,"s"),r=this.safeString(e,"o"),a=1===this.safeInteger(e,"S")?"buy":"sell",n=this.safeString(e,"X"),o=this.safeString(e,"N");return this.safeOrder({info:e,id:this.safeString(e,"i"),clientOrderId:this.safeString(e,"c"),timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:this.safeInteger(e,"T"),symbol:this.safeSymbol(s,t),type:this.parseWSOrderType(r),timeInForce:void 0,postOnly:void 0,side:a,price:this.safeString(e,"p"),triggerPrice:void 0,amount:this.safeString(e,"q"),cost:this.safeString(e,"Y"),average:void 0,filled:this.safeString(e,"z"),remaining:void 0,status:this.parseWSOrderStatus(n),fee:{currency:this.safeCurrencyCode(o),cost:this.safeNumber(e,"n")}},t)}async watchOrderBook(e,t,i={}){if(void 0===e)throw new a(this.id+" watchOrderBook() requires a symbol argument");await this.loadMarkets();const s=this.market(e),r="orderbook:"+(e=s.symbol),n=s.id.toLowerCase(),o="market_"+n+"_simple_depth_step0",h=this.urls.api.ws.public,d={event:"sub",params:{cb_id:n,channel:o}},c=this.deepExtend(d,i);return await this.watch(h,r,c,r)}handleOrderBook(e,t){const i=this.safeString(t,"channel").split("_"),s=this.safeStringUpper(i,1),r=this.safeMarket(s).symbol,a=this.safeInteger(t,"ts"),n=this.safeValue(t,"tick",{}),o=this.parseOrderBook(n,r,a,"buys","asks");this.orderbooks[r]=o;const h="orderbook:"+r;e.resolve(o,h)}parseWSOrderType(e){return this.safeString({1:"limit",2:"market",3:"limit"},e,e)}parseWSOrderStatus(e){return this.safeString({0:"open",1:"open",2:"closed",3:"open",4:"canceled",7:"open"},e,e)}handlePing(e,t){this.spawn(this.pong,e,t)}async pong(e,t){const i={pong:this.safeInteger(t,"ping")};await e.send(i)}handleMessage(e,t){if("channel"in t)this.handleOrderBook(e,t);else if("ping"in t)this.handlePing(e,t);else{const i=this.safeString(t,"e"),s={BALANCE:this.handleBalance,ORDER:this.handleOrder},r=this.safeValue(s,i);void 0!==r&&r.call(this,e,t)}}async authenticate(e={}){if(void 0===this.safeValue(this.options,"listenKey")){let t;try{t=await this.openPrivatePostPoseidonApiV1ListenKey(e)}catch(e){return this.options.listenKey=void 0,void(this.options.listenKeyUrl=void 0)}const i=this.safeValue(t,"data",{}),s=this.safeString(i,"listenKey");this.options.listenKey=s,this.options.listenKeyUrl=this.urls.api.ws.private+"/stream?listenKey="+s;const r=this.safeInteger(this.options,"listenKeyRefreshRate",18e5);this.delay(r,this.keepAliveListenKey)}return this.options.listenKeyUrl}async keepAliveListenKey(e={}){const t={listenKey:this.safeString(this.options,"listenKey")};try{await this.openPrivatePutPoseidonApiV1ListenKeyListenKey(this.extend(t,e))}catch(e){return this.options.listenKey=void 0,void(this.options.listenKeyUrl=void 0)}const i=this.safeInteger(this.options,"listenKeyRefreshRate",18e5);this.delay(i,this.keepAliveListenKey)}}},96604:function(e,t,i){"use strict";const s=i(7653),{ArgumentsRequired:r,AuthenticationError:a}=i(73449),{ArrayCache:n,ArrayCacheBySymbolById:o}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchOrderBook:!0,watchOrders:!0,watchTrades:!0,watchOHLCV:!1,watchTicker:!1,watchTickers:!1},urls:{api:{ws:"wss://ws.bitstamp.net"}},options:{expiresIn:"",userId:"",wsSessionToken:"",watchOrderBook:{snapshotDelay:6,maxRetries:3},tradesLimit:1e3,OHLCVLimit:1e3},exceptions:{exact:{4009:a}}})}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r="orderbook:"+(e=s.symbol),a="diff_order_book_"+s.id,n=this.urls.api.ws,o={event:"bts:subscribe",data:{channel:a}},h=this.extend(o,i);return(await this.watch(n,r,h,r)).limit()}handleOrderBook(e,t){const i=this.safeString(t,"channel").split("_"),s=this.safeString(i,3),r=this.safeSymbol(s),a=this.safeValue(this.orderbooks,r),n=this.safeValue(a,"nonce"),o=this.safeValue(t,"data"),h=this.safeInteger(o,"microtimestamp"),d="orderbook:"+r;if(void 0===n){return a.cache.length===this.handleOption("watchOrderBook","snapshotDelay",6)&&this.spawn(this.loadOrderBook,e,d,r),void a.cache.push(o)}n>=h||(this.handleDelta(a,o),e.resolve(a,d))}handleDelta(e,t){const i=this.safeTimestamp(t,"timestamp");e.timestamp=i,e.datetime=this.iso8601(i),e.nonce=this.safeInteger(t,"microtimestamp");const s=this.safeValue(t,"bids",[]),r=this.safeValue(t,"asks",[]),a=e.bids,n=e.asks;this.handleBidAsks(a,s),this.handleBidAsks(n,r)}handleBidAsks(e,t){for(let i=0;i<t.length;i++){const s=this.parseBidAsk(t[i]);e.storeArray(s)}}getCacheIndex(e,t){const i=t[0],s=this.safeInteger(i,"microtimestamp"),r=this.safeInteger(e,"nonce");if(r<s)return-1;for(let e=0;e<t.length;e++){const i=t[e];if(this.safeInteger(i,"microtimestamp")===r)return e+1}return t.length}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a="trades:"+(e=r.symbol),n=this.urls.api.ws,o={event:"bts:subscribe",data:{channel:"live_trades_"+r.id}},h=this.extend(o,s),d=await this.watch(n,a,h,a);return this.newUpdates&&(i=d.getLimit(e,i)),this.filterBySinceLimit(d,t,i,"timestamp",!0)}parseWsTrade(e,t){const i=this.safeInteger(e,"microtimestamp"),s=this.safeString(e,"id"),r=parseInt(i/1e3),a=this.safeString(e,"price"),n=this.safeString(e,"amount"),o=t.symbol;let h=this.safeInteger(e,"type");return h=0===h?"buy":"sell",this.safeTrade({info:e,timestamp:r,datetime:this.iso8601(r),symbol:o,id:s,order:void 0,type:void 0,takerOrMaker:void 0,side:h,price:a,amount:n,cost:void 0,fee:void 0},t)}handleTrade(e,t){const i=this.safeString(t,"channel").split("_"),s=this.safeString(i,2),r=this.safeMarket(s),a=r.symbol,o="trades:"+a,h=this.safeValue(t,"data"),d=this.parseWsTrade(h,r);let c=this.safeValue(this.trades,a);if(void 0===c){const e=this.safeInteger(this.options,"tradesLimit",1e3);c=new n(e),this.trades[a]=c}c.append(d),e.resolve(c,o)}async watchOrders(e,t,i,s={}){if(void 0===e)throw new r(this.id+" watchOrders requires a symbol argument");await this.loadMarkets();const a=this.market(e);e=a.symbol;const n="private-my_orders",o=n+"_"+a.id,h={symbol:e,limit:i,type:n,params:s},d=await this.subscribePrivate(h,o,s);return this.newUpdates&&(i=d.getLimit(e,i)),this.filterBySinceLimit(d,t,i,"timestamp",!0)}handleOrders(e,t){const i=this.safeString(t,"channel"),s=this.safeValue(t,"data",{}),r=this.safeInteger(this.options,"ordersLimit",1e3);void 0===this.orders&&(this.orders=new o(r));const a=this.orders,n=this.safeValue(e.subscriptions,i),h=this.safeString(n,"symbol"),d=this.market(h),c=this.parseWsOrder(s,d);a.append(c),e.resolve(this.orders,i)}parseWsOrder(e,t){const i=this.safeString(e,"id_str"),s=this.safeStringLower(e,"order_type"),r=this.safeString(e,"price_str"),a=this.safeString(e,"amount_str"),n="1"===s?"sell":"buy",o=this.safeTimestamp(e,"datetime"),h=(t=this.safeMarket(void 0,t)).symbol;return this.safeOrder({info:e,symbol:h,id:i,clientOrderId:void 0,timestamp:o,datetime:this.iso8601(o),lastTradeTimestamp:void 0,type:void 0,timeInForce:void 0,postOnly:void 0,side:n,price:r,stopPrice:void 0,triggerPrice:void 0,amount:a,cost:void 0,average:void 0,filled:void 0,remaining:void 0,status:void 0,fee:void 0,trades:void 0},t)}handleOrderBookSubscription(e,t){const i=this.safeString(t,"channel").split("_"),s=this.safeString(i,3),r=this.safeSymbol(s);this.orderbooks[r]=this.orderBook()}handleSubscriptionStatus(e,t){this.safeString(t,"channel").indexOf("order_book")>-1&&this.handleOrderBookSubscription(e,t)}handleSubject(e,t){const i=this.safeString(t,"channel"),s={live_trades:this.handleTrade,diff_order_book:this.handleOrderBook,"private-my_orders":this.handleOrders},r=Object.keys(s);for(let a=0;a<r.length;a++){const n=r[a];if(i.indexOf(n)>-1){s[n].call(this,e,t)}}}handleErrorMessage(e,t){if("bts:error"===this.safeString(t,"event")){const e=this.id+" "+this.json(t),i=this.safeValue(t,"data",{}),s=this.safeNumber(i,"code");this.throwExactlyMatchedException(this.exceptions.exact,s,e)}return t}handleMessage(e,t){if(!this.handleErrorMessage(e,t))return;return"bts:subscription_succeeded"===this.safeString(t,"event")?this.handleSubscriptionStatus(e,t):this.handleSubject(e,t)}async authenticate(e={}){this.checkRequiredCredentials();const t=this.milliseconds(),i=this.safeInteger(this.options,"expiresIn");if(void 0===i||t>i){const i=await this.privatePostWebsocketsToken(e),s=this.safeString(i,"token");if(void 0!==s){const e=this.safeNumber(i,"user_id"),r=this.safeIntegerProduct(i,"valid_sec",1e3);return this.options.expiresIn=this.sum(t,r),this.options.userId=e,this.options.wsSessionToken=s,i}}}async subscribePrivate(e,t,i={}){const s=this.urls.api.ws;await this.authenticate();const r={event:"bts:subscribe",data:{channel:t+="-"+this.options.userId,auth:this.options.wsSessionToken}};return e.messageHash=t,await this.watch(s,t,this.extend(r,i),t,e)}}},31579:function(e,t,i){"use strict";const s=i(9461),{InvalidNonce:r,BadRequest:a}=i(73449),{ArrayCache:n,ArrayCacheByTimestamp:o,ArrayCacheBySymbolById:h}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchHeartbeat:!0,watchMyTrades:!0,watchOHLCV:!0,watchOrderBook:!0,watchOrders:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0},urls:{api:{ws:"wss://socket-v3.bittrex.com/signalr/connect",signalr:"https://socket-v3.bittrex.com/signalr"}},api:{signalr:{get:["negotiate","start"]}},options:{tradesLimit:1e3,hub:"c3",I:this.milliseconds()}})}getSignalRUrl(e){const t=this.safeString(e.response,"ConnectionToken"),i=this.extend(e.request,{connectionToken:t});return this.urls.api.ws+"?"+this.urlencode(i)}makeRequest(e,t,i){return{H:this.safeString(this.options,"hub","c3"),M:t,A:i,I:e}}makeRequestToSubscribe(e,t){return this.makeRequest(e,"Subscribe",t)}makeRequestToAuthenticate(e){const t=this.milliseconds(),i=this.uuid(),s=t.toString()+i,r=this.hmac(this.encode(s),this.encode(this.secret),"sha512"),a=[this.apiKey,t,i,r];return this.makeRequest(e,"Authenticate",a)}requestId(){const e=this.sum(this.safeInteger(this.options,"I",0),1);return this.options.I=e,e}async sendRequestToSubscribe(e,t,i,s={}){const r=[t],a=this.requestId().toString(),n=this.makeRequestToSubscribe(a,[r]);i=this.extend({id:a,negotiation:e},i);const o=this.getSignalRUrl(e);return await this.watch(o,t,n,t,i)}async authenticate(e={}){await this.loadMarkets();const t=await this.negotiate();return await this.sendRequestToAuthenticate(t,!1,e)}async sendRequestToAuthenticate(e,t=!1,i={}){const s=this.getSignalRUrl(e),r=this.client(s),a="authenticate";let n=this.safeValue(r.subscriptions,a);if(void 0===n||t){n=r.future(a),r.subscriptions[a]=n;const t=this.requestId().toString(),o=this.makeRequestToAuthenticate(t),h={id:t,params:i,negotiation:e,method:this.handleAuthenticate};this.spawn(this.watch,s,a,o,t,h)}return await n}async sendAuthenticatedRequestToSubscribe(e,t,i={}){const s=this.safeValue(e,"negotiation"),r={params:i};return await this.sendRequestToSubscribe(s,t,r,i)}handleAuthenticate(e,t,i){const s=this.safeString(i,"id");s in e.subscriptions&&delete e.subscriptions[s],e.resolve(i,"authenticate")}async handleAuthenticationExpiringHelper(){const e=await this.negotiate();return await this.sendRequestToAuthenticate(e,!0)}handleAuthenticationExpiring(e,t){this.spawn(this.handleAuthenticationExpiringHelper)}createSignalRQuery(e={}){const t=[{name:this.safeString(this.options,"hub","c3")}],i=this.milliseconds();return this.extend({transport:"webSockets",connectionData:this.json(t),clientProtocol:1.5,_:i,tid:this.sum(i%10,1)},e)}async negotiate(e={}){const t=this.client(this.urls.api.ws),i="negotiate";let s=this.safeValue(t.subscriptions,i);if(void 0===s){s=t.future(i),t.subscriptions[i]=s;const r=this.createSignalRQuery(e),a={request:r,response:await this.signalrGetNegotiate(this.extend(r,e))};t.resolve(a,i)}return await s}async start(e,t={}){const i=this.safeString(e.response,"ConnectionToken"),s=this.createSignalRQuery(this.extend(e.request,{connectionToken:i}));return await this.signalrGetStart(s)}async watchOrders(e,t,i,s={}){await this.loadMarkets(),void 0!==e&&(e=this.symbol(e));const r=await this.authenticate(),a=await this.subscribeToOrders(r,s);return this.newUpdates&&(i=a.getLimit(e,i)),this.filterBySymbolSinceLimit(a,e,t,i,!0)}async subscribeToOrders(e,t={}){return await this.sendAuthenticatedRequestToSubscribe(e,"order",t)}handleOrder(e,t){const i=this.safeValue(t,"delta",{}),s=this.parseOrder(i);if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new h(e)}this.orders.append(s);e.resolve(this.orders,"order")}async watchBalance(e={}){await this.loadMarkets();const t=await this.authenticate();return await this.subscribeToBalance(t,e)}async subscribeToBalance(e,t={}){return await this.sendAuthenticatedRequestToSubscribe(e,"balance",t)}handleBalance(e,t){const i=this.safeValue(t,"delta",{}),s=this.safeString(i,"currencySymbol"),r=this.safeCurrencyCode(s),a=this.account();a.free=this.safeString(i,"available"),a.total=this.safeString(i,"total"),this.balance[r]=a,this.balance=this.safeBalance(this.balance);e.resolve(this.balance,"balance")}async watchHeartbeat(e={}){await this.loadMarkets();const t=await this.negotiate();return await this.subscribeToHeartbeat(t,e)}async subscribeToHeartbeat(e,t={}){await this.loadMarkets();const i=this.getSignalRUrl(e),s=this.milliseconds().toString(),r="heartbeat",a=[r],n=this.makeRequestToSubscribe(s,[a]),o={id:s,params:t,negotiation:e};return await this.watch(i,r,n,r,o)}handleHeartbeat(e,t){e.resolve(t,"heartbeat")}async watchTicker(e,t={}){await this.loadMarkets();const i=await this.negotiate();return await this.subscribeToTicker(i,e,t)}async subscribeToTicker(e,t,i={}){await this.loadMarkets();const s=this.market(t);t=s.symbol;const r="ticker_"+s.id,a={marketId:s.id,symbol:t,params:i};return await this.sendRequestToSubscribe(e,r,a)}handleTicker(e,t){const i=this.parseTicker(t),s=i.symbol,r=this.market(s);this.tickers[s]=i;const a="ticker_"+r.id;e.resolve(i,a)}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets(),e=this.symbol(e);const a=await this.negotiate(),n=await this.subscribeToOHLCV(a,e,t,r);return this.newUpdates&&(s=n.getLimit(e,s)),this.filterBySinceLimit(n,i,s,0,!0)}async subscribeToOHLCV(e,t,i="1m",s={}){await this.loadMarkets();const r=this.market(t),a=this.safeString(this.timeframes,i,i),n="candle_"+r.id+"_"+a,o={symbol:t,timeframe:i,messageHash:n,params:s};return await this.sendRequestToSubscribe(e,n,o)}handleOHLCV(e,t){const i=this.safeString(t,"marketSymbol"),s=this.safeSymbol(i,void 0,"-"),r=this.safeString(t,"interval"),a="candle_"+i+"_"+r,n=this.findTimeframe(r),h=this.safeValue(t,"delta",{}),d=this.parseOHLCV(h);this.ohlcvs[s]=this.safeValue(this.ohlcvs,s,{});let c=this.safeValue(this.ohlcvs[s],n);if(void 0===c){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);c=new o(e),this.ohlcvs[s][n]=c}c.append(d),e.resolve(c,a)}async watchTrades(e,t,i,s={}){await this.loadMarkets(),e=this.symbol(e);const r=await this.negotiate(),a=await this.subscribeToTrades(r,e,s);return this.newUpdates&&(i=a.getLimit(e,i)),this.filterBySinceLimit(a,t,i,"timestamp",!0)}async subscribeToTrades(e,t,i={}){await this.loadMarkets();const s="trade_"+this.market(t).id,r={symbol:t,messageHash:s,params:i};return await this.sendRequestToSubscribe(e,s,r)}handleTrades(e,t){const i=this.safeValue(t,"deltas",[]),s=this.safeString(t,"marketSymbol"),r=this.safeSymbol(s,void 0,"-"),a=this.market(r),o="trade_"+s;let h=this.safeValue(this.trades,r);if(void 0===h){const e=this.safeInteger(this.options,"tradesLimit",1e3);h=new n(e)}const d=this.parseTrades(i,a);for(let e=0;e<d.length;e++)h.append(d[e]);this.trades[r]=h,e.resolve(h,o)}async watchMyTrades(e,t,i,s={}){await this.loadMarkets(),e=this.symbol(e);const r=await this.authenticate(),a=await this.subscribeToMyTrades(r,s);return this.newUpdates&&(i=a.getLimit(e,i)),this.filterBySymbolSinceLimit(a,e,t,i,!0)}async subscribeToMyTrades(e,t={}){return await this.sendAuthenticatedRequestToSubscribe(e,"execution",t)}handleMyTrades(e,t){const i=this.safeValue(t,"deltas",{}),s=this.parseTrades(i);let r=this.myTrades;if(void 0===r){const e=this.safeInteger(this.options,"tradesLimit",1e3);r=new h(e),this.myTrades=r}for(let e=0;e<s.length;e++)r.append(s[e]);e.resolve(r,"execution")}async watchOrderBook(e,t,i={}){if(1!==(t=void 0===t?25:t)&&25!==t&&500!==t)throw new a(this.id+" watchOrderBook() limit argument must be undefined, 1, 25 or 500, default is 25");await this.loadMarkets(),e=this.symbol(e);const s=await this.negotiate();return(await this.subscribeToOrderBook(s,e,t,i)).limit()}async subscribeToOrderBook(e,t,i,s={}){await this.loadMarkets();const r="orderbook_"+this.market(t).id+"_"+i.toString(),a={symbol:t,messageHash:r,method:this.handleSubscribeToOrderBook,limit:i,params:s};return await this.sendRequestToSubscribe(e,r,a)}async fetchOrderBookSnapshot(e,t,i){const s=this.safeString(i,"symbol"),a=this.safeInteger(i,"limit"),n=this.safeString(i,"messageHash");try{const o=await this.fetchOrderBook(s,a),h=this.orderbooks[s],d=h.cache,c=this.safeValue(d,0,{}),l=this.safeInteger(c,"sequence"),u=this.safeInteger(o,"nonce");if(void 0!==l&&u<l){const a=this.safeValue(this.options,"fetchOrderBookSnapshot",{}),o=this.safeInteger(a,"maxAttempts",3);let h=this.safeInteger(i,"numAttempts",0);if(!(h<o))throw new r(this.id+" failed to synchronize WebSocket feed with the snapshot for symbol "+s+" in "+o.toString()+" attempts");n in e.subscriptions&&(h=this.sum(h,1),i.numAttempts=h,e.subscriptions[n]=i,this.spawn(this.fetchOrderBookSnapshot,e,t,i))}else{h.reset(o);for(let t=0;t<d.length;t++){const i=d[t];this.handleOrderBookMessage(e,i,h)}this.orderbooks[s]=h,e.resolve(h,n)}}catch(t){e.reject(t,n)}}handleSubscribeToOrderBook(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeInteger(i,"limit");s in this.orderbooks&&delete this.orderbooks[s],this.orderbooks[s]=this.orderBook({},r),this.spawn(this.fetchOrderBookSnapshot,e,t,i)}handleDelta(e,t){const i=this.safeFloat(t,"rate"),s=this.safeFloat(t,"quantity");e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleOrderBook(e,t){const i=this.safeString(t,"marketSymbol"),s=this.safeSymbol(i,void 0,"-"),r=this.safeInteger(t,"depth");let a=this.safeValue(this.orderbooks,s);void 0===a&&(a=this.orderBook({},r)),void 0!==a.nonce?this.handleOrderBookMessage(e,t,a):a.cache.push(t)}handleOrderBookMessage(e,t,i){const s="orderbook_"+this.safeString(t,"marketSymbol")+"_"+this.safeString(t,"depth"),r=this.safeInteger(t,"sequence");return r>i.nonce&&(this.handleDeltas(i.asks,this.safeValue(t,"askDeltas",[])),this.handleDeltas(i.bids,this.safeValue(t,"bidDeltas",[])),i.nonce=r,e.resolve(i,s)),i}async handleSystemStatusHelper(){const e=await this.negotiate();await this.start(e)}handleSystemStatus(e,t){return this.spawn(this.handleSystemStatusHelper),t}handleSubscriptionStatus(e,t){const i=this.safeString(t,"I");let s=this.safeValue(e.subscriptions,i);if(void 0===s){const t=this.indexBy(e.subscriptions,"id");s=this.safeValue(t,i,{})}else delete e.subscriptions[i];const r=this.safeValue(s,"method");return void 0===r?e.resolve(t,i):r.call(this,e,t,s),t}handleMessage(e,t){const i={authenticationExpiring:this.handleAuthenticationExpiring,order:this.handleOrder,balance:this.handleBalance,trade:this.handleTrades,candle:this.handleOHLCV,orderBook:this.handleOrderBook,heartbeat:this.handleHeartbeat,ticker:this.handleTicker,execution:this.handleMyTrades},s=this.safeValue(t,"M",[]);for(let r=0;r<s.length;r++){const a=this.safeValue(s[r],"M"),n=this.safeValue(i,a);if(void 0!==n)if("heartbeat"===a)n.call(this,e,t);else if("authenticationExpiring"===a)n.call(this,e,t);else{const t=this.safeValue(s[r],"A",[]);for(let i=0;i<t.length;i++){const s=this.inflate64(t[i]),r=JSON.parse(s);n.call(this,e,r)}}}"I"in t&&this.handleSubscriptionStatus(e,t),"S"in t&&this.handleSystemStatus(e,t);Object.keys(t).length<1&&this.handleHeartbeat(e,t)}}},5089:function(e,t,i){"use strict";const s=i(54253),{AuthenticationError:r,ArgumentsRequired:a}=i(73449),{ArrayCache:n,ArrayCacheByTimestamp:o,ArrayCacheBySymbolById:h}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchOrderBook:!0,watchTrades:!0,watchTicker:!0,watchOHLCV:!0,watchOrders:!0,watchMyTrades:!0},urls:{api:{ws:"wss://ws.bitvavo.com/v2"}},options:{tradesLimit:1e3,ordersLimit:1e3,OHLCVLimit:1e3}})}async watchPublic(e,t,i={}){await this.loadMarkets();const s=this.market(t),r=e+"@"+s.id,a=this.urls.api.ws,n={action:"subscribe",channels:[{name:e,markets:[s.id]}]},o=this.extend(n,i);return await this.watch(a,r,o,r)}async watchTicker(e,t={}){return await this.watchPublic("ticker24h",e,t)}handleTicker(e,t){const i=this.safeString(t,"event"),s=this.safeValue(t,"data",[]);for(let t=0;t<s.length;t++){const r=s[t],a=this.safeString(r,"market"),n=this.safeMarket(a,void 0,"-"),o=i+"@"+a,h=this.parseTicker(r,n),d=h.symbol;this.tickers[d]=h,e.resolve(h,o)}return t}async watchTrades(e,t,i,s={}){await this.loadMarkets(),e=this.symbol(e);const r=await this.watchPublic("trades",e,s);return this.newUpdates&&(i=r.getLimit(e,i)),this.filterBySinceLimit(r,t,i,"timestamp",!0)}handleTrade(e,t){const i=this.safeString(t,"market"),s=this.safeMarket(i,void 0,"-"),r=s.symbol,a="trades@"+i,o=this.parseTrade(t,s);let h=this.safeValue(this.trades,r);if(void 0===h){const e=this.safeInteger(this.options,"tradesLimit",1e3);h=new n(e)}h.append(o),this.trades[r]=h,e.resolve(h,a)}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;const n=a.id,o=this.safeString(this.timeframes,t,t),h="candles@"+n+"_"+o,d=this.urls.api.ws,c={action:"subscribe",channels:[{name:"candles",interval:[o],markets:[n]}]},l=this.extend(c,r),u=await this.watch(d,h,l,h);return this.newUpdates&&(s=u.getLimit(e,s)),this.filterBySinceLimit(u,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeString(t,"market"),s=this.safeMarket(i,void 0,"-"),r=s.symbol,a=this.safeString(t,"interval"),n=this.findTimeframe(a),h="candles@"+i+"_"+a,d=this.safeValue(t,"candle");this.ohlcvs[r]=this.safeValue(this.ohlcvs,r,{});let c=this.safeValue(this.ohlcvs[r],n);if(void 0===c){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);c=new o(e),this.ohlcvs[r][n]=c}for(let e=0;e<d.length;e++){const t=d[e],i=this.parseOHLCV(t,s);c.append(i)}e.resolve(c,h)}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);e=s.symbol;const r="book",a=r+"@"+s.id,n=this.urls.api.ws,o={action:"subscribe",channels:[{name:r,markets:[s.id]}]},h={messageHash:a,name:r,symbol:e,marketId:s.id,method:this.handleOrderBookSubscription,limit:t,params:i},d=this.extend(o,i);return(await this.watch(n,a,d,a,h)).limit()}handleDelta(e,t){const i=this.safeFloat(t,0),s=this.safeFloat(t,1);e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleOrderBookMessage(e,t,i){const s=this.safeInteger(t,"nonce");return s>i.nonce&&(this.handleDeltas(i.asks,this.safeValue(t,"asks",[])),this.handleDeltas(i.bids,this.safeValue(t,"bids",[])),i.nonce=s),i}handleOrderBook(e,t){const i=this.safeString(t,"event"),s=this.safeString(t,"market"),r=this.safeMarket(s,void 0,"-"),a=r.symbol,n=i+"@"+r.id,o=this.safeValue(this.orderbooks,a);if(void 0!==o)if(void 0===o.nonce){const i=this.safeValue(e.subscriptions,n,{});if(void 0===this.safeValue(i,"watchingOrderBookSnapshot")){i.watchingOrderBookSnapshot=!0,e.subscriptions[n]=i;const s=this.safeValue(this.options,"watchOrderBookSnapshot",{}),r=this.safeInteger(s,"delay",this.rateLimit);this.delay(r,this.watchOrderBookSnapshot,e,t,i)}o.cache.push(t)}else this.handleOrderBookMessage(e,t,o),e.resolve(o,n)}async watchOrderBookSnapshot(e,t,i){const s=this.safeValue(i,"params"),r=this.safeString(i,"marketId"),a="getBook",n=a+"@"+r,o=this.urls.api.ws,h={action:a,market:r};return(await this.watch(o,n,this.extend(h,s),n,i)).limit()}handleOrderBookSnapshot(e,t){const i=this.safeValue(t,"response");if(void 0===i)return t;const s=this.safeString(i,"market"),r=this.safeSymbol(s,void 0,"-"),a="book@"+s,n=this.orderbooks[r],o=this.parseOrderBook(i,r);o.nonce=this.safeInteger(i,"nonce"),n.reset(o);const h=n.cache;for(let t=0;t<h.length;t++){const i=h[t];this.handleOrderBookMessage(e,i,n)}this.orderbooks[r]=n,e.resolve(n,a)}handleOrderBookSubscription(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeInteger(i,"limit");s in this.orderbooks&&delete this.orderbooks[s],this.orderbooks[s]=this.orderBook({},r)}handleOrderBookSubscriptions(e,t,i){for(let s=0;s<i.length;s++){const r=this.safeString(i,s),a="book@"+r;if(!(this.safeSymbol(r,void 0,"-")in this.orderbooks)){const i=this.safeValue(e.subscriptions,a),s=this.safeValue(i,"method");void 0!==s&&s.call(this,e,t,i)}}}async watchOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" watchOrders requires a symbol argument");await this.loadMarkets(),await this.authenticate();const r=this.market(e);e=r.symbol;const n=r.id,o=this.urls.api.ws,h="order:"+e,d={action:"subscribe",channels:[{name:"account",markets:[n]}]},c=await this.watch(o,h,d,h);return this.newUpdates&&(i=c.getLimit(e,i)),this.filterBySymbolSinceLimit(c,e,t,i,!0)}async watchMyTrades(e,t,i,s={}){if(void 0===e)throw new a(this.id+" watchMyTrades requires a symbol argument");await this.loadMarkets(),await this.authenticate();const r=this.market(e);e=r.symbol;const n=r.id,o=this.urls.api.ws,h="myTrades:"+e,d={action:"subscribe",channels:[{name:"account",markets:[n]}]},c=await this.watch(o,h,d,h);return this.newUpdates&&(i=c.getLimit(e,i)),this.filterBySymbolSinceLimit(c,e,t,i,!0)}handleOrder(e,t){const i=this.safeString(t,"market"),s=this.safeMarket(i,void 0,"-"),r="order:"+s.symbol,a=this.parseOrder(t,s);if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new h(e)}this.orders.append(a),e.resolve(this.orders,r)}handleMyTrade(e,t){const i=this.safeString(t,"market"),s=this.safeMarket(i,void 0,"-"),r="myTrades:"+s.symbol,a=this.parseTrade(t,s);if(void 0===this.myTrades){const e=this.safeInteger(this.options,"tradesLimit",1e3);this.myTrades=new n(e)}const o=this.myTrades;o.append(a),e.resolve(o,r)}handleSubscriptionStatus(e,t){const i=this.safeValue(t,"subscriptions",{}),s={book:this.handleOrderBookSubscriptions},r=Object.keys(i);for(let a=0;a<r.length;a++){const n=r[a],o=this.safeValue(s,n);if(void 0!==o){const s=this.safeValue(i,n);o.call(this,e,t,s)}}return t}authenticate(e={}){const t=this.urls.api.ws,i=this.client(t),s="authenticated";let r=this.safeValue(i.subscriptions,s);if(void 0===r){const a=this.milliseconds(),n=a.toString()+"GET/"+this.version+"/websocket",o=this.hmac(this.encode(n),this.encode(this.secret)),h={action:"authenticate",key:this.apiKey,signature:o,timestamp:a},d=this.extend(h,e);r=this.watch(t,s,d),i.subscriptions[s]=r}return r}handleAuthenticationMessage(e,t){const i="authenticated";if(this.safeValue(t,"authenticated",!1))e.resolve(t,i);else{const s=new r(this.json(t));e.reject(s,i),i in e.subscriptions&&delete e.subscriptions[i]}}handleMessage(e,t){const i={subscribed:this.handleSubscriptionStatus,book:this.handleOrderBook,getBook:this.handleOrderBookSnapshot,trade:this.handleTrade,candle:this.handleOHLCV,ticker24h:this.handleTicker,authenticate:this.handleAuthenticationMessage,order:this.handleOrder,fill:this.handleMyTrade},s=this.safeString(t,"event");let r=this.safeValue(i,s);if(void 0===r){const s=this.safeString(t,"action");return r=this.safeValue(i,s),void 0===r?t:r.call(this,e,t)}return r.call(this,e,t)}}},39441:function(e,t,i){"use strict";const s=i(40212),{NotSupported:r,ExchangeError:a,ArgumentsRequired:n}=i(73449),{ArrayCache:o,ArrayCacheBySymbolById:h,ArrayCacheByTimestamp:d}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0,watchMyTrades:!0,watchOrders:!0,watchOrderBook:!0,watchOHLCV:!0},urls:{api:{ws:"wss://api.btcex.com/ws/api/v1"}},options:{watchOrderBook:{snapshotDelay:0,maxRetries:3}},streaming:{ping:this.ping,keepAlive:5e3},exceptions:{},timeframes:{"1m":"1","3m":"3","5m":"4","10m":"10","15m":"15","30m":"30","1h":"60","2h":"120","3h":"180","4h":"240","6h":"360","12h":"720","1d":"1D"}})}requestId(){const e=this.sum(this.safeInteger(this.options,"requestId",0),1);return this.options.requestId=e,e.toString()}async watchBalance(e={}){const t=await this.authenticate(e);let i;[i,e]=this.handleMarketTypeAndParams("watchBalance",void 0,e);const s=this.safeValue(this.options,"accountsByType",{}),r=this.safeString(s,i,i);e=this.omit(e,"type");const a="balancess",n=this.urls.api.ws,o={jsonrpc:"2.0",id:this.requestId(),method:"/private/subscribe",params:{access_token:t,channels:["user.asset."+r]}},h=this.deepExtend(o,e);return await this.watch(n,a,h,a,h)}handleBalance(e,t){const i=this.safeValue(t,"params",{}),s=this.safeValue(i,"data",{});this.balance=this.parseBalance(s),e.resolve(this.balance,"balancess")}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;let n=a.id;a.spot&&(n=a.baseId+"-"+a.quoteId);const o=this.safeString(this.timeframes,t,t),h="ohlcv:"+e+":"+o;let d={jsonrpc:"2.0",id:this.requestId(),method:"/public/subscribe",params:{channels:["chart.trades."+n+"."+o]}};d=this.deepExtend(d,r);const c=this.urls.api.ws,l=await this.watch(c,h,d,h,d);return this.newUpdates&&(s=l.getLimit(e,s)),this.filterBySinceLimit(l,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeValue(t,"params"),s=this.safeString(i,"channel").slice(13),r=s.indexOf("."),a=s.slice(0,r),n=s.slice(r+1),o=this.findTimeframe(n),h=this.safeSymbol(a,void 0,"-"),c="ohlcv:"+h+":"+n,l=this.safeValue(i,"data",{}),u=this.parseOHLCV(l);this.ohlcvs[h]=this.safeValue(this.ohlcvs,h,{});let f=this.safeValue(this.ohlcvs[h],o);if(void 0===f){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);f=new d(e),this.ohlcvs[h][o]=f}f.append(u),e.resolve(f,c)}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e);e=i.symbol;let s=i.id;i.spot&&(s=i.baseId+"-"+i.quoteId);const r=this.urls.api.ws,a="ticker:"+e;let n={jsonrpc:"2.0",id:this.requestId(),method:"/public/subscribe",params:{channels:["ticker."+s+".raw"]}};return n=this.deepExtend(n,t),await this.watch(r,a,n,a)}handleTicker(e,t){const i=this.safeValue(t,"params"),s=this.safeValue(i,"data"),r=this.parseTicker(s),a=this.safeString(r,"symbol"),n="ticker:"+a;this.tickers[a]=r,e.resolve(r,n)}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);e=r.symbol;const a=this.urls.api.ws,n="trades:"+e;let o={jsonrpc:"2.0",id:this.requestId(),method:"/public/subscribe",params:{channels:["trades."+r.id+".raw"]}};o=this.deepExtend(o,s);const h=await this.watch(a,n,o,n,o);return this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySinceLimit(h,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeValue(t,"params",{}),s=this.safeString(i,"channel").split(".")[1],r=this.safeSymbol(s),a="trades:"+r;let n=this.safeValue(this.trades,r);if(void 0===n){const e=this.safeInteger(this.options,"tradesLimit",1e3);n=new o(e),this.trades[r]=n}const h=this.safeValue(i,"data",[]);for(let e=0;e<h.length;e++){const t=h[e],i=this.parseTrade(t,void 0);n.append(i)}this.trades[r]=n,e.resolve(n,a)}async watchMyTrades(e,t,i,s={}){if(void 0===e)throw new n(this.id+" watchMyTrades() requires a symbol argument");await this.loadMarkets();const r=await this.authenticate(),a=this.market(e);e=a.symbol;const o=this.urls.api.ws,h="myTrades:"+e,d={jsonrpc:"2.0",id:this.requestId(),method:"/private/subscribe",params:{access_token:r,channels:["user.trades."+a.id+".raw"]}},c=await this.watch(o,h,d,h);return this.newUpdates&&(i=c.getLimit(e,i)),this.filterBySymbolSinceLimit(c,e,t,i,!0)}handleMyTrades(e,t){const i=this.safeValue(t,"params",{}),s=this.safeString(i,"channel",""),r=s.indexOf(".raw"),a=s.slice(12,r),n=this.safeSymbol(a,void 0,"-"),o=this.safeValue(i,"data",[]);let d=this.myTrades;if(void 0===d){const e=this.safeInteger(this.options,"tradesLimit",1e3);d=new h(e)}for(let e=0;e<o.length;e++){const t=o[e],i=this.parseTrade(t);d.append(i)}this.myTrades=d;const c="myTrades:"+n;e.resolve(d,c)}async watchOrders(e,t,i,s={}){if(void 0===e)throw new n(this.id+"watchesOrders() requires a symbol");await this.loadMarkets();const r=await this.authenticate(),a=this.market(e);e=a.symbol;const o=this.urls.api.ws,h={jsonrpc:"2.0",id:this.requestId(),method:"/private/subscribe",params:{access_token:r,channels:["user.orders."+a.id+".raw"]}},d="orders:"+e,c=this.deepExtend(h,s),l=await this.watch(o,d,c,d);return this.newUpdates&&(i=l.getLimit(e,i)),this.filterBySymbolSinceLimit(l,e,t,i,!0)}handleOrder(e,t){const i=this.safeValue(t,"params",{}),s=this.safeValue(i,"data",{});let r=this.orders;if(void 0===r){const e=this.safeInteger(this.options,"ordersLimit",1e3);r=new h(e)}const a=this.parseOrder(s),n="orders:"+this.safeString(a,"symbol");r.append(a),this.orders=r,e.resolve(this.orders,n)}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);e=s.symbol;let r=s.id;s.spot&&(r=s.baseId+"-"+s.quoteId);const a=this.urls.api.ws;i=this.omit(i,"type");const n="orderbook:"+e,o={jsonrpc:"2.0",id:this.requestId(),method:"/public/subscribe",params:{channels:["book."+r+".raw"]}},h=this.deepExtend(o,i);return(await this.watch(a,n,h,n)).limit()}handleOrderBook(e,t){const i=this.safeValue(t,"params"),s=this.safeValue(i,"data"),r=this.safeString(s,"instrument_name"),a=this.safeSymbol(r,void 0,"-"),n=this.safeValue(this.orderbooks,a),o=this.safeInteger(n,"nonce"),h=this.safeInteger(s,"change_id"),d="orderbook:"+a;if(void 0!==o)h<=o||(this.handleDelta(n,s),e.resolve(n,d));else{if(n.cache.length===this.handleOption("watchOrderBook","snapshotDelay",0)){const t=0;this.spawn(this.loadOrderBook,e,d,a,t)}n.cache.push(s)}}getCacheIndex(e,t){const i=t[0];let s=this.safeInteger(i,"change_id");const r=this.safeInteger(e,"nonce");if(r<s-1)return-1;for(let e=0;e<t.length;e++){const i=t[e];if(s=this.safeInteger(i,"change_id"),r===s-1)return e}return t.length}handleDelta(e,t){const i=this.safeInteger(t,"timestamp");e.timestamp=i,e.datetime=this.iso8601(i),e.nonce=this.safeInteger(t,"change_id");const s=this.safeValue(t,"bids",[]),r=this.safeValue(t,"asks",[]),a=e.bids,n=e.asks;this.handleBidAsks(a,s),this.handleBidAsks(n,r)}handleBidAsks(e,t){for(let i=0;i<t.length;i++){const s=this.parseBidAsk(t[i],1,2);e.storeArray(s)}}handleUser(e,t){const i=this.safeValue(t,"params"),s=this.safeString(i,"channel").slice(5),a=s.indexOf("."),n=s.slice(0,a),o={asset:this.handleBalance,orders:this.handleOrder,trades:this.handleMyTrades},h=this.safeValue(o,n);if(void 0!==h)return h.call(this,e,t);throw new r(this.id+" received an unsupported message: "+this.json(t))}handleErrorMessage(e,t){const i=this.safeValue(t,"error",{});throw new a(this.id+" error: "+this.json(i))}handleAuthenticate(e,t){const i=this.safeValue(t,"result",{}),s=this.safeInteger(i,"expires_in",0);this.options.expiresAt=1e3*this.sum(this.seconds(),s);const r=this.safeString(i,"access_token");e.resolve(r,"authenticated")}handleSubscription(e,t){const i=this.safeValue(t,"result",[]);for(let e=0;e<i.length;e++){const t=i[e].split("."),s=this.safeString(t,0),r=this.safeString(t,1);if("book"===s){const e=this.safeSymbol(r,void 0,"-");this.orderbooks[e]=this.orderBook({})}}}handlePong(e,t){e.lastPong=this.milliseconds()}handleMessage(e,t){if("PONG"===t)return void this.handlePong(e,t);if(void 0!==this.safeValue(t,"error"))return this.handleErrorMessage(e,t);const i=this.safeValue(t,"result",{});if(void 0!==this.safeString(i,"access_token"))return this.handleAuthenticate(e,t);if("subscription"===this.safeString(t,"method")){const i=this.safeValue(t,"params"),s=this.safeString(i,"channel").split("."),r=this.safeString(s,0),a={ticker:this.handleTicker,trades:this.handleTrades,chart:this.handleOHLCV,balances:this.handleBalance,trading:this.handleOrder,user:this.handleUser,book:this.handleOrderBook},n=this.safeValue(a,r);if(void 0!==n)return n.call(this,e,t)}else"result"in t&&this.handleSubscription(e,t);return t}authenticate(e={}){const t=this.urls.api.ws,i=this.client(t),s="authenticated",r=this.safeNumber(this.options,"expiresAt"),a=this.milliseconds();let n=this.safeValue(i.subscriptions,s);if(void 0===n||r<=a){const r={jsonrpc:"2.0",id:this.requestId(),method:"/public/auth",params:{grant_type:"client_credentials",client_id:this.apiKey,client_secret:this.secret}},a=this.extend(r,e);n=this.watch(t,s,a),i.subscriptions[s]=n}return n}ping(e){return"PING"}}},5520:function(e,t,i){"use strict";const s=i(73803),{AuthenticationError:r,ExchangeError:a,BadRequest:n}=i(73449),{ArrayCache:o,ArrayCacheBySymbolById:h,ArrayCacheByTimestamp:d}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchMyTrades:!0,watchOHLCV:!0,watchOrderBook:!0,watchOrders:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0,watchPosition:void 0},urls:{api:{ws:{public:{spot:"wss://stream.{hostname}/spot/public/v3",inverse:"wss://stream.{hostname}/contract/inverse/public/v3",usdt:"wss://stream.{hostname}/contract/usdt/public/v3",usdc:{option:"wss://stream.{hostname}/option/usdc/public/v3",swap:"wss://stream.{hostname}/contract/usdc/public/v3"}},private:{spot:"wss://stream.{hostname}/spot/private/v3",contract:{unified:"wss://stream.{hostname}/unified/private/v3",nonUnified:"wss://stream.{hostname}/contract/private/v3"}}}},test:{ws:{public:{spot:"wss://stream-testnet.{hostname}/spot/public/v3",inverse:"wss://stream-testnet.{hostname}/contract/inverse/public/v3",usdt:"wss://stream-testnet.{hostname}/contract/usdt/public/v3",usdc:{option:"wss://stream-testnet.{hostname}/option/usdc/public/v3",swap:"wss://stream-testnet.{hostname}/contract/usdc/public/v3"}},private:{spot:"wss://stream-testnet.{hostname}/spot/private/v3",contract:{unified:"wss://stream-testnet.{hostname}/unified/private/v3",nonUnified:"wss://stream-testnet.{hostname}/contract/private/v3"}}}}},options:{watchTicker:{name:"tickers"},spot:{timeframes:{"1m":"1m","3m":"3m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","2h":"2h","4h":"4h","6h":"6h","12h":"12h","1d":"1d","1w":"1w","1M":"1M"}},contract:{timeframes:{"1m":"1","3m":"3","5m":"5","15m":"15","30m":"30","1h":"60","2h":"120","4h":"240","6h":"360","12h":"720","1d":"D","1w":"W","1M":"M"}}},streaming:{ping:this.ping,keepAlive:2e4},exceptions:{ws:{exact:{}}}})}requestId(){const e=this.sum(this.safeInteger(this.options,"requestId",0),1);return this.options.requestId=e,e}getUrlByMarketType(e,t=!1,i=!1,s,r={}){const a=t?"private":"public";let n,o,h,d,c,l=this.urls.api.ws;if(void 0!==e)c=this.market(e),n="USDC"===c.settle,d="USDT"===c.settle,o=c.spot,h=c.type;else{[h,r]=this.handleMarketTypeAndParams(s,void 0,r);let e=this.safeString(this.options,"defaultSettle");e=this.safeString2(r,"settle","defaultSettle",e),n="USDC"===e,d="USDT"===e,o="spot"===h}if(t)if(o)l=l[a].spot;else{const e=i?"unified":"nonUnified";l=l[a].contract[e]}else l=o?l[a].spot:n?l[a].usdc[h]:d?l[a].usdt:l[a].inverse;return l=this.implodeHostname(l),l}cleanParams(e){return e=this.omit(e,["type","subType","settle","defaultSettle","unifiedMargin"])}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s="ticker:"+i.symbol,r=this.getUrlByMarketType(e,!1,!1,t);t=this.cleanParams(t);const a=this.safeValue(this.options,"watchTicker",{});let o=this.safeString(a,"name","tickers");if(!i.spot&&"tickers"!==o)throw new n(this.id+" watchTicker() only supports name tickers for contract markets");o+="."+i.id;const h=[o];return await this.watchTopics(r,s,h,t)}handleTicker(e,t){const i=this.safeString(t,"topic",""),s=this.safeString(t,"type",""),r=this.safeValue(t,"data",{}),a=void 0!==this.safeString(r,"s");let n,o;if("snapshot"===s||a)o=this.parseTicker(r),n=o.symbol;else if("delta"===s){const e=i.split("."),t=e.length,s=this.safeString(e,t-1);n=this.market(s).symbol;const a=this.safeValue(this.tickers,n,{}),h=this.safeValue(a,"info",{}),d=this.extend(h,r);o=this.parseTicker(d)}const h=this.safeInteger(t,"ts");o.timestamp=h,o.datetime=this.iso8601(h),this.tickers[n]=o;const d="ticker:"+n;e.resolve(this.tickers[n],d)}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;const n=this.getUrlByMarketType(e,!1,!1,r);let o;r=this.cleanParams(r);const h=a.spot?"spot":"contract",d=this.safeValue(this.options,h,{}),c=this.safeValue(d,"timeframes",{}),l=this.safeString(c,t,t),u=["kline."+l+"."+a.id],f="kline:"+l+":"+e;return o=await this.watchTopics(n,f,u,r),this.newUpdates&&(s=o.getLimit(e,s)),this.filterBySinceLimit(o,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeValue(t,"data",{}),s=this.safeString(t,"topic").split("."),r=s.length,a=this.safeString(s,1),n=this.safeString(s,r-1),o=e.url.indexOf("spot")>-1?"spot":"contract",h=this.safeMarket(n,void 0,void 0,o).symbol,c=this.safeValue(this.ohlcvs,h);void 0===c&&(this.ohlcvs[h]={});let l=this.safeValue(c,a);if(void 0===l){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);l=new d(e),this.ohlcvs[h][a]=l}if(Array.isArray(i))for(let e=0;e<i.length;e++){const t=this.parseWsContractOHLCV(i[e]);l.append(t)}else{const e=this.parseSpotOHLCV(i);l.append(e)}const u="kline:"+a+":"+h;e.resolve(l,u)}parseWsContractOHLCV(e){return[this.safeInteger(e,"timestamp"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber2(e,"volume","turnover")]}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);e=s.symbol;const r=this.getUrlByMarketType(e,!1,!1,i);i=this.cleanParams(i);const a="orderbook:"+e;if(void 0===t)t=s.spot?40:200;else if(!s.spot&&1!==t&&50!==t&&200!==t)throw new n(this.id+" watchOrderBook() can only use limit 1, 50 and 200.");const o=["orderbook."+t.toString()+"."+s.id];return(await this.watchTopics(r,a,o,i)).limit()}handleOrderBook(e,t){const i=e.url.indexOf("spot")>=0;let s="snapshot"===this.safeString(t,"type");i&&(s=!0);const r=this.safeValue(t,"data",{}),a=this.safeString(r,"s"),n=i?"spot":"contract",o=this.safeMarket(a,void 0,void 0,n).symbol,h=this.safeInteger(t,"ts");let d=this.safeValue(this.orderbooks,o);if(void 0===d&&(d=this.orderBook()),s){const e=this.parseOrderBook(r,o,h,"b","a");d.reset(e)}else{const e=this.safeValue(r,"a",[]),t=this.safeValue(r,"b",[]);this.handleDeltas(d.asks,e),this.handleDeltas(d.bids,t),d.timestamp=h,d.datetime=this.iso8601(h)}const c="orderbook:"+o;this.orderbooks[o]=d,e.resolve(d,c)}handleDelta(e,t){const i=this.parseBidAsk(t,0,1);e.storeArray(i)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);e=r.symbol;const a=this.getUrlByMarketType(e,!1,!1,s);s=this.cleanParams(s);const n="trade:"+e;let o;r.spot?o="trade."+r.id:(o="publicTrade.",r.option?o+=r.baseId:o+=r.id);const h=await this.watchTopics(a,n,[o],s);return this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySinceLimit(h,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeValue(t,"data",{});let s;const r=this.safeString(t,"topic").split("."),a="trade"===this.safeString(r,0)?"spot":"contract",n=this.safeString(r,1),h=this.safeMarket(n,void 0,void 0,a);s=Array.isArray(i)?i:[i];const d=h.symbol;let c=this.safeValue(this.trades,d);if(void 0===c){const e=this.safeInteger(this.options,"tradesLimit",1e3);c=new o(e),this.trades[d]=c}for(let e=0;e<s.length;e++){const t=this.parseWsTrade(s[e],h);c.append(t)}const l="trade:"+d;e.resolve(c,l)}parseWsTrade(e,t){const i=this.safeStringN(e,["i","T","v"]),s="BT"in e?"contract":"spot",r=this.safeString(e,"s"),a=(t=this.safeMarket(r,t,void 0,s)).symbol,n=this.safeInteger2(e,"t","T");let o,h=this.safeStringLower(e,"S");const d=this.safeValue(e,"m");void 0===h?h=d?"buy":"sell":o=d;const c=this.safeString(e,"p"),l=this.safeString2(e,"q","v"),u=this.safeString(e,"o");return this.safeTrade({id:i,info:e,timestamp:n,datetime:this.iso8601(n),symbol:a,order:u,type:void 0,side:h,takerOrMaker:o,price:c,amount:l,cost:void 0,fee:void 0},t)}getPrivateType(e){return e.indexOf("spot")>=0?"spot":e.indexOf("unified")>=0?"unified":e.indexOf("contract")>=0?"contract":void 0}async watchMyTrades(e,t,i,s={}){let r="myTrades";await this.loadMarkets(),void 0!==e&&(r+=":"+(e=this.symbol(e)));const a=await this.isUnifiedMarginEnabled(),n=this.getUrlByMarketType(e,!0,a,"watchMyTrades",s);await this.authenticate(n);const o=this.safeValue({spot:"ticketInfo",contract:"user.execution.contractAccount",unified:"user.execution.unifiedAccount"},this.getPrivateType(n)),h=await this.watchTopics(n,r,[o],s);return this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySinceLimit(h,t,i,"timestamp",!0)}handleMyTrades(e,t){const i="ticketInfo"===this.safeString(t,"topic");let s=this.safeValue(t,"data",[]);if(s=this.safeValue(s,"result",s),void 0===this.myTrades){const e=this.safeInteger(this.options,"tradesLimit",1e3);this.myTrades=new h(e)}const r=this.myTrades,a={},n=i?"parseWsTrade":"parseTrade";for(let e=0;e<s.length;e++){const t=s[e],i=this[n](t);a[i.symbol]=!0,r.append(i)}const o=Object.keys(a);for(let t=0;t<o.length;t++){const i="myTrades:"+o[t];e.resolve(r,i)}e.resolve(r,"myTrades")}async watchOrders(e,t,i,s={}){await this.loadMarkets();let r="orders";void 0!==e&&(r+=":"+(e=this.symbol(e)));const a=await this.isUnifiedMarginEnabled(),n=this.getUrlByMarketType(void 0,!0,a,"watchOrders",s);await this.authenticate(n);const o=this.safeValue({spot:["order","stopOrder"],contract:["user.order.contractAccount"],unified:["user.order.unifiedAccount"]},this.getPrivateType(n)),h=await this.watchTopics(n,r,o,s);return this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySymbolSinceLimit(h,e,t,i,!0)}handleOrder(e,t,i){const s=this.safeString(t,"topic","");if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new h(e)}const r=this.orders;let a,n=[];"order"===s?(n=this.safeValue(t,"data",[]),a="parseWsSpotOrder"):(a="parseContractOrder",n=this.safeValue(t,"data",[]),n=this.safeValue(n,"result",n));const o={};for(let e=0;e<n.length;e++){const t=this[a](n[e]);o[t.symbol]=!0,r.append(t)}const d=Object.keys(o);for(let t=0;t<d.length;t++){const i="orders:"+d[t];e.resolve(r,i)}e.resolve(r,"orders")}parseWsSpotOrder(e,t){const i=this.safeString(e,"i"),s=this.safeString(e,"s"),r=this.safeSymbol(s,t,void 0,"spot"),a=this.safeInteger(e,"O");let n=this.safeString(e,"p");"0"===n&&(n=void 0);const o=this.safeString(e,"z"),h=this.parseOrderStatus(this.safeString(e,"X")),d=this.safeStringLower(e,"S"),c=this.safeString(e,"E"),l=this.safeString(e,"f");let u;const f=this.safeString(e,"Z"),p=this.safeString(e,"q");let m,g=this.safeStringLower(e,"o");u=g.indexOf("quote")>=0?o:p,g.indexOf("market")>=0&&(g="market");const y=this.safeString(e,"n");if(void 0!==y&&"0"!==y){const t=this.safeString(e,"N");m={cost:y,currency:this.safeCurrencyCode(t)}}return this.safeOrder({info:e,id:i,clientOrderId:this.safeString(e,"c"),timestamp:a,datetime:this.iso8601(a),lastTradeTimestamp:c,symbol:r,type:g,timeInForce:l,postOnly:void 0,side:d,price:n,stopPrice:void 0,triggerPrice:void 0,amount:u,cost:f,average:void 0,filled:o,remaining:void 0,status:h,fee:m},t)}async watchBalance(e={}){const t=await this.isUnifiedMarginEnabled(),i=this.getUrlByMarketType(void 0,!0,t,"watchBalance",e);await this.authenticate(i);const s=[this.safeValue({spot:"outboundAccountInfo",contract:"user.wallet.contractAccount",unified:"user.wallet.unifiedAccount"},this.getPrivateType(i))];return await this.watchTopics(i,"balances",s,e)}handleBalance(e,t){void 0===this.balance&&(this.balance={});let i="balance";const s=this.safeValue(t,"topic");let r,a=[];if("outboundAccountInfo"===s){const e=this.safeValue(t,"data",[]);for(let t=0;t<e.length;t++){const i=this.safeValue(e[t],"B",[]);a=this.arrayConcat(a,i)}r=a}if("user.wallet.contractAccount"===s&&(a=this.safeValue(t,"data",[]),r=a),"user.wallet.unifiedAccount"===s){const e=this.safeValue(t,"data",{}),i=this.safeValue(e,"result",{});a=this.safeValue(i,"coin",[]),r=i}for(let e=0;e<a.length;e++)this.parseWsBalance(a[e]);this.balance.info=r;const n=this.safeInteger(t,"ts");this.balance.timestamp=n,this.balance.datetime=this.iso8601(n),this.balance=this.safeBalance(this.balance),i="balances",e.resolve(this.balance,"balances")}parseWsBalance(e){const t=this.account(),i=this.safeStringN(e,["a","currencyCoin","coin"]),s=this.safeCurrencyCode(i);t.free=this.safeStringN(e,["availableBalanceWithoutConvert","availableBalance","f"]),t.used=this.safeString(e,"l"),t.total=this.safeString(e,"walletBalance"),this.balance[s]=t}async watchTopics(e,t,i=[],s={}){const r={op:"subscribe",req_id:this.requestId(),args:i},a=this.extend(r,s);return await this.watch(e,t,a,t)}authenticate(e,t={}){this.checkRequiredCredentials();const i="authenticated",s=this.client(e);let r=this.safeValue(s.subscriptions,i);if(void 0===r){let a=this.milliseconds()+1e4;a=a.toString();const n="GET/realtime"+a,o=this.hmac(this.encode(n),this.encode(this.secret),"sha256","hex"),h={op:"auth",args:[this.apiKey,a,o]},d=this.extend(h,t);r=this.watch(e,i,d),s.subscriptions[i]=r}return r}handleErrorMessage(e,t){const i=this.safeString2(t,"code","ret_code");try{if(void 0!==i){const e=this.id+" "+this.json(t);this.throwExactlyMatchedException(this.exceptions.exact,i,e)}const e=this.safeValue(t,"success");if(void 0!==e&&!e){const e=this.safeString(t,"ret_msg"),i=this.safeValue(t,"request",{});throw"auth"===this.safeString(i,"op")?new r("Authentication failed: "+e):new a(this.id+" "+e)}return!1}catch(t){if(t instanceof r){const i="authenticated";e.reject(t,i),i in e.subscriptions&&delete e.subscriptions[i]}else e.reject(t);return!0}}handleMessage(e,t){if(this.handleErrorMessage(e,t))return;if("pong"===this.safeString(t,"ret_msg"))return void this.handlePong(e,t);if(void 0!==this.safeInteger(t,"pong"))return void this.handlePong(e,t);const i=this.safeString(t,"op");if("pong"===i)return void this.handlePong(e,t);if("sub"===this.safeString(t,"event"))return void this.handleSubscriptionStatus(e,t);const s=this.safeString(t,"topic",""),r={orderbook:this.handleOrderBook,kline:this.handleOHLCV,order:this.handleOrder,stopOrder:this.handleOrder,ticker:this.handleTicker,trade:this.handleTrades,publicTrade:this.handleTrades,depth:this.handleOrderBook,wallet:this.handleBalance,outboundAccountInfo:this.handleBalance,execution:this.handleMyTrades,ticketInfo:this.handleMyTrades},a=Object.keys(r);for(let i=0;i<a.length;i++){const n=a[i];if(s.indexOf(a[i])>=0){return void r[n].call(this,e,t)}}const n=this.safeString(t,"type");"auth"!==i&&"AUTH_RESP"!==n||this.handleAuthenticate(e,t)}ping(e){return{req_id:this.requestId(),op:"ping"}}handlePong(e,t){return e.lastPong=this.safeInteger(t,"pong"),t}handleAuthenticate(e,t){const i="authenticated";if(this.safeValue(t,"success"))e.resolve(t,i);else{const s=new r(this.id+" "+this.json(t));e.reject(s,i),i in e.subscriptions&&delete e.subscriptions[i]}return t}handleSubscriptionStatus(e,t){return t}}},782:function(e,t,i){"use strict";const{ExchangeError:s,ArgumentsRequired:r}=i(73449),a=i(6832),n=i(74228),{ArrayCacheBySymbolById:o,ArrayCacheByTimestamp:h,ArrayCache:d}=i(56062);e.exports=class extends n{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchTicker:!0,watchTickers:!0,watchTrades:!0,watchMyTrades:!0,watchOrders:!0,watchOrderBook:!0,watchOHLCV:!0,watchPosition:void 0},urls:{api:{ws:"wss://ws.cex.io/ws"}},options:{orderbook:{}},streaming:{},exceptions:{}})}requestId(){const e=this.sum(this.safeInteger(this.options,"requestId",0),1);return this.options.requestId=e,e}async watchBalance(e={}){await this.authenticate(e);const t="balance",i=this.urls.api.ws,s={e:"get-balance",data:{},oid:this.requestId()},r=this.deepExtend(s,e);return await this.watch(i,t,r,t,r)}handleBalance(e,t){const i=this.safeValue(t,"data",{}),s=this.safeValue(i,"balance",{}),r=this.safeValue(i,"obalance",{}),a={},n=Object.keys(s);for(let e=0;e<n.length;e++){const t=n[e],i=this.account();i.free=this.safeString(s,t),i.used=this.safeString(r,t);a[this.safeCurrencyCode(t)]=i}this.balance=this.safeBalance(a),e.resolve(this.balance,"balance")}async watchTrades(e,t,i,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;const n=this.urls.api.ws,o="old:"+e,h=this.safeValue(this.clients,n);if(void 0!==h){const e=Object.keys(h.subscriptions);for(let t=0;t<e.length;t++){let i=e[t];if(i!==o&&(i=i.slice(0,3),"old"===i))throw new s(this.id+" watchTrades() only supports watching one symbol at a time.")}}const d={e:"subscribe",rooms:["pair-"+a.base+"-"+a.quote]},c=this.deepExtend(d,r),l=await this.watch(n,"trades",c,o);for(let t=0;t<l.length;t++)l[t].symbol=e;return this.filterBySinceLimit(l,t,i,"timestamp",!0)}handleTradesSnapshot(e,t){const i=this.safeValue(t,"data",[]),s=this.safeInteger(this.options,"tradesLimit",1e3),r=new d(s);for(let e=0;e<i.length;e++){const t=i[e],s=this.parseWsOldTrade(t);r.append(s)}this.trades=r,e.resolve(this.trades,"trades")}parseWsOldTrade(e,t){Array.isArray(e)||(e=e.split(":"));const i=this.safeString(e,0),s=this.safeNumber(e,1),r=this.safeString(e,2),a=this.safeString(e,3),n=this.safeString(e,4);return this.safeTrade({info:e,id:n,timestamp:s,datetime:this.iso8601(s),symbol:void 0,type:void 0,side:i,order:void 0,takerOrMaker:void 0,price:a,amount:r,cost:void 0,fee:void 0},t)}handleTrade(e,t){const i=this.safeValue(t,"data",[]),s=this.trades;for(let e=0;e<i.length;e++){const t=i[e],r=this.parseWsOldTrade(t);s.append(r)}this.trades=s,e.resolve(this.trades,"trades")}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e);e=i.symbol;const s=this.urls.api.ws,r="ticker:"+e;let a={e:"subscribe",rooms:["tickers"]},n="tickers";"private"===this.safeString(t,"method","private")&&(await this.authenticate(),a={e:"ticker",data:[i.baseId,i.quoteId],oid:this.requestId()},n="ticker:"+e);const o=this.deepExtend(a,t);return await this.watch(s,r,o,n)}async watchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=this.urls.api.ws,s="tickers",r=this.deepExtend({e:"subscribe",rooms:["tickers"]},t),a=await this.watch(i,s,r,s),n=a.symbol;if(void 0!==e&&!this.inArray(n,e))return await this.watchTickers(e,t);if(this.newUpdates){const e={};return e[n]=a,e}return this.filterByArray(this.tickers,"symbol",e)}handleTicker(e,t){const i=this.safeValue(t,"data",{}),s=this.parseWsTicker(i),r=s.symbol,a="ticker:"+r;this.tickers[r]=s,e.resolve(s,a),e.resolve(s,"tickers")}parseWsTicker(e,t){const i=this.safeValue(e,"pair",[]);let s=this.safeString(e,"symbol1");void 0===s&&(s=this.safeString(i,0));let r=this.safeString(e,"symbol2");void 0===r&&(r=this.safeString(i,1));const a=this.safeCurrencyCode(s)+"/"+this.safeCurrencyCode(r);let n=this.safeInteger(e,"timestamp");return void 0!==n&&(n*=1e3),this.safeTicker({symbol:a,timestamp:n,datetime:this.iso8601(n),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:this.safeString(e,"open24"),close:void 0,last:this.safeString2(e,"price","last"),previousClose:void 0,change:this.safeString(e,"priceChange"),percentage:this.safeString(e,"priceChangePercentage"),average:void 0,baseVolume:void 0,quoteVolume:this.safeString(e,"volume"),info:e},t)}async watchOrders(e,t,i,s={}){if(void 0===e)throw new r(this.id+" watchOrders requires a symbol argument");await this.loadMarkets(),await this.authenticate(s);const a=this.urls.api.ws,n=this.market(e),o="orders:"+(e=n.symbol),h={e:"open-orders",data:{pair:[n.baseId,n.quoteId]},oid:e},d=this.deepExtend(h,s),c=await this.watch(a,o,d,o,d);return this.newUpdates&&(i=c.getLimit(e,i)),this.filterBySymbolSinceLimit(c,e,t,i,!0)}async watchMyTrades(e,t,i,s={}){if(void 0===e)throw new r(this.id+" watchOrders requires a symbol argument");await this.loadMarkets(),await this.authenticate(s);const a=this.urls.api.ws,n=this.market(e),o="myTrades:"+n.symbol,h="orders:"+n.symbol,d={e:"open-orders",data:{pair:[n.baseId,n.quoteId]},oid:n.symbol},c=this.deepExtend(d,s),l=await this.watch(a,o,c,h,c);return this.filterBySymbolSinceLimit(l,n.symbol,t,i,!0)}handleTransaction(e,t){const i=this.safeValue(t,"data");void 0!==this.safeString(i,"symbol2")&&(this.handleOrderUpdate(e,t),this.handleMyTrades(e,t))}handleMyTrades(e,t){const i=this.safeValue(t,"data",{});let s=this.myTrades;if(void 0===s){const e=this.safeInteger(this.options,"tradesLimit",1e3);s=new o(e),this.myTrades=s}const r=this.parseWsTrade(i);s.append(r);const a="myTrades:"+r.symbol;e.resolve(s,a)}parseWsTrade(e,t){const i=this.safeString(e,"type"),s=this.safeString(e,"price"),r=this.safeString(e,"time"),n=this.safeString(e,"symbol"),o=this.safeString(e,"symbol2"),h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o);let c=h+"/"+d,l=this.safeString(e,"amount");"sell"===i&&(c=d+"/"+h,l=a.stringDiv(l,s));const u={id:this.safeString(e,"id"),order:this.safeString(e,"order"),info:e,timestamp:this.parse8601(r),datetime:r,symbol:c,type:void 0,side:i,takerOrMaker:void 0,price:s,cost:void 0,amount:l,fee:void 0},f=this.safeString(e,"fee_amount");return void 0!==f&&(u.fee={cost:f,currency:d,rate:void 0}),this.safeTrade(u,t)}handleOrderUpdate(e,t){const i=this.safeValue(t,"data",{}),s="tx"===this.safeString(t,"e"),r=this.safeString2(i,"id","order");let a=this.safeString(i,"remains"),n=this.safeString(i,"symbol"),h=this.safeString(i,"symbol2");const d=this.safeValue(i,"pair");void 0!==d&&(n=this.safeString(d,"symbol1"),h=this.safeString(d,"symbol2"));const c=this.safeCurrencyCode(n),l=this.safeCurrencyCode(h),u=c+"/"+l,f=this.safeMarket(u);if(a=this.currencyFromPrecision(c,a),void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new o(e)}const p=this.safeValue(this.orders.hashmap,u,{});let m=this.safeValue(p,r);void 0===m&&(m=this.parseWsOrderUpdate(i,f)),m.remaining=a;this.safeValue(i,"cancel",!1)&&(m.status="canceled"),s&&(m.status="closed");const g=this.safeNumber(i,"fee");void 0!==g&&(m.fee={cost:g,currency:l,rate:void 0});const y=this.safeInteger(i,"time",this.milliseconds());m.timestamp=y,m.datetime=this.iso8601(y),m=this.safeOrder(m);const b=this.orders;b.append(m);const v="orders:"+u;e.resolve(b,v)}parseWsOrderUpdate(e,t){const i=void 0!==this.safeValue(e,"d"),s=this.safeString(e,"remains");let r;void 0!==s&&(r=this.currencyFromPrecision(t.base,s));const a=this.safeString(e,"amount");i||this.currencyFromPrecision(t.base,a);let n=this.safeString(e,"symbol"),o=this.safeString(e,"symbol2");void 0!==this.safeValue(e,"pair")&&(n=this.safeString(e,"symbol1"),o=this.safeString(e,"symbol2"));const h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o),c=h+"/"+d;t=this.safeMarket(c,t);const l=this.safeInteger(e,"time",this.milliseconds());let u=l;i&&(u=this.parse8601(l));let f="open";this.safeValue(e,"cancel",!1)?f="canceled":i&&(f="closed");const p={id:this.safeString2(e,"id","order"),clientOrderId:void 0,info:e,timestamp:u,datetime:this.iso8601(u),lastTradeTimestamp:void 0,status:f,symbol:c,type:void 0,timeInForce:void 0,postOnly:void 0,side:this.safeString(e,"type"),price:this.safeNumber(e,"price"),stopPrice:void 0,triggerPrice:void 0,average:void 0,cost:void 0,amount:a,filled:void 0,remaining:r,fee:{cost:this.safeNumber2(e,"fee","fee_amount"),currency:d,rate:void 0},trades:void 0};return i&&(p.trades=this.parseWsTrade(e,t)),this.safeOrder(p,t)}fromPrecision(e,t){if(void 0===e)return;const i=new a(e);return i.decimals=this.sum(i.decimals,t),i.reduce(),i.toString()}currencyFromPrecision(e,t){const i=this.safeInteger(this.currencies[e],"precision",0);return this.fromPrecision(t,i)}handleOrdersSnapshot(e,t){const i=this.safeString(t,"oid"),s=this.safeValue(t,"data",[]);let r=this.orders;if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);r=new o(e)}for(let e=0;e<s.length;e++){const t=s[e],a=this.safeMarket(i),n=this.parseOrder(t,a);n.status="open",r.append(n)}this.orders=r;const a="orders:"+i;r.length>0&&e.resolve(r,a)}async watchOrderBook(e,t,i={}){await this.loadMarkets(),await this.authenticate();const s=this.market(e);e=s.symbol;const r=this.urls.api.ws,a="orderbook:"+e,n=void 0===t?0:t,o={e:"order-book-subscribe",data:{pair:[s.baseId,s.quoteId],subscribe:!0,depth:n},oid:this.requestId()},h=this.deepExtend(o,i);return(await this.watch(r,a,h,a)).limit(t)}handleOrderBookSnapshot(e,t){const i=this.safeValue(t,"data",{}),s=this.safeString(i,"pair"),r=this.pairToSymbol(s),a="orderbook:"+r,n=this.safeInteger2(i,"timestamp_ms","timestamp"),o=this.safeNumber(i,"id"),h=this.orderBook({}),d=this.parseOrderBook(i,r,n,"bids","asks");d.nonce=o,h.reset(d),this.options.orderbook[r]={incrementalId:o},this.orderbooks[r]=h,e.resolve(h,a)}pairToSymbol(e){const t=e.split(":"),i=this.safeString(t,0),s=this.safeString(t,1);return this.safeCurrencyCode(i)+"/"+this.safeCurrencyCode(s)}handleOrderBookUpdate(e,t){const i=this.safeValue(t,"data",{}),r=this.safeNumber(i,"id"),a=this.safeString(i,"pair",""),n=this.pairToSymbol(a),o=this.safeValue(this.orderbooks,n);if(r!==o.nonce+1)throw new s(this.id+" watchOrderBook() skipped a message");const h="orderbook:"+n,d=this.safeInteger(i,"time"),c=this.safeValue(i,"asks",[]),l=this.safeValue(i,"bids",[]);this.handleDeltas(o.asks,c),this.handleDeltas(o.bids,l),o.timestamp=d,o.datetime=this.iso8601(d),o.nonce=r,e.resolve(o,h)}handleDelta(e,t){const i=this.parseBidAsk(t,0,1);e.storeArray(i)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n="ohlcv:"+(e=a.symbol),o=this.urls.api.ws,h={e:"init-ohlcv",i:t,rooms:["pair-"+a.baseId+"-"+a.quoteId]},d=await this.watch(o,n,this.extend(h,r),n);return this.newUpdates&&(s=d.getLimit(e,s)),this.filterBySinceLimit(d,i,s,0,!0)}handleInitOHLCV(e,t){const i=this.safeString(t,"pair").split(":"),s=this.safeString(i,0),r=this.safeString(i,1),a=this.safeCurrencyCode(s)+"/"+this.safeCurrencyCode(r),n=this.safeMarket(a),o="ohlcv:"+a,d=this.safeValue(t,"data",[]),c=this.safeInteger(this.options,"OHLCVLimit",1e3),l=new h(c),u=this.sortBy(d,0);for(let e=0;e<u.length;e++)l.append(this.parseOHLCV(u[e],n));this.ohlcvs[a]=l,e.resolve(l,o)}handleOHLCV24(e,t){return t}handleOHLCV1m(e,t){const i=this.safeValue(t,"data",{}),s=this.safeString(i,"pair"),r=this.pairToSymbol(s),a="ohlcv:"+r,n=[this.safeTimestamp(i,"time"),this.safeNumber(i,"o"),this.safeNumber(i,"h"),this.safeNumber(i,"l"),this.safeNumber(i,"c"),this.safeNumber(i,"v")],o=this.safeValue(this.ohlcvs,r);o.append(n),e.resolve(o,a)}handleOHLCV(e,t){const i=this.safeValue(t,"data",[]),s=this.safeString(t,"pair"),r=this.pairToSymbol(s),a="ohlcv:"+r,n=this.safeValue(this.ohlcvs,r);for(let e=0;e<i.length;e++){const t=[this.safeTimestamp(i[e],0),this.safeNumber(i[e],1),this.safeNumber(i[e],2),this.safeNumber(i[e],3),this.safeNumber(i[e],4),this.safeNumber(i[e],5)];n.append(t)}i.length>0&&e.resolve(n,a)}handleConnected(e,t){return t}handleErrorMessage(e,t){throw new s(this.id+" "+this.json(t))}handleMessage(e,t){if("error"===this.safeString(t,"ok"))return this.handleErrorMessage(e,t);const i=this.safeString(t,"e"),s={auth:this.handleAuthenticationMessage,connected:this.handleConnected,tick:this.handleTicker,ticker:this.handleTicker,"init-ohlcv-data":this.handleInitOHLCV,ohlcv24:this.handleOHLCV24,ohlcv1m:this.handleOHLCV1m,ohlcv:this.handleOHLCV,"get-balance":this.handleBalance,"order-book-subscribe":this.handleOrderBookSnapshot,md_update:this.handleOrderBookUpdate,"open-orders":this.handleOrdersSnapshot,order:this.handleOrderUpdate,"history-update":this.handleTrade,history:this.handleTradesSnapshot,tx:this.handleTransaction},r=this.safeValue(s,i);return void 0!==r?r.call(this,e,t):t}handleAuthenticationMessage(e,t){const i=this.safeValue(e.futures,"authenticated");void 0!==i&&i.resolve(!0)}async authenticate(e={}){const t=this.urls.api.ws,i=this.client(t),s="authenticated",r=i.future("authenticated");if(void 0===this.safeValue(i.subscriptions,s)){this.checkRequiredCredentials();const i=this.seconds().toString(),r=i+this.apiKey,a=this.hmac(this.encode(r),this.encode(this.secret)),n={e:"auth",auth:{key:this.apiKey,signature:a.toUpperCase(),timestamp:i}};this.spawn(this.watch,t,s,this.extend(n,e),s)}return await r}}},96451:function(e,t,i){"use strict";const s=i(57385);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"coinbaseprime",name:"Coinbase Prime",has:{ws:!0,watchOrderBook:!0},urls:{test:{ws:"wss://ws-feed-public.sandbox.exchange.coinbase.com"},logo:"https://user-images.githubusercontent.com/1294454/44539184-29f26e00-a70c-11e8-868f-e907fc236a7c.jpg",api:{ws:"wss://ws-feed.exchange.coinbase.com"},www:"https://exchange.coinbase.com",doc:"https://docs.exchange.coinbase.com/",fees:"https://pro.coinbase.com/fees"}})}}},57385:function(e,t,i){"use strict";const s=i(51241),{BadSymbol:r}=i(73449),{ArrayCache:a,ArrayCacheBySymbolById:n}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchOHLCV:!1,watchOrderBook:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0,watchBalance:!1,watchStatus:!1,watchOrders:!0,watchMyTrades:!0},urls:{api:{ws:"wss://ws-feed.pro.coinbase.com"}},options:{tradesLimit:1e3,ordersLimit:1e3,myTradesLimit:1e3}})}authenticate(){this.checkRequiredCredentials();const e=this.nonce(),t=e.toString()+"GET/users/self/verify",i=this.hmac(this.encode(t),this.base64ToBinary(this.secret),"sha256","base64");return{timestamp:e,key:this.apiKey,signature:i,passphrase:this.password}}async subscribe(e,t,i,s={}){await this.loadMarkets();const r=this.market(t),a=i+":"+r.id;let n=this.urls.api.ws;"signature"in s&&(n+="?");const o={type:"subscribe",product_ids:[r.id],channels:[e]},h=this.extend(o,s);return await this.watch(n,a,h,a)}async watchTicker(e,t={}){const i="ticker";return await this.subscribe(i,e,i,t)}async watchTrades(e,t,i,s={}){await this.loadMarkets(),e=this.symbol(e);const r="matches",a=await this.subscribe(r,e,r,s);return this.newUpdates&&(i=a.getLimit(e,i)),this.filterBySinceLimit(a,t,i,"timestamp",!0)}async watchMyTrades(e,t,i,s={}){if(void 0===e)throw new r(this.id+" watchMyTrades requires a symbol");await this.loadMarkets(),e=this.symbol(e);const a=this.authenticate(),n=await this.subscribe("user",e,"myTrades",this.extend(s,a));return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySinceLimit(n,t,i,"timestamp",!0)}async watchOrders(e,t,i,s={}){if(void 0===e)throw new r(this.id+" watchMyTrades requires a symbol");await this.loadMarkets(),e=this.symbol(e);const a=this.authenticate(),n=await this.subscribe("user",e,"orders",this.extend(s,a));return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySinceLimit(n,t,i,"timestamp",!0)}async watchOrderBook(e,t,i={}){const s="level2";await this.loadMarkets();const r=this.market(e);e=r.symbol;const a=s+":"+r.id,n=this.urls.api.ws,o={type:"subscribe",product_ids:[r.id],channels:[s]},h=this.extend(o,i),d={messageHash:a,symbol:e,marketId:r.id,limit:t};return(await this.watch(n,a,h,a,d)).limit()}handleTrade(e,t){const i=this.safeString(t,"product_id");if(void 0!==i){const s=this.parseWsTrade(t),r=s.symbol,n="matches"+":"+i;let o=this.safeValue(this.trades,r);if(void 0===o){const e=this.safeInteger(this.options,"tradesLimit",1e3);o=new a(e),this.trades[r]=o}o.append(s),e.resolve(o,n)}return t}handleMyTrade(e,t){const i=this.safeString(t,"product_id");if(void 0!==i){const s=this.parseWsTrade(t),r="myTrades"+":"+i;let a=this.myTrades;if(void 0===a){const e=this.safeInteger(this.options,"myTradesLimit",1e3);a=new n(e),this.myTrades=a}a.append(s),e.resolve(a,r)}return t}parseWsTrade(e){const t=super.parseTrade(e);let i;"maker_fee_rate"in e?(t.takerOrMaker="maker",i=this.safeNumber(e,"maker_fee_rate")):(t.takerOrMaker="taker",i=this.safeNumber(e,"taker_fee_rate"));const s=this.market(t.symbol).quote;let r;return void 0!==t.cost&&void 0!==i&&(r=t.cost*i),t.fee={rate:i,cost:r,currency:s},t}parseWsOrderStatus(e){return this.safeString({filled:"closed",canceled:"canceled"},e,"open")}handleOrder(e,t){let i=this.orders;if(void 0===i){const e=this.safeInteger(this.options,"ordersLimit",1e3);i=new n(e),this.orders=i}const s=this.safeString(t,"type"),r=this.safeString(t,"product_id");if(void 0!==r){const i="orders:"+r,a=this.safeSymbol(r),n=this.safeString(t,"order_id"),o=this.safeString(t,"maker_order_id"),h=this.safeString(t,"taker_order_id"),d=this.orders,c=this.safeValue(d.hashmap,a,{});let l=this.safeValue(c,n);if(void 0===l&&(l=this.safeValue2(c,o,h)),void 0===l){const s=this.parseWsOrder(t);d.append(s),e.resolve(d,i)}else{const r=this.safeInteger(t,"sequence"),a=this.safeValue(l,"info",{}),n=this.safeInteger(a,"sequence");if(void 0===n||r>n)if("match"===s){const s=this.parseWsTrade(t);void 0===l.trades&&(l.trades=[]),l.trades.push(s),l.lastTradeTimestamp=s.timestamp;let r=0,a=0;const n=l.trades;for(let e=0;e<n.length;e++){const t=n[e];r=this.sum(r,t.cost),a=this.sum(a,t.amount)}a>0&&(l.average=r/a),l.cost=r,void 0!==l.filled&&(l.filled+=s.amount,void 0!==l.amount&&(l.remaining=l.amount-l.filled)),void 0===l.fee&&(l.fee={cost:0,currency:s.fee.currency}),void 0!==l.fee.cost&&void 0!==s.fee.cost&&(l.fee.cost=this.sum(l.fee.cost,s.fee.cost)),d.append(l),e.resolve(d,i)}else if("received"===s||"done"===s){const s=this.extend(l.info,t),r=this.parseWsOrder(s),a=Object.keys(r);for(let e=0;e<a.length;e++){const t=a[e];void 0!==r[t]&&(l[t]=r[t])}d.append(l),e.resolve(d,i)}}}}parseWsOrder(e){const t=this.safeString(e,"order_id"),i=this.safeString(e,"client_oid"),s=this.safeString(e,"product_id"),r=this.safeSymbol(s),a=this.safeString(e,"side"),n=this.safeNumber(e,"price"),o=this.safeNumber2(e,"size","funds"),h=this.safeString(e,"time"),d=this.parse8601(h),c=this.safeString(e,"reason"),l=this.parseWsOrderStatus(c),u=this.safeString(e,"order_type");let f=this.safeNumber(e,"remaining_size");const p=this.safeString(e,"type");let m,g;return void 0!==o&&void 0!==f?m=o-f:"received"===p&&(m=0,void 0!==o&&(f=o-m)),void 0!==n&&void 0!==o&&(g=n*o),{info:e,symbol:r,id:t,clientOrderId:i,timestamp:d,datetime:this.iso8601(d),lastTradeTimestamp:void 0,type:u,timeInForce:void 0,postOnly:void 0,side:a,price:n,stopPrice:void 0,triggerPrice:void 0,amount:o,cost:g,average:void 0,filled:m,remaining:f,status:l,fee:void 0,trades:void 0}}handleTicker(e,t){const i=this.safeString(t,"product_id");if(void 0!==i){const s=this.parseTicker(t),r=s.symbol;this.tickers[r]=s;const a=this.safeString(t,"type")+":"+i;e.resolve(s,a)}return t}parseTicker(e,t){if(void 0===this.safeString(e,"type"))return super.parseTicker(e,t);const i=this.safeString(e,"product_id"),s=this.safeSymbol(i,t,"-"),r=this.parse8601(this.safeString(e,"time")),a=this.safeNumber(e,"price");return{symbol:s,timestamp:r,datetime:this.iso8601(r),high:this.safeNumber(e,"high_24h"),low:this.safeNumber(e,"low_24h"),bid:this.safeNumber(e,"best_bid"),bidVolume:void 0,ask:this.safeNumber(e,"best_ask"),askVolume:void 0,vwap:void 0,open:this.safeNumber(e,"open_24h"),close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeNumber(e,"volume_24h"),quoteVolume:void 0,info:e}}handleDelta(e,t){const i=this.safeNumber(t,0),s=this.safeNumber(t,1);e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleOrderBook(e,t){const i=this.safeString(t,"type"),s=this.safeString(t,"product_id"),r=this.safeMarket(s,void 0,"-").symbol,a="level2:"+s,n=this.safeValue(e.subscriptions,a,{}),o=this.safeInteger(n,"limit");if("snapshot"===i){this.orderbooks[r]=this.orderBook({},o);const i=this.orderbooks[r];this.handleDeltas(i.asks,this.safeValue(t,"asks",[])),this.handleDeltas(i.bids,this.safeValue(t,"bids",[])),i.timestamp=void 0,i.datetime=void 0,e.resolve(i,a)}else if("l2update"===i){const i=this.orderbooks[r],s=this.parse8601(this.safeString(t,"time")),n=this.safeValue(t,"changes",[]),o={sell:"asks",buy:"bids"};for(let e=0;e<n.length;e++){const t=n[e],s=this.safeString(t,0),r=this.safeString(o,s),a=this.safeNumber(t,1),h=this.safeNumber(t,2);i[r].store(a,h)}i.timestamp=s,i.datetime=this.iso8601(s),e.resolve(i,a)}}handleSubscriptionStatus(e,t){return t}handleMessage(e,t){const i=this.safeString(t,"type"),s={snapshot:this.handleOrderBook,l2update:this.handleOrderBook,subscribe:this.handleSubscriptionStatus,ticker:this.handleTicker,received:this.handleOrder,open:this.handleOrder,change:this.handleOrder,done:this.handleOrder},r=e.url.length-0,a="?"===e.url[r-1],n=this.safeValue(s,i);if(void 0!==n)return n.call(this,e,t);"match"===i&&(a?(this.handleMyTrade(e,t),this.handleOrder(e,t)):this.handleTrade(e,t))}}},31094:function(e,t,i){"use strict";const s=i(6832),r=i(78427),{AuthenticationError:a,BadRequest:n,ExchangeNotAvailable:o,NotSupported:h,RequestTimeout:d,ExchangeError:c}=i(73449),{ArrayCache:l,ArrayCacheByTimestamp:u,ArrayCacheBySymbolById:f}=i(56062);e.exports=class extends r{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchTicker:!0,watchTickers:!0,watchTrades:!0,watchMyTrades:!1,watchOrders:!0,watchOrderBook:!0,watchOHLCV:!1},urls:{api:{ws:{spot:"wss://socket.coinex.com/",swap:"wss://perpetual.coinex.com/"}}},options:{watchOHLCVWarning:!0,timeframes:{"1m":60,"3m":180,"5m":300,"15m":900,"30m":1800,"1h":3600,"2h":7200,"4h":14400,"6h":21600,"12h":43200,"1d":86400,"3d":259200,"1w":604800},account:"spot",watchOrderBook:{limits:[5,10,20,50],defaultLimit:50,aggregations:["10","1","0","0.1","0.01"],defaultAggregation:"0"}},streaming:{},exceptions:{codes:{1:n,2:c,3:o,4:h,5:d,6:a}}})}requestId(){const e=this.sum(this.safeInteger(this.options,"requestId",0),1);return this.options.requestId=e,e}handleTicker(e,t){const i=this.safeString(this.options,"defaultType"),s=this.safeValue(t,"params",[]),r=this.safeValue(s,0,{}),a=Object.keys(r),n=[];for(let t=0;t<a.length;t++){const s=a[t],o=r[s],h=this.safeSymbol(s,void 0,void 0,i),d=this.safeMarket(s,void 0,void 0,i),c=this.parseWSTicker(o,d),l="ticker:"+h;this.tickers[h]=c,n.push(c),e.resolve(c,l)}e.resolve(n,"tickers")}parseWSTicker(e,t){const i=this.safeString(this.options,"defaultType");return this.safeTicker({symbol:this.safeSymbol(void 0,t,void 0,i),timestamp:void 0,datetime:void 0,high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:void 0,bidVolume:this.safeString(e,"buy_total"),ask:void 0,askVolume:this.safeString(e,"sell_total"),vwap:void 0,open:this.safeString(e,"open"),close:this.safeString(e,"close"),last:this.safeString(e,"last"),previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"volume"),quoteVolume:this.safeString(e,"deal"),info:e},t)}async watchBalance(e={}){await this.loadMarkets(),await this.authenticate(e);const t="balance";let i;[i,e]=this.handleMarketTypeAndParams("watchBalance",void 0,e);const s=this.urls.api.ws[i],r={method:"asset.subscribe",params:Object.keys(this.currencies_by_id),id:this.requestId()},a=this.deepExtend(r,e);return await this.watch(s,t,a,t)}handleBalance(e,t){const i=this.safeValue(t,"params",[]),r=this.safeValue(i,0,{}),a=Object.keys(r);for(let e=0;e<a.length;e++){const t=a[e],i=this.safeCurrencyCode(t),n=this.safeString(r[t],"available"),o=this.safeString(r[t],"frozen"),h=s.stringAdd(n,o),d=this.account();d.free=this.parseNumber(n),d.used=this.parseNumber(o),d.total=this.parseNumber(h),this.balance[i]=d,this.balance=this.safeBalance(this.balance)}e.resolve(this.balance,"balance")}handleTrades(e,t){const i=this.safeValue(t,"params",[]),s=this.safeString(i,0),r=this.safeValue(i,1,[]),a=this.safeString(this.options,"defaultType"),n=this.safeMarket(s,void 0,void 0,a),o=n.symbol,h="trades:"+o;let d=this.safeValue(this.trades,o);if(void 0===d){const e=this.safeInteger(this.options,"tradesLimit",1e3);d=new l(e),this.trades[o]=d}for(let e=0;e<r.length;e++){const t=r[e],i=this.parseWSTrade(t,n);d.append(i)}this.trades[o]=d,e.resolve(this.trades[o],h)}parseWSTrade(e,t){const i=this.safeTimestamp(e,"time"),s=this.safeString(this.options,"defaultType");return this.safeTrade({id:this.safeString(e,"id"),info:e,timestamp:i,datetime:this.iso8601(i),symbol:this.safeSymbol(void 0,t,void 0,s),order:void 0,type:void 0,side:this.safeString(e,"type"),takerOrMaker:void 0,price:this.safeString(e,"price"),amount:this.safeString(e,"amount"),cost:void 0,fee:void 0},t)}handleOHLCV(e,t){const i=this.safeValue(t,"params",[]),s=this.parseOHLCVs(i);if(0===Object.keys(this.ohlcvs).length){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);this.ohlcvs=new u(e)}for(let e=0;e<s.length;e++){const t=s[e];this.ohlcvs.append(t)}e.resolve(this.ohlcvs,"ohlcv")}async watchTicker(e,t={}){return await this.watchTickers([e],t)}async watchTickers(e,t={}){let i;await this.loadMarkets(),e=this.marketSymbols(e),[i,t]=this.handleMarketTypeAndParams("watchTickers",void 0,t);const s=this.urls.api.ws[i],r="tickers",a={method:"state.subscribe",id:this.requestId(),params:[]},n=this.deepExtend(a,t),o=await this.watch(s,r,n,r),h=this.filterByArray(o,"symbol",e);return Object.keys(h).length>0?this.newUpdates?h:this.filterByArray(this.tickers,"symbol",e):await this.watchTickers(e,t)}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);let a;e=r.symbol,[a,s]=this.handleMarketTypeAndParams("watchTrades",r,s);const n=this.urls.api.ws[a],o="trades:"+e,h={method:"deals.subscribe",params:[r.id],id:this.requestId()},d=this.deepExtend(h,s),c=await this.watch(n,o,d,o,d);return this.filterBySinceLimit(c,t,i,"timestamp",!0)}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);let r;e=s.symbol,[r,i]=this.handleMarketTypeAndParams("watchOrderBook",s,i);const a=this.urls.api.ws[r],n="orderbook:"+e,o=this.safeValue(this.options,"watchOrderBook",{}),d=this.safeValue(o,"limits",[]);if(void 0===t&&(t=this.safeValue(o,"defaultLimit",50)),!this.inArray(t,d))throw new h(this.id+" watchOrderBook() limit must be one of "+d.join(", "));const c=this.safeString(o,"defaultAggregation","0"),l=this.safeValue(o,"aggregations",[]),u=this.safeString(i,"aggregation",c);if(!this.inArray(u,l))throw new h(this.id+" watchOrderBook() aggregation must be one of "+l.join(", "));i=this.omit(i,"aggregation");const f=this.safeValue(this.options,"watchOrderBookSubscriptions",{});f[e]=[s.id,t,u,!0];const p={method:"depth.subscribe_multi",id:this.requestId(),params:Object.values(f)};this.options.watchOrderBookSubscriptions=f;const m=this.hash(this.encode(this.json(f))),g=this.deepExtend(p,i);return(await this.watch(a,n,g,m,g)).limit()}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);let n;if(e=a.symbol,[n,r]=this.handleMarketTypeAndParams("watchOHLCV",a,r),"swap"!==n)throw new h(this.id+" watchOHLCV() is only supported for swap markets");const o=this.urls.api.ws[n],d="ohlcv",l=this.safeValue(this.options,"watchOHLCVWarning",!0),u=this.safeValue(this.clients,o,{}),f=this.safeValue(u.subscriptions,d);if(l&&void 0!==f&&(f.symbol!==e||f.timeframe!==t))throw new c(this.id+" watchOHLCV() can only watch one symbol and timeframe at a time. To supress this warning set watchOHLCVWarning to false in options");const p=this.safeValue(this.options,"timeframes",{}),m={method:"kline.subscribe",id:this.requestId(),params:[a.id,this.safeInteger(p,t,t)]},g={symbol:e,timeframe:t},y=this.deepExtend(m,r),b=await this.watch(o,d,y,d,g);return this.newUpdates&&(s=b.getLimit(e,s)),this.filterBySinceLimit(b,i,s,0,!0)}handleDelta(e,t){const i=this.parseBidAsk(t,0,1);e.storeArray(i)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleOrderBook(e,t){const i=this.safeValue(t,"params",[]),s=this.safeValue(i,0);let r=this.safeValue(i,1);const a=this.safeString(i,2),n=this.safeString(this.options,"defaultType"),o=this.safeMarket(a,void 0,void 0,n).symbol,h="orderbook:"+o,d=this.safeNumber(r,"time"),c=this.safeValue(this.orderbooks,o);if(s){const e=this.parseOrderBook(r,o,d);void 0===c?(r=this.orderBook(e),this.orderbooks[o]=r):(r=this.orderbooks[o],r.reset(e))}else{const e=this.safeValue(r,"asks",[]),t=this.safeValue(r,"bids",[]);this.handleDeltas(c.asks,e),this.handleDeltas(c.bids,t),c.nonce=d,c.timestamp=d,c.datetime=this.iso8601(d),this.orderbooks[o]=c}e.resolve(this.orderbooks[o],h)}checkOrderBookChecksum(e){const t=this.safeValue(e,"asks",[]),i=this.safeValue(e,"bids",[]);let s="";const r=i.length;for(let e=0;e<r;e++){const t=i[e];0!==e&&(s+=":"),s+=t[0]+":"+t[1]}const a=t.length;for(let e=0;e<a;e++){const i=t[e];0!==r&&(s+=":"),s+=i[0]+":"+i[1]}const n=this.hash(s,"cr32","hex");if(this.safeString(e,"checksum")!==n)throw new c(this.id+" watchOrderBook () checksum failed")}async watchOrders(e,t,i,s={}){await this.loadMarkets(),await this.authenticate(s);let r,a="orders";const[n,o]=this.handleMarketTypeAndParams("watchOrders",r,s),h={method:"order.subscribe",id:this.requestId()};void 0!==e?(r=this.market(e),e=r.symbol,h.params=[r.id],a+=":"+e):h.params=this.ids;const d=this.urls.api.ws[n],c=this.deepExtend(h,o),l=await this.watch(d,a,c,a,c);return this.newUpdates&&(i=l.getLimit(e,i)),this.filterBySymbolSinceLimit(l,e,t,i,!0)}handleOrders(e,t){const i=this.safeValue(t,"params",[]),s=this.safeValue(i,1,{}),r=this.parseWSOrder(s);if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new f(e)}this.orders.append(r);let a="orders";e.resolve(this.orders,a),a+=":"+r.symbol,e.resolve(this.orders,a)}parseWSOrder(e){const t=this.safeTimestamp2(e,"update_time","mtime"),i=this.safeString(e,"market"),r=this.safeString(e,"type"),a=this.safeString({1:"limit",2:"market"},r),n=this.safeString(e,"side"),o=this.safeString({1:"sell",2:"buy"},n),h=this.safeString(e,"left"),d=this.safeString(e,"amount"),c=this.safeString(e,"status"),l=this.safeString(this.options,"defaultType"),u=this.safeMarket(i,void 0,void 0,l);let f,p,m=this.safeString(e,"deal_money"),g=this.safeString(e,"deal_stock");if(u.swap){const t=this.safeString(e,"leverage");m=s.stringDiv(g,t),f=s.stringDiv(g,d),g=void 0}const y=this.omitZero(this.safeString(e,"money_fee"));if(void 0!==y){const t=this.safeString(e,"fee_asset",u.quote);p={currency:this.safeCurrencyCode(t),cost:y}}return this.safeOrder({info:e,id:this.safeString2(e,"order_id","id"),clientOrderId:this.safeString(e,"client_id"),datetime:this.iso8601(t),timestamp:t,lastTradeTimestamp:this.safeTimestamp(e,"last_deal_time"),symbol:u.symbol,type:1===a?"limit":"market",timeInForce:void 0,postOnly:void 0,side:o,price:this.safeString(e,"price"),stopPrice:this.safeString(e,"stop_price"),triggerPrice:this.safeString(e,"stop_price"),amount:d,filled:g,remaining:h,cost:m,average:f,status:this.parseWSOrderStatus(c),fee:p,trades:void 0},u)}parseWSOrderStatus(e){return this.safeString({0:"pending",1:"ok"},e,e)}handleMessage(e,t){const i=this.safeValue(t,"error");if(void 0!==i)throw new c(this.id+" "+this.json(i));const s=this.safeString(t,"method"),r={"state.update":this.handleTicker,"asset.update":this.handleBalance,"deals.update":this.handleTrades,"depth.update":this.handleOrderBook,"order.update":this.handleOrders,"kline.update":this.handleOHLCV,"order.update_stop":this.handleOrders},a=this.safeValue(r,s);return void 0!==a?a.call(this,e,t):this.handleSubscriptionStatus(e,t)}handleAuthenticationMessage(e,t){const i=this.safeValue(e.futures,"authenticated");return void 0!==i&&i.resolve(!0),t}handleSubscriptionStatus(e,t){const i=this.safeString(t,"id"),s=this.safeValue(e.subscriptions,i);if(void 0!==s){const t=this.safeString(s,"future"),r=this.safeValue(e.futures,t);void 0!==r&&r.resolve(!0),delete e.subscriptions[i]}}authenticate(e={}){let t;[t,e]=this.handleMarketTypeAndParams("authenticate",void 0,e);const i=this.urls.api.ws[t],s=this.client(i),r=this.milliseconds();if("spot"===t){const e="authenticated:spot";if(void 0!==this.safeValue(s.futures,e))return;const t=s.future(e),a=this.requestId(),n={id:a,future:"authenticated:spot"},o="access_id="+this.apiKey+"&tonce="+this.numberToString(r)+"&secret_key="+this.secret,h=this.hash(this.encode(o),"md5"),d={method:"server.sign",params:[this.apiKey,h.toUpperCase(),r],id:a};return this.spawn(this.watch,i,e,d,a,n),t}{const e="authenticated:swap";if(void 0!==this.safeValue(s.futures,e))return;const t=s.future("authenticated:swap"),a=this.requestId(),n={id:a,future:"authenticated:swap"},o="access_id="+this.apiKey+"&timestamp="+this.numberToString(r)+"&secret_key="+this.secret,h=this.hash(this.encode(o),"sha256","hex"),d={method:"server.sign",params:[this.apiKey,h.toLowerCase(),r],id:a};return this.spawn(this.watch,i,e,d,a,n),t}}}},19300:function(e,t,i){"use strict";const s=i(10073),{AuthenticationError:r,NotSupported:a}=i(73449),{ArrayCache:n,ArrayCacheByTimestamp:o,ArrayCacheBySymbolById:h}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchTicker:!0,watchTickers:!1,watchMyTrades:!0,watchTrades:!0,watchOrderBook:!0,watchOrders:!0,watchOHLCV:!0},urls:{api:{ws:{public:"wss://stream.crypto.com/v2/market",private:"wss://stream.crypto.com/v2/user"}},test:{public:"wss://uat-stream.3ona.co/v2/market",private:"wss://uat-stream.3ona.co/v2/user"}},options:{},streaming:{}})}async pong(e,t){await e.send({id:this.safeInteger(t,"id"),method:"public/respond-heartbeat"})}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);if(!s.spot)throw new a(this.id+" watchOrderBook() supports spot markets only");const r="book."+s.id;return(await this.watchPublic(r,i)).limit()}handleOrderBookSnapshot(e,t){const i=this.safeString(t,"subscription"),s=this.safeString(t,"instrument_name"),r=this.safeMarket(s).symbol;let a=this.safeValue(t,"data");a=this.safeValue(a,0);const n=this.safeInteger(a,"t"),o=this.parseOrderBook(a,r,n);o.nonce=this.safeInteger(a,"s");let h=this.safeValue(this.orderbooks,r);if(void 0===h){const e=this.safeInteger(t,"depth");h=this.orderBook({},e)}h.reset(o),this.orderbooks[r]=h,e.resolve(h,i)}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);if(e=r.symbol,!r.spot)throw new a(this.id+" watchTrades() supports spot markets only");const n="trade."+r.id,o=await this.watchPublic(n,s);return this.newUpdates&&(i=o.getLimit(e,i)),this.filterBySinceLimit(o,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeString(t,"channel"),s=this.safeString(t,"instrument_name"),r=this.safeString(t,"subscription"),a=this.safeMarket(s),o=a.symbol;let h=this.safeValue(this.trades,o);if(void 0===h){const e=this.safeInteger(this.options,"tradesLimit",1e3);h=new n(e),this.trades[o]=h}const d=this.safeValue(t,"data",[]),c=this.parseTrades(d,a);for(let e=0;e<c.length;e++)h.append(c[e]);e.resolve(h,r),e.resolve(h,i)}async watchMyTrades(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e),e=r.symbol);let a="margin"===this.safeString(this.options,"defaultType","spot")?"user.margin.trade":"user.trade";a=void 0!==r?a+"."+r.id:a;const n=await this.watchPrivate(a,s);return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySymbolSinceLimit(n,e,t,i,!0)}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.spot)throw new a(this.id+" watchTicker() supports spot markets only");const s="ticker."+i.id;return await this.watchPublic(s,t)}handleTicker(e,t){const i=this.safeString(t,"subscription"),s=this.safeString(t,"instrument_name"),r=this.safeMarket(s),a=this.safeValue(t,"data",[]);for(let t=0;t<a.length;t++){const s=a[t],n=this.parseTicker(s,r),o=n.symbol;this.tickers[o]=n,e.resolve(n,i)}}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const n=this.market(e);if(e=n.symbol,!n.spot)throw new a(this.id+" watchOHLCV() supports spot markets only");const o="candlestick."+this.safeString(this.timeframes,t,t)+"."+n.id,h=await this.watchPublic(o,r);return this.newUpdates&&(s=h.getLimit(e,s)),this.filterBySinceLimit(h,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeString(t,"subscription"),s=this.safeString(t,"instrument_name"),r=this.safeMarket(s),a=r.symbol,n=this.safeString(t,"interval"),h=this.findTimeframe(n);this.ohlcvs[a]=this.safeValue(this.ohlcvs,a,{});let d=this.safeValue(this.ohlcvs[a],h);if(void 0===d){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);d=new o(e),this.ohlcvs[a][h]=d}const c=this.safeValue(t,"data");for(let e=0;e<c.length;e++){const t=c[e],i=this.parseOHLCV(t,r);d.append(i)}e.resolve(d,i)}async watchOrders(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==e&&(r=this.market(e),e=r.symbol);let a="margin"===this.safeString(this.options,"defaultType","spot")?"user.margin.order":"user.order";a=void 0!==r?a+"."+r.id:a;const n=await this.watchPrivate(a,s);return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySymbolSinceLimit(n,e,t,i,!0)}handleOrders(e,t,i){const s=this.safeString(t,"channel"),r=this.safeString(t,"subscription"),a=this.safeValue(t,"data",[]);if(a.length>0){if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new h(e)}const t=this.orders,i=this.parseOrders(a);for(let e=0;e<i.length;e++)t.append(i[e]);e.resolve(t,r),e.resolve(t,s)}}async watchBalance(e={}){const t="margin"===this.safeString(this.options,"defaultType","spot")?"user.margin.balance":"user.balance";return await this.watchPrivate(t,e)}handleBalance(e,t){const i=this.safeString(t,"subscription"),s=this.safeValue(t,"data");for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"currency"),r=this.safeCurrencyCode(i),a=this.account();a.free=this.safeString(t,"available"),a.total=this.safeString(t,"balance"),this.balance[r]=a,this.balance=this.safeBalance(this.balance)}e.resolve(this.balance,i)}async watchPublic(e,t={}){const i=this.urls.api.ws.public,s={method:"subscribe",params:{channels:[e]},nonce:this.nonce()},r=this.extend(s,t);return await this.watch(i,e,r,e)}async watchPrivate(e,t={}){await this.authenticate();const i=this.urls.api.ws.private,s={method:"subscribe",params:{channels:[e]},nonce:this.nonce()},r=this.extend(s,t);return await this.watch(i,e,r,e)}handleErrorMessage(e,t){const i=this.safeInteger(t,"code");try{if(i){const e=this.id+" "+this.json(t);this.throwExactlyMatchedException(this.exceptions.exact,i,e);const s=this.safeValue(t,"message");void 0!==s&&this.throwBroadlyMatchedException(this.exceptions.broad,s,e)}return!1}catch(t){if(t instanceof r){const i="authenticated";e.reject(t,i),i in e.subscriptions&&delete e.subscriptions[i]}else e.reject(t);return!0}}handleMessage(e,t){if(this.handleErrorMessage(e,t))return;const i=this.safeString(t,"method");if("public/heartbeat"===i)return void this.handlePing(e,t);if("public/auth"===i)return void this.handleAuthenticate(e,t);const s={candlestick:this.handleOHLCV,ticker:this.handleTicker,trade:this.handleTrades,book:this.handleOrderBookSnapshot,"user.order":this.handleOrders,"user.margin.order":this.handleOrders,"user.trade":this.handleTrades,"user.margin.trade":this.handleTrades,"user.balance":this.handleBalance,"user.margin.balance":this.handleBalance},r=this.safeValue2(t,"result","info"),a=this.safeString(r,"channel"),n=this.safeValue(s,a);void 0!==n&&n.call(this,e,r)}authenticate(e={}){this.checkRequiredCredentials();const t=this.urls.api.ws.private,i=this.client(t),s="authenticated";let r=this.safeValue(i.subscriptions,s);if(void 0===r){const a="public/auth",n=this.nonce().toString(),o=a+n+this.apiKey+n,h=this.hmac(this.encode(o),this.encode(this.secret),"sha256"),d={id:n,nonce:n,method:a,api_key:this.apiKey,sig:h},c=this.extend(d,e);r=this.watch(t,s,c),i.subscriptions[s]=r}return r}handlePing(e,t){this.spawn(this.pong,e,t)}handleAuthenticate(e,t){e.resolve(t,"authenticated")}}},55537:function(e,t,i){"use strict";const s=i(49610),r=i(6832),{ArrayCache:a,ArrayCacheByTimestamp:n}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0,watchOrderBook:!0,watchOHLCV:!0},urls:{api:{ws:"wss://api-adapter.backend.currency.com/connect"}},options:{tradesLimit:1e3,OHLCVLimit:1e3,timeframes:{"1m":"M1","3m":"M3","5m":"M5","15m":"M15","30m":"M30","1h":"H1","4h":"H4","1d":"D1","1w":"W1"}},streaming:{ping:this.ping,keepAlive:2e4}})}ping(e){return{destination:"ping",correlationId:this.requestId().toString(),payload:{}}}handlePong(e,t){return e.lastPong=this.milliseconds(),t}handleBalance(e,t,i){const s=this.safeValue(t,"payload"),r=this.parseBalance(s);this.balance=this.extend(this.balance,r);const a=this.safeString(i,"messageHash");e.resolve(this.balance,a),a in e.subscriptions&&delete e.subscriptions[a]}handleTicker(e,t,i){const s=this.safeValue(t,"payload"),r=this.safeValue(s,"tickers",[]);for(let t=0;t<r.length;t++){const i=this.parseTicker(r[t]),s=i.symbol;this.tickers[s]=i;const a="/api/v1/ticker/24hr:"+s;e.resolve(i,a),a in e.subscriptions&&delete e.subscriptions[a]}}handleTrade(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,void 0,"/"),a=this.safeInteger(e,"ts"),n=this.safeString(e,"price"),o=this.safeString(e,"size"),h=this.parseNumber(r.stringMul(n,o)),d=this.parseNumber(n),c=this.parseNumber(o),l=this.safeString2(e,"id"),u=this.safeString(e,"orderId"),f=this.safeValue(e,"buyer")?"buy":"sell";return{info:e,timestamp:a,datetime:this.iso8601(a),symbol:s,id:l,order:u,type:void 0,takerOrMaker:void 0,side:f,price:d,amount:c,cost:h,fee:void 0}}handleTrades(e,t,i){const s=this.safeValue(t,"payload"),r=this.handleTrade(s),n=r.symbol,o="trades.subscribe:"+n;let h=this.safeValue(this.trades,n);if(void 0===h){const e=this.safeInteger(this.options,"tradesLimit",1e3);h=new a(e),this.trades[n]=h}h.append(r),e.resolve(h,o)}findTimeframe(e){const t=this.safeValue(this.options,"timeframes"),i=Object.keys(t);for(let s=0;s<i.length;s++){const r=i[s];if(t[r]===e)return r}}handleOHLCV(e,t){const i=this.safeValue(t,"payload",{}),s=this.safeString(i,"interval"),r=this.findTimeframe(s),a=this.safeString(i,"symbol"),o=this.safeMarket(a).symbol,h="OHLCMarketData.subscribe:"+r+":"+o,d=[this.safeInteger(i,"t"),this.safeNumber(i,"o"),this.safeNumber(i,"h"),this.safeNumber(i,"l"),this.safeNumber(i,"c"),void 0];this.ohlcvs[o]=this.safeValue(this.ohlcvs,o,{});let c=this.safeValue(this.ohlcvs[o],r);if(void 0===c){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);c=new n(e),this.ohlcvs[o][r]=c}c.append(d),e.resolve(c,h)}requestId(){const e=this.sum(this.safeInteger(this.options,"correlationId",0),1);return this.options.correlationId=e,e}async watchPublic(e,t,i={}){await this.loadMarkets();const s=this.market(t),r=e+":"+(t=s.symbol),a=this.urls.api.ws,n=this.requestId().toString(),o=this.deepExtend({destination:e,correlationId:n,payload:{symbols:[s.id]}},i),h=this.extend(o,{messageHash:r,symbol:t});return await this.watch(a,r,o,r,h)}async watchPrivate(e,t={}){await this.loadMarkets();const i="/api/v1/account",s=this.urls.api.ws,r=this.requestId().toString(),a={timestamp:this.milliseconds(),apiKey:this.apiKey},n=this.urlencode(this.keysort(a)),o=this.deepExtend({destination:e,correlationId:r,payload:a},t);o.payload.signature=this.hmac(this.encode(n),this.encode(this.secret));const h=this.extend(o,{messageHash:i});return await this.watch(s,i,o,i,h)}async watchBalance(e={}){return await this.loadMarkets(),await this.watchPrivate("/api/v1/account",e)}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s="/api/v1/ticker/24hr",r=s+":"+(e=i.symbol),a=this.urls.api.ws,n=this.requestId().toString(),o=this.deepExtend({destination:s,correlationId:n,payload:{symbol:i.id}},t),h=this.extend(o,{messageHash:r,symbol:e});return await this.watch(a,r,o,r,h)}async watchTrades(e,t,i,s={}){await this.loadMarkets(),e=this.symbol(e);const r=await this.watchPublic("trades.subscribe",e,s);return this.newUpdates&&(i=r.getLimit(e,i)),this.filterBySinceLimit(r,t,i,"timestamp",!0)}async watchOrderBook(e,t,i={}){await this.loadMarkets(),e=this.symbol(e);return(await this.watchPublic("depthMarketData.subscribe",e,i)).limit()}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets(),e=this.symbol(e);const a="OHLCMarketData.subscribe",n=a+":"+t,o={destination:a,payload:{intervals:[this.safeValue(this.options,"timeframes")[t]]}},h=await this.watchPublic(n,e,this.extend(o,r));return this.newUpdates&&(s=h.getLimit(e,s)),this.filterBySinceLimit(h,i,s,0,!0)}handleDeltas(e,t){const i=Object.keys(t);for(let s=0;s<i.length;s++){const r=i[s],a=t[r];e.store(parseFloat(r),parseFloat(a))}}handleOrderBook(e,t){const i=this.safeValue(t,"payload",{}),s=this.safeValue(i,"data",{}),r=this.safeString(i,"symbol"),a=this.safeSymbol(r,void 0,"/"),n="depthMarketData.subscribe:"+a,o=this.safeInteger(s,"ts");let h=this.safeValue(this.orderbooks,a);void 0===h&&(h=this.orderBook()),h.reset({timestamp:o,datetime:this.iso8601(o)});const d=this.safeValue(s,"bid",{}),c=this.safeValue(s,"ofr",{});this.handleDeltas(h.bids,d),this.handleDeltas(h.asks,c),this.orderbooks[a]=h,e.resolve(h,n)}handleMessage(e,t){const i=this.safeString(t,"correlationId");if(void 0!==i){const s=this.indexBy(e.subscriptions,"correlationId"),r=this.safeString(t,"status"),a=this.safeValue(s,i);if(void 0!==a&&"OK"===r){const i=this.safeString(a,"destination");if(void 0!==i){const s={"/api/v1/ticker/24hr":this.handleTicker,"/api/v1/account":this.handleBalance},r=this.safeValue(s,i);return void 0===r?t:r.call(this,e,t,a)}}}const s=this.safeString(t,"destination");if(void 0!==s){const i={"marketdepth.event":this.handleOrderBook,"internal.trade":this.handleTrades,"ohlc.event":this.handleOHLCV,ping:this.handlePong},r=this.safeValue(i,s);return void 0===r?t:r.call(this,e,t)}}}},74844:function(e,t,i){"use strict";const s=i(41680),{NotSupported:r,ExchangeError:a}=i(73449),{ArrayCache:n,ArrayCacheBySymbolById:o,ArrayCacheByTimestamp:h}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0,watchMyTrades:!0,watchOrders:!0,watchOrderBook:!0,watchOHLCV:!0},urls:{test:{ws:"wss://test.deribit.com/ws/api/v2"},api:{ws:"wss://www.deribit.com/ws/api/v2"}},options:{timeframes:{"1m":1,"3m":3,"5m":5,"15m":15,"30m":30,"1h":60,"2h":120,"4h":180,"6h":360,"12h":720,"1d":"1D"},currencies:["BTC","ETH","SOL","USDC"]},streaming:{},exceptions:{}})}requestId(){const e=this.sum(this.safeInteger(this.options,"requestId",0),1);return this.options.requestId=e,e}async watchBalance(e={}){await this.authenticate(e);const t="balance",i=this.urls.api.ws,s=this.safeValue(this.options,"currencies",[]),r=[];for(let e=0;e<s.length;e++){const t=s[e];r.push("user.portfolio."+t)}const a={jsonrpc:"2.0",method:"private/subscribe",params:{channels:r},id:this.requestId()},n=this.deepExtend(a,e);return await this.watch(i,t,n,t,n)}handleBalance(e,t){const i=this.safeValue(t,"params",{}),s=this.safeValue(i,"data",{}),r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.parseBalance(s);this.balance[a]=n;e.resolve(this.balance,"balance")}async watchTicker(e,t={}){const i=this.market(e),s=this.urls.api.ws,r=this.safeString(t,"interval","100ms");t=this.omit(t,"interval"),await this.loadMarkets(),"raw"===r&&await this.authenticate();const a="ticker."+i.id+"."+r,n={jsonrpc:"2.0",method:"public/subscribe",params:{channels:["ticker."+i.id+"."+r]},id:this.requestId()},o=this.deepExtend(n,t);return await this.watch(s,a,o,a,o)}handleTicker(e,t){const i=this.safeValue(t,"params",{}),s=this.safeValue(i,"data",{}),r=this.safeString(s,"instrument_name"),a=this.safeSymbol(r),n=this.parseTicker(s),o=this.safeString(i,"channel");this.tickers[a]=n,e.resolve(n,o)}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a=this.urls.api.ws,n=this.safeString(s,"interval","100ms");s=this.omit(s,"interval");const o="trades."+r.id+"."+n;"raw"===n&&await this.authenticate();const h={jsonrpc:"2.0",method:"public/subscribe",params:{channels:[o]},id:this.requestId()},d=this.deepExtend(h,s),c=await this.watch(a,o,d,o,d);return this.filterBySinceLimit(c,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeValue(t,"params",{}),s=this.safeString(i,"channel",""),r=s.split("."),a=this.safeString(r,1),o=this.safeSymbol(a),h=this.safeMarket(a),d=this.safeValue(i,"data",[]);let c=this.safeValue(this.trades,o);if(void 0===c){const e=this.safeInteger(this.options,"tradesLimit",1e3);c=new n(e),this.trades[o]=c}for(let e=0;e<d.length;e++){const t=d[e],i=this.parseTrade(t,h);c.append(i)}this.trades[o]=c,e.resolve(this.trades[o],s)}async watchMyTrades(e,t,i,s={}){await this.authenticate(s),void 0!==e&&(await this.loadMarkets(),e=this.symbol(e));const r=this.urls.api.ws,a=this.safeString(s,"interval","raw");s=this.omit(s,"interval");const n="user.trades.any.any."+a,o={jsonrpc:"2.0",method:"private/subscribe",params:{channels:[n]},id:this.requestId()},h=this.deepExtend(o,s),d=await this.watch(r,n,h,n,h);return this.filterBySymbolSinceLimit(d,e,t,i,!0)}handleMyTrades(e,t){const i=this.safeValue(t,"params",{}),s=this.safeString(i,"channel",""),r=this.safeValue(i,"data",[]);let a=this.myTrades;if(void 0===a){const e=this.safeInteger(this.options,"tradesLimit",1e3);a=new o(e)}const n=this.parseTrades(r),h={};for(let e=0;e<n.length;e++){const t=n[e];a.append(t);h[t.symbol]=!0}e.resolve(a,s)}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r=this.urls.api.ws,a=this.safeString(i,"interval","100ms");i=this.omit(i,"interval"),"raw"===a&&await this.authenticate();const n="book."+s.id+"."+a,o={jsonrpc:"2.0",method:"public/subscribe",params:{channels:[n]},id:this.requestId()},h=this.deepExtend(o,i);return(await this.watch(r,n,h,n)).limit()}handleOrderBook(e,t){const i=this.safeValue(t,"params",{}),s=this.safeValue(i,"data",{}),r=this.safeString(i,"channel"),a=this.safeString(s,"instrument_name"),n=this.safeSymbol(a),o=this.safeNumber(s,"timestamp");let h=this.safeValue(this.orderbooks,n);void 0===h&&(h=this.countedOrderBook());const d=this.safeValue(s,"asks",[]),c=this.safeValue(s,"bids",[]);this.handleDeltas(h.asks,d),this.handleDeltas(h.bids,c),h.nonce=o,h.timestamp=o,h.datetime=this.iso8601(o),h.symbol=n,this.orderbooks[n]=h,e.resolve(h,r)}cleanOrderBook(e){const t=this.safeValue(e,"bids",[]),i=this.safeValue(e,"asks",[]),s=[];for(let e=0;e<t.length;e++)s.push([t[e][1],t[e][2]]);const r=[];for(let e=0;e<i.length;e++)r.push([i[e][1],i[e][2]]);return e.bids=s,e.asks=r,e}handleDelta(e,t){const i=t[1],s=t[2];"new"===t[0]||"change"===t[0]?e.store(i,s,1):"delete"===t[0]&&e.store(i,s,0)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}async watchOrders(e,t,i,s={}){await this.loadMarkets(),await this.authenticate(s),void 0!==e&&(e=this.symbol(e));const r=this.urls.api.ws,a=this.safeString(s,"currency","any"),n=this.safeString(s,"interval","raw"),o=this.safeString(s,"kind","any");s=this.omit(s,"interval","currency","kind");const h="user.orders."+o+"."+a+"."+n,d={jsonrpc:"2.0",method:"private/subscribe",params:{channels:[h]},id:this.requestId()},c=this.deepExtend(d,s),l=await this.watch(r,h,c,h,c);return this.newUpdates&&(i=l.getLimit(e,i)),this.filterBySymbolSinceLimit(l,e,t,i,!0)}handleOrders(e,t){if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new o(e)}const i=this.safeValue(t,"params",{}),s=this.safeString(i,"channel",""),r=this.safeValue(i,"data",{});let a=[];if(Array.isArray(r))a=this.parseOrders(r);else{a=[this.parseOrder(r)]}for(let e=0;e<a.length;e++)this.orders.append(a[e]);e.resolve(this.orders,s)}async watchOHLCV(e,t="1m",i,s,a={}){await this.loadMarkets();const n=this.market(e),o=this.urls.api.ws,h=this.safeValue(this.options,"timeframes",{}),d=this.safeString(h,t);if(void 0===d)throw new r(this.id+" this interval is not supported, please provide one of the supported timeframes");const c="chart.trades."+n.id+"."+d,l={jsonrpc:"2.0",method:"public/subscribe",params:{channels:[c]},id:this.requestId()},u=this.deepExtend(l,a),f=await this.watch(o,c,u,c,u);return this.newUpdates&&(s=f.getLimit(n.symbol,s)),this.filterBySinceLimit(f,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeValue(t,"params",{}),s=this.safeString(i,"channel",""),r=s.split("."),a=this.safeString(r,2),n=this.safeSymbol(a),o=this.safeValue(i,"data",{}),d=[this.safeNumber(o,"tick"),this.safeNumber(o,"open"),this.safeNumber(o,"high"),this.safeNumber(o,"low"),this.safeNumber(o,"close"),this.safeNumber(o,"volume")];let c=this.safeValue(this.ohlcvs,n);if(void 0===c){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);c=new h(e)}c.append(d),this.ohlcvs[n]=c,e.resolve(c,s)}handleMessage(e,t){const i=this.safeValue(t,"error");if(void 0!==i)throw new a(this.id+" "+this.json(i));const s=this.safeValue(t,"params"),n=this.safeString(s,"channel");if(void 0!==n){const i=n.split("."),s=this.safeString(i,0),a={trades:this.handleMyTrades,portfolio:this.handleBalance,orders:this.handleOrders},o={ticker:this.handleTicker,book:this.handleOrderBook,trades:this.handleTrades,chart:this.handleOHLCV,user:this.safeValue(a,this.safeString(i,1))},h=this.safeValue(o,s);if(void 0!==h)return h.call(this,e,t);throw new r(this.id+" no handler found for this message "+this.json(t))}const o=this.safeValue(t,"result",{});return void 0!==this.safeString(o,"access_token")?this.handleAuthenticationMessage(e,t):t}handleAuthenticationMessage(e,t){const i=this.safeValue(e.futures,"authenticated");return void 0!==i&&i.resolve(!0),t}async authenticate(e={}){const t=this.urls.api.ws,i=this.client(t),s=this.milliseconds(),r=this.numberToString(s),a=r,n="authenticated",o=i.future("authenticated");if(void 0===this.safeValue(i.subscriptions,n)){this.checkRequiredCredentials();const i=this.requestId(),o=this.hmac(this.encode(r+"\n"+a+"\n"),this.encode(this.secret),"sha256"),h={jsonrpc:"2.0",id:i,method:"public/auth",params:{grant_type:"client_signature",client_id:this.apiKey,timestamp:s,signature:o,nonce:a,data:""}};this.spawn(this.watch,t,n,this.extend(h,e),n)}return await o}}},8140:function(e,t,i){"use strict";const s=i(74101),{NotSupported:r}=i(73449),{ArrayCache:a,ArrayCacheBySymbolById:n}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0,watchMyTrades:!0,watchOrders:!1,watchOrderBook:!0,watchOHLCV:!1},urls:{api:{ws:{public:"wss://ws-api.exmo.com:443/v1/public",spot:"wss://ws-api.exmo.com:443/v1/private",margin:"wss://ws-api.exmo.com:443/v1/margin/private"}}},options:{},streaming:{},exceptions:{}})}requestId(){const e=this.sum(this.safeInteger(this.options,"requestId",0),1);return this.options.requestId=e,e}async watchBalance(e={}){await this.authenticate(e);const[t,i]=this.handleMarketTypeAndParams("watchBalance",void 0,e),s="balance:"+t,r=this.urls.api.ws[t],a={method:"subscribe",topics:[t+"/wallet"],id:this.requestId()},n=this.deepExtend(a,i);return await this.watch(r,s,n,s,n)}handleBalance(e,t){const i=this.safeString(t,"topic").split("/"),s=this.safeString(i,0);"spot"===s?this.parseSpotBalance(t):"margin"===s&&this.parseMarginBalance(t);const r="balance:"+s;e.resolve(this.balance,r)}parseSpotBalance(e){const t=this.safeString(e,"event"),i=this.safeValue(e,"data");if("snapshot"===t){const e=this.safeValue(i,"balances",{}),t=this.safeValue(i,"reserved",{}),s=Object.keys(e);for(let i=0;i<s.length;i++){const r=s[i],a=this.safeCurrencyCode(r),n=e[r],o=t[r],h=this.account();h.free=this.parseNumber(n),h.used=this.parseNumber(o),this.balance[a]=h}}else if("update"===t){const e=this.safeString(i,"currency"),t=this.safeCurrencyCode(e),s=this.account();s.free=this.safeNumber(i,"balance"),s.used=this.safeNumber(i,"reserved"),this.balance[t]=s}this.balance=this.safeBalance(this.balance)}parseMarginBalance(e){const t=this.safeValue(e,"data"),i=Object.keys(t);for(let e=0;e<i.length;e++){const s=i[e],r=this.safeCurrencyCode(s),a=this.safeValue(t,s),n=this.account();n.free=this.safeNumber(a,"free"),n.used=this.safeNumber(a,"used"),n.total=this.safeNumber(a,"balance"),this.balance[r]=n,this.balance=this.safeBalance(this.balance)}}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e);e=i.symbol;const s=this.urls.api.ws.public,r="ticker:"+e,a={method:"subscribe",topics:["spot/ticker:"+i.id],id:this.requestId()},n=this.deepExtend(a,t);return await this.watch(s,r,n,r,n)}handleTicker(e,t){const i=this.safeString(t,"topic").split(":"),s=this.safeString(i,1),r=this.safeSymbol(s),a=this.safeValue(t,"data",{}),n=this.safeMarket(s),o=this.parseTicker(a,n),h="ticker:"+r;this.tickers[r]=o,e.resolve(o,h)}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);e=r.symbol;const a=this.urls.api.ws.public,n="trades:"+e,o={method:"subscribe",topics:["spot/trades:"+r.id],id:this.requestId()},h=this.deepExtend(o,s),d=await this.watch(a,n,h,n,h);return this.filterBySinceLimit(d,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeString(t,"topic").split(":"),s=this.safeString(i,1),r=this.safeSymbol(s),n=this.safeMarket(s),o=this.safeValue(t,"data",[]),h="trades:"+r;let d=this.safeValue(this.trades,r);if(void 0===d){const e=this.safeInteger(this.options,"tradesLimit",1e3);d=new a(e),this.trades[r]=d}for(let e=0;e<o.length;e++){const t=o[e],i=this.parseTrade(t,n);d.append(i)}this.trades[r]=d,e.resolve(this.trades[r],h)}async watchMyTrades(e,t,i,s={}){await this.loadMarkets(),await this.authenticate(s);const[r,a]=this.handleMarketTypeAndParams("watchMyTrades",void 0,s),n=this.urls.api.ws[r];let o;if(void 0===e)o="myTrades:"+r;else{const t=this.market(e);e=t.symbol,o="myTrades:"+t.symbol}const h={method:"subscribe",topics:[r+"/user_trades"],id:this.requestId()},d=this.deepExtend(h,a),c=await this.watch(n,o,d,o,d);return this.filterBySymbolSinceLimit(c,e,t,i,!0)}handleMyTrades(e,t){const i=this.safeString(t,"topic").split("/"),s="myTrades:"+this.safeString(i,0),r=this.safeString(t,"event");let a,o=[];if(void 0===this.myTrades){const e=this.safeInteger(this.options,"tradesLimit",1e3);a=new n(e),this.myTrades=a}else a=this.myTrades;if("snapshot"===r)o=this.safeValue(t,"data",[]);else if("update"===r){o=[this.safeValue(t,"data",{})]}const h=this.parseTrades(o),d={};for(let e=0;e<h.length;e++){const t=h[e];a.append(t),d[t.symbol]=!0}const c=Object.keys(d);for(let t=0;t<c.length;t++){const i="myTrades:"+c[t];e.resolve(a,i)}e.resolve(a,s)}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);e=s.symbol;const r=this.urls.api.ws.public,a="orderbook:"+e;i=this.omit(i,"aggregation");const n={method:"subscribe",id:this.requestId(),topics:["spot/order_book_updates:"+s.id]},o=this.deepExtend(n,i);return(await this.watch(r,a,o,a)).limit()}handleOrderBook(e,t){const i=this.safeString(t,"topic").split(":"),s=this.safeString(i,1),r=this.safeSymbol(s),a=this.safeValue(t,"data",{}),n="orderbook:"+r,o=this.safeNumber(t,"ts");let h=this.safeValue(this.orderbooks,r);void 0===h&&(h=this.orderBook({}),this.orderbooks[r]=h);if("snapshot"===this.safeString(t,"event")){const e=this.parseOrderBook(a,r,o,"bid","ask");h.reset(e)}else{const e=this.safeValue(a,"ask",[]),t=this.safeValue(a,"bid",[]);this.handleDeltas(h.asks,e),this.handleDeltas(h.bids,t),h.timestamp=o,h.datetime=this.iso8601(o)}e.resolve(h,n)}handleDelta(e,t){const i=this.parseBidAsk(t,0,1);e.storeArray(i)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleMessage(e,t){const i=this.safeString(t,"event"),s={logged_in:this.handleAuthenticationMessage,info:this.handleInfo,subscribed:this.handleSubscribed},a=this.safeValue(s,i);if(void 0!==a)return a.call(this,e,t);if("update"===i||"snapshot"===i){const i=this.safeString(t,"topic");if(void 0!==i){const s=i.split(":"),r=this.safeString(s,0),a={"spot/ticker":this.handleTicker,"spot/wallet":this.handleBalance,"margin/wallet":this.handleBalance,"margin/wallets":this.handleBalance,"spot/trades":this.handleTrades,"margin/trades":this.handleTrades,"spot/order_book_updates":this.handleOrderBook,"spot/user_trades":this.handleMyTrades,"margin/user_trades":this.handleMyTrades},n=this.safeValue(a,r);if(void 0!==n)return n.call(this,e,t)}}throw new r(this.id+" received an unsupported message: "+this.json(t))}handleSubscribed(e,t){return t}handleInfo(e,t){return t}handleAuthenticationMessage(e,t){e.resolve(t,"authenticated")}authenticate(e={}){const t="authenticated",[i,s]=this.handleMarketTypeAndParams("authenticate",void 0,e),r=this.urls.api.ws[i],a=this.client(r);let n=this.safeValue(a.subscriptions,t);if(void 0===n){const e=this.milliseconds();this.checkRequiredCredentials();const i=this.requestId(),o=this.apiKey+e.toString(),h=this.hmac(this.encode(o),this.encode(this.secret),"sha512","base64"),d={method:"login",id:i,api_key:this.apiKey,sign:h,nonce:e},c=this.extend(d,s);n=this.watch(r,t,c),a.subscriptions[t]=n}return n}}},59017:function(e,t,i){"use strict";const s=i(53927),{AuthenticationError:r,BadRequest:a,ArgumentsRequired:n,NotSupported:o,InvalidNonce:h}=i(73449),{ArrayCache:d,ArrayCacheByTimestamp:c,ArrayCacheBySymbolById:l}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchOrderBook:!0,watchTicker:!0,watchTickers:!0,watchTrades:!0,watchMyTrades:!0,watchOHLCV:!0,watchBalance:!0,watchOrders:!0},urls:{api:{ws:"wss://ws.gate.io/v4",spot:"wss://api.gateio.ws/ws/v4/",swap:{usdt:"wss://fx-ws.gateio.ws/v4/ws/usdt",btc:"wss://fx-ws.gateio.ws/v4/ws/btc"},future:{usdt:"wss://fx-ws.gateio.ws/v4/ws/delivery/usdt",btc:"wss://fx-ws.gateio.ws/v4/ws/delivery/btc"},option:"wss://op-ws.gateio.live/v4/ws"},test:{swap:{usdt:"wss://fx-ws-testnet.gateio.ws/v4/ws/usdt",btc:"wss://fx-ws-testnet.gateio.ws/v4/ws/btc"},future:{usdt:"wss://fx-ws-testnet.gateio.ws/v4/ws/usdt",btc:"wss://fx-ws-testnet.gateio.ws/v4/ws/btc"},option:"wss://op-ws-testnet.gateio.live/v4/ws"}},options:{tradesLimit:1e3,OHLCVLimit:1e3,watchTradesSubscriptions:{},watchTickerSubscriptions:{},watchOrderBookSubscriptions:{},watchTicker:{name:"tickers"},watchOrderBook:{interval:"100ms",snapshotDelay:10,maxRetries:3},watchBalance:{settle:"usdt",spot:"spot.balances"}},exceptions:{ws:{exact:{2:a,4:r,6:r,11:r}}}})}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);e=s.symbol;const r=s.id,[a,n]=this.handleOptionAndParams(i,"watchOrderBook","interval","100ms"),o=this.getTypeByMarket(s)+".order_book_update",h="orderbook:"+e,d=this.getUrlByMarket(s),c=[r,a];if(void 0===t&&(t=100),s.contract){const e=t.toString();c.push(e)}const l={symbol:e,limit:t};return(await this.subscribePublic(d,h,c,o,l,n)).limit()}handleOrderBookSubscription(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeInteger(i,"limit");this.orderbooks[s]=this.orderBook({},r)}handleOrderBook(e,t){const i=this.safeString(t,"channel").split("."),s="spot"===this.safeString(i,0),r=s?"spot":"contract",a=this.safeValue(t,"result"),n=this.safeInteger(a,"U"),o=this.safeInteger(a,"u"),d=this.safeString(a,"s"),c=this.safeSymbol(d,void 0,"_",r),l="orderbook:"+c,u=this.safeValue(this.orderbooks,c),f=this.safeInteger(u,"nonce");if(void 0!==f){if(!(f>=o)){if(f>=n-1)this.handleDelta(u,a);else{const t=new h(this.id+" orderbook update has a nonce bigger than u");e.reject(t,l)}e.resolve(u,l)}}else{let t=0;void 0!==u&&(t=u.cache.length);const i=this.handleOption("watchOrderBook","snapshotDelay",10);if(t===(s?i:0)){const t=e.subscriptions[l],i=this.safeInteger(t,"limit");this.spawn(this.loadOrderBook,e,l,c,i)}u.cache.push(a)}}getCacheIndex(e,t){const i=this.safeInteger(e,"nonce"),s=t[0];if(i<this.safeInteger(s,"U"))return-1;for(let e=0;e<t.length;e++){const s=t[e],r=this.safeInteger(s,"U"),a=this.safeInteger(s,"u");if(i>=r-1&&i<a)return e}return t.length}handleBidAsks(e,t){for(let i=0;i<t.length;i++){const s=t[i];if(Array.isArray(s))e.storeArray(this.parseBidAsk(s));else{const t=this.safeFloat(s,"p"),i=this.safeFloat(s,"s");e.store(t,i)}}}handleDelta(e,t){const i=this.safeInteger(t,"t");e.timestamp=i,e.datetime=this.iso8601(i),e.nonce=this.safeInteger(t,"u");const s=this.safeValue(t,"b",[]),r=this.safeValue(t,"a",[]),a=e.bids,n=e.asks;this.handleBidAsks(a,s),this.handleBidAsks(n,r)}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e);e=i.symbol;const s=i.id,r=this.getUrlByMarket(i),a=this.getTypeByMarket(i),[n,o]=this.handleOptionAndParams(t,"watchTicker","method","tickers"),h=a+"."+n,d="ticker:"+e,c=[s];return await this.subscribePublic(r,d,c,h,void 0,o)}async watchTickers(e,t={}){if(await this.loadMarkets(),void 0===(e=this.marketSymbols(e)))throw new n(this.id+" watchTickers requires symbols");const i=this.market(e[0]),s=this.getTypeByMarket(i),r=this.marketIds(e),[a,o]=this.handleOptionAndParams(t,"watchTicker","method","tickers"),h=s+"."+a,d=this.getUrlByMarket(i),c=await this.subscribePublic(d,"tickers",r,h,void 0,o);let l={};return this.newUpdates?l[c.symbol]=c:l=this.tickers,this.filterByArray(l,"symbol",e,!0)}handleTicker(e,t){const i=this.safeString(t,"channel").split("."),s="futures"===this.safeString(i,0)?"contract":"spot";let r=this.safeValue(t,"result");Array.isArray(r)||(r=[r]);for(let t=0;t<r.length;t++){const i=r[t],a=this.safeString(i,"s"),n=this.safeMarket(a,void 0,"_",s),o=this.parseTicker(i,n),h=o.symbol;this.tickers[h]=o;const d="ticker:"+h;e.resolve(o,d),e.resolve(o,"tickers")}}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);e=r.symbol;const a=r.id,n=this.getTypeByMarket(r)+".trades",o="trades:"+e,h=this.getUrlByMarket(r),d=[a],c=await this.subscribePublic(h,o,d,n,void 0,s);return this.newUpdates&&(i=c.getLimit(e,i)),this.filterBySinceLimit(c,t,i,"timestamp",!0)}handleTrades(e,t){let i=this.safeValue(t,"result");Array.isArray(i)||(i=[i]);const s=this.parseTrades(i);for(let t=0;t<s.length;t++){const i=s[t],r=i.symbol;let a=this.safeValue(this.trades,r);if(void 0===a){const e=this.safeInteger(this.options,"tradesLimit",1e3);a=new d(e),this.trades[r]=a}a.append(i);const n="trades:"+r;e.resolve(a,n)}}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;const n=a.id,o=this.safeString(this.timeframes,t,t),h=this.getTypeByMarket(a)+".candlesticks",d="candles:"+o+":"+a.symbol,c=this.getUrlByMarket(a),l=[o,n],u=await this.subscribePublic(c,d,l,h,void 0,r);return this.newUpdates&&(s=u.getLimit(e,s)),this.filterBySinceLimit(u,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeString(t,"channel").split("."),s="spot"===this.safeString(i,0)?"spot":"contract";let r=this.safeValue(t,"result");Array.isArray(r)||(r=[r]);const a={};for(let e=0;e<r.length;e++){const t=r[e],i=this.safeString(t,"n",""),n=i.split("_"),o=this.safeString(n,0),h=o+"_",d=i.replace(h,""),l=this.safeSymbol(d,void 0,"_",s),u=this.parseOHLCV(t);let f=this.safeValue(this.ohlcvs,l);if(void 0===f){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);f=new c(e),this.ohlcvs[l]=f}f.append(u),a[l]=o}const n=Object.keys(a);for(let t=0;t<n.length;t++){const i=n[t],s=a[i],r="candles:"+this.findTimeframe(s)+":"+i,o=this.safeValue(this.ohlcvs,i);e.resolve(o,r)}}async watchMyTrades(e,t,i,s={}){let r,a;await this.loadMarkets();let n,o="!all";void 0!==e&&(n=this.market(e),o=n.id),[a,s]=this.handleMarketTypeAndParams("watchMyTrades",n,s),[r,s]=this.handleSubTypeAndParams("watchMyTrades",n,s);const h=this.getSupportedMapping(a,{spot:"spot",margin:"spot",future:"futures",swap:"futures",option:"options"})+".usertrades";let d="myTrades";void 0!==e&&(d+=":"+e);const c="inverse"===r,l=this.getUrlByMarketType(a,c),u=[o],f="spot"!==a,p=await this.subscribePrivate(l,d,u,h,s,f);return this.newUpdates&&(i=p.getLimit(e,i)),this.filterBySymbolSinceLimit(p,e,t,i,!0)}handleMyTrades(e,t){const i=this.safeValue(t,"result",[]);if(0===i.length)return;let s=this.myTrades;if(void 0===s){const e=this.safeInteger(this.options,"tradesLimit",1e3);s=new l(e),this.myTrades=s}const r=this.parseTrades(i),a={};for(let e=0;e<r.length;e++){const t=r[e];s.append(t);a[t.symbol]=!0}const n=Object.keys(a);for(let t=0;t<n.length;t++){const i="myTrades:"+n[t];e.resolve(s,i)}e.resolve(s,"myTrades")}async watchBalance(e={}){let t,i;await this.loadMarkets(),[t,e]=this.handleMarketTypeAndParams("watchBalance",void 0,e),[i,e]=this.handleSubTypeAndParams("watchBalance",void 0,e);const s="inverse"===i,r=this.getUrlByMarketType(t,s),a="spot"!==t,n=this.getSupportedMapping(t,{spot:"spot",margin:"spot",future:"futures",swap:"futures",option:"options"})+".balances",o=t+".balance";return await this.subscribePrivate(r,o,void 0,n,e,a)}handleBalance(e,t){const i=this.safeValue(t,"result",[]);for(let e=0;e<i.length;e++){const t=i[e],s=this.account(),r=this.safeString(t,"currency","USDT"),a=this.safeCurrencyCode(r);s.free=this.safeString(t,"available"),s.total=this.safeString2(t,"total","balance"),this.balance[a]=s}const s=this.safeString(t,"channel").split("."),r=this.safeString(s,0),a=this.getSupportedMapping(r,{spot:"spot",futures:"swap",options:"option"})+".balance";this.balance=this.safeBalance(this.balance),e.resolve(this.balance,a)}async watchOrders(e,t,i,s={}){let r,a,n;await this.loadMarkets(),void 0!==e&&(r=this.market(e),e=r.symbol),[a,n]=this.handleMarketTypeAndParams("watchOrders",r,s);const o=this.getSupportedMapping(a,{spot:"spot",margin:"spot",future:"futures",swap:"futures",option:"options"})+".orders";let h,d="orders",c=["!all"];void 0!==e&&(d+=":"+r.id,c=[r.id]),[h,n]=this.handleSubTypeAndParams("watchOrders",r,n);const l="inverse"===h,u=this.getUrlByMarketType(a,l),f="spot"!==a,p=await this.subscribePrivate(u,d,c,o,n,f);return this.newUpdates&&(i=p.getLimit(e,i)),this.filterBySinceLimit(p,t,i,"timestamp",!0)}handleOrder(e,t){const i=this.safeValue(t,"result",[]),s=this.safeInteger(this.options,"ordersLimit",1e3);void 0===this.orders&&(this.orders=new l(s));const r=this.orders,a={},n=this.parseOrders(i);for(let e=0;e<n.length;e++){const t=n[e],i=this.safeValue(t,"info"),s=this.safeString(i,"event");"put"===s?t.status="open":"finish"===s&&(t.status="closed"),r.append(t);const o=t.symbol;a[this.market(o).id]=!0}const o=Object.keys(a);for(let t=0;t<o.length;t++){const i="orders:"+o[t];e.resolve(this.orders,i)}e.resolve(this.orders,"orders")}handleErrorMessage(e,t){const i=this.safeValue(t,"error",{}),s=this.safeInteger(i,"code");if(void 0!==s){const i=this.safeString(t,"id"),r=this.indexBy(e.subscriptions,"id"),a=this.safeValue(r,i);if(void 0!==a)try{this.throwExactlyMatchedException(this.exceptions.ws.exact,s,this.json(t))}catch(t){const s=this.safeString(a,"messageHash");e.reject(t,s),i in e.subscriptions&&delete e.subscriptions[i]}}}handleBalanceSubscription(e,t,i){this.balance={}}handleSubscriptionStatus(e,t){const i=this.safeString(t,"channel",""),s={balance:this.handleBalanceSubscription,order_book:this.handleOrderBookSubscription},r=this.safeInteger(t,"id"),a=this.indexBy(e.subscriptions,"id"),n=this.safeValue(a,r);if(void 0!==n){const r=Object.keys(s);for(let a=0;a<r.length;a++){const o=r[a];if(i.indexOf(o)>=0){s[o].call(this,e,t,n)}}}}handleMessage(e,t){this.handleErrorMessage(e,t);if("subscribe"===this.safeString(t,"event"))return void this.handleSubscriptionStatus(e,t);const i=this.safeString(t,"channel","").split("."),s=this.safeValue(i,1),r={usertrades:this.handleMyTrades,candlesticks:this.handleOHLCV,orders:this.handleOrder,tickers:this.handleTicker,book_ticker:this.handleTicker,trades:this.handleTrades,order_book_update:this.handleOrderBook,balances:this.handleBalance},a=this.safeValue(r,s);void 0!==a&&a.call(this,e,t)}getUrlByMarket(e){const t=this.urls.api[e.type];return e.contract?e.linear?t.usdt:t.btc:t}getTypeByMarket(e){return e.spot?"spot":e.option?"options":"futures"}getUrlByMarketType(e,t=!1){if("spot"===e){const t=this.urls.api.spot;if(void 0===t)throw new o(this.id+" does not have a testnet for the "+e+" market type.");return t}if("swap"===e){const e=this.urls.api.swap;return t?e.btc:e.usdt}if("future"===e){const e=this.urls.api.future;return t?e.btc:e.usdt}if("option"===e)return this.urls.api.option}requestId(){const e=this.sum(this.safeInteger(this.options,"reqid",0),1);return this.options.reqid=e,e}async subscribePublic(e,t,i,s,r,a={}){const n=this.requestId(),o={id:n,time:this.seconds(),channel:s,event:"subscribe",payload:i};void 0===r&&(r={}),r=this.extend(r,{id:n,messageHash:t});const h=this.extend(o,a);return await this.watch(e,t,h,t,r)}async subscribePrivate(e,t,i,s,r,a=!1){if(this.checkRequiredCredentials(),a){if(void 0===this.uid||0===this.uid.length)throw new n(this.id+" requires uid to subscribe");const e=[this.uid];i=void 0===i?e:this.arrayConcat(e,i)}const o=this.seconds(),h="channel="+s+"&event=subscribe&time="+o.toString(),d=this.hmac(this.encode(h),this.encode(this.secret),"sha512","hex"),c={method:"api_key",KEY:this.apiKey,SIGN:d},l=this.requestId(),u={id:l,time:o,channel:s,event:"subscribe",auth:c};void 0!==i&&(u.payload=i);const f=this.extend(u,r),p={id:l,messageHash:t};return await this.watch(e,t,f,t,p)}}},64581:function(e,t,i){"use strict";const s=i(59017);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{alias:!0,id:"gateio"})}}},28005:function(e,t,i){"use strict";const s=i(23094),{ArrayCache:r,ArrayCacheBySymbolById:a,ArrayCacheByTimestamp:n}=i(56062),{ExchangeError:o}=i(73449);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!1,watchTicker:!1,watchTickers:!1,watchTrades:!0,watchMyTrades:!1,watchOrders:!0,watchOrderBook:!0,watchOHLCV:!0},hostname:"api.gemini.com",urls:{api:{ws:"wss://api.gemini.com"},test:{ws:"wss://api.sandbox.gemini.com"}}})}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a="trades:"+r.symbol,n={type:"subscribe",subscriptions:[{name:"l2",symbols:[r.id.toUpperCase()]}]},o="l2:"+r.symbol,h=this.urls.api.ws+"/v2/marketdata",d=await this.watch(h,a,n,o);return this.newUpdates&&(i=d.getLimit(r.symbol,i)),this.filterBySinceLimit(d,t,i,"timestamp",!0)}parseWsTrade(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeString(e,"event_id"),r=this.safeString(e,"price"),a=this.safeString(e,"quantity"),n=this.safeStringLower(e,"side"),o=this.safeStringLower(e,"symbol"),h=this.safeSymbol(o,t);return this.safeTrade({id:s,order:void 0,info:e,timestamp:i,datetime:this.iso8601(i),symbol:h,type:void 0,side:n,takerOrMaker:void 0,price:r,cost:void 0,amount:a,fee:void 0},t)}handleTrade(e,t){const i=this.parseWsTrade(t),s=i.symbol,a=this.safeInteger(this.options,"tradesLimit",1e3);let n=this.safeValue(this.trades,s);void 0===n&&(n=new r(a),this.trades[s]=n),n.append(i);const o="trades:"+s;e.resolve(n,o)}handleTrades(e,t){const i=this.safeStringLower(t,"symbol"),s=this.safeMarket(i),a=this.safeValue(t,"trades");if(void 0!==a){const t=s.symbol,i=this.safeInteger(this.options,"tradesLimit",1e3);let n=this.safeValue(this.trades,t);void 0===n&&(n=new r(i),this.trades[t]=n);for(let e=0;e<a.length;e++){const t=this.parseWsTrade(a[e],s);n.append(t)}const o="trades:"+t;e.resolve(n,o)}}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.safeString(this.timeframes,t,t),o={type:"subscribe",subscriptions:[{name:"candles_"+n,symbols:[a.id.toUpperCase()]}]},h="ohlcv:"+a.symbol+":"+n,d=this.urls.api.ws+"/v2/marketdata",c=await this.watch(d,h,o,h);return this.newUpdates&&(s=c.getLimit(e,s)),this.filterBySinceLimit(c,i,s,0,!0)}handleOHLCV(e,t){let i=this.safeString(t,"type","").slice(8);const s=i.indexOf("_");i=i.slice(0,s);const r=this.safeString(t,"symbol","").toLowerCase(),a=this.safeMarket(r),o=this.safeSymbol(r,a),h=this.safeValue(t,"changes",[]),d=this.findTimeframe(i);void 0===this.safeValue(this.ohlcvs,o)&&(this.ohlcvs[o]={});let c=this.safeValue(this.ohlcvs[o],d);if(void 0===c){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);c=new n(e),this.ohlcvs[o][d]=c}const l=h.length;for(let e=0;e<l;e++){const t=l-e-1,i=this.parseOHLCV(h[t],a);c.append(i)}const u="ohlcv:"+o+":"+i;return e.resolve(c,u),t}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r="orderbook:"+s.symbol,a={type:"subscribe",subscriptions:[{name:"l2",symbols:[s.id.toUpperCase()]}]},n="l2:"+s.symbol,o=this.urls.api.ws+"/v2/marketdata";return(await this.watch(o,r,a,n)).limit()}handleOrderBook(e,t){const i=this.safeValue(t,"changes",[]),s=this.safeStringLower(t,"symbol"),r=this.safeMarket(s).symbol,a="orderbook:"+r;let n=this.safeValue(this.orderbooks,r);void 0===n&&(n=this.orderBook());for(let e=0;e<i.length;e++){const t=i[e],s=this.safeNumber(t,1),r=this.safeNumber(t,2),a="buy"===t[0]?"bids":"asks",o=n[a];o.store(s,r),n[a]=o}n.symbol=r,this.orderbooks[r]=n,e.resolve(n,a)}handleL2Updates(e,t){this.handleOrderBook(e,t),this.handleTrades(e,t)}async watchOrders(e,t,i,s={}){const r=this.urls.api.ws+"/v1/order/events?eventTypeFilter=initial&eventTypeFilter=accepted&eventTypeFilter=rejected&eventTypeFilter=fill&eventTypeFilter=cancelled&eventTypeFilter=booked";await this.loadMarkets();const a={url:r};if(await this.authenticate(a),void 0!==e){e=this.market(e).symbol}const n="orders",o=await this.watch(r,n,void 0,n);return this.newUpdates&&(i=o.getLimit(e,i)),this.filterBySymbolSinceLimit(o,e,t,i,!0)}handleHeartbeat(e,t){return t}handleSubscription(e,t){return t}handleOrder(e,t){if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new a(e)}const i=this.orders;for(let e=0;e<t.length;e++){const s=this.parseWsOrder(t[e]);i.append(s)}e.resolve(this.orders,"orders")}parseWsOrder(e,t){const i=this.safeNumber(e,"timestampms"),s=this.safeString(e,"type"),r=this.safeString(e,"symbol"),a=this.safeString(e,"order_type"),n=this.safeString(e,"behavior");let o="GTC",h=!1;return"immediate-or-cancel"===n?o="IOC":"fill-or-kill"===n?o="FOK":"maker-or-cancel"===n&&(o="PO",h=!0),this.safeOrder({id:this.safeString(e,"order_id"),clientOrderId:this.safeString(e,"client_order_id"),info:e,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:void 0,status:this.parseWsOrderStatus(s),symbol:this.safeSymbol(r,t),type:this.parseWsOrderType(a),timeInForce:o,postOnly:h,side:this.safeString(e,"side"),price:this.safeNumber(e,"price"),stopPrice:void 0,average:this.safeNumber(e,"avg_execution_price"),cost:void 0,amount:this.safeNumber(e,"original_amount"),filled:this.safeNumber(e,"executed_amount"),remaining:this.safeNumber(e,"remaining_amount"),fee:void 0,trades:void 0},t)}parseWsOrderStatus(e){return this.safeString({accepted:"open",booked:"open",fill:"closed",cancelled:"canceled",cancel_rejected:"rejected",rejected:"rejected"},e,e)}parseWsOrderType(e){return this.safeString({"exchange limit":"limit","market buy":"market","market sell":"market"},e,e)}handleError(e,t){throw new o(this.json(t))}handleMessage(e,t){if(Array.isArray(t))return this.handleOrder(e,t);"error"===this.safeString(t,"reason")&&this.handleError(e,t);const i={l2_updates:this.handleL2Updates,trade:this.handleTrade,subscription_ack:this.handleSubscription,heartbeat:this.handleHeartbeat},s=this.safeString(t,"type","");if(s.indexOf("candles")>=0)return this.handleOHLCV(e,t);const r=this.safeValue(i,s);void 0!==r&&r.call(this,e,t)}async authenticate(e={}){const t=this.safeString(e,"url");if(void 0!==this.clients&&t in this.clients)return;this.checkRequiredCredentials();const i=this.urls.api.ws.length,s=t.indexOf("?"),r=t.length,a=s>=0?s:r,n={request:t.slice(i,a),nonce:this.nonce()},o=this.stringToBase64(this.encode(this.json(n))),h=this.hmac(o,this.encode(this.secret),"sha384","hex");this.options=this.extend({ws:{options:{headers:{}}}},this.options);const d=this.options.ws.options.headers;this.options.ws.options.headers={"X-GEMINI-APIKEY":this.apiKey,"X-GEMINI-PAYLOAD":this.decode(o),"X-GEMINI-SIGNATURE":h},this.client(t),this.options.ws.options.headers=d}}},59306:function(e,t,i){"use strict";const s=i(28267),{ArrayCache:r,ArrayCacheByTimestamp:a}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0,watchOrderBook:!0,watchBalance:!1,watchOHLCV:!0},urls:{api:{ws:"wss://api.hitbtc.com/api/2/ws"}},options:{tradesLimit:1e3,methods:{orderbook:"subscribeOrderbook",ticker:"subscribeTicker",trades:"subscribeTrades",ohlcv:"subscribeCandles"}}})}async watchPublic(e,t,i,s={}){await this.loadMarkets();const r=this.marketId(e),a=this.urls.api.ws;let n=t+":"+r;void 0!==i&&(n+=":"+i);const o=this.safeValue(this.options,"methods",{}),h={method:this.safeString(o,t,t),params:{symbol:r},id:this.nonce()},d=this.deepExtend(h,s);return await this.watch(a,n,d,n)}async watchOrderBook(e,t,i={}){return(await this.watchPublic(e,"orderbook",void 0,i)).limit()}handleOrderBookSnapshot(e,t){const i=this.safeValue(t,"params",{}),s=this.safeString(i,"symbol"),r=this.safeMarket(s).symbol,a=this.parse8601(this.safeString(i,"timestamp")),n=this.safeInteger(i,"sequence");r in this.orderbooks&&delete this.orderbooks[r];const o=this.parseOrderBook(i,r,a,"bid","ask","price","size"),h=this.orderBook(o);h.nonce=n,this.orderbooks[r]=h;const d="orderbook:"+s;e.resolve(h,d)}handleOrderBookUpdate(e,t){const i=this.safeValue(t,"params",{}),s=this.safeString(i,"symbol"),r=this.safeMarket(s).symbol;if(r in this.orderbooks){const t=this.parse8601(this.safeString(i,"timestamp")),a=this.safeInteger(i,"sequence"),n=this.orderbooks[r],o=this.safeValue(i,"ask",[]),h=this.safeValue(i,"bid",[]);this.handleDeltas(n.asks,o),this.handleDeltas(n.bids,h),n.timestamp=t,n.datetime=this.iso8601(t),n.nonce=a,this.orderbooks[r]=n;const d="orderbook:"+s;e.resolve(n,d)}}handleDelta(e,t){const i=this.safeFloat(t,"price"),s=this.safeFloat(t,"size");e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}async watchTicker(e,t={}){return await this.watchPublic(e,"ticker",void 0,t)}handleTicker(e,t){const i=this.safeValue(t,"params"),s=this.safeValue(i,"symbol"),r=this.safeMarket(s),a=r.symbol,n=this.parseTicker(i,r);this.tickers[a]=n;const o=this.safeValue(t,"method")+":"+s;e.resolve(n,o)}async watchTrades(e,t,i,s={}){const r=await this.watchPublic(e,"trades",void 0,s);return this.newUpdates&&(i=r.getLimit(e,i)),this.filterBySinceLimit(r,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeValue(t,"params",{}),s=this.safeValue(i,"data",[]),a=this.safeString(i,"symbol"),n=this.safeMarket(a),o=n.symbol,h="trades:"+a,d=this.safeInteger(this.options,"tradesLimit",1e3);let c=this.safeValue(this.trades,o);if(void 0===c&&(c=new r(d),this.trades[o]=c),Array.isArray(s)){const e=this.parseTrades(s,n);for(let t=0;t<e.length;t++)c.append(e[t])}else{const e=this.parseTrade(t,n);c.append(e)}return e.resolve(c,h),t}async watchOHLCV(e,t="1m",i,s,r={}){const a=this.safeString(this.timeframes,t,t),n={params:{period:a}},o=this.deepExtend(n,r),h=await this.watchPublic(e,"ohlcv",a,o);return this.newUpdates&&(s=h.getLimit(e,s)),this.filterBySinceLimit(h,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeValue(t,"params",{}),s=this.safeValue(i,"data",[]),r=this.safeString(i,"symbol"),n=this.safeMarket(r),o=n.symbol,h=this.safeString(i,"period"),d=this.findTimeframe(h),c="ohlcv:"+r+":"+h;for(let t=0;t<s.length;t++){const i=s[t],r=this.parseOHLCV(i,n);this.ohlcvs[o]=this.safeValue(this.ohlcvs,o,{});let h=this.safeValue(this.ohlcvs[o],d);if(void 0===h){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);h=new a(e),this.ohlcvs[o][d]=h}h.append(r),e.resolve(h,c)}return t}handleNotification(e,t){return t}handleMessage(e,t){const i={snapshotOrderbook:this.handleOrderBookSnapshot,updateOrderbook:this.handleOrderBookUpdate,ticker:this.handleTicker,snapshotTrades:this.handleTrades,updateTrades:this.handleTrades,snapshotCandles:this.handleOHLCV,updateCandles:this.handleOHLCV},s=this.safeString(t,"method"),r=this.safeValue(i,s);void 0===r?this.handleNotification(e,t):r.call(this,e,t)}}},33622:function(e,t,i){"use strict";const s=i(94693),{AuthenticationError:r,BadSymbol:a,BadRequest:n}=i(73449),{ArrayCache:o,ArrayCacheBySymbolById:h}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchMyTrades:!1,watchOHLCV:!1,watchOrderBook:!0,watchOrders:!0,watchTicker:!1,watchTickers:!1,watchTrades:!0},urls:{api:{ws:"wss://api.hollaex.com/stream"},test:{ws:"wss://api.sandbox.hollaex.com/stream"}},options:{watchBalance:{},watchOrders:{}},streaming:{ping:this.ping},exceptions:{ws:{exact:{"Bearer or HMAC authentication required":a,"Error: wrong input":n}}}})}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s="orderbook:"+this.market(e).id;return(await this.watchPublic(s,i)).limit()}handleOrderBook(e,t){const i=this.safeString(t,"symbol"),s=this.safeString(t,"topic"),r=this.safeMarket(i).symbol,a=this.safeValue(t,"data");let n=this.safeString(a,"timestamp");n=this.parse8601(n);const o=this.parseOrderBook(a,r,n);let h;r in this.orderbooks?(h=this.orderbooks[r],h.reset(o)):(h=this.orderBook(o),this.orderbooks[r]=h);const d=s+":"+i;e.resolve(h,d)}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);e=r.symbol;const a="trade:"+r.id,n=await this.watchPublic(a,s);return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySinceLimit(n,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeString(t,"topic"),s=this.safeString(t,"symbol"),r=this.safeMarket(s),a=r.symbol;let n=this.safeValue(this.trades,a);if(void 0===n){const e=this.safeInteger(this.options,"tradesLimit",1e3);n=new o(e),this.trades[a]=n}const h=this.safeValue(t,"data",[]),d=this.parseTrades(h,r);for(let e=0;e<d.length;e++)n.append(d[e]);const c=i+":"+s;e.resolve(n,c),e.resolve(n,i)}async watchMyTrades(e,t,i,s={}){await this.loadMarkets();let r,a="usertrade";void 0!==e&&(r=this.market(e),e=r.symbol,a+=":"+r.id);const n=await this.watchPrivate(a,s);return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySymbolSinceLimit(n,e,t,i,!0)}handleMyTrades(e,t,i){const s=this.safeString(t,"topic"),r=this.safeValue(t,"data");if(0===r.length)return 0;if(void 0===this.myTrades){const e=this.safeInteger(this.options,"tradesLimit",1e3);this.myTrades=new o(e)}const a=this.myTrades,n={};for(let e=0;e<r.length;e++){const t=r[e],i=this.parseTrade(t);a.append(i);const s=t.symbol;n[this.market(s).id]=!0}e.resolve(this.myTrades,s);const h=Object.keys(n);for(let t=0;t<h.length;t++){const i=s+":"+h[t];e.resolve(this.myTrades,i)}}async watchOrders(e,t,i,s={}){await this.loadMarkets();let r,a="order";void 0!==e&&(r=this.market(e),e=r.symbol,a+=":"+r.id);const n=await this.watchPrivate(a,s);return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySymbolSinceLimit(n,e,t,i,!0)}handleOrder(e,t,i){const s=this.safeString(t,"topic"),r=this.safeValue(t,"data",{});if(0===r.length)return 0;if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new h(e)}const a=this.orders;let n;n=Array.isArray(r)?r:[r];const o={};for(let e=0;e<n.length;e++){const t=n[e],i=this.parseOrder(t);a.append(i);const s=t.symbol;o[this.market(s).id]=!0}e.resolve(this.orders,s);const d=Object.keys(o);for(let t=0;t<d.length;t++){const i=s+":"+d[t];e.resolve(this.orders,i)}}async watchBalance(e={}){return await this.watchPrivate("wallet",e)}handleBalance(e,t){const i=this.safeString(t,"topic"),s=this.safeValue(t,"data"),r=Object.keys(s);for(let e=0;e<r.length;e++){const t=r[e],i=t.split("_"),a=this.safeString(i,0),n=this.safeCurrencyCode(a),o=n in this.balance?this.balance[n]:this.account();o["available"===this.safeString(i,1)?"free":"total"]=this.safeString(s,t),this.balance[n]=o}this.balance=this.safeBalance(this.balance),e.resolve(this.balance,i)}async watchPublic(e,t={}){const i=this.urls.api.ws,s={op:"subscribe",args:[e]},r=this.extend(s,t);return await this.watch(i,e,r,e)}async watchPrivate(e,t={}){this.checkRequiredCredentials();let i=this.safeString(this.options,"ws-expires");if(void 0===i){const e=parseInt(this.timeout/1e3);i=this.sum(this.seconds(),e),i=i.toString(),this.options["ws-expires"]=i}const s=this.urls.api.ws,r="CONNECT/stream"+i,a=this.hmac(this.encode(r),this.encode(this.secret)),n={"api-key":this.apiKey,"api-signature":a,"api-expires":i},o=s+"?"+this.urlencode(n),h={op:"subscribe",args:[e]},d=this.extend(h,t);return await this.watch(o,e,d,e)}handleErrorMessage(e,t){const i=this.safeInteger(t,"error");try{if(void 0!==i){const e=this.id+" "+this.json(t);this.throwExactlyMatchedException(this.exceptions.ws.exact,i,e)}}catch(e){if(e instanceof r)return!1}return t}handleMessage(e,t){if(!this.handleErrorMessage(e,t))return;if("pong"===this.safeString(t,"message"))return void this.handlePong(e,t);const i={trade:this.handleTrades,orderbook:this.handleOrderBook,order:this.handleOrder,wallet:this.handleBalance,usertrade:this.handleMyTrades},s=this.safeValue(t,"topic"),r=this.safeValue(i,s);void 0!==r&&r.call(this,e,t)}ping(e){return{op:"ping"}}handlePong(e,t){return e.lastPong=this.milliseconds(),t}onError(e,t){this.options["ws-expires"]=void 0,super.onError(e,t)}onClose(e,t){this.options["ws-expires"]=void 0,super.onClose(e,t)}}},85225:function(e,t,i){"use strict";const s=i(68639),{ExchangeError:r,InvalidNonce:a,ArgumentsRequired:n,BadRequest:o,BadSymbol:h,AuthenticationError:d}=i(73449),{ArrayCache:c,ArrayCacheByTimestamp:l,ArrayCacheBySymbolById:u}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchOrderBook:!0,watchOrders:!0,watchTickers:!1,watchTicker:!0,watchTrades:!0,watchMyTrades:!0,watchBalance:!0,watchOHLCV:!0},urls:{api:{ws:{api:{spot:{public:"wss://{hostname}/ws",private:"wss://{hostname}/ws/v2"},future:{linear:{public:"wss://api.hbdm.com/linear-swap-ws",private:"wss://api.hbdm.com/linear-swap-notification"},inverse:{public:"wss://api.hbdm.com/ws",private:"wss://api.hbdm.com/notification"}},swap:{inverse:{public:"wss://api.hbdm.com/swap-ws",private:"wss://api.hbdm.com/swap-notification"},linear:{public:"wss://api.hbdm.com/linear-swap-ws",private:"wss://api.hbdm.com/linear-swap-notification"}}},"api-aws":{spot:{public:"wss://api-aws.huobi.pro/ws",private:"wss://api-aws.huobi.pro/ws/v2"},future:{linear:{public:"wss://api.hbdm.vn/linear-swap-ws",private:"wss://api.hbdm.vn/linear-swap-notification"},inverse:{public:"wss://api.hbdm.vn/ws",private:"wss://api.hbdm.vn/notification"}},swap:{inverse:{public:"wss://api.hbdm.vn/swap-ws",private:"wss://api.hbdm.vn/swap-notification"},linear:{public:"wss://api.hbdm.vn/linear-swap-ws",private:"wss://api.hbdm.vn/linear-swap-notification"}}}}}},options:{tradesLimit:1e3,OHLCVLimit:1e3,api:"api",maxOrderBookSyncAttempts:3,ws:{gunzip:!0},watchTicker:{name:"market.{marketId}.detail"}},exceptions:{ws:{exact:{"bad-request":o,2002:d,2021:o,2001:h,2011:h,2040:o}}}})}requestId(){const e=this.sum(this.safeInteger(this.options,"requestId",0),1);return this.options.requestId=e,e.toString()}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e);e=i.symbol;const s=this.safeValue(this.options,"watchTicker",{}),r=this.safeString(s,"name","market.{marketId}.detail");if("market.{marketId}.ticker"===r&&"spot"!==i.type)throw new o(this.id+" watchTicker() with name market.{marketId}.ticker is only allowed for spot markets, use market.{marketId}.detail instead");const a=this.implodeParams(r,{marketId:i.id}),n=this.getUrlByMarketType(i.type,i.linear);return await this.subscribePublic(n,e,a,void 0,t)}handleTicker(e,t){const i=this.safeValue(t,"tick",{}),s=this.safeString(t,"ch"),r=s.split("."),a=this.safeString(r,1),n=this.safeMarket(a),o=this.parseTicker(i,n),h=this.safeValue(t,"ts");o.timestamp=h,o.datetime=this.iso8601(h);const d=o.symbol;return this.tickers[d]=o,e.resolve(o,s),t}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);e=r.symbol;const a="market."+r.id+".trade.detail",n=this.getUrlByMarketType(r.type,r.linear),o=await this.subscribePublic(n,e,a,void 0,s);return this.newUpdates&&(i=o.getLimit(e,i)),this.filterBySinceLimit(o,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeValue(t,"tick",{}),s=this.safeValue(i,"data",{}),r=this.safeString(t,"ch"),a=r.split("."),n=this.safeString(a,1),o=this.safeMarket(n),h=o.symbol;let d=this.safeValue(this.trades,h);if(void 0===d){const e=this.safeInteger(this.options,"tradesLimit",1e3);d=new c(e),this.trades[h]=d}for(let e=0;e<s.length;e++){const t=this.parseTrade(s[e],o);d.append(t)}return e.resolve(d,r),t}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;const n=this.safeString(this.timeframes,t,t),o="market."+a.id+".kline."+n,h=this.getUrlByMarketType(a.type,a.linear),d=await this.subscribePublic(h,e,o,void 0,r);return this.newUpdates&&(s=d.getLimit(e,s)),this.filterBySinceLimit(d,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeString(t,"ch"),s=i.split("."),r=this.safeString(s,1),a=this.safeMarket(r),n=a.symbol,o=this.safeString(s,3),h=this.findTimeframe(o);this.ohlcvs[n]=this.safeValue(this.ohlcvs,n,{});let d=this.safeValue(this.ohlcvs[n],h);if(void 0===d){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);d=new l(e),this.ohlcvs[n][h]=d}const c=this.safeValue(t,"tick"),u=this.parseOHLCV(c,a);d.append(u),e.resolve(d,i)}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);e=s.symbol;if(t=void 0===t?150:t,s.spot&&!this.inArray(t,[150]))throw new r(this.id+" watchOrderBook spot market accepts limits of 150 only");if(!s.spot&&!this.inArray(t,[20,150]))throw new r(this.id+" watchOrderBook swap market accepts limits of 20 and 150 only");let a;a=s.spot?"market."+s.id+".mbp."+t.toString():"market."+s.id+".depth.size_"+t.toString()+".high_freq";const n=this.getUrlByMarketType(s.type,s.linear);let o=this.handleOrderBookSubscription;s.spot||(i.data_type="incremental",o=void 0);return(await this.subscribePublic(n,e,a,o,i)).limit()}handleOrderBookSnapshot(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeString(i,"messageHash");try{const n=this.orderbooks[s],o=this.safeValue(t,"data"),h=n.cache,d=this.safeValue(h,0,{}),c=this.parseOrderBook(o,s),l=this.safeValue(d,"tick"),u=this.safeInteger(l,"seqNum"),f=this.safeInteger(o,"seqNum");if(c.nonce=f,void 0!==u&&f<u){const n=this.safeInteger(this.options,"maxOrderBookSyncAttempts",3);let o=this.safeInteger(i,"numAttempts",0);if(!(o<n))throw new a(this.id+" failed to synchronize WebSocket feed with the snapshot for symbol "+s+" in "+n.toString()+" attempts");r in e.subscriptions&&(o=this.sum(o,1),i.numAttempts=o,e.subscriptions[r]=i,this.spawn(this.watchOrderBookSnapshot,e,t,i))}else{n.reset(c);for(let t=0;t<h.length;t++){const i=h[t];this.handleOrderBookMessage(e,i,n)}this.orderbooks[s]=n,e.resolve(n,r)}}catch(t){e.reject(t,r)}}async watchOrderBookSnapshot(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeInteger(i,"limit"),a=this.safeValue(i,"params"),n=this.safeInteger(i,"numAttempts",0),o=this.safeString(i,"messageHash"),h=this.market(s),d=this.getUrlByMarketType(h.type,h.linear),c=this.requestId(),l={req:o,id:c},u={id:c,messageHash:o,symbol:s,limit:r,params:a,numAttempts:n,method:this.handleOrderBookSnapshot};return(await this.watch(d,c,l,c,u)).limit()}handleDelta(e,t){const i=this.safeFloat(t,0),s=this.safeFloat(t,1);e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleOrderBookMessage(e,t,i){const s=this.safeValue(t,"ch").split("."),r=this.safeString(s,1),a=this.safeSymbol(r),n=this.safeValue(t,"tick",{}),o=this.safeInteger2(n,"seqNum","version"),h=this.safeInteger(n,"prevSeqNum"),d=this.safeString(n,"event"),c=this.safeInteger(t,"ts");if("snapshot"===d){const e=this.parseOrderBook(n,a,c);i.reset(e),i.nonce=o}if((void 0===h||h<=i.nonce)&&o>i.nonce){const e=this.safeValue(n,"asks",[]),t=this.safeValue(n,"bids",[]);this.handleDeltas(i.asks,e),this.handleDeltas(i.bids,t),i.nonce=o,i.timestamp=c,i.datetime=this.iso8601(c)}return i}handleOrderBook(e,t){const i=this.safeValue(t,"tick",{}),s=this.safeString(i,"event"),r=this.safeString(t,"ch"),a=this.safeValue(t,"ch").split("."),n=this.safeString(a,1),o=this.safeSymbol(n);let h=this.safeValue(this.orderbooks,o);if(void 0===h){const e=this.safeString(a,3).split("_"),t=this.safeInteger(e,1);h=this.orderBook({},t)}void 0===h.nonce&&h.cache.push(t),void 0===s&&void 0===h.nonce||(this.orderbooks[o]=this.handleOrderBookMessage(e,t,h),e.resolve(h,r))}handleOrderBookSubscription(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeInteger(i,"limit");s in this.orderbooks&&delete this.orderbooks[s],this.orderbooks[s]=this.orderBook({},r),!0===this.markets[s].spot&&this.spawn(this.watchOrderBookSnapshot,e,t,i)}async watchMyTrades(e,t,i,s={}){let r;this.checkRequiredCredentials();let a,n,o,h,d,c="*";if(void 0!==e?(await this.loadMarkets(),a=this.market(e),e=a.symbol,r=a.type,d=a.linear?"linear":"inverse",c=a.lowercaseId):(r=this.safeString(this.options,"defaultType","spot"),r=this.safeString(s,"type",r),d=this.safeString2(this.options,"subType","defaultSubType","linear"),d=this.safeString(s,"subType",d),s=this.omit(s,["type","subType"])),"spot"===r){let e;void 0===e&&(e=this.safeString2(this.options,"watchMyTrades","mode","0"),e=this.safeString(s,"mode",e),s=this.omit(s,"mode")),n="trade.clearing#"+c+"#"+e,o=n}else{const e=this.getOrderChannelAndMessageHash(r,d,a,s);o=this.safeString(e,0);n=this.safeString(e,1)+":trade"}return h=await this.subscribePrivate(o,n,r,d,s),this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySymbolSinceLimit(h,e,t,i,!0)}getOrderChannelAndMessageHash(e,t,i,s={}){let r,a,n=this.safeString(this.options,"orderType","orders");n=this.safeString(s,"orderType",n),s=this.omit(s,"orderType");const o=void 0!==i?i.lowercaseId:void 0,h=void 0!==i?i.lowercaseBaseId:void 0,d=n;if(r=d,"linear"===t){const e="cross"===this.safeString(s,"margin","cross")?d+"_cross":d;r=e,void 0!==o?(r+="."+o,a=r):a=e+".*"}else"future"===e?void 0!==h?(a=d+"."+h,r=a):a=d+".*":void 0!==o?(a=d+"."+o,r=a):a=d+".*";return[a,r]}async watchOrders(e,t,i,s={}){let r,a,n;await this.loadMarkets();let o,h,d="*";if(void 0!==e?(n=this.market(e),e=n.symbol,r=n.type,d=n.lowercaseId,a=n.linear?"linear":"inverse"):(r=this.safeString(this.options,"defaultType","spot"),r=this.safeString(s,"type",r),a=this.safeString2(this.options,"subType","defaultSubType","linear"),a=this.safeString(s,"subType",a),s=this.omit(s,["type","subType"])),"spot"===r)o="orders#"+d,h=o;else{const e=this.getOrderChannelAndMessageHash(r,a,n,s);h=this.safeString(e,0),o=this.safeString(e,1)}const c=await this.subscribePrivate(h,o,r,a,s);return this.newUpdates&&(i=c.getLimit(e,i)),this.filterBySinceLimit(c,t,i,"timestamp",!0)}handleOrder(e,t){const i=this.safeString2(t,"ch","topic"),s=this.safeValue(t,"data");let r=this.safeString(t,"contract_code");void 0===r&&(r=this.safeString(s,"symbol"));const a=this.safeMarket(r);let n;if(void 0!==s){if("trade"===this.safeString(s,"eventType")){const e=this.parseOrderTrade(s,a);n={id:this.safeString(e,"order"),trades:[e],status:"closed",symbol:a.symbol}}else n=this.parseWsOrder(s,a)}else{n=this.parseWsOrder(t,a);const s=this.safeValue(t,"trade",[]);if(s.length>0){const t={trades:s,ch:i,symbol:r},a={order:this.safeString(n,"id"),type:this.safeString(n,"type"),side:this.safeString(n,"side")};this.handleMyTrade(e,t,a)}}if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new u(e)}this.orders.append(n),e.resolve(this.orders,i);let o=i.replace("."+a.lowercaseId,"");o=o.replace("."+a.lowercaseBaseId,""),e.resolve(this.orders,o)}parseWsOrder(e,t){const i=this.safeInteger2(e,"lastActTime","ts"),s=this.safeInteger(e,"orderCreateTime"),r=this.safeString2(e,"contract_code","symbol");t=this.safeMarket(r,t);const a=this.safeSymbol(r,t),n=this.safeString2(e,"orderSize","volume"),o=this.parseOrderStatus(this.safeString2(e,"orderStatus","status")),h=this.safeString2(e,"orderId","order_id"),d=this.safeString2(e,"clientOrderId","client_order_id"),c=this.safeString2(e,"orderPrice","price"),l=this.safeString(e,"execAmt");let u=this.safeString(e,"type");const f=this.safeString(e,"fee");let p;if(void 0!==f){const t=this.safeString(e,"fee_asset");p={cost:f,currency:this.safeCurrencyCode(t)}}const m=this.safeString(e,"trade_avg_price"),g=this.safeValue(e,"trade");void 0!==u&&(u=u.split("-"));let y=this.safeStringLower(u,1);void 0===y&&(y=this.safeString(e,"order_price_type"));let b=this.safeStringLower(u,0);void 0===b&&(b=this.safeString(e,"direction"));const v=this.safeString(e,"orderValue");return this.safeOrder({info:e,id:h,clientOrderId:d,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:i,status:o,symbol:a,type:y,timeInForce:void 0,postOnly:void 0,side:b,price:c,amount:n,filled:l,remaining:void 0,cost:v,fee:p,average:m,trades:g},t)}parseOrderTrade(e,t){const i=(t=this.safeMarket(void 0,t)).symbol,s=this.safeString(e,"tradeId"),r=this.safeString(e,"tradePrice"),a=this.safeString(e,"tradeVolume"),n=this.safeString(e,"orderId"),o=this.safeInteger(e,"tradeTime");let h,d=this.safeString(e,"type");if(void 0!==d){const e=d.split("-");h=e[0],d=e[1]}const c=this.safeValue(e,"aggressor");let l;return void 0!==c&&(l=c?"taker":"maker"),this.safeTrade({info:e,timestamp:o,datetime:this.iso8601(o),symbol:i,id:s,order:n,type:d,takerOrMaker:l,side:h,price:r,amount:a,cost:void 0,fee:void 0},t)}async watchBalance(e={}){let t=this.safeString2(this.options,"watchBalance","defaultType","spot");t=this.safeString(e,"type",t);let i,s,r,a=this.safeString2(this.options,"watchBalance","subType","linear");if(a=this.safeString(e,"subType",a),e=this.omit(e,["type","subType"]),e=this.omit(e,"type"),await this.loadMarkets(),"spot"===t){let t=this.safeString2(this.options,"watchBalance","mode","2");t=this.safeString(e,"mode",t),i="accounts.update#"+t,s=i}else{const n=this.safeString(e,"symbol"),o=this.safeString(e,"currency"),h=void 0!==n?this.market(n):void 0,d=void 0!==o?this.currency(o):void 0;r=this.safeString(e,"margin","cross"),e=this.omit(e,["currency","symbol","margin"]);let c="accounts";i=c,"linear"===a?(c="cross"===r?c+"_cross":c,i=c,"isolated"===r?void 0!==n?(i+="."+h.id,s=i):s=c+".*":void 0!==d?(s=c+"."+d.id,i=s):s=c+".*"):"future"===t?void 0!==d?(i+="."+d.id,s=i):s=c+".*":void 0!==h?(i+="."+h.id,s=i):s=c+".*"}const n={type:t,subType:a,margin:r};return await this.subscribePrivate(s,i,t,a,e,n)}handleBalance(e,t){const i=this.safeString(t,"ch");if(void 0!==i){const s=this.safeValue(t,"data",{}),r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"available"),n.total=this.safeString(s,"balance"),this.balance[a]=n,this.balance=this.safeBalance(this.balance),e.resolve(this.balance,i)}else{const i=this.safeValue(t,"data",[]);if(0===i.length)return;const s=this.safeValue(i,0,{});let r=this.safeString(t,"topic"),a=this.safeValue2(e.subscriptions,r,r+".*");if(void 0===a){r+="."+this.safeString(s,"margin_asset").toLowerCase(),a=this.safeValue(e.subscriptions,r)}const n=this.safeString(a,"type");if("linear"===this.safeString(a,"subType")){if("cross"===this.safeString(a,"margin")){const e="future"===n?"futures_contract_detail":"contract_detail",t=this.safeValue(s,e,[]);if(t.length>0)for(let e=0;e<t.length;e++){const i=t[e],s=this.safeString2(i,"contract_code","margin_account"),r=this.safeMarket(s),a=this.safeString(i,"margin_asset"),n=this.safeCurrency(a),o=this.safeString(r,"settle",n.code);if(void 0!==o){const e=this.account();e.free=this.safeString2(i,"margin_balance","margin_available"),e.used=this.safeString(i,"margin_frozen");const t={};t[o]=e;const s=r.symbol;this.balance[s]=this.safeBalance(t)}}}else for(let e=0;e<i.length;e++){const t=i[e],s=this.account();s.free=this.safeString(t,"margin_balance","margin_available"),s.used=this.safeString(t,"margin_frozen");const r=this.safeString2(t,"margin_asset","symbol"),a=this.safeCurrencyCode(r);this.balance[a]=s,this.balance=this.safeBalance(this.balance)}}else for(let e=0;e<i.length;e++){const t=i[e],s=this.safeString(t,"symbol"),r=this.safeCurrencyCode(s),a=this.account();a.free=this.safeString(t,"margin_available"),a.used=this.safeString(t,"margin_frozen"),this.balance[r]=a,this.balance=this.safeBalance(this.balance)}e.resolve(this.balance,r)}}handleSubscriptionStatus(e,t){const i=this.safeString(t,"id"),s=this.indexBy(e.subscriptions,"id"),r=this.safeValue(s,i);if(void 0!==r){const s=this.safeValue(r,"method");if(void 0!==s)return s.call(this,e,t,r);i in e.subscriptions&&delete e.subscriptions[i]}return t}handleSystemStatus(e,t){return t}handleSubject(e,t){const i=this.safeValue(t,"ch",""),s=i.split(".");if("market"===this.safeString(s,0)){const i=this.safeString(s,2),r={depth:this.handleOrderBook,mbp:this.handleOrderBook,detail:this.handleTicker,bbo:this.handleTicker,ticker:this.handleTicker,trade:this.handleTrades,kline:this.handleOHLCV},a=this.safeValue(r,i);return void 0===a?t:a.call(this,e,t)}const r=i.split("#"),a=this.safeString(r,0,"");if("trade.clearing"===a)return void this.handleMyTrade(e,t);if(-1!==a.indexOf("accounts.update"))return void this.handleBalance(e,t);if("orders"===a)return void this.handleOrder(e,t);if("notify"===this.safeString(t,"op")){const i=this.safeString(t,"topic","");-1!==i.indexOf("orders")&&this.handleOrder(e,t),-1!==i.indexOf("account")&&this.handleBalance(e,t)}}async pong(e,t){const i=this.safeInteger(t,"ping");if(void 0!==i)return void await e.send({pong:i});if("ping"===this.safeString(t,"action")){const i=this.safeValue(t,"data"),s=this.safeInteger(i,"ts");return void await e.send({action:"pong",data:{ts:s}})}if("ping"===this.safeString(t,"op")){const i=this.safeInteger(t,"ts");await e.send({op:"pong",ts:i})}}handlePing(e,t){this.spawn(this.pong,e,t)}handleAuthenticate(e,t){return e.resolve(t,"auth"),t}handleErrorMessage(e,t){if("error"===this.safeString(t,"status")){const i=this.safeString(t,"id"),s=this.indexBy(e.subscriptions,"id"),r=this.safeValue(s,i);if(void 0!==r){const s=this.safeString(t,"err-code");try{this.throwExactlyMatchedException(this.exceptions.ws.exact,s,this.json(t))}catch(t){const s=this.safeString(r,"messageHash");e.reject(t,s),e.reject(t,i),i in e.subscriptions&&delete e.subscriptions[i]}}return!1}const i=this.safeInteger(t,"code");if(void 0!==i&&200!==i){const s=this.id+" "+this.json(t);try{this.throwExactlyMatchedException(this.exceptions.ws.exact,i,s)}catch(t){if(t instanceof d){e.reject(t,"auth");const i="auth";return i in e.subscriptions&&delete e.subscriptions[i],!1}e.reject(t)}}return t}handleMessage(e,t){if(this.handleErrorMessage(e,t)){if("id"in t)return void this.handleSubscriptionStatus(e,t);if("action"in t){const i=this.safeString(t,"action");if("ping"===i)return void this.handlePing(e,t);if("sub"===i)return void this.handleSubscriptionStatus(e,t)}if("ch"in t)return"auth"===t.ch?void this.handleAuthenticate(e,t):void this.handleSubject(e,t);if("op"in t){const i=this.safeString(t,"op");if("ping"===i)return void this.handlePing(e,t);if("auth"===i)return void this.handleAuthenticate(e,t);if("sub"===i)return void this.handleSubscriptionStatus(e,t);if("notify"===i)return void this.handleSubject(e,t)}"ping"in t&&this.handlePing(e,t)}}handleMyTrade(e,t,i={}){if(void 0===this.myTrades){const e=this.safeInteger(this.options,"tradesLimit",1e3);this.myTrades=new u(e)}const s=this.myTrades,r=this.safeString(t,"ch");if(void 0!==r){const a=this.safeValue(t,"data");if(void 0!==a){const t=this.parseWsTrade(a);void 0!==this.safeString(t,"symbol")&&(s.append(t),e.resolve(this.myTrades,r))}else{const a=this.safeValue(t,"trades",[]),n=this.safeValue(t,"symbol"),o=this.market(n);for(let e=0;e<a.length;e++){const t=a[e];let r=this.parseTrade(t,o);r=this.extend(r,i),s.append(r)}const h=r+":trade";e.resolve(this.myTrades,h);let d=r.replace("."+o.lowercaseId,"");d=d.replace("."+o.lowercaseBaseId,"");const c=d+":trade";e.resolve(this.myTrades,c)}}}parseWsTrade(e){const t=this.safeSymbol(this.safeString(e,"symbol")),i=this.safeString2(e,"side","orderSide"),s=this.safeString(e,"tradeId"),r=this.safeString(e,"tradePrice"),a=this.safeString(e,"tradeVolume"),n=this.safeString(e,"orderId"),o=this.safeInteger(e,"tradeTime"),h=this.market(t);let d=this.safeString(e,"orderType");const c=this.safeValue(e,"aggressor");let l,u,f;void 0!==c&&(l=c?"taker":"maker"),void 0!==d&&(d=d.split("-"),u=this.safeString(d,1));const p=this.safeCurrencyCode(this.safeString(e,"feeCurrency"));return void 0!==p&&(f={cost:this.safeString(e,"transactFee"),currency:p}),this.safeTrade({info:e,timestamp:o,datetime:this.iso8601(o),symbol:t,id:s,order:n,type:u,takerOrMaker:l,side:i,price:r,amount:a,cost:void 0,fee:f},h)}getUrlByMarketType(e,t=!0,i=!1){const s=this.safeString(this.options,"api","api"),r={hostname:this.hostname};let a,n;if("spot"===e)a=i?this.urls.api.ws[s].spot.private:this.urls.api.ws[s].spot.public,n=this.implodeParams(a,r);else{const r=this.urls.api.ws[s][e],a=t?r.linear:r.inverse;n=i?a.private:a.public}return n}async subscribePublic(e,t,i,s,r={}){const a=this.requestId(),n={sub:i,id:a},o={id:a,messageHash:i,symbol:t,params:r};return void 0!==s&&(o.method=s),await this.watch(e,i,this.extend(n,r),i,o)}async subscribePrivate(e,t,i,s,r={},a={}){const n=this.nonce(),o={id:n,messageHash:t,params:r},h=this.extend(o,a);let d;d="spot"===i?{action:"sub",ch:e}:{op:"sub",topic:e,cid:n};const c="linear"===s,l=this.getUrlByMarketType(i,c,!0),u={type:i,url:l,hostname:"spot"===i?this.urls.hostnames.spot:this.urls.hostnames.contract};return"spot"===i&&(this.options.ws.gunzip=!1),await this.authenticate(u),await this.watch(l,t,this.extend(d,r),e,h)}async authenticate(e={}){const t=this.safeString(e,"url"),i=this.safeString(e,"hostname"),s=this.safeString(e,"type");if(void 0===t||void 0===i||void 0===s)throw new n(this.id+" authenticate requires a url, hostname and type argument");this.checkRequiredCredentials();const r="auth",a=t.replace("wss://"+i,""),o=this.client(t);let h=this.safeValue(o.subscriptions,r);if(void 0===h){h=o.future(r);const e=this.ymdhms(this.milliseconds(),"T");let n;n="spot"===s?{accessKey:this.apiKey,signatureMethod:"HmacSHA256",signatureVersion:"2.1",timestamp:e}:{AccessKeyId:this.apiKey,SignatureMethod:"HmacSHA256",SignatureVersion:"2",Timestamp:e},n=this.keysort(n);const d=["GET",i,a,this.urlencode(n)].join("\n"),c=this.hmac(this.encode(d),this.encode(this.secret),"sha256","base64");let l;if("spot"===s){l={params:{authType:"api",accessKey:this.apiKey,signatureMethod:"HmacSHA256",signatureVersion:"2.1",timestamp:e,signature:c},action:"req",ch:r}}else l={op:r,type:"api",AccessKeyId:this.apiKey,SignatureMethod:"HmacSHA256",SignatureVersion:"2",Timestamp:e,Signature:c};await this.watch(t,r,l,r,h)}return await h}}},90396:function(e,t,i){"use strict";const s=i(54072),{ExchangeError:r}=i(73449),{ArrayCache:a,ArrayCacheByTimestamp:n}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchOrderBook:!0,watchTickers:!1,watchTicker:!0,watchTrades:!0,watchBalance:!1,watchOHLCV:!0},urls:{api:{ws:{api:{public:"wss://{hostname}/ws",private:"wss://{hostname}/ws/v2"}}}},options:{tradesLimit:1e3,OHLCVLimit:1e3,api:"api",ws:{gunzip:!0}}})}requestId(){const e=this.sum(this.safeInteger(this.options,"requestId",0),1);return this.options.requestId=e,e.toString()}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e);e=i.symbol;const s="market."+i.id+".detail",r=this.safeString(this.options,"api","api"),a={hostname:this.hostname},n=this.implodeParams(this.urls.api.ws[r].public,a),o=this.requestId(),h={sub:s,id:o},d={id:o,messageHash:s,symbol:e,params:t};return await this.watch(n,s,this.extend(h,t),s,d)}handleTicker(e,t){const i=this.safeValue(t,"tick",{}),s=this.safeString(t,"ch"),r=s.split("."),a=this.safeString(r,1),n=this.safeMarket(a),o=this.parseTicker(i,n),h=this.safeValue(t,"ts");o.timestamp=h,o.datetime=this.iso8601(h);const d=o.symbol;return this.tickers[d]=o,e.resolve(o,s),t}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);e=r.symbol;const a="market."+r.id+".trade.detail",n=this.safeString(this.options,"api","api"),o={hostname:this.hostname},h=this.implodeParams(this.urls.api.ws[n].public,o),d=this.requestId(),c={sub:a,id:d},l={id:d,messageHash:a,symbol:e,params:s},u=await this.watch(h,a,this.extend(c,s),a,l);return this.newUpdates&&(i=u.getLimit(e,i)),this.filterBySinceLimit(u,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeValue(t,"tick",{}),s=this.safeValue(i,"data",{}),r=this.safeString(t,"ch"),n=r.split("."),o=this.safeString(n,1),h=this.safeMarket(o),d=h.symbol;let c=this.safeValue(this.trades,d);if(void 0===c){const e=this.safeInteger(this.options,"tradesLimit",1e3);c=new a(e),this.trades[d]=c}for(let e=0;e<s.length;e++){const t=this.parseTrade(s[e],h);c.append(t)}return e.resolve(c,r),t}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;const n=this.safeString(this.timeframes,t,t),o="market."+a.id+".kline."+n,h=this.safeString(this.options,"api","api"),d={hostname:this.hostname},c=this.implodeParams(this.urls.api.ws[h].public,d),l=this.requestId(),u={sub:o,id:l},f={id:l,messageHash:o,symbol:e,timeframe:t,params:r},p=await this.watch(c,o,this.extend(u,r),o,f);return this.newUpdates&&(s=p.getLimit(e,s)),this.filterBySinceLimit(p,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeString(t,"ch"),s=i.split("."),r=this.safeString(s,1),a=this.safeMarket(r),o=a.symbol,h=this.safeString(s,3),d=this.findTimeframe(h);this.ohlcvs[o]=this.safeValue(this.ohlcvs,o,{});let c=this.safeValue(this.ohlcvs[o],d);if(void 0===c){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);c=new n(e),this.ohlcvs[o][d]=c}const l=this.safeValue(t,"tick"),u=this.parseOHLCV(l,a);c.append(u),e.resolve(c,i)}async watchOrderBook(e,t,i={}){if(void 0!==t&&150!==t)throw new r(this.id+" watchOrderBook accepts limit = 150 only");await this.loadMarkets();const s=this.market(e);e=s.symbol,t=void 0===t?150:t;const a="market."+s.id+".mbp."+t.toString(),n=this.safeString(this.options,"api","api"),o={hostname:this.hostname},h=this.implodeParams(this.urls.api.ws[n].public,o),d=this.requestId(),c={sub:a,id:d},l={id:d,messageHash:a,symbol:e,limit:t,params:i,method:this.handleOrderBookSubscription};return(await this.watch(h,a,this.extend(c,i),a,l)).limit()}handleOrderBookSnapshot(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeString(i,"messageHash"),a=this.orderbooks[s],n=this.safeValue(t,"data"),o=this.parseOrderBook(n,s);o.nonce=this.safeInteger(n,"seqNum"),a.reset(o);const h=a.cache;for(let t=0;t<h.length;t++){const i=h[t];this.handleOrderBookMessage(e,i,a)}this.orderbooks[s]=a,e.resolve(a,r)}async watchOrderBookSnapshot(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeInteger(i,"limit"),a=this.safeValue(i,"params"),n=this.safeString(i,"messageHash"),o=this.safeString(this.options,"api","api"),h={hostname:this.hostname},d=this.implodeParams(this.urls.api.ws[o].public,h),c=this.requestId(),l={req:n,id:c},u={id:c,messageHash:n,symbol:s,limit:r,params:a,method:this.handleOrderBookSnapshot};return(await this.watch(d,c,l,c,u)).limit()}handleDelta(e,t){const i=this.safeFloat(t,0),s=this.safeFloat(t,1);e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleOrderBookMessage(e,t,i){const s=this.safeValue(t,"tick",{}),r=this.safeInteger(s,"seqNum");if(this.safeInteger(s,"prevSeqNum")<=i.nonce&&r>i.nonce){const e=this.safeValue(s,"asks",[]),a=this.safeValue(s,"bids",[]);this.handleDeltas(i.asks,e),this.handleDeltas(i.bids,a),i.nonce=r;const n=this.safeInteger(t,"ts");i.timestamp=n,i.datetime=this.iso8601(n)}return i}handleOrderBook(e,t){const i=this.safeString(t,"ch"),s=this.safeValue(t,"ch").split("."),r=this.safeString(s,1),a=this.safeSymbol(r),n=this.orderbooks[a];void 0===n.nonce?n.cache.push(t):(this.handleOrderBookMessage(e,t,n),e.resolve(n,i))}handleOrderBookSubscription(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeInteger(i,"limit");s in this.orderbooks&&delete this.orderbooks[s],this.orderbooks[s]=this.orderBook({},r),this.spawn(this.watchOrderBookSnapshot,e,t,i)}handleSubscriptionStatus(e,t){const i=this.safeString(t,"id"),s=this.indexBy(e.subscriptions,"id"),r=this.safeValue(s,i);if(void 0!==r){const s=this.safeValue(r,"method");if(void 0!==s)return s.call(this,e,t,r);i in e.subscriptions&&delete e.subscriptions[i]}return t}handleSystemStatus(e,t){return t}handleSubject(e,t){const i=this.safeValue(t,"ch").split(".");if("market"===this.safeString(i,0)){const s=this.safeString(i,2),r={mbp:this.handleOrderBook,detail:this.handleTicker,trade:this.handleTrades,kline:this.handleOHLCV},a=this.safeValue(r,s);return void 0===a?t:a.call(this,e,t)}}async pong(e,t){await e.send({pong:this.safeInteger(t,"ping")})}handlePing(e,t){this.spawn(this.pong,e,t)}handleErrorMessage(e,t){if("error"===this.safeString(t,"status")){const i=this.safeString(t,"id"),s=this.indexBy(e.subscriptions,"id"),r=this.safeValue(s,i);if(void 0!==r){const s=this.safeString(t,"err-code");try{this.throwExactlyMatchedException(this.exceptions.exact,s,this.json(t))}catch(t){const s=this.safeString(r,"messageHash");e.reject(t,s),e.reject(t,i),i in e.subscriptions&&delete e.subscriptions[i]}}return!1}return t}handleMessage(e,t){this.handleErrorMessage(e,t)&&("id"in t?this.handleSubscriptionStatus(e,t):"ch"in t?this.handleSubject(e,t):"ping"in t&&this.handlePing(e,t))}}},50483:function(e,t,i){"use strict";const s=i(85225);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{alias:!0,id:"huobipro"})}}},94436:function(e,t,i){"use strict";const s=i(22574),{InvalidNonce:r}=i(73449),{ArrayCache:a,ArrayCacheByTimestamp:n,ArrayCacheBySymbolById:o}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchOrderBook:!0,watchTrades:!0,watchOHLCV:!0,watchTicker:!0,watchTickers:!1,watchOrders:!0,watchTransactions:!0},urls:{test:{ws:"wss://websocket-matic.idex.io/v1"},api:{}},options:{tradesLimit:1e3,ordersLimit:1e3,OHLCVLimit:1e3,watchOrderBookLimit:1e3,orderBookSubscriptions:{},token:void 0,fetchOrderBookSnapshotMaxAttempts:10,fetchOrderBookSnapshotMaxDelay:1e4}})}async subscribe(e,t,i=!0){const s=this.urls.test.ws,r={method:"subscribe",subscriptions:[e]};return await this.watch(s,t,r,t,i)}async subscribePrivate(e,t){const i=await this.authenticate(),s=this.urls.test.ws,r={method:"subscribe",token:i,subscriptions:[e]};return await this.watch(s,t,r,t)}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s="tickers",r={name:s,markets:[i.id]},a=s+":"+i.id;return await this.subscribe(this.extend(r,t),a)}handleTicker(e,t){const i=this.safeString(t,"type"),s=this.safeValue(t,"data"),r=this.safeString(s,"m"),a=this.safeSymbol(r),n=i+":"+r,o=this.safeInteger(s,"t"),h=this.safeFloat(s,"c"),d=this.safeFloat(s,"P");let c;void 0!==d&&void 0!==h&&(c=h*d);const l={symbol:a,timestamp:o,datetime:this.iso8601(o),high:this.safeFloat(s,"h"),low:this.safeFloat(s,"l"),bid:this.safeFloat(s,"b"),bidVolume:void 0,ask:this.safeFloat(s,"a"),askVolume:void 0,vwap:void 0,open:this.safeFloat(s,"o"),close:h,last:h,previousClose:void 0,change:c,percentage:d,average:void 0,baseVolume:this.safeFloat(s,"v"),quoteVolume:this.safeFloat(s,"q"),info:t};e.resolve(l,n)}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);e=r.symbol;const a="trades",n={name:a,markets:[r.id]},o=a+":"+r.id,h=await this.subscribe(n,o);return this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySinceLimit(h,t,i,"timestamp",!0)}handleTrade(e,t){const i=this.safeString(t,"type"),s=this.safeValue(t,"data"),r=i+":"+this.safeString(s,"m"),a=this.parseWsTrade(s);if(0===Object.keys(this.trades).length){const e=this.safeInteger(this.options,"tradesLimit");this.trades=new o(e)}const n=this.trades;n.append(a),e.resolve(n,r)}parseWsTrade(e){const t=this.safeString(e,"m"),i=this.safeSymbol(t),s=this.safeString(e,"i"),r=this.safeFloat(e,"p"),a=this.safeFloat(e,"q"),n=this.safeFloat(e,"Q"),o=this.safeInteger(e,"t"),h=this.safeString(e,"s"),d={currency:this.safeString(e,"a"),cost:this.safeFloat(e,"f")},c=this.safeString(e,"l");return{info:e,timestamp:o,datetime:this.iso8601(o),symbol:i,id:s,order:void 0,type:void 0,takerOrMaker:c,side:h,price:r,amount:a,cost:n,fee:d}}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;const n="candles",o=this.safeString(this.timeframes,t,t),h={name:n,markets:[a.id],interval:o},d=n+":"+a.id,c=await this.subscribe(h,d);return this.newUpdates&&(s=c.getLimit(e,s)),this.filterBySinceLimit(c,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeString(t,"type"),s=this.safeValue(t,"data"),r=this.safeString(s,"m"),a=i+":"+r,o=[this.safeInteger(s,"s"),this.safeFloat(s,"o"),this.safeFloat(s,"h"),this.safeFloat(s,"l"),this.safeFloat(s,"c"),this.safeFloat(s,"v")],h=this.safeSymbol(r),d=this.safeString(s,"i"),c=this.findTimeframe(d);this.ohlcvs[h]=this.safeValue(this.ohlcvs,h,{});let l=this.safeValue(this.ohlcvs[h],c);if(void 0===l){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);l=new n(e),this.ohlcvs[h][c]=l}l.append(o),e.resolve(l,a)}handleSubscribeMessage(e,t){const i=this.safeValue(t,"subscriptions");for(let t=0;t<i.length;t++){const s=i[t];if("l2orderbook"===this.safeString(s,"name")){const t=this.safeValue(s,"markets");for(let i=0;i<t.length;i++){const s=t[i];if(!(s in this.safeValue(this.options,"orderBookSubscriptions",{}))){const t=this.safeSymbol(s);if(!(t in this.orderbooks)){const e=this.countedOrderBook({});e.cache=[],this.orderbooks[t]=e}this.spawn(this.fetchOrderBookSnapshot,e,t)}}break}}}async fetchOrderBookSnapshot(e,t,i={}){const s=this.orderbooks[t],a="l2orderbook:"+this.market(t).id,n=e.subscriptions[a];n.fetchingOrderBookSnapshot||(n.startTime=this.milliseconds()),n.fetchingOrderBookSnapshot=!0;const o=this.safeInteger(this.options,"fetchOrderBookSnapshotMaxAttempts",10),h=this.safeInteger(this.options,"fetchOrderBookSnapshotMaxDelay",1e4);try{const i=this.safeInteger(n,"limit",0),d=await this.fetchOrderBook(t,i),c=this.safeValue(s.cache,0),l=this.safeValue(c,"data"),u=this.safeInteger(l,"u"),f=s.cache.length,p=this.safeValue(s.cache,f-1),m=this.safeValue(p,"data"),g=this.safeInteger(m,"u");if(void 0!==u&&void 0!==g&&u<=d.nonce+1&&g>d.nonce){s.reset(d);for(let t=0;t<s.cache.length;t++){const i=s.cache[t],r=this.safeValue(i,"data");this.safeInteger(r,"u")>s.nonce&&this.handleOrderBookMessage(e,i,s)}n.fetchingOrderBookSnapshot=!1,e.resolve(s,a)}else{n.numAttempts=n.numAttempts+1;const i=this.milliseconds()-n.startTime,s=n.numAttempts<o;if(!s||!(i<h)){const e=s?" after "+h.toString()+" milliseconds":" in "+o.toString()+" attempts";throw new r(this.id+" failed to synchronize WebSocket feed with the snapshot for symbol "+t+e)}this.delay(this.rateLimit,this.fetchOrderBookSnapshot,e,t)}}catch(t){n.fetchingOrderBookSnapshot=!1,e.reject(t,a)}}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r="l2orderbook",a={name:r,markets:[s.id]},n=r+":"+s.id,o={fetchingOrderBookSnapshot:!1,numAttempts:0,startTime:void 0};o.limit=void 0===t?1e3:t;return(await this.subscribe(a,n,o)).limit()}handleOrderBook(e,t){const i=this.safeValue(t,"data"),s=this.safeString(i,"m"),r=this.safeSymbol(s),a=this.orderbooks[r];void 0===a.nonce?a.cache.push(t):this.handleOrderBookMessage(e,t,a)}handleOrderBookMessage(e,t,i){const s=this.safeString(t,"type"),r=this.safeValue(t,"data"),a=s+":"+this.safeString(r,"m"),n=this.safeInteger(r,"u"),o=this.safeInteger(r,"t"),h=this.safeValue(r,"b"),d=this.safeValue(r,"a");this.handleDeltas(i.bids,h),this.handleDeltas(i.asks,d),i.nonce=n,i.timestamp=o,i.datetime=this.iso8601(o),e.resolve(i,a)}handleDelta(e,t){const i=this.safeFloat(t,0),s=this.safeFloat(t,1),r=this.safeInteger(t,2);e.store(i,s,r)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}async authenticate(e={}){const t=this.seconds();if(t-this.safeInteger(this.options,"lastAuthenticatedTime",0)>900){const i={wallet:this.walletAddress,nonce:this.uuidv1()},s=await this.privateGetWsToken(this.extend(i,e));this.options.lastAuthenticatedTime=t,this.options.token=this.safeString(s,"token")}return this.options.token}async watchOrders(e,t,i,s={}){await this.loadMarkets();const r="orders",a={name:r};let n=r;if(void 0!==e){e=this.symbol(e);const t=this.marketId(e);a.markets=[t],n=r+":"+t}const o=await this.subscribePrivate(a,n);return this.newUpdates&&(i=o.getLimit(e,i)),this.filterBySinceLimit(o,t,i,"timestamp",!0)}handleOrder(e,t){const i=this.safeString(t,"type"),s=this.safeValue(t,"data"),r=this.safeString(s,"m"),a=this.safeSymbol(r),n=this.safeInteger(s,"t"),h=this.safeValue(s,"F"),d=[];for(let e=0;e<h.length;e++)d.push(this.parseWsTrade(h[e]));const c=this.safeString(s,"i"),l=this.safeString(s,"s"),u=this.safeString(s,"o"),f=this.safeFloat(s,"q"),p=this.safeFloat(s,"z");let m;void 0!==f&&void 0!==p&&(m=f-p);const g=this.safeFloat(s,"v"),y=this.safeFloat(s,"price",g);let b;void 0!==f&&void 0!==y&&(b=f*y);const v=this.safeString(s,"X"),w=this.parseOrderStatus(v),S={currency:void 0,cost:void 0};let k;for(let e=0;e<d.length;e++)k=d[e],S.currency=k.fee.currency,S.cost=this.sum(S.cost,k.fee.cost);const T=this.safeInteger(k,"timestamp"),_={info:t,id:c,clientOrderId:void 0,timestamp:n,datetime:this.iso8601(n),lastTradeTimestamp:T,symbol:a,type:u,side:l,price:y,stopPrice:void 0,triggerPrice:void 0,amount:f,cost:b,average:g,filled:p,remaining:m,status:w,fee:S,trades:d};if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new o(e)}const O=this.orders;O.append(_);const M=i+":"+r;e.resolve(O,M),e.resolve(O,i)}async watchTransactions(e,t,i,s={}){await this.loadMarkets();const r="balances",a={name:r};let n=r;void 0!==e&&(n=r+":"+e);const o=await this.subscribePrivate(a,n);return this.newUpdates&&(i=o.getLimit(e,i)),this.filterBySinceLimit(o,t,i,"timestamp",!0)}handleTransaction(e,t){const i=this.safeString(t,"type"),s=this.safeValue(t,"data"),r=this.safeString(s,"a"),n=i+":"+r,o=this.safeCurrencyCode(r),h={info:t,id:void 0,currency:o,amount:void 0,address:this.safeString(s,"w"),addressTo:void 0,addressFrom:void 0,tag:void 0,tagTo:void 0,tagFrom:void 0,status:"ok",type:void 0,updated:void 0,txid:void 0,timestamp:void 0,datetime:void 0,fee:void 0};if(!(o in this.transactions)){const e=this.safeInteger(this.options,"transactionsLimit",1e3);this.transactions[o]=new a(e)}const d=this.transactions[o];d.append(h),e.resolve(d,n),e.resolve(d,i)}handleMessage(e,t){const i=this.safeString(t,"type"),s={tickers:this.handleTicker,trades:this.handleTrade,subscriptions:this.handleSubscribeMessage,candles:this.handleOHLCV,l2orderbook:this.handleOrderBook,balances:this.handleTransaction,orders:this.handleOrder};if(i in s){s[i].call(this,e,t)}}}},75905:function(e,t,i){"use strict";const s=i(66594),{BadSymbol:r,BadRequest:a,ExchangeError:n,NotSupported:o,InvalidNonce:h}=i(73449),{ArrayCache:d,ArrayCacheByTimestamp:c,ArrayCacheBySymbolById:l}=i(56062),u=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!1,watchMyTrades:!0,watchOHLCV:!0,watchOrderBook:!0,watchOrders:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0},urls:{api:{ws:{public:"wss://ws.kraken.com",private:"wss://ws-auth.kraken.com",beta:"wss://beta-ws.kraken.com"}}},options:{tradesLimit:1e3,OHLCVLimit:1e3,ordersLimit:1e3,symbolsByOrderId:{},checksum:!0},exceptions:{ws:{exact:{"Event(s) not found":a},broad:{"Currency pair not in ISO 4217-A3 format":r}}}})}handleTicker(e,t,i){const s=t[3],r="ticker:"+s,a=this.safeValue(this.options.marketsByWsName,s).symbol,n=t[1],o=this.safeFloat(n.p,0);let h;const d=this.safeFloat(n.v,0);void 0!==d&&void 0!==o&&(h=d*o);const c=this.safeFloat(n.c,0),l=this.milliseconds(),u={symbol:a,timestamp:l,datetime:this.iso8601(l),high:this.safeFloat(n.h,0),low:this.safeFloat(n.l,0),bid:this.safeFloat(n.b,0),bidVolume:this.safeFloat(n.b,2),ask:this.safeFloat(n.a,0),askVolume:this.safeFloat(n.a,2),vwap:o,open:this.safeFloat(n.o,0),close:c,last:c,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:d,quoteVolume:h,info:n};this.tickers[a]=u,e.resolve(u,r)}handleTrades(e,t,i){const s=this.safeString(t,3),r=this.safeString(t,2)+":"+s,a=this.safeValue(this.options.marketsByWsName,s),n=a.symbol;let o=this.safeValue(this.trades,n);if(void 0===o){const e=this.safeInteger(this.options,"tradesLimit",1e3);o=new d(e),this.trades[n]=o}const h=this.safeValue(t,1,[]),c=this.parseTrades(h,a);for(let e=0;e<c.length;e++)o.append(c[e]);e.resolve(o,r)}handleOHLCV(e,t,i){const s=this.safeValue(i,"subscription",{}),r=this.safeInteger(s,"interval"),a=this.safeString(s,"name"),n=this.safeString(t,3),o=this.safeValue(this.options.marketsByWsName,n).symbol,h=this.findTimeframe(r),d=this.parseTimeframe(h);if(void 0!==h){const i=this.safeValue(t,1),s=a+":"+h+":"+n;let r=this.safeFloat(i,1);r-=d;const l=[parseInt(1e3*r),this.safeFloat(i,2),this.safeFloat(i,3),this.safeFloat(i,4),this.safeFloat(i,5),this.safeFloat(i,7)];this.ohlcvs[o]=this.safeValue(this.ohlcvs,o,{});let u=this.safeValue(this.ohlcvs[o],h);if(void 0===u){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);u=new c(e),this.ohlcvs[o][h]=u}u.append(l),e.resolve(u,s)}}requestId(){const e=this.sum(this.safeInteger(this.options,"reqid",0),1);return this.options.reqid=e,e}async watchPublic(e,t,i={}){await this.loadMarkets();const s=this.market(t),r=this.safeValue(s.info,"wsname"),a=e+":"+r,n=this.urls.api.ws.public,o={event:"subscribe",reqid:this.requestId(),pair:[r],subscription:{name:e}},h=this.deepExtend(o,i);return await this.watch(n,a,h,a)}async watchTicker(e,t={}){return await this.watchPublic("ticker",e,t)}async watchTrades(e,t,i,s={}){await this.loadMarkets(),e=this.symbol(e);const r=await this.watchPublic("trade",e,s);return this.newUpdates&&(i=r.getLimit(e,i)),this.filterBySinceLimit(r,t,i,"timestamp",!0)}async watchOrderBook(e,t,i={}){const s={};if(void 0!==t){if(10!==t&&25!==t&&100!==t&&500!==t&&1e3!==t)throw new o(this.id+" watchOrderBook accepts limit values of 10, 25, 100, 500 and 1000 only");s.subscription={depth:t}}return(await this.watchPublic("book",e,this.extend(s,i))).limit()}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a="ohlc",n=this.market(e);e=n.symbol;const o=this.safeValue(n.info,"wsname"),h=a+":"+t+":"+o,d=this.urls.api.ws.public,c={event:"subscribe",reqid:this.requestId(),pair:[o],subscription:{name:a,interval:this.safeString(this.timeframes,t,t)}},l=this.deepExtend(c,r),u=await this.watch(d,h,l,h);return this.newUpdates&&(s=u.getLimit(e,s)),this.filterBySinceLimit(u,i,s,0,!0)}async loadMarkets(e=!1,t={}){const i=await super.loadMarkets(e,t);let s=this.safeValue(this.options,"marketsByWsName");if(void 0===s||e){s={};for(let e=0;e<this.symbols.length;e++){const t=this.symbols[e],i=this.markets[t];if(i.darkpool){const e=this.safeValue(i,"info",{}),t=this.safeString(e,"altname");s[t.slice(0,3)+"/"+t.slice(3)]=i}else{const e=this.safeValue(i,"info",{});s[this.safeString(e,"wsname")]=i}}this.options.marketsByWsName=s}return i}async watchHeartbeat(e={}){await this.loadMarkets();const t=this.urls.api.ws.public;return await this.watch(t,"heartbeat")}handleHeartbeat(e,t){const i=this.safeString(t,"event");e.resolve(t,i)}handleOrderBook(e,t,i){const s=t.length,r=t[s-1],a=t[s-2].split("-"),n=this.safeInteger(a,1,10),o=this.safeValue(this.options.marketsByWsName,r).symbol;let d;const c="book:"+r;if("as"in t[1]){this.orderbooks[o]=this.orderBook({},n);const i=this.orderbooks[o],s={as:"asks",bs:"bids"},r=Object.keys(s);for(let e=0;e<r.length;e++){const a=r[e],n=i[s[a]],o=this.safeValue(t[1],a,[]);d=this.handleDeltas(n,o,d)}i.symbol=o,i.timestamp=d,i.datetime=this.iso8601(d),e.resolve(i,c)}else{const i=this.orderbooks[o];let r,a,n;5===s?(r=this.safeValue(t[1],"a",[]),a=this.safeValue(t[2],"b",[]),n=this.safeInteger(t[1],"c"),n=this.safeInteger(t[2],"c",n)):(n=this.safeInteger(t[1],"c"),"a"in t[1]?r=this.safeValue(t[1],"a",[]):a=this.safeValue(t[1],"b",[]));const l=i.asks,u=i.bids;let f;void 0!==r&&(d=this.handleDeltas(l,r,d),f=this.safeValue(r,0)),void 0!==a&&(d=this.handleDeltas(u,a,d),f=this.safeValue(a,0)),i.limit();if(this.safeValue(this.options,"checksum",!0)){const t=this.safeString(f,0),i=this.safeString(f,1),s=t.split("."),r=i.split("."),a=s[1].length-0,o=r[1].length-0,d=[];if(void 0!==n){for(let e=0;e<10;e++){const t=this.formatNumber(l[e][0],a)+this.formatNumber(l[e][1],o);d.push(t)}for(let e=0;e<10;e++){const t=this.formatNumber(u[e][0],a)+this.formatNumber(u[e][1],o);d.push(t)}}const p=d.join("");if(this.crc32(p,!1)!==n){const t=new h(this.id+" invalid checksum");e.reject(t,c)}}i.symbol=o,i.timestamp=d,i.datetime=this.iso8601(d),e.resolve(i,c)}}formatNumber(e,t){const i=this.numberToString(e).split("."),s=this.safeString(i,0)+this.safeString(i,1,"").padEnd(t,"0");let r=0;for(;"0"===s[r];)r+=1;return r>0?s.slice(r):s}handleDeltas(e,t,i){for(let s=0;s<t.length;s++){const r=t[s],a=parseFloat(r[0]),n=parseFloat(r[1]),o=i||0;i=Math.max(o,parseInt(1e3*parseFloat(r[2]))),e.store(a,n)}return i}handleSystemStatus(e,t){return t}async authenticate(e={}){const t=this.urls.api.ws.private,i=this.client(t),s="authenticated";let r=this.safeValue(i.subscriptions,s);if(void 0===r){const t=await this.privatePostGetWebSocketsToken(e);r=this.safeValue(t,"result"),i.subscriptions[s]=r}return this.safeString(r,"token")}async watchPrivate(e,t,i,s,r={}){await this.loadMarkets();const a=await this.authenticate(),n=e;let o=e;void 0!==t&&(o+=":"+(t=this.symbol(t)));const h=this.urls.api.ws.private,d={event:"subscribe",reqid:this.requestId(),subscription:{name:e,token:a}},c=this.deepExtend(d,r),l=await this.watch(h,o,c,n);return this.newUpdates&&(s=l.getLimit(t,s)),this.filterBySymbolSinceLimit(l,t,i,s,!0)}async watchMyTrades(e,t,i,s={}){return await this.watchPrivate("ownTrades",e,t,i,s)}handleMyTrades(e,t,i){const s=this.safeValue(t,0,[]);if(s.length>0){if(void 0===this.myTrades){const e=this.safeInteger(this.options,"tradesLimit",1e3);this.myTrades=new d(e)}const t=this.myTrades,i={};for(let e=0;e<s.length;e++){const r=this.safeValue(s,e,{}),a=Object.keys(r);for(let e=0;e<a.length;e++){const s=a[e],n=r[s],o=this.parseWsTrade(this.extend({id:s},n));t.append(o);i[o.symbol]=!0}}const r="ownTrades";e.resolve(this.myTrades,r);const a=Object.keys(i);for(let t=0;t<a.length;t++){const i=r+":"+a[t];e.resolve(this.myTrades,i)}}}parseWsTrade(e,t){const i=this.safeString(e,"pair");let s;t=this.safeValue(this.options.marketsByWsName,i,t);const r=this.safeString(e,"ordertxid"),a=this.safeString2(e,"id","postxid"),n=this.safeTimestamp(e,"time"),o=this.safeString(e,"type"),h=this.safeString(e,"ordertype"),d=this.safeFloat(e,"price"),c=this.safeFloat(e,"vol");let l,u;if("fee"in e){let i;void 0!==t&&(i=t.quote),u={cost:this.safeFloat(e,"fee"),currency:i}}return void 0!==t&&(s=t.symbol),void 0!==d&&void 0!==c&&(l=d*c),{id:a,order:r,info:e,timestamp:n,datetime:this.iso8601(n),symbol:s,type:h,side:o,takerOrMaker:void 0,price:d,amount:c,cost:l,fee:u}}async watchOrders(e,t,i,s={}){return await this.watchPrivate("openOrders",e,t,i,s)}handleOrders(e,t,i){const s=this.safeValue(t,0,[]);if(s.length>0){const t=this.safeInteger(this.options,"ordersLimit",1e3);void 0===this.orders&&(this.orders=new l(t));const i=this.orders,r={};for(let e=0;e<s.length;e++){const a=this.safeValue(s,e,{}),n=Object.keys(a);for(let e=0;e<n.length;e++){const s=n[e],o=a[s],h=this.parseWsOrder(o);let d;h.id=s;const c=this.safeValue(this.options,"symbolsByOrderId",{});void 0!==h.symbol?(d=h.symbol,c[s]=d,this.options.symbolsByOrderId=c):d=this.safeString(c,s);const l=this.safeValue(i.hashmap,d),u=this.safeValue(l,s);let f=h;if(void 0!==u){const e=this.extend(u.info,f.info);f=this.parseWsOrder(e),f.id=s}if(i.length===t&&void 0===u){const e=i[0];e.id in c&&delete c[e.id]}i.append(f),r[d]=!0}}const a="openOrders";e.resolve(this.orders,a);const n=Object.keys(r);for(let t=0;t<n.length;t++){const i=a+":"+n[t];e.resolve(this.orders,i)}}}parseWsOrder(e,t){const i=this.safeValue(e,"descr",{}),s=this.safeString(i,"order");let r,a,n,o,h,d;if(void 0!==s){const e=s.split(" ");r=this.safeString(e,0),h=this.safeString(e,1),n=this.safeString(e,2),a=this.safeString(e,4),o=this.safeString(e,5)}r=this.safeString(i,"type",r),a=this.safeString(i,"ordertype",a),n=this.safeString(i,"pair",n),t=this.safeValue(this.options.marketsByWsName,n,t);const c=this.safeTimestamp(e,"opentm");h=this.safeString(e,"vol",h);const l=this.safeString(e,"vol_exec");let f;const p=this.safeString(e,"cost");o=this.safeString(i,"price",o),(void 0===o||u.stringEq(o,"0.0"))&&(o=this.safeString(i,"price2")),(void 0===o||u.stringEq(o,"0.0"))&&(o=this.safeString(e,"price",o));const m=this.safeString2(e,"avg_price","price");if(void 0!==t&&(d=t.symbol,"fee"in e)){const i=e.oflags;f={cost:this.safeString(e,"fee"),rate:void 0},i.indexOf("fciq")>=0?f.currency=t.quote:i.indexOf("fcib")>=0&&(f.currency=t.base)}const g=this.parseOrderStatus(this.safeString(e,"status"));let y=this.safeString(e,"id");if(void 0===y){const t=this.safeValue(e,"txid");y=this.safeString(t,0)}const b=this.safeString(e,"userref"),v=this.safeValue(e,"trades");let w;void 0!==v&&(w=this.parseTrades(v,t,void 0,void 0,{order:y}));const S=this.safeNumber(e,"stopprice");return this.safeOrder({id:y,clientOrderId:b,info:e,timestamp:c,datetime:this.iso8601(c),lastTradeTimestamp:void 0,status:g,symbol:d,type:a,timeInForce:void 0,postOnly:void 0,side:r,price:o,stopPrice:S,triggerPrice:S,cost:p,amount:h,filled:l,average:m,remaining:void 0,fee:f,trades:w})}handleSubscriptionStatus(e,t){const i=this.safeString(t,"channelID");void 0!==i&&(e.subscriptions[i]=t)}handleErrorMessage(e,t){const i=this.safeValue(t,"errorMessage");if(void 0!==i){const s=this.safeValue(t,"reqid");if(void 0!==s){const t=this.exceptions.ws.broad,r=this.findBroadlyMatchedKey(t,i);let a;return a=void 0===r?new n(i):new t[r](i),e.reject(a,s),!1}}return!0}handleMessage(e,t){if(Array.isArray(t)){const i=this.safeString(t,0),s=this.safeValue(e.subscriptions,i,{}),r=this.safeValue(s,"subscription",{}),a=t.length,n=this.safeString(t,a-2),o=this.safeString(r,"name"),h={book:this.handleOrderBook,ohlc:this.handleOHLCV,ticker:this.handleTicker,trade:this.handleTrades,openOrders:this.handleOrders,ownTrades:this.handleMyTrades},d=this.safeValue2(h,o,n);return void 0===d?t:d.call(this,e,t,s)}if(this.handleErrorMessage(e,t)){const i=this.safeString(t,"event"),s={heartbeat:this.handleHeartbeat,systemStatus:this.handleSystemStatus,subscriptionStatus:this.handleSubscriptionStatus},r=this.safeValue(s,i);return void 0===r?t:r.call(this,e,t)}}}},37416:function(e,t,i){"use strict";const s=i(6987),{ExchangeError:r}=i(73449),{ArrayCache:a,ArrayCacheByTimestamp:n,ArrayCacheBySymbolById:o}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchOrderBook:!0,watchOrders:!0,watchMyTrades:!0,watchTickers:!1,watchTicker:!0,watchTrades:!0,watchBalance:!0,watchOHLCV:!0},options:{tradesLimit:1e3,watchTicker:{name:"market/snapshot"},watchOrderBook:{snapshotDelay:5,maxRetries:3}},streaming:{ping:this.ping}})}negotiate(e,t={}){const i=e?"private":"public",s=this.safeValue(this.options,"urls",{});return i in s||(s[i]=this.spawn(this.negotiateHelper,e,t),this.options.urls=s),s[i]}async negotiateHelper(e,t={}){let i;const s=e?"private":"public";i=e?await this.privatePostBulletPrivate(t):await this.publicPostBulletPublic(t);const r=this.safeValue(i,"data",{}),a=this.safeValue(r,"instanceServers",[]),n=this.safeValue(a,0),o=this.safeInteger(n,"pingInterval"),h=this.safeString(n,"endpoint"),d=this.safeString(r,"token"),c=h+"?"+this.urlencode({token:d,privateChannel:e,connectId:s});return this.client(c).keepAlive=o,c}requestId(){const e=this.sum(this.safeInteger(this.options,"requestId",0),1);return this.options.requestId=e,e}async subscribe(e,t,i,s,r={}){const a=this.requestId().toString(),n={id:a,type:"subscribe",topic:i,response:!0},o=this.extend(n,r),h={id:a};return s=void 0===s?h:this.extend(h,s),await this.watch(e,t,o,i,s)}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e);e=i.symbol;const s=await this.negotiate(!1),[r,a]=this.handleOptionAndParams(t,"watchTicker","method","/market/snapshot"),n=r+":"+i.id,o="ticker:"+e;return await this.subscribe(s,o,n,void 0,a)}handleTicker(e,t){const i=this.safeString(t,"topic");let s;if(void 0!==i){const e=i.split(":"),t=this.safeString(e,1);s=this.safeMarket(t,s,"-")}const r=this.safeValue(t,"data",{}),a=this.safeValue(r,"data",r),n=this.parseTicker(a,s),o=n.symbol;this.tickers[o]=n;const h="ticker:"+o;e.resolve(n,h)}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=await this.negotiate(!1),n=this.market(e);e=n.symbol;const o=this.safeString(this.timeframes,t,t),h="/market/candles:"+n.id+"_"+o,d="candles:"+e+":"+t,c=await this.subscribe(a,d,h,void 0,r);return this.newUpdates&&(s=c.getLimit(e,s)),this.filterBySinceLimit(c,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeValue(t,"data",{}),s=this.safeString(i,"symbol"),r=this.safeValue(i,"candles",[]),a=this.safeString(t,"topic").split("_"),o=this.safeString(a,1),h=this.findTimeframe(o),d=this.safeMarket(s),c=d.symbol,l="candles:"+c+":"+h;this.ohlcvs[c]=this.safeValue(this.ohlcvs,c,{});let u=this.safeValue(this.ohlcvs[c],h);if(void 0===u){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);u=new n(e),this.ohlcvs[c][h]=u}const f=this.parseOHLCV(r,d);u.append(f),e.resolve(u,l)}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=await this.negotiate(!1),a=this.market(e);e=a.symbol;const n="/market/match:"+a.id,o="trades:"+e,h=await this.subscribe(r,o,n,void 0,s);return this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySinceLimit(h,t,i,"timestamp",!0)}handleTrade(e,t){const i=this.safeValue(t,"data",{}),s=this.parseTrade(i),r=s.symbol,n="trades:"+r;let o=this.safeValue(this.trades,r);if(void 0===o){const e=this.safeInteger(this.options,"tradesLimit",1e3);o=new a(e),this.trades[r]=o}o.append(s),e.resolve(o,n)}async watchOrderBook(e,t,i={}){if(void 0!==t&&20!==t&&100!==t)throw new r(this.id+" watchOrderBook 'limit' argument must be undefined, 20 or 100");await this.loadMarkets();const s=await this.negotiate(!1),a=this.market(e);e=a.symbol;const n="/market/level2:"+a.id,o="orderbook:"+e,h={method:this.handleOrderBookSubscription,symbol:e,limit:t};return(await this.subscribe(s,o,n,h,i)).limit()}handleOrderBook(e,t){const i=this.safeValue(t,"data"),s=this.safeString(i,"symbol"),r=this.safeSymbol(s,void 0,"-"),a="orderbook:"+r,n=this.orderbooks[r],o=this.safeInteger(n,"nonce"),h=this.safeInteger(i,"sequenceEnd");if(void 0===o){const s=n.cache.length,o=this.safeString(t,"topic"),h=e.subscriptions[o],d=this.safeInteger(h,"limit");return s===this.handleOption("watchOrderBook","snapshotDelay",5)&&this.spawn(this.loadOrderBook,e,a,r,d),void n.cache.push(i)}o>=h||(this.handleDelta(n,i),e.resolve(n,a))}getCacheIndex(e,t){const i=this.safeValue(t,0),s=this.safeInteger(e,"nonce");if(s<this.safeInteger(i,"sequenceStart")-1)return-1;for(let e=0;e<t.length;e++){const i=t[e],r=this.safeInteger(i,"sequenceStart"),a=this.safeInteger(i,"sequenceEnd");if(s>=r-1&&s<a)return e}return t.length}handleDelta(e,t){e.nonce=this.safeInteger(t,"sequenceEnd");const i=this.safeInteger(t,"time");e.timestamp=i,e.datetime=this.iso8601(i);const s=this.safeValue(t,"changes"),r=this.safeValue(s,"bids",[]),a=this.safeValue(s,"asks",[]),n=e.bids,o=e.asks;this.handleBidAsks(n,r),this.handleBidAsks(o,a)}handleBidAsks(e,t){for(let i=0;i<t.length;i++){const s=this.parseBidAsk(t[i]);e.storeArray(s)}}handleOrderBookSubscription(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeInteger(i,"limit");this.orderbooks[s]=this.orderBook({},r)}handleSubscriptionStatus(e,t){const i=this.safeString(t,"id"),s=this.indexBy(e.subscriptions,"id"),r=this.safeValue(s,i,{}),a=this.safeValue(r,"method");return void 0!==a&&a.call(this,e,t,r),t}handleSystemStatus(e,t){return t}async watchOrders(e,t,i,s={}){await this.loadMarkets();const r=await this.negotiate(!0);let a="orders";if(void 0!==e){a=a+":"+(e=this.market(e).symbol)}const n=await this.subscribe(r,a,"/spotMarket/tradeOrders",void 0,this.extend({privateChannel:!0},s));return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySymbolSinceLimit(n,e,t,i,!0)}parseWsOrderStatus(e){return this.safeString({open:"open",filled:"closed",match:"open",update:"open",canceled:"canceled"},e,e)}parseWsOrder(e,t){const i=this.safeString(e,"orderId"),s=this.safeString(e,"clientOid"),r=this.safeStringLower(e,"orderType"),a=this.safeString(e,"price"),n=this.safeString(e,"filledSize"),o=this.safeString(e,"size"),h=this.safeString(e,"type"),d=this.parseWsOrderStatus(h),c=this.safeIntegerProduct(e,"orderTime",1e-6),l=this.safeString(e,"symbol"),u=(t=this.safeMarket(l,t)).symbol,f=this.safeStringLower(e,"side");return this.safeOrder({info:e,symbol:u,id:i,clientOrderId:s,timestamp:c,datetime:this.iso8601(c),lastTradeTimestamp:void 0,type:r,timeInForce:void 0,postOnly:void 0,side:f,price:a,stopPrice:void 0,triggerPrice:void 0,amount:o,cost:void 0,average:void 0,filled:n,remaining:void 0,status:d,fee:void 0,trades:void 0},t)}handleOrder(e,t){const i="orders",s=this.safeValue(t,"data"),r=this.parseWsOrder(s),a=this.safeString(r,"symbol"),n=this.safeString(r,"id");if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new o(e)}const h=this.orders,d=this.safeValue(h.hashmap,a,{}),c=this.safeValue(d,n);if(void 0!==c){const e=this.safeValue(c,"stopPrice");void 0!==e&&(r.stopPrice=e),"closed"===c.status&&(r.status="closed")}h.append(r),e.resolve(this.orders,i);const l=i+":"+a;e.resolve(this.orders,l)}async watchMyTrades(e,t,i,s={}){await this.loadMarkets();const r=await this.negotiate(!0);let a="myTrades";if(void 0!==e){const t=this.market(e);e=t.symbol,a=a+":"+t.symbol}const n=await this.subscribe(r,a,"/spot/tradeFills",void 0,this.extend({privateChannel:!0},s));return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySymbolSinceLimit(n,e,t,i)}handleMyTrade(e,t){let i=this.myTrades;if(void 0===i){const e=this.safeInteger(this.options,"tradesLimit",1e3);i=new o(e)}const s=this.safeValue(t,"data"),r=this.parseWsTrade(s);i.append(r);const a="myTrades";e.resolve(i,a);const n=a+":"+r.symbol;e.resolve(i,n)}parseWsTrade(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t,"-")).symbol,r=this.safeString(e,"orderType"),a=this.safeString(e,"side"),n=this.safeString(e,"tradeId"),o=this.safeString(e,"price"),h=this.safeString(e,"size"),d=this.safeString(e,"orderId"),c=this.safeIntegerProduct(e,"time",1e-6),l=t.quote,u=this.safeString(e,"feeRate"),f={cost:this.safeString(e,"fee"),rate:u,currency:l};return this.safeTrade({info:e,timestamp:c,datetime:this.iso8601(c),symbol:s,id:n,order:d,type:r,takerOrMaker:void 0,side:a,price:o,amount:h,cost:void 0,fee:f},t)}async watchBalance(e={}){await this.loadMarkets();const t=await this.negotiate(!0);return await this.subscribe(t,"balance","/account/balance",void 0,this.extend({privateChannel:!0},e))}handleBalance(e,t){const i=this.safeValue(t,"data",{}),s=this.safeString(i,"currency"),r=this.safeString(i,"relationEvent");let a;if(void 0!==r){const e=r.split(".");a=this.safeString(e,0)}const n=this.safeString2(this.options,"watchBalance","defaultType","trade"),o=this.safeValue(this.options,"accountsByType"),h=this.safeString(o,a,"trade");h in this.balance||(this.balance[h]={});const d=this.safeCurrencyCode(s),c=this.account();c.free=this.safeString(i,"available"),c.used=this.safeString(i,"hold"),c.total=this.safeString(i,"total"),this.balance[h][d]=c,this.balance[h]=this.safeBalance(this.balance[h]),h===n&&e.resolve(this.balance[h],"balance")}handleSubject(e,t){const i=this.safeString(t,"subject"),s={"trade.l2update":this.handleOrderBook,"trade.ticker":this.handleTicker,"trade.snapshot":this.handleTicker,"trade.l3match":this.handleTrade,"trade.candles.update":this.handleOHLCV,"account.balance":this.handleBalance,"/spot/tradeFills":this.handleMyTrade,orderChange:this.handleOrder},r=this.safeValue(s,i);return void 0===r?t:r.call(this,e,t)}ping(e){return{id:this.requestId().toString(),type:"ping"}}handlePong(e,t){e.lastPong=this.milliseconds()}handleErrorMessage(e,t){return t}handleMessage(e,t){const i=this.safeString(t,"type"),s={welcome:this.handleSystemStatus,ack:this.handleSubscriptionStatus,message:this.handleSubject,pong:this.handlePong},r=this.safeValue(s,i);if(void 0!==r)return r.call(this,e,t)}}},87685:function(e,t,i){"use strict";const s=i(70514),{ExchangeError:r}=i(73449),{ArrayCache:a,ArrayCacheBySymbolById:n}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchTicker:!0,watchTrades:!0,watchOrderBook:!0,watchOrders:!0,watchBalance:!0},options:{accountsByType:{swap:"future",cross:"margin"},tradesLimit:1e3,watchOrderBook:{snapshotDelay:20,maxRetries:3},watchTicker:{name:"contractMarket/tickerV2"}},streaming:{ping:this.ping}})}negotiate(e,t={}){const i=e?"private":"public",s=this.safeValue(this.options,"urls",{});return i in s||(s[i]=this.spawn(this.negotiateHelper,e,t),this.options.urls=s),s[i]}async negotiateHelper(e,t={}){let i;const s=e?"private":"public";i=e?await this.futuresPrivatePostBulletPrivate(t):await this.futuresPublicPostBulletPublic(t);const r=this.safeValue(i,"data",{}),a=this.safeValue(r,"instanceServers",[]),n=this.safeValue(a,0),o=this.safeInteger(n,"pingInterval"),h=this.safeString(n,"endpoint"),d=this.safeString(r,"token"),c=h+"?"+this.urlencode({token:d,privateChannel:e,connectId:s});return this.client(c).keepAlive=o,c}requestId(){const e=this.sum(this.safeInteger(this.options,"requestId",0),1);return this.options.requestId=e,e}async subscribe(e,t,i,s,r={}){const a=this.requestId().toString(),n={id:a,type:"subscribe",topic:i,response:!0},o=this.extend(n,r),h={id:a};return s=void 0===s?h:this.extend(h,s),await this.watch(e,t,o,i,s)}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e);e=i.symbol;const s=await this.negotiate(!1),r=this.safeValue(this.options,"watchTicker",{}),a="/"+this.safeString(r,"name","contractMarket/tickerV2")+":"+i.id,n="ticker:"+e;return await this.subscribe(s,n,a,void 0,t)}handleTicker(e,t){const i=this.safeValue(t,"data",{}),s=this.safeValue(i,"symbol"),r=this.safeMarket(s,void 0,"-"),a=this.parseTicker(i,r);this.tickers[r.symbol]=a;const n="ticker:"+r.symbol;return e.resolve(a,n),t}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=await this.negotiate(!1),a=this.market(e);e=a.symbol;const n="/contractMarket/execution:"+a.id,o="trades:"+e,h=await this.subscribe(r,o,n,void 0,s);return this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySinceLimit(h,t,i,"timestamp",!0)}handleTrade(e,t){const i=this.safeValue(t,"data",{}),s=this.parseTrade(i),r=s.symbol;let n=this.safeValue(this.trades,r);if(void 0===n){const e=this.safeInteger(this.options,"tradesLimit",1e3);n=new a(e),this.trades[r]=n}n.append(s);const o="trades:"+r;return e.resolve(n,o),t}async watchOrderBook(e,t,i={}){if(void 0!==t&&20!==t&&100!==t)throw new r(this.id+" watchOrderBook 'limit' argument must be undefined, 20 or 100");await this.loadMarkets();const s=await this.negotiate(!1),a=this.market(e);e=a.symbol;const n="/contractMarket/level2:"+a.id,o="orderbook:"+e,h={method:this.handleOrderBookSubscription,symbol:e,limit:t};return(await this.subscribe(s,o,n,h,i)).limit()}handleDelta(e,t){e.nonce=this.safeInteger(t,"sequence");const i=this.safeInteger(t,"timestamp");e.timestamp=i,e.datetime=this.iso8601(i);const s=this.safeValue(t,"change",{}).split(","),r=this.safeNumber(s,0),a=this.safeString(s,1),n=[r,this.safeNumber(s,2)];if("bids"===("buy"===a?"bids":"asks")){e.bids.storeArray(n)}else{e.asks.storeArray(n)}}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleOrderBook(e,t){const i=this.safeValue(t,"data"),s=this.safeString(t,"topic").split(":"),r=this.safeString(s,1),a=this.safeSymbol(r,void 0,"-"),n="orderbook:"+a,o=this.orderbooks[a],h=this.safeInteger(o,"nonce"),d=this.safeInteger(i,"sequence");if(void 0===h){const s=o.cache.length,r=this.safeString(t,"topic"),h=e.subscriptions[r],d=this.safeInteger(h,"limit");return s===this.handleOption("watchOrderBook","snapshotDelay",5)&&this.spawn(this.loadOrderBook,e,n,a,d),void o.cache.push(i)}h>=d||(this.handleDelta(o,i),e.resolve(o,n))}getCacheIndex(e,t){const i=this.safeValue(t,0),s=this.safeInteger(e,"nonce");if(s<this.safeInteger(i,"sequence")-1)return-1;for(let e=0;e<t.length;e++){const i=t[e];if(s<this.safeInteger(i,"sequence")-1)return e}return t.length}handleOrderBookSubscription(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeInteger(i,"limit");this.orderbooks[s]=this.orderBook({},r)}handleSubscriptionStatus(e,t){const i=this.safeString(t,"id"),s=this.indexBy(e.subscriptions,"id"),r=this.safeValue(s,i,{}),a=this.safeValue(r,"method");return void 0!==a&&a.call(this,e,t,r),t}handleSystemStatus(e,t){return t}async watchOrders(e,t,i,s={}){await this.loadMarkets();const r=await this.negotiate(!0);let a="orders";if(void 0!==e){a=a+":"+(e=this.market(e).symbol)}const n=await this.subscribe(r,a,"/contractMarket/tradeOrders",void 0,this.extend({privateChannel:!0},s));return this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySymbolSinceLimit(n,e,t,i,!0)}parseWsOrderStatus(e){return this.safeString({open:"open",filled:"closed",match:"open",update:"open",canceled:"canceled"},e,e)}parseWsOrder(e,t){const i=this.safeString(e,"orderId"),s=this.safeString(e,"clientOid"),r=this.safeStringLower(e,"orderType"),a=this.safeString(e,"price"),n=this.safeString(e,"filledSize"),o=this.safeString(e,"size"),h=this.safeString(e,"type"),d=this.parseWsOrderStatus(h),c=this.safeIntegerProduct(e,"orderTime",1e-6),l=this.safeString(e,"symbol"),u=(t=this.safeMarket(l,t)).symbol,f=this.safeStringLower(e,"side");return this.safeOrder({info:e,symbol:u,id:i,clientOrderId:s,timestamp:c,datetime:this.iso8601(c),lastTradeTimestamp:void 0,type:r,timeInForce:void 0,postOnly:void 0,side:f,price:a,stopPrice:void 0,amount:o,cost:void 0,average:void 0,filled:n,remaining:void 0,status:d,fee:void 0,trades:void 0},t)}handleOrder(e,t){const i="orders",s=this.safeValue(t,"data"),r=this.parseWsOrder(s),a=this.safeString(r,"symbol"),o=this.safeString(r,"id");if(void 0!==a){if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new n(e)}const t=this.orders,s=this.safeValue(t.hashmap,a,{}),h=this.safeValue(s,o);if(void 0!==h){const e=this.safeValue(h,"stopPrice");void 0!==e&&(r.stopPrice=e),"closed"===h.status&&(r.status="closed")}t.append(r),e.resolve(this.orders,i);const d=i+":"+a;e.resolve(this.orders,d)}}async watchBalance(e={}){const t=await this.negotiate(!0),i={method:this.handleBalanceSubscription};return await this.subscribe(t,"balance","/contractAccount/wallet",i,this.extend({privateChannel:!0},e))}handleBalance(e,t){const i=this.safeValue(t,"data",{}),s=this.safeString(i,"currency"),r=this.safeCurrencyCode(s),a=this.account();a.free=this.safeString(i,"availableBalance"),a.used=this.safeString(i,"holdBalance"),this.balance[r]=a,this.balance=this.safeBalance(this.balance),e.resolve(this.balance,"balance")}handleBalanceSubscription(e,t,i){this.spawn(this.fetchBalanceSnapshot,e,t)}async fetchBalanceSnapshot(e,t){await this.loadMarkets(),this.checkRequiredCredentials();const i={type:this.safeString2(this.options,"watchBalance","defaultType","swap")},s=await this.fetchBalance(i),r=Object.keys(s);for(let e=0;e<r.length;e++){const t=r[e];"free"!==t&&"used"!==t&&"total"!==t&&"timestamp"!==t&&"datetime"!==t&&"info"!==t&&(this.balance[t]=s[t])}e.resolve(this.balance,"balance")}handleSubject(e,t){const i=this.safeString(t,"subject"),s={level2:this.handleOrderBook,tickerV2:this.handleTicker,"availableBalance.change":this.handleBalance,match:this.handleTrade,orderChange:this.handleOrder,orderUpdated:this.handleOrder},r=this.safeValue(s,i);return void 0===r?t:r.call(this,e,t)}ping(e){return{id:this.requestId().toString(),type:"ping"}}handlePong(e,t){return e.lastPong=this.milliseconds(),t}handleErrorMessage(e,t){return t}handleMessage(e,t){if(this.handleErrorMessage(e,t)){const i=this.safeString(t,"type"),s={welcome:this.handleSystemStatus,ack:this.handleSubscriptionStatus,message:this.handleSubject,pong:this.handlePong},r=this.safeValue(s,i);return void 0===r?t:r.call(this,e,t)}}}},48375:function(e,t,i){"use strict";const s=i(85439),{ArrayCache:r}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchTicker:!1,watchTickers:!1,watchTrades:!0,watchMyTrades:!1,watchOrders:void 0,watchOrderBook:!0,watchOHLCV:!1},urls:{api:{ws:"wss://ws.luno.com/api/1"}},options:{sequenceNumbers:{}},streaming:{},exceptions:{}})}async watchTrades(e,t,i,s={}){await this.checkRequiredCredentials(),await this.loadMarkets();const r=this.market(e);e=r.symbol;const a="/stream/"+r.id,n={symbol:e},o=this.urls.api.ws+a,h="trades:"+e,d={api_key_id:this.apiKey,api_key_secret:this.secret},c=this.deepExtend(d,s),l=await this.watch(o,h,c,a,n);return this.newUpdates&&(i=l.getLimit(e,i)),this.filterBySinceLimit(l,t,i,"timestamp",!0)}handleTrades(e,t,i){const s=this.safeValue(t,"trade_updates",[]);if(0===s.length)return;const a=i.symbol,n=this.market(a),o="trades:"+a;let h=this.safeValue(this.trades,a);if(void 0===h){const e=this.safeInteger(this.options,"tradesLimit",1e3);h=new r(e),this.trades[a]=h}for(let e=0;e<s.length;e++){const t=s[e],i=this.parseTrade(t,n);h.append(i)}this.trades[a]=h,e.resolve(this.trades[a],o)}parseTrade(e,t){return this.safeTrade({info:e,id:void 0,timestamp:void 0,datetime:void 0,symbol:t.symbol,order:void 0,type:void 0,side:void 0,takerOrMaker:void 0,price:void 0,amount:this.safeString(e,"base"),cost:this.safeString(e,"counter"),fee:void 0},t)}async watchOrderBook(e,t,i={}){await this.checkRequiredCredentials(),await this.loadMarkets();const s=this.market(e);e=s.symbol;const r="/stream/"+s.id,a={symbol:e},n=this.urls.api.ws+r,o="orderbook:"+e,h={api_key_id:this.apiKey,api_key_secret:this.secret},d=this.deepExtend(h,i);return(await this.watch(n,o,d,r,a)).limit(t)}handleOrderBook(e,t,i){const s=i.symbol,r="orderbook:"+s,a=this.safeString(t,"timestamp");let n=this.safeValue(this.orderbooks,s);void 0===n&&(n=this.indexedOrderBook({}),this.orderbooks[s]=n);if(void 0!==this.safeValue(t,"asks")){const e=this.parseOrderBook(t,s,a,"bids","asks","price","volume","id");n.reset(e)}else this.handleDelta(n,t),n.timestamp=a,n.datetime=this.iso8601(a);const o=this.safeInteger(t,"sequence");n.nonce=o,e.resolve(n,r)}parseOrderBook(e,t,i,s="bids",r="asks",a=0,n=1,o){const h=this.parseBidsAsks(this.safeValue(e,s,[]),a,n,o),d=this.parseBidsAsks(this.safeValue(e,r,[]),a,n,o);return{symbol:t,bids:this.sortBy(h,0,!0),asks:this.sortBy(d,0),timestamp:i,datetime:this.iso8601(i),nonce:void 0}}parseBidsAsks(e,t=0,i=1,s){e=this.toArray(e);const r=[];for(let a=0;a<e.length;a++)r.push(this.parseBidAsk(e[a],t,i,s));return r}parseBidAsk(e,t=0,i=1,s){const r=[this.safeNumber(e,t),this.safeNumber(e,i)];if(void 0!==s){const t=this.safeString(e,s);r.push(t)}return r}handleDelta(e,t){const i=this.safeValue(t,"create_update"),s=e.asks,r=e.bids;if(void 0!==i){const e=this.parseBidAsk(i,"price","volume","order_id"),t=this.safeString(i,"type");"ASK"===t?s.storeArray(e):"BID"===t&&r.storeArray(e)}const a=this.safeValue(t,"delete_update");if(void 0!==a){const e=this.safeString(a,"order_id");s.storeArray(0,0,e),r.storeArray(0,0,e)}return t}handleMessage(e,t){if(""===t)return;const i=Object.values(e.subscriptions),s=[this.handleOrderBook,this.handleTrades];for(let r=0;r<s.length;r++){s[r].call(this,e,t,i[0])}return t}}},46632:function(e,t,i){"use strict";const s=i(10085),{AuthenticationError:r,BadSymbol:a,BadRequest:n,NotSupported:o}=i(73449),{ArrayCache:h,ArrayCacheBySymbolById:d,ArrayCacheByTimestamp:c}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchMyTrades:!0,watchOHLCV:!0,watchOrderBook:!0,watchOrders:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0},urls:{api:{ws:{spot:"wss://wbs.mexc.com/raw/ws",swap:"wss://contract.mexc.com/ws"}}},options:{timeframes:{"1m":"Min1","5m":"Min5","15m":"Min15","30m":"Min30","1h":"Min60","4h":"Hour4","8h":"Hour8","1d":"Day1","1w":"Week1","1M":"Month1"}},streaming:{ping:this.ping,keepAlive:1e4},exceptions:{ws:{exact:{"signature validation failed":r},broad:{"Contract not exists":a}}}})}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s="ticker:"+(e=i.symbol),r={symbol:i.id};if("spot"===i.type)throw new o(this.id+" watchTicker does not support spot markets");return await this.watchSwapPublic(s,"sub.ticker",r,t)}handleTicker(e,t){const i=this.safeValue(t,"data",{}),s=this.safeString(t,"symbol"),r=this.safeMarket(s),a=r.symbol,n=this.parseTicker(i,r);this.tickers[a]=n;const o="ticker:"+a;return e.resolve(n,o),t}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={};e=a.symbol;const o=a.type,h=this.safeValue(this.options,"timeframes",{}),d=this.safeString(h,t),c="sub.kline",l="kline:"+d+":"+e;let u;return n.symbol=a.id,n.interval=d,void 0!==i&&(n.start=i),u="spot"===o?await this.watchSpotPublic(l,c,n,r):await this.watchSwapPublic(l,c,n,r),this.newUpdates&&(s=u.getLimit(e,s)),this.filterBySinceLimit(u,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeString(t,"symbol"),s=this.safeMarket(i),r=s.symbol,a=this.safeValue(t,"data",{}),n=this.safeString(a,"interval"),o="kline:"+n+":"+r,h=this.safeValue(this.options,"timeframes",{}),d=this.findTimeframe(n,h),l=this.parseWsOHLCV(a,s);this.ohlcvs[r]=this.safeValue(this.ohlcvs,r,{});let u=this.safeValue(this.ohlcvs[r],d);if(void 0===u){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);u=new c(e),this.ohlcvs[r][d]=u}return u.append(l),e.resolve(u,o),t}parseWsOHLCV(e,t){return[this.safeIntegerProduct(e,"t",1e3),this.safeNumber(e,"o"),this.safeNumber(e,"h"),this.safeNumber(e,"l"),this.safeNumber(e,"c"),this.safeNumber2(e,"v","q")]}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r="orderbook:"+(e=s.symbol),a={symbol:s.id};if(void 0!==t){if(5!==t&&10!==t&&20!==t)throw new n(this.id+" watchOrderBook limit parameter cannot be different from 5, 10 or 20")}else t=20;let o;if("swap"===s.type){const e="sub.depth";a.compress=!0,a.limit=t,o=await this.watchSwapPublic(r,e,a,i)}else{const e="sub.limit.depth";a.depth=t,o=await this.watchSpotPublic(r,e,a,i)}return o.limit()}handleOrderBook(e,t){const i=this.safeString(t,"symbol"),s=this.safeMarket(i),r=s.symbol,a=this.safeValue(t,"data"),n=this.safeInteger(t,"ts"),o=this.parseOrderBook(a,r,n);let h=this.safeNumber(a,"end");void 0===h&&(h=this.safeNumber(t,"version")),o.nonce=h;let d=this.safeValue(this.orderbooks,r);void 0===d?(d=this.orderBook(o),this.orderbooks[r]=d):"spot"===s.type?d.reset(o):this.handleOrderBookMessage(e,t,d);const c="orderbook:"+r;e.resolve(d,c)}handleOrderBookMessage(e,t,i){const s=this.safeValue(t,"data",{}),r=this.safeNumber(s,"end"),a=this.safeValue(s,"asks",[]),n=this.safeValue(s,"bids",[]);this.handleDeltas(i.asks,a),this.handleDeltas(i.bids,n);const o=this.safeInteger(t,"ts"),h=this.safeString(t,"symbol"),d=this.safeSymbol(h);return i.nonce=r,i.symbol=d,i.timestamp=o,i.datetime=this.iso8601(o),i}handleDelta(e,t){const i=this.safeFloat(t,0),s=this.safeFloat(t,1);e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a="sub.deal",n="trades:"+(e=r.symbol),o={symbol:r.id};let h;return h="spot"===r.type?await this.watchSpotPublic(n,a,o,s):await this.watchSwapPublic(n,a,o,s),this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySinceLimit(h,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeString(t,"symbol"),s=this.safeMarket(i),r=s.symbol;let a=this.safeValue(this.trades,r);if(void 0===a){const e=this.safeInteger(this.options,"tradesLimit",1e3);a=new h(e),this.trades[r]=a}const n=this.safeValue(t,"data",{});let o;o="deals"in n?this.safeValue(n,"deals",[]):[n];for(let e=0;e<o.length;e++){const t=this.parseWsTrade(o[e],s);a.append(t)}const d="trades:"+r;e.resolve(a,d)}async watchMyTrades(e,t,i,s={}){await this.loadMarkets();let r,a,n,h="trade";if(void 0!==e&&(r=this.market(e),e=r.symbol,h+=":"+r.symbol),[a,s]=this.handleMarketTypeAndParams("watchMyTrades",r,s),"spot"===a)throw new o(this.id+" watchMyTrades does not support spot markets");return n=await this.watchSwapPrivate(h,s),this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySymbolSinceLimit(n,e,t,i,!0)}handleMyTrade(e,t,i){const s=this.safeValue(t,"data",{}),r=this.safeString(s,"symbol"),a=this.safeMarket(r),n=this.parseWsTrade(s,a);if(void 0===this.myTrades){const e=this.safeInteger(this.options,"tradesLimit",1e3);this.myTrades=new d(e)}const o=this.myTrades;o.append(n);let h="trade";e.resolve(o,h),h+=":"+a.symbol,e.resolve(o,h)}parseWsTrade(e,t){const i=this.safeInteger2(e,"timestamp","t"),s=this.safeString(e,"symbol"),r=(t=this.safeMarket(s,t,"_")).symbol,a=this.safeString2(e,"price","p");let n=this.safeString2(e,"vol","q");void 0===n&&(n=this.safeString(e,"v"));let o,h=this.safeString(e,"T");void 0===h?(h=this.safeString(e,"side"),o=this.parseSwapSide(h)):o="1"===h?"buy":"sell";let d=this.safeString(e,"id");void 0===d&&(d=i.toString()+"-"+t.id+"-"+n);const c=this.safeString(e,"fee");let l;if(void 0!==c){const t=this.safeString(e,"feeCurrency");l={cost:c,currency:this.safeCurrencyCode(t)}}const u=this.safeString(e,"orderId"),f=this.safeValue(e,"taker",!0)?"taker":"maker";return this.safeTrade({info:e,id:d,order:u,timestamp:i,datetime:this.iso8601(i),symbol:r,type:void 0,side:o,takerOrMaker:f,price:a,amount:n,cost:void 0,fee:l},t)}async watchOrders(e,t,i,s={}){await this.loadMarkets();let r,a,n,o="order";return void 0!==e&&(r=this.market(e),e=r.symbol,o+=":"+r.symbol),[a,s]=this.handleMarketTypeAndParams("watchOrders",r,s),n="spot"===a?await this.watchSpotPrivate(o,s):await this.watchSwapPrivate(o,s),this.newUpdates&&(i=n.getLimit(e,i)),this.filterBySymbolSinceLimit(n,e,t,i,!0)}handleOrder(e,t,i){const s=this.safeValue(t,"data",{});let r=this.safeString(t,"symbol");void 0===r&&(r=this.safeString(s,"symbol"));const a=this.safeMarket(r),n=this.parseWSOrder(s,a);if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new d(e)}const o=this.orders;o.append(n);let h="order";e.resolve(o,h),h+=":"+a.symbol,e.resolve(o,h)}parseWSOrder(e,t){const i=this.safeString2(e,"orderId","id"),s=this.safeString2(e,"state","status"),r=this.safeInteger(e,"createTime"),a=this.safeString(e,"price"),n=this.safeString2(e,"quantity","vol"),o=this.safeString(e,"remainQuantity"),h=this.safeString(e,"dealVol"),d=this.safeString(e,"amount"),c=this.safeString(e,"dealAvgPrice"),l=this.safeString2(e,"symbol","symbolDisplay"),u=this.safeSymbol(l,t,"_"),f=this.safeString(e,"side");let p=this.parseSwapSide(f);if(void 0===p){const t=this.safeStringLower(e,"tradeType");p="ask"===t||"2"===t?"sell":"bid"===t||"1"===t?"buy":t}const m=this.parseWsOrderStatus(s,t);let g=this.safeString2(e,"client_order_id","orderId");""===g&&(g=void 0);const y=this.safeString(e,"orderType"),b="3"===y||"5"===y?"market":"limit";return this.safeOrder({id:i,clientOrderId:g,timestamp:r,datetime:this.iso8601(r),lastTradeTimestamp:this.safeInteger(e,"updateTime"),status:m,symbol:u,type:b,timeInForce:void 0,side:p,price:a,stopPrice:void 0,triggerPrice:void 0,average:c,amount:n,cost:d,filled:h,remaining:o,fee:void 0,trades:void 0,info:e},t)}parseSwapSide(e){return this.safeString({1:"open long",2:"close short",3:"open short",4:"close long"},e)}parseWsOrderStatus(e,t){let i={};return i="spot"===t.type?{1:"open",2:"closed",3:"open",4:"canceled",5:"open",NEW:"open",FILLED:"closed",PARTIALLY_FILLED:"open",CANCELED:"canceled",PARTIALLY_CANCELED:"canceled"}:{2:"open",3:"closed",4:"canceled"},this.safeString(i,e,e)}async watchBalance(e={}){await this.loadMarkets();let t;if([t,e]=this.handleMarketTypeAndParams("watchBalance",void 0,e),"spot"===t)throw new o(this.id+" watchBalance does not support spot markets");return this.watchSwapPrivate("balance",e)}handleBalance(e,t){const i=this.safeValue(t,"data"),s=this.safeString(i,"currency"),r=this.safeCurrencyCode(s),a=this.account();a.free=this.safeString(i,"availableBalance"),a.used=this.safeString(i,"frozenBalance"),this.balance[r]=a,this.balance=this.safeBalance(this.balance);e.resolve(this.balance,"balance")}async watchSwapPublic(e,t,i,s={}){const r=this.urls.api.ws.swap,a={method:t,param:i},n=this.extend(a,s);return await this.watch(r,e,n,e)}async watchSpotPublic(e,t,i,s={}){const r=this.urls.api.ws.spot,a={op:t},n=this.extend(a,i),o=this.extend(n,s);return await this.watch(r,e,o,e)}async watchSpotPrivate(e,t={}){this.checkRequiredCredentials();const i="sub.personal",s=this.urls.api.ws.spot,r=this.milliseconds().toString(),a={op:i,api_key:this.apiKey,req_time:r},n=this.keysort(a);n.api_secret=this.secret;const o=this.urlencode(n),h=this.hash(this.encode(o),"md5");a.sign=h;const d=this.extend(a,t);return await this.watch(s,e,d,i)}async watchSwapPrivate(e,t={}){this.checkRequiredCredentials();const i="login",s=this.urls.api.ws.swap,r=this.milliseconds().toString(),a=this.apiKey+r,n=this.hmac(this.encode(a),this.encode(this.secret),"sha256"),o={method:i,param:{apiKey:this.apiKey,signature:n,reqTime:r}},h=this.extend(o,t),d=this.extend(h,t);return await this.watch(s,e,d,i)}handleErrorMessage(e,t){const i=this.safeString(t,"channel");try{const e=this.id+" "+this.json(t);if(i.indexOf("error")>=0){const i=this.safeValue(t,"data");"string"==typeof i&&(this.throwExactlyMatchedException(this.exceptions.ws.exact,i,e),this.throwBroadlyMatchedException(this.exceptions.ws.broad,i,e))}if("sub.personal"===i){const i=this.safeString(t,"msg");this.throwExactlyMatchedException(this.exceptions.ws.exact,i,e)}}catch(e){if(e instanceof r)return!1}return t}handleAuthenticate(e,t){return t}handleMessage(e,t){if(!this.handleErrorMessage(e,t))return;if("pong"===t)return void this.handlePong(e,t);const i=this.safeString(t,"channel"),s={pong:this.handlePong,"rs.login":this.handleAuthenticate,"push.deal":this.handleTrades,orderbook:this.handleOrderBook,"push.kline":this.handleOHLCV,"push.ticker":this.handleTicker,"push.depth":this.handleOrderBook,"push.limit.depth":this.handleOrderBook,"push.personal.order":this.handleOrder,"push.personal.trigger.order":this.handleOrder,"push.personal.plan.order":this.handleOrder,"push.personal.order.deal":this.handleMyTrade,"push.personal.asset":this.handleBalance},r=this.safeValue(s,i);void 0!==r&&r.call(this,e,t)}ping(e){return"spot"===this.safeString(this.options,"defaultType","spot")?"ping":{method:"ping"}}handlePong(e,t){return e.lastPong=this.milliseconds(),t}}},19994:function(e,t,i){"use strict";const s=i(61985),{ArrayCache:r}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchOrderBook:!0,watchTrades:!0,watchTicker:!0,watchOHLCV:!0},urls:{test:{ws:"wss://ndaxmarginstaging.cdnhop.net:10456/WSAdminGatewa/"},api:{ws:"wss://api.ndax.io/WSGateway"}}})}requestId(){const e=this.sum(this.safeInteger(this.options,"requestId",0),1);return this.options.requestId=e,e}async watchTicker(e,t={}){const i=this.safeInteger(this.options,"omsId",1);await this.loadMarkets();const s=this.market(e),r="SubscribeLevel1",a=r+":"+s.id,n=this.urls.api.ws,o=this.requestId(),h={OMSId:i,InstrumentId:parseInt(s.id)},d={m:0,i:o,n:r,o:this.json(h)},c=this.extend(d,t);return await this.watch(n,a,c,a)}handleTicker(e,t){const i=this.safeValue(t,"o",{}),s=this.parseTicker(i),r=s.symbol,a=this.market(r);this.tickers[r]=s;const n="SubscribeLevel1:"+a.id;e.resolve(s,n)}async watchTrades(e,t,i,s={}){const r=this.safeInteger(this.options,"omsId",1);await this.loadMarkets();const a=this.market(e);e=a.symbol;const n="SubscribeTrades",o=n+":"+a.id,h=this.urls.api.ws,d=this.requestId(),c={OMSId:r,InstrumentId:parseInt(a.id),IncludeLastCount:100},l={m:0,i:d,n:n,o:this.json(c)},u=this.extend(l,s),f=await this.watch(h,o,u,o);return this.newUpdates&&(i=f.getLimit(e,i)),this.filterBySinceLimit(f,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeValue(t,"o",[]),s={};for(let e=0;e<i.length;e++){const t=this.parseTrade(i[e]),a=t.symbol;let n=this.safeValue(this.trades,a);if(void 0===n){const e=this.safeInteger(this.options,"tradesLimit",1e3);n=new r(e)}n.append(t),this.trades[a]=n,s[a]=!0}const a=Object.keys(s);for(let t=0;t<a.length;t++){const i=a[t],s="SubscribeTrades:"+this.market(i).id,r=this.safeValue(this.trades,i);e.resolve(r,s)}}async watchOHLCV(e,t="1m",i,s,r={}){const a=this.safeInteger(this.options,"omsId",1);await this.loadMarkets();const n=this.market(e);e=n.symbol;const o="SubscribeTicker",h=o+":"+t+":"+n.id,d=this.urls.api.ws,c=this.requestId(),l={OMSId:a,InstrumentId:parseInt(n.id),Interval:parseInt(this.safeString(this.timeframes,t,t)),IncludeLastCount:100},u={m:0,i:c,n:o,o:this.json(l)},f=this.extend(u,r),p=await this.watch(d,h,f,h);return this.newUpdates&&(s=p.getLimit(e,s)),this.filterBySinceLimit(p,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeValue(t,"o",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,8),a=this.safeMarket(r).symbol;s[r]={},this.ohlcvs[a]=this.safeValue(this.ohlcvs,a,{});const n=Object.keys(this.timeframes);for(let e=0;e<n.length;e++){const i=n[e],o=this.safeString(this.timeframes,i,i),h=1e3*parseInt(o),d=this.safeInteger(t,0),c=[parseInt(d/h)*h,this.safeFloat(t,3),this.safeFloat(t,1),this.safeFloat(t,2),this.safeFloat(t,4),this.safeFloat(t,5)],l=this.safeValue(this.ohlcvs[a],i,[]),u=l.length;if(u&&c[0]===l[u-1][0]){const e=l[u-1];l[u-1]=[c[0],e[1],Math.max(c[1],e[1]),Math.min(c[2],e[2]),c[4],this.sum(c[5],e[5])],s[r][i]=!0}else{if(u&&c[0]<l[u-1][0])continue;l.push(c);u>=this.safeInteger(this.options,"OHLCVLimit",1e3)&&l.shift(),s[r][i]=!0}this.ohlcvs[a][i]=l}}const r=Object.keys(s);for(let t=0;t<r.length;t++){const i=r[t],a=Object.keys(s[i]);for(let t=0;t<a.length;t++){const s=a[t],r="SubscribeTicker:"+s+":"+i,n=this.safeMarket(i).symbol,o=this.safeValue(this.ohlcvs[n],s,[]);e.resolve(o,r)}}}async watchOrderBook(e,t,i={}){const s=this.safeInteger(this.options,"omsId",1);await this.loadMarkets();const r=this.market(e);e=r.symbol;const a="SubscribeLevel2",n=a+":"+r.id,o=this.urls.api.ws,h=this.requestId();t=void 0===t?100:t;const d={OMSId:s,InstrumentId:parseInt(r.id),Depth:t},c={m:0,i:h,n:a,o:this.json(d)},l={id:h,messageHash:n,name:a,symbol:e,marketId:r.id,method:this.handleOrderBookSubscription,limit:t,params:i},u=this.extend(c,i);return(await this.watch(o,n,u,n,l)).limit()}handleOrderBook(e,t){const i=this.safeValue(t,"o",[]),s=this.safeValue(i,0,[]),r=this.safeString(s,7);if(void 0===r)return t;const a=this.safeMarket(r).symbol,n=this.safeValue(this.orderbooks,a);if(void 0===n)return t;let o,h;for(let e=0;e<i.length;e++){const t=i[e];if(void 0===o)o=this.safeInteger(t,2);else{const e=this.safeInteger(t,2);o=Math.max(o,e)}if(void 0===h)h=this.safeInteger(t,0);else{const e=this.safeInteger(t,0);h=Math.max(h,e)}const s=this.safeInteger(t,3),r=this.safeFloat(t,6),a=this.safeFloat(t,8),d=0===this.safeInteger(t,9)?n.bids:n.asks;0===s||1===s?d.store(r,a):2===s&&d.store(r,0)}n.nonce=h,n.timestamp=o,n.datetime=this.iso8601(o);const d="SubscribeLevel2:"+r;this.orderbooks[a]=n,e.resolve(n,d)}handleOrderBookSubscription(e,t,i){const s=this.safeValue(t,"o",[]),r=this.safeString(i,"symbol"),a=this.parseOrderBook(s,r),n=this.safeInteger(i,"limit"),o=this.orderBook(a,n);this.orderbooks[r]=o;const h=this.safeString(i,"messageHash");e.resolve(o,h)}handleSubscriptionStatus(e,t){const i=this.indexBy(e.subscriptions,"id"),s=this.safeInteger(t,"i"),r=this.safeValue(i,s);if(void 0!==r){const i=this.safeValue(r,"method");return void 0===i?t:i.call(this,e,t,r)}}handleMessage(e,t){const i=this.safeString(t,"o");if(void 0===i)return t;t.o=JSON.parse(i);const s={SubscribeLevel2:this.handleSubscriptionStatus,SubscribeLevel1:this.handleTicker,Level2UpdateEvent:this.handleOrderBook,Level1UpdateEvent:this.handleTicker,SubscribeTrades:this.handleTrades,TradeDataUpdateEvent:this.handleTrades,SubscribeTicker:this.handleOHLCV,TickerDataUpdateEvent:this.handleOHLCV},r=this.safeString(t,"n"),a=this.safeValue(s,r);return void 0===a?t:a.call(this,e,t)}}},65577:function(e,t,i){"use strict";const s=i(21384),{ArgumentsRequired:r,AuthenticationError:a}=i(73449),{ArrayCache:n,ArrayCacheByTimestamp:o,ArrayCacheBySymbolById:h}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchTicker:!0,watchTickers:!1,watchOrderBook:!0,watchOrders:!0,watchTrades:!0,watchBalance:!0,watchOHLCV:!0},urls:{api:{ws:"wss://real.okcoin.com:8443/ws/v3"},logo:"https://user-images.githubusercontent.com/1294454/27766791-89ffb502-5ee5-11e7-8a5b-c5950b68ac65.jpg",www:"https://www.okcoin.com",doc:"https://www.okcoin.com/docs/en/",fees:"https://www.okcoin.com/coin-fees",referral:"https://www.okcoin.com/account/register?flag=activity&channelId=600001513"},options:{fetchMarkets:["spot"],watchOrders:"order",watchOrderBook:{limit:400,type:"spot",depth:"depth_l2_tbt"},watchBalance:"spot",ws:{inflate:!0}},streaming:{ping:this.ping,keepAlive:2e4}})}async subscribe(e,t,i={}){await this.loadMarkets();const s=this.market(t),r=this.urls.api.ws,a=s.type+"/"+e+":"+s.id,n={op:"subscribe",args:[a]};return await this.watch(r,a,this.deepExtend(n,i),a)}async watchTrades(e,t,i,s={}){await this.loadMarkets(),e=this.symbol(e);const r=await this.subscribe("trade",e,s);return this.newUpdates&&(i=r.getLimit(e,i)),this.filterBySinceLimit(r,t,i,"timestamp",!0)}async watchOrders(e,t,i,s={}){await this.loadMarkets(),await this.authenticate(),void 0!==e&&(e=this.symbol(e));const r=this.safeString(this.options,"watchOrders","order"),a=await this.subscribe(r,e,s);return this.newUpdates&&(i=a.getLimit(e,i)),this.filterBySinceLimit(a,t,i,"timestamp",!0)}handleOrders(e,t,i){const s=this.safeString(t,"table"),r=this.safeValue(t,"data",[]);if(r.length>0){const t=this.safeInteger(this.options,"ordersLimit",1e3);void 0===this.orders&&(this.orders=new h(t));const i=this.orders,a={},n=this.parseOrders(r);for(let e=0;e<n.length;e++){const t=n[e];i.append(t);const s=t.symbol;a[this.market(s).id]=!0}const o=Object.keys(a);for(let t=0;t<o.length;t++){const i=s+":"+o[t];e.resolve(this.orders,i)}}}async watchTicker(e,t={}){return await this.subscribe("ticker",e,t)}handleTrade(e,t){const i=this.safeString(t,"table"),s=this.safeValue(t,"data",[]),r=this.safeInteger(this.options,"tradesLimit",1e3);for(let t=0;t<s.length;t++){const a=this.parseTrade(s[t]),o=a.symbol,h=i+":"+this.safeString(a.info,"instrument_id");let d=this.safeValue(this.trades,o);void 0===d&&(d=new n(r),this.trades[o]=d),d.append(a),e.resolve(d,h)}return t}handleTicker(e,t){const i=this.safeString(t,"table"),s=this.safeValue(t,"data",[]);for(let t=0;t<s.length;t++){const r=this.parseTicker(s[t]),a=r.symbol,n=i+":"+this.safeString(r.info,"instrument_id");this.tickers[a]=r,e.resolve(r,n)}return t}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets(),e=this.symbol(e);const a="candle"+this.safeString(this.timeframes,t,t)+"s",n=await this.subscribe(a,e,r);return this.newUpdates&&(s=n.getLimit(e,s)),this.filterBySinceLimit(n,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeString(t,"table"),s=this.safeValue(t,"data",[]),r=i.split("/");let a=this.safeString(r,1).replace("candle","");a=a.replace("s","");const n=this.findTimeframe(a);for(let t=0;t<s.length;t++){const r=this.safeString(s[t],"instrument_id"),a=this.safeValue(s[t],"candle"),h=this.safeMarket(r),d=h.symbol,c=this.parseOHLCV(a,h);this.ohlcvs[d]=this.safeValue(this.ohlcvs,d,{});let l=this.safeValue(this.ohlcvs[d],n);if(void 0===l){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);l=new o(e),this.ohlcvs[d][n]=l}l.append(c);const u=i+":"+r;e.resolve(l,u)}}async watchOrderBook(e,t,i={}){const s=this.safeValue(this.options,"watchOrderBook",{}),r=this.safeString(s,"depth","depth_l2_tbt");return(await this.subscribe(r,e,i)).limit()}handleDelta(e,t){const i=this.safeFloat(t,0),s=this.safeFloat(t,1);e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleOrderBookMessage(e,t,i){const s=this.safeValue(t,"asks",[]),r=this.safeValue(t,"bids",[]);this.handleDeltas(i.asks,s),this.handleDeltas(i.bids,r);const a=this.parse8601(this.safeString(t,"timestamp"));return i.timestamp=a,i.datetime=this.iso8601(a),i}handleOrderBook(e,t){const i=this.safeString(t,"action"),s=this.safeValue(t,"data",[]),r=this.safeString(t,"table");if("partial"===i)for(let t=0;t<s.length;t++){const i=s[t],a=this.safeString(i,"instrument_id"),n=this.safeMarket(a).symbol,o=this.safeValue(this.options,"watchOrderBook",{}),h=this.safeInteger(o,"limit",400),d=this.orderBook({},h);this.orderbooks[n]=d,this.handleOrderBookMessage(e,i,d);const c=r+":"+a;e.resolve(d,c)}else for(let t=0;t<s.length;t++){const i=s[t],a=this.safeString(i,"instrument_id"),n=this.safeMarket(a).symbol;if(n in this.orderbooks){const t=this.orderbooks[n];this.handleOrderBookMessage(e,i,t);const s=r+":"+a;e.resolve(t,s)}}return t}async authenticate(e={}){this.checkRequiredCredentials();const t=this.urls.api.ws,i="login",s=this.client(t);let r=this.safeValue(s.subscriptions,i);if(void 0===r){r=s.future("authenticated");const e=this.seconds().toString(),a=e+"GET"+"/users/self/verify",n=this.hmac(this.encode(a),this.encode(this.secret),"sha256","base64"),o={op:i,args:[this.apiKey,this.password,e,n]};this.spawn(this.watch,t,i,o,i,r)}return await r}async watchBalance(e={}){const t=this.safeString2(this.options,"watchBalance","defaultType");if(void 0===this.safeString(e,"type",t))throw new r(this.id+" watchBalance requires a type parameter (one of 'spot', 'margin', 'futures', 'swap')");const i=await this.authenticate();return await this.subscribeToUserAccount(i,e)}async subscribeToUserAccount(e,t={}){const i=this.safeString2(this.options,"watchBalance","defaultType"),s=this.safeString(t,"type",i);if(void 0===s)throw new r(this.id+" watchBalance requires a type parameter (one of 'spot', 'margin', 'futures', 'swap')");await this.loadMarkets();const a=this.safeString(t,"currency"),n=this.safeString(t,"code",this.safeCurrencyCode(a));let o;void 0!==n&&(o=this.currency(n));const h=this.safeString(t,"symbol"),d=this.market(h),c=void 0===d,l=void 0===o;if("spot"===s){if(l)throw new r(this.id+" watchBalance requires a 'currency' (id) or a unified 'code' parameter for "+s+" accounts")}else if("margin"===s||"swap"===s||"option"===s){if(c)throw new r(this.id+" watchBalance requires a 'instrument_id' (id) or a unified 'symbol' parameter for "+s+" accounts")}else if("futures"===s&&l&&c)throw new r(this.id+" watchBalance requires a 'currency' (id), or unified 'code', or 'instrument_id' (id), or unified 'symbol' parameter for "+s+" accounts");let u;l?c||(u=d.id):u=o.id;const f=("margin"===s?"spot":s)+"/"+("margin"===s?"margin_account":"account"),p=f+":"+u,m=this.urls.api.ws,g={op:"subscribe",args:[p]},y=this.omit(t,["currency","code","instrument_id","symbol","type"]);return await this.watch(m,f,this.deepExtend(g,y),p)}handleBalance(e,t){const i=this.safeString(t,"table"),s=i.split("/");let r=this.safeString(s,0);if("spot"===r){"margin_account"===this.safeString(s,1)&&(r="margin")}const a=this.safeValue(t,"data",[]);for(let t=0;t<a.length;t++){const t=this.parseBalanceByType(r,a),s=this.safeValue(this.balance,r,{}),n=this.deepExtend(s,t);this.balance[r]=this.safeBalance(n),e.resolve(this.balance[r],i)}}handleSubscriptionStatus(e,t){return t}handleAuthenticate(e,t){return e.resolve(t,"authenticated"),t}ping(e){return"ping"}handlePong(e,t){return e.lastPong=this.milliseconds(),t}handleErrorMessage(e,t){const i=this.safeString(t,"errorCode");try{if(void 0!==i){const e=this.id+" "+this.json(t);this.throwExactlyMatchedException(this.exceptions.exact,i,e);const s=this.safeValue(t,"message");void 0!==s&&this.throwBroadlyMatchedException(this.exceptions.broad,s,e)}}catch(t){if(t instanceof a){e.reject(t,"authenticated");const i="login";return i in e.subscriptions&&delete e.subscriptions[i],!1}}return t}handleMessage(e,t){if(!this.handleErrorMessage(e,t))return;if("pong"===t)return this.handlePong(e,t);const i=this.safeString(t,"table");if(void 0!==i){const s=i.split("/"),r=this.safeString(s,1),a={depth:this.handleOrderBook,depth5:this.handleOrderBook,depth_l2_tbt:this.handleOrderBook,ticker:this.handleTicker,trade:this.handleTrade,account:this.handleBalance,margin_account:this.handleBalance,order:this.handleOrders};let n=this.safeValue(a,r);return r.indexOf("candle")>=0&&(n=this.handleOHLCV),void 0===n?t:n.call(this,e,t)}{const i=this.safeString(t,"event");if(void 0!==i){const s={login:this.handleAuthenticate,subscribe:this.handleSubscriptionStatus},r=this.safeValue(s,i);return void 0===r?t:r.call(this,e,t)}}}}},73885:function(e,t,i){"use strict";const s=i(80613);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{alias:!0,id:"okex"})}}},80613:function(e,t,i){"use strict";const s=i(89352),{AuthenticationError:r,InvalidNonce:a}=i(73449),{ArrayCache:n,ArrayCacheByTimestamp:o,ArrayCacheBySymbolById:h}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchTicker:!0,watchOrderBook:!0,watchTrades:!0,watchBalance:!0,watchOHLCV:!0,watchOrders:!0},urls:{api:{ws:{public:"wss://ws.okx.com:8443/ws/v5/public",private:"wss://ws.okx.com:8443/ws/v5/private"}},test:{ws:{public:"wss://wspap.okx.com:8443/ws/v5/public?brokerId=9999",private:"wss://wspap.okx.com:8443/ws/v5/private?brokerId=9999"}}},options:{watchOrderBook:{depth:"books"},watchBalance:"spot",ws:{},checksum:!0},streaming:{ping:this.ping,keepAlive:2e4}})}async subscribe(e,t,i,s={}){await this.loadMarkets();const r=this.urls.api.ws[e];let a=t;const n={channel:t};if(void 0!==i){const e=this.market(i);a+=":"+e.id,n.instId=e.id}const o={op:"subscribe",args:[this.deepExtend(n,s)]};return await this.watch(r,a,o,a)}async watchTrades(e,t,i,s={}){await this.loadMarkets(),e=this.symbol(e);const r=await this.subscribe("public","trades",e,s);return this.newUpdates&&(i=r.getLimit(e,i)),this.filterBySinceLimit(r,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeValue(t,"arg",{}),s=this.safeString(i,"channel"),r=this.safeValue(t,"data",[]),a=this.safeInteger(this.options,"tradesLimit",1e3);for(let t=0;t<r.length;t++){const i=this.parseTrade(r[t]),o=i.symbol,h=s+":"+this.safeString(i.info,"instId");let d=this.safeValue(this.trades,o);void 0===d&&(d=new n(a),this.trades[o]=d),d.append(i),e.resolve(d,h)}return t}async watchTicker(e,t={}){return await this.subscribe("public","tickers",e,t)}handleTicker(e,t){const i=this.safeValue(t,"arg",{}),s=this.safeString(i,"channel"),r=this.safeValue(t,"data",[]);for(let t=0;t<r.length;t++){const i=this.parseTicker(r[t]),a=i.symbol,n=s+":"+this.safeString(i.info,"instId");this.tickers[a]=i,e.resolve(i,n)}return t}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets(),e=this.symbol(e);const a="candle"+this.safeString(this.timeframes,t,t),n=await this.subscribe("public",a,e,r);return this.newUpdates&&(s=n.getLimit(e,s)),this.filterBySinceLimit(n,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeValue(t,"arg",{}),s=this.safeString(i,"channel"),r=this.safeValue(t,"data",[]),a=this.safeString(i,"instId"),n=this.safeMarket(a),h=n.id,d=s.replace("candle",""),c=this.findTimeframe(d);for(let t=0;t<r.length;t++){const i=this.parseOHLCV(r[t],n);this.ohlcvs[h]=this.safeValue(this.ohlcvs,h,{});let d=this.safeValue(this.ohlcvs[h],c);if(void 0===d){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);d=new o(e),this.ohlcvs[h][c]=d}d.append(i);const l=s+":"+a;e.resolve(d,l)}}async watchOrderBook(e,t,i={}){const s=this.safeValue(this.options,"watchOrderBook",{}),r=this.safeString(s,"depth","books");return(await this.subscribe("public",r,e,i)).limit()}handleDelta(e,t){const i=this.safeFloat(t,0),s=this.safeFloat(t,1);e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleOrderBookMessage(e,t,i,s){const r=this.safeValue(t,"asks",[]),n=this.safeValue(t,"bids",[]),o=i.asks,h=i.bids;this.handleDeltas(o,r),this.handleDeltas(h,n);if(this.safeValue(this.options,"checksum",!0)){const i=o.length,r=h.length,n=[];for(let e=0;e<25;e++)e<r&&(n.push(this.numberToString(h[e][0])),n.push(this.numberToString(h[e][1]))),e<i&&(n.push(this.numberToString(o[e][0])),n.push(this.numberToString(o[e][1])));const d=n.join(":");if(this.safeInteger(t,"checksum")!==this.crc32(d,!0)){const t=new a(this.id+" invalid checksum");e.reject(t,s)}}const d=this.safeInteger(t,"ts");return i.timestamp=d,i.datetime=this.iso8601(d),i}handleOrderBook(e,t){const i=this.safeValue(t,"arg",{}),s=this.safeString(i,"channel"),r=this.safeString(t,"action"),a=this.safeValue(t,"data",[]),n=this.safeString(i,"instId"),o=this.safeMarket(n).symbol,h=this.safeInteger({"bbo-tbt":1,books:400,books5:5,"books-l2-tbt":400,"books50-l2-tbt":50},s),d=s+":"+n;if("snapshot"===r)for(let t=0;t<a.length;t++){const i=a[t],s=this.orderBook({},h);this.orderbooks[o]=s,s.symbol=o,this.handleOrderBookMessage(e,i,s,d),e.resolve(s,d)}else if("update"===r){if(o in this.orderbooks){const t=this.orderbooks[o];for(let i=0;i<a.length;i++){const s=a[i];this.handleOrderBookMessage(e,s,t,d),e.resolve(t,d)}}}else if("books5"===s||"bbo-tbt"===s){let t=this.safeValue(this.orderbooks,o);void 0===t&&(t=this.orderBook({},h)),this.orderbooks[o]=t;for(let i=0;i<a.length;i++){const s=a[i],r=this.safeInteger(s,"ts"),n=this.parseOrderBook(s,o,r,"bids","asks",0,1);t.reset(n),e.resolve(t,d)}}return t}authenticate(e={}){this.checkRequiredCredentials();const t=this.urls.api.ws.private,i="authenticated",s=this.client(t);let r=this.safeValue(s.subscriptions,i);if(void 0===r){const a=this.seconds().toString(),n=a+"GET"+"/users/self/verify",o=this.hmac(this.encode(n),this.encode(this.secret),"sha256","base64"),h={op:"login",args:[{apiKey:this.apiKey,passphrase:this.password,timestamp:a,sign:o}]},d=this.extend(h,e);r=this.watch(t,i,d),s.subscriptions[i]=r}return r}async watchBalance(e={}){return await this.loadMarkets(),await this.authenticate(),await this.subscribe("private","account",void 0,e)}handleBalance(e,t){const i=this.safeValue(t,"arg",{}),s=this.safeString(i,"channel"),r="spot",a=this.parseTradingBalance(t),n=this.safeValue(this.balance,r,{}),o=this.deepExtend(n,a);this.balance[r]=this.safeBalance(o),e.resolve(this.balance[r],s)}async watchOrders(e,t,i,s={}){await this.loadMarkets(),await this.authenticate();const r=this.safeValue(this.options,"watchOrders",{});let a=this.safeString(r,"type","ANY");a=this.safeString(s,"type",a);const n=this.safeValue(s,"stop",!1);let o;s=this.omit(s,["type","stop"]),void 0!==e&&(o=this.market(e),e=o.symbol,a=o.type),"future"===a&&(a="futures");const h={instType:a.toUpperCase()},d=n?"orders-algo":"orders",c=await this.subscribe("private",d,e,this.extend(h,s));return this.newUpdates&&(i=c.getLimit(e,i)),this.filterBySymbolSinceLimit(c,e,t,i,!0)}handleOrders(e,t,i){const s=this.safeValue(t,"arg",{}),r=this.safeString(s,"channel"),a=this.safeValue(t,"data",[]);if(a.length>0){const t=this.safeInteger(this.options,"ordersLimit",1e3);void 0===this.orders&&(this.orders=new h(t));const i=this.orders,s=[],n=this.parseOrders(a);for(let e=0;e<n.length;e++){const t=n[e];i.append(t);const r=t.symbol,a=this.market(r);s.push(a.id)}e.resolve(this.orders,r);for(let t=0;t<s.length;t++){const i=r+":"+s[t];e.resolve(this.orders,i)}}}handleSubscriptionStatus(e,t){return t}handleAuthenticate(e,t){e.resolve(t,"authenticated")}ping(e){return"ping"}handlePong(e,t){return e.lastPong=this.milliseconds(),t}handleErrorMessage(e,t){const i=this.safeInteger(t,"code");try{if(i){const e=this.id+" "+this.json(t);this.throwExactlyMatchedException(this.exceptions.exact,i,e);const s=this.safeValue(t,"message");void 0!==s&&this.throwBroadlyMatchedException(this.exceptions.broad,s,e)}}catch(t){if(t instanceof r){const i="authenticated";return e.reject(t,i),i in e.subscriptions&&delete e.subscriptions[i],!1}}return t}handleMessage(e,t){if(!this.handleErrorMessage(e,t))return;if("pong"===t)return this.handlePong(e,t);const i=this.safeString(t,"event");if(void 0!==i){const s={login:this.handleAuthenticate,subscribe:this.handleSubscriptionStatus},r=this.safeValue(s,i);return void 0===r?t:r.call(this,e,t)}{const i=this.safeValue(t,"arg",{}),s=this.safeString(i,"channel"),r={"bbo-tbt":this.handleOrderBook,books:this.handleOrderBook,books5:this.handleOrderBook,"books50-l2-tbt":this.handleOrderBook,"books-l2-tbt":this.handleOrderBook,tickers:this.handleTicker,trades:this.handleTrades,account:this.handleBalance,orders:this.handleOrders,"orders-algo":this.handleOrders},a=this.safeValue(r,s);if(void 0!==a)return a.call(this,e,t);if(0!==s.indexOf("candle"))return t;this.handleOHLCV(e,t)}}}},36053:function(e,t,i){"use strict";const s=i(50788),r=i(6832),{ArrayCache:a,ArrayCacheByTimestamp:n,ArrayCacheBySymbolById:o}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchTicker:!0,watchTickers:!1,watchTrades:!0,watchMyTrades:!0,watchOrders:!0,watchOrderBook:!0,watchOHLCV:!0},urls:{test:{ws:"wss://testnet.phemex.com/ws"},api:{ws:"wss://phemex.com/ws"}},options:{tradesLimit:1e3,OHLCVLimit:1e3},streaming:{keepAlive:2e4}})}fromEn(e,t){if(void 0===e)return;const i=new r(e);return i.decimals=this.sum(i.decimals,t),i.reduce(),i.toString()}fromEp(e,t){return void 0===e||void 0===t?e:this.fromEn(e,this.safeInteger(t,"priceScale"))}fromEv(e,t){return void 0===e||void 0===t?e:this.fromEn(e,this.safeInteger(t,"valueScale"))}fromEr(e,t){return void 0===e||void 0===t?e:this.fromEn(e,this.safeInteger(t,"ratioScale"))}requestId(){const e=this.sum(this.safeInteger(this.options,"requestId",0),1);return this.options.requestId=e,e}parseSwapTicker(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t)).symbol,a=this.safeIntegerProduct(e,"timestamp",1e-6),n=this.fromEp(this.safeString(e,"close"),t),o=this.parseNumber(n),h=this.parseNumber(this.fromEv(this.safeString(e,"turnover"),t)),d=this.parseNumber(this.fromEv(this.safeString(e,"volume"),t));let c,l,u;const f=this.omitZero(this.fromEp(this.safeString(e,"open"),t)),p=this.parseNumber(f);void 0!==f&&void 0!==n&&(c=this.parseNumber(r.stringSub(n,f)),u=this.parseNumber(r.stringDiv(r.stringAdd(n,f),"2")),l=this.parseNumber(r.stringMul(r.stringSub(r.stringDiv(n,f),"1"),"100")));return{symbol:s,timestamp:a,datetime:this.iso8601(a),high:this.parseNumber(this.fromEp(this.safeString(e,"high"),t)),low:this.parseNumber(this.fromEp(this.safeString(e,"low"),t)),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:p,close:o,last:o,previousClose:void 0,change:c,percentage:l,average:u,baseVolume:d,quoteVolume:h,info:e}}handleTicker(e,t){let i,s="market24h",r=this.safeValue(t,s);void 0===r?(s="spot_market24h",r=this.safeValue(t,s),i=this.parseTicker(r)):i=this.parseSwapTicker(r);const a=i.symbol,n=s+":"+a,o=this.safeIntegerProduct(t,"timestamp",1e-6);i.timestamp=o,i.datetime=this.iso8601(o),this.tickers[a]=i,e.resolve(i,n)}async watchBalance(e={}){await this.loadMarkets();const[t,i]=this.handleMarketTypeAndParams("watchBalance",void 0,e),s=t+":balance";return await this.subscribePrivate(t,s,i)}handleBalance(e,t,i){for(let e=0;e<i.length;e++){const t=i[e],s=this.safeString(t,"currency"),a=this.safeCurrencyCode(s),n=this.safeValue(this.currencies,a,{}),o=this.safeInteger(n,"valueScale",8),h=this.account();let d=this.safeString(t,"totalUsedBalanceEv");if(void 0===d){const e=this.safeString(t,"lockedTradingBalanceEv"),i=this.safeString(t,"lockedWithdrawEv");d=r.stringAdd(e,i)}const c=this.safeString2(t,"accountBalanceEv","balanceEv");h.used=this.fromEn(d,o),h.total=this.fromEn(c,o),this.balance[a]=h,this.balance=this.safeBalance(this.balance)}const s=e+":balance";t.resolve(this.balance,s)}handleTrades(e,t){const i=this.safeString(t,"symbol"),s=this.safeMarket(i),r=s.symbol,n="trade:"+r;let o=this.safeValue(this.trades,r);if(void 0===o){const e=this.safeInteger(this.options,"tradesLimit",1e3);o=new a(e),this.trades[r]=o}const h=this.safeValue(t,"trades",[]),d=this.parseTrades(h,s);for(let e=0;e<d.length;e++)o.append(d[e]);e.resolve(o,n)}handleOHLCV(e,t){const i="kline",s=this.safeString(t,"symbol"),r=this.safeMarket(s),a=r.symbol,o=this.safeValue(t,i,[]),h=this.safeValue(o,0,[]),d=this.safeString(h,1),c=this.findTimeframe(d);if(void 0!==c){const t=i+":"+c+":"+a,s=this.parseOHLCVs(o,r);this.ohlcvs[a]=this.safeValue(this.ohlcvs,a,{});let h=this.safeValue(this.ohlcvs[a],c);if(void 0===h){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);h=new n(e),this.ohlcvs[a][c]=h}for(let e=0;e<s.length;e++){const t=s[e];h.append(t)}e.resolve(h,t)}}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e);e=i.symbol;const s=i.spot?"spot_market24h":"market24h",r=this.urls.api.ws,a=s+".subscribe",n=s+":"+e,o={method:a,id:this.requestId(),params:[]},h=this.deepExtend(o,t);return await this.watch(r,n,h,a)}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);e=r.symbol;const a=this.urls.api.ws,n="trade",o=n+":"+e,h={method:n+".subscribe",id:this.requestId(),params:[r.id]},d=this.deepExtend(h,s),c=await this.watch(a,o,d,o);return this.newUpdates&&(i=c.getLimit(e,i)),this.filterBySinceLimit(c,t,i,"timestamp",!0)}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);e=s.symbol;const r=this.urls.api.ws,a="orderbook",n=a+":"+e,o={method:a+".subscribe",id:this.requestId(),params:[s.id]},h=this.deepExtend(o,i);return(await this.watch(r,n,h,n)).limit()}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;const n=this.urls.api.ws,o="kline",h=o+":"+t+":"+e,d={method:o+".subscribe",id:this.requestId(),params:[a.id,this.safeInteger(this.timeframes,t)]},c=this.deepExtend(d,r),l=await this.watch(n,h,c,h);return this.newUpdates&&(s=l.getLimit(e,s)),this.filterBySinceLimit(l,i,s,0,!0)}handleDelta(e,t,i){const s=this.parseBidAsk(t,0,1,i);e.storeArray(s)}handleDeltas(e,t,i){for(let s=0;s<t.length;s++)this.handleDelta(e,t[s],i)}handleOrderBook(e,t){const i=this.safeString(t,"symbol"),s=this.safeMarket(i),r=s.symbol,a=this.safeString(t,"type"),n=this.safeInteger(t,"depth"),o="orderbook:"+r,h=this.safeInteger(t,"sequence"),d=this.safeIntegerProduct(t,"timestamp",1e-6);if("snapshot"===a){const i=this.safeValue(t,"book",{}),a=this.parseOrderBook(i,r,d,"bids","asks",0,1,s);a.nonce=h;const c=this.orderBook(a,n);this.orderbooks[r]=c,e.resolve(c,o)}else{const i=this.safeValue(this.orderbooks,r);if(void 0!==i){const a=this.safeValue(t,"book",{}),n=this.safeValue(a,"asks",[]),c=this.safeValue(a,"bids",[]);this.handleDeltas(i.asks,n,s),this.handleDeltas(i.bids,c,s),i.nonce=h,i.timestamp=d,i.datetime=this.iso8601(d),this.orderbooks[r]=i,e.resolve(i,o)}}}async watchMyTrades(e,t,i,s={}){await this.loadMarkets();let r,a,n="trades";void 0!==e&&(r=this.market(e),e=r.symbol,n=n+":"+r.symbol),[a,s]=this.handleMarketTypeAndParams("watchMyTrades",r,s),void 0===e&&(n=n+":"+a);const o=await this.subscribePrivate(a,n,s);return this.newUpdates&&(i=o.getLimit(e,i)),this.filterBySymbolSinceLimit(o,e,t,i,!0)}handleMyTrades(e,t){const i="trades";if(0===t.length)return;let s=this.myTrades;if(void 0===s){const e=this.safeInteger(this.options,"tradesLimit",1e3);s=new o(e)}const r={};let a;for(let e=0;e<t.length;e++){const i=t[e],n=this.safeString(i,"symbol"),o=this.safeMarket(n),h=this.parseTrade(i);s.append(h);const d=h.symbol;void 0===a&&(a=o.type),r[d]=!0}const n=Object.keys(r);for(let t=0;t<n.length;t++){const r=i+":"+n[t];e.resolve(s,r)}const h=i+":"+a;e.resolve(s,h)}async watchOrders(e,t,i,s={}){await this.loadMarkets();let r,a,n="orders";void 0!==e&&(r=this.market(e),e=r.symbol,n=n+":"+r.symbol),[a,s]=this.handleMarketTypeAndParams("watchOrders",r,s),void 0===e&&(n=n+":"+a);const o=await this.subscribePrivate(a,n,s);return this.newUpdates&&(i=o.getLimit(e,i)),this.filterBySymbolSinceLimit(o,e,t,i,!0)}handleOrders(e,t){let i=[];const s=[];if("closed"in t||"fills"in t||"open"in t){const e=this.safeValue(t,"closed",[]),r=this.safeValue(t,"open",[]),a=this.arrayConcat(r,e);if(0===a.length)return;i=this.safeValue(t,"fills",[]);for(let e=0;e<a.length;e++){const t=a[e],i=this.parseOrder(t);s.push(i)}}else for(let e=0;e<t.length;e++){const r=t[e],a=this.safeString(r,"action");void 0!==a&&"Cancel"!==a&&i.push(r);const n=this.parseWSSwapOrder(r);s.push(n)}this.handleMyTrades(e,i);const r=this.safeInteger(this.options,"ordersLimit",1e3),a={};let n;void 0===this.orders&&(this.orders=new o(r));const h=this.orders;for(let e=0;e<s.length;e++){const t=s[e];h.append(t);const i=t.symbol,r=this.market(i);void 0===n&&(n=r.type),a[i]=!0}const d=Object.keys(a);for(let t=0;t<d.length;t++){const i="orders:"+d[t];e.resolve(this.orders,i)}const c="orders:"+n;e.resolve(this.orders,c)}parseWSSwapOrder(e,t){const i=this.safeString(e,"orderID");let s=this.safeString(e,"clOrdID");void 0!==s&&s.length<1&&(s=void 0);const r=this.safeString(e,"symbol"),a=(t=this.safeMarket(r,t)).symbol,n=this.parseOrderStatus(this.safeString(e,"ordStatus")),o=this.safeStringLower(e,"side"),h=this.parseOrderType(this.safeString(e,"ordType")),d=this.parseNumber(this.fromEp(this.safeString(e,"priceEp"),t)),c=this.safeString(e,"orderQty"),l=this.safeString(e,"cumQty"),u=this.safeString(e,"leavesQty"),f=this.safeIntegerProduct(e,"actionTimeNs",1e-6),p=this.safeString(e,"cumValueEv"),m=this.fromEv(p,t);let g=this.safeIntegerProduct(e,"transactTimeNs",1e-6);0===g&&(g=void 0);const y=this.parseTimeInForce(this.safeString(e,"timeInForce")),b=this.safeString(e,"stopPx"),v="PO"===y;return this.safeOrder({info:e,id:i,clientOrderId:s,datetime:this.iso8601(f),timestamp:f,lastTradeTimestamp:g,symbol:a,type:h,timeInForce:y,postOnly:v,side:o,price:d,stopPrice:b,triggerPrice:b,amount:c,filled:l,remaining:u,cost:m,average:void 0,status:n,fee:void 0,trades:void 0},t)}handleMessage(e,t){const i=this.safeInteger(t,"id");if(void 0!==i){const s=e.subscriptions,r=Object.values(s);for(let s=0;s<r.length;s++){const a=r[s];if(!0!==a){const s=this.safeInteger(a,"id");if(void 0!==s&&s===i){const i=this.safeValue(a,"method");if(void 0!==i)return void i.call(this,e,t)}}}}if("market24h"in t||"spot_market24h"in t)return this.handleTicker(e,t);if("trades"in t)return this.handleTrades(e,t);if("kline"in t)return this.handleOHLCV(e,t);if("book"in t)return this.handleOrderBook(e,t);if("orders"in t){const i=this.safeValue(t,"orders",{});this.handleOrders(e,i)}if("accounts"in t||"wallets"in t){const i="accounts"in t?"swap":"spot",s=this.safeValue2(t,"accounts","wallets",[]);this.handleBalance(i,e,s)}}handleAuthenticate(e,t){return e.futures.authenticated.resolve(1),t}async subscribePrivate(e,t,i={}){await this.loadMarkets(),await this.authenticate();const s=this.urls.api.ws,r=this.seconds(),a="spot"===e?"wo.subscribe":"aop.subscribe";let n={id:r,method:a,params:[]};n=this.extend(n,i);const o={id:r,messageHash:t};return await this.watch(s,t,n,a,o)}async authenticate(e={}){this.checkRequiredCredentials();const t=this.urls.api.ws,i=this.client(t),s=this.seconds(),r="authenticated",a=i.future(r);if(void 0===this.safeValue(i.subscriptions,r)){const e=this.safeInteger(this.options,"expires",120),i=this.seconds()+e,a=this.apiKey+i.toString(),n=this.hmac(this.encode(a),this.encode(this.secret),"sha256"),o={method:"user.auth",params:["API",this.apiKey,n,i],id:s},h={id:s,method:this.handleAuthenticate};this.spawn(this.watch,t,r,o,r,h)}return await a}}},12955:function(e,t,i){"use strict";const s=i(2041),{ArrayCache:r}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchOrderBook:!0,watchTrades:!0,watchTicker:!0},urls:{api:{ws:"wss://api.exchange.ripio.com/ws/v2/consumer/non-persistent/public/default/"}},options:{tradesLimit:1e3,uuid:this.uuid()}})}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);e=r.symbol;const a="trades",n=a+"_"+r.id.toLowerCase(),o=this.urls.api.ws+n+"/"+this.options.uuid,h={name:a,symbol:e,messageHash:n,method:this.handleTrade},d=await this.watch(o,n,void 0,n,h);return this.newUpdates&&(i=d.getLimit(e,i)),this.filterBySinceLimit(d,t,i,"timestamp",!0)}handleTrade(e,t,i){const s=this.safeString(t,"payload");if(void 0===s)return t;const a=JSON.parse(this.base64ToString(s)),n=this.safeString(i,"symbol"),o=this.safeString(i,"messageHash"),h=this.market(n),d=this.parseTrade(a,h);let c=this.safeValue(this.trades,n);if(void 0===c){const e=this.safeInteger(this.options,"tradesLimit",1e3);c=new r(e),this.trades[n]=c}c.append(d),e.resolve(c,o)}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e);e=i.symbol;const s="rate",r=s+"_"+i.id.toLowerCase(),a=this.urls.api.ws+r+"/"+this.options.uuid,n={name:s,symbol:e,messageHash:r,method:this.handleTicker};return await this.watch(a,r,void 0,r,n)}handleTicker(e,t,i){const s=this.safeString(t,"payload");if(void 0===s)return t;const r=JSON.parse(this.base64ToString(s)),a=this.parseTicker(r),n=this.parse8601(this.safeString(t,"publishTime"));a.timestamp=n,a.datetime=this.iso8601(n);const o=a.symbol;this.tickers[o]=a;const h=this.safeString(i,"messageHash");return void 0!==h&&e.resolve(a,h),t}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);e=s.symbol;const r="orderbook",a=r+"_"+s.id.toLowerCase(),n=this.urls.api.ws+a+"/"+this.options.uuid,o=this.client(n),h={name:r,symbol:e,messageHash:a,method:this.handleOrderBook};if(!(a in o.subscriptions)){this.orderbooks[e]=this.orderBook({}),o.subscriptions[a]=h;const t=this.safeValue(this.options,"fetchOrderBookSnapshot",{}),i=this.safeInteger(t,"delay",this.rateLimit);this.delay(i,this.fetchOrderBookSnapshot,o,h)}return(await this.watch(n,a,void 0,a,h)).limit()}async fetchOrderBookSnapshot(e,t){const i=this.safeString(t,"symbol"),s=this.safeString(t,"messageHash");try{const t=await this.fetchOrderBook(i),r=this.orderbooks[i],a=r.cache;r.reset(t);for(let t=0;t<a.length;t++){const i=a[t];this.handleOrderBookMessage(e,i,r)}this.orderbooks[i]=r,e.resolve(r,s)}catch(t){e.reject(t,s)}}handleOrderBook(e,t,i){const s=this.safeString(i,"messageHash"),r=this.safeString(i,"symbol"),a=this.safeValue(this.orderbooks,r);return void 0===a||(void 0===a.nonce?a.cache.push(t):(this.handleOrderBookMessage(e,t,a),e.resolve(a,s))),t}handleOrderBookMessage(e,t,i){const s=this.safeString(t,"payload");if(void 0===s)return t;const r=JSON.parse(this.base64ToString(s)),a=this.safeInteger(r,"updated_id");if(a>i.nonce){const e=this.safeValue(r,"sell",[]),s=this.safeValue(r,"buy",[]);this.handleDeltas(i.asks,e,i.nonce),this.handleDeltas(i.bids,s,i.nonce),i.nonce=a;const n=this.parse8601(this.safeString(t,"publishTime"));i.timestamp=n,i.datetime=this.iso8601(n)}return i}handleDelta(e,t){const i=this.safeFloat(t,"price"),s=this.safeFloat(t,"amount");e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}async ack(e,t){await e.send({messageId:t})}handleMessage(e,t){const i=this.safeString(t,"messageId");void 0!==i&&this.spawn(this.ack,e,i);const s=Object.keys(e.subscriptions),r=this.safeString(s,0),a=this.safeValue(e.subscriptions,r,{}),n=this.safeValue(a,"method");return void 0!==n?n.call(this,e,t,a):t}}},24377:function(e,t,i){"use strict";const s=i(7705),{ArrayCache:r}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchOrderBook:!0,watchTicker:!0,watchTrades:!0},urls:{api:{ws:"wss://api.upbit.com/websocket/v1"}},options:{tradesLimit:1e3}})}async watchPublic(e,t,i={}){await this.loadMarkets();const s=this.market(e);e=s.symbol;const r=s.id,a=this.urls.api.ws;this.options[t]=this.safeValue(this.options,t,{}),this.options[t][e]=!0;const n=Object.keys(this.options[t]),o=this.marketIds(n),h=[{ticket:this.uuid()},{type:t,codes:o}],d=t+":"+r;return await this.watch(a,d,h,d)}async watchTicker(e,t={}){return await this.watchPublic(e,"ticker")}async watchTrades(e,t,i,s={}){await this.loadMarkets(),e=this.symbol(e);const r=await this.watchPublic(e,"trade");return this.newUpdates&&(i=r.getLimit(e,i)),this.filterBySinceLimit(r,t,i,"timestamp",!0)}async watchOrderBook(e,t,i={}){return(await this.watchPublic(e,"orderbook")).limit()}handleTicker(e,t){const i="ticker:"+this.safeString(t,"code"),s=this.parseTicker(t),r=s.symbol;this.tickers[r]=s,e.resolve(s,i)}handleOrderBook(e,t){const i=this.safeString(t,"code"),s=this.safeSymbol(i,void 0,"-"),r=this.safeString(t,"stream_type"),a=this.safeValue(this.options,"watchOrderBook",{}),n=this.safeInteger(a,"limit",15);"SNAPSHOT"===r&&(this.orderbooks[s]=this.orderBook({},n));const o=this.orderbooks[s];o.reset({}),o.symbol=s;const h=o.bids,d=o.asks,c=this.safeValue(t,"orderbook_units",[]);for(let e=0;e<c.length;e++){const t=c[e],i=this.safeFloat(t,"ask_price"),s=this.safeFloat(t,"ask_size"),r=this.safeFloat(t,"bid_price"),a=this.safeFloat(t,"bid_size");d.store(i,s),h.store(r,a)}const l=this.safeInteger(t,"timestamp"),u=this.iso8601(l);o.timestamp=l,o.datetime=u;const f="orderbook:"+i;e.resolve(o,f)}handleTrades(e,t){const i=this.parseTrade(t),s=i.symbol;let a=this.safeValue(this.trades,s);if(void 0===a){const e=this.safeInteger(this.options,"tradesLimit",1e3);a=new r(e),this.trades[s]=a}a.append(i);const n="trade:"+this.safeString(t,"code");e.resolve(a,n)}handleMessage(e,t){const i={ticker:this.handleTicker,orderbook:this.handleOrderBook,trade:this.handleTrades},s=this.safeString(t,"type"),r=this.safeValue(i,s);r&&r.call(this,e,t)}}},55905:function(e,t,i){"use strict";const s=i(79741),{NotSupported:r,ExchangeError:a}=i(73449),{ArrayCacheBySymbolById:n,ArrayCacheByTimestamp:o,ArrayCache:h}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchTicker:!0,watchTickers:!0,watchTrades:!0,watchMyTrades:!0,watchOrders:!0,watchOrderBook:!0,watchOHLCV:!0},urls:{api:{ws:"wss://stream.wazirx.com/stream"}},options:{},streaming:{},exceptions:{},api:{private:{post:{create_auth_token:1}}}})}async watchBalance(e={}){await this.loadMarkets();const t=await this.authenticate(e),i="balance",s=this.urls.api.ws,r={event:"subscribe",streams:["outboundAccountPosition"],auth_key:t},a=this.deepExtend(r,e);return await this.watch(s,i,a,i)}handleBalance(e,t){const i=this.safeValue(t,"data",{}),s=this.safeValue(i,"B",[]);for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"a"),r=this.safeCurrencyCode(i),a=this.safeNumber(t,"b"),n=this.safeNumber(t,"l"),o=this.account();o.free=a,o.used=n,this.balance[r]=o}this.balance=this.safeBalance(this.balance);e.resolve(this.balance,"balance")}parseWSTrade(e,t){const i=this.safeInteger(e,"E"),s=this.safeString(e,"s");t=this.safeMarket(s,t);const r=this.safeString(e,"f"),a=this.safeString(e,"U"),n=!0===this.safeValue(e,"m");let o;return void 0!==r&&(o={cost:r,currency:this.safeCurrencyCode(a),rate:void 0}),this.safeTrade({id:this.safeString(e,"t"),info:e,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,order:this.safeStringN(e,["o"]),type:void 0,side:this.safeString(e,"S"),takerOrMaker:n?"maker":"taker",price:this.safeString(e,"p"),amount:this.safeString(e,"q"),cost:void 0,fee:o},t)}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s=this.urls.api.ws,r="ticker:"+i.symbol,a={event:"subscribe",streams:["!ticker@arr"]},n=this.deepExtend(a,t);return await this.watch(s,r,n,"tickers")}async watchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=this.urls.api.ws,s="tickers",r={event:"subscribe",streams:["!ticker@arr"]},a=this.deepExtend(r,t),n=await this.watch(i,s,a,s);return this.filterByArray(n,"symbol",e,!1)}handleTicker(e,t){const i=this.safeValue(t,"data",[]);for(let t=0;t<i.length;t++){const s=i[t],r=this.parseWSTicker(s),a=r.symbol;this.tickers[a]=r;const n="ticker:"+a;e.resolve(r,n)}e.resolve(this.tickers,"tickers")}parseWSTicker(e,t){const i=this.safeString(e,"s"),s=this.safeInteger(e,"E");return this.safeTicker({symbol:this.safeSymbol(i,t),timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"h"),low:this.safeString(e,"l"),bid:this.safeNumber(e,"b"),bidVolume:void 0,ask:this.safeNumber(e,"a"),askVolume:void 0,vwap:void 0,open:this.safeString(e,"o"),close:void 0,last:this.safeString(e,"l"),previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:void 0,quoteVolume:this.safeString(e,"q"),info:e},t)}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);e=r.symbol;const a=r.id+"@trades",n=this.urls.api.ws,o={event:"subscribe",streams:[a]},h=this.extend(o,s),d=await this.watch(n,a,h,a);return this.newUpdates&&(i=d.getLimit(e,i)),this.filterBySinceLimit(d,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeValue(t,"data",{}),s=this.safeValue(i,"trades",[]),r=this.safeString(t,"stream"),a=r.split("@"),n=this.safeString(a,0),o=this.safeMarket(n),d=this.safeSymbol(n,o);let c=this.safeValue(this.trades,d);if(void 0===c){const e=this.safeInteger(this.options,"tradesLimit",1e3);c=new h(e),this.trades[d]=c}for(let e=0;e<s.length;e++){const t=this.parseWSTrade(s[e],o);c.append(t)}e.resolve(c,r)}async watchMyTrades(e,t,i,s={}){await this.loadMarkets();const r=await this.authenticate(s);if(void 0!==e){e=this.market(e).symbol}const a=this.urls.api.ws,n="myTrades",o={event:"subscribe",streams:["ownTrade"],auth_key:r},h=this.deepExtend(o,s),d=await this.watch(a,n,h,n);return this.newUpdates&&(i=d.getLimit(e,i)),this.filterBySymbolSinceLimit(d,e,t,i,!0)}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;const n=this.urls.api.ws,o="ohlcv:"+e+":"+t,h={event:"subscribe",streams:[a.id+"@kline_"+t]},d=this.deepExtend(h,r),c=await this.watch(n,o,d,o);return this.newUpdates&&(s=c.getLimit(e,s)),this.filterBySinceLimit(c,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeValue(t,"data",{}),s=this.safeString(i,"s"),r=this.safeMarket(s),a=this.safeSymbol(s,r),n=this.safeString(i,"i");this.ohlcvs[a]=this.safeValue(this.ohlcvs,a,{});let h=this.safeValue(this.ohlcvs[a],n);if(void 0===h){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);h=new o(e),this.ohlcvs[a][n]=h}const d=this.parseWsOHLCV(i,r);h.append(d);const c="ohlcv:"+a+":"+n;e.resolve(h,c)}parseWsOHLCV(e,t){return[this.safeInteger(e,"t"),this.safeNumber(e,"o"),this.safeNumber(e,"c"),this.safeNumber(e,"h"),this.safeNumber(e,"l"),this.safeNumber(e,"v")]}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);e=s.symbol;const r=this.urls.api.ws,a="orderbook:"+e,n={event:"subscribe",streams:[s.id+"@depth"]},o=this.deepExtend(n,i);return(await this.watch(r,a,o,a)).limit()}handleDelta(e,t){const i=this.parseBidAsk(t,0,1);e.storeArray(i)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleOrderBook(e,t){const i=this.safeValue(t,"data",{}),s=this.safeInteger(i,"E"),r=this.safeString(i,"s"),a=this.safeMarket(r).symbol,n="orderbook:"+a,o=this.safeValue(this.orderbooks,a);if(void 0===o){const e=this.parseOrderBook(i,a,s,"b","a"),t=this.orderBook(e);this.orderbooks[a]=t}else{const e=this.safeValue(i,"a",[]),t=this.safeValue(i,"b",[]);this.handleDeltas(o.asks,e),this.handleDeltas(o.bids,t),o.nonce=s,o.timestamp=s,o.datetime=this.iso8601(s),this.orderbooks[a]=o}e.resolve(this.orderbooks[a],n)}async watchOrders(e,t,i,s={}){if(await this.loadMarkets(),void 0!==e){e=this.market(e).symbol}const r="orders",a={event:"subscribe",streams:["orderUpdate"],auth_key:await this.authenticate(s)},n=this.urls.api.ws,o=this.deepExtend(a,s),h=await this.watch(n,r,o,r,o);return this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySymbolSinceLimit(h,e,t,i,!0)}handleOrder(e,t){const i=this.safeValue(t,"data",{}),s=this.parseWSOrder(i);if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new n(e)}this.orders.append(s);let r="orders";e.resolve(this.orders,r),r+=":"+s.symbol,e.resolve(this.orders,r)}parseWSOrder(e){const t=this.safeInteger(e,"O"),i=this.safeString(e,"s"),s=this.safeString(e,"X"),r=this.safeMarket(i);return this.safeOrder({info:e,id:this.safeString(e,"i"),clientOrderId:this.safeString(e,"c"),datetime:this.iso8601(t),timestamp:t,lastTradeTimestamp:void 0,symbol:r.symbol,type:this.safeValue(e,"m")?"limit":"market",timeInForce:void 0,postOnly:void 0,side:this.safeString(e,"o"),price:this.safeString(e,"p"),stopPrice:void 0,triggerPrice:void 0,amount:this.safeString(e,"V"),filled:void 0,remaining:this.safeString(e,"q"),cost:void 0,average:this.safeString(e,"v"),status:this.parseOrderStatus(s),fee:void 0,trades:void 0},r)}handleMyTrades(e,t){const i=this.safeValue(t,"data",{});let s;if(void 0===this.myTrades){const e=this.safeInteger(this.options,"tradesLimit",1e3);s=new n(e),this.myTrades=s}else s=this.myTrades;const r=this.parseWSTrade(i);s.append(r),e.resolve(s,"myTrades")}handleConnected(e,t){return t}handleSubscribed(e,t){return t}handleError(e,t){throw new a(this.id+" "+this.json(t))}handleMessage(e,t){if("error"===this.safeString(t,"status"))return this.handleError(e,t);const i=this.safeString(t,"event"),s={error:this.handleError,connected:this.handleConnected,subscribed:this.handleSubscribed},a=this.safeValue(s,i);if(void 0!==a)return a.call(this,e,t);const n=this.safeString(t,"stream",""),o={"ticker@arr":this.handleTicker,"@depth":this.handleOrderBook,"@kline":this.handleOHLCV,"@trades":this.handleTrades,outboundAccountPosition:this.handleBalance,orderUpdate:this.handleOrder,ownTrade:this.handleMyTrades},h=Object.keys(o);for(let i=0;i<h.length;i++)if(this.inArray(h[i],n)){return o[h[i]].call(this,e,t)}throw new r(this.id+" this message type is not supported yet. Message: "+this.json(t))}async authenticate(e={}){const t=this.urls.api.ws,i=this.client(t),s="authenticated",r=this.milliseconds();let a=this.safeValue(i.subscriptions,s);const n=this.safeInteger(a,"expires");return(void 0===a||r>n)&&(a=await this.privatePostCreateAuthToken(),a.expires=r+1e3*this.safeInteger(a,"timeout_duration"),i.subscriptions[s]=a),this.safeString(a,"auth_key")}}},89997:function(e,t,i){"use strict";const s=i(70390),r=i(6832),{AuthenticationError:a,BadRequest:n,ArgumentsRequired:o}=i(73449),{ArrayCache:h,ArrayCacheBySymbolById:d,ArrayCacheByTimestamp:c}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!0,watchMyTrades:!0,watchOHLCV:!0,watchOrderBook:!0,watchOrders:!0,watchTicker:!0,watchTrades:!0},urls:{api:{ws:"wss://api.whitebit.com/ws"}},options:{timeframes:{"1m":"60","5m":"300","15m":"900","30m":"1800","1h":"3600","4h":"14400","8h":"28800","1d":"86400","1w":"604800"},watchOrderBook:{priceInterval:0}},streaming:{ping:this.ping},exceptions:{ws:{exact:{1:n,2:n,4:n,6:a}}}})}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);e=a.symbol;const n=this.safeValue(this.options,"timeframes",{}),o=this.safeInteger(n,t),h="candles:"+e,d=[a.id,o],c=await this.watchPublic(h,"candles_subscribe",d,r);return this.newUpdates&&(s=c.getLimit(e,s)),this.filterBySinceLimit(c,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeValue(t,"params",[]);for(let t=0;t<i.length;t++){const s=i[t],r=this.safeString(s,7),a=this.safeMarket(r),n=a.symbol,o="candles:"+n,h=this.parseOHLCV(s,a);this.ohlcvs[n]=this.safeValue(this.ohlcvs,n);let d=this.ohlcvs[n];if(void 0===d){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);d=new c(e),this.ohlcvs[n]=d}d.append(h),e.resolve(d,o)}return t}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e);void 0===t&&(t=10);const r="orderbook:"+s.symbol,a=this.safeValue(this.options,"watchOrderBook",{}),n=this.safeString(a,"priceInterval","0"),o=this.safeString(i,"priceInterval",n);i=this.omit(i,"priceInterval");const h=[s.id,t,o,!0];return(await this.watchPublic(r,"depth_subscribe",h,i)).limit()}handleOrderBook(e,t){const i=this.safeValue(t,"params",[]),s=this.safeValue(i,0),r=this.safeString(i,2),a=this.safeMarket(r).symbol,n=this.safeValue(i,1);let o;if(a in this.orderbooks?o=this.orderbooks[a]:(o=this.orderBook(),this.orderbooks[a]=o),s){const e=this.parseOrderBook(n,a);o.reset(e)}else{const e=this.safeValue(n,"asks",[]),t=this.safeValue(n,"bids",[]);this.handleDeltas(o.asks,e),this.handleDeltas(o.bids,t)}const h="orderbook:"+a;e.resolve(o,h)}handleDelta(e,t){const i=this.safeFloat(t,0),s=this.safeFloat(t,1);e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}async watchTicker(e,t={}){await this.loadMarkets();const i="ticker:"+(e=this.market(e).symbol);return await this.watchMultipleSubscription(i,"market_subscribe",e,!1,t)}handleTicker(e,t){const i=this.safeValue(t,"params",[]),s=this.safeString(i,0),r=this.safeMarket(s,void 0),a=r.symbol,n=this.safeValue(i,1,{}),o="ticker:"+a,h=this.parseTicker(n,r);this.tickers[a]=h,e.resolve(h,o);const d=Object.keys(e.futures);for(let t=0;t<d.length;t++){const i=d[t];i.indexOf("tickers")>=0&&i.indexOf(a)>=0&&e.resolve(h,i)}return t}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r="trades:"+(e=this.market(e).symbol),a=await this.watchMultipleSubscription(r,"trades_subscribe",e,!1,s);return this.newUpdates&&(i=a.getLimit(e,i)),this.filterBySinceLimit(a,t,i,"timestamp",!0)}handleTrades(e,t){const i=this.safeValue(t,"params",[]),s=this.safeString(i,0),r=this.safeMarket(s),a=r.symbol;let n=this.safeValue(this.trades,a);if(void 0===n){const e=this.safeInteger(this.options,"tradesLimit",1e3);n=new h(e),this.trades[a]=n}const o=this.safeValue(i,1,[]),d=this.parseTrades(o,r);for(let e=0;e<d.length;e++)n.append(d[e]);const c="trades:"+r.symbol;e.resolve(n,c)}async watchMyTrades(e,t,i,s={}){if(void 0===e)throw new o(this.id+" watchMyTrades requires a symbol argument");await this.loadMarkets(),await this.authenticate();const r="myTrades:"+(e=this.market(e).symbol),a=await this.watchMultipleSubscription(r,"deals_subscribe",e,!0,s);return this.newUpdates&&(i=a.getLimit(e,i)),this.filterBySymbolSinceLimit(a,e,t,i,!0)}handleMyTrades(e,t,i){const s=this.safeValue(t,"params");if(void 0===this.myTrades){const e=this.safeInteger(this.options,"tradesLimit",1e3);this.myTrades=new h(e)}const r=this.myTrades,a=this.parseWsTrade(s);r.append(a);const n="myTrades:"+a.symbol;e.resolve(r,n)}parseWsTrade(e,t){const i=this.safeString(e,3),s=this.safeTimestamp(e,1),r=this.safeString(e,0),a=this.safeString(e,4),n=this.safeString(e,5),o=this.safeString(e,2);let h;t=this.safeMarket(o,t);const d=this.safeString(e,6);return void 0!==d&&(h={cost:d,currency:t.quote}),this.safeTrade({id:r,info:e,timestamp:s,datetime:this.iso8601(s),symbol:t.symbol,order:i,type:void 0,side:void 0,takerOrMaker:void 0,price:a,amount:n,cost:void 0,fee:h},t)}async watchOrders(e,t,i,s={}){if(void 0===e)throw new o(this.id+" watchOrders requires a symbol argument");await this.loadMarkets(),await this.authenticate();const r="orders:"+(e=this.market(e).symbol),a=await this.watchMultipleSubscription(r,"ordersPending_subscribe",e,!1,s);return this.newUpdates&&(i=a.getLimit(e,i)),this.filterBySymbolSinceLimit(a,e,t,i,!0)}handleOrder(e,t,i){const s=this.safeValue(t,"params",[]),r=this.safeValue(s,1);if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new d(e)}const a=this.orders,n=this.safeInteger(s,0),o=this.parseWsOrder(r,n);a.append(o);const h="orders:"+o.symbol;e.resolve(this.orders,h)}parseWsOrder(e,t,i){const s=this.safeString(e,"market");i=this.safeMarket(s,i);const a=this.safeString(e,"id"),n=this.omitZero(this.safeString(e,"client_order_id")),o=this.safeString(e,"price"),h=this.safeString(e,"deal_stock"),d=this.safeString(e,"deal_money"),c=this.safeString(e,"activation_price"),l=this.safeString(e,"type"),u=this.parseWsOrderType(l);let f,p;"market"===u?(f=this.safeString(e,"deal_stock"),p="0"):(p=this.safeString(e,"left"),f=this.safeString(e,"amount"));const m=this.safeTimestamp(e,"ctime"),g=this.safeTimestamp(e,"mtime"),y=i.symbol,b=1===this.safeInteger(e,"side")?"sell":"buy",v=this.safeString(e,"deal_fee");let w;return void 0!==v&&(w={cost:this.parseNumber(v),currency:i.quote}),t=1===t||2===t?"open":r.stringEquals(p,"0")?"closed":"canceled",this.safeOrder({info:e,symbol:y,id:a,clientOrderId:n,timestamp:m,datetime:this.iso8601(m),lastTradeTimestamp:g,type:u,timeInForce:void 0,postOnly:void 0,side:b,price:o,stopPrice:c,triggerPrice:c,amount:f,cost:d,average:void 0,filled:h,remaining:p,status:t,fee:w,trades:void 0},i)}parseWsOrderType(e){return this.safeString({1:"limit",2:"market",202:"market",3:"limit",4:"market",5:"limit",6:"market",8:"limit",10:"market"},e,e)}async watchBalance(e={}){let t;await this.loadMarkets(),[t,e]=this.handleMarketTypeAndParams("watchBalance",void 0,e);let i,s="wallet:";"spot"===t?(i="balanceSpot_subscribe",s+="spot"):(i="balanceMargin_subscribe",s+="margin");const r=Object.keys(this.currencies);return await this.watchPrivate(s,i,r,e)}handleBalance(e,t){const i=this.safeString(t,"method"),s=this.safeValue(t,"params"),r=this.safeValue(s,0),a=Object.keys(r),n=this.safeValue(a,0),o=this.safeValue(r,n),h=this.safeCurrencyCode(n),d=this.account();d.free=this.safeString(o,"available"),d.used=this.safeString(o,"freeze"),this.balance[h]=d,this.balance=this.safeBalance(this.balance);let c="wallet:";i.indexOf("Spot")>=0?c+="spot":c+="margin",e.resolve(this.balance,c)}async watchPublic(e,t,i=[],s={}){const r=this.urls.api.ws,a={id:this.nonce(),method:t,params:i},n=this.extend(a,s);return await this.watch(r,e,n,e)}async watchMultipleSubscription(e,t,i,s=!1,r={}){await this.loadMarkets();const a=this.urls.api.ws,n=this.nonce(),o=this.safeValue(this.clients,a);let h;if(void 0===o){const o={},d=this.market(i).id;o[d]=!0;let c=[d];s&&(c=[c]),h={id:n,method:t,params:c};const l=this.extend(h,r);return await this.watch(a,e,l,t,o)}{const r=this.safeValue(o.subscriptions,t,{});let d=!0;const c=this.market(i).id;if(this.safeValue(r,c,!1)||(r[c]=!0,d=!1),d)return await this.watch(a,e,h,t,r);{let i=Object.keys(r);s&&(i=[i]);const h={id:n,method:t,params:i};return t in o.subscriptions&&delete o.subscriptions[t],await this.watch(a,e,h,t,r)}}}async watchPrivate(e,t,i=[],s={}){this.checkRequiredCredentials(),await this.authenticate();const r=this.urls.api.ws,a={id:this.nonce(),method:t,params:i},n=this.extend(a,s);return await this.watch(r,e,n,e)}async authenticate(e={}){this.checkRequiredCredentials();const t=this.urls.api.ws,i="login",s=this.client(t),r=s.future("authenticated");if(void 0===this.safeValue(s.subscriptions,i)){const e=await this.v4PrivatePostProfileWebsocketToken(),s=this.safeString(e,"websocket_token"),r=this.nonce(),a={id:r,method:"authorize",params:[s,"public"]},n={id:r,method:this.handleAuthenticate};this.spawn(this.watch,t,i,a,i,n)}return await r}handleAuthenticate(e,t){return e.futures.authenticated.resolve(1),t}handleErrorMessage(e,t){const i=this.safeValue(t,"error");try{if(void 0!==i){const e=this.safeString(t,"code"),i=this.id+" "+this.json(t);this.throwExactlyMatchedException(this.exceptions.ws.exact,e,i)}}catch(t){if(t instanceof a)return e.reject(t,"authenticated"),"login"in e.subscriptions&&delete e.subscriptions.login,!1}return t}handleMessage(e,t){if(!this.handleErrorMessage(e,t))return;const i=this.safeValue(t,"result",{});if(void 0!==i&&"pong"===i)return void this.handlePong(e,t);const s=this.safeInteger(t,"id");if(void 0!==s)return void this.handleSubscriptionStatus(e,t,s);const r={market_update:this.handleTicker,trades_update:this.handleTrades,depth_update:this.handleOrderBook,candles_update:this.handleOHLCV,ordersPending_update:this.handleOrder,ordersExecuted_update:this.handleOrder,balanceSpot_update:this.handleBalance,balanceMargin_update:this.handleBalance,deals_update:this.handleMyTrades},a=this.safeValue(t,"method"),n=this.safeValue(r,a);void 0!==n&&n.call(this,e,t)}handleSubscriptionStatus(e,t,i){const s=e.subscriptions,r=Object.values(s);for(let s=0;s<r.length;s++){const a=r[s];if(!0!==a){const s=this.safeInteger(a,"id");if(void 0!==s&&s===i){const i=this.safeValue(a,"method");if(void 0!==i)return void i.call(this,e,t)}}}}handlePong(e,t){return e.lastPong=this.milliseconds(),t}ping(e){return{id:0,method:"ping",params:[]}}}},71354:function(e,t,i){"use strict";const s=i(17630),{ExchangeError:r,AuthenticationError:a}=i(73449),{ArrayCacheByTimestamp:n,ArrayCacheBySymbolById:o,ArrayCache:h}=i(56062),d=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchBalance:!1,watchMyTrades:!1,watchOHLCV:!0,watchOrderBook:!0,watchOrders:!0,watchTicker:!0,watchTickers:!0,watchTrades:!0},urls:{api:{ws:{public:"wss://wss.woo.org/ws/stream",private:"wss://wss.woo.network/v2/ws/private/stream"}},test:{ws:{public:"wss://wss.staging.woo.org/ws/stream",private:"wss://wss.staging.woo.org/v2/ws/private/stream"}}},requiredCredentials:{apiKey:!0,secret:!0,uid:!0},options:{tradesLimit:1e3,ordersLimit:1e3,requestId:{}},streaming:{ping:this.ping,keepAlive:1e4}})}requestId(e){const t=this.safeValue(this.options,"requestId",{}),i=this.safeInteger(t,e,0),s=this.sum(i,1);return this.options.requestId[e]=s,s}async watchPublic(e,t){this.checkRequiredUid();const i=this.urls.api.ws.public+"/"+this.uid,s={id:this.requestId(i)},r=this.extend(s,t);return await this.watch(i,e,r,e,s)}async watchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e).id+"@orderbook",r={event:"subscribe",topic:s},a=this.extend(r,i);return(await this.watchPublic(s,a)).limit()}handleOrderBook(e,t){const i=this.safeValue(t,"data"),s=this.safeString(i,"symbol"),r=this.safeMarket(s).symbol,a=this.safeString(t,"topic");let n=this.safeValue(this.orderbooks,r);void 0===n&&(n=this.orderBook({}));const o=this.safeInteger(t,"ts"),h=this.parseOrderBook(i,r,o,"bids","asks");n.reset(h),e.resolve(n,a)}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e).id+"@ticker",s={event:"subscribe",topic:i},r=this.extend(s,t);return await this.watchPublic(i,r)}parseWsTicker(e,t){const i=this.safeInteger(e,"date",this.milliseconds());return this.safeTicker({symbol:this.safeSymbol(void 0,t),timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:this.safeString(e,"open"),close:this.safeString(e,"close"),last:void 0,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"volume"),quoteVolume:this.safeString(e,"amount"),info:e},t)}handleTicker(e,t){const i=this.safeValue(t,"data"),s=this.safeValue(t,"topic"),r=this.safeString(i,"symbol"),a=this.safeMarket(r),n=this.safeInteger(t,"ts");i.date=n;const o=this.parseWsTicker(i,a);return o.symbol=a.symbol,this.tickers[a.symbol]=o,e.resolve(o,s),t}async watchTickers(e,t={}){await this.loadMarkets();const i="tickers",s={event:"subscribe",topic:i},r=this.extend(s,t),a=await this.watchPublic(i,r);return this.filterByArray(a,"symbol",e)}handleTickers(e,t){const i=this.safeValue(t,"topic"),s=this.safeValue(t,"data"),r=this.safeInteger(t,"ts"),a=[];for(let e=0;e<s.length;e++){const t=this.safeString(s[e],"symbol"),i=this.safeMarket(t),n=this.parseWsTicker(this.extend(s[e],{date:r}),i);this.tickers[i.symbol]=n,a.push(n)}e.resolve(a,i)}async watchOHLCV(e,t="1m",i,s,a={}){if(await this.loadMarkets(),"1m"!==t&&"5m"!==t&&"15m"!==t&&"30m"!==t&&"1h"!==t&&"1d"!==t&&"1w"!==t&&"1M"!==t)throw new r(this.id+" watchOHLCV timeframe argument must be 1m, 5m, 15m, 30m, 1h, 1d, 1w, 1M");const n=this.market(e),o=this.safeString(this.timeframes,t,t),h=n.id+"@kline_"+o,d={event:"subscribe",topic:h},c=this.extend(d,a),l=await this.watchPublic(h,c);return this.newUpdates&&(s=l.getLimit(n.symbol,s)),this.filterBySinceLimit(l,i,s,0,!0)}handleOHLCV(e,t){const i=this.safeValue(t,"data"),s=this.safeValue(t,"topic"),r=this.safeString(i,"symbol"),a=this.safeMarket(r).symbol,o=this.safeString(i,"type"),h=this.findTimeframe(o),d=[this.safeInteger(i,"startTime"),this.safeFloat(i,"open"),this.safeFloat(i,"high"),this.safeFloat(i,"low"),this.safeFloat(i,"close"),this.safeFloat(i,"volume")];this.ohlcvs[a]=this.safeValue(this.ohlcvs,a,{});let c=this.safeValue(this.ohlcvs[a],h);if(void 0===c){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);c=new n(e),this.ohlcvs[a][h]=c}c.append(d),e.resolve(c,s)}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a=r.id+"@trade",n={event:"subscribe",topic:a},o=this.extend(n,s),h=await this.watchPublic(a,o);return this.newUpdates&&(i=h.getLimit(r.symbol,i)),this.filterBySymbolSinceLimit(h,e,t,i,!0)}handleTrade(e,t){const i=this.safeString(t,"topic"),s=this.safeInteger(t,"ts"),r=this.safeValue(t,"data"),a=this.safeString(r,"symbol"),n=this.safeMarket(a),o=n.symbol,d=this.parseWsTrade(this.extend(r,{timestamp:s}),n);let c=this.safeValue(this.trades,o);if(void 0===c){const e=this.safeInteger(this.options,"tradesLimit",1e3);c=new h(e)}c.append(d),this.trades[o]=c,e.resolve(c,i)}parseWsTrade(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeString(e,"price"),a=this.safeString(e,"size"),n=d.stringMul(r,a),o=this.safeStringLower(e,"side"),h=this.safeInteger(e,"timestamp");return this.safeTrade({id:void 0,timestamp:h,datetime:this.iso8601(h),symbol:s,side:o,price:r,amount:a,cost:n,order:void 0,takerOrMaker:void 0,type:void 0,fee:void 0,info:e},t)}checkRequiredUid(e=!0){if(!this.uid){if(e)throw new a(this.id+" requires `uid` credential");return!1}return!0}authenticate(e={}){this.checkRequiredCredentials();const t=this.urls.api.ws.private+"/"+this.uid,i=this.client(t),s="authenticated";let r=this.safeValue(i.subscriptions,s);if(void 0===r){const a=this.nonce().toString(),n="|"+a,o=this.hmac(this.encode(n),this.encode(this.secret),"sha256"),h={event:"auth",params:{apikey:this.apiKey,sign:o,timestamp:a}},d=this.extend(h,e);r=this.watch(t,s,d),i.subscriptions[s]=r}return r}async watchPrivate(e,t,i={}){await this.authenticate(i);const s=this.urls.api.ws.private+"/"+this.uid,r={id:this.requestId(s)},a=this.extend(r,t);return await this.watch(s,e,a,e,r)}async watchOrders(e,t,i,s={}){await this.loadMarkets();const r="executionreport";let a=r;if(void 0!==e){a+=":"+(e=this.market(e).symbol)}const n={event:"subscribe",topic:r},o=this.extend(n,s),h=await this.watchPrivate(a,o);return this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySymbolSinceLimit(h,e,t,i,!0)}parseWsOrder(e,t){const i=this.safeString(e,"orderId"),s=this.safeString(e,"symbol"),r=this.market(s).symbol,a=this.safeInteger(e,"timestamp"),n=this.safeString(e,"totalFee"),o={cost:n,currency:this.safeString(e,"feeAsset")},h=this.safeFloat(e,"price"),d=this.safeFloat(e,"quantity"),c=this.safeStringLower(e,"side"),l=this.safeStringLower(e,"type"),u=this.safeFloat(e,"executedQuantity"),f=this.safeFloat(e,"totalExecutedQuantity");let p=d;d>=f&&(p-=f);const m=this.safeString(e,"status"),g=this.parseOrderStatus(m);return{info:e,symbol:r,id:i,clientOrderId:this.safeString(e,"clientOrderId"),timestamp:a,datetime:this.iso8601(a),lastTradeTimestamp:a,type:l,timeInForce:void 0,postOnly:void 0,side:c,price:h,stopPrice:void 0,triggerPrice:void 0,amount:d,cost:n,average:void 0,filled:u,remaining:p,status:g,fee:o,trades:undefined}}handleOrderUpdate(e,t){const i=this.safeValue(t,"data");this.handleOrder(e,i)}handleOrder(e,t){const i="executionreport",s=this.parseWsOrder(t),r=this.safeString(s,"symbol"),a=this.safeString(s,"id");if(void 0!==r){if(void 0===this.orders){const e=this.safeInteger(this.options,"ordersLimit",1e3);this.orders=new o(e)}const t=this.orders,n=this.safeValue(t.hashmap,r,{}),h=this.safeValue(n,a);if(void 0!==h){const e=this.safeValue(h,"fee");void 0!==e&&(s.fee=e);const t=this.safeValue(h,"fees");void 0!==t&&(s.fees=t),s.trades=this.safeValue(h,"trades"),s.timestamp=this.safeInteger(h,"timestamp"),s.datetime=this.safeString(h,"datetime")}t.append(s),e.resolve(this.orders,i);const d=i+":"+r;e.resolve(this.orders,d)}}handleMessage(e,t){const i={ping:this.handlePing,pong:this.handlePong,subscribe:this.handleSubscribe,orderbook:this.handleOrderBook,ticker:this.handleTicker,tickers:this.handleTickers,kline:this.handleOHLCV,auth:this.handleAuth,executionreport:this.handleOrderUpdate,trade:this.handleTrade},s=this.safeString(t,"event");let r=this.safeValue(i,s);if(void 0!==r)return r.call(this,e,t);const a=this.safeString(t,"topic");if(void 0!==a){if(r=this.safeValue(i,a),void 0!==r)return r.call(this,e,t);const s=a.split("@");if(2===s.length){const a=this.safeString(s,1);if(r=this.safeValue(i,a),void 0!==r)return r.call(this,e,t);const n=a.split("_");if(2===s.length&&(r=this.safeValue(i,this.safeString(n,0)),void 0!==r))return r.call(this,e,t)}}return t}ping(e){return{event:"ping"}}handlePing(e,t){return{event:"pong"}}handlePong(e,t){return e.lastPong=this.milliseconds(),t}handleSubscribe(e,t){return t}handleAuth(e,t){const i="authenticated";if(this.safeValue(t,"success"))e.resolve(t,i);else{const s=new a(this.json(t));e.reject(s,i),i in e.subscriptions&&delete e.subscriptions.authenticated}}}},80922:function(e,t,i){"use strict";const s=i(90927),{ExchangeError:r,AuthenticationError:a,NotSupported:n}=i(73449),{ArrayCache:o,ArrayCacheByTimestamp:h}=i(56062);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{has:{ws:!0,watchOrderBook:!0,watchTicker:!0,watchTrades:!0,watchOHLCV:!0},urls:{api:{ws:{spot:"wss://api.{hostname}/websocket",contract:"wss://fapi.{hostname}/ws/public/v1"}}},options:{tradesLimit:1e3,ordersLimit:1e3,OHLCVLimit:1e3}})}async watchPublic(e,t,i,s,r,a={}){await this.loadMarkets();let n;const o=void 0!==r;"spot"===(this.market(i).spot?"spot":"contract")?(n={event:"addChannel",channel:t},o&&(n.length=r)):(n={action:"subscribe",channel:t},o&&(n.size=r));const h=this.extend(n,a),d={symbol:i,messageHash:t,method:s};return o&&(d.limit=r),await this.watch(e,t,h,t,d)}async watchTicker(e,t={}){await this.loadMarkets();const i=this.market(e);let s;const r=i.spot?"spot":"contract";s="spot"===r?i.baseId+i.quoteId+"_ticker":i.id+".Ticker";const a=this.implodeHostname(this.urls.api.ws[r]);return await this.watchPublic(a,s,e,this.handleTicker,void 0,t)}parseWsTicker(e,t){const i=this.safeInteger(e,6),s=this.safeString(e,3);return this.safeTicker({symbol:this.safeSymbol(void 0,t),timestamp:i,datetime:void 0,high:this.safeString(e,1),low:this.safeString(e,2),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:this.safeString(e,0),close:s,last:s,previousClose:void 0,change:void 0,percentage:this.safeString(e,5),average:void 0,baseVolume:this.safeString(e,4),quoteVolume:void 0,info:e},t,!1)}handleTicker(e,t,i){const s=this.safeString(i,"symbol"),r=this.safeString(t,"channel"),a=this.market(s);let n,o=this.safeValue(t,"ticker");return void 0===o?(o=this.safeValue(t,"data",[]),n=this.parseWsTicker(o,a)):(o.date=this.safeValue(t,"date"),n=this.parseTicker(o,a)),n.symbol=s,this.tickers[s]=n,e.resolve(n,r),t}async watchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e);if(a.spot)throw new n(this.id+" watchOHLCV() supports contract markets only");(void 0===s||s>1440)&&(s=100);const o=this.safeString(this.timeframes,t,t),h=a.id+".KLine_"+o,d=this.implodeHostname(this.urls.api.ws.contract),c=await this.watchPublic(d,h,e,this.handleOHLCV,s,r);return this.newUpdates&&(s=c.getLimit(e,s)),this.filterBySinceLimit(c,i,s,0,!0)}handleOHLCV(e,t,i){const s=this.safeValue(t,"data",[]),r=this.safeString(t,"channel",""),a=r.split("_"),n=a.length,o=this.safeString(a,n-1),d=this.findTimeframe(o),c=this.safeString(i,"symbol"),l=this.market(c);for(let t=0;t<s.length;t++){const i=s[t],a=this.parseOHLCV(i,l);this.ohlcvs[c]=this.safeValue(this.ohlcvs,c,{});let n=this.safeValue(this.ohlcvs[c],d);if(void 0===n){const e=this.safeInteger(this.options,"OHLCVLimit",1e3);n=new h(e),this.ohlcvs[c][d]=n}n.append(a),e.resolve(n,r)}return t}async watchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);let a;const n=r.spot?"spot":"contract";a="spot"===n?r.baseId+r.quoteId+"_trades":r.id+".Trade";const o=this.implodeHostname(this.urls.api.ws[n]),h=await this.watchPublic(o,a,e,this.handleTrades,i,s);return this.newUpdates&&(i=h.getLimit(e,i)),this.filterBySinceLimit(h,t,i,"timestamp",!0)}handleTrades(e,t,i){const s=this.safeValue(t,"channel"),r=this.safeString(i,"symbol"),a=this.market(r),n=this.safeValue(t,"data");let h=[];if("Whole"===this.safeString(t,"type"))for(let e=0;e<n.length;e++){const t=n[e],i=this.parseWsTrade(t,a);h.push(i)}else h=this.parseTrades(n,a);let d=this.safeValue(this.trades,r);if(void 0===d){const e=this.safeInteger(this.options,"tradesLimit",1e3);d=new o(e)}for(let e=0;e<h.length;e++)d.append(h[e]);this.trades[r]=d,e.resolve(d,s)}async watchOrderBook(e,t,i={}){if(void 0!==t){if(5!==t&&10!==t)throw new r(this.id+" watchOrderBook limit argument must be undefined, 5, or 10")}else t=5;await this.loadMarkets();const s=this.market(e),a=s.spot?"spot":"contract";let n,o=this.implodeHostname(this.urls.api.ws[a]);"spot"===a?(o+="/"+s.baseId,n=s.baseId+s.quoteId+"_quick_depth"):n=s.id+".Depth";return(await this.watchPublic(o,n,e,this.handleOrderBook,t,i)).limit()}parseWsTrade(e,t){const i=this.safeTimestamp(e,3),s=this.safeString(e,0),r=this.safeString(e,1);t=this.safeMarket(void 0,t);const a=1===this.safeInteger(e,2)?"buy":"sell";return this.safeTrade({id:void 0,timestamp:i,datetime:this.iso8601(i),symbol:t.symbol,order:void 0,type:void 0,side:a,takerOrMaker:void 0,price:s,amount:r,cost:void 0,fee:void 0,info:e},t)}handleOrderBook(e,t,i){const s=this.safeString2(t,"type","dataType"),r=this.safeString(t,"channel"),a=this.safeString(i,"symbol");let n=this.safeValue(this.orderbooks,a);if(void 0!==s){const o="Whole"===s,h=o?this.safeValue(t,"data"):t,d=this.safeInteger2(h,"lastTime","time"),c=o?"asks":"listUp",l=o?"bids":"listDown",u=this.parseOrderBook(h,a,d,l,c);if(a in this.orderbooks)n=this.orderbooks[a],n.reset(u);else{const e=this.safeInteger(this.options,"watchOrderBookLimit",1e3),t=this.safeInteger(i,"limit",e);n=this.orderBook(u,t),this.orderbooks[a]=n}n.symbol=a,e.resolve(n,r)}else this.handleOrderBookMessage(e,t,n),e.resolve(n,r)}handleOrderBookMessage(e,t,i){const s=this.safeValue(t,"data",{}),r=this.safeInteger(s,"time"),a=this.safeValue(s,"asks",[]),n=this.safeValue(s,"bids",[]);return this.handleDeltas(i.asks,a),this.handleDeltas(i.bids,n),i.timestamp=r,i.datetime=this.iso8601(r),i}handleDelta(e,t){const i=this.safeFloat(t,0),s=this.safeFloat(t,1);e.store(i,s)}handleDeltas(e,t){for(let i=0;i<t.length;i++)this.handleDelta(e,t[i])}handleMessage(e,t){const i=this.safeString(t,"channel"),s=this.safeValue(e.subscriptions,i);if(void 0!==s){const i=this.safeValue(s,"method");if(void 0!==i)return i.call(this,e,t,s)}return t}handleErrorMessage(e,t){const i=this.safeString(t,"errorCode");try{if(void 0!==i){const e=this.id+" "+this.json(t);this.throwExactlyMatchedException(this.exceptions.exact,i,e);const s=this.safeValue(t,"message");void 0!==s&&this.throwBroadlyMatchedException(this.exceptions.broad,s,e)}}catch(t){if(t instanceof a){e.reject(t,"authenticated");const i="login";return i in e.subscriptions&&delete e.subscriptions[i],!1}}return t}}},96818:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ExchangeNotAvailable:a,BadResponse:n,BadRequest:o,InvalidOrder:h,InsufficientFunds:d,AuthenticationError:c,ArgumentsRequired:l,InvalidAddress:u,RateLimitExceeded:f,DDoSProtection:p,BadSymbol:m}=i(73449),{TRUNCATE:g,TICK_SIZE:y}=i(62115),b=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"probit",name:"ProBit",countries:["SC","KR"],rateLimit:50,has:{CORS:!0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createMarketOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDepositAddresses:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawal:!1,fetchWithdrawals:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,signIn:!0,transfer:!1,withdraw:!0},timeframes:{"1m":"1m","3m":"3m","5m":"5m","10m":"10m","15m":"15m","30m":"30m","1h":"1h","4h":"4h","6h":"6h","12h":"12h","1d":"1D","1w":"1W","1M":"1M"},version:"v1",urls:{logo:"https://user-images.githubusercontent.com/51840849/79268032-c4379480-7ea2-11ea-80b3-dd96bb29fd0d.jpg",api:{accounts:"https://accounts.probit.com",public:"https://api.probit.com/api/exchange",private:"https://api.probit.com/api/exchange"},www:"https://www.probit.com",doc:["https://docs-en.probit.com","https://docs-ko.probit.com"],fees:"https://support.probit.com/hc/en-us/articles/360020968611-Trading-Fees",referral:"https://www.probit.com/r/34608773"},api:{public:{get:{market:1,currency:1,currency_with_platform:1,time:1,ticker:1,order_book:1,trade:1,candle:1}},private:{post:{new_order:2,cancel_order:1,withdrawal:2},get:{balance:1,order:1,open_order:1,order_history:1,trade_history:1,deposit_address:1}},accounts:{post:{token:1}}},fees:{trading:{tierBased:!1,percentage:!0,maker:this.parseNumber("0.002"),taker:this.parseNumber("0.002")}},exceptions:{exact:{UNAUTHORIZED:c,INVALID_ARGUMENT:o,TRADING_UNAVAILABLE:a,NOT_ENOUGH_BALANCE:d,NOT_ALLOWED_COMBINATION:o,INVALID_ORDER:h,RATE_LIMIT_EXCEEDED:f,MARKET_UNAVAILABLE:a,INVALID_MARKET:m,MARKET_CLOSED:m,MARKET_NOT_FOUND:m,INVALID_CURRENCY:o,TOO_MANY_OPEN_ORDERS:p,DUPLICATE_ADDRESS:u,invalid_grant:c}},requiredCredentials:{apiKey:!0,secret:!0},precisionMode:y,options:{createMarketBuyOrderRequiresPrice:!0,timeInForce:{limit:"gtc",market:"ioc"},networks:{BEP20:"BSC",ERC20:"ETH",TRC20:"TRON"},networksById:{BSC:"BEP20",ETH:"ERC20",TRON:"TRC20"}},commonCurrencies:{AUTO:"Cube",AZU:"Azultec",BCC:"BCC",BDP:"BidiPass",BIRD:"Birdchain",BTCBEAR:"BEAR",BTCBULL:"BULL",CBC:"CryptoBharatCoin",CHE:"Chellit",CLR:"Color Platform",CTK:"Cryptyk",CTT:"Castweet",DIP:"Dipper",DKT:"DAKOTA",EGC:"EcoG9coin",EPS:"Epanus",FX:"Fanzy",GDT:"Gorilla Diamond",GM:"GM Holding",GOGOL:"GOL",GOL:"Goldofir",GRB:"Global Reward Bank",HBC:"Hybrid Bank Cash",HUSL:"The Hustle App",LAND:"Landbox",LBK:"Legal Block",ORC:"Oracle System",PXP:"PIXSHOP COIN",PYE:"CreamPYE",ROOK:"Reckoon",SOC:"Soda Coin",SST:"SocialSwap",TCT:"Top Coin Token",TOR:"Torex",TPAY:"Tetra Pay",UNI:"UNICORN Token",UNISWAP:"UNI"}})}async fetchMarkets(e={}){const t=await this.publicGetMarket(e),i=this.safeValue(t,"data",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"id"),a=this.safeString(t,"base_currency_id"),n=this.safeString(t,"quote_currency_id"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=this.safeValue(t,"closed",!1),c=this.safeString(t,"taker_fee_rate"),l=b.stringDiv(c,"100"),u=this.safeString(t,"maker_fee_rate"),f=b.stringDiv(u,"100");s.push({id:r,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:!d,contract:!1,linear:void 0,inverse:void 0,taker:this.parseNumber(l),maker:this.parseNumber(f),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"quantity_precision"))),price:this.safeNumber(t,"price_increment"),cost:this.parseNumber(this.parsePrecision(this.safeString(t,"cost_precision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"min_quantity"),max:this.safeNumber(t,"max_quantity")},price:{min:this.safeNumber(t,"min_price"),max:this.safeNumber(t,"max_price")},cost:{min:this.safeNumber(t,"min_cost"),max:this.safeNumber(t,"max_cost")}},info:t})}return s}async fetchCurrencies(e={}){const t=await this.publicGetCurrencyWithPlatform(e),i=this.safeValue(t,"data",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"id"),a=this.safeCurrencyCode(r),n=this.safeValue(t,"display_name"),o=this.safeString(n,"en-us"),h=this.safeValue(t,"platform",[]),d=this.sortBy(h,"priority"),c=this.safeValue(d,0,{}),l=!this.safeValue(c,"deposit_suspended"),u=!this.safeValue(c,"withdrawal_suspended"),f=l&&u,p=this.safeValue(c,"withdrawal_fee",{}),m=[];for(let e=0;e<p.length;e++){const t=p[e],i=this.safeNumber(t,"amount"),s=this.safeInteger(t,"priority");void 0!==i&&void 0!==s&&m.push(t)}const g=this.sortBy(m,"priority"),y=this.safeValue(g,0,{}),b=this.safeNumber(y,"amount");s[a]={id:r,code:a,info:t,name:o,active:f,deposit:l,withdraw:u,fee:b,precision:this.parseNumber(this.parsePrecision(this.safeString(c,"precision"))),limits:{amount:{min:void 0,max:void 0},deposit:{min:this.safeNumber(c,"min_deposit_amount"),max:void 0},withdraw:{min:this.safeNumber(c,"min_withdrawal_amount"),max:void 0}}}}return s}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0},i=this.safeValue(e,"data",[]);for(let e=0;e<i.length;e++){const s=i[e],r=this.safeString(s,"currency_id"),a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(s,"total"),n.free=this.safeString(s,"available"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetBalance(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={market_id:s.id},a=await this.publicGetOrderBook(this.extend(r,i)),n=this.safeValue(a,"data",[]),o=this.groupBy(n,"side");return this.parseOrderBook(o,s.symbol,void 0,"buy","sell","price","quantity")}async fetchTickers(e,t={}){await this.loadMarkets();const i={};if(void 0!==e){const t=this.marketIds(e);i.market_ids=t.join(",")}const s=await this.publicGetTicker(this.extend(i,t)),r=this.safeValue(s,"data",[]);return this.parseTickers(r,e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={market_ids:i.id},r=await this.publicGetTicker(this.extend(s,t)),a=this.safeValue(r,"data",[]),o=this.safeValue(a,0);if(void 0===o)throw new n(this.id+" fetchTicker() returned an empty response");return this.parseTicker(o,i)}parseTicker(e,t){const i=this.parse8601(this.safeString(e,"time")),s=this.safeString(e,"market_id"),r=this.safeSymbol(s,t,"-"),a=this.safeString(e,"last"),n=this.safeString(e,"change"),o=this.safeString(e,"base_volume"),h=this.safeString(e,"quote_volume");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:void 0,close:a,last:a,previousClose:void 0,change:n,percentage:void 0,average:void 0,baseVolume:o,quoteVolume:h,info:e},t)}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets();const a={limit:100,start_time:this.iso8601(0),end_time:this.iso8601(this.milliseconds())};void 0!==e&&(r=this.market(e),a.market_id=r.id),void 0!==t&&(a.start_time=this.iso8601(t)),void 0!==i&&(a.limit=i);const n=await this.privateGetTradeHistory(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={market_id:r.id,limit:100,start_time:"1970-01-01T00:00:00.000Z",end_time:this.iso8601(this.milliseconds())};void 0!==t&&(a.start_time=this.iso8601(t)),void 0!==i&&(a.limit=i);const n=await this.publicGetTrade(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}parseTrade(e,t){const i=this.parse8601(this.safeString(e,"time")),s=this.safeString(e,"id");let r;if(void 0!==s){const e=s.split(":");r=this.safeString(e,0)}r=this.safeString(e,"market_id",r);const a=this.safeSymbol(r,t,"-"),n=this.safeString(e,"side"),o=this.safeString(e,"price"),h=this.safeString(e,"quantity"),d=this.safeString(e,"order_id"),c=this.safeString(e,"fee_amount");let l;if(void 0!==c){const t=this.safeString(e,"fee_currency_id");l={cost:c,currency:this.safeCurrencyCode(t)}}return this.safeTrade({id:s,info:e,timestamp:i,datetime:this.iso8601(i),symbol:a,order:d,type:void 0,side:n,takerOrMaker:void 0,price:o,amount:h,cost:void 0,fee:l},t)}async fetchTime(e={}){const t=await this.publicGetTime(e);return this.parse8601(this.safeString(t,"data"))}normalizeOHLCVTimestamp(e,t,i=!1){const s=this.parseTimeframe(t);if("1M"===t){const t=this.iso8601(e).split("-"),s=this.safeString(t,0);let r=this.safeInteger(t,1);return i&&(r=this.sum(r,1)),r=r<10?"0"+r.toString():r.toString(),s+"-"+r+"-01T00:00:00.000Z"}if("1w"===t){const t=259200,r=(e=parseInt(e/1e3))-t,a=Math.floor(r/s);let n=this.sum(t,a*s);return i&&(n=this.sum(n,s)),this.iso8601(1e3*n)}return e=parseInt(e/1e3),e=s*parseInt(e/s),i&&(e=this.sum(e,s)),this.iso8601(1e3*e)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.safeString(this.timeframes,t,t);s=void 0===s?100:s;let o=this.sum(s,1);o=Math.min(1e3,o);const h={market_ids:a.id,interval:n,sort:"asc",limit:o},d=this.milliseconds(),c=this.parseTimeframe(t);let l=i,u=d;void 0===i?(void 0===s&&(s=o),l=d-s*c*1e3):u=void 0===s?d:this.sum(i,this.sum(s,1)*c*1e3);const f=this.normalizeOHLCVTimestamp(l,t),p=this.normalizeOHLCVTimestamp(u,t,!0);h.start_time=f,h.end_time=p;const m=await this.publicGetCandle(this.extend(h,r)),g=this.safeValue(m,"data",[]);return this.parseOHLCVs(g,a,t,i,s)}parseOHLCV(e,t){return[this.parse8601(this.safeString(e,"start_time")),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"base_volume")]}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets(),t=this.parse8601(t);const r={};let a;void 0!==e&&(a=this.market(e),r.market_id=a.id);const n=await this.privateGetOpenOrder(this.extend(r,s)),o=this.safeValue(n,"data");return this.parseOrders(o,a,t,i)}async fetchClosedOrders(e,t,i,s={}){await this.loadMarkets();const r={start_time:this.iso8601(0),end_time:this.iso8601(this.milliseconds()),limit:100};let a;void 0!==e&&(a=this.market(e),r.market_id=a.id),t&&(r.start_time=this.iso8601(t)),i&&(r.limit=i);const n=await this.privateGetOrderHistory(this.extend(r,s)),o=this.safeValue(n,"data");return this.parseOrders(o,a,t,i)}async fetchOrder(e,t,i={}){if(void 0===t)throw new l(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={market_id:s.id},a=this.safeString2(i,"clientOrderId","client_order_id");void 0!==a?r.client_order_id=a:r.order_id=e;const n=this.omit(i,["clientOrderId","client_order_id"]),o=await this.privateGetOrder(this.extend(r,n)),h=this.safeValue(o,"data",[]),d=this.safeValue(h,0);return this.parseOrder(d,s)}parseOrderStatus(e){return this.safeString({open:"open",cancelled:"canceled",filled:"closed"},e,e)}parseOrder(e,t){const i=this.parseOrderStatus(this.safeString(e,"status")),s=this.safeString(e,"id"),r=this.safeString(e,"type"),a=this.safeString(e,"side"),n=this.safeString(e,"market_id"),o=this.safeSymbol(n,t,"-"),h=this.parse8601(this.safeString(e,"time"));let d=this.safeString(e,"limit_price");const c=this.safeString(e,"filled_quantity");let l=this.safeString(e,"open_quantity");const u=this.safeString(e,"cancelled_quantity");void 0!==u&&(l=b.stringAdd(l,u));const f=this.safeString(e,"quantity",b.stringAdd(c,l)),p=this.safeString2(e,"filled_cost","cost");"market"===r&&(d=void 0);const m=this.safeString(e,"client_order_id"),g=this.safeStringUpper(e,"time_in_force");return this.safeOrder({id:s,info:e,clientOrderId:m,timestamp:h,datetime:this.iso8601(h),lastTradeTimestamp:void 0,symbol:o,type:r,timeInForce:g,side:a,status:i,price:d,stopPrice:void 0,triggerPrice:void 0,amount:f,filled:c,remaining:l,average:void 0,cost:p,fee:void 0,trades:void 0},t)}costToPrecision(e,t){return this.decimalToPrecision(t,g,this.markets[e].precision.cost,this.precisionMode)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=this.safeValue(this.options,"timeInForce"),d=this.safeValue(o,t),c=this.safeString2(a,"timeInForce","time_in_force",d),l={market_id:n.id,type:t,side:i,time_in_force:c},u=this.safeString2(a,"clientOrderId","client_order_id");let f;if(void 0!==u&&(l.client_order_id=u),"limit"===t)l.limit_price=this.priceToPrecision(e,r),l.quantity=this.amountToPrecision(e,s);else if("market"===t)if("buy"===i){let t=this.safeNumber(a,"cost");if(this.safeValue(this.options,"createMarketBuyOrderRequiresPrice",!0)){if(void 0!==r)void 0===t&&(t=s*r);else if(void 0===t)throw new h(this.id+" createOrder() requires the price argument for market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount, or, alternatively, add .options['createMarketBuyOrderRequiresPrice'] = false and supply the total cost value in the 'amount' argument or in the 'cost' extra parameter (the exchange-specific behaviour)")}else t=void 0===t?s:t;f=this.costToPrecision(e,t),l.cost=f}else l.quantity=this.amountToPrecision(e,s);const p=this.omit(a,["timeInForce","time_in_force","clientOrderId","client_order_id"]),m=await this.privatePostNewOrder(this.extend(l,p)),g=this.safeValue(m,"data"),y=this.parseOrder(g,n);return"market"===t&&"buy"===i&&(y.amount=void 0,y.cost=this.parseNumber(f),y.remaining=void 0),y}async cancelOrder(e,t,i={}){if(void 0===t)throw new l(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s={market_id:this.market(t).id,order_id:e},r=await this.privatePostCancelOrder(this.extend(s,i)),a=this.safeValue(r,"data");return this.parseOrder(a)}parseDepositAddress(e,t){const i=this.safeString(e,"address"),s=this.safeString(e,"destination_tag"),r=this.safeString(e,"currency_id"),a=(t=this.safeCurrency(r,t)).code,n=this.safeString(e,"platform_id");return this.checkAddress(i),{currency:a,address:i,tag:s,network:n,info:e}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency_id:i.id},r=this.safeValue(this.options,"networks",{});let a=this.safeStringUpper(t,"network");a=this.safeString(r,a,a),void 0!==a&&(s.platform_id=a,t=this.omit(t,"platform_id"));const n=await this.privateGetDepositAddress(this.extend(s,t)),o=this.safeValue(n,"data",[]),h=this.safeValue(o,0);if(void 0===h)throw new u(this.id+" fetchDepositAddress() returned an empty response");return this.parseDepositAddress(h,i)}async fetchDepositAddresses(e,t={}){await this.loadMarkets();const i={};if(e){const t=[];for(let i=0;i<e.length;i++){const s=this.currency(e[i]);t.push(s.id)}i.currency_id=e.join(",")}const s=await this.privateGetDepositAddress(this.extend(i,t)),r=this.safeValue(s,"data",[]);return this.parseDepositAddresses(r)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e);void 0===s&&(s="");const n={currency_id:a.id,address:i,destination_tag:s,amount:this.numberToString(t)},o=this.safeValue(this.options,"networks",{});let h=this.safeStringUpper(r,"network");h=this.safeString(o,h,h),void 0!==h&&(n.platform_id=h,r=this.omit(r,"network"));const d=await this.privatePostWithdrawal(this.extend(n,r)),c=this.safeValue(d,"data");return this.parseTransaction(c,a)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=this.safeNumber(e,"amount"),r=this.safeString(e,"address"),a=this.safeString(e,"destination_tag"),n=this.safeString(e,"hash"),o=this.parse8601(this.safeString(e,"time")),h=this.safeString(e,"type"),d=this.safeString(e,"currency_id"),c=this.safeCurrencyCode(d),l=this.parseTransactionStatus(this.safeString(e,"status")),u=this.safeNumber(e,"fee");let f;return void 0!==u&&0!==u&&(f={currency:c,cost:u}),{id:i,currency:c,amount:s,network:void 0,addressFrom:void 0,address:r,addressTo:r,tagFrom:void 0,tag:a,tagTo:a,status:l,type:h,txid:n,timestamp:o,datetime:this.iso8601(o),updated:void 0,fee:f,info:e}}parseTransactionStatus(e){return this.safeString({requested:"pending",pending:"pending",confirming:"pending",confirmed:"pending",applying:"pending",done:"ok",cancelled:"canceled",cancelling:"canceled"},e,e)}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.publicGetCurrencyWithPlatform(t),s=this.safeValue(i,"data");return this.parseDepositWithdrawFees(s,e,"id")}parseDepositWithdrawFee(e,t){const i=this.depositWithdrawFee({}),s=this.safeValue(e,"platform",[]),r={fee:void 0,percentage:void 0};for(let e=0;e<s.length;e++){const a=s[e],n=this.safeString(a,"id"),o=this.networkIdToCode(n,t.code),h=this.safeValue(a,"withdrawal_fee",{}),d=this.safeNumber(h[0],"amount");if(h.length>0){const t={fee:d,percentage:void 0===d&&void 0};0===e&&(i.withdraw=t),i.networks[o]={withdraw:t,deposit:r}}}return i.info=e,i}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t]+"/";const o=this.omit(s,this.extractParams(e));if("accounts"===t){this.checkRequiredCredentials(),n+=this.implodeParams(e,s);const t=this.apiKey+":"+this.secret,i=this.stringToBase64(t);r={Authorization:"Basic "+this.decode(i),"Content-Type":"application/json"},Object.keys(o).length&&(a=this.json(o))}else if(n+=this.version+"/","public"===t)n+=this.implodeParams(e,s),Object.keys(o).length&&(n+="?"+this.urlencode(o));else if("private"===t){const t=this.milliseconds();this.checkRequiredCredentials();const h=this.safeInteger(this.options,"expires");if(void 0===h||h<t)throw new c(this.id+" access token expired, call signIn() method");r={Authorization:"Bearer "+this.safeString(this.options,"accessToken")},n+=this.implodeParams(e,s),"GET"===i?Object.keys(o).length&&(n+="?"+this.urlencode(o)):Object.keys(o).length&&(a=this.json(o),r["Content-Type"]="application/json")}return{url:n,method:i,body:a,headers:r}}async signIn(e={}){this.checkRequiredCredentials();const t=await this.accountsPostToken(this.extend({grant_type:"client_credentials"},e)),i=this.safeInteger(t,"expires_in"),s=this.safeString(t,"access_token");return this.options.accessToken=s,this.options.expires=this.sum(this.milliseconds(),1e3*i),t}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0!==o&&"errorCode"in o){const e=this.safeString(o,"errorCode"),t=this.safeString(o,"message");if(void 0!==e){const i=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,t,i),this.throwBroadlyMatchedException(this.exceptions.exact,e,i),new r(i)}}}}},2041:function(e,t,i){"use strict";const s=i(48819),{AuthenticationError:r,ExchangeError:a,BadSymbol:n,BadRequest:o,InvalidOrder:h,ArgumentsRequired:d,OrderNotFound:c,InsufficientFunds:l,DDoSProtection:u}=i(73449),{TICK_SIZE:f}=i(62115);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"ripio",name:"Ripio",countries:["AR","BR"],rateLimit:50,version:"v1",pro:!0,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1},urls:{logo:"https://user-images.githubusercontent.com/1294454/94507548-a83d6a80-0218-11eb-9998-28b9cec54165.jpg",api:{public:"https://api.exchange.ripio.com/api",private:"https://api.exchange.ripio.com/api"},www:"https://exchange.ripio.com",doc:["https://exchange.ripio.com/en/api/"],fees:"https://exchange.ripio.com/en/fee"},api:{public:{get:["rate/all/","rate/{pair}/","orderbook/{pair}/","tradehistory/{pair}/","pair/","currency/","orderbook/{pair}/depth/"]},private:{get:["balances/exchange_balances/","order/{pair}/{order_id}/","order/{pair}/","trade/{pair}/"],post:["order/{pair}/","order/{pair}/{order_id}/cancel/"]}},fees:{trading:{tierBased:!0,percentage:!0,taker:this.parseNumber("0.0"),maker:this.parseNumber("0.0")}},precisionMode:f,requiredCredentials:{apiKey:!0,secret:!1},exceptions:{exact:{},broad:{"Authentication credentials were not provided":r,"Disabled pair":n,"Invalid order type":h,"Your balance is not enough":l,"Order couldn't be created":a,"not found":c,"Invalid pair":n,"amount must be a number":o,"Total must be at least":h,"Account not found":o,"Wrong password provided":r,"User tokens limit":u,"Something unexpected ocurred":a,account_balance:o}}})}async fetchMarkets(e={}){const t=await this.publicGetPair(e),i=[],s=this.safeValue(t,"results",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"base"),a=this.safeString(t,"quote"),n=this.safeString(t,"symbol"),o=this.safeCurrencyCode(r),h=this.safeCurrencyCode(a),d=this.safeValue(t,"fees",[]),c=this.safeValue(d,0,{});i.push({id:n,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:r,quoteId:a,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:this.safeValue(t,"enabled",!0),contract:!1,linear:void 0,inverse:void 0,taker:this.safeNumber(c,"taker_fee",0),maker:this.safeNumber(c,"maker_fee",0),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(t,"min_amount"),price:this.safeNumber(t,"price_tick")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"min_amount"),max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(t,"min_value"),max:void 0}},info:t})}return i}async fetchCurrencies(e={}){const t=await this.publicGetCurrency(e),i=this.safeValue(t,"results",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"currency"),a=this.safeCurrencyCode(r),n=this.safeString(t,"name"),o=this.safeValue(t,"enabled",!0);s[a]={id:r,code:a,name:n,info:t,active:o,deposit:void 0,withdraw:void 0,fee:void 0,precision:this.parseNumber(this.parsePrecision(this.safeString(t,"decimal_places"))),limits:{amount:{min:void 0,max:void 0},withdraw:{min:void 0,max:void 0}}}}return s}parseTicker(e,t){const i=this.parse8601(this.safeString(e,"created_at")),s=this.safeString(e,"pair"),r=(t=this.safeMarket(s,t,"_")).symbol,a=this.safeString(e,"last_price"),n=this.safeString(e,"avg");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:this.safeString(e,"bid_volume"),ask:this.safeString(e,"ask"),askVolume:this.safeString(e,"ask_volume"),vwap:void 0,open:void 0,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:n,baseVolume:void 0,quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={pair:i.id},r=await this.publicGetRatePair(this.extend(s,t));return this.parseTicker(r,i)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetRateAll(t),s={};for(let e=0;e<i.length;e++){const t=this.parseTicker(i[e]);s[t.symbol]=t}return this.filterByArray(s,"symbol",e)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={pair:s.id},a=await this.publicGetOrderbookPair(this.extend(r,i)),n=this.parseOrderBook(a,s.symbol,void 0,"buy","sell","price","amount");return n.nonce=this.safeInteger(a,"updated_id"),n}parseTrade(e,t){const i=this.safeString(e,"id");let s=this.safeInteger(e,"timestamp");s=this.safeTimestamp(e,"created_at",s);let r=this.safeString(e,"side");const a=this.safeString(e,"taker_side")===r?"taker":"maker";void 0!==r&&(r=r.toLowerCase());const n=this.safeString2(e,"price","match_price"),o=this.safeString2(e,"amount","exchanged"),h=this.safeString(e,"pair");t=this.safeMarket(h,t);const d=this.safeString(e,a+"_fee"),c=this.safeString(e,a);let l;return void 0!==d&&(l={cost:d,currency:"buy"===r?t.base:t.quote}),this.safeTrade({id:i,order:c,timestamp:s,datetime:this.iso8601(s),symbol:t.symbol,type:void 0,side:r,price:n,amount:o,cost:void 0,takerOrMaker:a,fee:l,info:e},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pair:r.id},n=await this.publicGetTradehistoryPair(this.extend(a,s));return this.parseTrades(n,r,t,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.publicGetPair(e),i=this.safeValue(t,"results",[]),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"symbol"),a=this.safeSymbol(r,void 0,"_"),n=this.safeValue(t,"fees",[]),o=this.safeValue(n,0,{});s[a]={info:t,symbol:a,maker:this.safeNumber(o,"maker_fee"),taker:this.safeNumber(o,"taker_fee"),tierBased:!1}}return s}parseBalance(e){const t={info:e};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"symbol"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"available"),n.used=this.safeString(s,"locked"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetBalancesExchangeBalances(e);return this.parseBalance(t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=t.toUpperCase(),h=i.toUpperCase(),d={pair:n.id,order_type:o,side:h,amount:this.amountToPrecision(e,s)};"LIMIT"===o&&(d.limit_price=this.priceToPrecision(e,r));const c=await this.privatePostOrderPair(this.extend(d,a));return this.parseOrder(c,n)}async cancelOrder(e,t,i={}){if(void 0===t)throw new d(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={pair:s.id,order_id:e},a=await this.privatePostOrderPairOrderIdCancel(this.extend(r,i));return this.parseOrder(a,s)}async fetchOrder(e,t,i={}){if(void 0===t)throw new d(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r={pair:s.id,order_id:e},a=await this.privateGetOrderPairOrderId(this.extend(r,i));return this.parseOrder(a,s)}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new d(this.id+" fetchOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={pair:r.id};void 0!==i&&(a.offset=i);const n=await this.privateGetOrderPair(this.extend(a,s)),o=this.safeValue(n,"results",{}),h=this.safeValue(o,"data",[]);return this.parseOrders(h,r,t,i)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({status:"OPEN,PART"},s))}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({status:"CLOS,CANC,COMP"},s))}parseOrderStatus(e){return this.safeString({OPEN:"open",PART:"open",CLOS:"canceled",CANC:"canceled",COMP:"closed"},e,e)}parseOrder(e,t){const i=this.safeString(e,"order_id"),s=this.safeString(e,"amount"),r=this.safeString(e,"notional"),a=this.safeStringLower(e,"order_type"),n="market"===a?"fill_price":"limit_price",o=this.safeString(e,n),h=this.safeStringLower(e,"side"),d=this.parseOrderStatus(this.safeString(e,"status")),c=this.safeTimestamp(e,"created_at"),l=this.safeString(e,"fill_price"),u=this.safeString(e,"filled"),f=this.safeValue(e,"fills"),p=this.safeString(e,"pair");return this.safeOrder({info:e,id:i,clientOrderId:void 0,timestamp:c,datetime:this.iso8601(c),lastTradeTimestamp:void 0,symbol:this.safeSymbol(p,t,"_"),type:a,timeInForce:void 0,postOnly:void 0,side:h,price:o,stopPrice:this.safeString(e,"stop_price"),triggerPrice:this.safeString(e,"stop_price"),amount:s,cost:r,average:l,filled:u,remaining:void 0,status:d,fee:void 0,trades:f},t)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new d(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={pair:r.id};void 0!==i&&(a.limit=i);const n=await this.privateGetTradePair(this.extend(a,s)),o=this.safeValue(n,"results",{}),h=this.safeValue(o,"data",[]);return this.parseTrades(h,r,t,i)}sign(e,t="public",i="GET",s={},r,a){const n="/"+this.version+"/"+this.implodeParams(e,s);let o=this.urls.api[t]+n;const h=this.omit(s,this.extractParams(e));return"public"===t?Object.keys(h).length&&(o+="?"+this.urlencode(h)):"private"===t&&(this.checkRequiredCredentials(),"POST"===i?a=this.json(h):Object.keys(h).length&&(o+="?"+this.urlencode(h)),r={"Content-Type":"application/json",Authorization:"Bearer "+this.apiKey}),{url:o,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,n,o,h,d){if(void 0===o)return;const c=this.safeString(o,"detail");if(void 0!==c){const e=this.id+" "+n;this.throwBroadlyMatchedException(this.exceptions.broad,c,e)}const l=this.safeValue(o,"errors");if(void 0!==l){const e=this.id+" "+n,t=Object.keys(l);for(let i=0;i<t.length;i++){const s=t[i],r=this.safeValue(l,s,[]),a=this.safeString(r,0);this.throwBroadlyMatchedException(this.exceptions.broad,a,e)}throw new a(e)}}}},35060:function(e,t,i){!function(e,t){"use strict";function s(e,t){if(!e)throw new Error(t||"Assertion failed")}function r(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function a(e,t,i){if(a.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(i=t,t=10),this._init(e||0,t||10,i||"be"))}var n;"object"==typeof e?e.exports=a:t.BN=a,a.BN=a,a.wordSize=26;try{n=i(48764).Buffer}catch(e){}function o(e,t,i){for(var r=0,a=Math.min(e.length,i),n=0,o=t;o<a;o++){var h,d=e.charCodeAt(o)-48;r<<=4,r|=h=d>=49&&d<=54?d-49+10:d>=17&&d<=22?d-17+10:d,n|=h}return s(!(240&n),"Invalid character in "+e),r}function h(e,t,i,r){for(var a=0,n=0,o=Math.min(e.length,i),h=t;h<o;h++){var d=e.charCodeAt(h)-48;a*=r,n=d>=49?d-49+10:d>=17?d-17+10:d,s(d>=0&&n<r,"Invalid character"),a+=n}return a}function d(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"}a.isBN=function(e){return e instanceof a||null!==e&&"object"==typeof e&&e.constructor.wordSize===a.wordSize&&Array.isArray(e.words)},a.max=function(e,t){return e.cmp(t)>0?e:t},a.min=function(e,t){return e.cmp(t)<0?e:t},a.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),s(t===(0|t)&&t>=2&&t<=36);var r=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&r++,16===t?this._parseHex(e,r):this._parseBase(e,t,r),"-"===e[0]&&(this.negative=1),this._strip(),"le"===i&&this._initArray(this.toArray(),t,i)},a.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(s(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},a.prototype._initArray=function(e,t,i){if(s("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var a,n,o=0;if("be"===i)for(r=e.length-1,a=0;r>=0;r-=3)n=e[r]|e[r-1]<<8|e[r-2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);else if("le"===i)for(r=0,a=0;r<e.length;r+=3)n=e[r]|e[r+1]<<8|e[r+2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);return this._strip()},a.prototype._parseHex=function(e,t){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var s,r,a=0;for(i=e.length-6,s=0;i>=t;i-=6)r=o(e,i,i+6),this.words[s]|=r<<a&67108863,this.words[s+1]|=r>>>26-a&4194303,(a+=24)>=26&&(a-=26,s++);i+6!==t&&(r=o(e,t,i+6),this.words[s]|=r<<a&67108863,this.words[s+1]|=r>>>26-a&4194303),this._strip()},a.prototype._parseBase=function(e,t,i){this.words=[0],this.length=1;for(var s=0,r=1;r<=67108863;r*=t)s++;s--,r=r/t|0;for(var a=e.length-i,n=a%s,o=Math.min(a,a-n)+i,d=0,c=i;c<o;c+=s)d=h(e,c,c+s,t),this.imuln(r),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d);if(0!==n){var l=1;for(d=h(e,c,e.length,t),c=0;c<n;c++)l*=t;this.imuln(l),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d)}},a.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},a.prototype._move=function(e){e.words=this.words,e.length=this.length,e.negative=this.negative,e.red=this.red},a.prototype.clone=function(){var e=new a(null);return this.copy(e),e},a.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},a.prototype._strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},a.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},"undefined"!=typeof Symbol&&"function"==typeof Symbol.for?a.prototype[Symbol.for("nodejs.util.inspect.custom")]=d:a.prototype.inspect=d;var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],u=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];a.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var r=0,a=0,n=0;n<this.length;n++){var o=this.words[n],h=(16777215&(o<<r|a)).toString(16);i=0!==(a=o>>>24-r&16777215)||n!==this.length-1?c[6-h.length]+h+i:h+i,(r+=2)>=26&&(r-=26,n--)}for(0!==a&&(i=a.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var d=l[e],f=u[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modrn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:c[d-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}s(!1,"Base should be between 2 and 36")},a.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&s(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},a.prototype.toJSON=function(){return this.toString(16,2)},n&&(a.prototype.toBuffer=function(e,t){return this.toArrayLike(n,e,t)}),a.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)};function f(e,t,i){i.negative=t.negative^e.negative;var s=e.length+t.length|0;i.length=s,s=s-1|0;var r=0|e.words[0],a=0|t.words[0],n=r*a,o=67108863&n,h=n/67108864|0;i.words[0]=o;for(var d=1;d<s;d++){for(var c=h>>>26,l=67108863&h,u=Math.min(d,t.length-1),f=Math.max(0,d-e.length+1);f<=u;f++){var p=d-f|0;c+=(n=(r=0|e.words[p])*(a=0|t.words[f])+l)/67108864|0,l=67108863&n}i.words[d]=0|l,h=0|c}return 0!==h?i.words[d]=0|h:i.length--,i._strip()}a.prototype.toArrayLike=function(e,t,i){this._strip();var r=this.byteLength(),a=i||Math.max(1,r);s(r<=a,"byte array longer than desired length"),s(a>0,"Requested array length <= 0");var n=function(e,t){return e.allocUnsafe?e.allocUnsafe(t):new e(t)}(e,a);return this["_toArrayLike"+("le"===t?"LE":"BE")](n,r),n},a.prototype._toArrayLikeLE=function(e,t){for(var i=0,s=0,r=0,a=0;r<this.length;r++){var n=this.words[r]<<a|s;e[i++]=255&n,i<e.length&&(e[i++]=n>>8&255),i<e.length&&(e[i++]=n>>16&255),6===a?(i<e.length&&(e[i++]=n>>24&255),s=0,a=0):(s=n>>>24,a+=2)}if(i<e.length)for(e[i++]=s;i<e.length;)e[i++]=0},a.prototype._toArrayLikeBE=function(e,t){for(var i=e.length-1,s=0,r=0,a=0;r<this.length;r++){var n=this.words[r]<<a|s;e[i--]=255&n,i>=0&&(e[i--]=n>>8&255),i>=0&&(e[i--]=n>>16&255),6===a?(i>=0&&(e[i--]=n>>24&255),s=0,a=0):(s=n>>>24,a+=2)}if(i>=0)for(e[i--]=s;i>=0;)e[i--]=0},Math.clz32?a.prototype._countBits=function(e){return 32-Math.clz32(e)}:a.prototype._countBits=function(e){var t=e,i=0;return t>=4096&&(i+=13,t>>>=13),t>=64&&(i+=7,t>>>=7),t>=8&&(i+=4,t>>>=4),t>=2&&(i+=2,t>>>=2),i+t},a.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,i=0;return 0==(8191&t)&&(i+=13,t>>>=13),0==(127&t)&&(i+=7,t>>>=7),0==(15&t)&&(i+=4,t>>>=4),0==(3&t)&&(i+=2,t>>>=2),0==(1&t)&&i++,i},a.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},a.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var i=this._zeroBits(this.words[t]);if(e+=i,26!==i)break}return e},a.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},a.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},a.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},a.prototype.isNeg=function(){return 0!==this.negative},a.prototype.neg=function(){return this.clone().ineg()},a.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},a.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this._strip()},a.prototype.ior=function(e){return s(0==(this.negative|e.negative)),this.iuor(e)},a.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},a.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},a.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var i=0;i<t.length;i++)this.words[i]=this.words[i]&e.words[i];return this.length=t.length,this._strip()},a.prototype.iand=function(e){return s(0==(this.negative|e.negative)),this.iuand(e)},a.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},a.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},a.prototype.iuxor=function(e){var t,i;this.length>e.length?(t=this,i=e):(t=e,i=this);for(var s=0;s<i.length;s++)this.words[s]=t.words[s]^i.words[s];if(this!==t)for(;s<t.length;s++)this.words[s]=t.words[s];return this.length=t.length,this._strip()},a.prototype.ixor=function(e){return s(0==(this.negative|e.negative)),this.iuxor(e)},a.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},a.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},a.prototype.inotn=function(e){s("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var r=0;r<t;r++)this.words[r]=67108863&~this.words[r];return i>0&&(this.words[r]=~this.words[r]&67108863>>26-i),this._strip()},a.prototype.notn=function(e){return this.clone().inotn(e)},a.prototype.setn=function(e,t){s("number"==typeof e&&e>=0);var i=e/26|0,r=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<r:this.words[i]&~(1<<r),this._strip()},a.prototype.iadd=function(e){var t,i,s;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(i=this,s=e):(i=e,s=this);for(var r=0,a=0;a<s.length;a++)t=(0|i.words[a])+(0|s.words[a])+r,this.words[a]=67108863&t,r=t>>>26;for(;0!==r&&a<i.length;a++)t=(0|i.words[a])+r,this.words[a]=67108863&t,r=t>>>26;if(this.length=i.length,0!==r)this.words[this.length]=r,this.length++;else if(i!==this)for(;a<i.length;a++)this.words[a]=i.words[a];return this},a.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},a.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var i,s,r=this.cmp(e);if(0===r)return this.negative=0,this.length=1,this.words[0]=0,this;r>0?(i=this,s=e):(i=e,s=this);for(var a=0,n=0;n<s.length;n++)a=(t=(0|i.words[n])-(0|s.words[n])+a)>>26,this.words[n]=67108863&t;for(;0!==a&&n<i.length;n++)a=(t=(0|i.words[n])+a)>>26,this.words[n]=67108863&t;if(0===a&&n<i.length&&i!==this)for(;n<i.length;n++)this.words[n]=i.words[n];return this.length=Math.max(this.length,n),i!==this&&(this.negative=1),this._strip()},a.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,i){var s,r,a,n=e.words,o=t.words,h=i.words,d=0,c=0|n[0],l=8191&c,u=c>>>13,f=0|n[1],p=8191&f,m=f>>>13,g=0|n[2],y=8191&g,b=g>>>13,v=0|n[3],w=8191&v,S=v>>>13,k=0|n[4],T=8191&k,_=k>>>13,O=0|n[5],M=8191&O,I=O>>>13,x=0|n[6],C=8191&x,P=x>>>13,A=0|n[7],N=8191&A,B=A>>>13,E=0|n[8],V=8191&E,L=E>>>13,R=0|n[9],D=8191&R,F=R>>>13,q=0|o[0],G=8191&q,H=q>>>13,U=0|o[1],j=8191&U,W=U>>>13,z=0|o[2],K=8191&z,X=z>>>13,Z=0|o[3],Y=8191&Z,Q=Z>>>13,J=0|o[4],$=8191&J,ee=J>>>13,te=0|o[5],ie=8191&te,se=te>>>13,re=0|o[6],ae=8191&re,ne=re>>>13,oe=0|o[7],he=8191&oe,de=oe>>>13,ce=0|o[8],le=8191&ce,ue=ce>>>13,fe=0|o[9],pe=8191&fe,me=fe>>>13;i.negative=e.negative^t.negative,i.length=19;var ge=(d+(s=Math.imul(l,G))|0)+((8191&(r=(r=Math.imul(l,H))+Math.imul(u,G)|0))<<13)|0;d=((a=Math.imul(u,H))+(r>>>13)|0)+(ge>>>26)|0,ge&=67108863,s=Math.imul(p,G),r=(r=Math.imul(p,H))+Math.imul(m,G)|0,a=Math.imul(m,H);var ye=(d+(s=s+Math.imul(l,j)|0)|0)+((8191&(r=(r=r+Math.imul(l,W)|0)+Math.imul(u,j)|0))<<13)|0;d=((a=a+Math.imul(u,W)|0)+(r>>>13)|0)+(ye>>>26)|0,ye&=67108863,s=Math.imul(y,G),r=(r=Math.imul(y,H))+Math.imul(b,G)|0,a=Math.imul(b,H),s=s+Math.imul(p,j)|0,r=(r=r+Math.imul(p,W)|0)+Math.imul(m,j)|0,a=a+Math.imul(m,W)|0;var be=(d+(s=s+Math.imul(l,K)|0)|0)+((8191&(r=(r=r+Math.imul(l,X)|0)+Math.imul(u,K)|0))<<13)|0;d=((a=a+Math.imul(u,X)|0)+(r>>>13)|0)+(be>>>26)|0,be&=67108863,s=Math.imul(w,G),r=(r=Math.imul(w,H))+Math.imul(S,G)|0,a=Math.imul(S,H),s=s+Math.imul(y,j)|0,r=(r=r+Math.imul(y,W)|0)+Math.imul(b,j)|0,a=a+Math.imul(b,W)|0,s=s+Math.imul(p,K)|0,r=(r=r+Math.imul(p,X)|0)+Math.imul(m,K)|0,a=a+Math.imul(m,X)|0;var ve=(d+(s=s+Math.imul(l,Y)|0)|0)+((8191&(r=(r=r+Math.imul(l,Q)|0)+Math.imul(u,Y)|0))<<13)|0;d=((a=a+Math.imul(u,Q)|0)+(r>>>13)|0)+(ve>>>26)|0,ve&=67108863,s=Math.imul(T,G),r=(r=Math.imul(T,H))+Math.imul(_,G)|0,a=Math.imul(_,H),s=s+Math.imul(w,j)|0,r=(r=r+Math.imul(w,W)|0)+Math.imul(S,j)|0,a=a+Math.imul(S,W)|0,s=s+Math.imul(y,K)|0,r=(r=r+Math.imul(y,X)|0)+Math.imul(b,K)|0,a=a+Math.imul(b,X)|0,s=s+Math.imul(p,Y)|0,r=(r=r+Math.imul(p,Q)|0)+Math.imul(m,Y)|0,a=a+Math.imul(m,Q)|0;var we=(d+(s=s+Math.imul(l,$)|0)|0)+((8191&(r=(r=r+Math.imul(l,ee)|0)+Math.imul(u,$)|0))<<13)|0;d=((a=a+Math.imul(u,ee)|0)+(r>>>13)|0)+(we>>>26)|0,we&=67108863,s=Math.imul(M,G),r=(r=Math.imul(M,H))+Math.imul(I,G)|0,a=Math.imul(I,H),s=s+Math.imul(T,j)|0,r=(r=r+Math.imul(T,W)|0)+Math.imul(_,j)|0,a=a+Math.imul(_,W)|0,s=s+Math.imul(w,K)|0,r=(r=r+Math.imul(w,X)|0)+Math.imul(S,K)|0,a=a+Math.imul(S,X)|0,s=s+Math.imul(y,Y)|0,r=(r=r+Math.imul(y,Q)|0)+Math.imul(b,Y)|0,a=a+Math.imul(b,Q)|0,s=s+Math.imul(p,$)|0,r=(r=r+Math.imul(p,ee)|0)+Math.imul(m,$)|0,a=a+Math.imul(m,ee)|0;var Se=(d+(s=s+Math.imul(l,ie)|0)|0)+((8191&(r=(r=r+Math.imul(l,se)|0)+Math.imul(u,ie)|0))<<13)|0;d=((a=a+Math.imul(u,se)|0)+(r>>>13)|0)+(Se>>>26)|0,Se&=67108863,s=Math.imul(C,G),r=(r=Math.imul(C,H))+Math.imul(P,G)|0,a=Math.imul(P,H),s=s+Math.imul(M,j)|0,r=(r=r+Math.imul(M,W)|0)+Math.imul(I,j)|0,a=a+Math.imul(I,W)|0,s=s+Math.imul(T,K)|0,r=(r=r+Math.imul(T,X)|0)+Math.imul(_,K)|0,a=a+Math.imul(_,X)|0,s=s+Math.imul(w,Y)|0,r=(r=r+Math.imul(w,Q)|0)+Math.imul(S,Y)|0,a=a+Math.imul(S,Q)|0,s=s+Math.imul(y,$)|0,r=(r=r+Math.imul(y,ee)|0)+Math.imul(b,$)|0,a=a+Math.imul(b,ee)|0,s=s+Math.imul(p,ie)|0,r=(r=r+Math.imul(p,se)|0)+Math.imul(m,ie)|0,a=a+Math.imul(m,se)|0;var ke=(d+(s=s+Math.imul(l,ae)|0)|0)+((8191&(r=(r=r+Math.imul(l,ne)|0)+Math.imul(u,ae)|0))<<13)|0;d=((a=a+Math.imul(u,ne)|0)+(r>>>13)|0)+(ke>>>26)|0,ke&=67108863,s=Math.imul(N,G),r=(r=Math.imul(N,H))+Math.imul(B,G)|0,a=Math.imul(B,H),s=s+Math.imul(C,j)|0,r=(r=r+Math.imul(C,W)|0)+Math.imul(P,j)|0,a=a+Math.imul(P,W)|0,s=s+Math.imul(M,K)|0,r=(r=r+Math.imul(M,X)|0)+Math.imul(I,K)|0,a=a+Math.imul(I,X)|0,s=s+Math.imul(T,Y)|0,r=(r=r+Math.imul(T,Q)|0)+Math.imul(_,Y)|0,a=a+Math.imul(_,Q)|0,s=s+Math.imul(w,$)|0,r=(r=r+Math.imul(w,ee)|0)+Math.imul(S,$)|0,a=a+Math.imul(S,ee)|0,s=s+Math.imul(y,ie)|0,r=(r=r+Math.imul(y,se)|0)+Math.imul(b,ie)|0,a=a+Math.imul(b,se)|0,s=s+Math.imul(p,ae)|0,r=(r=r+Math.imul(p,ne)|0)+Math.imul(m,ae)|0,a=a+Math.imul(m,ne)|0;var Te=(d+(s=s+Math.imul(l,he)|0)|0)+((8191&(r=(r=r+Math.imul(l,de)|0)+Math.imul(u,he)|0))<<13)|0;d=((a=a+Math.imul(u,de)|0)+(r>>>13)|0)+(Te>>>26)|0,Te&=67108863,s=Math.imul(V,G),r=(r=Math.imul(V,H))+Math.imul(L,G)|0,a=Math.imul(L,H),s=s+Math.imul(N,j)|0,r=(r=r+Math.imul(N,W)|0)+Math.imul(B,j)|0,a=a+Math.imul(B,W)|0,s=s+Math.imul(C,K)|0,r=(r=r+Math.imul(C,X)|0)+Math.imul(P,K)|0,a=a+Math.imul(P,X)|0,s=s+Math.imul(M,Y)|0,r=(r=r+Math.imul(M,Q)|0)+Math.imul(I,Y)|0,a=a+Math.imul(I,Q)|0,s=s+Math.imul(T,$)|0,r=(r=r+Math.imul(T,ee)|0)+Math.imul(_,$)|0,a=a+Math.imul(_,ee)|0,s=s+Math.imul(w,ie)|0,r=(r=r+Math.imul(w,se)|0)+Math.imul(S,ie)|0,a=a+Math.imul(S,se)|0,s=s+Math.imul(y,ae)|0,r=(r=r+Math.imul(y,ne)|0)+Math.imul(b,ae)|0,a=a+Math.imul(b,ne)|0,s=s+Math.imul(p,he)|0,r=(r=r+Math.imul(p,de)|0)+Math.imul(m,he)|0,a=a+Math.imul(m,de)|0;var _e=(d+(s=s+Math.imul(l,le)|0)|0)+((8191&(r=(r=r+Math.imul(l,ue)|0)+Math.imul(u,le)|0))<<13)|0;d=((a=a+Math.imul(u,ue)|0)+(r>>>13)|0)+(_e>>>26)|0,_e&=67108863,s=Math.imul(D,G),r=(r=Math.imul(D,H))+Math.imul(F,G)|0,a=Math.imul(F,H),s=s+Math.imul(V,j)|0,r=(r=r+Math.imul(V,W)|0)+Math.imul(L,j)|0,a=a+Math.imul(L,W)|0,s=s+Math.imul(N,K)|0,r=(r=r+Math.imul(N,X)|0)+Math.imul(B,K)|0,a=a+Math.imul(B,X)|0,s=s+Math.imul(C,Y)|0,r=(r=r+Math.imul(C,Q)|0)+Math.imul(P,Y)|0,a=a+Math.imul(P,Q)|0,s=s+Math.imul(M,$)|0,r=(r=r+Math.imul(M,ee)|0)+Math.imul(I,$)|0,a=a+Math.imul(I,ee)|0,s=s+Math.imul(T,ie)|0,r=(r=r+Math.imul(T,se)|0)+Math.imul(_,ie)|0,a=a+Math.imul(_,se)|0,s=s+Math.imul(w,ae)|0,r=(r=r+Math.imul(w,ne)|0)+Math.imul(S,ae)|0,a=a+Math.imul(S,ne)|0,s=s+Math.imul(y,he)|0,r=(r=r+Math.imul(y,de)|0)+Math.imul(b,he)|0,a=a+Math.imul(b,de)|0,s=s+Math.imul(p,le)|0,r=(r=r+Math.imul(p,ue)|0)+Math.imul(m,le)|0,a=a+Math.imul(m,ue)|0;var Oe=(d+(s=s+Math.imul(l,pe)|0)|0)+((8191&(r=(r=r+Math.imul(l,me)|0)+Math.imul(u,pe)|0))<<13)|0;d=((a=a+Math.imul(u,me)|0)+(r>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,s=Math.imul(D,j),r=(r=Math.imul(D,W))+Math.imul(F,j)|0,a=Math.imul(F,W),s=s+Math.imul(V,K)|0,r=(r=r+Math.imul(V,X)|0)+Math.imul(L,K)|0,a=a+Math.imul(L,X)|0,s=s+Math.imul(N,Y)|0,r=(r=r+Math.imul(N,Q)|0)+Math.imul(B,Y)|0,a=a+Math.imul(B,Q)|0,s=s+Math.imul(C,$)|0,r=(r=r+Math.imul(C,ee)|0)+Math.imul(P,$)|0,a=a+Math.imul(P,ee)|0,s=s+Math.imul(M,ie)|0,r=(r=r+Math.imul(M,se)|0)+Math.imul(I,ie)|0,a=a+Math.imul(I,se)|0,s=s+Math.imul(T,ae)|0,r=(r=r+Math.imul(T,ne)|0)+Math.imul(_,ae)|0,a=a+Math.imul(_,ne)|0,s=s+Math.imul(w,he)|0,r=(r=r+Math.imul(w,de)|0)+Math.imul(S,he)|0,a=a+Math.imul(S,de)|0,s=s+Math.imul(y,le)|0,r=(r=r+Math.imul(y,ue)|0)+Math.imul(b,le)|0,a=a+Math.imul(b,ue)|0;var Me=(d+(s=s+Math.imul(p,pe)|0)|0)+((8191&(r=(r=r+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;d=((a=a+Math.imul(m,me)|0)+(r>>>13)|0)+(Me>>>26)|0,Me&=67108863,s=Math.imul(D,K),r=(r=Math.imul(D,X))+Math.imul(F,K)|0,a=Math.imul(F,X),s=s+Math.imul(V,Y)|0,r=(r=r+Math.imul(V,Q)|0)+Math.imul(L,Y)|0,a=a+Math.imul(L,Q)|0,s=s+Math.imul(N,$)|0,r=(r=r+Math.imul(N,ee)|0)+Math.imul(B,$)|0,a=a+Math.imul(B,ee)|0,s=s+Math.imul(C,ie)|0,r=(r=r+Math.imul(C,se)|0)+Math.imul(P,ie)|0,a=a+Math.imul(P,se)|0,s=s+Math.imul(M,ae)|0,r=(r=r+Math.imul(M,ne)|0)+Math.imul(I,ae)|0,a=a+Math.imul(I,ne)|0,s=s+Math.imul(T,he)|0,r=(r=r+Math.imul(T,de)|0)+Math.imul(_,he)|0,a=a+Math.imul(_,de)|0,s=s+Math.imul(w,le)|0,r=(r=r+Math.imul(w,ue)|0)+Math.imul(S,le)|0,a=a+Math.imul(S,ue)|0;var Ie=(d+(s=s+Math.imul(y,pe)|0)|0)+((8191&(r=(r=r+Math.imul(y,me)|0)+Math.imul(b,pe)|0))<<13)|0;d=((a=a+Math.imul(b,me)|0)+(r>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,s=Math.imul(D,Y),r=(r=Math.imul(D,Q))+Math.imul(F,Y)|0,a=Math.imul(F,Q),s=s+Math.imul(V,$)|0,r=(r=r+Math.imul(V,ee)|0)+Math.imul(L,$)|0,a=a+Math.imul(L,ee)|0,s=s+Math.imul(N,ie)|0,r=(r=r+Math.imul(N,se)|0)+Math.imul(B,ie)|0,a=a+Math.imul(B,se)|0,s=s+Math.imul(C,ae)|0,r=(r=r+Math.imul(C,ne)|0)+Math.imul(P,ae)|0,a=a+Math.imul(P,ne)|0,s=s+Math.imul(M,he)|0,r=(r=r+Math.imul(M,de)|0)+Math.imul(I,he)|0,a=a+Math.imul(I,de)|0,s=s+Math.imul(T,le)|0,r=(r=r+Math.imul(T,ue)|0)+Math.imul(_,le)|0,a=a+Math.imul(_,ue)|0;var xe=(d+(s=s+Math.imul(w,pe)|0)|0)+((8191&(r=(r=r+Math.imul(w,me)|0)+Math.imul(S,pe)|0))<<13)|0;d=((a=a+Math.imul(S,me)|0)+(r>>>13)|0)+(xe>>>26)|0,xe&=67108863,s=Math.imul(D,$),r=(r=Math.imul(D,ee))+Math.imul(F,$)|0,a=Math.imul(F,ee),s=s+Math.imul(V,ie)|0,r=(r=r+Math.imul(V,se)|0)+Math.imul(L,ie)|0,a=a+Math.imul(L,se)|0,s=s+Math.imul(N,ae)|0,r=(r=r+Math.imul(N,ne)|0)+Math.imul(B,ae)|0,a=a+Math.imul(B,ne)|0,s=s+Math.imul(C,he)|0,r=(r=r+Math.imul(C,de)|0)+Math.imul(P,he)|0,a=a+Math.imul(P,de)|0,s=s+Math.imul(M,le)|0,r=(r=r+Math.imul(M,ue)|0)+Math.imul(I,le)|0,a=a+Math.imul(I,ue)|0;var Ce=(d+(s=s+Math.imul(T,pe)|0)|0)+((8191&(r=(r=r+Math.imul(T,me)|0)+Math.imul(_,pe)|0))<<13)|0;d=((a=a+Math.imul(_,me)|0)+(r>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,s=Math.imul(D,ie),r=(r=Math.imul(D,se))+Math.imul(F,ie)|0,a=Math.imul(F,se),s=s+Math.imul(V,ae)|0,r=(r=r+Math.imul(V,ne)|0)+Math.imul(L,ae)|0,a=a+Math.imul(L,ne)|0,s=s+Math.imul(N,he)|0,r=(r=r+Math.imul(N,de)|0)+Math.imul(B,he)|0,a=a+Math.imul(B,de)|0,s=s+Math.imul(C,le)|0,r=(r=r+Math.imul(C,ue)|0)+Math.imul(P,le)|0,a=a+Math.imul(P,ue)|0;var Pe=(d+(s=s+Math.imul(M,pe)|0)|0)+((8191&(r=(r=r+Math.imul(M,me)|0)+Math.imul(I,pe)|0))<<13)|0;d=((a=a+Math.imul(I,me)|0)+(r>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,s=Math.imul(D,ae),r=(r=Math.imul(D,ne))+Math.imul(F,ae)|0,a=Math.imul(F,ne),s=s+Math.imul(V,he)|0,r=(r=r+Math.imul(V,de)|0)+Math.imul(L,he)|0,a=a+Math.imul(L,de)|0,s=s+Math.imul(N,le)|0,r=(r=r+Math.imul(N,ue)|0)+Math.imul(B,le)|0,a=a+Math.imul(B,ue)|0;var Ae=(d+(s=s+Math.imul(C,pe)|0)|0)+((8191&(r=(r=r+Math.imul(C,me)|0)+Math.imul(P,pe)|0))<<13)|0;d=((a=a+Math.imul(P,me)|0)+(r>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,s=Math.imul(D,he),r=(r=Math.imul(D,de))+Math.imul(F,he)|0,a=Math.imul(F,de),s=s+Math.imul(V,le)|0,r=(r=r+Math.imul(V,ue)|0)+Math.imul(L,le)|0,a=a+Math.imul(L,ue)|0;var Ne=(d+(s=s+Math.imul(N,pe)|0)|0)+((8191&(r=(r=r+Math.imul(N,me)|0)+Math.imul(B,pe)|0))<<13)|0;d=((a=a+Math.imul(B,me)|0)+(r>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,s=Math.imul(D,le),r=(r=Math.imul(D,ue))+Math.imul(F,le)|0,a=Math.imul(F,ue);var Be=(d+(s=s+Math.imul(V,pe)|0)|0)+((8191&(r=(r=r+Math.imul(V,me)|0)+Math.imul(L,pe)|0))<<13)|0;d=((a=a+Math.imul(L,me)|0)+(r>>>13)|0)+(Be>>>26)|0,Be&=67108863;var Ee=(d+(s=Math.imul(D,pe))|0)+((8191&(r=(r=Math.imul(D,me))+Math.imul(F,pe)|0))<<13)|0;return d=((a=Math.imul(F,me))+(r>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,h[0]=ge,h[1]=ye,h[2]=be,h[3]=ve,h[4]=we,h[5]=Se,h[6]=ke,h[7]=Te,h[8]=_e,h[9]=Oe,h[10]=Me,h[11]=Ie,h[12]=xe,h[13]=Ce,h[14]=Pe,h[15]=Ae,h[16]=Ne,h[17]=Be,h[18]=Ee,0!==d&&(h[19]=d,i.length++),i};function m(e,t,i){i.negative=t.negative^e.negative,i.length=e.length+t.length;for(var s=0,r=0,a=0;a<i.length-1;a++){var n=r;r=0;for(var o=67108863&s,h=Math.min(a,t.length-1),d=Math.max(0,a-e.length+1);d<=h;d++){var c=a-d,l=(0|e.words[c])*(0|t.words[d]),u=67108863&l;o=67108863&(u=u+o|0),r+=(n=(n=n+(l/67108864|0)|0)+(u>>>26)|0)>>>26,n&=67108863}i.words[a]=o,s=n,n=r}return 0!==s?i.words[a]=s:i.length--,i._strip()}function g(e,t,i){return m(e,t,i)}function y(e,t){this.x=e,this.y=t}Math.imul||(p=f),a.prototype.mulTo=function(e,t){var i=this.length+e.length;return 10===this.length&&10===e.length?p(this,e,t):i<63?f(this,e,t):i<1024?m(this,e,t):g(this,e,t)},y.prototype.makeRBT=function(e){for(var t=new Array(e),i=a.prototype._countBits(e)-1,s=0;s<e;s++)t[s]=this.revBin(s,i,e);return t},y.prototype.revBin=function(e,t,i){if(0===e||e===i-1)return e;for(var s=0,r=0;r<t;r++)s|=(1&e)<<t-r-1,e>>=1;return s},y.prototype.permute=function(e,t,i,s,r,a){for(var n=0;n<a;n++)s[n]=t[e[n]],r[n]=i[e[n]]},y.prototype.transform=function(e,t,i,s,r,a){this.permute(a,e,t,i,s,r);for(var n=1;n<r;n<<=1)for(var o=n<<1,h=Math.cos(2*Math.PI/o),d=Math.sin(2*Math.PI/o),c=0;c<r;c+=o)for(var l=h,u=d,f=0;f<n;f++){var p=i[c+f],m=s[c+f],g=i[c+f+n],y=s[c+f+n],b=l*g-u*y;y=l*y+u*g,g=b,i[c+f]=p+g,s[c+f]=m+y,i[c+f+n]=p-g,s[c+f+n]=m-y,f!==o&&(b=h*l-d*u,u=h*u+d*l,l=b)}},y.prototype.guessLen13b=function(e,t){var i=1|Math.max(t,e),s=1&i,r=0;for(i=i/2|0;i;i>>>=1)r++;return 1<<r+1+s},y.prototype.conjugate=function(e,t,i){if(!(i<=1))for(var s=0;s<i/2;s++){var r=e[s];e[s]=e[i-s-1],e[i-s-1]=r,r=t[s],t[s]=-t[i-s-1],t[i-s-1]=-r}},y.prototype.normalize13b=function(e,t){for(var i=0,s=0;s<t/2;s++){var r=8192*Math.round(e[2*s+1]/t)+Math.round(e[2*s]/t)+i;e[s]=67108863&r,i=r<67108864?0:r/67108864|0}return e},y.prototype.convert13b=function(e,t,i,r){for(var a=0,n=0;n<t;n++)a+=0|e[n],i[2*n]=8191&a,a>>>=13,i[2*n+1]=8191&a,a>>>=13;for(n=2*t;n<r;++n)i[n]=0;s(0===a),s(0==(-8192&a))},y.prototype.stub=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=0;return t},y.prototype.mulp=function(e,t,i){var s=2*this.guessLen13b(e.length,t.length),r=this.makeRBT(s),a=this.stub(s),n=new Array(s),o=new Array(s),h=new Array(s),d=new Array(s),c=new Array(s),l=new Array(s),u=i.words;u.length=s,this.convert13b(e.words,e.length,n,s),this.convert13b(t.words,t.length,d,s),this.transform(n,a,o,h,s,r),this.transform(d,a,c,l,s,r);for(var f=0;f<s;f++){var p=o[f]*c[f]-h[f]*l[f];h[f]=o[f]*l[f]+h[f]*c[f],o[f]=p}return this.conjugate(o,h,s),this.transform(o,h,u,a,s,r),this.conjugate(u,a,s),this.normalize13b(u,s),i.negative=e.negative^t.negative,i.length=e.length+t.length,i._strip()},a.prototype.mul=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},a.prototype.mulf=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),g(this,e,t)},a.prototype.imul=function(e){return this.clone().mulTo(e,this)},a.prototype.imuln=function(e){var t=e<0;t&&(e=-e),s("number"==typeof e),s(e<67108864);for(var i=0,r=0;r<this.length;r++){var a=(0|this.words[r])*e,n=(67108863&a)+(67108863&i);i>>=26,i+=a/67108864|0,i+=n>>>26,this.words[r]=67108863&n}return 0!==i&&(this.words[r]=i,this.length++),t?this.ineg():this},a.prototype.muln=function(e){return this.clone().imuln(e)},a.prototype.sqr=function(){return this.mul(this)},a.prototype.isqr=function(){return this.imul(this.clone())},a.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),i=0;i<t.length;i++){var s=i/26|0,r=i%26;t[i]=e.words[s]>>>r&1}return t}(e);if(0===t.length)return new a(1);for(var i=this,s=0;s<t.length&&0===t[s];s++,i=i.sqr());if(++s<t.length)for(var r=i.sqr();s<t.length;s++,r=r.sqr())0!==t[s]&&(i=i.mul(r));return i},a.prototype.iushln=function(e){s("number"==typeof e&&e>=0);var t,i=e%26,r=(e-i)/26,a=67108863>>>26-i<<26-i;if(0!==i){var n=0;for(t=0;t<this.length;t++){var o=this.words[t]&a,h=(0|this.words[t])-o<<i;this.words[t]=h|n,n=o>>>26-i}n&&(this.words[t]=n,this.length++)}if(0!==r){for(t=this.length-1;t>=0;t--)this.words[t+r]=this.words[t];for(t=0;t<r;t++)this.words[t]=0;this.length+=r}return this._strip()},a.prototype.ishln=function(e){return s(0===this.negative),this.iushln(e)},a.prototype.iushrn=function(e,t,i){var r;s("number"==typeof e&&e>=0),r=t?(t-t%26)/26:0;var a=e%26,n=Math.min((e-a)/26,this.length),o=67108863^67108863>>>a<<a,h=i;if(r-=n,r=Math.max(0,r),h){for(var d=0;d<n;d++)h.words[d]=this.words[d];h.length=n}if(0===n);else if(this.length>n)for(this.length-=n,d=0;d<this.length;d++)this.words[d]=this.words[d+n];else this.words[0]=0,this.length=1;var c=0;for(d=this.length-1;d>=0&&(0!==c||d>=r);d--){var l=0|this.words[d];this.words[d]=c<<26-a|l>>>a,c=l&o}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this._strip()},a.prototype.ishrn=function(e,t,i){return s(0===this.negative),this.iushrn(e,t,i)},a.prototype.shln=function(e){return this.clone().ishln(e)},a.prototype.ushln=function(e){return this.clone().iushln(e)},a.prototype.shrn=function(e){return this.clone().ishrn(e)},a.prototype.ushrn=function(e){return this.clone().iushrn(e)},a.prototype.testn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,r=1<<t;return!(this.length<=i)&&!!(this.words[i]&r)},a.prototype.imaskn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(s(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var r=67108863^67108863>>>t<<t;this.words[this.length-1]&=r}return this._strip()},a.prototype.maskn=function(e){return this.clone().imaskn(e)},a.prototype.iaddn=function(e){return s("number"==typeof e),s(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<=e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},a.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},a.prototype.isubn=function(e){if(s("number"==typeof e),s(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this._strip()},a.prototype.addn=function(e){return this.clone().iaddn(e)},a.prototype.subn=function(e){return this.clone().isubn(e)},a.prototype.iabs=function(){return this.negative=0,this},a.prototype.abs=function(){return this.clone().iabs()},a.prototype._ishlnsubmul=function(e,t,i){var r,a,n=e.length+i;this._expand(n);var o=0;for(r=0;r<e.length;r++){a=(0|this.words[r+i])+o;var h=(0|e.words[r])*t;o=((a-=67108863&h)>>26)-(h/67108864|0),this.words[r+i]=67108863&a}for(;r<this.length-i;r++)o=(a=(0|this.words[r+i])+o)>>26,this.words[r+i]=67108863&a;if(0===o)return this._strip();for(s(-1===o),o=0,r=0;r<this.length;r++)o=(a=-(0|this.words[r])+o)>>26,this.words[r]=67108863&a;return this.negative=1,this._strip()},a.prototype._wordDiv=function(e,t){var i=(this.length,e.length),s=this.clone(),r=e,n=0|r.words[r.length-1];0!==(i=26-this._countBits(n))&&(r=r.ushln(i),s.iushln(i),n=0|r.words[r.length-1]);var o,h=s.length-r.length;if("mod"!==t){(o=new a(null)).length=h+1,o.words=new Array(o.length);for(var d=0;d<o.length;d++)o.words[d]=0}var c=s.clone()._ishlnsubmul(r,1,h);0===c.negative&&(s=c,o&&(o.words[h]=1));for(var l=h-1;l>=0;l--){var u=67108864*(0|s.words[r.length+l])+(0|s.words[r.length+l-1]);for(u=Math.min(u/n|0,67108863),s._ishlnsubmul(r,u,l);0!==s.negative;)u--,s.negative=0,s._ishlnsubmul(r,1,l),s.isZero()||(s.negative^=1);o&&(o.words[l]=u)}return o&&o._strip(),s._strip(),"div"!==t&&0!==i&&s.iushrn(i),{div:o||null,mod:s}},a.prototype.divmod=function(e,t,i){return s(!e.isZero()),this.isZero()?{div:new a(0),mod:new a(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(r=o.div.neg()),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.iadd(e)),{div:r,mod:n}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(r=o.div.neg()),{div:r,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.isub(e)),{div:o.div,mod:n}):e.length>this.length||this.cmp(e)<0?{div:new a(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new a(this.modrn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new a(this.modrn(e.words[0]))}:this._wordDiv(e,t);var r,n,o},a.prototype.div=function(e){return this.divmod(e,"div",!1).div},a.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},a.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},a.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var i=0!==t.div.negative?t.mod.isub(e):t.mod,s=e.ushrn(1),r=e.andln(1),a=i.cmp(s);return a<0||1===r&&0===a?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},a.prototype.modrn=function(e){var t=e<0;t&&(e=-e),s(e<=67108863);for(var i=(1<<26)%e,r=0,a=this.length-1;a>=0;a--)r=(i*r+(0|this.words[a]))%e;return t?-r:r},a.prototype.modn=function(e){return this.modrn(e)},a.prototype.idivn=function(e){var t=e<0;t&&(e=-e),s(e<=67108863);for(var i=0,r=this.length-1;r>=0;r--){var a=(0|this.words[r])+67108864*i;this.words[r]=a/e|0,i=a%e}return this._strip(),t?this.ineg():this},a.prototype.divn=function(e){return this.clone().idivn(e)},a.prototype.egcd=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r=new a(1),n=new a(0),o=new a(0),h=new a(1),d=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++d;for(var c=i.clone(),l=t.clone();!t.isZero();){for(var u=0,f=1;0==(t.words[0]&f)&&u<26;++u,f<<=1);if(u>0)for(t.iushrn(u);u-- >0;)(r.isOdd()||n.isOdd())&&(r.iadd(c),n.isub(l)),r.iushrn(1),n.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(o.isOdd()||h.isOdd())&&(o.iadd(c),h.isub(l)),o.iushrn(1),h.iushrn(1);t.cmp(i)>=0?(t.isub(i),r.isub(o),n.isub(h)):(i.isub(t),o.isub(r),h.isub(n))}return{a:o,b:h,gcd:i.iushln(d)}},a.prototype._invmp=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r,n=new a(1),o=new a(0),h=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var d=0,c=1;0==(t.words[0]&c)&&d<26;++d,c<<=1);if(d>0)for(t.iushrn(d);d-- >0;)n.isOdd()&&n.iadd(h),n.iushrn(1);for(var l=0,u=1;0==(i.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(i.iushrn(l);l-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(o)):(i.isub(t),o.isub(n))}return(r=0===t.cmpn(1)?n:o).cmpn(0)<0&&r.iadd(e),r},a.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),i=e.clone();t.negative=0,i.negative=0;for(var s=0;t.isEven()&&i.isEven();s++)t.iushrn(1),i.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;i.isEven();)i.iushrn(1);var r=t.cmp(i);if(r<0){var a=t;t=i,i=a}else if(0===r||0===i.cmpn(1))break;t.isub(i)}return i.iushln(s)},a.prototype.invm=function(e){return this.egcd(e).a.umod(e)},a.prototype.isEven=function(){return 0==(1&this.words[0])},a.prototype.isOdd=function(){return 1==(1&this.words[0])},a.prototype.andln=function(e){return this.words[0]&e},a.prototype.bincn=function(e){s("number"==typeof e);var t=e%26,i=(e-t)/26,r=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=r,this;for(var a=r,n=i;0!==a&&n<this.length;n++){var o=0|this.words[n];a=(o+=a)>>>26,o&=67108863,this.words[n]=o}return 0!==a&&(this.words[n]=a,this.length++),this},a.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},a.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this._strip(),this.length>1)t=1;else{i&&(e=-e),s(e<=67108863,"Number is too big");var r=0|this.words[0];t=r===e?0:r<e?-1:1}return 0!==this.negative?0|-t:t},a.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},a.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,i=this.length-1;i>=0;i--){var s=0|this.words[i],r=0|e.words[i];if(s!==r){s<r?t=-1:s>r&&(t=1);break}}return t},a.prototype.gtn=function(e){return 1===this.cmpn(e)},a.prototype.gt=function(e){return 1===this.cmp(e)},a.prototype.gten=function(e){return this.cmpn(e)>=0},a.prototype.gte=function(e){return this.cmp(e)>=0},a.prototype.ltn=function(e){return-1===this.cmpn(e)},a.prototype.lt=function(e){return-1===this.cmp(e)},a.prototype.lten=function(e){return this.cmpn(e)<=0},a.prototype.lte=function(e){return this.cmp(e)<=0},a.prototype.eqn=function(e){return 0===this.cmpn(e)},a.prototype.eq=function(e){return 0===this.cmp(e)},a.red=function(e){return new _(e)},a.prototype.toRed=function(e){return s(!this.red,"Already a number in reduction context"),s(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},a.prototype.fromRed=function(){return s(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},a.prototype._forceRed=function(e){return this.red=e,this},a.prototype.forceRed=function(e){return s(!this.red,"Already a number in reduction context"),this._forceRed(e)},a.prototype.redAdd=function(e){return s(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},a.prototype.redIAdd=function(e){return s(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},a.prototype.redSub=function(e){return s(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},a.prototype.redISub=function(e){return s(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},a.prototype.redShl=function(e){return s(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},a.prototype.redMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},a.prototype.redIMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},a.prototype.redSqr=function(){return s(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},a.prototype.redISqr=function(){return s(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},a.prototype.redSqrt=function(){return s(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},a.prototype.redInvm=function(){return s(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},a.prototype.redNeg=function(){return s(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},a.prototype.redPow=function(e){return s(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var b={k256:null,p224:null,p192:null,p25519:null};function v(e,t){this.name=e,this.p=new a(t,16),this.n=this.p.bitLength(),this.k=new a(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function w(){v.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function S(){v.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function k(){v.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function T(){v.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function _(e){if("string"==typeof e){var t=a._prime(e);this.m=t.p,this.prime=t}else s(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function O(e){_.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new a(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}v.prototype._tmp=function(){var e=new a(null);return e.words=new Array(Math.ceil(this.n/13)),e},v.prototype.ireduce=function(e){var t,i=e;do{this.split(i,this.tmp),t=(i=(i=this.imulK(i)).iadd(this.tmp)).bitLength()}while(t>this.n);var s=t<this.n?-1:i.ucmp(this.p);return 0===s?(i.words[0]=0,i.length=1):s>0?i.isub(this.p):i._strip(),i},v.prototype.split=function(e,t){e.iushrn(this.n,0,t)},v.prototype.imulK=function(e){return e.imul(this.k)},r(w,v),w.prototype.split=function(e,t){for(var i=4194303,s=Math.min(e.length,9),r=0;r<s;r++)t.words[r]=e.words[r];if(t.length=s,e.length<=9)return e.words[0]=0,void(e.length=1);var a=e.words[9];for(t.words[t.length++]=a&i,r=10;r<e.length;r++){var n=0|e.words[r];e.words[r-10]=(n&i)<<4|a>>>22,a=n}a>>>=22,e.words[r-10]=a,0===a&&e.length>10?e.length-=10:e.length-=9},w.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,i=0;i<e.length;i++){var s=0|e.words[i];t+=977*s,e.words[i]=67108863&t,t=64*s+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},r(S,v),r(k,v),r(T,v),T.prototype.imulK=function(e){for(var t=0,i=0;i<e.length;i++){var s=19*(0|e.words[i])+t,r=67108863&s;s>>>=26,e.words[i]=r,t=s}return 0!==t&&(e.words[e.length++]=t),e},a._prime=function(e){if(b[e])return b[e];var t;if("k256"===e)t=new w;else if("p224"===e)t=new S;else if("p192"===e)t=new k;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new T}return b[e]=t,t},_.prototype._verify1=function(e){s(0===e.negative,"red works only with positives"),s(e.red,"red works only with red numbers")},_.prototype._verify2=function(e,t){s(0==(e.negative|t.negative),"red works only with positives"),s(e.red&&e.red===t.red,"red works only with red numbers")},_.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):(e.umod(this.m)._forceRed(this)._move(e),e)},_.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},_.prototype.add=function(e,t){this._verify2(e,t);var i=e.add(t);return i.cmp(this.m)>=0&&i.isub(this.m),i._forceRed(this)},_.prototype.iadd=function(e,t){this._verify2(e,t);var i=e.iadd(t);return i.cmp(this.m)>=0&&i.isub(this.m),i},_.prototype.sub=function(e,t){this._verify2(e,t);var i=e.sub(t);return i.cmpn(0)<0&&i.iadd(this.m),i._forceRed(this)},_.prototype.isub=function(e,t){this._verify2(e,t);var i=e.isub(t);return i.cmpn(0)<0&&i.iadd(this.m),i},_.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},_.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},_.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},_.prototype.isqr=function(e){return this.imul(e,e.clone())},_.prototype.sqr=function(e){return this.mul(e,e)},_.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(s(t%2==1),3===t){var i=this.m.add(new a(1)).iushrn(2);return this.pow(e,i)}for(var r=this.m.subn(1),n=0;!r.isZero()&&0===r.andln(1);)n++,r.iushrn(1);s(!r.isZero());var o=new a(1).toRed(this),h=o.redNeg(),d=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new a(2*c*c).toRed(this);0!==this.pow(c,d).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,r),u=this.pow(e,r.addn(1).iushrn(1)),f=this.pow(e,r),p=n;0!==f.cmp(o);){for(var m=f,g=0;0!==m.cmp(o);g++)m=m.redSqr();s(g<p);var y=this.pow(l,new a(1).iushln(p-g-1));u=u.redMul(y),l=y.redSqr(),f=f.redMul(l),p=g}return u},_.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},_.prototype.pow=function(e,t){if(t.isZero())return new a(1).toRed(this);if(0===t.cmpn(1))return e.clone();var i=new Array(16);i[0]=new a(1).toRed(this),i[1]=e;for(var s=2;s<i.length;s++)i[s]=this.mul(i[s-1],e);var r=i[0],n=0,o=0,h=t.bitLength()%26;for(0===h&&(h=26),s=t.length-1;s>=0;s--){for(var d=t.words[s],c=h-1;c>=0;c--){var l=d>>c&1;r!==i[0]&&(r=this.sqr(r)),0!==l||0!==n?(n<<=1,n|=l,(4===++o||0===s&&0===c)&&(r=this.mul(r,i[n]),o=0,n=0)):o=0}h=26}return r},_.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},_.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},a.mont=function(e){return new O(e)},r(O,_),O.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},O.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},O.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var i=e.imul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),a=r;return r.cmp(this.m)>=0?a=r.isub(this.m):r.cmpn(0)<0&&(a=r.iadd(this.m)),a._forceRed(this)},O.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new a(0)._forceRed(this);var i=e.mul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),n=r;return r.cmp(this.m)>=0?n=r.isub(this.m):r.cmpn(0)<0&&(n=r.iadd(this.m)),n._forceRed(this)},O.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=i.nmd(e),this)},27295:function(e,t){var i,s,r,a,n,o,h,d,c,l,u;e.exports=(u=u||function(e,t){var i=Object.create||function(){function e(){}return function(t){var i;return e.prototype=t,i=new e,e.prototype=null,i}}(),s={},r=s.lib={},a=r.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},n=r.WordArray=a.extend({init:function(e,i){e=this.words=e||[],this.sigBytes=i!=t?i:4*e.length},toString:function(e){return(e||h).stringify(this)},concat:function(e){var t=this.words,i=e.words,s=this.sigBytes,r=e.sigBytes;if(this.clamp(),s%4)for(var a=0;a<r;a++){var n=i[a>>>2]>>>24-a%4*8&255;t[s+a>>>2]|=n<<24-(s+a)%4*8}else for(a=0;a<r;a+=4)t[s+a>>>2]=i[a>>>2];return this.sigBytes+=r,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var i,s=[],r=function(t){var i=987654321,s=4294967295;return function(){var r=((i=36969*(65535&i)+(i>>16)&s)<<16)+(t=18e3*(65535&t)+(t>>16)&s)&s;return r/=4294967296,(r+=.5)*(e.random()>.5?1:-1)}},a=0;a<t;a+=4){var o=r(4294967296*(i||e.random()));i=987654071*o(),s.push(4294967296*o()|0)}return new n.init(s,t)}}),o=s.enc={},h=o.Hex={stringify:function(e){for(var t=e.words,i=e.sigBytes,s=[],r=0;r<i;r++){var a=t[r>>>2]>>>24-r%4*8&255;s.push((a>>>4).toString(16)),s.push((15&a).toString(16))}return s.join("")},parse:function(e){for(var t=e.length,i=[],s=0;s<t;s+=2)i[s>>>3]|=parseInt(e.substr(s,2),16)<<24-s%8*4;return new n.init(i,t/2)}},d=o.Latin1={stringify:function(e){for(var t=e.words,i=e.sigBytes,s=[],r=0;r<i;r++){var a=t[r>>>2]>>>24-r%4*8&255;s.push(String.fromCharCode(a))}return s.join("")},parse:function(e){for(var t=e.length,i=[],s=0;s<t;s++)i[s>>>2]|=(255&e.charCodeAt(s))<<24-s%4*8;return new n.init(i,t)}},c=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},l=r.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new n.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i=this._data,s=i.words,r=i.sigBytes,a=this.blockSize,o=r/(4*a),h=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*a,d=e.min(4*h,r);if(h){for(var c=0;c<h;c+=a)this._doProcessBlock(s,c);var l=s.splice(0,h);i.sigBytes-=d}return new n.init(l,d)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),u=(r.Hasher=l.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new u.HMAC.init(e,i).finalize(t)}}}),s.algo={});return s}(Math),function(){var e=u,t=e.lib.WordArray;function i(e,i,s){for(var r=[],a=0,n=0;n<i;n++)if(n%4){var o=s[e.charCodeAt(n-1)]<<n%4*2,h=s[e.charCodeAt(n)]>>>6-n%4*2;r[a>>>2]|=(o|h)<<24-a%4*8,a++}return t.create(r,a)}e.enc.Base64={stringify:function(e){var t=e.words,i=e.sigBytes,s=this._map;e.clamp();for(var r=[],a=0;a<i;a+=3)for(var n=(t[a>>>2]>>>24-a%4*8&255)<<16|(t[a+1>>>2]>>>24-(a+1)%4*8&255)<<8|t[a+2>>>2]>>>24-(a+2)%4*8&255,o=0;o<4&&a+.75*o<i;o++)r.push(s.charAt(n>>>6*(3-o)&63));var h=s.charAt(64);if(h)for(;r.length%4;)r.push(h);return r.join("")},parse:function(e){var t=e.length,s=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var a=0;a<s.length;a++)r[s.charCodeAt(a)]=a}var n=s.charAt(64);if(n){var o=e.indexOf(n);-1!==o&&(t=o)}return i(e,t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(e){var t=u,i=t.lib,s=i.WordArray,r=i.Hasher,a=t.algo,n=[];!function(){for(var t=0;t<64;t++)n[t]=4294967296*e.abs(e.sin(t+1))|0}();var o=a.MD5=r.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var i=0;i<16;i++){var s=t+i,r=e[s];e[s]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var a=this._hash.words,o=e[t+0],u=e[t+1],f=e[t+2],p=e[t+3],m=e[t+4],g=e[t+5],y=e[t+6],b=e[t+7],v=e[t+8],w=e[t+9],S=e[t+10],k=e[t+11],T=e[t+12],_=e[t+13],O=e[t+14],M=e[t+15],I=a[0],x=a[1],C=a[2],P=a[3];I=h(I,x,C,P,o,7,n[0]),P=h(P,I,x,C,u,12,n[1]),C=h(C,P,I,x,f,17,n[2]),x=h(x,C,P,I,p,22,n[3]),I=h(I,x,C,P,m,7,n[4]),P=h(P,I,x,C,g,12,n[5]),C=h(C,P,I,x,y,17,n[6]),x=h(x,C,P,I,b,22,n[7]),I=h(I,x,C,P,v,7,n[8]),P=h(P,I,x,C,w,12,n[9]),C=h(C,P,I,x,S,17,n[10]),x=h(x,C,P,I,k,22,n[11]),I=h(I,x,C,P,T,7,n[12]),P=h(P,I,x,C,_,12,n[13]),C=h(C,P,I,x,O,17,n[14]),I=d(I,x=h(x,C,P,I,M,22,n[15]),C,P,u,5,n[16]),P=d(P,I,x,C,y,9,n[17]),C=d(C,P,I,x,k,14,n[18]),x=d(x,C,P,I,o,20,n[19]),I=d(I,x,C,P,g,5,n[20]),P=d(P,I,x,C,S,9,n[21]),C=d(C,P,I,x,M,14,n[22]),x=d(x,C,P,I,m,20,n[23]),I=d(I,x,C,P,w,5,n[24]),P=d(P,I,x,C,O,9,n[25]),C=d(C,P,I,x,p,14,n[26]),x=d(x,C,P,I,v,20,n[27]),I=d(I,x,C,P,_,5,n[28]),P=d(P,I,x,C,f,9,n[29]),C=d(C,P,I,x,b,14,n[30]),I=c(I,x=d(x,C,P,I,T,20,n[31]),C,P,g,4,n[32]),P=c(P,I,x,C,v,11,n[33]),C=c(C,P,I,x,k,16,n[34]),x=c(x,C,P,I,O,23,n[35]),I=c(I,x,C,P,u,4,n[36]),P=c(P,I,x,C,m,11,n[37]),C=c(C,P,I,x,b,16,n[38]),x=c(x,C,P,I,S,23,n[39]),I=c(I,x,C,P,_,4,n[40]),P=c(P,I,x,C,o,11,n[41]),C=c(C,P,I,x,p,16,n[42]),x=c(x,C,P,I,y,23,n[43]),I=c(I,x,C,P,w,4,n[44]),P=c(P,I,x,C,T,11,n[45]),C=c(C,P,I,x,M,16,n[46]),I=l(I,x=c(x,C,P,I,f,23,n[47]),C,P,o,6,n[48]),P=l(P,I,x,C,b,10,n[49]),C=l(C,P,I,x,O,15,n[50]),x=l(x,C,P,I,g,21,n[51]),I=l(I,x,C,P,T,6,n[52]),P=l(P,I,x,C,p,10,n[53]),C=l(C,P,I,x,S,15,n[54]),x=l(x,C,P,I,u,21,n[55]),I=l(I,x,C,P,v,6,n[56]),P=l(P,I,x,C,M,10,n[57]),C=l(C,P,I,x,y,15,n[58]),x=l(x,C,P,I,_,21,n[59]),I=l(I,x,C,P,m,6,n[60]),P=l(P,I,x,C,k,10,n[61]),C=l(C,P,I,x,f,15,n[62]),x=l(x,C,P,I,w,21,n[63]),a[0]=a[0]+I|0,a[1]=a[1]+x|0,a[2]=a[2]+C|0,a[3]=a[3]+P|0},_doFinalize:function(){var t=this._data,i=t.words,s=8*this._nDataBytes,r=8*t.sigBytes;i[r>>>5]|=128<<24-r%32;var a=e.floor(s/4294967296),n=s;i[15+(r+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),i[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),t.sigBytes=4*(i.length+1),this._process();for(var o=this._hash,h=o.words,d=0;d<4;d++){var c=h[d];h[d]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}return o},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function h(e,t,i,s,r,a,n){var o=e+(t&i|~t&s)+r+n;return(o<<a|o>>>32-a)+t}function d(e,t,i,s,r,a,n){var o=e+(t&s|i&~s)+r+n;return(o<<a|o>>>32-a)+t}function c(e,t,i,s,r,a,n){var o=e+(t^i^s)+r+n;return(o<<a|o>>>32-a)+t}function l(e,t,i,s,r,a,n){var o=e+(i^(t|~s))+r+n;return(o<<a|o>>>32-a)+t}t.MD5=r._createHelper(o),t.HmacMD5=r._createHmacHelper(o)}(Math),n=(a=u).lib,o=n.WordArray,h=n.Hasher,d=a.algo,c=[],l=d.SHA1=h.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var i=this._hash.words,s=i[0],r=i[1],a=i[2],n=i[3],o=i[4],h=0;h<80;h++){if(h<16)c[h]=0|e[t+h];else{var d=c[h-3]^c[h-8]^c[h-14]^c[h-16];c[h]=d<<1|d>>>31}var l=(s<<5|s>>>27)+o+c[h];l+=h<20?1518500249+(r&a|~r&n):h<40?1859775393+(r^a^n):h<60?(r&a|r&n|a&n)-1894007588:(r^a^n)-899497514,o=n,n=a,a=r<<30|r>>>2,r=s,s=l}i[0]=i[0]+s|0,i[1]=i[1]+r|0,i[2]=i[2]+a|0,i[3]=i[3]+n|0,i[4]=i[4]+o|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,s=8*e.sigBytes;return t[s>>>5]|=128<<24-s%32,t[14+(s+64>>>9<<4)]=Math.floor(i/4294967296),t[15+(s+64>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=h.clone.call(this);return e._hash=this._hash.clone(),e}}),a.SHA1=h._createHelper(l),a.HmacSHA1=h._createHmacHelper(l),function(e){var t=u,i=t.lib,s=i.WordArray,r=i.Hasher,a=t.algo,n=[],o=[];!function(){function t(t){for(var i=e.sqrt(t),s=2;s<=i;s++)if(!(t%s))return!1;return!0}function i(e){return 4294967296*(e-(0|e))|0}for(var s=2,r=0;r<64;)t(s)&&(r<8&&(n[r]=i(e.pow(s,.5))),o[r]=i(e.pow(s,1/3)),r++),s++}();var h=[],d=a.SHA256=r.extend({_doReset:function(){this._hash=new s.init(n.slice(0))},_doProcessBlock:function(e,t){for(var i=this._hash.words,s=i[0],r=i[1],a=i[2],n=i[3],d=i[4],c=i[5],l=i[6],u=i[7],f=0;f<64;f++){if(f<16)h[f]=0|e[t+f];else{var p=h[f-15],m=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,g=h[f-2],y=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;h[f]=m+h[f-7]+y+h[f-16]}var b=s&r^s&a^r&a,v=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),w=u+((d<<26|d>>>6)^(d<<21|d>>>11)^(d<<7|d>>>25))+(d&c^~d&l)+o[f]+h[f];u=l,l=c,c=d,d=n+w|0,n=a,a=r,r=s,s=w+(v+b)|0}i[0]=i[0]+s|0,i[1]=i[1]+r|0,i[2]=i[2]+a|0,i[3]=i[3]+n|0,i[4]=i[4]+d|0,i[5]=i[5]+c|0,i[6]=i[6]+l|0,i[7]=i[7]+u|0},_doFinalize:function(){var t=this._data,i=t.words,s=8*this._nDataBytes,r=8*t.sigBytes;return i[r>>>5]|=128<<24-r%32,i[14+(r+64>>>9<<4)]=e.floor(s/4294967296),i[15+(r+64>>>9<<4)]=s,t.sigBytes=4*i.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=r._createHelper(d),t.HmacSHA256=r._createHmacHelper(d)}(Math),function(){var e=u,t=e.lib.WordArray,i=e.enc;function s(e){return e<<8&4278255360|e>>>8&16711935}i.Utf16=i.Utf16BE={stringify:function(e){for(var t=e.words,i=e.sigBytes,s=[],r=0;r<i;r+=2){var a=t[r>>>2]>>>16-r%4*8&65535;s.push(String.fromCharCode(a))}return s.join("")},parse:function(e){for(var i=e.length,s=[],r=0;r<i;r++)s[r>>>1]|=e.charCodeAt(r)<<16-r%2*16;return t.create(s,2*i)}},i.Utf16LE={stringify:function(e){for(var t=e.words,i=e.sigBytes,r=[],a=0;a<i;a+=2){var n=s(t[a>>>2]>>>16-a%4*8&65535);r.push(String.fromCharCode(n))}return r.join("")},parse:function(e){for(var i=e.length,r=[],a=0;a<i;a++)r[a>>>1]|=s(e.charCodeAt(a)<<16-a%2*16);return t.create(r,2*i)}}}(),function(){if("function"==typeof ArrayBuffer){var e=u.lib.WordArray,t=e.init,i=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var i=e.byteLength,s=[],r=0;r<i;r++)s[r>>>2]|=e[r]<<24-r%4*8;t.call(this,s,i)}else t.apply(this,arguments)};i.prototype=e}}(),function(e){var t=u,i=t.lib,s=i.WordArray,r=i.Hasher,a=t.algo,n=s.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),o=s.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),h=s.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),d=s.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),c=s.create([0,1518500249,1859775393,2400959708,2840853838]),l=s.create([1352829926,1548603684,1836072691,2053994217,0]),f=a.RIPEMD160=r.extend({_doReset:function(){this._hash=s.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var i=0;i<16;i++){var s=t+i,r=e[s];e[s]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}var a,u,f,w,S,k,T,_,O,M,I,x=this._hash.words,C=c.words,P=l.words,A=n.words,N=o.words,B=h.words,E=d.words;for(k=a=x[0],T=u=x[1],_=f=x[2],O=w=x[3],M=S=x[4],i=0;i<80;i+=1)I=a+e[t+A[i]]|0,I+=i<16?p(u,f,w)+C[0]:i<32?m(u,f,w)+C[1]:i<48?g(u,f,w)+C[2]:i<64?y(u,f,w)+C[3]:b(u,f,w)+C[4],I=(I=v(I|=0,B[i]))+S|0,a=S,S=w,w=v(f,10),f=u,u=I,I=k+e[t+N[i]]|0,I+=i<16?b(T,_,O)+P[0]:i<32?y(T,_,O)+P[1]:i<48?g(T,_,O)+P[2]:i<64?m(T,_,O)+P[3]:p(T,_,O)+P[4],I=(I=v(I|=0,E[i]))+M|0,k=M,M=O,O=v(_,10),_=T,T=I;I=x[1]+f+O|0,x[1]=x[2]+w+M|0,x[2]=x[3]+S+k|0,x[3]=x[4]+a+T|0,x[4]=x[0]+u+_|0,x[0]=I},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,s=8*e.sigBytes;t[s>>>5]|=128<<24-s%32,t[14+(s+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),e.sigBytes=4*(t.length+1),this._process();for(var r=this._hash,a=r.words,n=0;n<5;n++){var o=a[n];a[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8)}return r},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}});function p(e,t,i){return e^t^i}function m(e,t,i){return e&t|~e&i}function g(e,t,i){return(e|~t)^i}function y(e,t,i){return e&i|t&~i}function b(e,t,i){return e^(t|~i)}function v(e,t){return e<<t|e>>>32-t}t.RIPEMD160=r._createHelper(f),t.HmacRIPEMD160=r._createHmacHelper(f)}(Math),function(){var e=u,t=e.lib.Base,i=e.enc.Utf8;e.algo.HMAC=t.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=i.parse(t));var s=e.blockSize,r=4*s;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var a=this._oKey=t.clone(),n=this._iKey=t.clone(),o=a.words,h=n.words,d=0;d<s;d++)o[d]^=1549556828,h[d]^=909522486;a.sigBytes=n.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,i=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(i))}})}(),function(){var e=u,t=e.lib,i=t.Base,s=t.WordArray,r=e.algo,a=r.SHA1,n=r.HMAC,o=r.PBKDF2=i.extend({cfg:i.extend({keySize:4,hasher:a,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var i=this.cfg,r=n.create(i.hasher,e),a=s.create(),o=s.create([1]),h=a.words,d=o.words,c=i.keySize,l=i.iterations;h.length<c;){var u=r.update(t).finalize(o);r.reset();for(var f=u.words,p=f.length,m=u,g=1;g<l;g++){m=r.finalize(m),r.reset();for(var y=m.words,b=0;b<p;b++)f[b]^=y[b]}a.concat(u),d[0]++}return a.sigBytes=4*c,a}});e.PBKDF2=function(e,t,i){return o.create(i).compute(e,t)}}(),function(){var e=u,t=e.lib,i=t.Base,s=t.WordArray,r=e.algo,a=r.MD5,n=r.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:a,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var i=this.cfg,r=i.hasher.create(),a=s.create(),n=a.words,o=i.keySize,h=i.iterations;n.length<o;){d&&r.update(d);var d=r.update(e).finalize(t);r.reset();for(var c=1;c<h;c++)d=r.finalize(d),r.reset();a.concat(d)}return a.sigBytes=4*o,a}});e.EvpKDF=function(e,t,i){return n.create(i).compute(e,t)}}(),function(){var e=u,t=e.lib.WordArray,i=e.algo,s=i.SHA256,r=i.SHA224=s.extend({_doReset:function(){this._hash=new t.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=s._doFinalize.call(this);return e.sigBytes-=4,e}});e.SHA224=s._createHelper(r),e.HmacSHA224=s._createHmacHelper(r)}(),function(e){var t=u,i=t.lib,s=i.Base,r=i.WordArray,a=t.x64={};a.Word=s.extend({init:function(e,t){this.high=e,this.low=t}}),a.WordArray=s.extend({init:function(t,i){t=this.words=t||[],this.sigBytes=i!=e?i:8*t.length},toX32:function(){for(var e=this.words,t=e.length,i=[],s=0;s<t;s++){var a=e[s];i.push(a.high),i.push(a.low)}return r.create(i,this.sigBytes)},clone:function(){for(var e=s.clone.call(this),t=e.words=this.words.slice(0),i=t.length,r=0;r<i;r++)t[r]=t[r].clone();return e}})}(),function(e){var t=u,i=t.lib,s=i.WordArray,r=i.Hasher,a=t.x64.Word,n=t.algo,o=[],h=[],d=[];!function(){for(var e=1,t=0,i=0;i<24;i++){o[e+5*t]=(i+1)*(i+2)/2%64;var s=(2*e+3*t)%5;e=t%5,t=s}for(e=0;e<5;e++)for(t=0;t<5;t++)h[e+5*t]=t+(2*e+3*t)%5*5;for(var r=1,n=0;n<24;n++){for(var c=0,l=0,u=0;u<7;u++){if(1&r){var f=(1<<u)-1;f<32?l^=1<<f:c^=1<<f-32}128&r?r=r<<1^113:r<<=1}d[n]=a.create(c,l)}}();var c=[];!function(){for(var e=0;e<25;e++)c[e]=a.create()}();var l=n.SHA3=r.extend({cfg:r.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var i=this._state,s=this.blockSize/2,r=0;r<s;r++){var a=e[t+2*r],n=e[t+2*r+1];a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),n=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),(x=i[r]).high^=n,x.low^=a}for(var l=0;l<24;l++){for(var u=0;u<5;u++){for(var f=0,p=0,m=0;m<5;m++)f^=(x=i[u+5*m]).high,p^=x.low;var g=c[u];g.high=f,g.low=p}for(u=0;u<5;u++){var y=c[(u+4)%5],b=c[(u+1)%5],v=b.high,w=b.low;for(f=y.high^(v<<1|w>>>31),p=y.low^(w<<1|v>>>31),m=0;m<5;m++)(x=i[u+5*m]).high^=f,x.low^=p}for(var S=1;S<25;S++){var k=(x=i[S]).high,T=x.low,_=o[S];_<32?(f=k<<_|T>>>32-_,p=T<<_|k>>>32-_):(f=T<<_-32|k>>>64-_,p=k<<_-32|T>>>64-_);var O=c[h[S]];O.high=f,O.low=p}var M=c[0],I=i[0];for(M.high=I.high,M.low=I.low,u=0;u<5;u++)for(m=0;m<5;m++){var x=i[S=u+5*m],C=c[S],P=c[(u+1)%5+5*m],A=c[(u+2)%5+5*m];x.high=C.high^~P.high&A.high,x.low=C.low^~P.low&A.low}x=i[0];var N=d[l];x.high^=N.high,x.low^=N.low}},_doFinalize:function(){var t=this._data,i=t.words,r=(this._nDataBytes,8*t.sigBytes),a=32*this.blockSize;i[r>>>5]|=1<<24-r%32,i[(e.ceil((r+1)/a)*a>>>5)-1]|=128,t.sigBytes=4*i.length,this._process();for(var n=this._state,o=this.cfg.outputLength/8,h=o/8,d=[],c=0;c<h;c++){var l=n[c],u=l.high,f=l.low;u=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8),f=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),d.push(f),d.push(u)}return new s.init(d,o)},clone:function(){for(var e=r.clone.call(this),t=e._state=this._state.slice(0),i=0;i<25;i++)t[i]=t[i].clone();return e}});t.SHA3=r._createHelper(l),t.HmacSHA3=r._createHmacHelper(l)}(Math),function(){var e=u,t=e.lib.Hasher,i=e.x64,s=i.Word,r=i.WordArray,a=e.algo;function n(){return s.create.apply(s,arguments)}var o=[n(1116352408,3609767458),n(1899447441,602891725),n(3049323471,3964484399),n(3921009573,2173295548),n(961987163,4081628472),n(1508970993,3053834265),n(2453635748,2937671579),n(2870763221,3664609560),n(3624381080,2734883394),n(310598401,1164996542),n(607225278,1323610764),n(1426881987,3590304994),n(1925078388,4068182383),n(2162078206,991336113),n(2614888103,633803317),n(3248222580,3479774868),n(3835390401,2666613458),n(4022224774,944711139),n(264347078,2341262773),n(604807628,2007800933),n(770255983,1495990901),n(1249150122,1856431235),n(1555081692,3175218132),n(1996064986,2198950837),n(2554220882,3999719339),n(2821834349,766784016),n(2952996808,2566594879),n(3210313671,3203337956),n(3336571891,1034457026),n(3584528711,2466948901),n(113926993,3758326383),n(338241895,168717936),n(666307205,1188179964),n(773529912,1546045734),n(1294757372,1522805485),n(1396182291,2643833823),n(1695183700,2343527390),n(1986661051,1014477480),n(2177026350,1206759142),n(2456956037,344077627),n(2730485921,1290863460),n(2820302411,3158454273),n(3259730800,3505952657),n(3345764771,106217008),n(3516065817,3606008344),n(3600352804,1432725776),n(4094571909,1467031594),n(275423344,851169720),n(430227734,3100823752),n(506948616,1363258195),n(659060556,3750685593),n(883997877,3785050280),n(958139571,3318307427),n(1322822218,3812723403),n(1537002063,2003034995),n(1747873779,3602036899),n(1955562222,1575990012),n(2024104815,1125592928),n(2227730452,2716904306),n(2361852424,442776044),n(2428436474,593698344),n(2756734187,3733110249),n(3204031479,2999351573),n(3329325298,3815920427),n(3391569614,3928383900),n(3515267271,566280711),n(3940187606,3454069534),n(4118630271,4000239992),n(116418474,1914138554),n(174292421,2731055270),n(289380356,3203993006),n(460393269,320620315),n(685471733,587496836),n(852142971,1086792851),n(1017036298,365543100),n(1126000580,2618297676),n(1288033470,3409855158),n(1501505948,4234509866),n(1607167915,987167468),n(1816402316,1246189591)],h=[];!function(){for(var e=0;e<80;e++)h[e]=n()}();var d=a.SHA512=t.extend({_doReset:function(){this._hash=new r.init([new s.init(1779033703,4089235720),new s.init(3144134277,2227873595),new s.init(1013904242,4271175723),new s.init(2773480762,1595750129),new s.init(1359893119,2917565137),new s.init(2600822924,725511199),new s.init(528734635,4215389547),new s.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var i=this._hash.words,s=i[0],r=i[1],a=i[2],n=i[3],d=i[4],c=i[5],l=i[6],u=i[7],f=s.high,p=s.low,m=r.high,g=r.low,y=a.high,b=a.low,v=n.high,w=n.low,S=d.high,k=d.low,T=c.high,_=c.low,O=l.high,M=l.low,I=u.high,x=u.low,C=f,P=p,A=m,N=g,B=y,E=b,V=v,L=w,R=S,D=k,F=T,q=_,G=O,H=M,U=I,j=x,W=0;W<80;W++){var z=h[W];if(W<16)var K=z.high=0|e[t+2*W],X=z.low=0|e[t+2*W+1];else{var Z=h[W-15],Y=Z.high,Q=Z.low,J=(Y>>>1|Q<<31)^(Y>>>8|Q<<24)^Y>>>7,$=(Q>>>1|Y<<31)^(Q>>>8|Y<<24)^(Q>>>7|Y<<25),ee=h[W-2],te=ee.high,ie=ee.low,se=(te>>>19|ie<<13)^(te<<3|ie>>>29)^te>>>6,re=(ie>>>19|te<<13)^(ie<<3|te>>>29)^(ie>>>6|te<<26),ae=h[W-7],ne=ae.high,oe=ae.low,he=h[W-16],de=he.high,ce=he.low;K=(K=(K=J+ne+((X=$+oe)>>>0<$>>>0?1:0))+se+((X+=re)>>>0<re>>>0?1:0))+de+((X+=ce)>>>0<ce>>>0?1:0),z.high=K,z.low=X}var le,ue=R&F^~R&G,fe=D&q^~D&H,pe=C&A^C&B^A&B,me=P&N^P&E^N&E,ge=(C>>>28|P<<4)^(C<<30|P>>>2)^(C<<25|P>>>7),ye=(P>>>28|C<<4)^(P<<30|C>>>2)^(P<<25|C>>>7),be=(R>>>14|D<<18)^(R>>>18|D<<14)^(R<<23|D>>>9),ve=(D>>>14|R<<18)^(D>>>18|R<<14)^(D<<23|R>>>9),we=o[W],Se=we.high,ke=we.low,Te=U+be+((le=j+ve)>>>0<j>>>0?1:0),_e=ye+me;U=G,j=H,G=F,H=q,F=R,q=D,R=V+(Te=(Te=(Te=Te+ue+((le+=fe)>>>0<fe>>>0?1:0))+Se+((le+=ke)>>>0<ke>>>0?1:0))+K+((le+=X)>>>0<X>>>0?1:0))+((D=L+le|0)>>>0<L>>>0?1:0)|0,V=B,L=E,B=A,E=N,A=C,N=P,C=Te+(ge+pe+(_e>>>0<ye>>>0?1:0))+((P=le+_e|0)>>>0<le>>>0?1:0)|0}p=s.low=p+P,s.high=f+C+(p>>>0<P>>>0?1:0),g=r.low=g+N,r.high=m+A+(g>>>0<N>>>0?1:0),b=a.low=b+E,a.high=y+B+(b>>>0<E>>>0?1:0),w=n.low=w+L,n.high=v+V+(w>>>0<L>>>0?1:0),k=d.low=k+D,d.high=S+R+(k>>>0<D>>>0?1:0),_=c.low=_+q,c.high=T+F+(_>>>0<q>>>0?1:0),M=l.low=M+H,l.high=O+G+(M>>>0<H>>>0?1:0),x=u.low=x+j,u.high=I+U+(x>>>0<j>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,s=8*e.sigBytes;return t[s>>>5]|=128<<24-s%32,t[30+(s+128>>>10<<5)]=Math.floor(i/4294967296),t[31+(s+128>>>10<<5)]=i,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(d),e.HmacSHA512=t._createHmacHelper(d)}(),function(){var e=u,t=e.x64,i=t.Word,s=t.WordArray,r=e.algo,a=r.SHA512,n=r.SHA384=a.extend({_doReset:function(){this._hash=new s.init([new i.init(3418070365,3238371032),new i.init(1654270250,914150663),new i.init(2438529370,812702999),new i.init(355462360,4144912697),new i.init(1731405415,4290775857),new i.init(2394180231,1750603025),new i.init(3675008525,1694076839),new i.init(1203062813,3204075428)])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=16,e}});e.SHA384=a._createHelper(n),e.HmacSHA384=a._createHmacHelper(n)}(),u.lib.Cipher||function(e){var t=u,i=t.lib,s=i.Base,r=i.WordArray,a=i.BufferedBlockAlgorithm,n=t.enc,o=(n.Utf8,n.Base64),h=t.algo.EvpKDF,d=i.Cipher=a.extend({cfg:s.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,i){this.cfg=this.cfg.extend(i),this._xformMode=e,this._key=t,this.reset()},reset:function(){a.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?v:y}return function(t){return{encrypt:function(i,s,r){return e(s).encrypt(t,i,s,r)},decrypt:function(i,s,r){return e(s).decrypt(t,i,s,r)}}}}()}),c=(i.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),t.mode={}),l=i.BlockCipherMode=s.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),f=c.CBC=function(){var t=l.extend();function i(t,i,s){var r=this._iv;if(r){var a=r;this._iv=e}else a=this._prevBlock;for(var n=0;n<s;n++)t[i+n]^=a[n]}return t.Encryptor=t.extend({processBlock:function(e,t){var s=this._cipher,r=s.blockSize;i.call(this,e,t,r),s.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),t.Decryptor=t.extend({processBlock:function(e,t){var s=this._cipher,r=s.blockSize,a=e.slice(t,t+r);s.decryptBlock(e,t),i.call(this,e,t,r),this._prevBlock=a}}),t}(),p=(t.pad={}).Pkcs7={pad:function(e,t){for(var i=4*t,s=i-e.sigBytes%i,a=s<<24|s<<16|s<<8|s,n=[],o=0;o<s;o+=4)n.push(a);var h=r.create(n,s);e.concat(h)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},m=(i.BlockCipher=d.extend({cfg:d.cfg.extend({mode:f,padding:p}),reset:function(){d.reset.call(this);var e=this.cfg,t=e.iv,i=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var s=i.createEncryptor;else s=i.createDecryptor,this._minBufferSize=1;this._mode&&this._mode.__creator==s?this._mode.init(this,t&&t.words):(this._mode=s.call(i,this,t&&t.words),this._mode.__creator=s)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4}),i.CipherParams=s.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),g=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,i=e.salt;if(i)var s=r.create([1398893684,1701076831]).concat(i).concat(t);else s=t;return s.toString(o)},parse:function(e){var t=o.parse(e),i=t.words;if(1398893684==i[0]&&1701076831==i[1]){var s=r.create(i.slice(2,4));i.splice(0,4),t.sigBytes-=16}return m.create({ciphertext:t,salt:s})}},y=i.SerializableCipher=s.extend({cfg:s.extend({format:g}),encrypt:function(e,t,i,s){s=this.cfg.extend(s);var r=e.createEncryptor(i,s),a=r.finalize(t),n=r.cfg;return m.create({ciphertext:a,key:i,iv:n.iv,algorithm:e,mode:n.mode,padding:n.padding,blockSize:e.blockSize,formatter:s.format})},decrypt:function(e,t,i,s){return s=this.cfg.extend(s),t=this._parse(t,s.format),e.createDecryptor(i,s).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),b=(t.kdf={}).OpenSSL={execute:function(e,t,i,s){s||(s=r.random(8));var a=h.create({keySize:t+i}).compute(e,s),n=r.create(a.words.slice(t),4*i);return a.sigBytes=4*t,m.create({key:a,iv:n,salt:s})}},v=i.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:b}),encrypt:function(e,t,i,s){var r=(s=this.cfg.extend(s)).kdf.execute(i,e.keySize,e.ivSize);s.iv=r.iv;var a=y.encrypt.call(this,e,t,r.key,s);return a.mixIn(r),a},decrypt:function(e,t,i,s){s=this.cfg.extend(s),t=this._parse(t,s.format);var r=s.kdf.execute(i,e.keySize,e.ivSize,t.salt);return s.iv=r.iv,y.decrypt.call(this,e,t,r.key,s)}})}(),u.mode.CFB=function(){var e=u.lib.BlockCipherMode.extend();function t(e,t,i,s){var r=this._iv;if(r){var a=r.slice(0);this._iv=void 0}else a=this._prevBlock;s.encryptBlock(a,0);for(var n=0;n<i;n++)e[t+n]^=a[n]}return e.Encryptor=e.extend({processBlock:function(e,i){var s=this._cipher,r=s.blockSize;t.call(this,e,i,r,s),this._prevBlock=e.slice(i,i+r)}}),e.Decryptor=e.extend({processBlock:function(e,i){var s=this._cipher,r=s.blockSize,a=e.slice(i,i+r);t.call(this,e,i,r,s),this._prevBlock=a}}),e}(),u.mode.ECB=((r=u.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),r.Decryptor=r.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),r),u.pad.AnsiX923={pad:function(e,t){var i=e.sigBytes,s=4*t,r=s-i%s,a=i+r-1;e.clamp(),e.words[a>>>2]|=r<<24-a%4*8,e.sigBytes+=r},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},u.pad.Iso10126={pad:function(e,t){var i=4*t,s=i-e.sigBytes%i;e.concat(u.lib.WordArray.random(s-1)).concat(u.lib.WordArray.create([s<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},u.pad.Iso97971={pad:function(e,t){e.concat(u.lib.WordArray.create([2147483648],1)),u.pad.ZeroPadding.pad(e,t)},unpad:function(e){u.pad.ZeroPadding.unpad(e),e.sigBytes--}},u.mode.OFB=(i=u.lib.BlockCipherMode.extend(),s=i.Encryptor=i.extend({processBlock:function(e,t){var i=this._cipher,s=i.blockSize,r=this._iv,a=this._keystream;r&&(a=this._keystream=r.slice(0),this._iv=void 0),i.encryptBlock(a,0);for(var n=0;n<s;n++)e[t+n]^=a[n]}}),i.Decryptor=s,i),u.pad.NoPadding={pad:function(){},unpad:function(){}},function(e){var t=u,i=t.lib.CipherParams,s=t.enc.Hex;t.format.Hex={stringify:function(e){return e.ciphertext.toString(s)},parse:function(e){var t=s.parse(e);return i.create({ciphertext:t})}}}(),function(){var e=u,t=e.lib.BlockCipher,i=e.algo,s=[],r=[],a=[],n=[],o=[],h=[],d=[],c=[],l=[],f=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var i=0,u=0;for(t=0;t<256;t++){var p=u^u<<1^u<<2^u<<3^u<<4;p=p>>>8^255&p^99,s[i]=p,r[p]=i;var m=e[i],g=e[m],y=e[g],b=257*e[p]^16843008*p;a[i]=b<<24|b>>>8,n[i]=b<<16|b>>>16,o[i]=b<<8|b>>>24,h[i]=b,b=16843009*y^65537*g^257*m^16843008*i,d[p]=b<<24|b>>>8,c[p]=b<<16|b>>>16,l[p]=b<<8|b>>>24,f[p]=b,i?(i=m^e[e[e[y^m]]],u^=e[e[u]]):i=u=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],m=i.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,i=e.sigBytes/4,r=4*((this._nRounds=i+6)+1),a=this._keySchedule=[],n=0;n<r;n++)if(n<i)a[n]=t[n];else{var o=a[n-1];n%i?i>6&&n%i==4&&(o=s[o>>>24]<<24|s[o>>>16&255]<<16|s[o>>>8&255]<<8|s[255&o]):(o=s[(o=o<<8|o>>>24)>>>24]<<24|s[o>>>16&255]<<16|s[o>>>8&255]<<8|s[255&o],o^=p[n/i|0]<<24),a[n]=a[n-i]^o}for(var h=this._invKeySchedule=[],u=0;u<r;u++)n=r-u,o=u%4?a[n]:a[n-4],h[u]=u<4||n<=4?o:d[s[o>>>24]]^c[s[o>>>16&255]]^l[s[o>>>8&255]]^f[s[255&o]]}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,n,o,h,s)},decryptBlock:function(e,t){var i=e[t+1];e[t+1]=e[t+3],e[t+3]=i,this._doCryptBlock(e,t,this._invKeySchedule,d,c,l,f,r),i=e[t+1],e[t+1]=e[t+3],e[t+3]=i},_doCryptBlock:function(e,t,i,s,r,a,n,o){for(var h=this._nRounds,d=e[t]^i[0],c=e[t+1]^i[1],l=e[t+2]^i[2],u=e[t+3]^i[3],f=4,p=1;p<h;p++){var m=s[d>>>24]^r[c>>>16&255]^a[l>>>8&255]^n[255&u]^i[f++],g=s[c>>>24]^r[l>>>16&255]^a[u>>>8&255]^n[255&d]^i[f++],y=s[l>>>24]^r[u>>>16&255]^a[d>>>8&255]^n[255&c]^i[f++],b=s[u>>>24]^r[d>>>16&255]^a[c>>>8&255]^n[255&l]^i[f++];d=m,c=g,l=y,u=b}m=(o[d>>>24]<<24|o[c>>>16&255]<<16|o[l>>>8&255]<<8|o[255&u])^i[f++],g=(o[c>>>24]<<24|o[l>>>16&255]<<16|o[u>>>8&255]<<8|o[255&d])^i[f++],y=(o[l>>>24]<<24|o[u>>>16&255]<<16|o[d>>>8&255]<<8|o[255&c])^i[f++],b=(o[u>>>24]<<24|o[d>>>16&255]<<16|o[c>>>8&255]<<8|o[255&l])^i[f++],e[t]=m,e[t+1]=g,e[t+2]=y,e[t+3]=b},keySize:8});e.AES=t._createHelper(m)}(),function(){var e=u,t=e.lib,i=t.WordArray,s=t.BlockCipher,r=e.algo,a=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],n=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],o=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],h=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],d=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],c=r.DES=s.extend({_doReset:function(){for(var e=this._key.words,t=[],i=0;i<56;i++){var s=a[i]-1;t[i]=e[s>>>5]>>>31-s%32&1}for(var r=this._subKeys=[],h=0;h<16;h++){var d=r[h]=[],c=o[h];for(i=0;i<24;i++)d[i/6|0]|=t[(n[i]-1+c)%28]<<31-i%6,d[4+(i/6|0)]|=t[28+(n[i+24]-1+c)%28]<<31-i%6;for(d[0]=d[0]<<1|d[0]>>>31,i=1;i<7;i++)d[i]=d[i]>>>4*(i-1)+3;d[7]=d[7]<<5|d[7]>>>27}var l=this._invSubKeys=[];for(i=0;i<16;i++)l[i]=r[15-i]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,i){this._lBlock=e[t],this._rBlock=e[t+1],l.call(this,4,252645135),l.call(this,16,65535),f.call(this,2,858993459),f.call(this,8,16711935),l.call(this,1,1431655765);for(var s=0;s<16;s++){for(var r=i[s],a=this._lBlock,n=this._rBlock,o=0,c=0;c<8;c++)o|=h[c][((n^r[c])&d[c])>>>0];this._lBlock=n,this._rBlock=a^o}var u=this._lBlock;this._lBlock=this._rBlock,this._rBlock=u,l.call(this,1,1431655765),f.call(this,8,16711935),f.call(this,2,858993459),l.call(this,16,65535),l.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function l(e,t){var i=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=i,this._lBlock^=i<<e}function f(e,t){var i=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=i,this._rBlock^=i<<e}e.DES=s._createHelper(c);var p=r.TripleDES=s.extend({_doReset:function(){var e=this._key.words;this._des1=c.createEncryptor(i.create(e.slice(0,2))),this._des2=c.createEncryptor(i.create(e.slice(2,4))),this._des3=c.createEncryptor(i.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=s._createHelper(p)}(),function(){var e=u,t=e.lib.StreamCipher,i=e.algo,s=i.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,i=e.sigBytes,s=this._S=[],r=0;r<256;r++)s[r]=r;r=0;for(var a=0;r<256;r++){var n=r%i,o=t[n>>>2]>>>24-n%4*8&255;a=(a+s[r]+o)%256;var h=s[r];s[r]=s[a],s[a]=h}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=r.call(this)},keySize:8,ivSize:0});function r(){for(var e=this._S,t=this._i,i=this._j,s=0,r=0;r<4;r++){i=(i+e[t=(t+1)%256])%256;var a=e[t];e[t]=e[i],e[i]=a,s|=e[(e[t]+e[i])%256]<<24-8*r}return this._i=t,this._j=i,s}e.RC4=t._createHelper(s);var a=i.RC4Drop=s.extend({cfg:s.cfg.extend({drop:192}),_doReset:function(){s._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)r.call(this)}});e.RC4Drop=t._createHelper(a)}(),u.mode.CTRGladman=function(){var e=u.lib.BlockCipherMode.extend();function t(e){if(255==(e>>24&255)){var t=e>>16&255,i=e>>8&255,s=255&e;255===t?(t=0,255===i?(i=0,255===s?s=0:++s):++i):++t,e=0,e+=t<<16,e+=i<<8,e+=s}else e+=1<<24;return e}function i(e){return 0===(e[0]=t(e[0]))&&(e[1]=t(e[1])),e}var s=e.Encryptor=e.extend({processBlock:function(e,t){var s=this._cipher,r=s.blockSize,a=this._iv,n=this._counter;a&&(n=this._counter=a.slice(0),this._iv=void 0),i(n);var o=n.slice(0);s.encryptBlock(o,0);for(var h=0;h<r;h++)e[t+h]^=o[h]}});return e.Decryptor=s,e}(),function(){var e=u,t=e.lib.StreamCipher,i=e.algo,s=[],r=[],a=[],n=i.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,i=0;i<4;i++)e[i]=16711935&(e[i]<<8|e[i]>>>24)|4278255360&(e[i]<<24|e[i]>>>8);var s=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],r=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,i=0;i<4;i++)o.call(this);for(i=0;i<8;i++)r[i]^=s[i+4&7];if(t){var a=t.words,n=a[0],h=a[1],d=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),c=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),l=d>>>16|4294901760&c,u=c<<16|65535&d;for(r[0]^=d,r[1]^=l,r[2]^=c,r[3]^=u,r[4]^=d,r[5]^=l,r[6]^=c,r[7]^=u,i=0;i<4;i++)o.call(this)}},_doProcessBlock:function(e,t){var i=this._X;o.call(this),s[0]=i[0]^i[5]>>>16^i[3]<<16,s[1]=i[2]^i[7]>>>16^i[5]<<16,s[2]=i[4]^i[1]>>>16^i[7]<<16,s[3]=i[6]^i[3]>>>16^i[1]<<16;for(var r=0;r<4;r++)s[r]=16711935&(s[r]<<8|s[r]>>>24)|4278255360&(s[r]<<24|s[r]>>>8),e[t+r]^=s[r]},blockSize:4,ivSize:2});function o(){for(var e=this._X,t=this._C,i=0;i<8;i++)r[i]=t[i];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<r[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<r[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<r[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<r[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<r[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<r[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<r[6]>>>0?1:0)|0,this._b=t[7]>>>0<r[7]>>>0?1:0,i=0;i<8;i++){var s=e[i]+t[i],n=65535&s,o=s>>>16,h=((n*n>>>17)+n*o>>>15)+o*o,d=((4294901760&s)*s|0)+((65535&s)*s|0);a[i]=h^d}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.Rabbit=t._createHelper(n)}(),u.mode.CTR=function(){var e=u.lib.BlockCipherMode.extend(),t=e.Encryptor=e.extend({processBlock:function(e,t){var i=this._cipher,s=i.blockSize,r=this._iv,a=this._counter;r&&(a=this._counter=r.slice(0),this._iv=void 0);var n=a.slice(0);i.encryptBlock(n,0),a[s-1]=a[s-1]+1|0;for(var o=0;o<s;o++)e[t+o]^=n[o]}});return e.Decryptor=t,e}(),function(){var e=u,t=e.lib.StreamCipher,i=e.algo,s=[],r=[],a=[],n=i.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,i=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],s=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var r=0;r<4;r++)o.call(this);for(r=0;r<8;r++)s[r]^=i[r+4&7];if(t){var a=t.words,n=a[0],h=a[1],d=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),c=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),l=d>>>16|4294901760&c,u=c<<16|65535&d;for(s[0]^=d,s[1]^=l,s[2]^=c,s[3]^=u,s[4]^=d,s[5]^=l,s[6]^=c,s[7]^=u,r=0;r<4;r++)o.call(this)}},_doProcessBlock:function(e,t){var i=this._X;o.call(this),s[0]=i[0]^i[5]>>>16^i[3]<<16,s[1]=i[2]^i[7]>>>16^i[5]<<16,s[2]=i[4]^i[1]>>>16^i[7]<<16,s[3]=i[6]^i[3]>>>16^i[1]<<16;for(var r=0;r<4;r++)s[r]=16711935&(s[r]<<8|s[r]>>>24)|4278255360&(s[r]<<24|s[r]>>>8),e[t+r]^=s[r]},blockSize:4,ivSize:2});function o(){for(var e=this._X,t=this._C,i=0;i<8;i++)r[i]=t[i];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<r[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<r[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<r[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<r[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<r[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<r[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<r[6]>>>0?1:0)|0,this._b=t[7]>>>0<r[7]>>>0?1:0,i=0;i<8;i++){var s=e[i]+t[i],n=65535&s,o=s>>>16,h=((n*n>>>17)+n*o>>>15)+o*o,d=((4294901760&s)*s|0)+((65535&s)*s|0);a[i]=h^d}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.RabbitLegacy=t._createHelper(n)}(),u.pad.ZeroPadding={pad:function(e,t){var i=4*t;e.clamp(),e.sigBytes+=i-(e.sigBytes%i||i)},unpad:function(e){for(var t=e.words,i=e.sigBytes-1;!(t[i>>>2]>>>24-i%4*8&255);)i--;e.sigBytes=i+1}},u)},73150:function(e,t,i){"use strict";var s=t;s.inherits=function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e},s.version="6.5.0",s.utils=i(27882),s.curve=i(15261),s.curves=i(61198),s.ec=i(61643),s.eddsa=i(89214)},63235:function(e,t,i){"use strict";var s=i(35060),r=i(73150).utils,a=r.getNAF,n=r.getJSF,o=r.assert;function h(e,t){this.type=e,this.p=new s(t.p,16),this.red=t.prime?s.red(t.prime):s.mont(this.p),this.zero=new s(0).toRed(this.red),this.one=new s(1).toRed(this.red),this.two=new s(2).toRed(this.red),this.n=t.n&&new s(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4);var i=this.n&&this.p.div(this.n);!i||i.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function d(e,t){this.curve=e,this.type=t,this.precomputed=null}e.exports=h,h.prototype.point=function(){throw new Error("Not implemented")},h.prototype.validate=function(){throw new Error("Not implemented")},h.prototype._fixedNafMul=function(e,t){o(e.precomputed);var i=e._getDoubles(),s=a(t,1),r=(1<<i.step+1)-(i.step%2==0?2:1);r/=3;for(var n=[],h=0;h<s.length;h+=i.step){var d=0;for(t=h+i.step-1;t>=h;t--)d=(d<<1)+s[t];n.push(d)}for(var c=this.jpoint(null,null,null),l=this.jpoint(null,null,null),u=r;u>0;u--){for(h=0;h<n.length;h++){(d=n[h])===u?l=l.mixedAdd(i.points[h]):d===-u&&(l=l.mixedAdd(i.points[h].neg()))}c=c.add(l)}return c.toP()},h.prototype._wnafMul=function(e,t){var i=4,s=e._getNAFPoints(i);i=s.wnd;for(var r=s.points,n=a(t,i),h=this.jpoint(null,null,null),d=n.length-1;d>=0;d--){for(t=0;d>=0&&0===n[d];d--)t++;if(d>=0&&t++,h=h.dblp(t),d<0)break;var c=n[d];o(0!==c),h="affine"===e.type?c>0?h.mixedAdd(r[c-1>>1]):h.mixedAdd(r[-c-1>>1].neg()):c>0?h.add(r[c-1>>1]):h.add(r[-c-1>>1].neg())}return"affine"===e.type?h.toP():h},h.prototype._wnafMulAdd=function(e,t,i,s,r){for(var o=this._wnafT1,h=this._wnafT2,d=this._wnafT3,c=0,l=0;l<s;l++){var u=(O=t[l])._getNAFPoints(e);o[l]=u.wnd,h[l]=u.points}for(l=s-1;l>=1;l-=2){var f=l-1,p=l;if(1===o[f]&&1===o[p]){var m=[t[f],null,null,t[p]];0===t[f].y.cmp(t[p].y)?(m[1]=t[f].add(t[p]),m[2]=t[f].toJ().mixedAdd(t[p].neg())):0===t[f].y.cmp(t[p].y.redNeg())?(m[1]=t[f].toJ().mixedAdd(t[p]),m[2]=t[f].add(t[p].neg())):(m[1]=t[f].toJ().mixedAdd(t[p]),m[2]=t[f].toJ().mixedAdd(t[p].neg()));var g=[-3,-1,-5,-7,0,7,5,1,3],y=n(i[f],i[p]);c=Math.max(y[0].length,c),d[f]=new Array(c),d[p]=new Array(c);for(var b=0;b<c;b++){var v=0|y[0][b],w=0|y[1][b];d[f][b]=g[3*(v+1)+(w+1)],d[p][b]=0,h[f]=m}}else d[f]=a(i[f],o[f]),d[p]=a(i[p],o[p]),c=Math.max(d[f].length,c),c=Math.max(d[p].length,c)}var S=this.jpoint(null,null,null),k=this._wnafT4;for(l=c;l>=0;l--){for(var T=0;l>=0;){var _=!0;for(b=0;b<s;b++)k[b]=0|d[b][l],0!==k[b]&&(_=!1);if(!_)break;T++,l--}if(l>=0&&T++,S=S.dblp(T),l<0)break;for(b=0;b<s;b++){var O,M=k[b];0!==M&&(M>0?O=h[b][M-1>>1]:M<0&&(O=h[b][-M-1>>1].neg()),S="affine"===O.type?S.mixedAdd(O):S.add(O))}}for(l=0;l<s;l++)h[l]=null;return r?S:S.toP()},h.BasePoint=d,d.prototype.eq=function(){throw new Error("Not implemented")},d.prototype.validate=function(){return this.curve.validate(this)},h.prototype.decodePoint=function(e,t){e=r.toArray(e,t);var i=this.p.byteLength();if((4===e[0]||6===e[0]||7===e[0])&&e.length-1==2*i)return 6===e[0]?o(e[e.length-1]%2==0):7===e[0]&&o(e[e.length-1]%2==1),this.point(e.slice(1,1+i),e.slice(1+i,1+2*i));if((2===e[0]||3===e[0])&&e.length-1===i)return this.pointFromX(e.slice(1,1+i),3===e[0]);throw new Error("Unknown point format")},d.prototype.encodeCompressed=function(e){return this.encode(e,!0)},d.prototype._encode=function(e){var t=this.curve.p.byteLength(),i=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(i):[4].concat(i,this.getY().toArray("be",t))},d.prototype.encode=function(e,t){return r.encode(this._encode(t),e)},d.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},d.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return!!t&&t.points.length>=Math.ceil((e.bitLength()+1)/t.step)},d.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var i=[this],s=this,r=0;r<t;r+=e){for(var a=0;a<e;a++)s=s.dbl();i.push(s)}return{step:e,points:i}},d.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],i=(1<<e)-1,s=1===i?null:this.dbl(),r=1;r<i;r++)t[r]=t[r-1].add(s);return{wnd:e,points:t}},d.prototype._getBeta=function(){return null},d.prototype.dblp=function(e){for(var t=this,i=0;i<e;i++)t=t.dbl();return t}},95595:function(e,t,i){"use strict";var s=i(15261),r=i(73150),a=i(35060),n=r.inherits,o=s.base,h=r.utils.assert;function d(e){this.twisted=1!=(0|e.a),this.mOneA=this.twisted&&-1==(0|e.a),this.extended=this.mOneA,o.call(this,"edwards",e),this.a=new a(e.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new a(e.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new a(e.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),h(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|e.c)}function c(e,t,i,s,r){o.BasePoint.call(this,e,"projective"),null===t&&null===i&&null===s?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new a(t,16),this.y=new a(i,16),this.z=s?new a(s,16):this.curve.one,this.t=r&&new a(r,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}n(d,o),e.exports=d,d.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)},d.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)},d.prototype.jpoint=function(e,t,i,s){return this.point(e,t,i,s)},d.prototype.pointFromX=function(e,t){(e=new a(e,16)).red||(e=e.toRed(this.red));var i=e.redSqr(),s=this.c2.redSub(this.a.redMul(i)),r=this.one.redSub(this.c2.redMul(this.d).redMul(i)),n=s.redMul(r.redInvm()),o=n.redSqrt();if(0!==o.redSqr().redSub(n).cmp(this.zero))throw new Error("invalid point");var h=o.fromRed().isOdd();return(t&&!h||!t&&h)&&(o=o.redNeg()),this.point(e,o)},d.prototype.pointFromY=function(e,t){(e=new a(e,16)).red||(e=e.toRed(this.red));var i=e.redSqr(),s=i.redSub(this.one),r=i.redMul(this.d).redAdd(this.one),n=s.redMul(r.redInvm());if(0===n.cmp(this.zero)){if(t)throw new Error("invalid point");return this.point(this.zero,e)}var o=n.redSqrt();if(0!==o.redSqr().redSub(n).cmp(this.zero))throw new Error("invalid point");return o.isOdd()!==t&&(o=o.redNeg()),this.point(o,e)},d.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var t=e.x.redSqr(),i=e.y.redSqr(),s=t.redMul(this.a).redAdd(i),r=this.c2.redMul(this.one.redAdd(this.d.redMul(t).redMul(i)));return 0===s.cmp(r)},n(c,o.BasePoint),d.prototype.pointFromJSON=function(e){return c.fromJSON(this,e)},d.prototype.point=function(e,t,i,s){return new c(this,e,t,i,s)},c.fromJSON=function(e,t){return new c(e,t[0],t[1],t[2])},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&0===this.y.cmp(this.z)},c.prototype._extDbl=function(){var e=this.x.redSqr(),t=this.y.redSqr(),i=this.z.redSqr();i=i.redIAdd(i);var s=this.curve._mulA(e),r=this.x.redAdd(this.y).redSqr().redISub(e).redISub(t),a=s.redAdd(t),n=a.redSub(i),o=s.redSub(t),h=r.redMul(n),d=a.redMul(o),c=r.redMul(o),l=n.redMul(a);return this.curve.point(h,d,l,c)},c.prototype._projDbl=function(){var e,t,i,s=this.x.redAdd(this.y).redSqr(),r=this.x.redSqr(),a=this.y.redSqr();if(this.curve.twisted){var n=(d=this.curve._mulA(r)).redAdd(a);if(this.zOne)e=s.redSub(r).redSub(a).redMul(n.redSub(this.curve.two)),t=n.redMul(d.redSub(a)),i=n.redSqr().redSub(n).redSub(n);else{var o=this.z.redSqr(),h=n.redSub(o).redISub(o);e=s.redSub(r).redISub(a).redMul(h),t=n.redMul(d.redSub(a)),i=n.redMul(h)}}else{var d=r.redAdd(a);o=this.curve._mulC(this.c.redMul(this.z)).redSqr(),h=d.redSub(o).redSub(o);e=this.curve._mulC(s.redISub(d)).redMul(h),t=this.curve._mulC(d).redMul(r.redISub(a)),i=d.redMul(h)}return this.curve.point(e,t,i)},c.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},c.prototype._extAdd=function(e){var t=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),i=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),s=this.t.redMul(this.curve.dd).redMul(e.t),r=this.z.redMul(e.z.redAdd(e.z)),a=i.redSub(t),n=r.redSub(s),o=r.redAdd(s),h=i.redAdd(t),d=a.redMul(n),c=o.redMul(h),l=a.redMul(h),u=n.redMul(o);return this.curve.point(d,c,u,l)},c.prototype._projAdd=function(e){var t,i,s=this.z.redMul(e.z),r=s.redSqr(),a=this.x.redMul(e.x),n=this.y.redMul(e.y),o=this.curve.d.redMul(a).redMul(n),h=r.redSub(o),d=r.redAdd(o),c=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(a).redISub(n),l=s.redMul(h).redMul(c);return this.curve.twisted?(t=s.redMul(d).redMul(n.redSub(this.curve._mulA(a))),i=h.redMul(d)):(t=s.redMul(d).redMul(n.redSub(a)),i=this.curve._mulC(h).redMul(d)),this.curve.point(l,t,i)},c.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)},c.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)},c.prototype.mulAdd=function(e,t,i){return this.curve._wnafMulAdd(1,[this,t],[e,i],2,!1)},c.prototype.jmulAdd=function(e,t,i){return this.curve._wnafMulAdd(1,[this,t],[e,i],2,!0)},c.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this},c.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},c.prototype.getX=function(){return this.normalize(),this.x.fromRed()},c.prototype.getY=function(){return this.normalize(),this.y.fromRed()},c.prototype.eq=function(e){return this===e||0===this.getX().cmp(e.getX())&&0===this.getY().cmp(e.getY())},c.prototype.eqXToP=function(e){var t=e.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(t))return!0;for(var i=e.clone(),s=this.curve.redN.redMul(this.z);;){if(i.iadd(this.curve.n),i.cmp(this.curve.p)>=0)return!1;if(t.redIAdd(s),0===this.x.cmp(t))return!0}return!1},c.prototype.toP=c.prototype.normalize,c.prototype.mixedAdd=c.prototype.add},15261:function(e,t,i){"use strict";var s=t;s.base=i(63235),s.short=i(42669),s.mont=i(54152),s.edwards=i(95595)},54152:function(e,t,i){"use strict";var s=i(15261),r=i(35060),a=i(73150).inherits,n=s.base,o=i(73150).utils;function h(e){n.call(this,"mont",e),this.a=new r(e.a,16).toRed(this.red),this.b=new r(e.b,16).toRed(this.red),this.i4=new r(4).toRed(this.red).redInvm(),this.two=new r(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function d(e,t,i){n.BasePoint.call(this,e,"projective"),null===t&&null===i?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new r(t,16),this.z=new r(i,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}a(h,n),e.exports=h,h.prototype.validate=function(e){var t=e.normalize().x,i=t.redSqr(),s=i.redMul(t).redAdd(i.redMul(this.a)).redAdd(t);return 0===s.redSqrt().redSqr().cmp(s)},a(d,n.BasePoint),h.prototype.decodePoint=function(e,t){return this.point(o.toArray(e,t),1)},h.prototype.point=function(e,t){return new d(this,e,t)},h.prototype.pointFromJSON=function(e){return d.fromJSON(this,e)},d.prototype.precompute=function(){},d.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},d.fromJSON=function(e,t){return new d(e,t[0],t[1]||e.one)},d.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},d.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},d.prototype.dbl=function(){var e=this.x.redAdd(this.z).redSqr(),t=this.x.redSub(this.z).redSqr(),i=e.redSub(t),s=e.redMul(t),r=i.redMul(t.redAdd(this.curve.a24.redMul(i)));return this.curve.point(s,r)},d.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},d.prototype.diffAdd=function(e,t){var i=this.x.redAdd(this.z),s=this.x.redSub(this.z),r=e.x.redAdd(e.z),a=e.x.redSub(e.z).redMul(i),n=r.redMul(s),o=t.z.redMul(a.redAdd(n).redSqr()),h=t.x.redMul(a.redISub(n).redSqr());return this.curve.point(o,h)},d.prototype.mul=function(e){for(var t=e.clone(),i=this,s=this.curve.point(null,null),r=[];0!==t.cmpn(0);t.iushrn(1))r.push(t.andln(1));for(var a=r.length-1;a>=0;a--)0===r[a]?(i=i.diffAdd(s,this),s=s.dbl()):(s=i.diffAdd(s,this),i=i.dbl());return s},d.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},d.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},d.prototype.eq=function(e){return 0===this.getX().cmp(e.getX())},d.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},d.prototype.getX=function(){return this.normalize(),this.x.fromRed()}},42669:function(e,t,i){"use strict";var s=i(15261),r=i(73150),a=i(35060),n=r.inherits,o=s.base,h=r.utils.assert;function d(e){o.call(this,"short",e),this.a=new a(e.a,16).toRed(this.red),this.b=new a(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}function c(e,t,i,s){o.BasePoint.call(this,e,"affine"),null===t&&null===i?(this.x=null,this.y=null,this.inf=!0):(this.x=new a(t,16),this.y=new a(i,16),s&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function l(e,t,i,s){o.BasePoint.call(this,e,"jacobian"),null===t&&null===i&&null===s?(this.x=this.curve.one,this.y=this.curve.one,this.z=new a(0)):(this.x=new a(t,16),this.y=new a(i,16),this.z=new a(s,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}n(d,o),e.exports=d,d.prototype._getEndomorphism=function(e){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var t,i;if(e.beta)t=new a(e.beta,16).toRed(this.red);else{var s=this._getEndoRoots(this.p);t=(t=s[0].cmp(s[1])<0?s[0]:s[1]).toRed(this.red)}if(e.lambda)i=new a(e.lambda,16);else{var r=this._getEndoRoots(this.n);0===this.g.mul(r[0]).x.cmp(this.g.x.redMul(t))?i=r[0]:(i=r[1],h(0===this.g.mul(i).x.cmp(this.g.x.redMul(t))))}return{beta:t,lambda:i,basis:e.basis?e.basis.map((function(e){return{a:new a(e.a,16),b:new a(e.b,16)}})):this._getEndoBasis(i)}}},d.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:a.mont(e),i=new a(2).toRed(t).redInvm(),s=i.redNeg(),r=new a(3).toRed(t).redNeg().redSqrt().redMul(i);return[s.redAdd(r).fromRed(),s.redSub(r).fromRed()]},d.prototype._getEndoBasis=function(e){for(var t,i,s,r,n,o,h,d,c,l=this.n.ushrn(Math.floor(this.n.bitLength()/2)),u=e,f=this.n.clone(),p=new a(1),m=new a(0),g=new a(0),y=new a(1),b=0;0!==u.cmpn(0);){var v=f.div(u);d=f.sub(v.mul(u)),c=g.sub(v.mul(p));var w=y.sub(v.mul(m));if(!s&&d.cmp(l)<0)t=h.neg(),i=p,s=d.neg(),r=c;else if(s&&2==++b)break;h=d,f=u,u=d,g=p,p=c,y=m,m=w}n=d.neg(),o=c;var S=s.sqr().add(r.sqr());return n.sqr().add(o.sqr()).cmp(S)>=0&&(n=t,o=i),s.negative&&(s=s.neg(),r=r.neg()),n.negative&&(n=n.neg(),o=o.neg()),[{a:s,b:r},{a:n,b:o}]},d.prototype._endoSplit=function(e){var t=this.endo.basis,i=t[0],s=t[1],r=s.b.mul(e).divRound(this.n),a=i.b.neg().mul(e).divRound(this.n),n=r.mul(i.a),o=a.mul(s.a),h=r.mul(i.b),d=a.mul(s.b);return{k1:e.sub(n).sub(o),k2:h.add(d).neg()}},d.prototype.pointFromX=function(e,t){(e=new a(e,16)).red||(e=e.toRed(this.red));var i=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),s=i.redSqrt();if(0!==s.redSqr().redSub(i).cmp(this.zero))throw new Error("invalid point");var r=s.fromRed().isOdd();return(t&&!r||!t&&r)&&(s=s.redNeg()),this.point(e,s)},d.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,i=e.y,s=this.a.redMul(t),r=t.redSqr().redMul(t).redIAdd(s).redIAdd(this.b);return 0===i.redSqr().redISub(r).cmpn(0)},d.prototype._endoWnafMulAdd=function(e,t,i){for(var s=this._endoWnafT1,r=this._endoWnafT2,a=0;a<e.length;a++){var n=this._endoSplit(t[a]),o=e[a],h=o._getBeta();n.k1.negative&&(n.k1.ineg(),o=o.neg(!0)),n.k2.negative&&(n.k2.ineg(),h=h.neg(!0)),s[2*a]=o,s[2*a+1]=h,r[2*a]=n.k1,r[2*a+1]=n.k2}for(var d=this._wnafMulAdd(1,s,r,2*a,i),c=0;c<2*a;c++)s[c]=null,r[c]=null;return d},n(c,o.BasePoint),d.prototype.point=function(e,t,i){return new c(this,e,t,i)},d.prototype.pointFromJSON=function(e,t){return c.fromJSON(this,e,t)},c.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var i=this.curve,s=function(e){return i.point(e.x.redMul(i.endo.beta),e.y)};e.beta=t,t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(s)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(s)}}}return t}},c.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},c.fromJSON=function(e,t,i){"string"==typeof t&&(t=JSON.parse(t));var s=e.point(t[0],t[1],i);if(!t[2])return s;function r(t){return e.point(t[0],t[1],i)}var a=t[2];return s.precomputed={beta:null,doubles:a.doubles&&{step:a.doubles.step,points:[s].concat(a.doubles.points.map(r))},naf:a.naf&&{wnd:a.naf.wnd,points:[s].concat(a.naf.points.map(r))}},s},c.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},c.prototype.isInfinity=function(){return this.inf},c.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(0===this.x.cmp(e.x))return this.curve.point(null,null);var t=this.y.redSub(e.y);0!==t.cmpn(0)&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var i=t.redSqr().redISub(this.x).redISub(e.x),s=t.redMul(this.x.redSub(i)).redISub(this.y);return this.curve.point(i,s)},c.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(0===e.cmpn(0))return this.curve.point(null,null);var t=this.curve.a,i=this.x.redSqr(),s=e.redInvm(),r=i.redAdd(i).redIAdd(i).redIAdd(t).redMul(s),a=r.redSqr().redISub(this.x.redAdd(this.x)),n=r.redMul(this.x.redSub(a)).redISub(this.y);return this.curve.point(a,n)},c.prototype.getX=function(){return this.x.fromRed()},c.prototype.getY=function(){return this.y.fromRed()},c.prototype.mul=function(e){return e=new a(e,16),this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},c.prototype.mulAdd=function(e,t,i){var s=[this,t],r=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(s,r):this.curve._wnafMulAdd(1,s,r,2)},c.prototype.jmulAdd=function(e,t,i){var s=[this,t],r=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(s,r,!0):this.curve._wnafMulAdd(1,s,r,2,!0)},c.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||0===this.x.cmp(e.x)&&0===this.y.cmp(e.y))},c.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var i=this.precomputed,s=function(e){return e.neg()};t.precomputed={naf:i.naf&&{wnd:i.naf.wnd,points:i.naf.points.map(s)},doubles:i.doubles&&{step:i.doubles.step,points:i.doubles.points.map(s)}}}return t},c.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},n(l,o.BasePoint),d.prototype.jpoint=function(e,t,i){return new l(this,e,t,i)},l.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),i=this.x.redMul(t),s=this.y.redMul(t).redMul(e);return this.curve.point(i,s)},l.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},l.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),i=this.z.redSqr(),s=this.x.redMul(t),r=e.x.redMul(i),a=this.y.redMul(t.redMul(e.z)),n=e.y.redMul(i.redMul(this.z)),o=s.redSub(r),h=a.redSub(n);if(0===o.cmpn(0))return 0!==h.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var d=o.redSqr(),c=d.redMul(o),l=s.redMul(d),u=h.redSqr().redIAdd(c).redISub(l).redISub(l),f=h.redMul(l.redISub(u)).redISub(a.redMul(c)),p=this.z.redMul(e.z).redMul(o);return this.curve.jpoint(u,f,p)},l.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),i=this.x,s=e.x.redMul(t),r=this.y,a=e.y.redMul(t).redMul(this.z),n=i.redSub(s),o=r.redSub(a);if(0===n.cmpn(0))return 0!==o.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var h=n.redSqr(),d=h.redMul(n),c=i.redMul(h),l=o.redSqr().redIAdd(d).redISub(c).redISub(c),u=o.redMul(c.redISub(l)).redISub(r.redMul(d)),f=this.z.redMul(n);return this.curve.jpoint(l,u,f)},l.prototype.dblp=function(e){if(0===e)return this;if(this.isInfinity())return this;if(!e)return this.dbl();if(this.curve.zeroA||this.curve.threeA){for(var t=this,i=0;i<e;i++)t=t.dbl();return t}var s=this.curve.a,r=this.curve.tinv,a=this.x,n=this.y,o=this.z,h=o.redSqr().redSqr(),d=n.redAdd(n);for(i=0;i<e;i++){var c=a.redSqr(),l=d.redSqr(),u=l.redSqr(),f=c.redAdd(c).redIAdd(c).redIAdd(s.redMul(h)),p=a.redMul(l),m=f.redSqr().redISub(p.redAdd(p)),g=p.redISub(m),y=f.redMul(g);y=y.redIAdd(y).redISub(u);var b=d.redMul(o);i+1<e&&(h=h.redMul(u)),a=m,o=b,d=y}return this.curve.jpoint(a,d.redMul(r),o)},l.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},l.prototype._zeroDbl=function(){var e,t,i;if(this.zOne){var s=this.x.redSqr(),r=this.y.redSqr(),a=r.redSqr(),n=this.x.redAdd(r).redSqr().redISub(s).redISub(a);n=n.redIAdd(n);var o=s.redAdd(s).redIAdd(s),h=o.redSqr().redISub(n).redISub(n),d=a.redIAdd(a);d=(d=d.redIAdd(d)).redIAdd(d),e=h,t=o.redMul(n.redISub(h)).redISub(d),i=this.y.redAdd(this.y)}else{var c=this.x.redSqr(),l=this.y.redSqr(),u=l.redSqr(),f=this.x.redAdd(l).redSqr().redISub(c).redISub(u);f=f.redIAdd(f);var p=c.redAdd(c).redIAdd(c),m=p.redSqr(),g=u.redIAdd(u);g=(g=g.redIAdd(g)).redIAdd(g),e=m.redISub(f).redISub(f),t=p.redMul(f.redISub(e)).redISub(g),i=(i=this.y.redMul(this.z)).redIAdd(i)}return this.curve.jpoint(e,t,i)},l.prototype._threeDbl=function(){var e,t,i;if(this.zOne){var s=this.x.redSqr(),r=this.y.redSqr(),a=r.redSqr(),n=this.x.redAdd(r).redSqr().redISub(s).redISub(a);n=n.redIAdd(n);var o=s.redAdd(s).redIAdd(s).redIAdd(this.curve.a),h=o.redSqr().redISub(n).redISub(n);e=h;var d=a.redIAdd(a);d=(d=d.redIAdd(d)).redIAdd(d),t=o.redMul(n.redISub(h)).redISub(d),i=this.y.redAdd(this.y)}else{var c=this.z.redSqr(),l=this.y.redSqr(),u=this.x.redMul(l),f=this.x.redSub(c).redMul(this.x.redAdd(c));f=f.redAdd(f).redIAdd(f);var p=u.redIAdd(u),m=(p=p.redIAdd(p)).redAdd(p);e=f.redSqr().redISub(m),i=this.y.redAdd(this.z).redSqr().redISub(l).redISub(c);var g=l.redSqr();g=(g=(g=g.redIAdd(g)).redIAdd(g)).redIAdd(g),t=f.redMul(p.redISub(e)).redISub(g)}return this.curve.jpoint(e,t,i)},l.prototype._dbl=function(){var e=this.curve.a,t=this.x,i=this.y,s=this.z,r=s.redSqr().redSqr(),a=t.redSqr(),n=i.redSqr(),o=a.redAdd(a).redIAdd(a).redIAdd(e.redMul(r)),h=t.redAdd(t),d=(h=h.redIAdd(h)).redMul(n),c=o.redSqr().redISub(d.redAdd(d)),l=d.redISub(c),u=n.redSqr();u=(u=(u=u.redIAdd(u)).redIAdd(u)).redIAdd(u);var f=o.redMul(l).redISub(u),p=i.redAdd(i).redMul(s);return this.curve.jpoint(c,f,p)},l.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),i=this.z.redSqr(),s=t.redSqr(),r=e.redAdd(e).redIAdd(e),a=r.redSqr(),n=this.x.redAdd(t).redSqr().redISub(e).redISub(s),o=(n=(n=(n=n.redIAdd(n)).redAdd(n).redIAdd(n)).redISub(a)).redSqr(),h=s.redIAdd(s);h=(h=(h=h.redIAdd(h)).redIAdd(h)).redIAdd(h);var d=r.redIAdd(n).redSqr().redISub(a).redISub(o).redISub(h),c=t.redMul(d);c=(c=c.redIAdd(c)).redIAdd(c);var l=this.x.redMul(o).redISub(c);l=(l=l.redIAdd(l)).redIAdd(l);var u=this.y.redMul(d.redMul(h.redISub(d)).redISub(n.redMul(o)));u=(u=(u=u.redIAdd(u)).redIAdd(u)).redIAdd(u);var f=this.z.redAdd(n).redSqr().redISub(i).redISub(o);return this.curve.jpoint(l,u,f)},l.prototype.mul=function(e,t){return e=new a(e,t),this.curve._wnafMul(this,e)},l.prototype.eq=function(e){if("affine"===e.type)return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),i=e.z.redSqr();if(0!==this.x.redMul(i).redISub(e.x.redMul(t)).cmpn(0))return!1;var s=t.redMul(this.z),r=i.redMul(e.z);return 0===this.y.redMul(r).redISub(e.y.redMul(s)).cmpn(0)},l.prototype.eqXToP=function(e){var t=this.z.redSqr(),i=e.toRed(this.curve.red).redMul(t);if(0===this.x.cmp(i))return!0;for(var s=e.clone(),r=this.curve.redN.redMul(t);;){if(s.iadd(this.curve.n),s.cmp(this.curve.p)>=0)return!1;if(i.redIAdd(r),0===this.x.cmp(i))return!0}return!1},l.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},l.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}},61198:function(e,t,i){"use strict";var s,r=t,a=i(73150),n=a.utils.assert;function o(e){"short"===e.type?this.curve=new a.curve.short(e):"edwards"===e.type?this.curve=new a.curve.edwards(e):this.curve=new a.curve.mont(e),this.g=this.curve.g,this.n=this.curve.n,this.hash=e.hash,n(this.g.validate(),"Invalid curve"),n(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function h(e,t){Object.defineProperty(r,e,{configurable:!0,enumerable:!0,get:function(){var i=new o(t);return Object.defineProperty(r,e,{configurable:!0,enumerable:!0,value:i}),i}})}r.PresetCurve=o,h("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:"SHA256",gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),h("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:"SHA256",gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),h("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:"SHA256",gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),h("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:"SHA384",gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),h("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:"SHA512",gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),h("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:"SHA256",gRed:!1,g:["9"]}),h("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:"SHA256",gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{s=i(14935)}catch(e){s=void 0}h("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:"SHA256",beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",s]})},61643:function(e,t,i){"use strict";var s=i(35060),r=i(50448),a=i(73150),n=a.utils.assert,o=i(60331),h=i(20562);function d(e){if(!(this instanceof d))return new d(e);"string"==typeof e&&(n(a.curves.hasOwnProperty(e),"Unknown curve "+e),e=a.curves[e]),e instanceof a.curves.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}e.exports=d,d.prototype.keyPair=function(e){return new o(this,e)},d.prototype.keyFromPrivate=function(e,t){return o.fromPrivate(this,e,t)},d.prototype.keyFromPublic=function(e,t){return o.fromPublic(this,e,t)},d.prototype.genKeyPair=function(e){e||(e={});for(var t=new r({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||null,entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),i=this.n.byteLength(),a=this.n.sub(new s(2));;){var n=new s(t.generate(i));if(!(n.cmp(a)>0))return n.iaddn(1),this.keyFromPrivate(n)}},d.prototype._truncateToN=function(e,t){var i=8*e.byteLength()-this.n.bitLength();return i>0&&(e=e.ushrn(i)),!t&&e.cmp(this.n)>=0?e.sub(this.n):e},d.prototype.sign=function(e,t,i,a){"object"==typeof i&&(a=i,i=null),a||(a={}),t=this.keyFromPrivate(t,i),e=this._truncateToN(new s(e,16));for(var n=this.n.byteLength(),o=t.getPrivate().toArray("be",n),d=e.toArray("be",n),c=new r({hash:this.hash,entropy:a.extraEntropy?o.concat(a.extraEntropy):o,nonce:d,pers:a.pers,persEnc:a.persEnc||"utf8"}),l=this.n.sub(new s(1)),u=0;;u++){var f=a.k?a.k(u):new s(c.generate(this.n.byteLength()));if(!((f=this._truncateToN(f,!0)).cmpn(1)<=0||f.cmp(l)>=0)){var p=this.g.mul(f);if(!p.isInfinity()){var m=p.getX(),g=m.umod(this.n);if(0!==g.cmpn(0)){var y=f.invm(this.n).mul(g.mul(t.getPrivate()).iadd(e));if(0!==(y=y.umod(this.n)).cmpn(0)){var b=(p.getY().isOdd()?1:0)|(0!==m.cmp(g)?2:0);return a.canonical&&y.cmp(this.nh)>0&&(y=this.n.sub(y),b^=1),new h({r:g,s:y,recoveryParam:b})}}}}}},d.prototype.verify=function(e,t,i,r){e=this._truncateToN(new s(e,16)),i=this.keyFromPublic(i,r);var a=(t=new h(t,"hex")).r,n=t.s;if(a.cmpn(1)<0||a.cmp(this.n)>=0)return!1;if(n.cmpn(1)<0||n.cmp(this.n)>=0)return!1;var o,d=n.invm(this.n),c=d.mul(e).umod(this.n),l=d.mul(a).umod(this.n);return this.curve._maxwellTrick?!(o=this.g.jmulAdd(c,i.getPublic(),l)).isInfinity()&&o.eqXToP(a):!(o=this.g.mulAdd(c,i.getPublic(),l)).isInfinity()&&0===o.getX().umod(this.n).cmp(a)},d.prototype.recoverPubKey=function(e,t,i,r){n((3&i)===i,"The recovery param is more than two bits"),t=new h(t,r);var a=this.n,o=new s(e),d=t.r,c=t.s,l=1&i,u=i>>1;if(d.cmp(this.curve.p.umod(this.curve.n))>=0&&u)throw new Error("Unable to find sencond key candinate");d=u?this.curve.pointFromX(d.add(this.curve.n),l):this.curve.pointFromX(d,l);var f=t.r.invm(a),p=a.sub(o).mul(f).umod(a),m=c.mul(f).umod(a);return this.g.mulAdd(p,d,m)},d.prototype.getKeyRecoveryParam=function(e,t,i,s){if(null!==(t=new h(t,s)).recoveryParam)return t.recoveryParam;for(var r=0;r<4;r++){var a;try{a=this.recoverPubKey(e,t,r)}catch(e){continue}if(a.eq(i))return r}throw new Error("Unable to find valid recovery factor")}},60331:function(e,t,i){"use strict";var s=i(35060),r=i(73150).utils.assert;function a(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}e.exports=a,a.fromPublic=function(e,t,i){return t instanceof a?t:new a(e,{pub:t,pubEnc:i})},a.fromPrivate=function(e,t,i){return t instanceof a?t:new a(e,{priv:t,privEnc:i})},a.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},a.prototype.getPublic=function(e,t){return"string"==typeof e&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t?this.pub.encode(t,e):this.pub},a.prototype.getPrivate=function(e){return"hex"===e?this.priv.toString(16,2):this.priv},a.prototype._importPrivate=function(e,t){this.priv=new s(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)},a.prototype._importPublic=function(e,t){if(e.x||e.y)return"mont"===this.ec.curve.type?r(e.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||r(e.x&&e.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(e.x,e.y));this.pub=this.ec.curve.decodePoint(e,t)},a.prototype.derive=function(e){return e.mul(this.priv).getX()},a.prototype.sign=function(e,t,i){return this.ec.sign(e,this,t,i)},a.prototype.verify=function(e,t){return this.ec.verify(e,t,this)},a.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},20562:function(e,t,i){"use strict";var s=i(35060),r=i(73150).utils.assert;e.exports=function e(t,i){if(t instanceof e)return t;r(t.r&&t.s,"Signature without r or s"),this.r=new s(t.r,16),this.s=new s(t.s,16),void 0===t.recoveryParam?this.recoveryParam=null:this.recoveryParam=t.recoveryParam}},89214:function(e,t,i){"use strict";var s=i(61198),r=i(27882),a=r.assert,n=r.parseBytes,o=i(72429),h=i(7423);const d=i(35060),{byteArrayToWordArray:c}=i(80651),l=i(27295);function u(e){if(a("ed25519"===e,"only tested with ed25519 so far"),!(this instanceof u))return new u(e);var t=s[e].curve;this.curve=t,this.g=t.g,this.g.precompute(t.n.bitLength()+1),this.pointClass=t.point().constructor,this.encodingLength=Math.ceil(t.n.bitLength()/8)}e.exports=u,u.prototype.sign=function(e,t){e=n(e);var i=this.keyFromSecret(t),s=this.hashInt(i.secret(),e),r=this.g.mul(s),a=this.encodePoint(r),o=this.hashInt(a,i.pubBytes(),e);o=o.mul(i.priv());var h=s.add(o).umod(this.curve.n);return this.makeSignature({R:r,S:h,Rencoded:a})},u.prototype.signModified=function(e,t){e=n(e);var i=this.keyFromSecret(t);const s=new d(i.secret(),16,"le"),r=this.encodePoint(this.g.mul(s)),a=128&r[31];var o=this.hashInt(i.secret(),e),h=this.g.mul(o),c=this.encodePoint(h);let l=this.hashInt(c,r,e);l=l.mul(s);var u=o.add(l).umod(this.curve.n),f=u.toArray("le",32);return f[31]|=a,this.makeSignature({R:h,S:u,Rencoded:c,Sencoded:f})},u.prototype.verify=function(e,t,i){e=n(e),t=this.makeSignature(t);var s=this.keyFromPublic(i),r=this.hashInt(t.Rencoded(),s.pubBytes(),e),a=this.g.mul(t.S());return t.R().add(s.pub().mul(r)).eq(a)},u.prototype.hashInt=function(){let e=Array.from(arguments).reduce(((e,t)=>e.concat(t)));e=c(e);const t=l.SHA512(e).toString(l.enc.Hex);return r.intFromLE(t).umod(this.curve.n)},u.prototype.keyFromPublic=function(e){return o.fromPublic(this,e)},u.prototype.keyFromSecret=function(e){return o.fromSecret(this,e)},u.prototype.makeSignature=function(e){return e instanceof h?e:new h(this,e)},u.prototype.encodePoint=function(e){var t=e.getY().toArray("le",this.encodingLength);return t[this.encodingLength-1]|=e.getX().isOdd()?128:0,t},u.prototype.decodePoint=function(e){var t=(e=r.parseBytes(e)).length-1,i=e.slice(0,t).concat(-129&e[t]),s=0!=(128&e[t]),a=r.intFromLE(i);return this.curve.pointFromY(a,s)},u.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)},u.prototype.decodeInt=function(e){return r.intFromLE(e)},u.prototype.isPoint=function(e){return e instanceof this.pointClass}},72429:function(e,t,i){"use strict";var s=i(27882),r=s.assert,a=s.parseBytes,n=s.cachedProperty;function o(e,t){this.eddsa=e,this._secret=a(t.secret),e.isPoint(t.pub)?this._pub=t.pub:this._pubBytes=a(t.pub)}o.fromPublic=function(e,t){return t instanceof o?t:new o(e,{pub:t})},o.fromSecret=function(e,t){return t instanceof o?t:new o(e,{secret:t})},o.prototype.secret=function(){return this._secret},n(o,"pubBytes",(function(){return this.eddsa.encodePoint(this.pub())})),n(o,"pub",(function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())})),n(o,"privBytes",(function(){var e=this.eddsa,t=this.hash(),i=e.encodingLength-1,s=t.slice(0,e.encodingLength);return s[0]&=248,s[i]&=127,s[i]|=64,s})),n(o,"priv",(function(){return this.eddsa.decodeInt(this.privBytes())})),n(o,"hash",(function(){return this.eddsa.hash().update(this.secret()).digest()})),n(o,"messagePrefix",(function(){return this.hash().slice(this.eddsa.encodingLength)})),o.prototype.sign=function(e){return r(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)},o.prototype.signModified=function(e){return r(this._secret,"KeyPair can only verify"),this.eddsa.signModified(e,this)},o.prototype.verify=function(e,t){return this.eddsa.verify(e,t,this)},o.prototype.getSecret=function(e){return r(this._secret,"KeyPair is public only"),s.encode(this.secret(),e)},o.prototype.getPublic=function(e){return s.encode(this.pubBytes(),e)},e.exports=o},7423:function(e,t,i){"use strict";var s=i(35060),r=i(27882),a=r.assert,n=r.cachedProperty,o=r.parseBytes;function h(e,t){this.eddsa=e,"object"!=typeof t&&(t=o(t)),Array.isArray(t)&&(t={R:t.slice(0,e.encodingLength),S:t.slice(e.encodingLength)}),a(t.R&&t.S,"Signature without R or S"),e.isPoint(t.R)&&(this._R=t.R),t.S instanceof s&&(this._S=t.S),this._Rencoded=Array.isArray(t.R)?t.R:t.Rencoded,this._Sencoded=Array.isArray(t.S)?t.S:t.Sencoded}n(h,"S",(function(){return this.eddsa.decodeInt(this.Sencoded())})),n(h,"R",(function(){return this.eddsa.decodePoint(this.Rencoded())})),n(h,"Rencoded",(function(){return this.eddsa.encodePoint(this.R())})),n(h,"Sencoded",(function(){return this.eddsa.encodeInt(this.S())})),h.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},h.prototype.toHex=function(){return r.encode(this.toBytes(),"hex").toUpperCase()},e.exports=h},14935:function(e){e.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}},27882:function(e,t,i){"use strict";var s=t,r=i(35060);function a(e,t){var i=[];return t>0&&i.push(e>>>24),t>1&&i.push(e>>>16&255),t>2&&i.push(e>>>8&255),t>3&&i.push(255&e),i}function n(e){return 1===e.length?"0"+e:e}function o(e){for(var t="",i=0;i<e.length;i++)t+=n(e[i].toString(16));return t}s.assert=function(e,t){if(!e)throw new Error(t)},s.getNAF=function(e,t){for(var i=[],s=1<<t+1,r=e.clone();r.cmpn(1)>=0;){var a;if(r.isOdd()){var n=r.andln(s-1);a=n>(s>>1)-1?(s>>1)-n:n,r.isubn(a)}else a=0;i.push(a);for(var o=0!==r.cmpn(0)&&0===r.andln(s-1)?t+1:1,h=1;h<o;h++)i.push(0);r.iushrn(o)}return i},s.getJSF=function(e,t){var i=[[],[]];e=e.clone(),t=t.clone();for(var s=0,r=0;e.cmpn(-s)>0||t.cmpn(-r)>0;){var a,n,o,h=e.andln(3)+s&3,d=t.andln(3)+r&3;if(3===h&&(h=-1),3===d&&(d=-1),0==(1&h))a=0;else a=3!==(o=e.andln(7)+s&7)&&5!==o||2!==d?h:-h;if(i[0].push(a),0==(1&d))n=0;else n=3!==(o=t.andln(7)+r&7)&&5!==o||2!==h?d:-d;i[1].push(n),2*s===a+1&&(s=1-s),2*r===n+1&&(r=1-r),e.iushrn(1),t.iushrn(1)}return i},s.cachedProperty=function(e,t,i){var s="_"+t;e.prototype[t]=function(){return void 0!==this[s]?this[s]:this[s]=i.call(this)}},s.parseBytes=function(e){return"string"==typeof e?s.toArray(e,"hex"):e},s.intFromLE=function(e){return new r(e,"hex","le")},s.wordArrayToBuffer=function(e){let t;if(!e.hasOwnProperty("sigBytes")||!e.hasOwnProperty("words"))throw Error("Argument not a wordArray");t=e.sigBytes,e=e.words;const i=[];let s=[],r=0;for(;t>0;)s=a(e[r],Math.min(4,t)),t-=s.length,i.push(s),r++;return[].concat.apply([],i)},s.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var i=[];if("string"!=typeof e){for(var s=0;s<e.length;s++)i[s]=0|e[s];return i}if("hex"===t){(e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e);for(s=0;s<e.length;s+=2)i.push(parseInt(e[s]+e[s+1],16))}else for(s=0;s<e.length;s++){var r=e.charCodeAt(s),a=r>>8,n=255&r;a?i.push(a,n):i.push(n)}return i},s.zero2=n,s.toHex=o,s.encode=function(e,t){return"hex"===t?o(e):e}},50448:function(e,t,i){"use strict";var s=i(27295),r=i(27882).assert,a=i(27882),{byteArrayToWordArray:n}=i(80651);const o=s.enc.Utf8.parse(""),h=s.enc.Utf8.parse("\0");function d(e){if(!(this instanceof d))return new d(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.slice(3,6),this.minEntropy=e.minEntropy||192,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=e.entropy,i=e.nonce;r(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,i,[])}e.exports=d,d.prototype._init=function(e,t,i){var r=e.concat(t).concat(i);this.K=new s.lib.WordArray.init,this.V=new s.lib.WordArray.init;this.V.words=Array(this.outLen/32).fill(16843009),this.V.sigBytes=32,this._update(r),this._reseed=1,this.reseedInterval=281474976710656},d.prototype._hmac=function(){return new s.lib.WordArray.init},d.prototype._update=function(e){var t=this._hmac();t.concat(this.V),t.concat(h),e&&t.concat(n(e)),this.K=s["Hmac"+this.hash](t,this.K),this.V=s["Hmac"+this.hash](this.V,this.K),e&&((t=this._hmac()).concat(this.V),t.concat(o),t.concat(n(e)),this.K=s["Hmac"+this.hash](t,this.K),this.V=s["Hmac"+this.hash](this.V,this.K))},d.prototype.reseed=function(e,t,i,s){"string"!=typeof t&&(i,i=t,t=null),r(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(i||[])),this._reseed=1},d.prototype.generate=function(e,t,i,r){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof t&&(i,i=t,t=null),i&&(i=s.enc.Utf8.parse(i),this._update(i));for(var n=new s.lib.WordArray.init;n.sigBytes<e;)this.V=s["Hmac"+this.hash](this.V,this.K),n.concat(this.V);return this._update(i),this._reseed++,a.wordArrayToBuffer(n)}},79323:function(e,t,i){"use strict";var s=i(61214);function r(e){const t=function(t,i){return"string"==typeof t&&"//"===t.slice(0,2)?e("https:"+t,i):e(t,i)};return t.http=e.http,t.https=e.https,t}e.exports=function(e){return e&&e.Promise&&(s.Promise=e.Promise),{fetch:r(s),Headers:s.Headers,Request:s.Request,Response:s.Response}}},61214:function(e,t,i){"use strict";var s=i(48764).Buffer;Object.defineProperty(t,"__esModule",{value:!0});const r=Symbol("buffer"),a=Symbol("type");class n{constructor(){this[a]="";const e=arguments[0],t=arguments[1],i=[];if(e){const t=e,a=Number(t.length);for(let e=0;e<a;e++){const a=t[e];let o;o=a instanceof s?a:ArrayBuffer.isView(a)?s.from(a.buffer,a.byteOffset,a.byteLength):a instanceof ArrayBuffer?s.from(a):a instanceof n?a[r]:s.from("string"==typeof a?a:String(a)),i.push(o)}}this[r]=s.concat(i);let o=t&&void 0!==t.type&&String(t.type).toLowerCase();o&&!/[^\u0020-\u007E]/.test(o)&&(this[a]=o)}get size(){return this[r].length}get type(){return this[a]}slice(){const e=this.size,t=arguments[0],i=arguments[1];let s,a;s=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),a=void 0===i?e:i<0?Math.max(e+i,0):Math.min(i,e);const o=Math.max(a-s,0),h=this[r].slice(s,s+o),d=new n([],{type:arguments[2]});return d[r]=h,d}}function o(e,t,i){Error.call(this,e),this.message=e,this.type=t,i&&(this.code=this.errno=i.code),Error.captureStackTrace(this,this.constructor)}Object.defineProperties(n.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(n.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),o.prototype=Object.create(Error.prototype),o.prototype.constructor=o,o.prototype.name="FetchError";const h=i(42830);const d=i(42830).PassThrough,c=Symbol("Body internals");function l(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i.size;let a=void 0===r?0:r;var d=i.timeout;let l=void 0===d?0:d;null==e?e=null:"string"==typeof e||f(e)||e instanceof n||s.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||e instanceof h||(e=String(e)),this[c]={body:e,disturbed:!1,error:null},this.size=a,this.timeout=l,e instanceof h&&e.on("error",(function(e){t[c].error=new o(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e)}))}function u(){var e=this;if(this[c].disturbed)return l.Promise.reject(new TypeError(`body used already for: ${this.url}`));if(this[c].disturbed=!0,this[c].error)return l.Promise.reject(this[c].error);if(null===this.body)return l.Promise.resolve(s.alloc(0));if("string"==typeof this.body)return l.Promise.resolve(s.from(this.body));if(this.body instanceof n)return l.Promise.resolve(this.body[r]);if(s.isBuffer(this.body))return l.Promise.resolve(this.body);if("[object ArrayBuffer]"===Object.prototype.toString.call(this.body))return l.Promise.resolve(s.from(this.body));if(!(this.body instanceof h))return l.Promise.resolve(s.alloc(0));let t=[],i=0,a=!1;return new l.Promise((function(r,n){let h;e.timeout&&(h=setTimeout((function(){a=!0,n(new o(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))}),e.timeout)),e.body.on("error",(function(t){n(new o(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))})),e.body.on("data",(function(s){if(!a&&null!==s){if(e.size&&i+s.length>e.size)return a=!0,void n(new o(`content size at ${e.url} over limit: ${e.size}`,"max-size"));i+=s.length,t.push(s)}})),e.body.on("end",(function(){if(!a){clearTimeout(h);try{r(s.concat(t))}catch(t){n(new o(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}}))}))}function f(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function p(e){let t,i,s=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return s instanceof h&&"function"!=typeof s.getBoundary&&(t=new d,i=new d,s.pipe(t),s.pipe(i),e[c].body=t,s=i),s}function m(e){const t=e.body;return null===t?0:"string"==typeof t?s.byteLength(t):f(t)?s.byteLength(String(t)):t instanceof n?t.size:s.isBuffer(t)?t.length:"[object ArrayBuffer]"===Object.prototype.toString.call(t)?t.byteLength:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}l.prototype={get body(){return this[c].body},get bodyUsed(){return this[c].disturbed},arrayBuffer(){return u.call(this).then((function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}))},blob(){let e=this.headers&&this.headers.get("content-type")||"";return u.call(this).then((function(t){return Object.assign(new n([],{type:e.toLowerCase()}),{[r]:t})}))},json(){var e=this;return u.call(this).then((function(t){try{return JSON.parse(t.toString())}catch(t){return l.Promise.reject(new o(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}}))},text(){return u.call(this).then((function(e){return e.toString()}))},buffer(){return u.call(this)},textConverted(){var e=this;return u.call(this).then((function(t){return function(e,t){if("function"!=typeof convert)throw new Error("The package `encoding` must be installed to use the textConverted() function");const i=t.get("content-type");let s,r,a="utf-8";i&&(s=/charset=([^;]*)/i.exec(i));r=e.slice(0,1024).toString(),!s&&r&&(s=/<meta.+?charset=(['"])(.+?)\1/i.exec(r));!s&&r&&(s=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(r),s&&(s=/charset=(.*)/i.exec(s.pop())));!s&&r&&(s=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(r));s&&(a=s.pop(),"gb2312"!==a&&"gbk"!==a||(a="gb18030"));return convert(e,"UTF-8",a).toString()}(t,e.headers)}))}},Object.defineProperties(l.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),l.mixIn=function(e){for(const t of Object.getOwnPropertyNames(l.prototype))if(!(t in e)){const i=Object.getOwnPropertyDescriptor(l.prototype,t);Object.defineProperty(e,t,i)}},l.Promise=i.g.Promise;const g=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,y=/[^\t\x20-\x7e\x80-\xff]/;function b(e){if(e=`${e}`,g.test(e))throw new TypeError(`${e} is not a legal HTTP header name`)}function v(e){if(e=`${e}`,y.test(e))throw new TypeError(`${e} is not a legal HTTP header value`)}function w(e,t){t=t.toLowerCase();for(const i in e)if(i.toLowerCase()===t)return i}const S=Symbol("map");class k{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[S]=Object.create(null),e instanceof k){const t=e.raw(),i=Object.keys(t);for(const e of i)for(const i of t[e])this.append(e,i)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const i=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");i.push(Array.from(t))}for(const e of i){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const i=e[t];this.append(t,i)}}}}get(e){b(e=`${e}`);const t=w(this[S],e);return void 0===t?null:this[S][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=T(this),s=0;for(;s<i.length;){var r=i[s];const a=r[0],n=r[1];e.call(t,n,a,this),i=T(this),s++}}set(e,t){t=`${t}`,b(e=`${e}`),v(t);const i=w(this[S],e);this[S][void 0!==i?i:e]=[t]}append(e,t){t=`${t}`,b(e=`${e}`),v(t);const i=w(this[S],e);void 0!==i?this[S][i].push(t):this[S][e]=[t]}has(e){return b(e=`${e}`),void 0!==w(this[S],e)}delete(e){b(e=`${e}`);const t=w(this[S],e);void 0!==t&&delete this[S][t]}raw(){return this[S]}keys(){return O(this,"key")}values(){return O(this,"value")}[Symbol.iterator](){return O(this,"key+value")}}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";const i=Object.keys(e[S]).sort();return i.map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[S][t].join(", ")}:function(t){return[t.toLowerCase(),e[S][t].join(", ")]})}k.prototype.entries=k.prototype[Symbol.iterator],Object.defineProperty(k.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(k.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const _=Symbol("internal");function O(e,t){const i=Object.create(M);return i[_]={target:e,kind:t,index:0},i}const M=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==M)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[_];const t=e.target,i=e.kind,s=e.index,r=T(t,i);return s>=r.length?{value:void 0,done:!0}:(this[_].index=s+1,{value:r[s],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function I(e){const t=Object.assign({__proto__:null},e[S]),i=w(e[S],"Host");return void 0!==i&&(t[i]=t[i][0]),t}Object.defineProperty(M,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const x=i(35368).STATUS_CODES,C=Symbol("Response internals");class P{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};l.call(this,e,t);const i=t.status||200;this[C]={url:t.url,status:i,statusText:t.statusText||x[i],headers:new k(t.headers)}}get url(){return this[C].url}get status(){return this[C].status}get ok(){return this[C].status>=200&&this[C].status<300}get statusText(){return this[C].statusText}get headers(){return this[C].headers}clone(){return new P(p(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok})}}l.mixIn(P.prototype),Object.defineProperties(P.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(P.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});var A=i(8575);const N=A.format,B=A.parse,E=Symbol("Request internals");function V(e){return"object"==typeof e&&"object"==typeof e[E]}class L{constructor(e){let t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};V(e)?t=B(e.url):(t=e&&e.href?B(e.href):B(`${e}`),e={});let r=i.method||e.method||"GET";if(r=r.toUpperCase(),(null!=i.body||V(e)&&null!==e.body)&&("GET"===r||"HEAD"===r))throw new TypeError("Request with GET/HEAD method cannot have body");let a=null!=i.body?i.body:V(e)&&null!==e.body?p(e):null;l.call(this,a,{timeout:i.timeout||e.timeout||0,size:i.size||e.size||0});const o=new k(i.headers||e.headers||{});if(null!=i.body){const e=function(e){const t=e.body;return null===t?null:"string"==typeof t?"text/plain;charset=UTF-8":f(t)?"application/x-www-form-urlencoded;charset=UTF-8":t instanceof n?t.type||null:s.isBuffer(t)||"[object ArrayBuffer]"===Object.prototype.toString.call(t)?null:"function"==typeof t.getBoundary?`multipart/form-data;boundary=${t.getBoundary()}`:null}(this);null===e||o.has("Content-Type")||o.append("Content-Type",e)}this[E]={method:r,redirect:i.redirect||e.redirect||"follow",headers:o,parsedURL:t},this.follow=void 0!==i.follow?i.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==i.compress?i.compress:void 0===e.compress||e.compress,this.counter=i.counter||e.counter||0,this.agent=i.agent||e.agent}get method(){return this[E].method}get url(){return N(this[E].parsedURL)}get headers(){return this[E].headers}get redirect(){return this[E].redirect}clone(){return new L(this)}}l.mixIn(L.prototype),Object.defineProperty(L.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(L.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0}});const R=i(35368),D=i(78339);const F=i(42830).PassThrough;const q=i(8575).resolve,G=i(42635);function H(e,t){if(!H.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return l.Promise=H.Promise,new H.Promise((function(i,a){const h=new L(e,t),d=function(e){const t=e[E].parsedURL,i=new k(e[E].headers);if(i.has("Accept")||i.set("Accept","*/*"),!t.protocol||!t.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw new TypeError("Only HTTP(S) protocols are supported");let s=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(s="0"),null!=e.body){const t=m(e);"number"==typeof t&&(s=String(t))}return s&&i.set("Content-Length",s),i.has("User-Agent")||i.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&i.set("Accept-Encoding","gzip,deflate"),i.has("Connection")||e.agent||i.set("Connection","close"),Object.assign({},t,{method:e.method,headers:I(i),agent:e.agent})}(h),c=(0,("https:"===d.protocol?D:R).request)(d);let l;function u(){c.abort(),clearTimeout(l)}h.timeout&&c.once("socket",(function(e){l=setTimeout((function(){a(new o(`network timeout at: ${h.url}`,"request-timeout")),u()}),h.timeout)})),c.on("error",(function(e){a(new o(`request to ${h.url} failed, reason: ${e.message}`,"system",e)),u()})),c.on("response",(function(e){clearTimeout(l);const t=function(e){const t=new k;for(const i of Object.keys(e))if(!g.test(i))if(Array.isArray(e[i]))for(const s of e[i])y.test(s)||(void 0===t[S][i]?t[S][i]=[s]:t[S][i].push(s));else y.test(e[i])||(t[S][i]=[e[i]]);return t}(e.headers);if(H.isRedirect(e.statusCode)){const s=t.get("Location"),r=null===s?null:q(h.url,s);switch(h.redirect){case"error":return a(new o(`redirect mode is set to error: ${h.url}`,"no-redirect")),void u();case"manual":null!==r&&t.set("Location",r);break;case"follow":if(null===r)break;if(h.counter>=h.follow)return a(new o(`maximum redirect reached at: ${h.url}`,"max-redirect")),void u();const s={headers:new k(h.headers),follow:h.follow,counter:h.counter+1,agent:h.agent,compress:h.compress,method:h.method,body:h.body};return 303!==e.statusCode&&h.body&&null===m(h)?(a(new o("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void u()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==h.method)||(s.method="GET",s.body=void 0,s.headers.delete("content-length")),i(H(new L(r,s))),void u())}}let s=e.pipe(new F);const r={url:h.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:h.size,timeout:h.timeout},n=t.get("Content-Encoding");if(!h.compress||"HEAD"===h.method||null===n||204===e.statusCode||304===e.statusCode)return void i(new P(s,r));const d={flush:G.Z_SYNC_FLUSH,finishFlush:G.Z_SYNC_FLUSH};if("gzip"==n||"x-gzip"==n)return s=s.pipe(G.createGunzip(d)),void i(new P(s,r));if("deflate"!=n&&"x-deflate"!=n)i(new P(s,r));else{e.pipe(new F).once("data",(function(e){s=8==(15&e[0])?s.pipe(G.createInflate()):s.pipe(G.createInflateRaw()),i(new P(s,r))}))}})),function(e,t){const i=t.body;null===i?e.end():"string"==typeof i?(e.write(i),e.end()):f(i)?(e.write(s.from(String(i))),e.end()):i instanceof n?(e.write(i[r]),e.end()):s.isBuffer(i)?(e.write(i),e.end()):"[object ArrayBuffer]"===Object.prototype.toString.call(i)?(e.write(s.from(i)),e.end()):i.pipe(e)}(c,h)}))}H.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},H.default=H,H.Promise=i.g.Promise,H.http=R,H.https=D,e.exports=t=H,t.Headers=k,t.Request=L,t.Response=P,t.FetchError=o},21286:function(e,t,i){var s=i(48764).Buffer,r=i(939),a=i(41147)._,n=i(48173),o=i(41917);e.exports=function(){var e={browser:["md5","ripemd160","sha1","sha256","sha512"]},t="pkcs1",i="pkcs1",h={private:"pkcs1-private-pem","private-der":"pkcs1-private-der",public:"pkcs8-public-pem","public-der":"pkcs8-public-der"};function d(e,n,o){if(!(this instanceof d))return new d(e,n,o);a.isObject(n)&&(o=n,n=void 0),this.$options={signingScheme:i,signingSchemeOptions:{hash:"sha256",saltLength:null},encryptionScheme:t,encryptionSchemeOptions:{hash:"sha1",label:null},environment:"browser",rsaUtils:this},this.keyPair=new r.Key,this.$cache={},s.isBuffer(e)||a.isString(e)?this.importKey(e,n):a.isObject(e)&&this.generateKeyPair(e.b,e.e),this.setOptions(o)}return d.prototype.setOptions=function(s){if((s=s||{}).environment&&(this.$options.environment=s.environment),s.signingScheme){if(a.isString(s.signingScheme)){var r=s.signingScheme.toLowerCase().split("-");1==r.length?e.node.indexOf(r[0])>-1?(this.$options.signingSchemeOptions={hash:r[0]},this.$options.signingScheme=i):(this.$options.signingScheme=r[0],this.$options.signingSchemeOptions={hash:null}):(this.$options.signingSchemeOptions={hash:r[1]},this.$options.signingScheme=r[0])}else a.isObject(s.signingScheme)&&(this.$options.signingScheme=s.signingScheme.scheme||i,this.$options.signingSchemeOptions=a.omit(s.signingScheme,"scheme"));if(!n.isSignature(this.$options.signingScheme))throw Error("Unsupported signing scheme");if(this.$options.signingSchemeOptions.hash&&-1===e[this.$options.environment].indexOf(this.$options.signingSchemeOptions.hash))throw Error("Unsupported hashing algorithm for "+this.$options.environment+" environment")}if(s.encryptionScheme){if(a.isString(s.encryptionScheme)?(this.$options.encryptionScheme=s.encryptionScheme.toLowerCase(),this.$options.encryptionSchemeOptions={}):a.isObject(s.encryptionScheme)&&(this.$options.encryptionScheme=s.encryptionScheme.scheme||t,this.$options.encryptionSchemeOptions=a.omit(s.encryptionScheme,"scheme")),!n.isEncryption(this.$options.encryptionScheme))throw Error("Unsupported encryption scheme");if(this.$options.encryptionSchemeOptions.hash&&-1===e[this.$options.environment].indexOf(this.$options.encryptionSchemeOptions.hash))throw Error("Unsupported hashing algorithm for "+this.$options.environment+" environment")}this.keyPair.setOptions(this.$options)},d.prototype.importKey=function(e,t){if(!e)throw Error("Empty key given");if(t&&(t=h[t]||t),!o.detectAndImport(this.keyPair,e,t)&&void 0===t)throw Error("Key format must be specified");return this.$cache={},this},d.prototype.isPrivate=function(){return this.keyPair.isPrivate()},d.prototype.isPublic=function(e){return this.keyPair.isPublic(e)},d.prototype.isEmpty=function(e){return!(this.keyPair.n||this.keyPair.e||this.keyPair.d)},d.prototype.sign=function(e,t,i){if(!this.isPrivate())throw Error("This is not private key");var s=this.keyPair.sign(this.$getDataForEncrypt(e,i));return t&&"buffer"!=t&&(s=s.toString(t)),s},d.prototype.$getDataForEncrypt=function(e,t){if(a.isString(e)||a.isNumber(e))return s.from(""+e,t||"utf8");if(s.isBuffer(e))return e;if(a.isObject(e))return s.from(JSON.stringify(e));throw Error("Unexpected data type")},d}()},29470:function(e){e.exports={newInvalidAsn1Error:function(e){var t=new Error;return t.name="InvalidAsn1Error",t.message=e||"",t}}},42046:function(e,t,i){var s=i(29470),r=i(54275),a=i(32758);for(var n in e.exports={Reader:a},r)r.hasOwnProperty(n)&&(e.exports[n]=r[n]);for(var o in s)s.hasOwnProperty(o)&&(e.exports[o]=s[o])},32758:function(e,t,i){var s=i(48764).Buffer,r=i(48583),a=i(54275),n=i(29470).newInvalidAsn1Error;function o(e){if(!e||!s.isBuffer(e))throw new TypeError("data must be a node Buffer");this._buf=e,this._size=e.length,this._len=0,this._offset=0}Object.defineProperty(o.prototype,"length",{enumerable:!0,get:function(){return this._len}}),Object.defineProperty(o.prototype,"offset",{enumerable:!0,get:function(){return this._offset}}),Object.defineProperty(o.prototype,"remain",{get:function(){return this._size-this._offset}}),Object.defineProperty(o.prototype,"buffer",{get:function(){return this._buf.slice(this._offset)}}),o.prototype.readByte=function(e){if(this._size-this._offset<1)return null;var t=255&this._buf[this._offset];return e||(this._offset+=1),t},o.prototype.peek=function(){return this.readByte(!0)},o.prototype.readLength=function(e){if(void 0===e&&(e=this._offset),e>=this._size)return null;var t=255&this._buf[e++];if(null===t)return null;if(128==(128&t)){if(0===(t&=127))throw n("Indefinite length not supported");if(t>4)throw n("encoding too long");if(this._size-e<t)return null;this._len=0;for(var i=0;i<t;i++)this._len=(this._len<<8)+(255&this._buf[e++])}else this._len=t;return e},o.prototype.readSequence=function(e){var t=this.peek();if(null===t)return null;if(void 0!==e&&e!==t)throw n("Expected 0x"+e.toString(16)+": got 0x"+t.toString(16));var i=this.readLength(this._offset+1);return null===i?null:(this._offset=i,t)},o.prototype.readInt=function(){return this._readTag(a.Integer)},o.prototype.readBoolean=function(){return 0!==this._readTag(a.Boolean)},o.prototype.readEnumeration=function(){return this._readTag(a.Enumeration)},o.prototype.readString=function(e,t){e||(e=a.OctetString);var i=this.peek();if(null===i)return null;if(i!==e)throw n("Expected 0x"+e.toString(16)+": got 0x"+i.toString(16));var r=this.readLength(this._offset+1);if(null===r)return null;if(this.length>this._size-r)return null;if(this._offset=r,0===this.length)return t?s.alloc(0):"";var o=this._buf.slice(this._offset,this._offset+this.length);return this._offset+=this.length,t?o:o.toString("utf8")},o.prototype.readOID=function(e){e||(e=a.OID);var t=this.readString(e,!0);if(null===t)return null;for(var i=[],s=0,r=0;r<t.length;r++){var n=255&t[r];s<<=7,s+=127&n,0==(128&n)&&(i.push(s),s=0)}return s=i.shift(),i.unshift(s%40),i.unshift(s/40>>0),i.join(".")},o.prototype._readTag=function(e){r.ok(void 0!==e);var t=this.peek();if(null===t)return null;if(t!==e)throw n("Expected 0x"+e.toString(16)+": got 0x"+t.toString(16));var i=this.readLength(this._offset+1);if(null===i)return null;if(this.length>4)throw n("Integer too long: "+this.length);if(this.length>this._size-i)return null;this._offset=i;for(var s=this._buf[this._offset],a=0,o=0;o<this.length;o++)a<<=8,a|=255&this._buf[this._offset++];return 128==(128&s)&&4!==o&&(a-=1<<8*o),a>>0},e.exports=o},54275:function(e){e.exports={EOC:0,Boolean:1,Integer:2,BitString:3,OctetString:4,Null:5,OID:6,ObjectDescriptor:7,External:8,Real:9,Enumeration:10,PDV:11,Utf8String:12,RelativeOID:13,Sequence:16,Set:17,NumericString:18,PrintableString:19,T61String:20,VideotexString:21,IA5String:22,UTCTime:23,GeneralizedTime:24,GraphicString:25,VisibleString:26,GeneralString:28,UniversalString:29,CharacterString:30,BMPString:31,Constructor:32,Context:128}},4449:function(e,t,i){var s=i(42046);e.exports={Ber:s,BerReader:s.Reader}},73666:function(e,t,i){i(41147)._,i(41147);e.exports={privateExport:function(e,t){return{n:e.n.toBuffer(),e:e.e,d:e.d.toBuffer(),p:e.p.toBuffer(),q:e.q.toBuffer(),dmp1:e.dmp1.toBuffer(),dmq1:e.dmq1.toBuffer(),coeff:e.coeff.toBuffer()}},privateImport:function(e,t,i){if(!(t.n&&t.e&&t.d&&t.p&&t.q&&t.dmp1&&t.dmq1&&t.coeff))throw Error("Invalid key data");e.setPrivate(t.n,t.e,t.d,t.p,t.q,t.dmp1,t.dmq1,t.coeff)},publicExport:function(e,t){return{n:e.n.toBuffer(),e:e.e}},publicImport:function(e,t,i){if(!t.n||!t.e)throw Error("Invalid key data");e.setPublic(t.n,t.e)},autoImport:function(t,i){return!(!i.n||!i.e)&&(i.d&&i.p&&i.q&&i.dmp1&&i.dmq1&&i.coeff?(e.exports.privateImport(t,i),!0):(e.exports.publicImport(t,i),!0))}}},41917:function(e,t,i){i(41147)._;e.exports={pkcs1:i(37073),pkcs8:i(27158),components:i(73666),detectAndImport:function(t,i,s){if(void 0===s){for(var r in e.exports)if("function"==typeof e.exports[r].autoImport&&e.exports[r].autoImport(t,i))return!0}else if(s){var a=formatParse(s);if(!e.exports[a.scheme])throw Error("Unsupported key format");"private"===a.keyType?e.exports[a.scheme].privateImport(t,i,a.keyOpt):e.exports[a.scheme].publicImport(t,i,a.keyOpt)}return!1}}},37073:function(e,t,i){var s=i(48764).Buffer,r=i(4449).Ber,a=i(41147)._,n=i(41147);const o="-----BEGIN RSA PRIVATE KEY-----",h="-----END RSA PRIVATE KEY-----",d="-----BEGIN RSA PUBLIC KEY-----",c="-----END RSA PUBLIC KEY-----";e.exports={privateExport:function(e,t){t=t||{};var i=e.n.toBuffer(),s=e.d.toBuffer(),a=e.p.toBuffer(),d=e.q.toBuffer(),c=e.dmp1.toBuffer(),l=e.dmq1.toBuffer(),u=e.coeff.toBuffer(),f=i.length+s.length+a.length+d.length+c.length+l.length+u.length+512,p=new r.Writer({size:f});return p.startSequence(),p.writeInt(0),p.writeBuffer(i,2),p.writeInt(e.e),p.writeBuffer(s,2),p.writeBuffer(a,2),p.writeBuffer(d,2),p.writeBuffer(c,2),p.writeBuffer(l,2),p.writeBuffer(u,2),p.endSequence(),"der"===t.type?p.buffer:o+"\n"+n.linebrk(p.buffer.toString("base64"),64)+"\n"+h},privateImport:function(e,t,i){var d;if("der"!==(i=i||{}).type){if(s.isBuffer(t)&&(t=t.toString("utf8")),!a.isString(t))throw Error("Unsupported key format");var c=n.trimSurroundingText(t,o,h).replace(/\s+|\n\r|\n|\r$/gm,"");d=s.from(c,"base64")}else{if(!s.isBuffer(t))throw Error("Unsupported key format");d=t}var l=new r.Reader(d);l.readSequence(),l.readString(2,!0),e.setPrivate(l.readString(2,!0),l.readString(2,!0),l.readString(2,!0),l.readString(2,!0),l.readString(2,!0),l.readString(2,!0),l.readString(2,!0),l.readString(2,!0))},publicExport:function(e,t){t=t||{};var i=e.n.toBuffer(),s=i.length+512,a=new r.Writer({size:s});return a.startSequence(),a.writeBuffer(i,2),a.writeInt(e.e),a.endSequence(),"der"===t.type?a.buffer:d+"\n"+n.linebrk(a.buffer.toString("base64"),64)+"\n"+c},publicImport:function(e,t,i){var o;if("der"!==(i=i||{}).type){if(s.isBuffer(t)&&(t=t.toString("utf8")),a.isString(t)){var h=n.trimSurroundingText(t,d,c).replace(/\s+|\n\r|\n|\r$/gm,"");o=s.from(h,"base64")}}else{if(!s.isBuffer(t))throw Error("Unsupported key format");o=t}var l=new r.Reader(o);l.readSequence(),e.setPublic(l.readString(2,!0),l.readString(2,!0))},autoImport:function(t,i){return/^[\S\s]*-----BEGIN RSA PRIVATE KEY-----\s*(?=(([A-Za-z0-9+/=]+\s*)+))\1-----END RSA PRIVATE KEY-----[\S\s]*$/g.test(i)?(e.exports.privateImport(t,i),!0):!!/^[\S\s]*-----BEGIN RSA PUBLIC KEY-----\s*(?=(([A-Za-z0-9+/=]+\s*)+))\1-----END RSA PUBLIC KEY-----[\S\s]*$/g.test(i)&&(e.exports.publicImport(t,i),!0)}}},27158:function(e,t,i){var s=i(48764).Buffer,r=i(4449).Ber,a=i(41147)._,n="1.2.840.113549.1.1.1",o=i(41147);const h="-----BEGIN PRIVATE KEY-----",d="-----END PRIVATE KEY-----",c="-----BEGIN PUBLIC KEY-----",l="-----END PUBLIC KEY-----";e.exports={privateExport:function(e,t){t=t||{};var i=e.n.toBuffer(),s=e.d.toBuffer(),a=e.p.toBuffer(),c=e.q.toBuffer(),l=e.dmp1.toBuffer(),u=e.dmq1.toBuffer(),f=e.coeff.toBuffer(),p=i.length+s.length+a.length+c.length+l.length+u.length+f.length+512,m=new r.Writer({size:p});m.startSequence(),m.writeInt(0),m.writeBuffer(i,2),m.writeInt(e.e),m.writeBuffer(s,2),m.writeBuffer(a,2),m.writeBuffer(c,2),m.writeBuffer(l,2),m.writeBuffer(u,2),m.writeBuffer(f,2),m.endSequence();var g=new r.Writer({size:p});return g.startSequence(),g.writeInt(0),g.startSequence(),g.writeOID(n),g.writeNull(),g.endSequence(),g.writeBuffer(m.buffer,4),g.endSequence(),"der"===t.type?g.buffer:h+"\n"+o.linebrk(g.buffer.toString("base64"),64)+"\n"+d},privateImport:function(e,t,i){var c;if("der"!==(i=i||{}).type){if(s.isBuffer(t)&&(t=t.toString("utf8")),!a.isString(t))throw Error("Unsupported key format");var l=o.trimSurroundingText(t,h,d).replace("-----END PRIVATE KEY-----","").replace(/\s+|\n\r|\n|\r$/gm,"");c=s.from(l,"base64")}else{if(!s.isBuffer(t))throw Error("Unsupported key format");c=t}var u=new r.Reader(c);if(u.readSequence(),u.readInt(0),new r.Reader(u.readString(48,!0)).readOID(6,!0)!==n)throw Error("Invalid Public key format");var f=new r.Reader(u.readString(4,!0));f.readSequence(),f.readString(2,!0),e.setPrivate(f.readString(2,!0),f.readString(2,!0),f.readString(2,!0),f.readString(2,!0),f.readString(2,!0),f.readString(2,!0),f.readString(2,!0),f.readString(2,!0))},publicExport:function(e,t){t=t||{};var i=e.n.toBuffer(),s=i.length+512,a=new r.Writer({size:s});a.writeByte(0),a.startSequence(),a.writeBuffer(i,2),a.writeInt(e.e),a.endSequence();var h=new r.Writer({size:s});return h.startSequence(),h.startSequence(),h.writeOID(n),h.writeNull(),h.endSequence(),h.writeBuffer(a.buffer,3),h.endSequence(),"der"===t.type?h.buffer:c+"\n"+o.linebrk(h.buffer.toString("base64"),64)+"\n"+l},publicImport:function(e,t,i){var h;if("der"!==(i=i||{}).type){if(s.isBuffer(t)&&(t=t.toString("utf8")),a.isString(t)){var d=o.trimSurroundingText(t,c,l).replace(/\s+|\n\r|\n|\r$/gm,"");h=s.from(d,"base64")}}else{if(!s.isBuffer(t))throw Error("Unsupported key format");h=t}var u=new r.Reader(h);if(u.readSequence(),new r.Reader(u.readString(48,!0)).readOID(6,!0)!==n)throw Error("Invalid Public key format");var f=new r.Reader(u.readString(3,!0));f.readByte(),f.readSequence(),e.setPublic(f.readString(2,!0),f.readString(2,!0))},autoImport:function(t,i){return/^[\S\s]*-----BEGIN PRIVATE KEY-----\s*(?=(([A-Za-z0-9+/=]+\s*)+))\1-----END PRIVATE KEY-----[\S\s]*$/g.test(i)?(e.exports.privateImport(t,i),!0):!!/^[\S\s]*-----BEGIN PUBLIC KEY-----\s*(?=(([A-Za-z0-9+/=]+\s*)+))\1-----END PUBLIC KEY-----[\S\s]*$/g.test(i)&&(e.exports.publicImport(t,i),!0)}}},28446:function(e,t,i){var s=i(48764).Buffer,r=i(41147)._;function a(e,t){null!=e&&("number"==typeof e?this.fromNumber(e,t):s.isBuffer(e)?this.fromBuffer(e):null==t&&"string"!=typeof e?this.fromByteArray(e):this.fromString(e,t))}function n(){return new a(null)}a.prototype.am=function(e,t,i,s,r,a){for(var n=16383&t,o=t>>14;--a>=0;){var h=16383&this[e],d=this[e++]>>14,c=o*h+d*n;r=((h=n*h+((16383&c)<<14)+i[s]+r)>>28)+(c>>14)+o*d,i[s++]=268435455&h}return r},a.prototype.DB=28,a.prototype.DM=268435455,a.prototype.DV=1<<28;a.prototype.FV=Math.pow(2,52),a.prototype.F1=24,a.prototype.F2=4;var o,h,d=new Array;for(o="0".charCodeAt(0),h=0;h<=9;++h)d[o++]=h;for(o="a".charCodeAt(0),h=10;h<36;++h)d[o++]=h;for(o="A".charCodeAt(0),h=10;h<36;++h)d[o++]=h;function c(e){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(e)}function l(e,t){var i=d[e.charCodeAt(t)];return null==i?-1:i}function u(e){var t=n();return t.fromInt(e),t}function f(e){var t,i=1;return 0!=(t=e>>>16)&&(e=t,i+=16),0!=(t=e>>8)&&(e=t,i+=8),0!=(t=e>>4)&&(e=t,i+=4),0!=(t=e>>2)&&(e=t,i+=2),0!=(t=e>>1)&&(e=t,i+=1),i}function p(e){this.m=e}function m(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function g(e,t){return e&t}function y(e,t){return e|t}function b(e,t){return e^t}function v(e){if(0===e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function w(){}function S(e){return e}function k(e){this.r2=n(),this.q3=n(),a.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}p.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},p.prototype.revert=function(e){return e},p.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},p.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},p.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},m.prototype.convert=function(e){var t=n();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(a.ZERO)>0&&this.m.subTo(t,t),t},m.prototype.revert=function(e){var t=n();return e.copyTo(t),this.reduce(t),t},m.prototype.reduce=function(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(var t=0;t<this.m.t;++t){var i=32767&e[t],s=i*this.mpl+((i*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(e[i=t+this.m.t]+=this.m.am(0,s,e,t,0,this.m.t);e[i]>=e.DV;)e[i]-=e.DV,e[++i]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},m.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},m.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},w.prototype.convert=S,w.prototype.revert=S,w.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i)},w.prototype.sqrTo=function(e,t){e.squareTo(t)},k.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=n();return e.copyTo(t),this.reduce(t),t},k.prototype.revert=function(e){return e},k.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},k.prototype.mulTo=function(e,t,i){e.multiplyTo(t,i),this.reduce(i)},k.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},a.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s},a.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+DV:this.t=0},a.prototype.fromString=function(e,t,i){var s;switch(t){case 2:s=1;break;case 4:s=2;break;case 8:s=3;break;case 16:s=4;break;case 32:s=5;break;case 256:s=8;break;default:return void this.fromRadix(e,t)}this.t=0,this.s=0;for(var r=e.length,n=!1,o=0;--r>=0;){var h=8==s?255&e[r]:l(e,r);h<0?"-"==e.charAt(r)&&(n=!0):(n=!1,0===o?this[this.t++]=h:o+s>this.DB?(this[this.t-1]|=(h&(1<<this.DB-o)-1)<<o,this[this.t++]=h>>this.DB-o):this[this.t-1]|=h<<o,(o+=s)>=this.DB&&(o-=this.DB))}i||8!=s||0==(128&e[0])||(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),n&&a.ZERO.subTo(this,this)},a.prototype.fromByteArray=function(e,t){this.fromString(e,256,t)},a.prototype.fromBuffer=function(e){this.fromString(e,256,!0)},a.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this[this.t-1]==e;)--this.t},a.prototype.dlShiftTo=function(e,t){var i;for(i=this.t-1;i>=0;--i)t[i+e]=this[i];for(i=e-1;i>=0;--i)t[i]=0;t.t=this.t+e,t.s=this.s},a.prototype.drShiftTo=function(e,t){for(var i=e;i<this.t;++i)t[i-e]=this[i];t.t=Math.max(this.t-e,0),t.s=this.s},a.prototype.lShiftTo=function(e,t){var i,s=e%this.DB,r=this.DB-s,a=(1<<r)-1,n=Math.floor(e/this.DB),o=this.s<<s&this.DM;for(i=this.t-1;i>=0;--i)t[i+n+1]=this[i]>>r|o,o=(this[i]&a)<<s;for(i=n-1;i>=0;--i)t[i]=0;t[n]=o,t.t=this.t+n+1,t.s=this.s,t.clamp()},a.prototype.rShiftTo=function(e,t){t.s=this.s;var i=Math.floor(e/this.DB);if(i>=this.t)t.t=0;else{var s=e%this.DB,r=this.DB-s,a=(1<<s)-1;t[0]=this[i]>>s;for(var n=i+1;n<this.t;++n)t[n-i-1]|=(this[n]&a)<<r,t[n-i]=this[n]>>s;s>0&&(t[this.t-i-1]|=(this.s&a)<<r),t.t=this.t-i,t.clamp()}},a.prototype.subTo=function(e,t){for(var i=0,s=0,r=Math.min(e.t,this.t);i<r;)s+=this[i]-e[i],t[i++]=s&this.DM,s>>=this.DB;if(e.t<this.t){for(s-=e.s;i<this.t;)s+=this[i],t[i++]=s&this.DM,s>>=this.DB;s+=this.s}else{for(s+=this.s;i<e.t;)s-=e[i],t[i++]=s&this.DM,s>>=this.DB;s-=e.s}t.s=s<0?-1:0,s<-1?t[i++]=this.DV+s:s>0&&(t[i++]=s),t.t=i,t.clamp()},a.prototype.multiplyTo=function(e,t){var i=this.abs(),s=e.abs(),r=i.t;for(t.t=r+s.t;--r>=0;)t[r]=0;for(r=0;r<s.t;++r)t[r+i.t]=i.am(0,s[r],t,r,0,i.t);t.s=0,t.clamp(),this.s!=e.s&&a.ZERO.subTo(t,t)},a.prototype.squareTo=function(e){for(var t=this.abs(),i=e.t=2*t.t;--i>=0;)e[i]=0;for(i=0;i<t.t-1;++i){var s=t.am(i,t[i],e,2*i,0,1);(e[i+t.t]+=t.am(i+1,2*t[i],e,2*i+1,s,t.t-i-1))>=t.DV&&(e[i+t.t]-=t.DV,e[i+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(i,t[i],e,2*i,0,1)),e.s=0,e.clamp()},a.prototype.divRemTo=function(e,t,i){var s=e.abs();if(!(s.t<=0)){var r=this.abs();if(r.t<s.t)return null!=t&&t.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=n());var o=n(),h=this.s,d=e.s,c=this.DB-f(s[s.t-1]);c>0?(s.lShiftTo(c,o),r.lShiftTo(c,i)):(s.copyTo(o),r.copyTo(i));var l=o.t,u=o[l-1];if(0!==u){var p=u*(1<<this.F1)+(l>1?o[l-2]>>this.F2:0),m=this.FV/p,g=(1<<this.F1)/p,y=1<<this.F2,b=i.t,v=b-l,w=null==t?n():t;for(o.dlShiftTo(v,w),i.compareTo(w)>=0&&(i[i.t++]=1,i.subTo(w,i)),a.ONE.dlShiftTo(l,w),w.subTo(o,o);o.t<l;)o[o.t++]=0;for(;--v>=0;){var S=i[--b]==u?this.DM:Math.floor(i[b]*m+(i[b-1]+y)*g);if((i[b]+=o.am(0,S,i,v,0,l))<S)for(o.dlShiftTo(v,w),i.subTo(w,i);i[b]<--S;)i.subTo(w,i)}null!=t&&(i.drShiftTo(l,t),h!=d&&a.ZERO.subTo(t,t)),i.t=l,i.clamp(),c>0&&i.rShiftTo(c,i),h<0&&a.ZERO.subTo(i,i)}}},a.prototype.invDigit=function(){if(this.t<1)return 0;var e=this[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},a.prototype.isEven=function(){return 0===(this.t>0?1&this[0]:this.s)},a.prototype.exp=function(e,t){if(e>4294967295||e<1)return a.ONE;var i=n(),s=n(),r=t.convert(this),o=f(e)-1;for(r.copyTo(i);--o>=0;)if(t.sqrTo(i,s),(e&1<<o)>0)t.mulTo(s,r,i);else{var h=i;i=s,s=h}return t.revert(i)},a.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},a.prototype.toRadix=function(e){if(null==e&&(e=10),0===this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),i=Math.pow(e,t),s=u(i),r=n(),a=n(),o="";for(this.divRemTo(s,r,a);r.signum()>0;)o=(i+a.intValue()).toString(e).substr(1)+o,r.divRemTo(s,r,a);return a.intValue().toString(e)+o},a.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var i=this.chunkSize(t),s=Math.pow(t,i),r=!1,n=0,o=0,h=0;h<e.length;++h){var d=l(e,h);d<0?"-"==e.charAt(h)&&0===this.signum()&&(r=!0):(o=t*o+d,++n>=i&&(this.dMultiply(s),this.dAddOffset(o,0),n=0,o=0))}n>0&&(this.dMultiply(Math.pow(t,n)),this.dAddOffset(o,0)),r&&a.ZERO.subTo(this,this)},a.prototype.bitwiseTo=function(e,t,i){var s,r,a=Math.min(e.t,this.t);for(s=0;s<a;++s)i[s]=t(this[s],e[s]);if(e.t<this.t){for(r=e.s&this.DM,s=a;s<this.t;++s)i[s]=t(this[s],r);i.t=this.t}else{for(r=this.s&this.DM,s=a;s<e.t;++s)i[s]=t(r,e[s]);i.t=e.t}i.s=t(this.s,e.s),i.clamp()},a.prototype.addTo=function(e,t){for(var i=0,s=0,r=Math.min(e.t,this.t);i<r;)s+=this[i]+e[i],t[i++]=s&this.DM,s>>=this.DB;if(e.t<this.t){for(s+=e.s;i<this.t;)s+=this[i],t[i++]=s&this.DM,s>>=this.DB;s+=this.s}else{for(s+=this.s;i<e.t;)s+=e[i],t[i++]=s&this.DM,s>>=this.DB;s+=e.s}t.s=s<0?-1:0,s>0?t[i++]=s:s<-1&&(t[i++]=this.DV+s),t.t=i,t.clamp()},a.prototype.dMultiply=function(e){this[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},a.prototype.dAddOffset=function(e,t){if(0!==e){for(;this.t<=t;)this[this.t++]=0;for(this[t]+=e;this[t]>=this.DV;)this[t]-=this.DV,++t>=this.t&&(this[this.t++]=0),++this[t]}},a.prototype.multiplyLowerTo=function(e,t,i){var s,r=Math.min(this.t+e.t,t);for(i.s=0,i.t=r;r>0;)i[--r]=0;for(s=i.t-this.t;r<s;++r)i[r+this.t]=this.am(0,e[r],i,r,0,this.t);for(s=Math.min(e.t,t);r<s;++r)this.am(0,e[r],i,r,0,t-r);i.clamp()},a.prototype.multiplyUpperTo=function(e,t,i){--t;var s=i.t=this.t+e.t-t;for(i.s=0;--s>=0;)i[s]=0;for(s=Math.max(t-this.t,0);s<e.t;++s)i[this.t+s-t]=this.am(t-s,e[s],i,0,0,this.t+s-t);i.clamp(),i.drShiftTo(1,i)},a.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var i,s=(1<<t)-1,r=!1,a="",n=this.t,o=this.DB-n*this.DB%t;if(n-- >0)for(o<this.DB&&(i=this[n]>>o)>0&&(r=!0,a=c(i));n>=0;)o<t?(i=(this[n]&(1<<o)-1)<<t-o,i|=this[--n]>>(o+=this.DB-t)):(i=this[n]>>(o-=t)&s,o<=0&&(o+=this.DB,--n)),i>0&&(r=!0),r&&(a+=c(i));return r?a:"0"},a.prototype.negate=function(){var e=n();return a.ZERO.subTo(this,e),e},a.prototype.abs=function(){return this.s<0?this.negate():this},a.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var i=this.t;if(0!=(t=i-e.t))return this.s<0?-t:t;for(;--i>=0;)if(0!=(t=this[i]-e[i]))return t;return 0},a.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+f(this[this.t-1]^this.s&this.DM)},a.prototype.mod=function(e){var t=n();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(a.ZERO)>0&&e.subTo(t,t),t},a.prototype.clone=function(){var e=n();return this.copyTo(e),e},a.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0===this.t)return-1}else{if(1==this.t)return this[0];if(0===this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},a.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},a.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var i,s=this.DB-e*this.DB%8,r=0;if(e-- >0)for(s<this.DB&&(i=this[e]>>s)!=(this.s&this.DM)>>s&&(t[r++]=i|this.s<<this.DB-s);e>=0;)s<8?(i=(this[e]&(1<<s)-1)<<8-s,i|=this[--e]>>(s+=this.DB-8)):(i=this[e]>>(s-=8)&255,s<=0&&(s+=this.DB,--e)),0!=(128&i)&&(i|=-256),0===r&&(128&this.s)!=(128&i)&&++r,(r>0||i!=this.s)&&(t[r++]=i);return t},a.prototype.toBuffer=function(e){var t=s.from(this.toByteArray());if(!0===e&&0===t[0])t=t.slice(1);else if(r.isNumber(e)){if(t.length>e){for(var i=0;i<t.length-e;i++)if(0!==t[i])return null;return t.slice(t.length-e)}if(t.length<e){var a=s.alloc(e);return a.fill(0,0,e-t.length),t.copy(a,e-t.length),a}}return t},a.prototype.equals=function(e){return 0==this.compareTo(e)},a.prototype.min=function(e){return this.compareTo(e)<0?this:e},a.prototype.max=function(e){return this.compareTo(e)>0?this:e},a.prototype.and=function(e){var t=n();return this.bitwiseTo(e,g,t),t},a.prototype.or=function(e){var t=n();return this.bitwiseTo(e,y,t),t},a.prototype.xor=function(e){var t=n();return this.bitwiseTo(e,b,t),t},a.prototype.not=function(){for(var e=n(),t=0;t<this.t;++t)e[t]=this.DM&~this[t];return e.t=this.t,e.s=~this.s,e},a.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this[e])return e*this.DB+v(this[e]);return this.s<0?this.t*this.DB:-1},a.prototype.add=function(e){var t=n();return this.addTo(e,t),t},a.prototype.subtract=function(e){var t=n();return this.subTo(e,t),t},a.prototype.multiply=function(e){var t=n();return this.multiplyTo(e,t),t},a.prototype.divide=function(e){var t=n();return this.divRemTo(e,t,null),t},a.prototype.remainder=function(e){var t=n();return this.divRemTo(e,null,t),t},a.prototype.modPow=function(e,t){var i,s,r=e.bitLength(),a=u(1);if(r<=0)return a;i=r<18?1:r<48?3:r<144?4:r<768?5:6,s=r<8?new p(t):t.isEven()?new k(t):new m(t);var o=new Array,h=3,d=i-1,c=(1<<i)-1;if(o[1]=s.convert(this),i>1){var l=n();for(s.sqrTo(o[1],l);h<=c;)o[h]=n(),s.mulTo(l,o[h-2],o[h]),h+=2}var g,y,b=e.t-1,v=!0,w=n();for(r=f(e[b])-1;b>=0;){for(r>=d?g=e[b]>>r-d&c:(g=(e[b]&(1<<r+1)-1)<<d-r,b>0&&(g|=e[b-1]>>this.DB+r-d)),h=i;0==(1&g);)g>>=1,--h;if((r-=h)<0&&(r+=this.DB,--b),v)o[g].copyTo(a),v=!1;else{for(;h>1;)s.sqrTo(a,w),s.sqrTo(w,a),h-=2;h>0?s.sqrTo(a,w):(y=a,a=w,w=y),s.mulTo(w,o[g],a)}for(;b>=0&&0==(e[b]&1<<r);)s.sqrTo(a,w),y=a,a=w,w=y,--r<0&&(r=this.DB-1,--b)}return s.revert(a)},a.prototype.pow=function(e){return this.exp(e,new w)},a.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),i=e.s<0?e.negate():e.clone();if(t.compareTo(i)<0){var s=t;t=i,i=s}var r=t.getLowestSetBit(),a=i.getLowestSetBit();if(a<0)return t;for(r<a&&(a=r),a>0&&(t.rShiftTo(a,t),i.rShiftTo(a,i));t.signum()>0;)(r=t.getLowestSetBit())>0&&t.rShiftTo(r,t),(r=i.getLowestSetBit())>0&&i.rShiftTo(r,i),t.compareTo(i)>=0?(t.subTo(i,t),t.rShiftTo(1,t)):(i.subTo(t,i),i.rShiftTo(1,i));return a>0&&i.lShiftTo(a,i),i},a.int2char=c,a.ZERO=u(0),a.ONE=u(1),a.prototype.square=function(){var e=n();return this.squareTo(e),e},e.exports=a},939:function(e,t,i){var s=i(41147)._,r=i(28446),a=i(41147),n=i(48173);e.exports.Key=function(){function e(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}return e.prototype.setOptions=function(e){var t=n[e.signingScheme],i=n[e.encryptionScheme];t===i?this.signingScheme=this.encryptionScheme=i.makeScheme(this,e):(this.encryptionScheme=i.makeScheme(this,e),this.signingScheme=t.makeScheme(this,e))},e.prototype.setPrivate=function(e,t,i,n,o,h,d,c){if(!(e&&t&&i&&e.length>0&&(s.isNumber(t)||t.length>0)&&i.length>0))throw Error("Invalid RSA private key");this.n=new r(e),this.e=s.isNumber(t)?t:a.get32IntFromBuffer(t,0),this.d=new r(i),n&&o&&h&&d&&c&&(this.p=new r(n),this.q=new r(o),this.dmp1=new r(h),this.dmq1=new r(d),this.coeff=new r(c)),this.$$recalculateCache()},e.prototype.$doPrivate=function(e){if(this.p||this.q)return e.modPow(this.d,this.n);for(var t=e.mod(this.p).modPow(this.dmp1,this.p),i=e.mod(this.q).modPow(this.dmq1,this.q);t.compareTo(i)<0;)t=t.add(this.p);return t.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)},e.prototype.sign=function(e){return this.signingScheme.sign.apply(this.signingScheme,arguments)},e.prototype.isPrivate=function(){return this.n&&this.e&&this.d||!1},Object.defineProperty(e.prototype,"keySize",{get:function(){return this.cache.keyBitLength}}),Object.defineProperty(e.prototype,"encryptedDataLength",{get:function(){return this.cache.keyByteLength}}),Object.defineProperty(e.prototype,"maxMessageLength",{get:function(){return this.encryptionScheme.maxMessageLength()}}),e.prototype.$$recalculateCache=function(){this.cache=this.cache||{},this.cache.keyBitLength=this.n.bitLength(),this.cache.keyByteLength=this.cache.keyBitLength+6>>3},e}()},93679:function(e,t,i){var s=i(48764).Buffer,r=i(28446),a=i(27295),n=3;i(83208);var o={md2:s.from("3020300c06082a864886f70d020205000410","hex"),md5:s.from("3020300c06082a864886f70d020505000410","hex"),sha1:s.from("3021300906052b0e03021a05000414","hex"),sha224:s.from("302d300d06096086480165030402040500041c","hex"),sha256:s.from("3031300d060960864801650304020105000420","hex"),sha384:s.from("3041300d060960864801650304020205000430","hex"),sha512:s.from("3051300d060960864801650304020305000440","hex"),ripemd160:s.from("3021300906052b2403020105000414","hex"),rmd160:s.from("3021300906052b2403020105000414","hex")},h={ripemd160:"rmd160"};function d(e,t){var i=[];return t>0&&i.push(e>>>24),t>1&&i.push(e>>>16&255),t>2&&i.push(e>>>8&255),t>3&&i.push(255&e),i}e.exports={isEncryption:!0,isSignature:!0},e.exports.makeScheme=function(e,t){function i(e,t){this.key=e,this.options=t}return i.prototype.maxMessageLength=function(){return this.options.encryptionSchemeOptions&&this.options.encryptionSchemeOptions.padding==n?this.key.encryptedDataLength:this.key.encryptedDataLength-11},i.prototype.encUnPad=function(e,t){t=t||{};var i=0;if(this.options.encryptionSchemeOptions&&this.options.encryptionSchemeOptions.padding==n)return"function"==typeof e.lastIndexOf?e.slice(e.lastIndexOf("\0")+1,e.length):e.slice(String.prototype.lastIndexOf.call(e,"\0")+1,e.length);if(e.length<4)return null;if(1===t.type){if(0!==e[0]&&1!==e[1])return null;for(i=3;0!==e[i];)if(255!=e[i]||++i>=e.length)return null}else{if(0!==e[0]&&2!==e[1])return null;for(i=3;0!==e[i];)if(++i>=e.length)return null}return e.slice(i+1,e.length)},i.prototype.sign=function(e){var t=this.options.signingSchemeOptions.hash||"sha256";if("browser"===this.options.environment){var i=function(e){let t;if(!e.hasOwnProperty("sigBytes")||!e.hasOwnProperty("words"))throw Error("Argument not a wordArray");t=e.sigBytes,e=e.words;const i=[];let r=[],a=0;for(;t>0;)r=d(e[a],Math.min(4,t)),t-=r.length,i.push(r),a++;return new s.from([].concat.apply([],i),"hex")}(a[(t=h[t]||t).toUpperCase()](e.toString())),n=this.pkcs1pad(i,t);return this.key.$doPrivate(new r(n)).toBuffer(this.key.encryptedDataLength)}throw new Error("CCXT only supports browser mode :P")},i.prototype.pkcs1pad=function(e,t){var i=o[t];if(!i)throw Error("Unsupported hash algorithm");var r=s.concat([i,e]);if(r.length+10>this.key.encryptedDataLength)throw Error("Key is too short for signing algorithm ("+t+")");var a=s.alloc(this.key.encryptedDataLength-r.length-1);return a.fill(255,0,a.length-1),a[0]=1,a[a.length-1]=0,s.concat([a,r])},new i(e,t)}},48173:function(e,t,i){e.exports={pkcs1:i(93679),isEncryption:function(t){return e.exports[t]&&e.exports[t].isEncryption},isSignature:function(t){return e.exports[t]&&e.exports[t].isSignature}}},41147:function(e){e.exports.linebrk=function(e,t){for(var i="",s=0;s+t<e.length;)i+=e.substring(s,s+t)+"\n",s+=t;return i+e.substring(s,e.length)},e.exports.get32IntFromBuffer=function(e,t){t=t||0;var i;if((i=e.length-t)>0){if(i>=4)return e.readUInt32BE(t);for(var s=0,r=t+i,a=0;r>t;r--,a+=2)s+=e[r-1]*Math.pow(16,a);return s}return NaN},e.exports._={isObject:function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)},isString:function(e){return"string"==typeof e||e instanceof String},isNumber:function(e){return"number"==typeof e||!isNaN(parseFloat(e))&&isFinite(e)},omit:function(e,t){var i={};for(var s in e)e.hasOwnProperty(s)&&s!==t&&(i[s]=e[s]);return i}},e.exports.trimSurroundingText=function(e,t,i){var s=0,r=e.length,a=e.indexOf(t);a>=0&&(s=a+t.length);var n=e.indexOf(i,a);return n>=0&&(r=n),e.substring(s,r)}},57539:function(e){"use strict";var t=String.prototype.replace,i=/%20/g;e.exports={default:"RFC3986",formatters:{RFC1738:function(e){return t.call(e,i,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},84106:function(e,t,i){"use strict";var s=i(68633),r=i(58006),a=i(57539);e.exports={formats:a,parse:r,stringify:s}},58006:function(e,t,i){"use strict";var s=i(48578),r=Object.prototype.hasOwnProperty,a={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:s.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},n=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},o=function(e,t,i){if(e){var s=i.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,a=/(\[[^[\]]*])/g,n=/(\[[^[\]]*])/.exec(s),o=n?s.slice(0,n.index):s,h=[];if(o){if(!i.plainObjects&&r.call(Object.prototype,o)&&!i.allowPrototypes)return;h.push(o)}for(var d=0;null!==(n=a.exec(s))&&d<i.depth;){if(d+=1,!i.plainObjects&&r.call(Object.prototype,n[1].slice(1,-1))&&!i.allowPrototypes)return;h.push(n[1])}return n&&h.push("["+s.slice(n.index)+"]"),function(e,t,i){for(var s=t,r=e.length-1;r>=0;--r){var a,n=e[r];if("[]"===n&&i.parseArrays)a=[].concat(s);else{a=i.plainObjects?Object.create(null):{};var o="["===n.charAt(0)&&"]"===n.charAt(n.length-1)?n.slice(1,-1):n,h=parseInt(o,10);i.parseArrays||""!==o?!isNaN(h)&&n!==o&&String(h)===o&&h>=0&&i.parseArrays&&h<=i.arrayLimit?(a=[])[h]=s:a[o]=s:a={0:s}}s=a}return s}(h,t,i)}};e.exports=function(e,t){var i=function(e){if(!e)return a;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new Error("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?a.charset:e.charset;return{allowDots:void 0===e.allowDots?a.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:a.allowPrototypes,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:a.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:a.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:a.comma,decoder:"function"==typeof e.decoder?e.decoder:a.decoder,delimiter:"string"==typeof e.delimiter||s.isRegExp(e.delimiter)?e.delimiter:a.delimiter,depth:"number"==typeof e.depth?e.depth:a.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:a.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:a.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:a.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:a.strictNullHandling}}(t);if(""===e||null==e)return i.plainObjects?Object.create(null):{};for(var h="string"==typeof e?function(e,t){var i,o={},h=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,d=t.parameterLimit===1/0?void 0:t.parameterLimit,c=h.split(t.delimiter,d),l=-1,u=t.charset;if(t.charsetSentinel)for(i=0;i<c.length;++i)0===c[i].indexOf("utf8=")&&("utf8=%E2%9C%93"===c[i]?u="utf-8":"utf8=%26%2310003%3B"===c[i]&&(u="iso-8859-1"),l=i,i=c.length);for(i=0;i<c.length;++i)if(i!==l){var f,p,m=c[i],g=m.indexOf("]="),y=-1===g?m.indexOf("="):g+1;-1===y?(f=t.decoder(m,a.decoder,u),p=t.strictNullHandling?null:""):(f=t.decoder(m.slice(0,y),a.decoder,u),p=t.decoder(m.slice(y+1),a.decoder,u)),p&&t.interpretNumericEntities&&"iso-8859-1"===u&&(p=n(p)),p&&t.comma&&p.indexOf(",")>-1&&(p=p.split(",")),r.call(o,f)?o[f]=s.combine(o[f],p):o[f]=p}return o}(e,i):e,d=i.plainObjects?Object.create(null):{},c=Object.keys(h),l=0;l<c.length;++l){var u=c[l],f=o(u,h[u],i);d=s.merge(d,f,i)}return s.compact(d)}},68633:function(e,t,i){"use strict";var s=i(48578),r=i(57539),a=Object.prototype.hasOwnProperty,n={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},o=Array.isArray,h=Array.prototype.push,d=function(e,t){h.apply(e,o(t)?t:[t])},c=Date.prototype.toISOString,l={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:s.encode,encodeValuesOnly:!1,formatter:r.formatters[r.default],indices:!1,serializeDate:function(e){return c.call(e)},skipNulls:!1,strictNullHandling:!1},u=function e(t,i,r,a,n,h,c,u,f,p,m,g,y){var b=t;if("function"==typeof c?b=c(i,b):b instanceof Date?b=p(b):"comma"===r&&o(b)&&(b=b.join(",")),null===b){if(a)return h&&!g?h(i,l.encoder,y):i;b=""}if("string"==typeof b||"number"==typeof b||"boolean"==typeof b||s.isBuffer(b))return h?[m(g?i:h(i,l.encoder,y))+"="+m(h(b,l.encoder,y))]:[m(i)+"="+m(String(b))];var v,w=[];if(void 0===b)return w;if(o(c))v=c;else{var S=Object.keys(b);v=u?S.sort(u):S}for(var k=0;k<v.length;++k){var T=v[k];n&&null===b[T]||(o(b)?d(w,e(b[T],"function"==typeof r?r(i,T):i,r,a,n,h,c,u,f,p,m,g,y)):d(w,e(b[T],i+(f?"."+T:"["+T+"]"),r,a,n,h,c,u,f,p,m,g,y)))}return w};e.exports=function(e,t){var i,s=e,h=function(e){if(!e)return l;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||l.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=r.default;if(void 0!==e.format){if(!a.call(r.formatters,e.format))throw new TypeError("Unknown format option provided.");i=e.format}var s=r.formatters[i],n=l.filter;return("function"==typeof e.filter||o(e.filter))&&(n=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:l.addQueryPrefix,allowDots:void 0===e.allowDots?l.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:l.charsetSentinel,delimiter:void 0===e.delimiter?l.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:l.encode,encoder:"function"==typeof e.encoder?e.encoder:l.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:l.encodeValuesOnly,filter:n,formatter:s,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:l.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:l.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:l.strictNullHandling}}(t);"function"==typeof h.filter?s=(0,h.filter)("",s):o(h.filter)&&(i=h.filter);var c,f=[];if("object"!=typeof s||null===s)return"";c=t&&t.arrayFormat in n?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var p=n[c];i||(i=Object.keys(s)),h.sort&&i.sort(h.sort);for(var m=0;m<i.length;++m){var g=i[m];h.skipNulls&&null===s[g]||d(f,u(s[g],g,p,h.strictNullHandling,h.skipNulls,h.encode?h.encoder:null,h.filter,h.sort,h.allowDots,h.serializeDate,h.formatter,h.encodeValuesOnly,h.charset))}var y=f.join(h.delimiter),b=!0===h.addQueryPrefix?"?":"";return h.charsetSentinel&&("iso-8859-1"===h.charset?b+="utf8=%26%2310003%3B&":b+="utf8=%E2%9C%93&"),y.length>0?b+y:""}},48578:function(e){"use strict";var t=Object.prototype.hasOwnProperty,i=Array.isArray,s=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),r=function(e,t){for(var i=t&&t.plainObjects?Object.create(null):{},s=0;s<e.length;++s)void 0!==e[s]&&(i[s]=e[s]);return i};e.exports={arrayToObject:r,assign:function(e,t){return Object.keys(t).reduce((function(e,i){return e[i]=t[i],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],s=[],r=0;r<t.length;++r)for(var a=t[r],n=a.obj[a.prop],o=Object.keys(n),h=0;h<o.length;++h){var d=o[h],c=n[d];"object"==typeof c&&null!==c&&-1===s.indexOf(c)&&(t.push({obj:n,prop:d}),s.push(c))}return function(e){for(;e.length>1;){var t=e.pop(),s=t.obj[t.prop];if(i(s)){for(var r=[],a=0;a<s.length;++a)void 0!==s[a]&&r.push(s[a]);t.obj[t.prop]=r}}}(t),e},decode:function(e,t,i){var s=e.replace(/\+/g," ");if("iso-8859-1"===i)return s.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(s)}catch(e){return s}},encode:function(e,t,i){if(0===e.length)return e;var r="string"==typeof e?e:String(e);if("iso-8859-1"===i)return escape(r).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var a="",n=0;n<r.length;++n){var o=r.charCodeAt(n);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?a+=r.charAt(n):o<128?a+=s[o]:o<2048?a+=s[192|o>>6]+s[128|63&o]:o<55296||o>=57344?a+=s[224|o>>12]+s[128|o>>6&63]+s[128|63&o]:(n+=1,o=65536+((1023&o)<<10|1023&r.charCodeAt(n)),a+=s[240|o>>18]+s[128|o>>12&63]+s[128|o>>6&63]+s[128|63&o])}return a},isBuffer:function(e){return!(!e||"object"!=typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(s,a,n){if(!a)return s;if("object"!=typeof a){if(i(s))s.push(a);else{if(!s||"object"!=typeof s)return[s,a];(n&&(n.plainObjects||n.allowPrototypes)||!t.call(Object.prototype,a))&&(s[a]=!0)}return s}if(!s||"object"!=typeof s)return[s].concat(a);var o=s;return i(s)&&!i(a)&&(o=r(s,n)),i(s)&&i(a)?(a.forEach((function(i,r){if(t.call(s,r)){var a=s[r];a&&"object"==typeof a&&i&&"object"==typeof i?s[r]=e(a,i,n):s.push(i)}else s[r]=i})),s):Object.keys(a).reduce((function(i,s){var r=a[s];return t.call(i,s)?i[s]=e(i[s],r,n):i[s]=r,i}),o)}}},80842:function(e,t,i){"use strict";const s=i(48819),{ArgumentsRequired:r,AuthenticationError:a,ExchangeError:n,InsufficientFunds:o,OrderNotFound:h,PermissionDenied:d,BadRequest:c,BadSymbol:l,DDoSProtection:u,InvalidOrder:f,AccountSuspended:p}=i(73449),{TICK_SIZE:m}=i(62115),g=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"stex",name:"STEX",countries:["EE"],rateLimit:1e3/3,certified:!1,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelAllOrders:!0,cancelOrder:!0,createDepositAddress:!0,createMarketOrder:!1,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrder:!0,fetchCurrencies:!0,fetchDeposit:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderTrades:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!1,fetchTransactionFees:!0,fetchWithdrawal:!0,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!0,withdraw:!0},version:"v3",urls:{logo:"https://user-images.githubusercontent.com/1294454/69680782-03fd0b80-10bd-11ea-909e-7f603500e9cc.jpg",api:{rest:"https://api3.stex.com"},www:"https://www.stex.com",doc:["https://apidocs.stex.com/","https://help.stex.com/en/collections/1593608-api-v3-documentation"],fees:"https://app.stex.com/en/pairs-specification",referral:"https://app.stex.com?ref=36416021"},requiredCredentials:{apiKey:!1,secret:!1,token:!0},timeframes:{"1m":"1","5m":"5","30m":"30","1h":"60","4h":"240","12h":"720","1d":"1D"},api:{public:{get:{currencies:1,"currencies/{currencyId}":1,markets:1,"pairs-groups":1,"currency_pairs/list/{code}":1,"currency_pairs/group/{currencyPairGroupId}":1,"currency_pairs/{currencyPairId}":1,ticker:1,"ticker/{currencyPairId}":1,"trades/{currencyPairId}":1,"orderbook/{currencyPairId}":1,"chart/{currencyPairId}/{candlesType}":1,"deposit-statuses":1,"deposit-statuses/{statusId}":1,"withdrawal-statuses":1,"withdrawal-statuses/{statusId}":1,ping:1,"mobile-versions":1,twitter:1}},trading:{get:{"fees/{currencyPairId}":1,orders:12,"orders/{currencyPairId}":6,"order/{orderId}":12},post:{"orders/{currencyPairId}":1.5,"orders/bulk/{currencyPairId}":12},delete:{orders:30,"orders/{currencyPairId}":12,"order/{orderId}":1.5}},reports:{get:{currencies:12,currency_pairs:12,orders:12,"orders/{orderId}":12,"trades/{currencyPairId}":12,"background/{listMode}":12,"background/{id}":12,"background/download/{id}":12},post:{"background/create":12},delete:{"background/{id}":12}},profile:{get:{info:3,wallets:3,"wallets/{walletId}":3,"wallets/address/{walletId}":3,deposits:3,"deposits/{id}":3,rewards:3,"rewards/{id}":3,addressbook:3,"addressbook/{itemId}":3,withdrawals:3,"withdrawals/{id}":3,notifications:3,"notifications/price":3,"favorite/currency_pairs":3,"token-scopes":3},post:{"wallets/burn/{walletId}":3,"wallets/{walletId}/hold_amount":3,"wallets/{currencyId}":3,"wallets/address/{walletId}":3,"addressbook/disable_item/{itemId}":3,"addressbook/enable_item/{itemId}":3,"addressbook/enable_strict_wd":3,"addressbook/disable_strict_wd":3,withdraw:30,"notifications/price":3,"referral/program":3,"referral/insert/{code}":3,"referral/bonus_transfer/{currencyId}":3},put:{"favorite/currency_pairs/set":3},delete:{"addressbook/{itemId}":3,"withdraw/{withdrawalId}":30,"notifications/price/{priceAlertId}":3}},verification:{get:{countries:1,status:1,"fractal/url":1,"smart-id":1,stex:1,"cryptonomica/code":1},post:{"smart-id":1,stex:1,cryptonomica:1}},settings:{get:{"notifications/{event}":1,notifications:1},put:{notifications:1,"notifications/set":1}}},fees:{trading:{tierBased:!1,percentage:!0,taker:this.parseNumber("0.002"),maker:this.parseNumber("0.002")}},commonCurrencies:{BC:"Bitcoin Confidential",BITS:"Bitcoinus",BITSW:"BITS",BHD:"Bithold",BTH:"Bithereum",MPH:"Chasyr Token",SBTC:"SBTCT"},options:{parseOrderToPrecision:!1,networks:{ERC20:5,ETH:5,OMNI:10,XLM:20,BEP2:22,TRC20:24,TRX:24,SOL:25,BEP20:501},accountsByType:{spot:"spot",hold:"hold",funding:"funding",referal:"referal"},transfer:{fillResponseFromRequest:!0}},precisionMode:m,exceptions:{exact:{"Wrong parameters":c,"Unauthenticated.":a,"Server Error":n,"This feature is only enabled for users verifies by Cryptonomica":d,"Too Many Attempts.":u,"Selected Pair is disabled":l,"Invalid scope(s) provided.":d,"The maximum amount of open orders with the same price cannot exceed 10":f,"Your account not verified!":p},broad:{"Not enough":o}}})}async fetchCurrencies(e={}){const t=await this.publicGetCurrencies(e),i={},s=this.safeValue(t,"data",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"id"),a=this.safeInteger(t,"id"),n=this.safeCurrencyCode(this.safeString(t,"code")),o=this.parseNumber(this.parsePrecision(this.safeString(t,"precision"))),h=this.safeNumber(t,"withdrawal_fee_const"),d=this.safeValue(t,"active",!0);i[n]={id:r,numericId:a,code:n,info:t,type:void 0,name:this.safeString(t,"name"),active:d,deposit:void 0,withdraw:void 0,fee:h,precision:o,limits:{amount:{min:o,max:void 0},deposit:{min:this.safeNumber(t,"minimum_deposit_amount"),max:void 0},withdraw:{min:this.safeNumber(t,"minimum_withdrawal_amount"),max:void 0}}}}return i}async fetchMarkets(e={}){const t=await this.publicGetCurrencyPairsListCode(this.extend({code:"ALL"},e)),i=[],s=this.safeValue(t,"data",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"id"),a=this.safeInteger(t,"id"),n=this.safeString(t,"currency_id"),o=this.safeString(t,"market_currency_id"),h=this.safeInteger(t,"currency_id"),d=this.safeInteger(t,"market_currency_id"),c=this.safeCurrencyCode(this.safeString(t,"currency_code")),l=this.safeCurrencyCode(this.safeString(t,"market_code")),u=this.safeString(t,"min_buy_price"),f=this.safeString(t,"min_sell_price"),p=g.stringMax(u,f),m=g.stringDiv(this.safeString(t,"buy_fee_percent"),"100"),y=g.stringDiv(this.safeString(t,"sell_fee_percent"),"100"),b=g.stringMax(m,y);i.push({id:r,numericId:a,symbol:c+"/"+l,base:c,quote:l,settle:void 0,baseId:n,quoteId:o,settleId:void 0,baseNumericId:h,quoteNumericId:d,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:this.safeValue(t,"active"),contract:!1,linear:void 0,inverse:void 0,taker:b,maker:b,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"currency_precision"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"market_precision")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"min_order_amount"),max:void 0},price:{min:p,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return i}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={currencyPairId:i.id},r=await this.publicGetTickerCurrencyPairId(this.extend(s,t)),a=this.safeValue(r,"data",{});return this.parseTicker(a,i)}async fetchTime(e={}){const t=await this.publicGetPing(e),i=this.safeValue(t,"data",{}),s=this.safeValue(i,"server_datetime",{});return this.parse8601(this.safeString(s,"date"))}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={currencyPairId:this.market(e).id};void 0!==t&&(s.limit_bids=t,s.limit_asks=t);const r=await this.publicGetOrderbookCurrencyPairId(this.extend(s,i)),a=this.safeValue(r,"data",{});return this.parseOrderBook(a,e,void 0,"bid","ask","price","amount")}parseTicker(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeString2(e,"id","symbol"),r=this.safeSymbol(s,t,"_"),a=this.safeString(e,"last"),n=this.safeString(e,"open");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:n,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"volumeQuote"),quoteVolume:this.safeString(e,"volume"),info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetTicker(t),s=this.safeValue(i,"data",[]);return this.parseTickers(s,e)}parseOHLCV(e,t){return[this.safeInteger(e,"time"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={currencyPairId:a.id,candlesType:this.safeString(this.timeframes,t,t)};void 0===s?s=100:n.limit=s;const o=s*this.parseTimeframe(t);void 0===i?(n.timeEnd=this.seconds(),n.timeStart=n.timeEnd-o):(n.timeStart=parseInt(i/1e3),n.timeEnd=this.sum(n.timeStart,o));const h=await this.publicGetChartCurrencyPairIdCandlesType(this.extend(n,r)),d=this.safeValue(h,"data",[]);return this.parseOHLCVs(d,a,t,i,s)}parseTrade(e,t){const i=this.safeString(e,"id"),s=this.safeTimestamp(e,"timestamp"),r=this.safeString(e,"price"),a=this.safeString(e,"amount");let n;void 0===n&&void 0!==t&&(n=t.symbol);const o=this.safeStringLower2(e,"type","trade_type");return this.safeTrade({info:e,timestamp:s,datetime:this.iso8601(s),symbol:n,id:i,order:void 0,type:void 0,takerOrMaker:void 0,side:o,price:r,amount:a,cost:void 0,fee:void 0},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={currencyPairId:r.id};void 0!==i&&(a.limit=i),void 0!==t&&(a.sort="ASC",a.from=parseInt(t/1e3));const n=await this.publicGetTradesCurrencyPairId(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTrades(o,r,t,i)}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={currencyPairId:i.id},r=await this.tradingGetFeesCurrencyPairId(this.extend(s,t)),a=this.safeValue(r,"data");return{info:r,symbol:i.symbol,maker:this.safeNumber(a,"sell_fee"),taker:this.safeNumber(a,"buy_fee"),percentage:!0,tierBased:!0}}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0},i=this.safeValue(e,"data",[]);for(let e=0;e<i.length;e++){const s=i[e],r=this.safeCurrencyCode(this.safeString(s,"currency_id")),a=this.account();a.free=this.safeString(s,"balance"),a.used=this.safeString(s,"frozen_balance"),t[r]=a}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.profileGetWallets(e);return this.parseBalance(t)}parseOrderStatus(e){return this.safeString({PROCESSING:"open",PENDING:"open",PARTIAL:"open",FINISHED:"closed",CANCELLED:"canceled"},e,e)}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.parseOrderStatus(this.safeString(e,"status")),r=this.safeString2(e,"currency_pair_id","currency_pair_name"),a=this.safeSymbol(r,t,"_"),n=this.safeTimestamp(e,"timestamp"),o=this.safeString(e,"price"),h=this.safeString(e,"initial_amount"),d=this.safeString(e,"processed_amount");let c,l;void 0!==d&&(void 0!==h&&(c=g.stringSub(h,d),this.options.parseOrderToPrecision&&(c=this.amountToPrecision(a,c)),c=g.stringMax(c,"0.0")),void 0!==o&&void 0===l&&(l=g.stringMul(o,d)));let u=this.safeString(e,"original_type");"BUY"!==u&&"SELL"!==u||(u=void 0);const f=this.safeStringLower(e,"type"),p=this.safeValue(e,"trades"),m=this.safeNumber(e,"trigger_price"),y={info:e,id:i,clientOrderId:void 0,timestamp:n,datetime:this.iso8601(n),lastTradeTimestamp:void 0,symbol:a,type:u,timeInForce:void 0,postOnly:void 0,side:f,price:o,stopPrice:m,triggerPrice:m,amount:h,cost:l,average:void 0,filled:d,remaining:c,status:s,trades:p},b=this.safeValue(e,"fees");if(void 0===b)y.fee=void 0;else{if(b.length>0){y.fees=[];for(let e=0;e<b.length;e++){const t=this.safeString(b[e],"amount");if(void 0!==t){const i=this.safeString(b[e],"currency_id"),s=this.safeCurrencyCode(i);y.fees.push({cost:t,currency:s})}}}else y.fee=void 0}return this.safeOrder(y,t)}async createOrder(e,t,i,s,r,a={}){if("market"===t)throw new n(this.id+" createOrder() allows limit orders only");await this.loadMarkets();const o=this.market(e);"limit"===t&&(t=i);const h={currencyPairId:o.id,type:t.toUpperCase(),amount:parseFloat(this.amountToPrecision(e,s)),price:parseFloat(this.priceToPrecision(e,r))},d=await this.tradingPostOrdersCurrencyPairId(this.extend(h,a)),c=this.safeValue(d,"data",{});return this.parseOrder(c,o)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={orderId:e},r=await this.tradingGetOrderOrderId(this.extend(s,i)),a=this.safeValue(r,"data",{});let n;return void 0!==t&&(n=this.market(t)),this.parseOrder(a,n)}async fetchClosedOrder(e,t,i={}){await this.loadMarkets();const s={orderId:e},r=await this.reportsGetOrdersOrderId(this.extend(s,i)),a=this.safeValue(r,"data",{});let n;return void 0!==t&&(n=this.market(t)),this.parseOrder(a,n)}async fetchOrderTrades(e,t,i,s,r={}){return(await this.fetchClosedOrder(e,t,r)).trades}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets();let a="tradingGetOrders";const n={};void 0!==e&&(a="tradingGetOrdersCurrencyPairId",r=this.market(e),n.currencyPairId=r.id),void 0!==i&&(n.limit=i);const o=await this[a](this.extend(n,s)),h=this.safeValue(o,"data",[]);return this.parseOrders(h,r,t,i)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={orderId:e},r=await this.tradingDeleteOrderOrderId(this.extend(s,i)),a=this.safeValue(r,"data",{}),n=this.safeValue(a,"put_into_processing_queue",[]),o=this.safeValue(a,"not_put_into_processing_queue",[]),d=n.length,c=o.length;if(d<1){if(c<1)throw new h(this.id+" cancelOrder() received an empty response: "+this.json(r));return this.parseOrder(o[0])}if(c<1)return this.parseOrder(n[0]);throw new h(this.id+" cancelOrder() received an empty response: "+this.json(r))}async cancelAllOrders(e,t={}){await this.loadMarkets();const i={};let s="tradingDeleteOrders";if(void 0!==e){const t=this.market(e);i.currencyPairId=t.id,s="tradingDeleteOrdersCurrencyPairId"}return await this[s](this.extend(i,t))}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new r(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const a=this.market(e),n={currencyPairId:a.id};void 0!==t&&(n.timeStart=this.iso8601(t)),void 0!==i&&(n.limit=i);const o=await this.reportsGetTradesCurrencyPairId(this.extend(n,s)),h=this.safeValue(o,"data",[]);return this.parseTrades(h,a,t,i)}async createDepositAddress(e,t={}){await this.loadMarkets();const i={currencyId:this.currency(e).id},s=await this.profilePostWalletsCurrencyId(this.extend(i,t)),r=this.safeValue(s,"data",{}),a=this.safeValue(r,"deposit_address",{}),n=this.safeString(a,"address"),o=this.safeString(a,"additional_address_parameter");return this.checkAddress(n),{currency:e,address:n,tag:o,info:s}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=await this.fetchBalance(),s=this.safeValue(i.info,"data",[]),r=this.indexBy(s,"currency_id"),a=this.currency(e),o=this.safeValue(r,a.id);if(void 0===o)throw new n(this.id+" fetchDepositAddress() could not find the wallet id for currency code "+e+", try to call createDepositAddress() first");const h=this.safeInteger(o,"id");if(void 0===h)throw new n(this.id+" fetchDepositAddress() could not find the wallet id for currency code "+e+", try to call createDepositAddress() first");const d={walletId:h},c=await this.profileGetWalletsWalletId(this.extend(d,t)),l=this.safeValue(c,"data",[]),u=this.safeValue(l,"deposit_address",{}),f=this.safeString(u,"address"),p=this.safeString(u,"additional_address_parameter");return this.checkAddress(f),{currency:e,address:f,tag:p,network:void 0,info:c}}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+t+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));return"public"===t?Object.keys(o).length&&(n+="?"+this.urlencode(o)):(this.checkRequiredCredentials(),r={Authorization:"Bearer "+this.token},"GET"===i||"DELETE"===i?Object.keys(o).length&&(n+="?"+this.urlencode(o)):(a=this.json(o),Object.keys(o).length&&(r["Content-Type"]="application/json"))),{url:n,method:i,body:a,headers:r}}parseTransactionStatus(e){return this.safeString({processing:"pending","checking by system":"pending",hodl:"pending","amount too low":"failed","not confirmed":"pending","cancelled by user":"canceled",approved:"pending",finished:"ok","withdrawal error":"failed","deposit error":"failed","cancelled by admin":"canceled",awaiting:"pending"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=this.safeValue(e,"withdrawal_address",{}),r=this.safeString(s,"address"),a=this.safeString(s,"additional_address_parameter"),n=this.safeString(e,"currency_id");let o;n in this.currencies_by_id?t=this.currencies_by_id[n]:o=this.commonCurrencyCode(this.safeString(e,"currency_code")),void 0===o&&void 0!==t&&(o=t.code);const h="deposit_status_id"in e?"deposit":"withdrawal",d=this.safeNumber(e,"amount"),c=this.parseTransactionStatus(this.safeStringLower(e,"status")),l=this.safeTimestamp2(e,"timestamp","created_ts"),u=this.safeTimestamp(e,"updated_ts"),f=this.safeString(e,"txid");let p;const m=this.safeNumber(e,"fee");if(void 0!==m){const t=this.safeString2(e,"fee_currency_id","deposit_fee_currency_id");p={cost:m,currency:this.safeCurrencyCode(t)}}const g=this.safeString(s,"protocol_name");return{info:e,id:i,txid:f,timestamp:l,datetime:this.iso8601(l),network:g,addressFrom:void 0,address:r,addressTo:r,tagFrom:void 0,tag:a,tagTo:a,type:h,amount:d,currency:o,status:c,updated:u,fee:p}}async fetchDeposit(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.profileGetDepositsId(this.extend(s,i)),a=this.safeValue(r,"data",{});return this.parseTransaction(a)}async fetchDeposits(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.currency(e),a.currencyId=r.id),void 0!==i&&(a.limit=i),void 0!==t&&(a.timeStart=t);const n=await this.profileGetDeposits(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTransactions(o,r,t,i)}async fetchWithdrawal(e,t,i={}){await this.loadMarkets();const s={id:e},r=await this.profileGetWithdrawalsId(this.extend(s,i)),a=this.safeValue(r,"data",{});return this.parseTransaction(a)}async fetchWithdrawals(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.currency(e),a.currencyId=r.id),void 0!==i&&(a.limit=i),void 0!==t&&(a.timeStart=t);const n=await this.profileGetWithdrawals(this.extend(a,s)),o=this.safeValue(n,"data",[]);return this.parseTransactions(o,r,t,i)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e);let o;const h={};if("referal"===i&&"spot"===s)h.currencyId=a.id,o="profilePostReferralBonusTransferCurrencyId";else if("hold"===s)h.walletId=i,t=this.currencyToPrecision(e,t),t=g.stringNeg(t),h.amount=t,o="profilePostWalletsWalletIdHoldAmount";else{if("hold"!==i)throw new n(this.id+" transfer() only allows transfers of referal to spot and between a walletId and funding");h.walletId=s,h.amount=t,o="profilePostWalletsWalletIdHoldAmount"}const d=await this[o](this.extend(h,r)),c=this.safeValue(d,"data",{}),l=this.parseTransfer(c,a),u=this.safeValue(this.options,"transfer",{});return this.safeValue(u,"fillResponseFromRequest",!0)&&(l.fromAccount=i,l.toAccount=s,"string"==typeof t&&g.stringLt(t,"0")&&(t=this.parseNumber(g.stringNeg(t))),l.amount=t,void 0===l.currency&&(l.currency=e)),l}parseTransfer(e,t){const i=this.safeString(e,"currency_id");let s;return i in this.currencies_by_id?t=this.currencies_by_id[i]:s=this.commonCurrencyCode(this.safeString(e,"currency_code")),void 0===s&&(s=this.safeValue(t,"code")),{info:e,id:this.safeString(e,"id"),timestamp:void 0,datetime:void 0,currency:s,amount:void 0,fromAccount:void 0,toAccount:void 0,status:void 0}}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={currency_id:a.id,amount:parseFloat(this.currencyToPrecision(e,t)),address:i};void 0!==s&&(n.additional_address_parameter=s);const o=this.safeValue(this.options,"networks",{});let h=this.safeStringUpper(r,"network");h=this.safeInteger(o,h,h),void 0!==h&&(n.protocol_id=h,r=this.omit(r,"network"));const d=await this.profilePostWithdraw(this.extend(n,r)),c=this.safeValue(d,"data",{});return this.parseTransaction(c,a)}async fetchTransactionFees(e,t={}){await this.loadMarkets();const i=Object.keys(this.currencies),s={};for(let t=0;t<i.length;t++){const r=i[t],a=this.currencies[r];if(void 0!==e&&!this.inArray(r,e))continue;const n=this.safeValue(a,"info");s[r]={withdraw:this.safeNumber(a,"fee"),deposit:this.safeNumber(n,"deposit_fee_const"),info:n}}return s}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.publicGetCurrencies(t),s=this.safeValue(i,"data");return this.parseDepositWithdrawFees(s,e,"code")}parseDepositWithdrawFee(e,t){const i={withdraw:{fee:this.safeNumber(e,"withdrawal_fee_const"),percentage:!1},deposit:{fee:this.safeNumber(e,"deposit_fee_const"),percentage:!1},networks:{}},s=this.safeValue(e,"protocol_specific_settings",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"protocol_name"),a=this.networkIdToCode(r);i.networks[a]={withdraw:{fee:this.safeNumber(t,"withdrawal_fee_const"),percentage:!1},deposit:{fee:void 0,percentage:void 0}}}return i}handleErrors(e,t,i,s,r,a,o,h,d){if(void 0===o)return;if(!this.safeValue(o,"success",!1)){const e=this.safeString(o,"message"),t=this.id+" "+a;throw this.throwExactlyMatchedException(this.exceptions.exact,e,t),this.throwBroadlyMatchedException(this.exceptions.broad,e,t),new n(t)}}}},9269:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,BadRequest:n,OrderNotFound:o,InvalidAddress:h}=i(73449),{TICK_SIZE:d}=i(62115),c=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"therock",name:"TheRockTrading",countries:["MT"],rateLimit:100,version:"v1",has:{CORS:void 0,spot:!0,margin:void 0,swap:!1,future:!1,option:!1,cancelOrder:!0,createOrder:!0,fetchBalance:!0,fetchClosedOrders:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLedger:!0,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPositionMode:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!0,fetchTransactions:"emulated",fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawals:!0,transfer:!1,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/27766869-75057fa2-5ee9-11e7-9a6f-13e641fa4707.jpg",api:{rest:"https://api.therocktrading.com"},www:"https://therocktrading.com",doc:["https://api.therocktrading.com/doc/v1/index.html","https://api.therocktrading.com/doc/"]},api:{public:{get:{funds:1,"funds/{id}":1,"funds/{id}/orderbook":1,"funds/{id}/ticker":1,"funds/{id}/trades":1,"funds/{id}/ohlc_statistics":1,"funds/tickers":1}},private:{get:{balances:1,"balances/{id}":1,discounts:1,"discounts/{id}":1,funds:1,"funds/{id}":1,"funds/{id}/trades":1,"funds/{fund_id}/orders":1,"funds/{fund_id}/orders/{id}":1,"funds/{fund_id}/position_balances":1,"funds/{fund_id}/positions":1,"funds/{fund_id}/positions/{id}":1,transactions:1,"transactions/{id}":1,"withdraw_limits/{id}":1,withdraw_limits:1},post:{"atms/withdraw":1,"funds/{fund_id}/orders":1},delete:{"funds/{fund_id}/orders/{id}":1,"funds/{fund_id}/orders/remove_all":1}}},fees:{trading:{maker:this.parseNumber("0.002"),taker:this.parseNumber("0.002")},funding:{tierBased:!1,percentage:!1,withdraw:{},deposit:{BTC:0,BCH:0,PPC:0,ETH:0,ZEC:0,LTC:0,EUR:0}}},precisionMode:d,exceptions:{exact:{"Request already running":n,"cannot specify multiple address types":n,"Currency is not included in the list":n,"Record not found":o},broad:{"before must be greater than after param":n,"must be shorter than 60 days":n,"must be a multiple of (period param) in minutes":n,"Address allocation limit reached for currency":h,"is not a valid value for param currency":n," is invalid":h}},options:{withdraw:{fillResponseFromRequest:!0}}})}async fetchMarkets(e={}){const t=await this.publicGetFunds(e),i=this.safeValue(t,"funds"),s=[];if(void 0===i)throw new r(this.id+" fetchMarkets() got an unexpected response");for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"id"),a=this.safeString(t,"trade_currency"),n=this.safeString(t,"base_currency"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=this.safeString(t,"buy_fee"),l=this.safeString(t,"sell_fee");let u=c.stringMax(d,l);u=this.parseNumber(c.stringDiv(u,"100"));const f=this.safeValue(t,"leverages"),p=f.length;s.push({id:r,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:!0,margin:p>0,swap:!1,future:!1,option:!1,contract:!1,linear:void 0,inverse:void 0,taker:u,maker:u,contractSize:void 0,active:!0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"trade_currency_decimals"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"base_currency_decimals")))},limits:{leverage:{min:1,max:this.safeValue(f,p-1,1)},amount:{min:this.safeNumber(t,"minimum_quantity_offer"),max:void 0},price:{min:this.safeNumber(t,"minimum_price_offer"),max:void 0},cost:{min:void 0,max:void 0}},info:t})}return s}parseBalance(e){const t=this.safeValue(e,"balances",[]),i={info:e};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"trading_balance"),n.total=this.safeString(s,"balance"),i[a]=n}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetBalances(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={id:s.id},a=await this.publicGetFundsIdOrderbook(this.extend(r,i)),n=this.parse8601(this.safeString(a,"date"));return this.parseOrderBook(a,s.symbol,n,"bids","asks","price","amount")}parseTicker(e,t){const i=this.parse8601(this.safeString(e,"date"));t=this.safeMarket(void 0,t);const s=this.safeString(e,"last");return this.safeTicker({symbol:t.symbol,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:this.safeString(e,"open"),close:s,last:s,previousClose:this.safeString(e,"close"),change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"volume_traded"),quoteVolume:this.safeString(e,"volume"),info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.publicGetFundsTickers(t),s=this.indexBy(i.tickers,"fund_id"),r=Object.keys(s),a={};for(let e=0;e<r.length;e++){const t=r[e],i=this.safeMarket(t),n=i.symbol,o=s[t];a[n]=this.parseTicker(o,i)}return this.filterByArray(a,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={id:i.id},r=await this.publicGetFundsIdTicker(this.extend(s,t));return this.parseTicker(r,i)}parseTrade(e,t){const i=this.safeString(e,"fund_id"),s=this.safeSymbol(i,t),r=this.parse8601(this.safeString(e,"date")),a=this.safeString(e,"id"),n=this.safeString(e,"order_id"),o=this.safeString(e,"side"),h=this.safeString(e,"price"),d=this.safeString(e,"amount");let l,u;const f=this.safeValue(e,"transactions",[]),p=this.groupBy(f,"type"),m=this.safeValue(p,"paid_commission",[]);for(let e=0;e<m.length;e++)void 0===u&&(u="0.0"),u=c.stringAdd(u,this.safeString(m[e],"price"));return void 0!==u&&(l={cost:u,currency:t.quote}),this.safeTrade({info:e,id:a,order:n,timestamp:r,datetime:this.iso8601(r),symbol:s,type:void 0,side:o,takerOrMaker:void 0,price:h,amount:d,cost:void 0,fee:l},t)}parseLedgerEntryDirection(e){return this.safeString({affiliate_earnings:"in",atm_payment:"in",bought_currency_from_fund:"out",bought_shares:"out",paid_commission:"out",paypal_payment:"in",pos_payment:"in",released_currency_to_fund:"out",rollover_commission:"out",sold_currency_to_fund:"in",sold_shares:"in",transfer_received:"in",transfer_sent:"out",withdraw:"out"},e,e)}parseLedgerEntryType(e){return this.safeString({affiliate_earnings:"referral",atm_payment:"transaction",bought_currency_from_fund:"trade",bought_shares:"trade",paid_commission:"fee",paypal_payment:"transaction",pos_payment:"transaction",released_currency_to_fund:"trade",rollover_commission:"fee",sold_currency_to_fund:"trade",sold_shares:"trade",transfer_received:"transfer",transfer_sent:"transfer",withdraw:"transaction"},e,e)}parseLedgerEntry(e,t){const i=this.safeString(e,"id");let s,r=this.safeString(e,"type");const a=this.parseLedgerEntryDirection(r);r=this.parseLedgerEntryType(r),"trade"!==r&&"fee"!==r||(s=this.safeString(e,"trade_id"));const n=this.safeString(e,"currency"),o=this.safeCurrencyCode(n),h=this.safeNumber(e,"price"),d=this.parse8601(this.safeString(e,"date"));return{info:e,id:i,direction:a,account:void 0,referenceId:s,referenceAccount:void 0,type:r,currency:o,amount:h,before:void 0,after:void 0,status:"ok",timestamp:d,datetime:this.iso8601(d),fee:void 0}}async fetchLedger(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==t&&(r.after=this.iso8601(t));const n=await this.privateGetTransactions(this.extend(r,s)),o=this.safeValue(n,"transactions",[]);return this.parseLedger(o,a,t,i)}parseTransactionType(e){return this.safeString({withdraw:"withdrawal",atm_payment:"deposit"},e,e)}parseTransaction(e,t){const i=this.safeString2(e,"id","transaction_id"),s=this.parseTransactionType(this.safeString(e,"type")),r=this.safeValue(e,"transfer_detail",{}),a=this.safeString(r,"method");let n,o;void 0!==a&&"wire_transfer"!==a&&(n=this.safeString(r,"id"),o=this.safeString(r,"recipient"));const h=this.safeString(e,"currency"),d=this.safeCurrencyCode(h),c=this.safeNumber(e,"price"),l=this.parse8601(this.safeString(e,"date"));return{info:e,id:i,currency:d,amount:c,network:this.safeString(r,"method"),addressFrom:void 0,addressTo:o,address:o,tagFrom:void 0,tagTo:void 0,tag:void 0,status:"ok",type:s,updated:void 0,txid:n,timestamp:l,datetime:this.iso8601(l),fee:void 0}}async fetchWithdrawals(e,t,i,s={}){return await this.fetchTransactions(e,t,i,this.extend({type:"withdraw"},s))}async fetchDeposits(e,t,i,s={}){return await this.fetchTransactions(e,t,i,this.extend({type:"atm_payment"},s))}async fetchTransactions(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==t&&(r.after=this.iso8601(t)),s=this.extend(r,s);const n=await this.privateGetTransactions(s),o=this.safeValue(n,"transactions",[]),h=this.filterByArray(o,"type",["withdraw","atm_payment"],!1);return this.parseTransactions(h,a,t,i)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets();const a=this.currency(e);t=this.currencyToPrecision(e,t);const n={currency:a.id,destination_address:i,amount:parseFloat(t)};void 0!==s&&(n.destination_tag=s);const o=await this.privatePostAtmsWithdraw(this.extend(n,r)),h=this.parseTransaction(o,a),d=this.safeValue(this.options,"withdraw",{});return this.safeValue(d,"fillResponseFromRequest",!0)&&(h.addressTo===i&&(h.addressTo=i),void 0===h.address&&(h.address=i),void 0===h.tagTo&&(h.tagTo=s),void 0===h.tag&&(h.tag=s),void 0===h.amount&&(h.amount=t)),h}parseOrderStatus(e){return this.safeString({active:"open",executed:"closed",deleted:"canceled"},e,e)}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"fund_id"),r=this.parse8601(this.safeString(e,"date")),a=this.safeString(e,"amount"),n=this.safeString(e,"amount_unfilled"),o=this.safeString(e,"price"),h=this.safeValue(e,"trades"),d=this.safeString(e,"conditional_price");return this.safeOrder({id:i,clientOrderId:void 0,info:e,timestamp:r,datetime:this.iso8601(r),lastTradeTimestamp:void 0,status:this.parseOrderStatus(this.safeString(e,"status")),symbol:this.safeSymbol(s,t),type:this.safeString(e,"type"),timeInForce:void 0,postOnly:void 0,side:this.safeString(e,"side"),price:o,stopPrice:d,triggerPrice:d,cost:void 0,amount:a,filled:void 0,average:void 0,remaining:n,fee:void 0,trades:h},t)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({status:"active"},s))}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({status:"executed"},s))}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={fund_id:r.id};void 0!==t&&(n.after=this.iso8601(t));const o=await this.privateGetFundsFundIdOrders(this.extend(n,s)),h=this.safeValue(o,"orders",[]);return this.parseOrders(h,r,t,i)}async fetchOrder(e,t,i={}){if(void 0===t)throw new a(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s={id:e,fund_id:this.market(t).id},r=await this.privateGetFundsFundIdOrdersId(this.extend(s,i));return this.parseOrder(r)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets(),"market"===t&&(r=0);const n={fund_id:this.market(e).id,side:i,amount:s,price:r},o=await this.privatePostFundsFundIdOrders(this.extend(n,a));return this.parseOrder(o)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={id:e,fund_id:this.marketId(t)},r=await this.privateDeleteFundsFundIdOrdersId(this.extend(s,i));return this.parseOrder(r)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.parseTimeframe(t),o=parseInt(n/60),h={id:a.id,period:o};void 0===i&&(h.after=this.iso8601(i));const d=await this.publicGetFundsIdOhlcStatistics(this.extend(h,r));return this.parseOHLCVs(d,a,t,i,s)}parseOHLCV(e,t){const i=this.safeString(e,"interval_starts_at");return[this.parse8601(i),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"base_volume")]}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={id:r.id};void 0!==i&&(n.per_page=i),void 0!==t&&(n.after=this.iso8601(t));const o=await this.privateGetFundsIdTrades(this.extend(n,s)),h=this.safeValue(o,"trades",[]);return this.parseTrades(h,r,t,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={id:r.id};void 0!==i&&(a.per_page=i),void 0!==t&&(a.after=this.iso8601(t));const n=await this.publicGetFundsIdTrades(this.extend(a,s));return this.parseTrades(n.trades,r,t,i)}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e);let s={id:i.id};const r=await this.publicGetFundsId(this.extend(s,t));s={id:i.quoteId};const a=await this.privateGetDiscountsId(this.extend(s,t));return this.parseTradingFee(r,a,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.publicGetFunds(e),i=await this.privateGetDiscounts(e),s=this.safeValue(t,"funds",[]),r=this.safeValue(i,"discounts",[]),a={};for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"id"),n=this.safeMarket(i),o=this.safeValue(n,"quoteId"),h=this.filterBy(r,"currency",o),d=this.parseTradingFee(t,h,n);a[d.symbol]=d}return a}parseTradingFee(e,t,i){const s=this.safeString(e,"id"),r=this.safeString(e,"buy_fee"),a=this.safeString(e,"sell_fee"),n=this.safeString(t,"discount","0"),o=c.stringSub("100",n),h=this.parseNumber(c.stringDiv(c.stringMul(r,o),"10000")),d=this.parseNumber(c.stringDiv(c.stringMul(a,o),"10000"));return{info:e,symbol:this.safeSymbol(s,i),maker:d,taker:h,percentage:!0,tierBased:!0}}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+this.version+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if(r=void 0===r?{}:r,"private"===t){if(this.checkRequiredCredentials(),Object.keys(o).length)if("POST"===i)a=this.json(o),r["Content-Type"]="application/json";else{const e=this.rawencode(o);e.length&&(n+="?"+e)}const e=this.nonce().toString(),t=e+n;r["X-TRT-KEY"]=this.apiKey,r["X-TRT-NONCE"]=e,r["X-TRT-SIGN"]=this.hmac(this.encode(t),this.encode(this.secret),"sha512")}else"public"===t&&Object.keys(o).length&&(n+="?"+this.rawencode(o));return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;const c=this.safeValue(o,"errors",[]),l=c.length;if(l>0){const e=this.id+" "+n;for(let t=0;t<l;t++){const i=c[t],s=this.safeString(i,"message");this.throwExactlyMatchedException(this.exceptions.exact,s,e),this.throwBroadlyMatchedException(this.exceptions.broad,s,e)}throw new r(e)}}}},46974:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,ExchangeNotAvailable:n,InsufficientFunds:o,OrderNotFound:h,DDoSProtection:d,InvalidOrder:c,AuthenticationError:l,PermissionDenied:u}=i(73449),{TICK_SIZE:f}=i(62115),p=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"tidex",name:"Tidex",countries:["UK"],rateLimit:2e3,version:"3",userAgent:this.userAgents.chrome,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createMarketOrder:!1,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchCurrencies:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderBooks:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/30781780-03149dc4-a12e-11e7-82bb-313b269d24d4.jpg",api:{web:"https://gate.tidex.com/api",public:"https://api.tidex.com/api/3",private:"https://api.tidex.com/tapi"},www:"https://tidex.com",doc:"https://tidex.com/exchange/public-api",referral:"https://tidex.com/exchange",fees:["https://tidex.com/exchange/assets-spec","https://tidex.com/exchange/pairs-spec"]},api:{web:{get:["currency","pairs","tickers","orders","ordershistory","trade-data","trade-data/{id}"]},public:{get:["info","ticker/{pair}","depth/{pair}","trades/{pair}"]},private:{post:["getInfoExt","getInfo","Trade","ActiveOrders","OrderInfo","CancelOrder","TradeHistory","getDepositAddress","createWithdraw","getWithdraw"]}},fees:{trading:{feeSide:"get",tierBased:!1,percentage:!0,taker:this.parseNumber("0.001"),maker:this.parseNumber("0.001")}},commonCurrencies:{DSH:"DASH",EMGO:"MGO",MGO:"WMGO"},precisionMode:f,exceptions:{exact:{803:c,804:c,805:c,806:c,807:c,831:o,832:o,833:h},broad:{"Invalid pair name":r,"invalid api key":l,"invalid sign":l,"api key dont have trade permission":l,"invalid parameter":c,"invalid order":c,"Requests too often":d,"not available":n,"data unavailable":n,"external service unavailable":n,"IP restricted":u}},options:{fetchTickersMaxLength:2048},orders:{}})}async fetchCurrencies(e={}){const t=await this.webGetCurrency(e),i={};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"symbol"),a=this.safeCurrencyCode(r);let n=!0===this.safeValue(s,"visible");const o=this.safeValue(s,"withdrawEnable",!0),h=this.safeValue(s,"depositEnable",!0);o&&h||(n=!1);const d=this.safeString(s,"name"),c=this.safeNumber(s,"withdrawFee");i[a]={id:r,code:a,name:d,active:n,deposit:h,withdraw:o,precision:this.parseNumber(this.parsePrecision(this.safeString(s,"amountPoint"))),funding:{withdraw:{active:o,fee:c},deposit:{active:h,fee:this.parseNumber("0")}},limits:{amount:{min:void 0,max:void 0},withdraw:{min:this.safeNumber(s,"withdrawMinAmount"),max:void 0},deposit:{min:this.safeNumber(s,"depositMinAmount"),max:void 0}},info:s}}return i}async fetchMarkets(e={}){const t=(await this.publicGetInfo(e)).pairs,i=Object.keys(t),s=[];for(let e=0;e<i.length;e++){const r=i[e],a=t[r],[n,o]=r.split("_"),h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o),c=this.safeInteger(a,"hidden");let l=this.safeString(a,"fee");l=p.stringDiv(l,"100"),s.push({id:r,symbol:h+"/"+d,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:0===c,contract:!1,linear:void 0,inverse:void 0,taker:this.parseNumber(l),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(a,"decimal_places"))),price:this.parseNumber(this.parsePrecision(this.safeString(a,"decimal_places")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(a,"min_amount"),max:this.safeNumber(a,"max_amount")},price:{min:this.safeNumber(a,"min_price"),max:this.safeNumber(a,"max_price")},cost:{min:this.safeNumber(a,"min_total"),max:void 0}},info:a})}return s}parseBalance(e){const t=this.safeValue(e,"return"),i=this.safeTimestamp(t,"server_time"),s={info:e,timestamp:i,datetime:this.iso8601(i)},r=this.safeValue(t,"funds",{}),a=Object.keys(r);for(let e=0;e<a.length;e++){const t=a[e],i=this.safeCurrencyCode(t),n=this.safeValue(r,t,{}),o=this.account();o.free=this.safeString(n,"value"),o.used=this.safeString(n,"inOrders"),s[i]=o}return this.safeBalance(s)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostGetInfoExt(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),a={pair:s.id};void 0!==t&&(a.limit=t);const n=await this.publicGetDepthPair(this.extend(a,i));if(!(s.id in n))throw new r(this.id+" "+s.symbol+" order book is empty or not available");const o=n[s.id];return this.parseOrderBook(o,e)}async fetchOrderBooks(e,t,i={}){let s;if(await this.loadMarkets(),void 0===e){if(s=this.ids.join("-"),s.length>2048){const e=this.ids.length;throw new r(this.id+" fetchOrderBooks() has "+e.toString()+" symbols exceeding max URL length, you are required to specify a list of symbols in the first argument to fetchOrderBooks")}}else s=this.marketIds(e),s=s.join("-");const a={pair:s};void 0!==t&&(a.limit=t);const n=await this.publicGetDepthPair(this.extend(a,i)),o={};s=Object.keys(n);for(let e=0;e<s.length;e++){const t=s[e],i=this.safeSymbol(t);o[i]=this.parseOrderBook(n[t],i)}return o}parseTicker(e,t){const i=this.safeTimestamp(e,"updated");t=this.safeMarket(void 0,t);const s=this.safeString(e,"last");return this.safeTicker({symbol:t.symbol,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"buy"),bidVolume:void 0,ask:this.safeString(e,"sell"),askVolume:void 0,vwap:void 0,open:void 0,close:s,last:s,previousClose:void 0,change:void 0,percentage:void 0,average:this.safeString(e,"avg"),baseVolume:this.safeString(e,"vol_cur"),quoteVolume:this.safeString(e,"vol"),info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);let i=this.ids;if(void 0===e){const e=i.length;if(i=i.join("-"),i.length>this.options.fetchTickersMaxLength){const t=this.safeInteger(this.options,"fetchTickersMaxLength",2048);throw new a(this.id+" fetchTickers() has "+e.toString()+" markets exceeding max URL length for this endpoint ("+t.toString()+" characters), please, specify a list of symbols of interest in the first argument to fetchTickers")}}else i=this.marketIds(e),i=i.join("-");const s={pair:i},r=await this.publicGetTickerPair(this.extend(s,t)),n={},o=Object.keys(r);for(let e=0;e<o.length;e++){const t=o[e],i=this.safeMarket(t);n[i.symbol]=this.parseTicker(r[t],i)}return this.filterByArray(n,"symbol",e)}async fetchTicker(e,t={}){return(await this.fetchTickers([e],t))[e]}parseTrade(e,t){const i=this.safeTimestamp(e,"timestamp");let s=this.safeString(e,"type");"ask"===s?s="sell":"bid"===s&&(s="buy");const r=this.safeString2(e,"rate","price"),a=this.safeString2(e,"trade_id","tid"),n=this.safeString(e,"order_id"),o=this.safeString(e,"pair"),h=this.safeSymbol(o,t),d=this.safeString(e,"amount"),c=this.parseNumber(r),l=this.parseNumber(d),u=this.parseNumber(p.stringMul(r,d)),f="limit";let m,g;const y=this.safeNumber(e,"commission");if(void 0!==y){const t=this.safeString(e,"commissionCurrency");g={cost:y,currency:this.safeCurrencyCode(t)}}const b=this.safeValue(e,"is_your_order");return void 0!==b&&(m="taker",b&&(m="maker"),void 0===g&&(g=this.calculateFee(h,f,s,l,c,m))),{id:a,order:n,timestamp:i,datetime:this.iso8601(i),symbol:h,type:f,side:s,takerOrMaker:m,price:c,amount:l,cost:u,fee:g,info:e}}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pair:r.id};void 0!==i&&(a.limit=i);const n=await this.publicGetTradesPair(this.extend(a,s));if(Array.isArray(n)){if(0===n.length)return[]}return this.parseTrades(n[r.id],r,t,i)}async createOrder(e,t,i,s,a,n={}){if("market"===t)throw new r(this.id+" createOrder() allows limit orders only");const o=s.toString(),h=a.toString();await this.loadMarkets();const d=this.market(e),c={pair:d.id,type:i,amount:this.amountToPrecision(e,s),rate:this.priceToPrecision(e,a)},l=await this.privatePostTrade(this.extend(c,n));let u,f="open",p="0.0",m=o;const g=this.safeValue(l,"return");void 0!==g&&(u=this.safeString(g,"order_id"),"0"===u&&(u=this.safeString(g,"init_order_id"),f="closed"),p=this.safeString(g,"received",p),m=this.safeString(g,"remains",o));const y=this.milliseconds();return this.safeOrder({id:u,timestamp:y,datetime:this.iso8601(y),lastTradeTimestamp:void 0,status:f,symbol:e,type:t,side:i,price:h,cost:void 0,amount:o,remaining:m,filled:p,fee:void 0,info:l,clientOrderId:void 0,average:void 0,trades:void 0},d)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={order_id:parseInt(e)};return await this.privatePostCancelOrder(this.extend(s,i))}parseOrderStatus(e){return this.safeString({0:"open",1:"closed",2:"canceled",3:"canceled"},e,e)}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.parseOrderStatus(this.safeString(e,"status")),r=this.safeTimestamp(e,"timestamp_created"),a=this.safeString(e,"pair"),n=this.safeSymbol(a,t);let o,h;const d=this.safeString(e,"rate");"start_amount"in e?(h=this.safeString(e,"start_amount"),o=this.safeString(e,"amount")):o=this.safeString(e,"amount");return this.safeOrder({info:e,id:i,clientOrderId:void 0,symbol:n,timestamp:r,datetime:this.iso8601(r),lastTradeTimestamp:void 0,type:"limit",timeInForce:void 0,postOnly:void 0,side:this.safeString(e,"type"),price:d,stopPrice:void 0,triggerPrice:void 0,cost:void 0,amount:h,remaining:o,filled:void 0,status:s,fee:undefined,average:void 0,trades:void 0},t)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={order_id:parseInt(e)},r=await this.privatePostOrderInfo(this.extend(s,i));e=e.toString();const a=this.safeValue(r,"return",{}),n=this.safeValue(a,e);return this.parseOrder(this.extend({id:e},n))}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.pair=a.id);const n=await this.privatePostActiveOrders(this.extend(r,s)),o=this.safeValue(n,"return",[]);return this.parseOrders(o,a,t,i)}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.pair=r.id),void 0!==i&&(a.count=parseInt(i)),void 0!==t&&(a.since=parseInt(t/1e3));const n=await this.privatePostTradeHistory(this.extend(a,s)),o=this.safeValue(n,"return",[]);return this.parseTrades(o,r,t,i)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={asset:a.id,amount:parseFloat(t),address:i};void 0!==s&&(n.memo=s);const o=await this.privatePostCreateWithdraw(this.extend(n,r)),h=this.safeValue(o,"return",{}),d=this.safeValue(h,"withdraw_info",{});return this.parseTransaction(d,a)}parseTransaction(e,t){return t=this.safeCurrency(void 0,t),{id:this.safeString(e,"id"),txid:void 0,timestamp:void 0,datetime:void 0,network:void 0,addressFrom:void 0,address:void 0,addressTo:void 0,amount:void 0,type:void 0,currency:t.code,status:void 0,updated:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,comment:void 0,fee:void 0,info:e}}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t];const o=this.omit(s,this.extractParams(e));if("private"===t){this.checkRequiredCredentials();const t=this.nonce();a=this.urlencode(this.extend({nonce:t,method:e},o));const i=this.hmac(this.encode(a),this.encode(this.secret),"sha512");r={"Content-Type":"application/x-www-form-urlencoded",Key:this.apiKey,Sign:i}}else"public"===t?(n+="/"+this.implodeParams(e,s),Object.keys(o).length&&(n+="?"+this.urlencode(o))):(n+="/"+this.implodeParams(e,s),"GET"===i?Object.keys(o).length&&(n+="?"+this.urlencode(o)):Object.keys(o).length&&(a=this.json(o),r={"Content-Type":"application/json"}));return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0!==o&&"success"in o){let e=this.safeValue(o,"success",!1);if("string"==typeof e&&(e="true"===e||"1"===e),!e){const e=this.safeString(o,"code"),t=this.safeString(o,"error"),i=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,e,i),this.throwExactlyMatchedException(this.exceptions.exact,t,i),this.throwBroadlyMatchedException(this.exceptions.broad,t,i),new r(i)}}}}},41378:function(e,t,i){"use strict";const s=i(48819),{ArgumentsRequired:r,ExchangeError:a,PermissionDenied:n,ExchangeNotAvailable:o,InsufficientFunds:h,OrderNotFound:d,InvalidOrder:c,RateLimitExceeded:l,NotSupported:u,BadRequest:f,AuthenticationError:p}=i(73449),{TICK_SIZE:m}=i(62115),g=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"timex",name:"TimeX",countries:["AU"],version:"v1",rateLimit:1500,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,cancelOrders:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,editOrder:!0,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposit:!1,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!0,fetchWithdrawal:!1,fetchWithdrawals:!0,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1},timeframes:{"1m":"I1","5m":"I5","15m":"I15","30m":"I30","1h":"H1","2h":"H2","4h":"H4","6h":"H6","12h":"H12","1d":"D1","1w":"W1"},urls:{logo:"https://user-images.githubusercontent.com/1294454/70423869-6839ab00-1a7f-11ea-8f94-13ae72c31115.jpg",api:{rest:"https://plasma-relay-backend.timex.io"},www:"https://timex.io",doc:"https://docs.timex.io",referral:"https://timex.io/?refcode=1x27vNkTbP1uwkCck"},api:{addressbook:{get:["me"],post:["","id/{id}","id/{id}/remove"]},custody:{get:["credentials","credentials/h/{hash}","credentials/k/{key}","credentials/me","credentials/me/address","deposit-addresses","deposit-addresses/h/{hash}"]},history:{get:["orders","orders/details","orders/export/csv","trades","trades/export/csv"]},currencies:{get:["a/{address}","i/{id}","s/{symbol}"],post:["perform","prepare","remove/perform","s/{symbol}/remove/prepare","s/{symbol}/update/perform","s/{symbol}/update/prepare"]},manager:{get:["deposits","transfers","withdrawals"]},markets:{get:["i/{id}","s/{symbol}"],post:["perform","prepare","remove/perform","s/{symbol}/remove/prepare","s/{symbol}/update/perform","s/{symbol}/update/prepare"]},public:{get:["candles","currencies","markets","orderbook","orderbook/raw","orderbook/v2","tickers","trades"]},statistics:{get:["address"]},trading:{get:["balances","fees","orders"],post:["orders","orders/json"],put:["orders","orders/json"],delete:["orders","orders/json"]},tradingview:{get:["config","history","symbol_info","time"]}},precisionMode:m,exceptions:{exact:{0:a,1:u,4e3:f,4001:f,4002:h,4003:p,4004:p,4005:f,4006:f,4007:f,4300:n,4100:p,4400:d,5001:c,5002:a,400:f,401:p,403:n,404:d,429:l,500:a,503:o},broad:{Insufficient:h}},options:{expireIn:31536e3,fetchTickers:{period:"1d"},fetchTrades:{sort:"timestamp,asc"},fetchMyTrades:{sort:"timestamp,asc"},fetchOpenOrders:{sort:"createdAt,asc"},fetchClosedOrders:{sort:"createdAt,asc"},defaultSort:"timestamp,asc",defaultSortOrders:"createdAt,asc"}})}async fetchMarkets(e={}){const t=await this.publicGetMarkets(e),i=[];for(let e=0;e<t.length;e++)i.push(this.parseMarket(t[e]));return i}async fetchCurrencies(e={}){const t=await this.publicGetCurrencies(e),i=[];for(let e=0;e<t.length;e++){const s=t[e];i.push(this.parseCurrency(s))}return this.indexBy(i,"code")}async fetchDeposits(e,t,i,s={}){const a=this.safeString(s,"address");if(s=this.omit(s,"address"),void 0===a)throw new r(this.id+" fetchDeposits() requires an address parameter");const n={address:a},o=await this.managerGetDeposits(this.extend(n,s));return this.parseTransactions(o,e,t,i)}async fetchWithdrawals(e,t,i,s={}){const a=this.safeString(s,"address");if(s=this.omit(s,"address"),void 0===a)throw new r(this.id+" fetchDeposits() requires an address parameter");const n={address:a},o=await this.managerGetWithdrawals(this.extend(n,s));return this.parseTransactions(o,e,t,i)}getCurrencyByAddress(e){const t=this.currencies;for(let i=0;i<t.length;i++){const s=t[i],r=this.safeValue(s,"info",{});if(this.safeString(r,"address")===e)return s}}parseTransaction(e,t){const i=this.safeString(e,"timestamp"),s=this.safeString(e,"token","");return t=this.getCurrencyByAddress(s),{info:e,id:this.safeString2(e,"transferHash"),txid:this.safeString(e,"txid"),timestamp:this.parse8601(i),datetime:i,network:void 0,address:void 0,addressTo:this.safeString(e,"to"),addressFrom:this.safeString(e,"from"),tag:void 0,tagTo:void 0,tagFrom:void 0,type:void 0,amount:this.safeNumber(e,"value"),currency:this.safeCurrencyCode(void 0,t),status:"ok",updated:void 0,fee:void 0}}async fetchTickers(e,t={}){await this.loadMarkets();const i=this.safeString(this.options.fetchTickers,"period","1d"),s={period:this.timeframes[i]},r=await this.publicGetTickers(this.extend(s,t));return this.parseTickers(r,e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s=this.safeString(this.options.fetchTickers,"period","1d"),r={market:i.id,period:this.timeframes[s]},a=await this.publicGetTickers(this.extend(r,t)),n=this.safeValue(a,0);return this.parseTicker(n,i)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={market:this.market(e).id};void 0!==t&&(s.limit=t);const r=await this.publicGetOrderbookV2(this.extend(s,i)),a=this.parse8601(this.safeString(r,"timestamp"));return this.parseOrderBook(r,e,a,"bid","ask","price","baseTokenAmount")}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a=this.safeValue(this.options,"fetchTrades",{}),n=this.safeValue(a,"sort","timestamp,asc"),o=this.safeString(s,"sort",n),h=this.omit(s,"sort"),d={market:r.id,sort:o};void 0!==t&&(d.from=this.iso8601(t)),void 0!==i&&(d.size=i);const c=await this.publicGetTrades(this.extend(d,h));return this.parseTrades(c,r,t,i)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={market:a.id,period:this.safeString(this.timeframes,t,t)},o=this.parseTimeframe(t);if(void 0===s&&(s=1e3),void 0!==i)n.from=this.iso8601(i),n.till=this.iso8601(this.sum(i,this.sum(s,1)*o*1e3));else{const e=this.milliseconds();n.till=this.iso8601(e),n.from=this.iso8601(e-s*o*1e3-1)}const h=await this.publicGetCandles(this.extend(n,r));return this.parseOHLCVs(h,a,t,i,s)}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.total=this.safeString(s,"totalBalance"),n.used=this.safeString(s,"lockedBalance"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.tradingGetBalances(e);return this.parseBalance(t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=i.toUpperCase();let h=t.toUpperCase();this.safeValue(a,"postOnly",!1)&&(h="POST_ONLY",a=this.omit(a,["postOnly"]));const d={symbol:n.id,quantity:this.amountToPrecision(e,s),side:o,orderTypes:h};let l=a;if("LIMIT"===h||"POST_ONLY"===h){d.price=this.priceToPrecision(e,r);const i=this.safeInteger(this.options,"expireIn"),s=this.safeValue(a,"expireTime"),n=this.safeValue(a,"expireIn",i);if(void 0!==s)d.expireTime=s;else{if(void 0===n)throw new c(this.id+" createOrder() method requires a expireTime or expireIn param for a "+t+" order, you can also set the expireIn exchange-wide option");d.expireIn=n}l=this.omit(a,["expireTime","expireIn"])}else d.price=0;const u=await this.tradingPostOrders(this.extend(d,l)),f=this.safeValue(u,"orders",[]),p=this.safeValue(f,0,{});return this.parseOrder(p,n)}async editOrder(e,t,i,s,r,a,n={}){await this.loadMarkets();const o=this.market(t),h={id:e};void 0!==r&&(h.quantity=this.amountToPrecision(t,r)),void 0!==a&&(h.price=this.priceToPrecision(t,a));const d=await this.tradingPutOrders(this.extend(h,n));if("unchangedOrders"in d){const e=this.safeValue(d,"unchangedOrders",[]);return{id:this.safeString(e,0),info:d}}const c=this.safeValue(d,"changedOrders",[]),l=this.safeValue(c,0,{}),u=this.safeValue(l,"newOrder",{});return this.parseOrder(u,o)}async cancelOrder(e,t,i={}){return await this.loadMarkets(),await this.cancelOrders([e],t,i)}async cancelOrders(e,t,i={}){await this.loadMarkets();const s={id:e};return await this.tradingDeleteOrders(this.extend(s,i))}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={orderHash:e},r=await this.historyGetOrdersDetails(s),a=this.safeValue(r,"order",{}),n=this.safeValue(r,"trades",[]);return this.parseOrder(this.extend(a,{trades:n}))}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r=this.safeValue(this.options,"fetchOpenOrders",{}),a=this.safeValue(r,"sort","createdAt,asc"),n=this.safeString(s,"sort",a),o=this.omit(s,"sort"),h={sort:n};let d;void 0!==e&&(d=this.market(e),h.symbol=d.id),void 0!==i&&(h.size=i);const c=await this.tradingGetOrders(this.extend(h,o)),l=this.safeValue(c,"orders",[]);return this.parseOrders(l,d,t,i)}async fetchClosedOrders(e,t,i,s={}){await this.loadMarkets();const r=this.safeValue(this.options,"fetchClosedOrders",{}),a=this.safeValue(r,"sort","createdAt,asc"),n=this.safeString(s,"sort",a),o=this.omit(s,"sort"),h={sort:n,side:"BUY"};let d;void 0!==e&&(d=this.market(e),h.symbol=d.id),void 0!==t&&(h.from=this.iso8601(t)),void 0!==i&&(h.size=i);const c=await this.historyGetOrders(this.extend(h,o)),l=this.safeValue(c,"orders",[]);return this.parseOrders(l,d,t,i)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r=this.safeValue(this.options,"fetchMyTrades",{}),a=this.safeValue(r,"sort","timestamp,asc"),n=this.safeString(s,"sort",a),o=this.omit(s,"sort"),h={sort:n};let d;void 0!==e&&(d=this.market(e),h.symbol=d.id),void 0!==t&&(h.from=this.iso8601(t)),void 0!==i&&(h.size=i);const c=await this.historyGetTrades(this.extend(h,o)),l=this.safeValue(c,"trades",[]);return this.parseTrades(l,d,t,i)}parseTradingFee(e,t){const i=this.safeString(e,"market"),s=this.safeNumber(e,"fee");return{info:e,symbol:this.safeSymbol(i,t),maker:s,taker:s}}async fetchTradingFee(e,t={}){await this.loadMarkets();const i=this.market(e),s={markets:i.id},r=await this.tradingGetFees(this.extend(s,t)),a=this.safeValue(r,0,{});return this.parseTradingFee(a,i)}parseMarket(e){const t=this.safeValue(e,"locked"),i=this.safeString(e,"symbol"),s=this.safeString(e,"baseCurrency"),r=this.safeString(e,"quoteCurrency"),a=this.safeCurrencyCode(s),n=this.safeCurrencyCode(r),o=this.safeString(e,"quantityIncrement"),h=this.safeString(e,"baseMinSize"),d=g.stringMax(o,h),c=this.safeString(e,"tickSize"),l=this.safeString(e,"quoteMinSize");return{id:i,symbol:a+"/"+n,base:a,quote:n,settle:void 0,baseId:s,quoteId:r,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:!t,contract:!1,linear:void 0,inverse:void 0,taker:this.safeNumber(e,"takerFee"),maker:this.safeNumber(e,"makerFee"),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(e,"quantityIncrement"),price:this.safeNumber(e,"tickSize")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.parseNumber(d),max:void 0},price:{min:this.parseNumber(c),max:void 0},cost:{min:l,max:void 0}},info:e}}parseCurrency(e){const t=this.safeString(e,"symbol"),i=this.safeCurrencyCode(t),s=this.safeString(e,"name"),r=this.safeValue(e,"depositEnabled"),a=this.safeValue(e,"withdrawalEnabled"),n=this.safeValue(e,"active"),o=r&&a&&n,h=this.safeString(e,"withdrawalFee"),d=this.safeInteger(e,"tradeDecimals");let c;if(void 0!==h&&void 0!==d){const e=h.length-d;if(e>0){const t=h.slice(0,e),i=h.slice(-e);c=this.parseNumber(t+"."+i)}else{let t=".";for(let i=0;i<-e;i++)t+="0";c=this.parseNumber(t+h)}}return{id:i,code:i,info:e,type:void 0,name:s,active:o,deposit:r,withdraw:a,fee:c,precision:this.parseNumber(this.parsePrecision(this.safeString(e,"decimals"))),limits:{withdraw:{min:c,max:void 0},amount:{min:void 0,max:void 0}}}}parseTicker(e,t){const i=this.safeString(e,"market"),s=this.safeSymbol(i,t,"/"),r=this.parse8601(this.safeString(e,"timestamp")),a=this.safeString(e,"last"),n=this.safeString(e,"open");return this.safeTicker({symbol:s,info:e,timestamp:r,datetime:this.iso8601(r),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:n,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"volume"),quoteVolume:this.safeString(e,"volumeQuote")},t)}parseTrade(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t),r=this.parse8601(this.safeString(e,"timestamp")),a=this.safeString(e,"price"),n=this.safeString(e,"quantity"),o=this.parseNumber(a),h=this.parseNumber(n),d=this.parseNumber(g.stringMul(a,n)),c=this.safeString(e,"id"),l=this.safeStringLower2(e,"direction","side"),u=this.safeStringLower(e,"makerOrTaker");let f,p;void 0!==u&&(f=this.safeString(e,u+"OrderId"));const m=this.safeNumber(e,"fee"),y=this.safeCurrencyCode(this.safeString(e,"feeToken"));return void 0!==m&&(p={cost:m,currency:y}),{info:e,id:c,timestamp:r,datetime:this.iso8601(r),symbol:s,order:f,type:void 0,side:l,price:o,amount:h,cost:d,takerOrMaker:u,fee:p}}parseOHLCV(e,t){return[this.parse8601(this.safeString(e,"timestamp")),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}parseOrder(e,t){const i=this.safeString(e,"id"),s=this.safeStringLower(e,"type"),r=this.safeStringLower(e,"side"),a=this.safeString(e,"symbol"),n=this.safeSymbol(a,t),o=this.parse8601(this.safeString(e,"createdAt")),h=this.safeString(e,"price"),d=this.safeString(e,"quantity"),c=this.safeString(e,"filledQuantity"),l=this.omitZero(this.safeString(e,"cancelledQuantity"));let u;u=g.stringEquals(c,d)?"closed":void 0!==l?"canceled":"open";const f=this.safeValue(e,"trades",[]),p=this.safeString(e,"clientOrderId");return this.safeOrder({info:e,id:i,clientOrderId:p,timestamp:o,datetime:this.iso8601(o),lastTradeTimestamp:void 0,symbol:n,type:s,timeInForce:void 0,postOnly:void 0,side:r,price:h,stopPrice:void 0,triggerPrice:void 0,amount:d,cost:void 0,average:void 0,filled:c,remaining:void 0,status:u,fee:void 0,trades:f},t)}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+t+"/"+e;if(Object.keys(s).length&&(n+="?"+this.urlencodeWithArrayRepeat(s)),"public"!==t){this.checkRequiredCredentials();const e=this.stringToBase64(this.apiKey+":"+this.secret);r={authorization:"Basic "+this.decode(e)}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,n,o,h,d){if(void 0!==o&&e>=400){const e=this.id+" "+n;let t=this.safeValue(o,"error");void 0===t&&(t=o);const i=this.safeString2(t,"code","status"),s=this.safeString2(t,"message","debugMessage");throw this.throwBroadlyMatchedException(this.exceptions.broad,s,e),this.throwExactlyMatchedException(this.exceptions.exact,i,e),this.throwExactlyMatchedException(this.exceptions.exact,s,e),new a(e)}}}},9655:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,ExchangeNotAvailable:n,InsufficientFunds:o,OrderNotFound:h,InvalidOrder:d,DDoSProtection:c,InvalidNonce:l,AuthenticationError:u,RateLimitExceeded:f,PermissionDenied:p,NotSupported:m,BadRequest:g,BadSymbol:y,AccountSuspended:b,OrderImmediatelyFillable:v,OnMaintenance:w,BadResponse:S,RequestTimeout:k,OrderNotFillable:T,MarginModeAlreadySet:_}=i(73449),{TRUNCATE:O,DECIMAL_PLACES:M}=i(62115),I=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"tokocrypto",name:"Tokocrypto",countries:["ID"],certified:!1,pro:!1,version:"v1",has:{CORS:void 0,spot:!0,margin:!0,swap:!1,future:!1,option:!1,addMargin:void 0,borrowMargin:void 0,cancelAllOrders:!1,cancelOrder:!0,cancelOrders:void 0,createDepositAddress:!1,createOrder:!0,createReduceOnlyOrder:void 0,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!0,fetchAccounts:!1,fetchBalance:!0,fetchBidsAsks:!0,fetchBorrowInterest:void 0,fetchBorrowRate:void 0,fetchBorrowRateHistories:void 0,fetchBorrowRateHistory:void 0,fetchBorrowRates:void 0,fetchBorrowRatesPerSymbol:void 0,fetchCanceledOrders:!1,fetchClosedOrder:!1,fetchClosedOrders:"emulated",fetchCurrencies:!1,fetchDeposit:!1,fetchDepositAddress:!0,fetchDepositAddresses:!1,fetchDepositAddressesByNetwork:!1,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchL3OrderBook:!1,fetchLedger:void 0,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarketLeverageTiers:"emulated",fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrder:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderBooks:!1,fetchOrders:!0,fetchOrderTrades:!1,fetchPosition:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchStatus:!1,fetchTicker:!1,fetchTickers:!1,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTradingLimits:!1,fetchTransactionFee:!1,fetchTransactionFees:!1,fetchTransactions:!1,fetchTransfers:!1,fetchWithdrawal:!1,fetchWithdrawals:!0,fetchWithdrawalWhitelist:!1,reduceMargin:!1,repayMargin:!1,setLeverage:!1,setMargin:!1,setMarginMode:!1,setPositionMode:!1,signIn:!1,transfer:!1,withdraw:!1},timeframes:{"1m":"1m","3m":"3m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","2h":"2h","4h":"4h","6h":"6h","8h":"8h","12h":"12h","1d":"1d","3d":"3d","1w":"1w","1M":"1M"},urls:{logo:"https://user-images.githubusercontent.com/1294454/183870484-d3398d0c-f6a1-4cce-91b8-d58792308716.jpg",api:{rest:{public:"https://www.tokocrypto.com",binance:"https://api.binance.com/api/v3",private:"https://www.tokocrypto.com"}},www:"https://tokocrypto.com",doc:"https://www.tokocrypto.com/apidocs/",fees:"https://www.tokocrypto.com/fees/newschedule"},api:{binance:{get:{ping:1,time:1,depth:{cost:1,byLimit:[[100,1],[500,5],[1e3,10],[5e3,50]]},trades:1,aggTrades:1,historicalTrades:5,klines:1,"ticker/24hr":{cost:1,noSymbol:40},"ticker/price":{cost:1,noSymbol:2},"ticker/bookTicker":{cost:1,noSymbol:2},exchangeInfo:10},put:{userDataStream:1},post:{userDataStream:1},delete:{userDataStream:1}},public:{get:{"open/v1/common/time":1,"open/v1/common/symbols":1,"open/v1/market/depth":1,"open/v1/market/trades":1,"open/v1/market/agg-trades":1,"open/v1/market/klines":1}},private:{get:{"open/v1/orders/detail":1,"open/v1/orders":1,"open/v1/account/spot":1,"open/v1/account/spot/asset":1,"open/v1/orders/trades":1,"open/v1/withdraws":1,"open/v1/deposits":1,"open/v1/deposits/address":1},post:{"open/v1/orders":1,"open/v1/orders/cancel":1,"open/v1/orders/oco":1,"open/v1/withdraws":1,"open/v1/user-data-stream":1}}},fees:{trading:{tierBased:!0,percentage:!0,taker:this.parseNumber("0.0075"),maker:this.parseNumber("0.0075")}},precisionMode:M,options:{defaultTimeInForce:"GTC",hasAlreadyAuthenticatedSuccessfully:!1,warnOnFetchOpenOrdersWithoutSymbol:!0,recvWindow:5e3,timeDifference:0,adjustForTimeDifference:!1,newOrderRespType:{market:"FULL",limit:"FULL"},quoteOrderQty:!1,networks:{ERC20:"ETH",TRC20:"TRX",BEP2:"BNB",BEP20:"BSC",OMNI:"OMNI",EOS:"EOS",SPL:"SOL"},reverseNetworks:{"tronscan.org":"TRC20","etherscan.io":"ERC20","bscscan.com":"BSC","explorer.binance.org":"BEP2","bithomp.com":"XRP","bloks.io":"EOS","stellar.expert":"XLM","blockchair.com/bitcoin":"BTC","blockchair.com/bitcoin-cash":"BCH","blockchair.com/ecash":"XEC","explorer.litecoin.net":"LTC","explorer.avax.network":"AVAX","solscan.io":"SOL","polkadot.subscan.io":"DOT","dashboard.internetcomputer.org":"ICP","explorer.chiliz.com":"CHZ","cardanoscan.io":"ADA","mainnet.theoan.com":"AION","algoexplorer.io":"ALGO","explorer.ambrosus.com":"AMB","viewblock.io/zilliqa":"ZIL","viewblock.io/arweave":"AR","explorer.ark.io":"ARK","atomscan.com":"ATOM","www.mintscan.io":"CTK","explorer.bitcoindiamond.org":"BCD","btgexplorer.com":"BTG","bts.ai":"BTS","explorer.celo.org":"CELO","explorer.nervos.org":"CKB","cerebro.cortexlabs.ai":"CTXC","chainz.cryptoid.info":"VIA","explorer.dcrdata.org":"DCR","digiexplorer.info":"DGB","dock.subscan.io":"DOCK","dogechain.info":"DOGE","explorer.elrond.com":"EGLD","blockscout.com":"ETC","explore-fetchhub.fetch.ai":"FET","filfox.info":"FIL","fio.bloks.io":"FIO","explorer.firo.org":"FIRO","neoscan.io":"NEO","ftmscan.com":"FTM","explorer.gochain.io":"GO","block.gxb.io":"GXS","hash-hash.info":"HBAR","www.hiveblockexplorer.com":"HIVE","explorer.helium.com":"HNT","tracker.icon.foundation":"ICX","www.iostabc.com":"IOST","explorer.iota.org":"IOTA","iotexscan.io":"IOTX","irishub.iobscan.io":"IRIS","kava.mintscan.io":"KAVA","scope.klaytn.com":"KLAY","kmdexplorer.io":"KMD","kusama.subscan.io":"KSM","explorer.lto.network":"LTO","polygonscan.com":"POLYGON","explorer.ont.io":"ONT","minaexplorer.com":"MINA","nanolooker.com":"NANO","explorer.nebulas.io":"NAS","explorer.nbs.plus":"NBS","explorer.nebl.io":"NEBL","nulscan.io":"NULS","nxscan.com":"NXS","explorer.harmony.one":"ONE","explorer.poa.network":"POA","qtum.info":"QTUM","explorer.rsk.co":"RSK","www.oasisscan.com":"ROSE","ravencoin.network":"RVN","sc.tokenview.com":"SC","secretnodes.com":"SCRT","explorer.skycoin.com":"SKY","steemscan.com":"STEEM","explorer.stacks.co":"STX","www.thetascan.io":"THETA","scan.tomochain.com":"TOMO","explore.vechain.org":"VET","explorer.vite.net":"VITE","www.wanscan.org":"WAN","wavesexplorer.com":"WAVES","wax.eosx.io":"WAXP","waltonchain.pro":"WTC","chain.nem.ninja":"XEM","verge-blockchain.info":"XVG","explorer.yoyow.org":"YOYOW","explorer.zcha.in":"ZEC","explorer.zensystem.io":"ZEN"},impliedNetworks:{ETH:{ERC20:"ETH"},TRX:{TRC20:"TRX"}},legalMoney:{MXN:!0,UGX:!0,SEK:!0,CHF:!0,VND:!0,AED:!0,DKK:!0,KZT:!0,HUF:!0,PEN:!0,PHP:!0,USD:!0,TRY:!0,EUR:!0,NGN:!0,PLN:!0,BRL:!0,ZAR:!0,KES:!0,ARS:!0,RUB:!0,AUD:!0,NOK:!0,CZK:!0,GBP:!0,UAH:!0,GHS:!0,HKD:!0,CAD:!0,INR:!0,JPY:!0,NZD:!0}},exceptions:{exact:{"System is under maintenance.":w,"System abnormality":r,"You are not authorized to execute this request.":p,"API key does not exist":u,"Order would trigger immediately.":v,"Stop price would trigger immediately.":v,"Order would immediately match and take.":v,"Account has insufficient balance for requested action.":o,"Rest API trading is not enabled.":n,"You don't have permission.":p,"Market is closed.":n,"Too many requests. Please try again later.":c,"This action disabled is on this account.":b,"-1000":n,"-1001":n,"-1002":u,"-1003":f,"-1004":c,"-1005":p,"-1006":S,"-1007":k,"-1010":S,"-1011":p,"-1013":d,"-1014":d,"-1015":f,"-1016":n,"-1020":g,"-1021":l,"-1022":u,"-1023":g,"-1099":u,"-1100":g,"-1101":g,"-1102":g,"-1103":g,"-1104":g,"-1105":g,"-1106":g,"-1108":g,"-1109":u,"-1110":g,"-1111":g,"-1112":d,"-1113":g,"-1114":g,"-1115":g,"-1116":g,"-1117":g,"-1118":g,"-1119":g,"-1120":g,"-1121":y,"-1125":u,"-1127":g,"-1128":g,"-1130":g,"-1131":g,"-1136":g,"-2008":u,"-2010":r,"-2011":h,"-2013":h,"-2014":u,"-2015":u,"-2016":g,"-2018":o,"-2019":o,"-2020":T,"-2021":v,"-2022":d,"-2023":o,"-2024":o,"-2025":d,"-2026":d,"-2027":d,"-2028":o,"-3000":r,"-3001":u,"-3002":y,"-3003":g,"-3004":r,"-3005":o,"-3006":o,"-3007":r,"-3008":o,"-3009":g,"-3010":r,"-3011":g,"-3012":r,"-3013":g,"-3014":b,"-3015":r,"-3016":g,"-3017":r,"-3018":b,"-3019":b,"-3020":o,"-3021":g,"-3022":b,"-3023":g,"-3024":r,"-3025":g,"-3026":g,"-3027":y,"-3028":y,"-3029":r,"-3036":b,"-3037":r,"-3038":g,"-3041":o,"-3042":g,"-3043":g,"-3044":c,"-3045":r,"-3999":r,"-4001":g,"-4002":g,"-4003":g,"-4004":u,"-4005":f,"-4006":g,"-4007":g,"-4008":g,"-4010":g,"-4011":g,"-4012":g,"-4013":u,"-4014":p,"-4015":r,"-4016":p,"-4017":p,"-4018":y,"-4019":y,"-4021":g,"-4022":g,"-4023":r,"-4024":o,"-4025":o,"-4026":o,"-4027":r,"-4028":g,"-4029":g,"-4030":r,"-4031":r,"-4032":r,"-4033":g,"-4034":r,"-4035":p,"-4036":g,"-4037":r,"-4038":r,"-4039":g,"-4040":g,"-4041":r,"-4042":r,"-4043":g,"-4044":g,"-4045":r,"-4046":u,"-4047":g,"-5001":g,"-5002":o,"-5003":o,"-5004":g,"-5005":o,"-5006":g,"-5007":g,"-5008":o,"-5009":g,"-5010":r,"-5011":g,"-5012":r,"-5013":o,"-5021":g,"-6001":g,"-6003":g,"-6004":r,"-6005":d,"-6006":g,"-6007":g,"-6008":g,"-6009":f,"-6011":g,"-6012":o,"-6013":r,"-6014":g,"-6015":g,"-6016":g,"-6017":g,"-6018":g,"-6019":u,"-6020":g,"-7001":g,"-7002":g,"-9000":o,"-10017":g,"-11008":o,"-12014":f,"-13000":g,"-13001":g,"-13002":g,"-13003":g,"-13004":g,"-13005":g,"-13006":d,"-13007":u,"-21001":g,"-21002":g,"-21003":g,100001003:g,2202:o,3210:d,3203:d,3211:d,3207:d,3218:h},broad:{"has no operation privilege":p,MAX_POSITION:d}}})}nonce(){return this.milliseconds()-this.options.timeDifference}async fetchTime(e={}){const t=await this.publicGetTime(e);return this.safeInteger(t,"serverTime")}async fetchMarkets(e={}){const t=await this.publicGetOpenV1CommonSymbols(e);this.options.adjustForTimeDifference&&await this.loadTimeDifference();const i=this.safeValue(t,"data",{}),s=this.safeValue(i,"list",[]),r=[];for(let e=0;e<s.length;e++){const t=s[e],i=this.safeString(t,"baseAsset"),a=this.safeString(t,"quoteAsset"),n=this.safeString(t,"symbol"),o=this.safeStringLower(t,"symbol"),h=this.safeString(t,"marginAsset"),d=this.safeCurrencyCode(i),c=this.safeCurrencyCode(a),l=this.safeCurrencyCode(h),u=d+"/"+c,f=this.safeValue(t,"filters",[]),p=this.indexBy(f,"filterType");let m="TRADING"===this.safeString2(t,"status","contractStatus");const g=this.safeValue(t,"permissions",[]);for(let e=0;e<g.length;e++)if("TRD_GRP_003"===g[e]){m=!1;break}const y={id:n,lowercaseId:o,symbol:u,base:d,quote:c,settle:l,baseId:i,quoteId:a,settleId:h,type:"spot",spot:!0,margin:this.safeValue(t,"isMarginTradingAllowed",!1),swap:!1,future:!1,delivery:!1,option:!1,active:m,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeInteger(t,"quantityPrecision"),price:this.safeInteger(t,"pricePrecision"),base:this.safeInteger(t,"baseAssetPrecision"),quote:this.safeInteger(t,"quotePrecision")},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:t};if("PRICE_FILTER"in p){const e=this.safeValue(p,"PRICE_FILTER",{}),t=this.safeString(e,"tickSize");y.precision.price=this.precisionFromString(t),y.limits.price={min:this.safeNumber(e,"minPrice"),max:this.safeNumber(e,"maxPrice")},y.precision.price=this.precisionFromString(e.tickSize)}if("LOT_SIZE"in p){const e=this.safeValue(p,"LOT_SIZE",{}),t=this.safeString(e,"stepSize");y.precision.amount=this.precisionFromString(t),y.limits.amount={min:this.safeNumber(e,"minQty"),max:this.safeNumber(e,"maxQty")}}if("MARKET_LOT_SIZE"in p){const e=this.safeValue(p,"MARKET_LOT_SIZE",{});y.limits.market={min:this.safeNumber(e,"minQty"),max:this.safeNumber(e,"maxQty")}}if("MIN_NOTIONAL"in p){const e=this.safeValue(p,"MIN_NOTIONAL",{});y.limits.cost.min=this.safeNumber2(e,"minNotional","notional")}r.push(y)}return r}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.baseId+s.quoteId};void 0!==t&&(r.limit=t);const a=await this.binanceGetDepth(this.extend(r,i)),n=this.safeInteger(a,"T"),o=this.parseOrderBook(a,e,n);return o.nonce=this.safeInteger(a,"lastUpdateId"),o}parseTrade(e,t){const i=this.safeInteger2(e,"T","time"),s=this.safeString2(e,"p","price"),r=this.safeString2(e,"q","qty"),a=this.safeString2(e,"quoteQty","baseQty"),n=this.safeString(e,"symbol"),o=this.safeSymbol(n,t);let h,d=this.safeString2(e,"t","a");d=this.safeString2(e,"id","tradeId",d);const c=this.safeString(e,"orderId"),l=this.safeValue2(e,"m","isBuyerMaker");let u,f;return void 0!==l?(h=l?"sell":"buy",u="taker"):"side"in e?h=this.safeStringLower(e,"side"):"isBuyer"in e&&(h=e.isBuyer?"buy":"sell"),"commission"in e&&(f={cost:this.safeString(e,"commission"),currency:this.safeCurrencyCode(this.safeString(e,"commissionAsset"))}),"isMaker"in e&&(u=e.isMaker?"maker":"taker"),"maker"in e&&(u=e.maker?"maker":"taker"),this.safeTrade({info:e,timestamp:i,datetime:this.iso8601(i),symbol:o,id:d,order:c,type:void 0,side:h,takerOrMaker:u,price:s,amount:r,cost:a,fee:f},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.baseId+r.quoteId},n=this.safeString(this.options,"fetchTradesMethod","binanceGetTrades");"binanceGetAggTrades"===n&&void 0!==t&&(a.startTime=t,a.endTime=this.sum(t,36e5)),void 0!==i&&(a.limit=i);const o=await this[n](this.extend(a,s));return this.parseTrades(o,r,t,i)}parseTicker(e,t){const i=this.safeInteger(e,"closeTime"),s=this.safeString(e,"symbol"),r=this.safeSymbol(s,t),a=this.safeString(e,"lastPrice");let n,o;return"baseVolume"in e?(n=this.safeString(e,"baseVolume"),o=this.safeString(e,"volume")):(n=this.safeString(e,"volume"),o=this.safeString(e,"quoteVolume")),this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"highPrice"),low:this.safeString(e,"lowPrice"),bid:this.safeString(e,"bidPrice"),bidVolume:this.safeString(e,"bidQty"),ask:this.safeString(e,"askPrice"),askVolume:this.safeString(e,"askQty"),vwap:this.safeString(e,"weightedAvgPrice"),open:this.safeString(e,"openPrice"),close:a,last:a,previousClose:this.safeString(e,"prevClosePrice"),change:this.safeString(e,"priceChange"),percentage:this.safeString(e,"priceChangePercent"),average:void 0,baseVolume:n,quoteVolume:o,info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets();const i=this.safeString(this.options,"fetchTickersMethod","binanceGetTicker24hr"),s=await this[i](t);return this.parseTickers(s,e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.baseId+i.quoteId},r=await this.binanceGetTicker24hr(this.extend(s,t));if(Array.isArray(r)){const e=this.safeValue(r,0,{});return this.parseTicker(e,i)}return this.parseTicker(r,i)}async fetchBidsAsks(e,t={}){await this.loadMarkets();const i=await this.binanceGetTickerBookTicker(t);return this.parseTickers(i,e)}parseOHLCV(e,t){return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.safeString(r,"price"),o=this.safeInteger(r,"until");r=this.omit(r,["price","until"]),s=void 0===s?500:Math.min(s,1500);const h={interval:this.safeString(this.timeframes,t,t),limit:s};"index"===n?h.pair=a.id:h.symbol=a.baseId+a.quoteId,void 0!==i&&(h.startTime=i),void 0!==o&&(h.endTime=o);const d=await this.binanceGetKlines(this.extend(h,r));return this.parseOHLCVs(d,a,t,i,s)}async fetchBalance(e={}){await this.loadMarkets();const t=this.safeString2(this.options,"fetchBalance","defaultType","spot"),i=this.safeString(e,"type",t),s=this.safeString2(this.options,"marginMode","defaultMarginMode"),r=this.safeStringLower(e,"marginMode",s),a=await this.privateGetOpenV1AccountSpot(this.extend({},e));return this.parseBalance(a,i,r)}parseBalance(e,t,i){const s=this.safeInteger(e,"updateTime"),r={info:e,timestamp:s,datetime:this.iso8601(s)},a=this.safeValue(e,"data",{}),n=this.safeValue(a,"accountAssets",[]);for(let e=0;e<n.length;e++){const t=n[e],i=this.safeString(t,"asset"),s=this.safeCurrencyCode(i),a=this.account();a.free=this.safeString(t,"free"),a.used=this.safeString(t,"locked"),r[s]=a}return this.safeBalance(r)}parseOrderStatus(e){return this.safeString({"-2":"open",0:"open",1:"open",2:"closed",3:"canceled",4:"canceling",5:"rejected",6:"expired",NEW:"open",PARTIALLY_FILLED:"open",FILLED:"closed",CANCELED:"canceled",PENDING_CANCEL:"canceling",REJECTED:"rejected",EXPIRED:"expired"},e,e)}parseOrder(e,t){const i=this.parseOrderStatus(this.safeString(e,"status")),s=this.safeString(e,"symbol"),r=this.safeSymbol(s,t),a=this.safeString(e,"executedQty","0"),n=this.safeInteger(e,"createTime"),o=this.safeString(e,"avgPrice"),h=this.safeString(e,"price"),d=this.safeString(e,"origQty");let c=this.safeString2(e,"cummulativeQuoteQty","cumQuote");c=this.safeString(e,"cumBase",c);const l=this.safeString(e,"orderId");let u=this.safeStringLower(e,"type"),f=this.safeStringLower(e,"side");"0"===f?f="buy":"1"===f&&(f="sell");const p=this.safeValue(e,"fills",[]),m=this.safeString(e,"clientOrderId");let g=this.safeString(e,"timeInForce");"GTX"===g&&(g="PO");const y="limit_maker"===u||"PO"===g;"limit_maker"===u&&(u="limit");const b=this.safeString(e,"stopPrice"),v=this.parseNumber(this.omitZero(b));return this.safeOrder({info:e,id:l,clientOrderId:m,timestamp:n,datetime:this.iso8601(n),lastTradeTimestamp:void 0,symbol:r,type:u,timeInForce:g,postOnly:y,reduceOnly:this.safeValue(e,"reduceOnly"),side:f,price:h,stopPrice:v,triggerPrice:v,amount:d,cost:c,average:o,filled:a,remaining:void 0,status:i,fee:void 0,trades:p},t)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=this.safeString2(a,"clientOrderId","clientId");this.safeValue(a,"postOnly",!1)&&(t="LIMIT_MAKER"),a=this.omit(a,["clientId","clientOrderId"]);const h=t.toUpperCase();let c=h;const l=this.safeValue2(a,"triggerPrice","stopPrice");void 0!==l&&(a=this.omit(a,["triggerPrice","stopPrice"]),"MARKET"===c?c="STOP_LOSS":"LIMIT"===c&&(c="STOP_LOSS_LIMIT"));const u=this.safeValue(n.info,"orderTypes");if(!this.inArray(c,u))throw new d(h!==c?this.id+" stopPrice parameter is not allowed for "+e+" "+t+" orders":this.id+" "+t+" is not a valid order type for the "+e+" market");const f={symbol:n.baseId+"_"+n.quoteId,type:this.safeString({LIMIT:1,MARKET:2,STOP_LOSS:3,STOP_LOSS_LIMIT:4,TAKE_PROFIT:5,TAKE_PROFIT_LIMIT:6,LIMIT_MAKER:7},c)};if("buy"===i?f.side=0:"sell"===i&&(f.side=1),void 0===o){const e=this.safeValue(this.options,"broker");if(void 0!==e){const t=this.safeString(e,"marketType");void 0!==t&&(f.clientId=t+this.uuid22())}}else f.clientId=o;let p=!1,m=!1,g=!1;if("MARKET"===c){if(this.safeValue(this.options,"quoteOrderQty",!0)){const e=this.safeValue2(a,"quoteOrderQty","cost"),t=n.precision.price;void 0!==e?(f.quoteOrderQty=this.decimalToPrecision(e,O,t,this.precisionMode),a=this.omit(a,["quoteOrderQty","cost"])):void 0!==r?f.quoteOrderQty=this.decimalToPrecision(s*r,O,t,this.precisionMode):g=!0}else g=!0}else"LIMIT"===c?(p=!0,g=!0):"STOP_LOSS"===c||"TAKE_PROFIT"===c?(m=!0,g=!0,(n.linear||n.inverse)&&(p=!0)):"STOP_LOSS_LIMIT"===c||"TAKE_PROFIT_LIMIT"===c?(g=!0,m=!0,p=!0):"LIMIT_MAKER"===c&&(p=!0,g=!0);if(g&&(f.quantity=this.amountToPrecision(e,s)),p){if(void 0===r)throw new d(this.id+" createOrder() requires a price argument for a "+t+" order");f.price=this.priceToPrecision(e,r)}if(m){if(void 0===l)throw new d(this.id+" createOrder() requires a stopPrice extra param for a "+t+" order");f.stopPrice=this.priceToPrecision(e,l)}const y=await this.privatePostOpenV1Orders(this.extend(f,a)),b=this.safeValue(y,"data",{});return this.parseOrder(b,n)}async fetchOrder(e,t,i={}){const s={orderId:e},r=await this.privateGetOpenV1Orders(this.extend(s,i)),a=this.safeValue(r,"data",{}),n=this.safeValue(a,"list",[]),o=this.safeValue(n,0,{});return this.parseOrder(o)}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={symbol:r.id};void 0!==t&&(n.startTime=t),void 0!==i&&(n.limit=i);const o=await this.privateGetOpenV1Orders(this.extend(n,s)),h=this.safeValue(o,"data",{}),d=this.safeValue(h,"list",[]);return this.parseOrders(d,r,t,i)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({type:1},s))}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrders(e,t,i,this.extend({type:2},s))}async cancelOrder(e,t,i={}){const s={orderId:e},r=await this.privatePostOpenV1OrdersCancel(this.extend(s,i)),a=this.safeValue(r,"data",{});return this.parseOrder(a)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),n={symbol:r.id},o=this.safeInteger2(s,"until","endTime");if(void 0!==t){const e=parseInt(t);n.startTime=e}void 0!==o&&(n.endTime=o,s=this.omit(s,["endTime","until"])),void 0!==i&&(n.limit=i);const h=await this.privateGetOpenV1OrdersTrades(this.extend(n,s)),d=this.safeValue(h,"data",{}),c=this.safeValue(d,"list",[]);return this.parseTrades(c,r,t,i)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={asset:this.currency(e).id},s=this.safeValue(this.options,"networks",{});let r=this.safeStringUpper(t,"network");r=this.safeString(s,r,r),void 0!==r&&(i.network=r,t=this.omit(t,"network"));const a=await this.privateGetOpenV1DepositsAddress(this.extend(i,t)),n=this.safeValue(a,"data",{}),o=this.safeString(n,"address");let h=this.safeString(n,"addressTag","");return 0===h.length&&(h=void 0),this.checkAddress(o),{currency:e,address:o,tag:h,network:this.safeString(n,"network"),info:a}}async fetchDeposits(e,t,i,s={}){let r;await this.loadMarkets();const a={},n=this.safeInteger(s,"until");if(void 0!==e&&(r=this.currency(e),a.coin=r.id),void 0!==t){a.startTime=t;let e=this.sum(t,7776e6);void 0!==n&&(e=Math.min(e,n)),a.endTime=e}void 0!==i&&(a.limit=i);const o=await this.privateGetOpenV1Deposits(this.extend(a,s)),h=this.safeValue(o,"data",{}),d=this.safeValue(h,"list",[]);return this.parseTransactions(d,r,t,i)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.coin=a.id),void 0!==t&&(r.startTime=t,r.endTime=this.sum(t,7776e6)),void 0!==i&&(r.limit=i);const n=await this.privateGetOpenV1Withdraws(this.extend(r,s)),o=this.safeValue(n,"data",{}),h=this.safeValue(o,"list",[]);return this.parseTransactions(h,a,t,i)}parseTransactionStatusByType(e,t){const i=this.safeValue({deposit:{0:"pending",1:"ok"},withdrawal:{0:"pending",1:"canceled",2:"pending",3:"failed",4:"pending",5:"failed",10:"ok"}},t,{});return this.safeString(i,e,e)}parseTransaction(e,t){const i=this.safeString(e,"address");let s=this.safeString(e,"addressTag");void 0!==s&&s.length<1&&(s=void 0);let r=this.safeString(e,"txId");void 0!==r&&r.indexOf("Internal transfer ")>=0&&(r=r.slice(18));const a=this.safeString2(e,"coin","fiatCurrency"),n=this.safeCurrencyCode(a,t);let o;const h=this.safeInteger(e,"insertTime"),d=this.safeInteger(e,"createTime");let c=this.safeString(e,"type");void 0===c&&(void 0!==h&&void 0===d?(c="deposit",o=h):void 0===h&&void 0!==d&&(c="withdrawal",o=d));const l=this.safeNumber2(e,"transactionFee","totalFee"),u={currency:void 0,cost:void 0,rate:void 0};void 0!==l&&(u.currency=n,u.cost=l);let f=this.safeInteger(e,"transferType");return void 0!==f&&(f=!!f),{info:e,id:this.safeString(e,"id"),txid:r,type:c,currency:n,network:this.safeString(e,"network"),amount:this.safeNumber(e,"amount"),status:this.parseTransactionStatusByType(this.safeString(e,"status"),c),timestamp:o,datetime:this.iso8601(o),address:i,addressFrom:void 0,addressTo:i,tag:s,tagFrom:void 0,tagTo:s,updated:this.safeInteger2(e,"successTime","updateTime"),comment:void 0,internal:f,fee:u}}sign(e,t="public",i="GET",s={},r,a){if(!(t in this.urls.api.rest))throw new m(this.id+" does not have a testnet/sandbox URL for "+t+" endpoints");let n=this.urls.api.rest[t];n+="/"+e,"wapi"===t&&(n+=".html");if("userDataStream"===e||"listenKey"===e){if(!this.apiKey)throw new u(this.id+" userDataStream endpoint requires `apiKey` credential");r={"X-MBX-APIKEY":this.apiKey,"Content-Type":"application/x-www-form-urlencoded"},"GET"!==i&&(a=this.urlencode(s))}else if("private"===t||"sapi"===t&&"system/status"!==e||"sapiV3"===t||"wapi"===t&&"systemStatus"!==e||"dapiPrivate"===t||"dapiPrivateV2"===t||"fapiPrivate"===t||"fapiPrivateV2"===t){let o;this.checkRequiredCredentials();const h=this.safeInteger(this.options,"recvWindow"),d=this.extend({timestamp:this.nonce()},s);void 0!==h&&(d.recvWindow=h);const c=this.safeInteger(s,"recvWindow");void 0!==c&&(d.recvWindow=c),o="sapi"===t&&"asset/dust"===e?this.urlencodeWithArrayRepeat(d):"batchOrders"===e||e.indexOf("sub-account")>=0||"capital/withdraw/apply"===e||e.indexOf("staking")>=0?this.rawencode(d):this.urlencode(d);o+="&signature="+this.hmac(this.encode(o),this.encode(this.secret)),r={"X-MBX-APIKEY":this.apiKey},"GET"===i||"DELETE"===i||"wapi"===t?n+="?"+o:(a=o,r["Content-Type"]="application/x-www-form-urlencoded")}else Object.keys(s).length&&(n+="?"+this.urlencode(s));return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,l){if(418===e||429===e)throw new c(this.id+" "+e.toString()+" "+t+" "+n);if(e>=400){if(n.indexOf("Price * QTY is zero or less")>=0)throw new d(this.id+" order cost = amount * price is zero or less "+n);if(n.indexOf("LOT_SIZE")>=0)throw new d(this.id+" order amount should be evenly divisible by lot size "+n);if(n.indexOf("PRICE_FILTER")>=0)throw new d(this.id+" order price is invalid, i.e. exceeds allowed price precision, exceeds min price or max price limits or is invalid value in general, use this.priceToPrecision (symbol, amount) "+n)}if(void 0===o)return;const u=this.safeValue(o,"success",!0);if(!u){const e=this.safeString(o,"msg");let t;if(void 0!==e){try{t=JSON.parse(e)}catch(e){t=void 0}void 0!==t&&(o=t)}}const f=this.safeString(o,"msg");void 0!==f&&(this.throwExactlyMatchedException(this.exceptions.exact,f,this.id+" "+f),this.throwBroadlyMatchedException(this.exceptions.broad,f,this.id+" "+f));const p=this.safeString(o,"code");if(void 0!==p){if("200"===p||I.stringEquals(p,"0"))return;if("-2015"===p&&this.options.hasAlreadyAuthenticatedSuccessfully)throw new c(this.id+" "+n);const e=this.id+" "+n;if("No need to change margin type."===f)throw new _(e);throw this.throwExactlyMatchedException(this.exceptions.exact,p,e),new r(e)}if(!u)throw new r(this.id+" "+n)}calculateRateLimiterCost(e,t,i,s,r={},a={}){if("noCoin"in r&&!("coin"in s))return r.noCoin;if("noSymbol"in r&&!("symbol"in s))return r.noSymbol;if("noPoolId"in r&&!("poolId"in s))return r.noPoolId;if("byLimit"in r&&"limit"in s){const e=s.limit,t=r.byLimit;for(let i=0;i<t.length;i++){const s=t[i];if(e<=s[0])return s[1]}}return this.safeInteger(r,"cost",1)}}},7705:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,BadRequest:a,AuthenticationError:n,InvalidOrder:o,InsufficientFunds:h,OrderNotFound:d,PermissionDenied:c,AddressPending:l}=i(73449),{TICK_SIZE:u}=i(62115),f=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"upbit",name:"Upbit",countries:["KR"],version:"v1",rateLimit:1e3,pro:!0,has:{CORS:!0,spot:!0,margin:void 0,swap:!1,future:!1,option:!1,cancelOrder:!0,createDepositAddress:!0,createMarketOrder:!0,createOrder:!0,fetchBalance:!0,fetchCanceledOrders:!0,fetchClosedOrders:!0,fetchDepositAddress:!0,fetchDepositAddresses:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!1,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderBooks:!0,fetchOrders:!1,fetchPositionMode:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!0,fetchTradingFees:!1,fetchTransactions:!1,fetchWithdrawals:!0,transfer:!1,withdraw:!0},timeframes:{"1m":"minutes","3m":"minutes","5m":"minutes","15m":"minutes","30m":"minutes","1h":"minutes","4h":"minutes","1d":"days","1w":"weeks","1M":"months"},hostname:"api.upbit.com",urls:{logo:"https://user-images.githubusercontent.com/1294454/49245610-eeaabe00-f423-11e8-9cba-4b0aed794799.jpg",api:{public:"https://{hostname}",private:"https://{hostname}"},www:"https://upbit.com",doc:"https://docs.upbit.com/docs/%EC%9A%94%EC%B2%AD-%EC%88%98-%EC%A0%9C%ED%95%9C",fees:"https://upbit.com/service_center/guide"},api:{public:{get:["market/all","candles/{timeframe}","candles/{timeframe}/{unit}","candles/minutes/{unit}","candles/minutes/1","candles/minutes/3","candles/minutes/5","candles/minutes/15","candles/minutes/30","candles/minutes/60","candles/minutes/240","candles/days","candles/weeks","candles/months","trades/ticks","ticker","orderbook"]},private:{get:["accounts","orders/chance","order","orders","withdraws","withdraw","withdraws/chance","deposits","deposit","deposits/coin_addresses","deposits/coin_address"],post:["orders","withdraws/coin","withdraws/krw","deposits/generate_coin_address"],delete:["order"]}},fees:{trading:{tierBased:!1,percentage:!0,maker:this.parseNumber("0.0025"),taker:this.parseNumber("0.0025")},funding:{tierBased:!1,percentage:!1,withdraw:{},deposit:{}}},precisionMode:u,exceptions:{exact:{"This key has expired.":n,"Missing request parameter error. Check the required parameters!":a,"side is missing, side does not have a valid value":o},broad:{thirdparty_agreement_required:c,out_of_scope:c,order_not_found:d,insufficient_funds:h,invalid_access_key:n,jwt_verification:n,create_ask_error:r,create_bid_error:r,volume_too_large:o,invalid_funds:o}},options:{createMarketBuyOrderRequiresPrice:!0,fetchTickersMaxLength:4096,fetchOrderBooksMaxLength:4096,tradingFeesByQuoteCurrency:{KRW:5e-4}},commonCurrencies:{TON:"Tokamak Network"}})}async fetchCurrency(e,t={}){await this.loadMarkets();const i=this.currency(e);return await this.fetchCurrencyById(i.id,t)}async fetchCurrencyById(e,t={}){const i={currency:e},s=await this.privateGetWithdrawsChance(this.extend(i,t)),r=this.safeValue(s,"member_level",{}),a=this.safeValue(s,"currency",{}),n=this.safeValue(s,"withdraw_limit",{}),o=this.safeValue(n,"can_withdraw"),h=this.safeString(a,"wallet_state"),d=this.safeValue(r,"wallet_locked"),c=this.safeValue(r,"locked");let l=!0;void 0===o||o?("working"!==h||void 0!==d&&d||void 0!==c&&c)&&(l=!1):l=!1;const u=this.safeNumber(n,"onetime"),f=this.safeNumber(n,"daily",u),p=this.safeNumber(n,"remaining_daily",f);let m;m=p>0?p:f;const g=this.safeString(a,"code"),y=this.safeCurrencyCode(g);return{info:s,id:g,code:y,name:y,active:l,fee:this.safeNumber(a,"withdraw_fee"),precision:void 0,limits:{withdraw:{min:this.safeNumber(n,"minimum"),max:m}}}}async fetchMarket(e,t={}){await this.loadMarkets();const i=this.market(e);return await this.fetchMarketById(i.id,t)}async fetchMarketById(e,t={}){const i={market:e},s=await this.privateGetOrdersChance(this.extend(i,t)),r=this.safeValue(s,"market"),a=this.safeValue(r,"bid"),n=this.safeValue(r,"ask"),o=this.safeString(r,"id"),h=this.safeString(n,"currency"),d=this.safeString(a,"currency"),c=this.safeCurrencyCode(h),l=this.safeCurrencyCode(d),u=this.safeString(r,"state"),f=this.safeNumber(s,"bid_fee"),p=this.safeNumber(s,"ask_fee"),m=Math.max(f,p);return{id:o,symbol:c+"/"+l,base:c,quote:l,settle:void 0,baseId:h,quoteId:d,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:"active"===u,contract:!1,linear:void 0,inverse:void 0,taker:m,maker:m,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber("1e-8"),price:this.parseNumber("1e-8")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(n,"min_total"),max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(a,"min_total"),max:this.safeNumber(r,"max_total")},info:s}}}async fetchMarkets(e={}){const t=await this.publicGetMarketAll(e),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"market"),[a,n]=r.split("-"),o=this.safeCurrencyCode(n),h=this.safeCurrencyCode(a);i.push({id:r,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:n,quoteId:a,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:!0,contract:!1,linear:void 0,inverse:void 0,taker:this.safeNumber(this.options.tradingFeesByQuoteCurrency,h,this.fees.trading.taker),maker:this.safeNumber(this.options.tradingFeesByQuoteCurrency,h,this.fees.trading.maker),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{price:this.parseNumber("1e-8"),amount:this.parseNumber("1e-8")},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:s})}return i}parseBalance(e){const t={info:e,timestamp:void 0,datetime:void 0};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"balance"),n.used=this.safeString(s,"locked"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetAccounts(e);return this.parseBalance(t)}async fetchOrderBooks(e,t,i={}){let s;if(await this.loadMarkets(),void 0===e){if(s=this.ids.join(","),s.length>this.options.fetchOrderBooksMaxLength){const e=this.ids.length;throw new r(this.id+" fetchOrderBooks() has "+e.toString()+" symbols ("+s.length.toString()+" characters) exceeding max URL length ("+this.options.fetchOrderBooksMaxLength.toString()+" characters), you are required to specify a list of symbols in the first argument to fetchOrderBooks")}}else s=this.marketIds(e),s=s.join(",");const a={markets:s},n=await this.publicGetOrderbook(this.extend(a,i)),o={};for(let e=0;e<n.length;e++){const t=n[e],i=this.safeString(t,"market"),s=this.safeSymbol(i,void 0,"-"),r=this.safeInteger(t,"timestamp");o[s]={symbol:s,bids:this.sortBy(this.parseBidsAsks(t.orderbook_units,"bid_price","bid_size"),0,!0),asks:this.sortBy(this.parseBidsAsks(t.orderbook_units,"ask_price","ask_size"),0),timestamp:r,datetime:this.iso8601(r),nonce:void 0}}return o}async fetchOrderBook(e,t,i={}){const s=await this.fetchOrderBooks([e],t,i);return this.safeValue(s,e)}parseTicker(e,t){const i=this.safeInteger(e,"trade_timestamp"),s=this.safeString2(e,"market","code");t=this.safeMarket(s,t,"-");const r=this.safeString(e,"trade_price");return this.safeTicker({symbol:t.symbol,timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high_price"),low:this.safeString(e,"low_price"),bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:this.safeString(e,"opening_price"),close:r,last:r,previousClose:this.safeString(e,"prev_closing_price"),change:this.safeString(e,"signed_change_price"),percentage:this.safeString(e,"signed_change_rate"),average:void 0,baseVolume:this.safeString(e,"acc_trade_volume_24h"),quoteVolume:this.safeString(e,"acc_trade_price_24h"),info:e},t)}async fetchTickers(e,t={}){let i;if(await this.loadMarkets(),void 0===(e=this.marketSymbols(e))){if(i=this.ids.join(","),i.length>this.options.fetchTickersMaxLength){const e=this.ids.length;throw new r(this.id+" fetchTickers() has "+e.toString()+" symbols exceeding max URL length, you are required to specify a list of symbols in the first argument to fetchTickers")}}else i=this.marketIds(e),i=i.join(",");const s={markets:i},a=await this.publicGetTicker(this.extend(s,t)),n={};for(let e=0;e<a.length;e++){const t=this.parseTicker(a[e]);n[t.symbol]=t}return this.filterByArray(n,"symbol",e)}async fetchTicker(e,t={}){const i=await this.fetchTickers([e],t);return this.safeValue(i,e)}parseTrade(e,t){const i=this.safeString2(e,"sequential_id","uuid");let s,r=this.safeInteger(e,"timestamp");void 0===r&&(r=this.parse8601(this.safeString(e,"created_at")));const a=this.safeStringLower2(e,"ask_bid","side");"ask"===a?s="sell":"bid"===a&&(s="buy");const n=this.safeString(e,"funds"),o=this.safeString2(e,"trade_price","price"),h=this.safeString2(e,"trade_volume","volume"),d=this.safeString2(e,"market","code");let c;t=this.safeMarket(d,t,"-");const l=this.safeString(e,a+"_fee");return void 0!==l&&(c={currency:t.quote,cost:l}),this.safeTrade({id:i,info:e,order:undefined,timestamp:r,datetime:this.iso8601(r),symbol:t.symbol,type:void 0,side:s,takerOrMaker:void 0,price:o,amount:h,cost:n,fee:c},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e);void 0===i&&(i=200);const a={market:r.id,count:i},n=await this.publicGetTradesTicks(this.extend(a,s));return this.parseTrades(n,r,t,i)}async fetchTradingFee(e,t={}){await this.loadMarkets();const i={market:this.market(e).id},s=await this.privateGetOrdersChance(this.extend(i,t)),r=this.safeString(s,"ask_fee"),a=this.safeString(s,"bid_fee"),n=f.stringMax(r,a),o=this.safeString(s,"maker_ask_fee"),h=this.safeString(s,"maker_bid_fee"),d=f.stringMax(o,h);return{info:s,symbol:e,maker:this.parseNumber(d),taker:this.parseNumber(n),percentage:!0,tierBased:!1}}parseOHLCV(e,t){return[this.parse8601(this.safeString(e,"candle_date_time_utc")),this.safeNumber(e,"opening_price"),this.safeNumber(e,"high_price"),this.safeNumber(e,"low_price"),this.safeNumber(e,"trade_price"),this.safeNumber(e,"candle_acc_trade_volume")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=this.parseTimeframe(t),o=this.safeString(this.timeframes,t,t);void 0===s&&(s=200);const h={market:a.id,timeframe:o,count:s};let d="publicGetCandlesTimeframe";if("minutes"===o){const e=Math.round(n/60);h.unit=e,d+="Unit"}void 0!==i&&(h.to=this.iso8601(this.sum(i,n*s*1e3)));const c=await this[d](this.extend(h,r));return this.parseOHLCVs(c,a,t,i,s)}async createOrder(e,t,i,s,r,a={}){if("market"===t&&"buy"===i&&this.options.createMarketBuyOrderRequiresPrice){if(void 0===r)throw new o(this.id+" createOrder() requires the price argument with market buy orders to calculate total order cost (amount to spend), where cost = amount * price. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount, or, alternatively, add .options['createMarketBuyOrderRequiresPrice'] = false to supply the cost in the amount argument (the exchange-specific behaviour)");s*=r}let n;if("buy"===i)n="bid";else{if("sell"!==i)throw new o(this.id+" createOrder() allows buy or sell side only!");n="ask"}await this.loadMarkets();const h={market:this.market(e).id,side:n};"limit"===t?(h.volume=this.amountToPrecision(e,s),h.price=this.priceToPrecision(e,r),h.ord_type=t):"market"===t&&("buy"===i?(h.ord_type="price",h.price=this.priceToPrecision(e,s)):"sell"===i&&(h.ord_type=t,h.volume=this.amountToPrecision(e,s)));const d=this.safeString2(a,"clientOrderId","identifier");void 0!==d&&(h.identifier=d),a=this.omit(a,["clientOrderId","identifier"]);const c=await this.privatePostOrders(this.extend(h,a));return this.parseOrder(c)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={uuid:e},r=await this.privateDeleteOrder(this.extend(s,i));return this.parseOrder(r)}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==i&&(r.limit=i);const n=await this.privateGetDeposits(this.extend(r,s));return this.parseTransactions(n,a,t,i)}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==i&&(r.limit=i);const n=await this.privateGetWithdraws(this.extend(r,s));return this.parseTransactions(n,a,t,i)}parseTransactionStatus(e){return this.safeString({submitting:"pending",submitted:"pending",almost_accepted:"pending",rejected:"failed",accepted:"pending",processing:"pending",done:"ok",canceled:"canceled"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"uuid"),s=this.safeNumber(e,"amount"),r=this.safeString(e,"txid"),a=this.safeString(e,"done_at"),n=this.parse8601(a),o=this.parse8601(this.safeString(e,"created_at",a));let h=this.safeString(e,"type");"withdraw"===h&&(h="withdrawal");const d=this.safeString(e,"currency"),c=this.safeCurrencyCode(d),l=this.parseTransactionStatus(this.safeStringLower(e,"state")),u=this.safeNumber(e,"fee");return{info:e,id:i,currency:c,amount:s,network:void 0,address:undefined,addressTo:void 0,addressFrom:void 0,tag:undefined,tagTo:void 0,tagFrom:void 0,status:l,type:h,updated:n,txid:r,timestamp:o,datetime:this.iso8601(o),fee:{currency:c,cost:u}}}parseOrderStatus(e){return this.safeString({wait:"open",done:"closed",cancel:"canceled"},e,e)}parseOrder(e,t){const i=this.safeString(e,"uuid");let s=this.safeString(e,"side");s="bid"===s?"buy":"sell";let r=this.safeString(e,"ord_type");const a=this.parse8601(this.safeString(e,"created_at")),n=this.parseOrderStatus(this.safeString(e,"state"));let o,h=this.safeNumber(e,"price");const d=this.safeNumber(e,"volume"),c=this.safeNumber(e,"remaining_volume"),l=this.safeNumber(e,"executed_volume");let u,f,p;"price"===r&&(r="market",u=h,h=void 0);let m=this.safeNumber(e,"paid_fee");const g=this.safeString(e,"market");t=this.safeMarket(g,t);let y=this.safeValue(e,"trades",[]);y=this.parseTrades(y,t,void 0,void 0,{order:i,type:r});const b=y.length;if(b>0){o=y[b-1].timestamp;let e=!1;void 0===m&&(e=!0,m=0),u=0;for(let t=0;t<b;t++){const i=y[t];if(u=this.sum(u,i.cost),e){const e=this.safeValue(y[t],"fee",{}),i=this.safeNumber(e,"cost");void 0!==i&&(m=this.sum(m,i))}}f=u/l}void 0!==m&&(p={currency:t.quote,cost:m});return{info:e,id:i,clientOrderId:void 0,timestamp:a,datetime:this.iso8601(a),lastTradeTimestamp:o,symbol:t.symbol,type:r,timeInForce:void 0,postOnly:void 0,side:s,price:h,stopPrice:void 0,triggerPrice:void 0,cost:u,average:f,amount:d,filled:l,remaining:c,status:n,fee:p,trades:y}}async fetchOrdersByState(e,t,i,s,r={}){await this.loadMarkets();const a={state:e};let n;void 0!==t&&(n=this.market(t),a.market=n.id);const o=await this.privateGetOrders(this.extend(a,r));return this.parseOrders(o,n,i,s)}async fetchOpenOrders(e,t,i,s={}){return await this.fetchOrdersByState("wait",e,t,i,s)}async fetchClosedOrders(e,t,i,s={}){return await this.fetchOrdersByState("done",e,t,i,s)}async fetchCanceledOrders(e,t,i,s={}){return await this.fetchOrdersByState("cancel",e,t,i,s)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={uuid:e},r=await this.privateGetOrder(this.extend(s,i));return this.parseOrder(r)}async fetchDepositAddresses(e,t={}){await this.loadMarkets();const i=await this.privateGetDepositsCoinAddresses(t);return this.parseDepositAddresses(i)}parseDepositAddress(e,t){const i=this.safeString(e,"deposit_address"),s=this.safeString(e,"secondary_address"),r=this.safeString(e,"currency"),a=this.safeCurrencyCode(r);return this.checkAddress(i),{currency:a,address:i,tag:s,network:void 0,info:e}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s=await this.privateGetDepositsCoinAddress(this.extend({currency:i.id},t));return this.parseDepositAddress(s)}async createDepositAddress(e,t={}){await this.loadMarkets();const i={currency:this.currency(e).id},s=await this.privatePostDepositsGenerateCoinAddress(this.extend(i,t));if(void 0!==this.safeString(s,"message"))throw new l(this.id+" is generating "+e+" deposit address, call fetchDepositAddress or createDepositAddress one more time later to retrieve the generated address");return this.parseDepositAddress(s)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const a=this.currency(e),n={amount:t};let o="privatePostWithdraws";"KRW"!==e?(o+="Coin",n.currency=a.id,n.address=i,void 0!==s&&(n.secondary_address=s)):o+="Krw";const h=await this[o](this.extend(n,r));return this.parseTransaction(h)}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){let n=this.implodeParams(this.urls.api[t],{hostname:this.hostname});n+="/"+this.version+"/"+this.implodeParams(e,s);const o=this.omit(s,this.extractParams(e));if("POST"!==i&&Object.keys(o).length&&(n+="?"+this.urlencode(o)),"private"===t){this.checkRequiredCredentials();const e=this.nonce(),t={access_key:this.apiKey,nonce:e};if(Object.keys(o).length){const e=this.urlencode(o),i=this.hash(this.encode(e),"sha512");t.query_hash=i,t.query_hash_alg="SHA512"}r={Authorization:"Bearer "+this.jwt(t,this.encode(this.secret))},"GET"!==i&&"DELETE"!==i&&(a=this.json(s),r["Content-Type"]="application/json")}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;const c=this.safeValue(o,"error");if(void 0!==c){const e=this.safeString(c,"message"),t=this.safeString(c,"name"),i=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,e,i),this.throwExactlyMatchedException(this.exceptions.exact,t,i),this.throwBroadlyMatchedException(this.exceptions.broad,e,i),this.throwBroadlyMatchedException(this.exceptions.broad,t,i),new r(i)}}}},86091:function(e,t,i){"use strict";const s=i(48819),{ArgumentsRequired:r,AuthenticationError:a,InsufficientFunds:n,InvalidOrder:o,AccountSuspended:h,ExchangeError:d,DuplicateOrderId:c,OrderNotFound:l,BadSymbol:u,ExchangeNotAvailable:f,BadRequest:p}=i(73449),m=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"wavesexchange",name:"Waves.Exchange",countries:["CH"],certified:!1,pro:!1,has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createMarketOrder:!0,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchClosedOrders:!0,fetchDepositAddress:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTransfer:!1,fetchTransfers:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,signIn:!0,transfer:!1,withdraw:!0},timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","2h":"2h","3h":"3h","4h":"4h","6h":"6h","12h":"12h","1d":"1d","1w":"1w","1M":"1M"},urls:{logo:"https://user-images.githubusercontent.com/1294454/84547058-5fb27d80-ad0b-11ea-8711-78ac8b3c7f31.jpg",test:{matcher:"https://matcher-testnet.waves.exchange",node:"https://nodes-testnet.wavesnodes.com",public:"https://api-testnet.wavesplatform.com/v0",private:"https://api-testnet.waves.exchange/v1",forward:"https://testnet.waves.exchange/api/v1/forward/matcher",market:"https://testnet.waves.exchange/api/v1/forward/marketdata/api/v1"},api:{matcher:"https://matcher.waves.exchange",node:"https://nodes.waves.exchange",public:"https://api.wavesplatform.com/v0",private:"https://api.waves.exchange/v1",forward:"https://waves.exchange/api/v1/forward/matcher",market:"https://waves.exchange/api/v1/forward/marketdata/api/v1"},doc:"https://docs.waves.exchange",www:"https://waves.exchange"},api:{matcher:{get:["matcher","matcher/settings","matcher/settings/rates","matcher/balance/reserved/{publicKey}","matcher/debug/allSnashotOffsets","matcher/debug/currentOffset","matcher/debug/lastOffset","matcher/debug/oldestSnapshotOffset","matcher/orderbook","matcher/orderbook/{amountAsset}/{priceAsset}","matcher/orderbook/{baseId}/{quoteId}/publicKey/{publicKey}","matcher/orderbook/{baseId}/{quoteId}/{orderId}","matcher/orderbook/{baseId}/{quoteId}/info","matcher/orderbook/{baseId}/{quoteId}/status","matcher/orderbook/{baseId}/{quoteId}/tradeableBalance/{address}","matcher/orderbook/{publicKey}","matcher/orderbook/{publicKey}/{orderId}","matcher/orders/{address}","matcher/orders/{address}/{orderId}","matcher/transactions/{orderId}"],post:["matcher/orderbook","matcher/orderbook/market","matcher/orderbook/cancel","matcher/orderbook/{baseId}/{quoteId}/cancel","matcher/orderbook/{amountAsset}/{priceAsset}/calculateFee","matcher/debug/saveSnapshots","matcher/orders/{address}/cancel","matcher/orders/cancel/{orderId}"],delete:["matcher/orderbook/{baseId}/{quoteId}","matcher/settings/rates/{assetId}"],put:["matcher/settings/rates/{assetId}"]},node:{get:["addresses","addresses/balance/{address}","addresses/balance/{address}/{confirmations}","addresses/balance/details/{address}","addresses/data/{address}","addresses/data/{address}/{key}","addresses/effectiveBalance/{address}","addresses/effectiveBalance/{address}/{confirmations}","addresses/publicKey/{publicKey}","addresses/scriptInfo/{address}","addresses/scriptInfo/{address}/meta","addresses/seed/{address}","addresses/seq/{from}/{to}","addresses/validate/{address}","alias/by-address/{address}","alias/by-alias/{alias}","assets/{assetId}/distribution/{height}/{limit}","assets/balance/{address}","assets/balance/{address}/{assetId}","assets/details/{assetId}","assets/nft/{address}/limit/{limit}","blockchain/rewards","blockchain/rewards/height","blocks/address/{address}/{from}/{to}/","blocks/at/{height}","blocks/delay/{signature}/{blockNum}","blocks/first","blocks/headers/last","blocks/headers/seq/{from}/{to}","blocks/height","blocks/height/{signature}","blocks/last","blocks/seq/{from}/{to}","blocks/signature/{signature}","consensus/algo","consensus/basetarget","consensus/basetarget/{blockId}","consensus/{generatingbalance}/address","consensus/generationsignature","consensus/generationsignature/{blockId}","debug/balances/history/{address}","debug/blocks/{howMany}","debug/configInfo","debug/historyInfo","debug/info","debug/minerInfo","debug/portfolios/{address}","debug/state","debug/stateChanges/address/{address}","debug/stateChanges/info/{id}","debug/stateWaves/{height}","leasing/active/{address}","node/state","node/version","peers/all","peers/blacklisted","peers/connected","peers/suspended","transactions/address/{address}/limit/{limit}","transactions/info/{id}","transactions/status","transactions/unconfirmed","transactions/unconfirmed/info/{id}","transactions/unconfirmed/size","utils/seed","utils/seed/{length}","utils/time","wallet/seed"],post:["addresses","addresses/data/{address}","addresses/sign/{address}","addresses/signText/{address}","addresses/verify/{address}","addresses/verifyText/{address}","debug/blacklist","debug/print","debug/rollback","debug/validate","node/stop","peers/clearblacklist","peers/connect","transactions/broadcast","transactions/calculateFee","tranasctions/sign","transactions/sign/{signerAddress}","tranasctions/status","utils/hash/fast","utils/hash/secure","utils/script/compileCode","utils/script/compileWithImports","utils/script/decompile","utils/script/estimate","utils/sign/{privateKey}","utils/transactionsSerialize"],delete:["addresses/{address}","debug/rollback-to/{signature}"]},public:{get:["assets","pairs","candles/{baseId}/{quoteId}","transactions/exchange"]},private:{get:["deposit/addresses/{currency}","deposit/addresses/{currency}/{platform}","platforms","deposit/currencies","withdraw/currencies","withdraw/addresses/{currency}/{address}"],post:["oauth2/token"]},forward:{get:["matcher/orders/{address}","matcher/orders/{address}/{orderId}"],post:["matcher/orders/{wavesAddress}/cancel"]},market:{get:["tickers"]}},currencies:{WX:{id:"EMAMLxDnv3xiz8RXg8Btj33jcEw3wLczL3JKYYmuubpc",numericId:void 0,code:"WX",precision:8}},options:{allowedCandles:1440,accessToken:void 0,createMarketBuyOrderRequiresPrice:!0,matcherPublicKey:void 0,quotes:void 0,createOrderDefaultExpiry:24192e5,wavesAddress:void 0,withdrawFeeUSDN:7420,withdrawFeeWAVES:1e5,wavesPrecision:8,messagePrefix:"W",networks:{ERC20:"ETH",BEP20:"BSC"},reverseNetworks:{ETH:"ERC20",BSC:"BEP20"}},commonCurrencies:{EGG:"Waves Ducks"},requiresEddsa:!0,exceptions:{3147270:n,112:n,4:d,13:f,14:f,3145733:h,3148040:c,3148801:a,9440512:a,9440771:u,9441026:o,9441282:o,9441286:o,9441295:o,9441540:o,9441542:o,106954752:a,106954769:a,106957828:a,106960131:a,106981137:a,9437184:p,9437193:l,1048577:p,1051904:a}})}setSandboxMode(e){return this.options.messagePrefix=e?"T":"W",super.setSandboxMode(e)}async getFeesForAsset(e,t,i,s,r={}){await this.loadMarkets();const a=this.market(e);i=this.amountToPrecision(e,i),s=this.priceToPrecision(e,s);const n=this.extend({amountAsset:a.baseId,priceAsset:a.quoteId,orderType:t,amount:i,price:s},r);return await this.matcherPostMatcherOrderbookAmountAssetPriceAssetCalculateFee(n)}async calculateFee(e,t,i,s,r,a="taker",n={}){const o=await this.getFeesForAsset(e,i,s,r);let h;h=this.safeValue(n,"isDiscountFee",!1)?this.safeValue(o,"discount"):this.safeValue(o,"base");const d=this.safeString(h,"matcherFee"),c=this.safeString(h,"feeAssetId"),l=this.safeCurrencyCode(c),u=this.currencyFromPrecision(l,d),f=this.numberToString(s),p=this.numberToString(r),g=this.feeToPrecision(e,this.parseNumber(u)),y=m.stringDiv(u,m.stringMul(f,p));return{type:a,currency:l,rate:this.parseNumber(y),cost:this.parseNumber(g)}}async getQuotes(){let e=this.safeValue(this.options,"quotes");if(e)return e;{const t=await this.matcherGetMatcherSettings();e={};const i=this.safeValue(t,"priceAssets");for(let t=0;t<i.length;t++)e[i[t]]=!0;return this.options.quotes=e,e}}async fetchMarkets(e={}){const t=await this.marketGetTickers(),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"amountAssetID"),a=this.safeString(s,"priceAssetID"),n=r+"/"+a,o=this.safeString(s,"symbol");let[h,d]=o.split("/");h=this.safeCurrencyCode(h),d=this.safeCurrencyCode(d);const c=h+"/"+d;i.push({id:n,symbol:c,base:h,quote:d,settle:void 0,baseId:r,quoteId:a,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeInteger(s,"amountAssetDecimals"),price:this.safeInteger(s,"priceAssetDecimals")},limits:{leverage:{min:void 0,max:void 0},amount:{min:void 0,max:void 0},price:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:s})}return i}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r=this.extend({amountAsset:s.baseId,priceAsset:s.quoteId},i),a=await this.matcherGetMatcherOrderbookAmountAssetPriceAsset(r),n=this.safeInteger(a,"timestamp");return{symbol:e,bids:this.parseOrderBookSide(this.safeValue(a,"bids"),s,t),asks:this.parseOrderBookSide(this.safeValue(a,"asks"),s,t),timestamp:n,datetime:this.iso8601(n),nonce:void 0}}parseOrderBookSide(e,t,i){const s=t.precision,r=this.safeInteger(this.options,"wavesPrecision",8),a=Math.pow(10,s.amount),n=s.amount-s.price,o=Math.pow(10,r-n),h=[];for(let t=0;t<e.length;t++){const s=e[t],r=this.safeInteger(s,"price",0)/o,n=this.safeInteger(s,"amount",0)/a;if(void 0!==i&&t>i)break;h.push([r,n])}return h}checkRequiredKeys(){if(void 0===this.apiKey)throw new a(this.id+" requires apiKey credential");if(void 0===this.secret)throw new a(this.id+" requires secret credential");let e,t;try{e=this.base58ToBinary(this.apiKey)}catch(e){throw new a(this.id+" apiKey must be a base58 encoded public key")}try{t=this.base58ToBinary(this.secret)}catch(e){throw new a(this.id+" secret must be a base58 encoded private key")}const i=this.binaryToBase16(e),s=this.binaryToBase16(t);if(64!==i.length)throw new a(this.id+" apiKey must be a base58 encoded public key");if(64!==s.length)throw new a(this.id+" secret must be a base58 encoded private key")}sign(e,t="public",i="GET",s={},r,a){const n=this.omit(s,this.extractParams(e)),o="matcher/orders/{wavesAddress}/cancel"===e;e=this.implodeParams(e,s);let h=this.urls.api[t]+"/"+e,d=this.urlencodeWithArrayRepeat(n);if("private"===t||"forward"===t){r={Accept:"application/json"};const e=this.safeString(this.options,"accessToken");e&&(r.Authorization="Bearer "+e),r["content-type"]="POST"===i?"application/json":"application/x-www-form-urlencoded",o&&(a=this.json([n.orderId]),d=""),d.length>0&&(h+="?"+d)}else"matcher"===t?"POST"===i?(r={Accept:"application/json","Content-Type":"application/json"},a=this.json(n)):r=n:"POST"===i?(r={"content-type":"application/json"},a=this.json(n)):(r={"content-type":"application/x-www-form-urlencoded"},d.length>0&&(h+="?"+d));return{url:h,method:i,body:a,headers:r}}async signIn(e={}){if(!this.safeString(this.options,"accessToken")){const e="ffffff01",t=604800;let i=this.sum(this.seconds(),t);i=i.toString();const s="waves.exchange",r=this.safeString(this.options,"messagePrefix","W")+":"+s+":"+i,a=e+this.binaryToBase16(this.stringToBinary(this.encode(r))),n=this.binaryToBase16(this.base58ToBinary(this.secret)),o=this.eddsa(a,n,"ed25519"),h={grant_type:"password",scope:"general",username:this.apiKey,password:i+":"+o,client_id:s},d=await this.privatePostOauth2Token(h);return this.options.accessToken=this.safeString(d,"access_token"),this.options.accessToken}}parseTicker(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeString(e,"symbol"),r=(t=this.safeMarket(s,t,"/")).symbol,a=this.safeString2(e,"24h_close","lastPrice"),n=this.safeString2(e,"24h_low","low"),o=this.safeString2(e,"24h_high","high"),h=this.safeString2(e,"24h_vwap","weightedAveragePrice"),d=this.safeString2(e,"24h_volume","volume"),c=this.safeString2(e,"24h_priceVolume","quoteVolume"),l=this.safeString2(e,"24h_open","firstPrice");return this.safeTicker({symbol:r,timestamp:i,datetime:this.iso8601(i),high:o,low:n,bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:h,open:l,close:a,last:a,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:d,quoteVolume:c,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={pairs:i.id},r=await this.publicGetPairs(this.extend(s,t)),a=this.safeValue(r,"data",[]),n=this.safeValue(a,0,{}),o=this.safeValue(n,"data",{});return this.parseTicker(o,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.marketGetTickers(t);return this.parseTickers(i,e)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={baseId:a.baseId,quoteId:a.quoteId,interval:this.safeString(this.timeframes,t,t)},o=this.safeInteger(this.options,"allowedCandles",1440);void 0===s&&(s=o),s=Math.min(o,s);const h=1e3*this.parseTimeframe(t);if(void 0===i){const e=parseInt(this.milliseconds()/h)*h-(s-1)*h;n.timeStart=e.toString()}else{n.timeStart=i.toString();const e=this.sum(i,h*s);n.timeEnd=e.toString()}const d=await this.publicGetCandlesBaseIdQuoteId(this.extend(n,r)),c=this.safeValue(d,"data",[]);let l,u=this.parseOHLCVs(c,a,t,i,s);u=this.filterFutureCandles(u);const f=u.length;for(let e=0;e<u.length;e++){const t=f-e-1,i=u[t];void 0===i[1]&&(i[1]=l,i[2]=l,i[3]=l,i[4]=l,u[t]=i),l=i[4]}return u}filterFutureCandles(e){const t=[],i=this.milliseconds();for(let s=0;s<e.length&&!(e[s][0]>i);s++)t.push(e[s]);return t}parseOHLCV(e,t){const i=this.safeValue(e,"data",{});return[this.parse8601(this.safeString(i,"time")),this.safeNumber(i,"open"),this.safeNumber(i,"high"),this.safeNumber(i,"low"),this.safeNumber(i,"close"),this.safeNumber(i,"volume",0)]}async fetchDepositAddress(e,t={}){await this.signIn();const i=this.safeValue(this.options,"networks",{}),s=this.safeStringUpper(t,"network"),r=this.safeString(i,s,s);t=this.omit(t,["network"]);const a=await this.privateGetPlatforms(),n={},o={},h=this.safeValue(a,"items",[]);for(let e=0;e<h.length;e++){const t=h[e],i=this.safeString(t,"id"),s=this.safeValue(t,"currencies",[]);for(let e=0;e<s.length;e++){const t=this.safeString(s,e);n[t]=!0,t in o||(o[t]={}),o[t][i]=!0}}if(!(e in n)){const t=Object.keys(n);throw new d(this.id+" fetchDepositAddress() "+e+" not supported. Currency code must be one of "+t.join(", "))}let c;if(void 0===r){const i={currency:e};c=await this.privateGetDepositAddressesCurrency(this.extend(i,t))}else{const i=o[e];if(!(r in i)){const t=Object.keys(i);throw new d(this.id+" "+r+" network "+e+" deposit address not supported. Network must be one of "+t.join(", "))}if("WAVES"===r){const t={publicKey:this.apiKey},i=await this.nodeGetAddressesPublicKeyPublicKey(this.extend(t,t));return{address:this.safeString(i,"address"),code:e,currency:e,network:r,tag:void 0,info:i}}{const i={currency:e,platform:r};c=await this.privateGetDepositAddressesCurrencyPlatform(this.extend(i,t))}}const l=this.safeValue(c,"currency"),u=this.safeString(l,"platform_id"),f=this.safeValue(this.options,"reverseNetworks",{}),p=this.safeString(f,u,u),m=this.safeValue(c,"deposit_addresses");return{address:this.safeString(m,0),code:e,currency:e,tag:void 0,network:p,info:c}}async getMatcherPublicKey(){const e=this.safeString(this.options,"matcherPublicKey");if(e)return e;{const e=await this.matcherGetMatcher();return this.options.matcherPublicKey=e.slice(1,e.length-1),this.options.matcherPublicKey}}getAssetBytes(e){return"WAVES"===e?this.numberToBE(0,1):this.binaryConcat(this.numberToBE(1,1),this.base58ToBinary(e))}getAssetId(e){return"WAVES"===e?"":e}priceToPrecision(e,t){const i=this.markets[e],s=this.safeInteger(this.options,"wavesPrecision",8),r=i.precision.amount-i.precision.price;return parseInt(parseFloat(this.toPrecision(t,s-r)))}amountToPrecision(e,t){return parseInt(parseFloat(this.toPrecision(t,this.markets[e].precision.amount)))}currencyToPrecision(e,t,i){return parseInt(parseFloat(this.toPrecision(t,this.currencies[e].precision)))}fromPrecision(e,t){if(void 0===e)return;const i=new m(e);return i.decimals=this.sum(i.decimals,t),i.reduce(),i.toString()}toPrecision(e,t){const i=e.toString(),s=new m(i);return s.decimals=s.decimals-t,s.reduce(),s.toString()}currencyFromPrecision(e,t){const i=this.currencies[e].precision;return this.fromPrecision(t,i)}priceFromPrecision(e,t){const i=this.markets[e],s=this.safeInteger(this.options,"wavesPrecision",8),r=this.sum(s,i.precision.price)-i.precision.amount;return this.fromPrecision(t,r)}safeGetDynamic(e){const t=this.safeValue(e,"orderFee");return"dynamic"in t?this.safeValue(t,"dynamic"):this.safeValue(t.composite.default,"dynamic")}safeGetRates(e){const t=this.safeValue(e,"rates");return void 0===t?{WAVES:1}:t}async createOrder(e,t,i,s,r,a={}){this.checkRequiredDependencies(),this.checkRequiredKeys(),await this.loadMarkets();const h=this.market(e),d=await this.getMatcherPublicKey(),c=this.getAssetId(h.baseId),l=this.getAssetId(h.quoteId),u="market"===t;if(u&&void 0===r)throw new o(this.id+" createOrder() requires a price argument for "+t+" orders to determine the max price for buy and the min price for sell");const f="buy"===i?0:1,p=this.milliseconds(),m=this.safeInteger(this.options,"createOrderDefaultExpiry",24192e5),g=this.sum(p,m),y=await this.getFeesForAsset(e,i,s,r),b=this.safeValue(y,"base"),v=this.safeString(b,"feeAssetId"),w=this.safeCurrencyCode(v),S=this.safeString(b,"matcherFee"),k=this.safeValue(y,"discount"),T=this.safeString(k,"feeAssetId"),_=this.safeCurrencyCode(T),O=this.safeString(k,"matcherFee");let M,I;if("feeAsset"in a||"feeAsset"in this.options){const e=this.safeString(a,"feeAsset",this.safeString(this.options,"feeAsset")),t=this.currency(e);M=this.safeString(t,"id")}const x=await this.fetchBalance();if(void 0!==M){if(v!==M&&T!==M)throw new o(this.id+" asset fee must be "+w+" or "+_);const e=this.safeCurrencyCode(M),t=M===v?S:O,i=parseFloat(this.currencyFromPrecision(e,t));if(!(e in x&&x[e].free>=i))throw new n(this.id+" not enough funds of the selected asset fee");I=parseInt(t)}if(void 0===M){const e=parseFloat(this.currencyFromPrecision(w,S));if(w in x&&x[w].free>=e)M=v,I=parseInt(S);else{const e=parseFloat(this.currencyFromPrecision(_,O));_ in x&&x[_].free>=e&&(M=T,I=parseInt(O))}}if(void 0===M)throw new n(this.id+" not enough funds on none of the eligible asset fees");s=this.amountToPrecision(e,s),r=this.priceToPrecision(e,r);const C=[this.numberToBE(3,1),this.base58ToBinary(this.apiKey),this.base58ToBinary(d),this.getAssetBytes(h.baseId),this.getAssetBytes(h.quoteId),this.numberToBE(f,1),this.numberToBE(r,8),this.numberToBE(s,8),this.numberToBE(p,8),this.numberToBE(g,8),this.numberToBE(I,8),this.getAssetBytes(M)],P=this.binaryConcatArray(C),A=this.eddsa(this.binaryToBase16(P),this.binaryToBase16(this.base58ToBinary(this.secret)),"ed25519"),N={amountAsset:c,priceAsset:l},B={senderPublicKey:this.apiKey,matcherPublicKey:d,assetPair:N,orderType:i,price:r,amount:s,timestamp:p,expiration:g,matcherFee:parseInt(I),signature:A,version:3};if("WAVES"!==M&&(B.matcherFeeAssetId=M),u){const e=await this.matcherPostMatcherOrderbookMarket(B),t=this.safeValue(e,"message");return this.parseOrder(t,h)}{const e=await this.matcherPostMatcherOrderbook(B),t=this.safeValue(e,"message");return this.parseOrder(t,h)}}async cancelOrder(e,t,i={}){this.checkRequiredDependencies(),this.checkRequiredKeys(),await this.signIn();const s=await this.getWavesAddress(),r=await this.forwardPostMatcherOrdersWavesAddressCancel({wavesAddress:s,orderId:e}),a=this.safeValue(r,"message"),n=this.safeValue(a,0),o=this.safeValue(n,0);return{info:r,id:this.safeString(o,"orderId"),clientOrderId:void 0,timestamp:void 0,datetime:void 0,lastTradeTimestamp:void 0,symbol:t,type:void 0,side:void 0,price:void 0,amount:void 0,cost:void 0,average:void 0,filled:void 0,remaining:void 0,status:void 0,fee:void 0,trades:void 0}}async fetchOrder(e,t,i={}){let s;this.checkRequiredDependencies(),this.checkRequiredKeys(),await this.loadMarkets(),void 0!==t&&(s=this.market(t));const r=this.milliseconds(),a=[this.base58ToBinary(this.apiKey),this.numberToBE(r,8)],n=this.binaryConcatArray(a),o=this.binaryToBase16(this.base58ToBinary(this.secret)),h=this.eddsa(this.binaryToBase16(n),o,"ed25519"),d={Timestamp:r.toString(),Signature:h,publicKey:this.apiKey,orderId:e},c=await this.matcherGetMatcherOrderbookPublicKeyOrderId(this.extend(d,i));return this.parseOrder(c,s)}async fetchOrders(e,t,i,s={}){if(this.checkRequiredDependencies(),this.checkRequiredKeys(),void 0===e)throw new r(this.id+" fetchOrders() requires symbol argument");await this.loadMarkets();const a=this.market(e),n=this.milliseconds(),o=[this.base58ToBinary(this.apiKey),this.numberToBE(n,8)],h=this.binaryConcatArray(o),d=this.binaryToBase16(this.base58ToBinary(this.secret)),c=this.eddsa(this.binaryToBase16(h),d,"ed25519"),l={Accept:"application/json",Timestamp:n.toString(),Signature:c,publicKey:this.apiKey,baseId:a.baseId,quoteId:a.quoteId},u=await this.matcherGetMatcherOrderbookBaseIdQuoteIdPublicKeyPublicKey(this.extend(l,s));return this.parseOrders(u,a,t,i)}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets(),await this.signIn(),void 0!==e&&(r=this.market(e));const a={address:await this.getWavesAddress(),activeOnly:!0},n=await this.forwardGetMatcherOrdersAddress(a);return this.parseOrders(n,r,t,i)}async fetchClosedOrders(e,t,i,s={}){let r;await this.loadMarkets(),await this.signIn(),void 0!==e&&(r=this.market(e));const a={address:await this.getWavesAddress(),closedOnly:!0},n=await this.forwardGetMatcherOrdersAddress(a);return this.parseOrders(n,r,t,i)}parseOrderStatus(e){return this.safeString({Cancelled:"canceled",Accepted:"open",Filled:"closed",PartiallyFilled:"open"},e,e)}getSymbolFromAssetPair(e){const t=this.safeString(e,"amountAsset","WAVES"),i=this.safeString(e,"priceAsset","WAVES");return this.safeCurrencyCode(t)+"/"+this.safeCurrencyCode(i)}parseOrder(e,t){const i=this.safeInteger(e,"timestamp"),s=this.safeString2(e,"type","orderType");let r="limit";"type"in e&&(r=this.safeString(e,"orderType",r));const a=this.safeString(e,"id"),n=this.safeString(e,"filled"),o=this.safeString(e,"price"),h=this.safeString(e,"amount"),d=this.safeValue(e,"assetPair");let c;void 0!==d?c=this.getSymbolFromAssetPair(d):void 0!==t&&(c=t.symbol);const l=this.safeCurrencyCode(this.safeString(d,"amountAsset","WAVES")),u=this.priceFromPrecision(c,o),f=this.currencyFromPrecision(l,h),p=this.currencyFromPrecision(l,n),m=this.priceFromPrecision(c,this.safeString(e,"avgWeighedPrice")),g=this.parseOrderStatus(this.safeString(e,"status"));let y;if("type"in e){const t=this.safeCurrencyCode(this.safeString(e,"feeAsset"));y={currency:t,fee:this.parseNumber(this.currencyFromPrecision(t,this.safeString(e,"filledFee")))}}else{const t=this.safeCurrencyCode(this.safeString(e,"matcherFeeAssetId","WAVES"));y={currency:t,fee:this.parseNumber(this.currencyFromPrecision(t,this.safeString(e,"matcherFee")))}}return this.safeOrder({info:e,id:a,clientOrderId:void 0,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:void 0,symbol:c,type:r,timeInForce:void 0,postOnly:void 0,side:s,price:u,stopPrice:void 0,triggerPrice:void 0,amount:f,cost:void 0,average:m,filled:p,remaining:void 0,status:g,fee:y,trades:void 0},t)}async getWavesAddress(){const e=this.safeString(this.options,"wavesAddress");if(void 0===e){const e={publicKey:this.apiKey},t=await this.nodeGetAddressesPublicKeyPublicKey(e);return this.options.wavesAddress=this.safeString(t,"address"),this.options.wavesAddress}return e}async fetchBalance(e={}){this.checkRequiredDependencies(),this.checkRequiredKeys(),await this.loadMarkets();const t=await this.getWavesAddress(),i={address:t},s=await this.nodeGetAssetsBalanceAddress(i),r=this.safeValue(s,"balances",[]),a={};let n;const o=[],h=[];for(let e=0;e<r.length;e++){const t=r[e],i=this.safeInteger(t,"timestamp");n=void 0===n?i:Math.max(n,i);const s=this.safeValue(t,"issueTransaction"),d=this.safeString(t,"assetId"),c=this.safeString(t,"balance");if(void 0===s){o.push(d),h.push(c);continue}const l=this.safeInteger(s,"decimals");let u;d in this.currencies_by_id&&(u=this.safeCurrencyCode(d),a[u]=this.account(),a[u].total=this.fromPrecision(c,l))}if(o.length){const e={ids:o},t=await this.publicGetAssets(e),i=this.safeValue(t,"data",[]);for(let e=0;e<i.length;e++){const t=i[e],s=h[e],r=this.safeValue(t,"data"),n=this.safeInteger(r,"precision"),o=this.safeString(r,"ticker"),d=this.safeCurrencyCode(o);a[d]=this.account(),a[d].total=this.fromPrecision(s,n)}}const d=this.milliseconds(),c=[this.base58ToBinary(this.apiKey),this.numberToBE(d,8)],l=this.binaryConcatArray(c),u=this.binaryToBase16(this.base58ToBinary(this.secret)),f=this.eddsa(this.binaryToBase16(l),u,"ed25519"),p={publicKey:this.apiKey,signature:f,timestamp:d.toString()},m=await this.matcherGetMatcherBalanceReservedPublicKey(p),g=Object.keys(m);for(let e=0;e<g.length;e++){const t=g[e],i=this.safeCurrencyCode(t);i in a||(a[i]=this.account());const s=this.safeString(m,t);i in this.currencies?a[i].used=this.currencyFromPrecision(i,s):a[i].used=s}const y={address:t},b=await this.nodeGetAddressesBalanceAddress(y);a.WAVES=this.safeValue(a,"WAVES",{}),a.WAVES.total=this.currencyFromPrecision("WAVES",this.safeString(b,"balance"));const v=Object.keys(a);for(let e=0;e<v.length;e++){const t=v[e];void 0===this.safeValue(a[t],"used")&&(a[t].used="0")}return a.timestamp=n,a.datetime=this.iso8601(n),this.safeBalance(a)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={sender:await this.getWavesAddress()};let a;void 0!==e&&(a=this.market(e),r.amountAsset=a.baseId,r.priceAsset=a.quoteId);const n=await this.publicGetTransactionsExchange(r),o=this.safeValue(n,"data");return this.parseTrades(o,a,t,i)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={amountAsset:r.baseId,priceAsset:r.quoteId};void 0!==i&&(a.limit=i),void 0!==t&&(a.timeStart=t);const n=await this.publicGetTransactionsExchange(a),o=this.safeValue(n,"data");return this.parseTrades(o,r,t,i)}parseTrade(e,t){const i=this.safeValue(e,"data"),s=this.safeString(i,"timestamp"),r=this.parse8601(s),a=this.safeString(i,"id"),n=this.safeString(i,"price"),o=this.safeString(i,"amount"),h=this.safeValue(i,"order1"),d=this.safeValue(i,"order2");let c,l;c=this.safeString(h,"senderPublicKey")===this.apiKey?h:d;const u=this.safeValue(c,"assetPair");void 0!==u?l=this.getSymbolFromAssetPair(u):void 0!==t&&(l=t.symbol);const f=this.safeString(c,"orderType"),p=this.safeString(c,"id"),m={cost:this.safeString(c,"matcherFee"),currency:this.safeCurrencyCode(this.safeString(c,"matcherFeeAssetId","WAVES"))};return this.safeTrade({info:e,timestamp:r,datetime:s,symbol:l,id:a,order:p,type:void 0,side:f,takerOrMaker:void 0,price:n,amount:o,cost:void 0,fee:m},t)}handleErrors(e,t,i,s,r,a,n,o,h){const c=this.safeString(n,"error"),l=this.safeValue(n,"success",!0),u=this.safeValue(this.exceptions,c);if(void 0!==u){const e=this.safeString(n,"message");throw new u(this.id+" "+e)}if("Validation Error"===this.safeString(n,"message"))throw new p(this.id+" "+a);if(!l)throw new d(this.id+" "+a)}async withdraw(e,t,i,s,r={}){if([s,r]=this.handleWithdrawTagAndParams(s,r),"WAVES"!==e){const t=await this.privateGetWithdrawCurrencies(),i={},s=this.safeValue(t,"items",[]);for(let e=0;e<s.length;e++){const t=s[e];i[this.safeString(t,"id")]=!0}if(!(e in i)){const t=Object.keys(i);throw new d(this.id+" withdraw() "+e+" not supported. Currency code must be one of "+t.toString())}}await this.loadMarkets();const a=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],n={};for(let e=0;e<a.length;e++){n[a[e]]=!0}let o=!0;const h=this.remove0xPrefix(i).toLowerCase();for(let e=0;e<h.length;e++){if(!(h[e]in n)){o=!1;break}}let c;if(await this.signIn(),"WAVES"!==e||o){const s={address:i,currency:e},r=await this.privateGetWithdrawAddressesCurrencyAddress(s),a=this.safeValue(r,"currency"),n=this.safeValue(a,"allowed_amount"),o=this.safeNumber(n,"min");if(t<=o)throw new p(this.id+" "+e+" withdraw failed, amount "+t.toString()+" must be greater than the minimum allowed amount of "+o.toString());const h=this.safeValue(r,"proxy_addresses",[]);c=this.safeString(h,0)}else c=i;const l=this.safeInteger(this.options,"withdrawFeeWAVES",1e5),u="WAVES",f=this.currencyToPrecision(e,t),m=this.currency(e),g=this.milliseconds(),y=[this.numberToBE(4,1),this.numberToBE(2,1),this.base58ToBinary(this.apiKey),this.getAssetBytes(m.id),this.getAssetBytes(u),this.numberToBE(g,8),this.numberToBE(f,8),this.numberToBE(l,8),this.base58ToBinary(c),this.numberToBE(0,2)],b=this.binaryConcatArray(y),v=this.binaryToBase16(this.base58ToBinary(this.secret)),w=this.eddsa(this.binaryToBase16(b),v,"ed25519"),S={senderPublicKey:this.apiKey,amount:f,fee:l,type:4,version:2,attachment:"",feeAssetId:this.getAssetId(u),proofs:[w],assetId:this.getAssetId(m.id),recipient:c,timestamp:g,signature:w},k=await this.nodePostTransactionsBroadcast(S);return this.parseTransaction(k,m)}parseTransaction(e,t){return{id:void 0,txid:void 0,timestamp:void 0,datetime:void 0,network:void 0,addressFrom:void 0,address:void 0,addressTo:void 0,amount:void 0,type:void 0,currency:(t=this.safeCurrency(void 0,t)).code,status:void 0,updated:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,comment:void 0,fee:void 0,info:e}}}},79741:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,BadRequest:a,RateLimitExceeded:n,BadSymbol:o,ArgumentsRequired:h,PermissionDenied:d,InsufficientFunds:c,InvalidOrder:l}=i(73449),{TICK_SIZE:u}=i(62115),f=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"wazirx",name:"WazirX",countries:["IN"],version:"v2",rateLimit:1e3,pro:!0,has:{CORS:!1,spot:!0,margin:void 0,swap:!1,future:!1,option:!1,cancelAllOrders:!0,cancelOrder:!0,createOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchBalance:!0,fetchBidsAsks:!1,fetchClosedOrders:!1,fetchCurrencies:!1,fetchDepositAddress:!1,fetchDepositAddressesByNetwork:!1,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!1,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPositionMode:!1,fetchPremiumIndexOHLCV:!1,fetchStatus:!0,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransactionFees:!1,fetchTransactions:!1,fetchTransfers:!1,fetchWithdrawals:!1,transfer:!1,withdraw:!1},urls:{logo:"https://user-images.githubusercontent.com/1294454/148647666-c109c20b-f8ac-472f-91c3-5f658cb90f49.jpeg",api:{rest:"https://api.wazirx.com/sapi/v1"},www:"https://wazirx.com",doc:"https://docs.wazirx.com/#public-rest-api-for-wazirx",fees:"https://wazirx.com/fees",referral:"https://wazirx.com/invite/k7rrnks5"},api:{public:{get:{exchangeInfo:1,depth:1,ping:1,systemStatus:1,"tickers/24hr":1,"ticker/24hr":1,time:1,trades:1,klines:1}},private:{get:{account:1,allOrders:1,funds:1,historicalTrades:1,openOrders:1,order:1,myTrades:1},post:{order:1,"order/test":1},delete:{order:1,openOrders:1}}},fees:{WRX:{maker:this.parseNumber("0.0"),taker:this.parseNumber("0.0")}},precisionMode:u,exceptions:{exact:{"-1121":o,1999:a,2002:c,2005:a,2078:d,2098:a,2031:l,2113:a,2115:a,2136:n,94001:l}},timeframes:{"1m":"1m","5m":"5m","30m":"30m","1h":"1h","2h":"2h","4h":"4h","6h":"6h","12h":"12h","1d":"1d","1w":"1w"},options:{recvWindow:1e4}})}async fetchMarkets(e={}){const t=await this.publicGetExchangeInfo(e),i=this.safeValue(t,"symbols",[]),s=[];for(let e=0;e<i.length;e++){const t=i[e],r=this.safeString(t,"symbol"),a=this.safeString(t,"baseAsset"),n=this.safeString(t,"quoteAsset"),o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=this.safeValue(t,"isSpotTradingAllowed"),c=this.safeValue(t,"filters");let l;for(let e=0;e<c.length;e++){const t=c[e];"PRICE_FILTER"===this.safeString(t,"filterType")&&(l=this.safeNumber(t,"minPrice"))}const u=this.safeValue(this.fees,h,{});let p=this.safeString(u,"taker","0.2");p=f.stringDiv(p,"100");let m=this.safeString(u,"maker","0.2");m=f.stringDiv(m,"100");const g=this.safeString(t,"status");s.push({id:r,symbol:o+"/"+h,base:o,quote:h,settle:void 0,baseId:a,quoteId:n,settleId:void 0,type:"spot",spot:d,margin:!1,swap:!1,future:!1,option:!1,active:"trading"===g,contract:!1,linear:void 0,inverse:void 0,taker:this.parseNumber(p),maker:this.parseNumber(m),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(t,"baseAssetPrecision"))),price:this.parseNumber(this.parsePrecision(this.safeString(t,"quoteAssetPrecision")))},limits:{leverage:{min:void 0,max:void 0},price:{min:l,max:void 0},amount:{min:void 0,max:void 0},cost:{min:void 0,max:void 0}},info:t})}return s}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,interval:this.safeString(this.timeframes,t,t)};void 0!==s&&(n.limit=s);const o=this.safeInteger(r,"until");r=this.omit(r,["until"]),void 0!==i&&(n.startTime=parseInt(i/1e3)),void 0!==o&&(n.endTime=o);const h=await this.publicGetKlines(this.extend(n,r));return this.parseOHLCVs(h,a,t,i,s)}parseOHLCV(e,t){return[this.safeTimestamp(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={symbol:this.market(e).id};void 0!==t&&(s.limit=t);const r=await this.publicGetDepth(this.extend(s,i)),a=this.safeInteger(r,"timestamp");return this.parseOrderBook(r,e,a)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.publicGetTicker24hr(this.extend(s,t));return this.parseTicker(r,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.publicGetTickers24hr(),s={};for(let e=0;e<i.length;e++){const t=i[e],r=this.parseTicker(t);s[r.symbol]=r}return s}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==i&&(a.limit=i);const n=this.safeString(this.options,"fetchTradesMethod","publicGetTrades"),o=await this[n](this.extend(a,s));return this.parseTrades(o,r,t,i)}parseTrade(e,t){const i=this.safeString(e,"id"),s=this.safeInteger(e,"time"),r=this.iso8601(s);t=this.safeMarket(void 0,t);const a=this.safeValue(e,"isBuyerMaker")?"sell":"buy",n=this.safeNumber(e,"price"),o=this.safeNumber(e,"qty"),h=this.safeNumber(e,"quoteQty");return this.safeTrade({info:e,id:i,timestamp:s,datetime:r,symbol:t.symbol,order:i,type:void 0,side:a,takerOrMaker:void 0,price:n,amount:o,cost:h,fee:void 0},t)}async fetchStatus(e={}){const t=await this.publicGetSystemStatus(e);return{status:"normal"===this.safeString(t,"status")?"ok":"maintenance",updated:void 0,eta:void 0,url:void 0,info:t}}async fetchTime(e={}){const t=await this.publicGetTime(e);return this.safeInteger(t,"serverTime")}parseTicker(e,t){const i=this.safeString(e,"symbol"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeString(e,"lastPrice"),a=this.safeString(e,"openPrice"),n=this.safeString(e,"highPrice"),o=this.safeString(e,"lowPrice"),h=this.safeString(e,"volume"),d=this.safeString(e,"bidPrice"),c=this.safeString(e,"askPrice"),l=this.safeInteger(e,"at");return this.safeTicker({symbol:s,timestamp:l,datetime:this.iso8601(l),high:n,low:o,bid:d,bidVolume:void 0,ask:c,askVolume:void 0,vwap:void 0,open:a,close:r,last:r,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:h,quoteVolume:void 0,info:e},t)}parseBalance(e){const t={};for(let i=0;i<e.length;i++){const s=e[i],r=this.safeString(s,"asset"),a=this.safeCurrencyCode(r),n=this.account();n.free=this.safeString(s,"free"),n.used=this.safeString(s,"locked"),t[a]=n}return this.safeBalance(t)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privateGetFunds(e);return this.parseBalance(t)}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new h(this.id+" fetchOrders() requires a `symbol` argument");await this.loadMarkets();const r=this.market(e),a={symbol:r.id};void 0!==t&&(a.startTime=t),void 0!==i&&(a.limit=i);const n=await this.privateGetAllOrders(this.extend(a,s));let o=this.parseOrders(n,r,t,i);return o=this.filterBy(o,"symbol",e),o}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.symbol=a.id);const n=await this.privateGetOpenOrders(this.extend(r,s));return this.parseOrders(n,a,t,i)}async cancelAllOrders(e,t={}){if(void 0===e)throw new h(this.id+" cancelAllOrders() requires a `symbol` argument");await this.loadMarkets();const i={symbol:this.market(e).id};return await this.privateDeleteOpenOrders(this.extend(i,t))}async cancelOrder(e,t,i={}){if(void 0===t)throw new h(this.id+" cancelOrder() requires a `symbol` argument");await this.loadMarkets();const s={symbol:this.market(t).id,orderId:e},r=await this.privateDeleteOrder(this.extend(s,i));return this.parseOrder(r)}async createOrder(e,t,i,s,a,n={}){if("limit"!==(t=t.toLowerCase())&&"stop_limit"!==t)throw new r(this.id+" createOrder() supports limit and stop_limit orders only");if(void 0===a)throw new r(this.id+" createOrder() requires a price argument");await this.loadMarkets();const o=this.market(e),h={symbol:o.id,side:i,quantity:s,type:"limit"};h.price=this.priceToPrecision(e,a);void 0!==this.safeString(n,"stopPrice")&&(h.type="stop_limit");const d=await this.privatePostOrder(this.extend(h,n));return this.parseOrder(d,o)}parseOrder(e,t){const i=this.safeInteger(e,"createdTime"),s=this.safeInteger(e,"updatedTime"),r=this.safeString(e,"symbol"),a=this.safeSymbol(r,t),n=this.safeString(e,"quantity"),o=this.safeString(e,"executedQty"),h=this.parseOrderStatus(this.safeString(e,"status")),d=this.safeString(e,"id"),c=this.safeString(e,"price"),l=this.safeStringLower(e,"type"),u=this.safeStringLower(e,"side");return this.safeOrder({info:e,id:d,clientOrderId:void 0,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:s,status:h,symbol:a,type:l,timeInForce:void 0,postOnly:void 0,side:u,price:c,amount:n,filled:o,remaining:void 0,cost:void 0,fee:void 0,average:void 0,trades:[]},t)}parseOrderStatus(e){return this.safeString({wait:"open",done:"closed",cancel:"canceled"},e,e)}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/"+e;if("public"===t&&Object.keys(s).length&&(n+="?"+this.urlencode(s)),"private"===t){this.checkRequiredCredentials();const e=this.milliseconds();let t=this.extend({recvWindow:this.options.recvWindow,timestamp:e},s);t=this.keysort(t);const i=this.hmac(this.encode(this.urlencode(t)),this.encode(this.secret),"sha256");n+="?"+this.urlencode(t),n+="&signature="+i,r={"Content-Type":"application/x-www-form-urlencoded","X-Api-Key":this.apiKey}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;const c=this.safeString(o,"code");if(void 0!==c){const e=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,c,e),new r(e)}}}},70390:function(e,t,i){"use strict";const s=i(48819),{ExchangeNotAvailable:r,ExchangeError:a,DDoSProtection:n,BadSymbol:o,InvalidOrder:h,ArgumentsRequired:d,AuthenticationError:c,OrderNotFound:l,PermissionDenied:u,InsufficientFunds:f,BadRequest:p,NotSupported:m}=i(73449),{TICK_SIZE:g}=i(62115),y=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"whitebit",name:"WhiteBit",version:"v4",countries:["EE"],rateLimit:500,has:{CORS:void 0,spot:!0,margin:!0,swap:!1,future:!1,option:!1,borrowMargin:!1,cancelAllOrders:!1,cancelOrder:!0,cancelOrders:!1,createOrder:!0,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,editOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDeposit:!0,fetchDepositAddress:!0,fetchDeposits:!0,fetchDepositWithdrawFee:"emulated",fetchDepositWithdrawFees:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrderBook:!0,fetchOrderTrades:!0,fetchPositionMode:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactionFees:!0,repayMargin:!1,setLeverage:!0,transfer:!0,withdraw:!0},timeframes:{"1m":"1m","3m":"3m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","2h":"2h","4h":"4h","6h":"6h","8h":"8h","12h":"12h","1d":"1d","3d":"3d","1w":"1w","1M":"1M"},urls:{logo:"https://user-images.githubusercontent.com/1294454/66732963-8eb7dd00-ee66-11e9-849b-10d9282bb9e0.jpg",api:{v1:{public:"https://whitebit.com/api/v1/public",private:"https://whitebit.com/api/v1"},v2:{public:"https://whitebit.com/api/v2/public"},v4:{public:"https://whitebit.com/api/v4/public",private:"https://whitebit.com/api/v4"}},www:"https://www.whitebit.com",doc:"https://github.com/whitebit-exchange/api-docs",fees:"https://whitebit.com/fee-schedule",referral:"https://whitebit.com/referral/d9bdf40e-28f2-4b52-b2f9-cd1415d82963"},api:{web:{get:["v1/healthcheck"]},v1:{public:{get:["markets","tickers","ticker","symbols","depth/result","history","kline"]},private:{post:["account/balance","order/new","order/cancel","orders","account/order_history","account/executed_history","account/executed_history/all","account/order"]}},v2:{public:{get:["markets","ticker","assets","fee","depth/{market}","trades/{market}"]}},v4:{public:{get:["assets","collateral/markets","fee","orderbook/{market}","ticker","trades/{market}","time","ping","markets"]},private:{post:["collateral-account/balance","collateral-account/positions/history","collateral-account/leverage","collateral-account/positions/open","collateral-account/summary","main-account/address","main-account/balance","main-account/create-new-address","main-account/codes","main-account/codes/apply","main-account/codes/my","main-account/codes/history","main-account/fiat-deposit-url","main-account/history","main-account/withdraw","main-account/withdraw-pay","main-account/transfer","trade-account/balance","trade-account/executed-history","trade-account/order","trade-account/order/history","order/collateral/limit","order/collateral/market","order/collateral/trigger_market","order/new","order/market","order/stock_market","order/stop_limit","order/stop_market","order/cancel","orders","profile/websocket_token"]}}},fees:{trading:{tierBased:!1,percentage:!0,taker:this.parseNumber("0.001"),maker:this.parseNumber("0.001")}},options:{fiatCurrencies:["EUR","USD","RUB","UAH"],fetchBalance:{account:"spot"},accountsByType:{main:"main",spot:"spot",margin:"collateral",trade:"spot"},networksById:{BEP20:"BSC"},defaultType:"spot",brokerId:"ccxt"},precisionMode:g,exceptions:{exact:{"Unauthorized request.":c,"The market format is invalid.":o,"Market is not available":o,"Invalid payload.":p,"Amount must be greater than 0":h,"Not enough balance.":f,"The order id field is required.":h,"Not enough balance":f,"This action is unauthorized.":u,"This API Key is not authorized to perform this action.":u,"Unexecuted order was not found.":l,"The selected from is invalid.":p,503:r,422:l},broad:{"Given amount is less than min amount":h,"Total is less than":h,"fee must be no less than":h,"Enable your key in API settings":u,"You don't have such amount for transfer":f}}})}async fetchMarkets(e={}){const t=await this.v4PublicGetMarkets(),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"name"),a=this.safeString(s,"stock");let n=this.safeString(s,"money");n="PERP"===n?"USDT":n;const o=this.safeCurrencyCode(a),h=this.safeCurrencyCode(n),d=this.safeValue(s,"tradesEnabled"),c=this.safeValue(s,"isCollateral");let l,u,f,p=o+"/"+h;const m="futures"===this.safeString(s,"type"),g=c&&!m;m?(f=n,u=this.safeCurrencyCode(f),p=p+":"+u,l="swap"):l="spot";const y={id:r,symbol:p,base:o,quote:h,settle:u,baseId:a,quoteId:n,settleId:f,type:l,spot:!m,margin:g,swap:m,future:!1,option:!1,active:d,contract:!1,linear:void 0,inverse:void 0,taker:this.safeNumber(s,"makerFee"),maker:this.safeNumber(s,"takerFee"),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(s,"stockPrec"))),price:this.parseNumber(this.parsePrecision(this.safeString(s,"moneyPrec")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(s,"minAmount"),max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(s,"minTotal"),max:void 0}},info:s};i.push(y)}return i}async fetchCurrencies(e={}){const t=await this.v4PublicGetAssets(e),i=Object.keys(t),s={};for(let e=0;e<i.length;e++){const r=i[e],a=t[r],n=this.safeValue(a,"can_deposit",!0),o=this.safeValue(a,"can_withdraw",!0),h=n&&o,d=this.safeCurrencyCode(r);s[d]={id:r,code:d,info:a,name:void 0,active:h,deposit:n,withdraw:o,fee:void 0,precision:void 0,limits:{amount:{min:void 0,max:void 0},withdraw:{min:this.safeNumber(a,"min_withdraw"),max:this.safeNumber(a,"max_withdraw")}}}}return s}async fetchTransactionFees(e,t={}){await this.loadMarkets();const i=await this.v4PublicGetFee(t),s=Object.keys(i),r={},a={};for(let e=0;e<s.length;e++){const t=s[e],n=i[t],o=this.safeCurrencyCode(t),h=this.safeValue(n,"withdraw",{});r[o]=this.safeString(h,"fixed");const d=this.safeValue(n,"deposit",{});a[o]=this.safeString(d,"fixed")}return{withdraw:r,deposit:a,info:i}}async fetchDepositWithdrawFees(e,t={}){await this.loadMarkets();const i=await this.v4PublicGetFee(t);return this.parseDepositWithdrawFees(i,e)}parseDepositWithdrawFees(e,t,i){const s={};t=this.marketCodes(t);const r=Object.keys(e);for(let i=0;i<r.length;i++){const a=r[i],n=a.split(" "),o=n[0],h=e[a],d=this.safeCurrencyCode(o);if(void 0===t||this.inArray(d,t)){void 0===this.safeValue(s,d)&&(s[d]=this.depositWithdrawFee({})),s[d].info[a]=h;let e=this.safeString(n,1);const t=this.safeValue(h,"withdraw"),i=this.safeValue(h,"deposit"),r=this.safeNumber(t,"fixed"),o=this.safeNumber(i,"fixed"),c={fee:r,percentage:void 0===r&&void 0},l={fee:o,percentage:void 0===o&&void 0};if(void 0!==e){const t=e.length;e=e.slice(1,t-1);const i=this.networkIdToCode(e);s[d].networks[i]={withdraw:c,deposit:l}}else s[d].withdraw=c,s[d].deposit=l}}const a=Object.keys(s);for(let e=0;e<a.length;e++){const t=a[e],i=this.currency(t);s[t]=this.assignDefaultDepositWithdrawFees(s[t],i)}return s}async fetchTradingFees(e={}){const t=await this.v4PublicGetAssets(e),i={};for(let e=0;e<this.symbols.length;e++){const s=this.symbols[e],r=this.market(s),a=this.safeValue(t,r.baseId,{});let n=this.safeString(a,"maker_fee"),o=this.safeString(a,"taker_fee");n=y.stringDiv(n,"100"),o=y.stringDiv(o,"100"),i[s]={info:a,symbol:r.symbol,percentage:!0,tierBased:!1,maker:this.parseNumber(n),taker:this.parseNumber(o)}}return i}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={market:i.id},r=await this.v1PublicGetTicker(this.extend(s,t)),a=this.safeValue(r,"result",{});return this.parseTicker(a,i)}parseTicker(e,t){t=this.safeMarket(void 0,t);const i=this.safeString(e,"last_price");return this.safeTicker({symbol:t.symbol,timestamp:void 0,datetime:void 0,high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:void 0,open:this.safeString(e,"open"),close:i,last:i,previousClose:void 0,change:void 0,percentage:this.safeString(e,"change"),average:void 0,baseVolume:this.safeString2(e,"base_volume","volume"),quoteVolume:this.safeString2(e,"quote_volume","deal"),info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.v4PublicGetTicker(t),s=Object.keys(i),r={};for(let e=0;e<s.length;e++){const t=s[e],a=this.safeMarket(t),n=this.parseTicker(i[t],a);r[n.symbol]=n}return this.filterByArray(r,"symbol",e)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={market:this.market(e).id};void 0!==t&&(s.depth=t);const r=await this.v4PublicGetOrderbookMarket(this.extend(s,i)),a=this.parseNumber(y.stringMul(this.safeString(r,"timestamp"),"1000"));return this.parseOrderBook(r,e,a)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={market:r.id},n=await this.v4PublicGetTradesMarket(this.extend(a,s));return this.parseTrades(n,r,t,i)}async fetchMyTrades(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.market=r.id);const n=await this.v4PrivatePostTradeAccountExecutedHistory(this.extend(a,s));if(Array.isArray(n))return this.parseTrades(n,r,t,i);{let e=[];const s=Object.keys(n);for(let r=0;r<s.length;r++){const a=s[r],o=this.safeMarket(a,void 0,"_"),h=this.safeValue(n,a,[]),d=this.parseTrades(h,o,t,i);e=this.arrayConcat(e,d)}e=this.sortBy2(e,"timestamp","id");const r=void 0===t;return this.filterBySinceLimit(e,t,i,"timestamp",r)}}parseTrade(e,t){t=this.safeMarket(void 0,t);const i=this.safeTimestamp2(e,"time","trade_timestamp"),s=this.safeString2(e,"dealOrderId","orderId"),r=this.safeString(e,"deal"),a=this.safeString(e,"price"),n=this.safeString2(e,"amount","quote_volume"),o=this.safeString2(e,"id","tradeID"),h=this.safeString2(e,"type","side"),d=t.symbol,c=this.safeInteger(e,"role");let l,u;void 0!==c&&(l=1===c?"maker":"taker");const f=this.safeString(e,"fee");return void 0!==f&&(u={cost:f,currency:t.quote}),this.safeTrade({info:e,timestamp:i,datetime:this.iso8601(i),symbol:d,id:o,order:s,type:void 0,takerOrMaker:l,side:h,price:a,amount:n,cost:r,fee:u},t)}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={market:a.id,interval:this.safeString(this.timeframes,t,t)};if(void 0!==i){const e=1440;void 0===s&&(s=e),s=Math.min(s,e);const r=parseInt(i/1e3),a=this.parseTimeframe(t),o=this.sum(r,a*s);n.start=r,n.end=o}void 0!==s&&(n.limit=Math.min(s,1440));const o=await this.v1PublicGetKline(this.extend(n,r)),h=this.safeValue(o,"result",[]);return this.parseOHLCVs(h,a,t,i,s)}parseOHLCV(e,t){return[this.safeTimestamp(e,0),this.safeNumber(e,1),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,2),this.safeNumber(e,5)]}async fetchStatus(e={}){const t=await this.v4PublicGetPing(e),i=this.safeString(t,0);return{status:"pong"===i?"ok":i,updated:void 0,eta:void 0,url:void 0,info:t}}async fetchTime(e={}){const t=await this.v4PublicGetTime(e);return this.safeInteger(t,"time")}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o={market:n.id,side:i,amount:this.amountToPrecision(e,s)},h=this.safeString2(a,"clOrdId","clientOrderId");if(void 0===h){const e=this.safeString(this.options,"brokerId");void 0!==e&&(o.clientOrderId=e+this.uuid16())}else o.clientOrderId=h,a=this.omit(a,["clientOrderId"]);const d=this.safeString(n,"type"),c="limit"===t,l="market"===t,u=this.safeNumberN(a,["triggerPrice","stopPrice","activation_price"]),f=void 0!==u,p=this.isPostOnly(l,!1,a),[g,y]=this.handleMarginModeAndParams("createOrder",a);let b;if(p&&(o.postOnly=!0),void 0!==g&&"cross"!==g)throw new m(this.id+" createOrder() is only available for cross margin");const v=void 0!==g||"swap"===d;f?(o.activation_price=this.priceToPrecision(e,u),c?(b="v4PrivatePostOrderStopLimit",o.price=this.priceToPrecision(e,r)):(b="v4PrivatePostOrderStopMarket",v&&(b="v4PrivatePostOrderCollateralTriggerMarket"))):c?(b="v4PrivatePostOrderNew",v&&(b="v4PrivatePostOrderCollateralLimit"),o.price=this.priceToPrecision(e,r)):(b="v4PrivatePostOrderStockMarket",v&&(b="v4PrivatePostOrderCollateralMarket")),a=this.omit(y,["postOnly","triggerPrice","stopPrice"]);const w=await this[b](this.extend(o,a));return this.parseOrder(w)}async cancelOrder(e,t,i={}){if(void 0===t)throw new d(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s={market:this.market(t).id,orderId:parseInt(e)};return await this.v4PrivatePostOrderCancel(this.extend(s,i))}parseBalance(e){const t=Object.keys(e),i={};for(let s=0;s<t.length;s++){const r=t[s],a=this.safeCurrencyCode(r),n=e[r];if("object"==typeof n&&void 0!==n){const e=this.account();e.free=this.safeString(n,"available"),e.used=this.safeString(n,"freeze"),e.total=this.safeString(n,"main_balance"),i[a]=e}else{const e=this.account();e.total=n,i[a]=e}}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const[t,i]=this.handleMarketTypeAndParams("fetchBalance",void 0,e);let s;if("swap"===t)s="v4PrivatePostCollateralAccountBalance";else{const t=this.safeValue(this.options,"fetchBalance",{}),i=this.safeString(t,"account"),r=this.safeString(e,"account",i);e=this.omit(e,"account"),s="main"===r?"v4PrivatePostMainAccountBalance":"v4PrivatePostTradeAccountBalance"}const r=await this[s](i);return this.parseBalance(r)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new d(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a={market:r.id};void 0!==i&&(a.limit=Math.min(i,100));const n=await this.v4PrivatePostOrders(this.extend(a,s));return this.parseOrders(n,r,t,i,{status:"open"})}async fetchClosedOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),e=a.symbol,r.market=a.id),void 0!==i&&(r.limit=Math.min(i,100));const n=await this.v4PrivatePostTradeAccountOrderHistory(this.extend(r,s)),o=Object.keys(n);let h=[];for(let e=0;e<o.length;e++){const t=o[e],i=this.safeMarket(t,void 0,"_"),s=n[t];for(let e=0;e<s.length;e++){const t=this.parseOrder(s[e],i);h.push(this.extend(t,{status:"closed"}))}}return h=this.sortBy(h,"timestamp"),h=this.filterBySymbolSinceLimit(h,e,t,i),h}parseOrderType(e){return this.safeString({limit:"limit",market:"market","stop market":"market","stop limit":"limit","stock market":"market","margin limit":"limit","margin market":"market"},e,e)}parseOrder(e,t){const i=this.safeString(e,"market"),s=(t=this.safeMarket(i,t,"_")).symbol,r=this.safeString(e,"side"),a=this.safeString(e,"dealStock"),n=this.safeString(e,"left");let o=this.safeString(e,"clientOrderId");""===o&&(o=void 0);const h=this.safeString(e,"price"),d=this.safeNumber(e,"activation_price"),c=this.safeString2(e,"orderId","id"),l=this.safeString(e,"type");let u=this.safeString(e,"amount");const f=this.safeString(e,"dealMoney");"buy"!==r||"market"!==l&&"stop market"!==l||(u=a);const p=this.safeString(e,"dealFee");let m;void 0!==p&&(m={cost:this.parseNumber(p),currency:t.quote});const g=this.safeTimestamp2(e,"ctime","timestamp"),y=this.safeTimestamp(e,"ftime");return this.safeOrder({info:e,id:c,symbol:s,clientOrderId:o,timestamp:g,datetime:this.iso8601(g),lastTradeTimestamp:y,timeInForce:void 0,postOnly:void 0,status:void 0,side:r,price:h,type:this.parseOrderType(l),stopPrice:d,triggerPrice:d,amount:u,filled:a,remaining:n,average:void 0,cost:f,fee:m,trades:void 0},t)}async fetchOrderTrades(e,t,i,s,r={}){await this.loadMarkets();const a={orderId:parseInt(e)};let n;void 0!==t&&(n=this.market(t),a.market=n.id),void 0!==s&&(a.limit=Math.min(s,100));const o=await this.v4PrivatePostTradeAccountOrder(this.extend(a,r)),h=this.safeValue(o,"records",[]);return this.parseTrades(h,n)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i={ticker:this.currency(e).id};let s="v4PrivatePostMainAccountAddress";if(this.isFiat(e)){s="v4PrivatePostMainAccountFiatDepositUrl";const e=this.safeNumber(t,"provider");if(void 0===e)throw new d(this.id+" fetchDepositAddress() requires a provider when the ticker is fiat");i.provider=e;const r=this.safeNumber(t,"amount");if(void 0===r)throw new d(this.id+" fetchDepositAddress() requires an amount when the ticker is fiat");i.amount=r;if(void 0===this.safeValue(t,"uniqueId"))throw new d(this.id+" fetchDepositAddress() requires an uniqueId when the ticker is fiat")}const r=await this[s](this.extend(i,t)),a=this.safeString(r,"url"),n=this.safeValue(r,"account",{}),o=this.safeString(n,"address",a),h=this.safeString(n,"memo");return this.checkAddress(o),{currency:e,address:o,tag:h,network:void 0,info:r}}async setLeverage(e,t,i={}){if(await this.loadMarkets(),void 0!==t)throw new m(this.id+" setLeverage() does not allow to set per symbol");if(e<1||e>20)throw new p(this.id+" setLeverage() leverage should be between 1 and 20");const s={leverage:e};return await this.v4PrivatePostCollateralAccountLeverage(this.extend(s,i))}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n=this.safeValue(this.options,"accountsByType"),o=this.safeString(n,i,i),h=this.safeString(n,s,s),d=this.currencyToPrecision(e,t),c={ticker:a.id,amount:d,from:o,to:h},l=await this.v4PrivatePostMainAccountTransfer(this.extend(c,r));return this.parseTransfer(l,a)}parseTransfer(e,t){return{info:e,id:void 0,timestamp:void 0,datetime:void 0,currency:this.safeCurrencyCode(void 0,t),amount:void 0,fromAccount:void 0,toAccount:void 0,status:void 0}}async withdraw(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n={ticker:a.id,amount:this.currencyToPrecision(e,t),address:i};let o=this.safeValue(r,"uniqueId");if(void 0===o&&(o=this.uuid22()),n.uniqueId=o,void 0!==s&&(n.memo=s),this.isFiat(e)){const e=this.safeValue(r,"provider");if(void 0===e)throw new d(this.id+" withdraw() requires a provider when the ticker is fiat");n.provider=e}const h=await this.v4PrivatePostMainAccountWithdraw(this.extend(n,r));return this.extend({id:o},this.parseTransaction(h,a))}parseTransaction(e,t){t=this.safeCurrency(void 0,t);const i=this.safeString(e,"address"),s=this.safeTimestamp(e,"createdAt"),r=this.safeString(e,"ticker"),a=this.safeString(e,"status"),n=this.safeString(e,"method");return{id:this.safeString(e,"uniqueId"),txid:this.safeString(e,"transactionHash"),timestamp:s,datetime:this.iso8601(s),network:this.safeString(e,"network"),addressFrom:"1"===n?i:void 0,address:i,addressTo:"2"===n?i:void 0,amount:this.safeNumber(e,"amount"),type:"1"===n?"deposit":"withdrawal",currency:this.safeCurrencyCode(r,t),status:this.parseTransactionStatus(a),updated:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,comment:this.safeString(e,"description"),fee:{cost:this.safeNumber(e,"fee"),currency:this.safeCurrencyCode(r,t)},info:e}}parseTransactionStatus(e){return this.safeString({1:"pending",2:"pending",3:"ok",4:"canceled",5:"pending",6:"pending",7:"ok",9:"canceled",10:"pending",11:"pending",12:"pending",13:"pending",14:"pending",15:"pending",16:"pending",17:"pending"},e,e)}async fetchDeposit(e,t,i={}){let s;await this.loadMarkets();const r={transactionMethod:1,uniqueId:e,limit:1,offset:0};void 0!==t&&(s=this.currency(t),r.ticker=s.id);const a=await this.v4PrivatePostMainAccountHistory(this.extend(r,i)),n=this.safeValue(a,"records",[]),o=this.safeValue(n,0,{});return this.parseTransaction(o,s)}async fetchDeposits(e,t,i,s={}){let r;await this.loadMarkets();const a={transactionMethod:1,limit:100,offset:0};void 0!==e&&(r=this.currency(e),a.ticker=r.id),void 0!==i&&(a.limit=Math.min(i,100));const n=await this.v4PrivatePostMainAccountHistory(this.extend(a,s)),o=this.safeValue(n,"records",[]);return this.parseTransactions(o,r,t,i)}async fetchBorrowInterest(e,t,i,s,r={}){await this.loadMarkets();const a={};let n;void 0!==t&&(n=this.market(t),a.market=n.id);const o=await this.v4PrivatePostCollateralAccountPositionsOpen(this.extend(a,r)),h=this.parseBorrowInterests(o,n);return this.filterByCurrencySinceLimit(h,e,i,s)}parseBorrowInterest(e,t){const i=this.safeString(e,"market"),s=this.safeSymbol(i,t,"_"),r=this.safeTimestamp(e,"modifyDate");return{symbol:s,marginMode:"cross",currency:"USDT",interest:this.safeNumber(e,"unrealizedFunding"),interestRate:98e-5,amountBorrowed:this.safeNumber(e,"amount"),timestamp:r,datetime:this.iso8601(r),info:e}}isFiat(e){const t=this.safeValue(this.options,"fiatCurrencies",[]);return this.inArray(e,t)}sign(e,t="public",i="GET",s={},r,a){const n=this.omit(s,this.extractParams(e)),o=this.safeValue(t,0),h=this.safeValue(t,1),d="/"+this.implodeParams(e,s);let c=this.urls.api[o][h]+d;if("public"===h&&Object.keys(n).length&&(c+="?"+this.urlencode(n)),"private"===h){this.checkRequiredCredentials();const e=this.nonce().toString(),t=this.stringToBinary(this.encode(this.secret)),i="/api/"+o+d;a=this.json(this.extend({request:i,nonce:e},s));const n=this.stringToBase64(a),h=this.hmac(n,t,"sha512");r={"Content-Type":"application/json","X-TXC-APIKEY":this.apiKey,"X-TXC-PAYLOAD":this.decode(n),"X-TXC-SIGNATURE":h}}return{url:c,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,o,h,d,c){if(418===e||429===e)throw new n(this.id+" "+e.toString()+" "+t+" "+o);if(404===e)throw new a(this.id+" "+e.toString()+" endpoint not found");if(void 0!==h){const e=this.safeString(h,"status"),t=this.safeString(h,"message"),i=this.safeInteger(h,"code"),s=void 0!==e&&"200"!==e;if(s||void 0!==i){const i=this.id+" "+o;let r=t;if(s)r=e;else{const e=this.safeValue(h,"errors");if(void 0!==e){const t=Object.keys(e)[0],i=this.safeValue(e,t,[]);r=i.length>0?i[0]:o}}throw this.throwExactlyMatchedException(this.exceptions.exact,r,i),this.throwBroadlyMatchedException(this.exceptions.broad,o,i),new a(i)}}}}},17630:function(e,t,i){"use strict";const s=i(48819),{ArgumentsRequired:r,AuthenticationError:a,RateLimitExceeded:n,BadRequest:o,ExchangeError:h,InvalidOrder:d}=i(73449),{TICK_SIZE:c}=i(62115),l=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"woo",name:"WOO X",countries:["KY"],rateLimit:100,version:"v1",certified:!1,pro:!0,hostname:"woo.org",has:{CORS:void 0,spot:!0,margin:!0,swap:!0,future:!1,option:!1,addMargin:!1,borrowMargin:!1,cancelAllOrders:!0,cancelOrder:!0,cancelWithdraw:!1,createDepositAddress:!1,createMarketOrder:!1,createOrder:!0,createReduceOnlyOrder:!0,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchAccounts:!0,fetchBalance:!0,fetchCanceledOrders:!1,fetchClosedOrder:!1,fetchClosedOrders:!1,fetchCurrencies:!0,fetchDepositAddress:!1,fetchDeposits:!0,fetchFundingHistory:!0,fetchFundingRate:!0,fetchFundingRateHistory:!0,fetchFundingRates:!0,fetchIndexOHLCV:!1,fetchLedger:!0,fetchLeverage:!0,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrder:!1,fetchOpenOrders:!1,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchOrderTrades:!0,fetchPosition:!0,fetchPositionMode:!1,fetchPositions:!0,fetchPremiumIndexOHLCV:!1,fetchStatus:!1,fetchTicker:!1,fetchTickers:!1,fetchTime:!1,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactions:!0,fetchTransfers:!0,fetchWithdrawals:!0,reduceMargin:!1,repayMargin:!0,setLeverage:!0,setMargin:!1,transfer:!0,withdraw:!0},timeframes:{"1m":"1m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","4h":"4h","12h":"12h","1d":"1d","1w":"1w","1M":"1mon","1y":"1y"},urls:{logo:"https://user-images.githubusercontent.com/1294454/150730761-1a00e5e0-d28c-480f-9e65-089ce3e6ef3b.jpg",api:{pub:"https://api-pub.woo.org",public:"https://api.{hostname}",private:"https://api.{hostname}"},test:{pub:"https://api-pub.staging.woo.org",public:"https://api.staging.woo.org",private:"https://api.staging.woo.org"},www:"https://woo.org/",doc:["https://docs.woo.org/"],fees:["https://support.woo.org/hc/en-001/articles/4404611795353--Trading-Fees"],referral:"https://referral.woo.org/BAJS6oNmZb3vi3RGA"},api:{v1:{pub:{get:{"hist/kline":10,"hist/trades":1}},public:{get:{info:1,"info/{symbol}":1,system_info:1,market_trades:1,token:1,token_network:1,funding_rates:1,"funding_rate/{symbol}":1,funding_rate_history:1,futures:1,"futures/{symbol}":1}},private:{get:{"client/token":1,"order/{oid}":1,"client/order/{client_order_id}":1,orders:1,"orderbook/{symbol}":1,kline:1,"client/trade/{tid}":1,"order/{oid}/trades":1,"client/trades":1,"client/info":60,"asset/deposit":10,"asset/history":60,"sub_account/all":60,"sub_account/assets":60,token_interest:60,"token_interest/{token}":60,"interest/history":60,"interest/repay":60,"funding_fee/history":30,positions:3.33,"position/{symbol}":3.33},post:{order:5,"asset/main_sub_transfer":30,"asset/withdraw":30,"interest/repay":60,"client/account_mode":120,"client/leverage":120},delete:{order:1,"client/order":1,orders:1,"asset/withdraw":120}}},v2:{private:{get:{"client/holding":1}}},v3:{private:{get:{"algo/order/{oid}":1,"algo/orders":1},post:{"algo/order":5},put:{"order/{oid}":2,"order/client/{oid}":2,"algo/order/{oid}":2,"algo/order/client/{oid}":2},delete:{"algo/order/{oid}":1,"algo/orders/pending":1,"algo/orders/pending/{symbol}":1,"orders/pending":1}}}},fees:{trading:{tierBased:!0,percentage:!0,maker:this.parseNumber("0.0002"),taker:this.parseNumber("0.0005")}},options:{createMarketBuyOrderRequiresPrice:!0,"network-aliases-for-tokens":{HT:"ERC20",OMG:"ERC20",UATOM:"ATOM",ZRX:"ZRX"},networks:{TRX:"TRON",TRC20:"TRON",ERC20:"ETH",BEP20:"BSC"},defaultNetworkCodeForCurrencies:{},transfer:{fillResponseFromRequest:!0}},commonCurrencies:{},exceptions:{exact:{"-1000":h,"-1001":a,"-1002":a,"-1003":n,"-1004":o,"-1005":o,"-1006":o,"-1007":o,"-1008":d,"-1009":o,"-1011":h,"-1012":o,"-1101":d,"-1102":d,"-1103":d,"-1104":d,"-1105":d},broad:{"symbol must not be blank":o,"The token is not supported":o,"Your order and symbol are not valid or already canceled":o,"Insufficient WOO. Please enable margin trading for leverage trading":o}},precisionMode:c})}async fetchMarkets(e={}){const t=await this.v1PublicGetInfo(e),i=[],s=this.safeValue(t,"rows",[]);for(let e=0;e<s.length;e++){const t=s[e],r=this.safeString(t,"symbol"),a=r.split("_");let n=this.safeStringLower(a,0);const o="spot"===n,h="perp"===n,d=this.safeString(a,1),c=this.safeString(a,2),l=this.safeCurrencyCode(d),u=this.safeCurrencyCode(c);let f,p,m,g,y=l+"/"+u;h&&(f=this.safeString(a,2),p=this.safeCurrencyCode(f),y=l+"/"+u+":"+p,m=this.parseNumber("1"),n="swap",g=!0),i.push({id:r,symbol:y,base:l,quote:u,settle:p,baseId:d,quoteId:c,settleId:f,type:n,spot:o,margin:!0,swap:h,future:!1,option:!1,active:void 0,contract:h,linear:g,inverse:void 0,contractSize:m,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(t,"base_tick"),price:this.safeNumber(t,"quote_tick")},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(t,"base_min"),max:this.safeNumber(t,"base_max")},price:{min:this.safeNumber(t,"quote_min"),max:this.safeNumber(t,"quote_max")},cost:{min:this.safeNumber(t,"min_notional"),max:void 0}},info:t})}return i}async fetchTrades(e,t,i,s={}){if(void 0===e)throw new r(this.id+" fetchTrades() requires a symbol argument");await this.loadMarkets();const a=this.market(e),n={symbol:a.id};void 0!==i&&(n.limit=i);const o=await this.v1PublicGetMarketTrades(this.extend(n,s)),h=this.safeValue(o,"rows",{});return this.parseTrades(h,a,t,i)}parseTrade(e,t){const i="id"in e,s=this.safeTimestamp(e,"executed_timestamp"),r=this.safeString(e,"symbol"),a=(t=this.safeMarket(r,t)).symbol,n=this.safeString(e,"executed_price"),o=this.safeString(e,"executed_quantity"),h=this.safeString(e,"order_id"),d=this.parseTokenAndFeeTemp(e,"fee_asset","fee"),c=l.stringMul(n,o),u=this.safeStringLower(e,"side"),f=this.safeString(e,"id");let p;if(i){p="1"===this.safeString(e,"is_maker")?"maker":"taker"}return this.safeTrade({id:f,timestamp:s,datetime:this.iso8601(s),symbol:a,side:u,price:n,amount:o,cost:c,order:h,takerOrMaker:p,type:void 0,fee:d,info:e},t)}parseTokenAndFeeTemp(e,t,i){const s=this.safeString(e,i);let r;if(void 0!==s){const i=this.safeString(e,t);r={cost:s,currency:this.safeCurrencyCode(i)}}return r}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.v1PrivateGetClientInfo(e),i=this.safeValue(t,"application",{}),s=this.safeString(i,"maker_fee_rate"),r=this.safeString(i,"taker_fee_rate"),a={};for(let e=0;e<this.symbols.length;e++){const i=this.symbols[e];a[i]={info:t,symbol:i,maker:this.parseNumber(l.stringDiv(s,"10000")),taker:this.parseNumber(l.stringDiv(r,"10000")),percentage:!0,tierBased:!0}}return a}async fetchCurrencies(e={}){const t={},i=await this.v1PublicGetToken(e),s=this.safeValue(i,"rows",[]),r=this.groupBy(s,"balance_token"),a=Object.keys(r);for(let e=0;e<a.length;e++){const i=a[e],s=r[i],n=this.safeCurrencyCode(i);let o,h;const d={};for(let e=0;e<s.length;e++){const t=s[e];o=this.safeString(t,"fullname");const i=this.safeString(t,"token"),r=i.split("_")[0],a=this.parsePrecision(this.safeString(t,"decimals"));void 0!==a&&(h=void 0===h?a:l.stringMin(a,h)),d[r]={id:i,network:r,limits:{withdraw:{min:void 0,max:void 0},deposit:{min:void 0,max:void 0}},active:void 0,deposit:void 0,withdraw:void 0,fee:void 0,precision:this.parseNumber(a),info:t}}t[n]={id:i,name:o,code:n,precision:this.parseNumber(h),active:void 0,fee:void 0,networks:d,deposit:void 0,withdraw:void 0,limits:{deposit:{min:void 0,max:void 0},withdraw:{min:void 0,max:void 0}},info:s}}return t}async createOrder(e,t,i,s,r,a={}){const n=this.safeValue(a,"reduceOnly"),o=t.toUpperCase();if(void 0!==n&&"LIMIT"!==o)throw new d(this.id+" createOrder() only support reduceOnly for limit orders");await this.loadMarkets();const h=this.market(e),c=i.toUpperCase(),u={symbol:h.id,order_type:o,side:c},f="MARKET"===o,p=this.safeStringLower(a,"timeInForce");if(this.isPostOnly(f,void 0,a)?u.order_type="POST_ONLY":"fok"===p?u.order_type="FOK":"ioc"===p&&(u.order_type="IOC"),n&&(u.reduce_only=n),void 0!==r&&(u.order_price=this.priceToPrecision(e,r)),f)if(h.spot&&"BUY"===c){const t=this.safeNumber(a,"cost");if(this.safeValue(this.options,"createMarketBuyOrderRequiresPrice",!0))if(void 0===t){if(void 0===r)throw new d(this.id+" createOrder() requires the price argument for market buy orders to calculate total order cost. Supply a price argument to createOrder() call if you want the cost to be calculated for you from price and amount, or alternatively, supply the total cost value in the 'order_amount' in  exchange-specific parameters");{const t=this.numberToString(s),i=this.numberToString(r),a=l.stringMul(t,i);u.order_amount=this.costToPrecision(e,a)}}else u.order_amount=this.costToPrecision(e,t);else u.order_amount=this.costToPrecision(e,s)}else u.order_quantity=this.amountToPrecision(e,s);else u.order_quantity=this.amountToPrecision(e,s);const m=this.safeString2(a,"clOrdID","clientOrderId");void 0!==m&&(u.client_order_id=m),a=this.omit(a,["clOrdID","clientOrderId","postOnly","timeInForce"]);const g=await this.v1PrivatePostOrder(this.extend(u,a));return this.extend(this.parseOrder(g,h),{type:t})}async editOrder(e,t,i,s,r,a,n={}){await this.loadMarkets();const o=this.market(t),h={oid:e};void 0!==a&&(h.price=this.priceToPrecision(t,a)),void 0!==r&&(h.quantity=this.amountToPrecision(t,r));const d=await this.v3PrivatePutOrderOid(this.extend(h,n)),c=this.safeValue(d,"data",{});return this.parseOrder(c,o)}async cancelOrder(e,t,i={}){if(void 0===t)throw new r(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s={},a=this.safeString2(i,"clOrdID","clientOrderId"),n=this.safeString2(i,"client_order_id",a),o=void 0!==n;let h;o?(s.client_order_id=n,i=this.omit(i,["clOrdID","clientOrderId","client_order_id"])):s.order_id=e,void 0!==t&&(h=this.market(t)),s.symbol=h.id;const d=await this.v1PrivateDeleteOrder(this.extend(s,i)),c={symbol:t};return o?c.client_order_id=n:c.id=e,this.extend(this.parseOrder(d),c)}async cancelAllOrders(e,t={}){if(void 0===e)throw new r(this.id+" canelOrders() requires a symbol argument");await this.loadMarkets();const i={symbol:this.market(e).id};return await this.v1PrivateDeleteOrders(this.extend(i,t))}async fetchOrder(e,t,i={}){await this.loadMarkets();const s=void 0!==t?this.market(t):void 0,r={},a=this.safeString2(i,"clOrdID","clientOrderId");let n;a?(n="v1PrivateGetClientOrderClientOrderId",r.client_order_id=a):(n="v1PrivateGetOrderOid",r.oid=e);const o=await this[n](this.extend(r,i));return this.parseOrder(o,s)}async fetchOrders(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.symbol=a.id),void 0!==t&&(r.start_t=t);const n=await this.v1PrivateGetOrders(this.extend(r,s)),o=this.safeValue(n,"rows");return this.parseOrders(o,a,t,i,s)}parseTimeInForce(e){return this.safeString({ioc:"IOC",fok:"FOK",post_only:"PO"},e,void 0)}parseOrder(e,t){const i=this.safeTimestamp2(e,"timestamp","created_time"),s=this.safeString(e,"order_id"),r=this.safeString(e,"client_order_id"),a=this.safeString(e,"symbol"),n=(t=this.safeMarket(a,t)).symbol,o=this.safeString2(e,"order_price","price"),h=this.safeString2(e,"order_quantity","quantity"),d=this.safeString2(e,"order_amount","amount"),c=this.safeStringLower2(e,"order_type","type"),u=this.safeValue(e,"status"),f=this.safeStringLower(e,"side"),p=this.safeValue(e,"executed"),m=l.stringSub(d,p),g=this.safeValue(e,"total_fee"),y=this.safeString(e,"fee_asset"),b=this.safeValue(e,"Transactions");return this.safeOrder({id:s,clientOrderId:r,timestamp:i,datetime:this.iso8601(i),lastTradeTimestamp:void 0,status:this.parseOrderStatus(u),symbol:n,type:c,timeInForce:this.parseTimeInForce(c),postOnly:void 0,reduceOnly:this.safeValue(e,"reduce_only"),side:f,price:o,stopPrice:void 0,triggerPrice:void 0,average:void 0,amount:h,filled:p,remaining:m,cost:d,trades:b,fee:{cost:g,currency:y},info:e},t)}parseOrderStatus(e){if(void 0!==e){const t={NEW:"open",FILLED:"closed",CANCEL_SENT:"canceled",CANCEL_ALL_SENT:"canceled",CANCELLED:"canceled",PARTIAL_FILLED:"open",REJECTED:"rejected",INCOMPLETE:"open",COMPLETED:"closed"};return this.safeString(t,e,e)}return e}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s={symbol:this.market(e).id};void 0!==t&&(t=Math.min(t,1e3),s.max_level=t);const r=await this.v1PrivateGetOrderbookSymbol(this.extend(s,i)),a=this.safeInteger(r,"timestamp");return this.parseOrderBook(r,e,a,"bids","asks","price","quantity")}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.id,type:this.safeString(this.timeframes,t,t)};void 0!==s&&(n.limit=Math.min(s,1e3));const o=await this.v1PrivateGetKline(this.extend(n,r)),h=this.safeValue(o,"rows",[]);return this.parseOHLCVs(h,a,t,i,s)}parseOHLCV(e,t){return[this.safeInteger(e,"start_timestamp"),this.safeNumber(e,"open"),this.safeNumber(e,"high"),this.safeNumber(e,"low"),this.safeNumber(e,"close"),this.safeNumber(e,"volume")]}async fetchOrderTrades(e,t,i,s,r={}){let a;await this.loadMarkets(),void 0!==t&&(a=this.market(t));const n={oid:e},o=await this.v1PrivateGetOrderOidTrades(this.extend(n,r)),h=this.safeValue(o,"rows",[]);return this.parseTrades(h,a,i,s,r)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.symbol=a.id),void 0!==t&&(r.start_t=t);const n=await this.v1PrivateGetClientTrades(this.extend(r,s)),o=this.safeValue(n,"rows",[]);return this.parseTrades(o,a,t,i,s)}async fetchAccounts(e={}){const t=await this.v1PrivateGetSubAccountAssets(e),i=this.safeValue(t,"rows",[]);return this.parseAccounts(i,e)}parseAccount(e){const t=this.safeString(e,"account");return{info:e,id:this.safeString(e,"application_id"),name:t,code:void 0,type:"Main"===t?"main":"subaccount"}}async fetchBalance(e={}){await this.loadMarkets();const t=await this.v2PrivateGetClientHolding(e);return this.parseBalance(t)}parseBalance(e){const t={info:e},i=this.safeValue(e,"holding",[]);for(let e=0;e<i.length;e++){const s=i[e],r=this.safeCurrencyCode(this.safeString(s,"token")),a=this.account();a.total=this.safeString(s,"holding");const n=this.safeString(s,"outstanding_holding");a.used=l.stringNeg(n),t[r]=a}return this.safeBalance(t)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s=this.defaultNetworkCodeForCurrency(e),r=this.safeString(t,"network",s);t=this.omit(t,"network");const a={token:r+"_"+i.code},n=await this.v1PrivateGetAssetDeposit(this.extend(a,t)),o=this.safeString(n,"extra"),h=this.safeString(n,"address");return this.checkAddress(h),{currency:e,address:h,tag:o,network:r,info:n}}async getAssetHistoryRows(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.balance_token=a.id),void 0!==t&&(r.start_t=t),void 0!==i&&(r.pageSize=i);const n=this.safeString(s,"type");s=this.omit(s,"type"),void 0!==n&&(r.type=n);const o=await this.v1PrivateGetAssetHistory(this.extend(r,s));return[a,this.safeValue(o,"rows",{})]}async fetchLedger(e,t,i,s={}){const[r,a]=await this.getAssetHistoryRows(e,t,i,s);return this.parseLedger(a,r,t,i,s)}parseLedgerEntry(e,t){const i=this.safeString(e,"token"),s=this.getCurrencyFromChaincode(i,t).code,r=this.safeNumber(e,"amount"),a="DEPOSIT"===this.safeString(e,"token_side")?"in":"out",n=this.safeTimestamp(e,"created_time"),o=this.parseTokenAndFeeTemp(e,"fee_token","fee_amount");return{id:this.safeString(e,"id"),currency:s,account:this.safeString(e,"account"),referenceAccount:void 0,referenceId:this.safeString(e,"tx_id"),status:this.parseTransactionStatus(this.safeString(e,"status")),amount:r,before:void 0,after:void 0,fee:o,direction:a,timestamp:n,datetime:this.iso8601(n),type:this.parseLedgerEntryType(this.safeString(e,"type")),info:e}}parseLedgerEntryType(e){return this.safeString({BALANCE:"transaction",COLLATERAL:"transfer"},e,e)}getCurrencyFromChaincode(e,t){if(void 0!==t)return t;{const i=e.split("_"),s=i.length,r=this.safeString(i,0);let a=this.safeString(i,1,r);s>2&&(a+="_"+this.safeString(i,2)),t=this.safeCurrency(a)}return t}async fetchDeposits(e,t,i,s={}){return await this.fetchTransactions(e,t,i,this.extend({token_side:"DEPOSIT"},s))}async fetchWithdrawals(e,t,i,s={}){return await this.fetchTransactions(e,t,i,this.extend({token_side:"WITHDRAW"},s))}async fetchTransactions(e,t,i,s={}){const[r,a]=await this.getAssetHistoryRows(e,t,i,this.extend({type:"BALANCE"},s));return this.parseTransactions(a,r,t,i,s)}parseTransaction(e,t){const i=this.safeString(e,"token"),s=this.getCurrencyFromChaincode(i,t).code;let r=this.safeStringLower(e,"token_side");"withdraw"===r&&(r="withdrawal");const a=this.parseTokenAndFeeTemp(e,"fee_token","fee_amount"),n=this.safeString(e,"target_address"),o=this.safeString(e,"source_address"),h=this.safeTimestamp(e,"created_time");return{id:this.safeString2(e,"id","withdraw_id"),txid:this.safeString(e,"tx_id"),timestamp:h,datetime:this.iso8601(h),address:void 0,addressFrom:o,addressTo:n,tag:this.safeString(e,"extra"),type:r,amount:this.safeNumber(e,"amount"),currency:s,status:this.parseTransactionStatus(this.safeString(e,"status")),updated:this.safeTimestamp(e,"updated_time"),fee:a,info:e}}parseTransactionStatus(e){return this.safeString({NEW:"pending",CONFIRMING:"pending",PROCESSING:"pending",COMPLETED:"ok",CANCELED:"canceled"},e,e)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n={token:a.id,amount:this.parseNumber(t),from_application_id:i,to_application_id:s},o=await this.v1PrivatePostAssetMainSubTransfer(this.extend(n,r)),h=this.parseTransfer(o,a),d=this.safeValue(this.options,"transfer",{});return this.safeValue(d,"fillResponseFromRequest",!0)&&(h.amount=t,h.fromAccount=i,h.toAccount=s),h}async fetchTransfers(e,t,i,s={}){const[r,a]=await this.getAssetHistoryRows(e,t,i,this.extend({type:"COLLATERAL"},s));return this.parseTransfers(a,r,t,i,s)}parseTransfer(e,t){const i=this.safeString(e,"token"),s=this.getCurrencyFromChaincode(i,t).code;let r,a,n=this.safeStringLower(e,"token_side");"withdraw"===n&&(n="withdrawal"),"withdraw"===n?(r=void 0,a="spot"):"deposit"===n&&(r="spot",a=void 0);const o=this.safeTimestamp(e,"created_time"),h=this.safeValue(e,"success");let d;return void 0!==h&&(d=h?"ok":"failed"),{id:this.safeString(e,"id"),timestamp:o,datetime:this.iso8601(o),currency:s,amount:this.safeNumber(e,"amount"),fromAccount:r,toAccount:a,status:this.parseTransferStatus(this.safeString(e,"status",d)),info:e}}parseTransferStatus(e){return this.safeString({NEW:"pending",CONFIRMING:"pending",PROCESSING:"pending",COMPLETED:"ok",CANCELED:"canceled"},e,e)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r),await this.loadMarkets(),this.checkAddress(i);const a=this.currency(e),n={amount:t,address:i};void 0!==s&&(n.extra=s);const h=this.safeValue(this.options,"networks",{}),d=this.safeValue(a,"networks",{}),c=this.safeStringUpper(r,"network"),l=this.safeString(h,c,c),u=this.safeValue(d,l,{}),f=this.safeString(u,"id");if(void 0===f)throw new o(this.id+" withdraw() require network parameter");n.token=f;const p=await this.v1PrivatePostAssetWithdraw(this.extend(n,r));return this.parseTransaction(p,a)}async repayMargin(e,t,i,s={}){let r;await this.loadMarkets(),void 0!==i&&(r=this.market(i),i=r.symbol);const a=this.currency(e),n={token:a.id,amount:this.currencyToPrecision(e,t)},o=await this.v1PrivatePostInterestRepay(this.extend(n,s)),h=this.parseMarginLoan(o,a);return this.extend(h,{amount:t,symbol:i})}parseMarginLoan(e,t){return{id:void 0,currency:this.safeCurrencyCode(void 0,t),amount:void 0,symbol:void 0,timestamp:void 0,datetime:void 0,info:e}}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){const n=t[0],o=t[1],h=this.implodeParams(e,s);let d=this.implodeHostname(this.urls.api[o]);if(d+="/"+n+"/",s=this.omit(s,this.extractParams(e)),s=this.keysort(s),"public"===o)d+=o+"/"+h,Object.keys(s).length&&(d+="?"+this.urlencode(s));else{this.checkRequiredCredentials();let e="";const t=this.nonce().toString();d+=h,r={"x-api-key":this.apiKey,"x-api-timestamp":t},"v3"!==n||"POST"!==i&&"PUT"!==i&&"DELETE"!==i?(e=this.urlencode(s),"POST"===i||"PUT"===i||"DELETE"===i?a=e:d+="?"+e,e+="|"+t,r["content-type"]="application/x-www-form-urlencoded"):(e=this.json(s),e=t+i+"/"+n+"/"+h+(a=e),r["content-type"]="application/json"),r["x-api-signature"]=this.hmac(this.encode(e),this.encode(this.secret),"sha256")}return{url:d,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,n,o,h){if(!n)return;const d=this.safeValue(n,"success"),c=this.safeString(n,"code");if(!d){const e=this.id+" "+this.json(n);this.throwBroadlyMatchedException(this.exceptions.broad,a,e),this.throwExactlyMatchedException(this.exceptions.exact,c,e)}}parseIncome(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t),r=this.safeNumber(e,"funding_fee"),a=this.safeCurrencyCode("USD"),n=this.safeString(e,"id"),o=this.safeTimestamp(e,"updated_time"),h=this.safe_number(e,"funding_rate");return{info:e,symbol:s,code:a,timestamp:o,datetime:this.iso8601(o),id:n,amount:r,rate:h}}async fetchFundingHistory(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.market(e),r.symbol=a.id),void 0!==t&&(r.start_t=t);const n=await this.v1PrivateGetFundingFeeHistory(this.extend(r,s)),o=this.safeValue(n,"rows",[]);return this.parseIncomes(o,a,t,i)}parseFundingRate(e,t){const i=this.safeString(e,"symbol");t=this.market(i);const s=this.safeInteger(e,"next_funding_time"),r=this.safeInteger(e,"est_funding_rate_timestamp"),a=this.safeInteger(e,"last_funding_rate_timestamp");return{info:e,symbol:t.symbol,markPrice:void 0,indexPrice:void 0,interestRate:this.parseNumber("0"),estimatedSettlePrice:void 0,timestamp:r,datetime:this.iso8601(r),fundingRate:this.safeNumber(e,"est_funding_rate"),fundingTimestamp:s,fundingDatetime:this.iso8601(s),nextFundingRate:void 0,nextFundingTimestamp:void 0,nextFundingDatetime:void 0,previousFundingRate:this.safeNumber(e,"last_funding_rate"),previousFundingTimestamp:a,previousFundingDatetime:this.iso8601(a)}}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.v1PublicGetFundingRateSymbol(this.extend(s,t));return this.parseFundingRate(r,i)}async fetchFundingRates(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.v1PublicGetFundingRates(t),s=this.safeValue(i,"rows",{}),r=this.parseFundingRates(s);return this.filterByArray(r,"symbol",e)}async fetchFundingRateHistory(e,t,i,s={}){await this.loadMarkets();const r={};if(void 0!==e){const t=this.market(e);e=t.symbol,r.symbol=t.id}void 0!==t&&(r.start_t=parseInt(t/1e3));const a=await this.v1PublicGetFundingRateHistory(this.extend(r,s)),n=this.safeValue(a,"rows"),o=[];for(let e=0;e<n.length;e++){const t=n[e],i=this.safeString(t,"symbol"),s=this.safeInteger(t,"funding_rate_timestamp");o.push({info:t,symbol:this.safeSymbol(i),fundingRate:this.safeNumber(t,"funding_rate"),timestamp:s,datetime:this.iso8601(s)})}const h=this.sortBy(o,"timestamp");return this.filterBySymbolSinceLimit(h,e,t,i)}async fetchLeverage(e,t={}){await this.loadMarkets();const i=await this.v1PrivateGetClientInfo(t),s=this.safeValue(i,"application");return{info:i,leverage:this.safeNumber(s,"leverage")}}async setLeverage(e,t,i={}){if(await this.loadMarkets(),e<1||e>20)throw new o(this.id+" leverage should be between 1 and 20");const s={leverage:e};return await this.v1PrivatePostClientLeverage(this.extend(s,i))}async fetchPosition(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.v1PrivateGetPositionSymbol(this.extend(s,t));return this.parsePosition(r,i)}async fetchPositions(e,t={}){await this.loadMarkets();const i=await this.v1PrivateGetPositions(t),s=this.safeValue(i,"positions",[]);return this.parsePositions(s,e)}parsePosition(e,t){const i=this.safeString(e,"symbol");t=this.safeMarket(i,t);let s,r=this.safeString(e,"holding");s=l.stringGt(r,"0")?"long":"short";const a=this.safeString(t,"contractSize"),n=this.safeString(e,"mark_price"),o=this.safeTimestamp(e,"timestamp"),h=this.safeString(e,"average_open_price"),d=l.stringSub(n,h),c=l.stringMul(d,r);r=l.stringAbs(r);const u=l.stringMul(r,n);return{info:e,id:void 0,symbol:this.safeString(t,"symbol"),timestamp:o,datetime:this.iso8601(o),initialMargin:void 0,initialMarginPercentage:void 0,maintenanceMargin:void 0,maintenanceMarginPercentage:void 0,entryPrice:this.parseNumber(h),notional:this.parseNumber(u),leverage:void 0,unrealizedPnl:this.parseNumber(c),contracts:this.parseNumber(r),contractSize:this.parseNumber(a),marginRatio:void 0,liquidationPrice:this.safeNumber(e,"est_liq_price"),markPrice:this.parseNumber(n),collateral:void 0,marginMode:"cross",marginType:void 0,side:s,percentage:void 0}}defaultNetworkCodeForCurrency(e){const t=this.currency(e).networks,i=Object.keys(t);for(let e=0;e<i.length;e++){const t=i[e];if("ETH"===t)return t}return this.safeValue(i,0)}}},65927:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,ArgumentsRequired:a,ExchangeNotAvailable:n,InvalidNonce:o,InsufficientFunds:h,OrderNotFound:d,DDoSProtection:c,InvalidOrder:l,AuthenticationError:u,RateLimitExceeded:f}=i(73449),{TICK_SIZE:p}=i(62115),m=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"yobit",name:"YoBit",countries:["RU"],rateLimit:2e3,version:"3",has:{CORS:void 0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelOrder:!0,createDepositAddress:!0,createMarketOrder:!1,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!1,createStopMarketOrder:!1,createStopOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchDepositAddress:!0,fetchDeposits:!1,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrderBooks:!0,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!0,fetchTransactions:!1,fetchTransfer:!1,fetchTransfers:!1,fetchWithdrawals:!1,reduceMargin:!1,setLeverage:!1,setMarginMode:!1,setPositionMode:!1,transfer:!1,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/27766910-cdcbfdae-5eea-11e7-9859-03fea873272d.jpg",api:{public:"https://yobit.net/api",private:"https://yobit.net/tapi"},www:"https://www.yobit.net",doc:"https://www.yobit.net/en/api/",fees:"https://www.yobit.net/en/fees/"},api:{public:{get:{"depth/{pair}":1,info:1,"ticker/{pair}":1,"trades/{pair}":1}},private:{post:{ActiveOrders:1,CancelOrder:1,GetDepositAddress:1,getInfo:1,OrderInfo:1,Trade:1,TradeHistory:1,WithdrawCoinsToAddress:1}}},fees:{trading:{maker:.002,taker:.002},funding:{withdraw:{}}},commonCurrencies:{AIR:"AirCoin",ANI:"ANICoin",ANT:"AntsCoin",ATMCHA:"ATM",ASN:"Ascension",AST:"Astral",ATM:"Autumncoin",AUR:"AuroraCoin",BAB:"Babel",BAN:"BANcoin",BCC:"BCH",BCS:"BitcoinStake",BITS:"Bitstar",BLN:"Bulleon",BNS:"Benefit Bonus Coin",BOT:"BOTcoin",BON:"BONES",BPC:"BitcoinPremium",BST:"BitStone",BTS:"Bitshares2",CAT:"BitClave",CBC:"CryptoBossCoin",CMT:"CometCoin",COIN:"Coin.com",COV:"Coven Coin",COVX:"COV",CPC:"Capricoin",CREDIT:"Creditbit",CS:"CryptoSpots",DCT:"Discount",DFT:"DraftCoin",DGD:"DarkGoldCoin",DIRT:"DIRTY",DROP:"FaucetCoin",DSH:"DASH",EGC:"EverGreenCoin",EGG:"EggCoin",EKO:"EkoCoin",ENTER:"ENTRC",EPC:"ExperienceCoin",ESC:"EdwardSnowden",EUROPE:"EUROP",EXT:"LifeExtension",FUND:"FUNDChains",FUNK:"FUNKCoin",FX:"FCoin",GCC:"GlobalCryptocurrency",GEN:"Genstake",GENE:"Genesiscoin",GMR:"Gimmer",GOLD:"GoldMint",GOT:"Giotto Coin",GSX:"GlowShares",GT:"GTcoin",HTML5:"HTML",HYPERX:"HYPER",ICN:"iCoin",INSANE:"INSN",JNT:"JointCoin",JPC:"JupiterCoin",JWL:"Jewels",KNC:"KingN Coin",LBTCX:"LiteBitcoin",LIZI:"LiZi",LOC:"LocoCoin",LOCX:"LOC",LUNYR:"LUN",LUN:"LunarCoin",LUNA:"Luna Coin",MASK:"Yobit MASK",MDT:"Midnight",MEME:"Memez Token",MIS:"MIScoin",MM:"MasterMint",NAV:"NavajoCoin",NBT:"NiceBytes",OMG:"OMGame",ONX:"Onix",PAC:"$PAC",PLAY:"PlayCoin",PIVX:"Darknet",PRS:"PRE",PURE:"PurePOS",PUTIN:"PutinCoin",SPACE:"Spacecoin",STK:"StakeCoin",SUB:"Subscriptio",PAY:"EPAY",PLC:"Platin Coin",RAI:"RaiderCoin",RCN:"RCoin",REP:"Republicoin",RUR:"RUB",SBTC:"Super Bitcoin",SMC:"SmartCoin",SOLO:"SoloCoin",SOUL:"SoulCoin",STAR:"StarCoin",SUPER:"SuperCoin",TNS:"Transcodium",TTC:"TittieCoin",UNI:"Universe",UST:"Uservice",VOL:"VolumeCoin",XIN:"XINCoin",XMT:"SummitCoin",XRA:"Ratecoin"},options:{fetchOrdersRequiresSymbol:!0,fetchTickersMaxLength:512,networks:{ETH:"ERC20",TRX:"TRC20",BSC:"BEP20"}},precisionMode:p,exceptions:{exact:{803:l,804:l,805:l,806:l,807:l,831:h,832:h,833:d},broad:{"Invalid pair name":r,"invalid api key":u,"invalid sign":u,"api key dont have trade permission":u,"invalid parameter":l,"invalid order":l,"The given order has already been cancelled":l,"Requests too often":c,"not available":n,"data unavailable":n,"external service unavailable":n,"Total transaction amount":l,"The given order has already been closed and cannot be cancelled":l,"Insufficient funds":h,"invalid key":u,"invalid nonce":o,"Total order amount is less than minimal amount":l,"Rate Limited":f}},orders:{}})}parseBalance(e){const t=this.safeValue(e,"return",{}),i=this.safeInteger(t,"server_time"),s={info:e,timestamp:i,datetime:this.iso8601(i)},r=this.safeValue(t,"funds",{}),a=this.safeValue(t,"funds_incl_orders",{}),n=Object.keys(this.extend(r,a));for(let e=0;e<n.length;e++){const t=n[e],i=this.safeCurrencyCode(t),o=this.account();o.free=this.safeString(r,t),o.total=this.safeString(a,t),s[i]=o}return this.safeBalance(s)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostGetInfo(e);return this.parseBalance(t)}async fetchMarkets(e={}){const t=await this.publicGetInfo(e),i=this.safeValue(t,"pairs",{}),s=Object.keys(i),r=[];for(let e=0;e<s.length;e++){const t=s[e],a=i[t],[n,o]=t.split("_");let h=n.toUpperCase(),d=o.toUpperCase();h=this.safeCurrencyCode(h),d=this.safeCurrencyCode(d);const c=this.safeInteger(a,"hidden");let l=this.safeString(a,"fee");l=m.stringDiv(l,"100"),r.push({id:t,symbol:h+"/"+d,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:0===c,contract:!1,linear:void 0,inverse:void 0,taker:this.parseNumber(l),maker:this.parseNumber(l),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(a,"decimal_places"))),price:this.parseNumber(this.parsePrecision(this.safeString(a,"decimal_places")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(a,"min_amount"),max:this.safeNumber(a,"max_amount")},price:{min:this.safeNumber(a,"min_price"),max:this.safeNumber(a,"max_price")},cost:{min:this.safeNumber(a,"min_total"),max:void 0}},info:a})}return r}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),a={pair:s.id};void 0!==t&&(a.limit=t);const n=await this.publicGetDepthPair(this.extend(a,i));if(!(s.id in n))throw new r(this.id+" "+s.symbol+" order book is empty or not available");const o=n[s.id];return this.parseOrderBook(o,e)}async fetchOrderBooks(e,t,i={}){let s;if(await this.loadMarkets(),void 0===e){if(s=this.ids.join("-"),s.length>2048){const e=this.ids.length;throw new r(this.id+" fetchOrderBooks() has "+e.toString()+" symbols exceeding max URL length, you are required to specify a list of symbols in the first argument to fetchOrderBooks")}}else s=this.marketIds(e),s=s.join("-");const a={pair:s};void 0!==t&&(a.limit=t);const n=await this.publicGetDepthPair(this.extend(a,i)),o={};s=Object.keys(n);for(let e=0;e<s.length;e++){const t=s[e],i=this.safeSymbol(t);o[i]=this.parseOrderBook(n[t],i)}return o}parseTicker(e,t){const i=this.safeTimestamp(e,"updated"),s=this.safeString(e,"last");return this.safeTicker({symbol:this.safeSymbol(void 0,t),timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"buy"),bidVolume:void 0,ask:this.safeString(e,"sell"),askVolume:void 0,vwap:void 0,open:void 0,close:s,last:s,previousClose:void 0,change:void 0,percentage:void 0,average:this.safeString(e,"avg"),baseVolume:this.safeString(e,"vol_cur"),quoteVolume:this.safeString(e,"vol"),info:e},t)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);let i=this.ids;if(void 0===e){const e=i.length;i=i.join("-");const t=this.safeInteger(this.options,"fetchTickersMaxLength",2048);if(i.length>this.options.fetchTickersMaxLength)throw new a(this.id+" fetchTickers() has "+e.toString()+" markets exceeding max URL length for this endpoint ("+t.toString()+" characters), please, specify a list of symbols of interest in the first argument to fetchTickers")}else i=this.marketIds(e),i=i.join("-");const s={pair:i},r=await this.publicGetTickerPair(this.extend(s,t)),n={},o=Object.keys(r);for(let e=0;e<o.length;e++){const t=o[e],i=r[t],s=this.safeMarket(t);n[s.symbol]=this.parseTicker(i,s)}return this.filterByArray(n,"symbol",e)}async fetchTicker(e,t={}){return(await this.fetchTickers([e],t))[e]}parseTrade(e,t){const i=this.safeTimestamp(e,"timestamp");let s=this.safeString(e,"type");"ask"===s?s="sell":"bid"===s&&(s="buy");const r=this.safeString2(e,"rate","price"),a=this.safeString2(e,"trade_id","tid"),n=this.safeString(e,"order_id"),o=this.safeString(e,"pair"),h=this.safeSymbol(o,t),d=this.safeString(e,"amount"),c=this.parseNumber(r),l=this.parseNumber(d),u="limit";let f;const p=this.safeNumber(e,"commission");if(void 0!==p){const t=this.safeString(e,"commissionCurrency");f={cost:p,currency:this.safeCurrencyCode(t)}}if(void 0!==this.safeValue(e,"is_your_order")&&void 0===f){const e=this.calculateFee(h,u,s,l,c,"taker");f={currency:this.safeString(e,"currency"),cost:this.safeString(e,"cost"),rate:this.safeString(e,"rate")}}return this.safeTrade({id:a,order:n,timestamp:i,datetime:this.iso8601(i),symbol:h,type:u,side:s,takerOrMaker:void 0,price:r,amount:d,cost:void 0,fee:f,info:e},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pair:r.id};void 0!==i&&(a.limit=i);const n=await this.publicGetTradesPair(this.extend(a,s));if(Array.isArray(n)){if(0===n.length)return[]}const o=this.safeValue(n,r.id,[]);return this.parseTrades(o,r,t,i)}async fetchTradingFees(e={}){await this.loadMarkets();const t=await this.publicGetInfo(e),i=this.safeValue(t,"pairs",{}),s=Object.keys(i),r={};for(let e=0;e<s.length;e++){const t=s[e],a=this.safeValue(i,t,{}),n=this.safeSymbol(t,void 0,"_"),o=this.safeString(a,"fee_buyer"),h=this.safeString(a,"fee_seller"),d=this.parseNumber(m.stringDiv(o,"100")),c=this.parseNumber(m.stringDiv(h,"100"));r[n]={info:a,symbol:n,taker:d,maker:c,percentage:!0,tierBased:!1}}return r}async createOrder(e,t,i,s,a,n={}){if("market"===t)throw new r(this.id+" createOrder() allows limit orders only");await this.loadMarkets();const o=this.market(e),h={pair:o.id,type:i,amount:this.amountToPrecision(e,s),rate:this.priceToPrecision(e,a)},d=await this.privatePostTrade(this.extend(h,n)),c=this.safeValue(d,"return");return this.parseOrder(c,o)}async cancelOrder(e,t,i={}){await this.loadMarkets();const s={order_id:parseInt(e)},r=await this.privatePostCancelOrder(this.extend(s,i)),a=this.safeValue(r,"return",{});return this.parseOrder(a)}parseOrderStatus(e){return this.safeString({0:"open",1:"closed",2:"canceled",3:"open"},e,e)}parseOrder(e,t){let i=this.safeString2(e,"id","order_id"),s=this.parseOrderStatus(this.safeString(e,"status","open"));"0"===i&&(i=this.safeString(e,"init_order_id"),s="closed");const r=this.safeTimestamp2(e,"timestamp_created","server_time"),a=this.safeString(e,"pair"),n=this.safeSymbol(a,t),o=this.safeString(e,"start_amount"),h=this.safeString2(e,"amount","remains"),d=this.safeString(e,"received","0.0"),c=this.safeString(e,"rate"),l=this.safeString(e,"type");return this.safeOrder({info:e,id:i,clientOrderId:void 0,symbol:n,timestamp:r,datetime:this.iso8601(r),lastTradeTimestamp:void 0,type:"limit",timeInForce:void 0,postOnly:void 0,side:l,price:c,stopPrice:void 0,triggerPrice:void 0,cost:void 0,amount:o,remaining:h,filled:d,status:s,fee:undefined,average:void 0,trades:void 0},t)}async fetchOrder(e,t,i={}){await this.loadMarkets();const s={order_id:parseInt(e)},r=await this.privatePostOrderInfo(this.extend(s,i));e=e.toString();const a=this.safeValue(r,"return",{});return this.parseOrder(this.extend({id:e},a[e]))}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const r={};if(void 0!==e){const t=this.market(e);r.pair=t.id}const n=await this.privatePostActiveOrders(this.extend(r,s)),o=this.safeValue(n,"return",{});return this.parseOrders(o,undefined,t,i)}async fetchMyTrades(e,t,i,s={}){if(void 0===e)throw new a(this.id+" fetchMyTrades() requires a `symbol` argument");await this.loadMarkets();const r=this.market(e),n={pair:r.id};void 0!==i&&(n.count=parseInt(i)),void 0!==t&&(n.since=parseInt(t/1e3));const o=await this.privatePostTradeHistory(this.extend(n,s)),h=this.safeValue(o,"return",{}),d=Object.keys(h),c=[];for(let e=0;e<d.length;e++){const t=d[e],i=this.parseTrade(this.extend(h[t],{trade_id:t}),r);c.push(i)}return this.filterBySymbolSinceLimit(c,r.symbol,t,i)}async createDepositAddress(e,t={}){const i=await this.fetchDepositAddress(e,this.extend({need_new:1},t)),s=this.safeString(i,"address");return this.checkAddress(s),{currency:e,address:s,tag:void 0,info:i.info}}async fetchDepositAddress(e,t={}){await this.loadMarkets();let i=this.currency(e).id;const s=this.safeValue(this.options,"networks",{});let r=this.safeStringUpper(t,"network");r=this.safeString(s,r,r),void 0!==r&&("ERC20"!==r&&(i+=r.toLowerCase()),t=this.omit(t,"network"));const a={coinName:i,need_new:0},n=await this.privatePostGetDepositAddress(this.extend(a,t)),o=this.safeString(n.return,"address");return this.checkAddress(o),{currency:e,address:o,tag:void 0,network:void 0,info:n}}async withdraw(e,t,i,s,a={}){[s,a]=this.handleWithdrawTagAndParams(s,a),this.checkAddress(i),await this.loadMarkets();const n={coinName:this.currency(e).id,amount:t,address:i};if(void 0!==s)throw new r(this.id+" withdraw() does not support the tag argument yet due to a lack of docs on withdrawing with tag/memo on behalf of the exchange.");return{info:await this.privatePostWithdrawCoinsToAddress(this.extend(n,a)),id:void 0}}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api[t];const o=this.omit(s,this.extractParams(e));if("private"===t){this.checkRequiredCredentials();const t=this.nonce();a=this.urlencode(this.extend({nonce:t,method:e},o));const i=this.hmac(this.encode(a),this.encode(this.secret),"sha512");r={"Content-Type":"application/x-www-form-urlencoded",Key:this.apiKey,Sign:i}}else"public"===t?(n+="/"+this.version+"/"+this.implodeParams(e,s),Object.keys(o).length&&(n+="?"+this.urlencode(o))):(n+="/"+this.implodeParams(e,s),"GET"===i?Object.keys(o).length&&(n+="?"+this.urlencode(o)):Object.keys(o).length&&(a=this.json(o),r={"Content-Type":"application/json"}));return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0!==o&&"success"in o){let e=this.safeValue(o,"success",!1);if("string"==typeof e&&(e="true"===e||"1"===e),!e){const e=this.safeString(o,"code"),t=this.safeString(o,"error"),i=this.id+" "+n;throw this.throwExactlyMatchedException(this.exceptions.exact,e,i),this.throwExactlyMatchedException(this.exceptions.exact,t,i),this.throwBroadlyMatchedException(this.exceptions.broad,t,i),new r(i)}}}}},34422:function(e,t,i){"use strict";const s=i(48819),{ExchangeError:r,BadRequest:a}=i(73449),{TICK_SIZE:n}=i(62115),o=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"zaif",name:"Zaif",countries:["JP"],rateLimit:100,version:"1",has:{CORS:void 0,spot:!0,margin:void 0,swap:!1,future:!1,option:!1,cancelOrder:!0,createMarketOrder:!1,createOrder:!0,fetchBalance:!0,fetchClosedOrders:!0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchOpenInterestHistory:!1,fetchOpenOrders:!0,fetchOrderBook:!0,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,withdraw:!0},urls:{logo:"https://user-images.githubusercontent.com/1294454/27766927-39ca2ada-5eeb-11e7-972f-1b4199518ca6.jpg",api:{rest:"https://api.zaif.jp"},www:"https://zaif.jp",doc:["https://techbureau-api-document.readthedocs.io/ja/latest/index.html","https://corp.zaif.jp/api-docs","https://corp.zaif.jp/api-docs/api_links","https://www.npmjs.com/package/zaif.jp","https://github.com/you21979/node-zaif"],fees:"https://zaif.jp/fee?lang=en"},fees:{trading:{percentage:!0,taker:this.parseNumber("0.001"),maker:this.parseNumber("0")}},api:{public:{get:{"depth/{pair}":1,"currencies/{pair}":1,"currencies/all":1,"currency_pairs/{pair}":1,"currency_pairs/all":1,"last_price/{pair}":1,"ticker/{pair}":1,"trades/{pair}":1}},private:{post:{active_orders:5,cancel_order:5,deposit_history:5,get_id_info:5,get_info:10,get_info2:5,get_personal_info:5,trade:5,trade_history:50,withdraw:5,withdraw_history:5}},ecapi:{post:{createInvoice:1,getInvoice:1,getInvoiceIdsByOrderNumber:1,cancelInvoice:1}},tlapi:{post:{get_positions:66,position_history:66,active_positions:5,create_position:33,change_position:33,cancel_position:33}},fapi:{get:{"groups/{group_id}":1,"last_price/{group_id}/{pair}":1,"ticker/{group_id}/{pair}":1,"trades/{group_id}/{pair}":1,"depth/{group_id}/{pair}":1}}},options:{fees:{"BTC/JPY":{maker:this.parseNumber("0"),taker:this.parseNumber("0.001")},"BCH/JPY":{maker:this.parseNumber("0"),taker:this.parseNumber("0.003")},"BCH/BTC":{maker:this.parseNumber("0"),taker:this.parseNumber("0.003")},"PEPECASH/JPY":{maker:this.parseNumber("0"),taker:this.parseNumber("0.0001")},"PEPECASH/BT":{maker:this.parseNumber("0"),taker:this.parseNumber("0.0001")}}},precisionMode:n,exceptions:{exact:{"unsupported currency_pair":a},broad:{}}})}async fetchMarkets(e={}){const t=await this.publicGetCurrencyPairsAll(e),i=[];for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"currency_pair"),a=this.safeString(s,"name"),[n,o]=a.split("/"),h=this.safeCurrencyCode(n),d=this.safeCurrencyCode(o),c=h+"/"+d,l=this.safeValue(this.options.fees,c,this.fees.trading);i.push({id:r,symbol:c,base:h,quote:d,settle:void 0,baseId:n,quoteId:o,settleId:void 0,type:"spot",spot:!0,margin:void 0,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,taker:l.taker,maker:l.maker,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.safeNumber(s,"item_unit_step"),price:this.parseNumber(this.parsePrecision(this.safeString(s,"aux_unit_point")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(s,"item_unit_min"),max:void 0},price:{min:this.safeNumber(s,"aux_unit_min"),max:void 0},cost:{min:void 0,max:void 0}},info:s})}return i}parseBalance(e){const t=this.safeValue(e,"return",{}),i=this.safeValue(t,"deposit"),s={info:e,timestamp:void 0,datetime:void 0},r=this.safeValue(t,"funds",{}),a=Object.keys(r);for(let e=0;e<a.length;e++){const t=a[e],n=this.safeCurrencyCode(t),o=this.safeString(r,t),h=this.account();h.free=o,h.total=o,void 0!==i&&t in i&&(h.total=this.safeString(i,t)),s[n]=h}return this.safeBalance(s)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.privatePostGetInfo(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={pair:s.id},a=await this.publicGetDepthPair(this.extend(r,i));return this.parseOrderBook(a,s.symbol)}parseTicker(e,t){const i=this.safeSymbol(void 0,t),s=this.milliseconds(),r=this.safeString(e,"vwap"),a=this.safeString(e,"volume"),n=o.stringMul(a,r),h=this.safeString(e,"last");return this.safeTicker({symbol:i,timestamp:s,datetime:this.iso8601(s),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"bid"),bidVolume:void 0,ask:this.safeString(e,"ask"),askVolume:void 0,vwap:r,open:void 0,close:h,last:h,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:a,quoteVolume:n,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={pair:i.id},r=await this.publicGetTickerPair(this.extend(s,t));return this.parseTicker(r,i)}parseTrade(e,t){let i=this.safeString(e,"trade_type");i="bid"===i?"buy":"sell";const s=this.safeTimestamp(e,"date"),r=this.safeString2(e,"id","tid"),a=this.safeString(e,"price"),n=this.safeString(e,"amount"),o=this.safeString(e,"currency_pair"),h=this.safeSymbol(o,t,"_");return this.safeTrade({id:r,info:e,timestamp:s,datetime:this.iso8601(s),symbol:h,type:void 0,side:i,order:void 0,takerOrMaker:void 0,price:a,amount:n,cost:void 0,fee:void 0},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={pair:r.id};let n=await this.publicGetTradesPair(this.extend(a,s));if(1===n.length){const e=n[0];Object.keys(e).length||(n=[])}return this.parseTrades(n,r,t,i)}async createOrder(e,t,i,s,a,n={}){if(await this.loadMarkets(),"limit"!==t)throw new r(this.id+" createOrder() allows limit orders only");const o={currency_pair:this.market(e).id,action:"buy"===i?"bid":"ask",amount:s,price:a},h=await this.privatePostTrade(this.extend(o,n));return{info:h,id:h.return.order_id.toString()}}async cancelOrder(e,t,i={}){const s={order_id:e};return await this.privatePostCancelOrder(this.extend(s,i))}parseOrder(e,t){let i=this.safeString(e,"action");i="bid"===i?"buy":"sell";const s=this.safeTimestamp(e,"timestamp"),r=this.safeString(e,"currency_pair"),a=this.safeSymbol(r,t,"_"),n=this.safeString(e,"price"),o=this.safeString(e,"amount"),h=this.safeString(e,"id");return this.safeOrder({id:h,clientOrderId:void 0,timestamp:s,datetime:this.iso8601(s),lastTradeTimestamp:void 0,status:"open",symbol:a,type:"limit",timeInForce:void 0,postOnly:void 0,side:i,price:n,stopPrice:void 0,triggerPrice:void 0,cost:void 0,amount:o,filled:void 0,remaining:void 0,trades:void 0,fee:void 0,info:e,average:void 0},t)}async fetchOpenOrders(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.currency_pair=r.id);const n=await this.privatePostActiveOrders(this.extend(a,s));return this.parseOrders(n.return,r,t,i)}async fetchClosedOrders(e,t,i,s={}){let r;await this.loadMarkets();const a={};void 0!==e&&(r=this.market(e),a.currency_pair=r.id);const n=await this.privatePostTradeHistory(this.extend(a,s));return this.parseOrders(n.return,r,t,i)}async withdraw(e,t,i,s,a={}){[s,a]=this.handleWithdrawTagAndParams(s,a),this.checkAddress(i),await this.loadMarkets();const n=this.currency(e);if("JPY"===e)throw new r(this.id+" withdraw() does not allow "+e+" withdrawals");const o={currency:n.id,amount:t,address:i};void 0!==s&&(o.message=s);const h=await this.privatePostWithdraw(this.extend(o,a)),d=this.safeValue(h,"return");return this.parseTransaction(d,n)}parseTransaction(e,t){let i;t=this.safeCurrency(void 0,t);const s=this.safeValue(e,"fee");return void 0!==s&&(i={cost:s,currency:t.code}),{id:this.safeString(e,"id"),txid:this.safeString(e,"txid"),timestamp:void 0,datetime:void 0,network:void 0,addressFrom:void 0,address:void 0,addressTo:void 0,amount:void 0,type:void 0,currency:t.code,status:void 0,updated:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,comment:void 0,fee:i,info:e}}nonce(){return parseFloat(this.milliseconds()/1e3).toFixed(8)}sign(e,t="public",i="GET",s={},r,a){let n=this.urls.api.rest+"/";if("public"===t)n+="api/"+this.version+"/"+this.implodeParams(e,s);else if("fapi"===t)n+="fapi/"+this.version+"/"+this.implodeParams(e,s);else{this.checkRequiredCredentials(),n+="ecapi"===t?"ecapi":"tlapi"===t?"tlapi":"tapi";const i=this.nonce();a=this.urlencode(this.extend({method:e,nonce:i},s)),r={"Content-Type":"application/x-www-form-urlencoded",Key:this.apiKey,Sign:this.hmac(this.encode(a),this.encode(this.secret),"sha512")}}return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,a,n,o,h,d){if(void 0===o)return;const c=this.id+" "+n,l=this.safeString(o,"error");if(void 0!==l)throw this.throwExactlyMatchedException(this.exceptions.exact,l,c),this.throwBroadlyMatchedException(this.exceptions.broad,l,c),new r(c);if(!this.safeValue(o,"success",!0))throw new r(c)}}},90927:function(e,t,i){"use strict";const s=i(48819),{BadRequest:r,BadSymbol:a,ExchangeError:n,ArgumentsRequired:o,AuthenticationError:h,InsufficientFunds:d,NotSupported:c,OrderNotFound:l,ExchangeNotAvailable:u,RateLimitExceeded:f,PermissionDenied:p,InvalidOrder:m,InvalidAddress:g,OnMaintenance:y,RequestTimeout:b,AccountSuspended:v,NetworkError:w,DDoSProtection:S,DuplicateOrderId:k,BadResponse:T}=i(73449),{TICK_SIZE:_}=i(62115),O=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"zb",name:"ZB",countries:["CN"],rateLimit:6,version:"v1",pro:!0,has:{CORS:void 0,spot:!0,margin:!0,swap:!0,future:void 0,option:void 0,addMargin:!0,borrowMargin:!0,cancelAllOrders:!0,cancelOrder:!0,createMarketOrder:!1,createOrder:!0,createReduceOnlyOrder:!1,createStopLimitOrder:!0,createStopMarketOrder:!0,createStopOrder:!0,fetchBalance:!0,fetchBorrowRate:!0,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!0,fetchCanceledOrders:!0,fetchClosedOrders:!0,fetchCurrencies:!0,fetchDepositAddress:!0,fetchDepositAddresses:!0,fetchDeposits:!0,fetchFundingHistory:!1,fetchFundingRate:!0,fetchFundingRateHistory:!0,fetchFundingRates:!0,fetchIndexOHLCV:!0,fetchLedger:!0,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarketLeverageTiers:!1,fetchMarkets:!0,fetchMarkOHLCV:!0,fetchOHLCV:!0,fetchOpenOrders:!0,fetchOrder:!0,fetchOrderBook:!0,fetchOrders:!0,fetchPosition:!0,fetchPositions:!0,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchWithdrawals:!0,reduceMargin:!0,setLeverage:!0,setMarginMode:!1,setPositionMode:!1,transfer:!0,withdraw:!0},timeframes:{"1m":"1m","3m":"3m","5m":"5m","15m":"15m","30m":"30m","1h":"1h","2h":"2h","4h":"4h","6h":"6h","12h":"12h","1d":"1d","3d":"3d","5d":"5d","1w":"1w"},hostname:"zb.com",urls:{logo:"https://user-images.githubusercontent.com/1294454/32859187-cd5214f0-ca5e-11e7-967d-96568e2e2bd1.jpg",api:{spot:{v1:{public:"https://api.{hostname}/data",private:"https://trade.{hostname}/api"}},contract:{v1:{public:"https://fapi.{hostname}/api/public"},v2:{public:"https://fapi.{hostname}/Server/api",private:"https://fapi.{hostname}/Server/api"}}},www:"https://www.zb.com",doc:"https://www.zb.com/i/developer",fees:"https://www.zb.com/i/rate",referral:{url:"https://www.zb.com/en/register?ref=4301lera",discount:.16}},api:{spot:{v1:{public:{get:{markets:16.667,ticker:16.667,allTicker:16.667,depth:16.667,trades:16.667,kline:166.667,getGroupMarkets:16.667,getFeeInfo:16.667}},private:{get:{order:1,orderMoreV2:1,cancelOrder:1,cancelAllOrdersAfter:1,getOrder:1,getOrders:1,getOrdersNew:16.667,getOrdersIgnoreTradeType:1,getUnfinishedOrdersIgnoreTradeType:1,getFinishedAndPartialOrders:1,getAccountInfo:16.667,getUserAddress:16.667,getPayinAddress:16.667,getWithdrawAddress:16.667,getWithdrawRecord:16.667,getChargeRecord:16.667,getCnyWithdrawRecord:16.667,getCnyChargeRecord:16.667,withdraw:16.667,addSubUser:16.667,getSubUserList:16.667,doTransferFunds:16.667,createSubUserKey:16.667,getLeverAssetsInfo:16.667,getLeverBills:16.667,transferInLever:16.667,transferOutLever:16.667,loan:16.667,cancelLoan:16.667,getLoans:16.667,getLoanRecords:16.667,borrow:16.667,autoBorrow:16.667,repay:16.667,doAllRepay:16.667,getRepayments:16.667,getFinanceRecords:16.667,changeInvestMark:16.667,changeLoop:16.667,getCrossAssets:16.667,getCrossBills:16.667,transferInCross:16.667,transferOutCross:16.667,doCrossLoan:16.667,doCrossRepay:16.667,getCrossRepayRecords:16.667}}}},contract:{v1:{public:{get:{depth:16.667,fundingRate:16.667,indexKline:16.667,indexPrice:16.667,kline:16.667,markKline:16.667,markPrice:16.667,ticker:16.667,trade:16.667}}},v2:{public:{get:{allForceOrders:3.334,"config/marketList":3.334,topLongShortAccountRatio:3.334,topLongShortPositionRatio:3.334,fundingRate:3.334,premiumIndex:3.334}},private:{get:{"Fund/balance":3.334,"Fund/getAccount":3.334,"Fund/getBill":3.334,"Fund/getBillTypeList":3.334,"Fund/marginHistory":3.334,"Positions/getPositions":3.334,"Positions/getNominalValue":3.334,"Positions/marginInfo":3.334,"setting/get":3.334,"trade/getAllOrders":3.334,"trade/getOrder":3.334,"trade/getOrderAlgos":3.334,"trade/getTradeList":3.334,"trade/getUndoneOrders":3.334,"trade/tradeHistory":3.334},post:{"activity/buyTicket":3.334,"Fund/transferFund":3.334,"Positions/setMarginCoins":3.334,"Positions/updateAppendUSDValue":3.334,"Positions/updateMargin":3.334,"setting/setLeverage":3.334,"setting/setPositionsMode":3.334,"trade/batchOrder":3.334,"trade/batchCancelOrder":3.334,"trade/cancelAlgos":3.334,"trade/cancelAllOrders":3.334,"trade/cancelOrder":3.334,"trade/order":3.334,"trade/orderAlgo":3.334,"trade/updateOrderAlgo":3.334}}}}},fees:{funding:{withdraw:{}},trading:{maker:this.parseNumber("0.002"),taker:this.parseNumber("0.002")}},commonCurrencies:{ANG:"Anagram",ENT:"ENTCash",BCHABC:"BCHABC",BCHSV:"BCHSV"},options:{timeframes:{spot:{"1m":"1min","3m":"3min","5m":"5min","15m":"15min","30m":"30min","1h":"1hour","2h":"2hour","4h":"4hour","6h":"6hour","12h":"12hour","1d":"1day","3d":"3day","1w":"1week"},swap:{"1m":"1M","5m":"5M","15m":"15M","30m":"30M","1h":"1H","6h":"6H","1d":"1D","5d":"5D"}}},precisionMode:_,exceptions:{ws:{1001:n,1002:n,1003:h,1004:h,1005:h,1006:p,1007:n,1009:y,1010:u,1012:p,1013:n,1014:n,2001:d,2002:d,2003:d,2005:d,2006:d,2007:d,2008:d,2009:d,3001:l,3002:m,3003:m,3004:h,3005:r,3006:p,3007:b,3008:n,3009:m,3010:p,3011:m,3012:m,4001:v,4002:f},exact:{10001:n,10002:p,10003:T,10004:T,10005:p,10006:r,10007:n,10008:n,10009:n,1001:n,10010:h,10011:h,10012:v,10013:h,10014:h,10015:h,10016:h,10017:p,10018:v,10019:b,1002:n,10020:r,10021:r,10022:r,10023:f,10024:h,10025:n,10026:w,10027:b,10028:u,10029:S,1003:h,10030:r,10031:r,10032:r,10033:r,10034:r,10035:r,10036:r,10037:o,10038:r,10039:T,1004:h,10040:T,10041:T,10042:n,10043:n,10044:n,10045:n,10046:n,10047:n,10048:n,10049:w,1005:h,1006:h,1009:u,1010:u,10100:y,1012:p,1013:n,1014:n,11e3:n,11001:n,110011:n,11002:n,11003:n,11004:d,11005:m,11006:d,11007:l,11008:n,11009:n,110110:n,11012:d,11013:n,11014:n,11015:h,11016:h,11017:n,11018:d,11019:n,11021:d,11023:n,11030:p,11031:n,11032:n,11033:o,11034:n,12e3:m,12001:m,12002:m,12003:m,12004:m,12005:m,12006:m,12007:m,12008:m,12009:m,12010:m,12011:m,12012:l,12013:m,12014:m,12015:m,12016:m,12017:m,12018:m,12019:o,12020:n,12021:m,12022:m,12023:l,12024:m,12025:m,12026:k,12027:u,12028:m,12029:m,12201:m,12202:m,12203:m,12204:m,12205:m,12206:m,12207:f,13001:h,13002:p,13003:m,13004:m,13005:f,13006:n,13007:n,13008:n,13009:n,14e3:n,14001:h,14002:h,14003:n,14100:n,14101:f,14200:o,14300:n,14301:n,14302:n,14303:n,14305:n,14306:n,14307:m,14308:m,14309:n,14310:c,14311:c,14312:n,14313:p,14314:n,2001:d,2002:d,2003:d,2005:d,2006:d,2007:d,2008:d,2009:d,3001:l,3002:m,3003:m,3004:h,3005:r,3006:h,3007:h,3008:l,3009:m,3010:p,3011:m,3012:m,4001:u,4002:f,9999:n},broad:{"提币地址有误, 请先添加提币地址。":g,"资金不足,无法划账":d,"响应超时":b}}})}async fetchMarkets(e={}){let t=[this.spotV1PublicGetMarkets(e),this.contractV2PublicGetConfigMarketList(e)];t=await Promise.all(t);const i=t[0],s=t[1],r=this.safeValue(s,"data",[]),a=this.indexBy(r,"marketName"),n=this.deepExtend(a,i),o=Object.keys(n),h=[];for(let e=0;e<o.length;e++){const t=o[e],i=n[t],[s,r]=t.split("_"),a=this.safeCurrencyCode(s),d=this.safeCurrencyCode(r),c=this.safeValue(i,"marginCurrencyName"),l=this.safeCurrencyCode(c),u=void 0===l,f=this.safeValue(i,"futures",!1),p=!!f||void 0;let m=!0,g=a+"/"+d;if(f){m="1"===this.safeString(i,"status"),g=a+"/"+d+":"+l}h.push({id:t,symbol:g,base:a,quote:d,settle:l,baseId:s,quoteId:r,settleId:c,type:f?"swap":"spot",spot:u,margin:!1,swap:f,future:!1,option:!1,active:m,contract:f,linear:p,inverse:f?!p:void 0,contractSize:void 0,expiry:void 0,expiryDatetime:void 0,strike:void 0,optionType:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString2(i,"amountScale","amountDecimal"))),price:this.parseNumber(this.parsePrecision(this.safeString2(i,"priceScale","priceDecimal")))},limits:{leverage:{min:void 0,max:this.safeNumber(i,"maxLeverage")},amount:{min:this.safeNumber(i,"minAmount"),max:this.safeNumber(i,"maxAmount")},price:{min:void 0,max:void 0},cost:{min:this.safeNumber2(i,"minSize","minTradeMoney"),max:this.safeNumber(i,"maxTradeMoney")}},info:i})}return h}async fetchCurrencies(e={}){const t=await this.spotV1PublicGetGetFeeInfo(e),i=this.safeValue(t,"result",{}),s=Object.keys(i),r={};for(let e=0;e<s.length;e++){const t=s[e],a=i[t],n=this.safeCurrencyCode(t);let o=!0,h=!0;const d={};for(let e=0;e<a.length;e++){const t=a[e],i=this.safeString(t,"chainName"),s=this.safeNumber(t,"fee"),r=this.safeValue(t,"canDeposit"),n=this.safeValue(t,"canWithdraw");h=h||r,o=o||n,d[i]=s}const c=o&&h;r[n]={id:t,name:void 0,code:n,precision:void 0,info:a,active:c,deposit:h,withdraw:o,fee:void 0,fees:d,limits:this.limits}}return r}parseBalance(e){const t=this.safeValue(e.result,"coins"),i={info:e};for(let e=0;e<t.length;e++){const s=t[e],r=this.account(),a=this.safeString(s,"key"),n=this.safeCurrencyCode(a);r.free=this.safeString(s,"available"),r.used=this.safeString(s,"freez"),i[n]=r}return this.safeBalance(i)}parseSwapBalance(e){const t={info:e},i=this.safeValue(e,"data",{});for(let e=0;e<i.length;e++){const s=i[e],r=this.safeCurrencyCode(this.safeString(s,"currencyName")),a=this.account();a.total=this.safeString(s,"accountBalance"),a.free=this.safeString(s,"allowTransferOutAmount"),a.used=this.safeString(s,"freezeAmount"),t[r]=a}return this.safeBalance(t)}parseMarginBalance(e,t){const i={info:e};let s;if("isolated"===t){const t=this.safeValue(e,"message",{}),i=this.safeValue(t,"datas",{});s=this.safeValue(i,"levers",[])}else{const t=this.safeValue(e,"result",{});s=this.safeValue(t,"list",[])}for(let e=0;e<s.length;e++){const r=s[e],a=this.account();if("isolated"===t){const e=this.safeCurrencyCode(this.safeString(r,"fShowName"));a.total=this.safeString(r,"fAvailableUSD"),a.free=this.safeString(r,"couldTransferOutFiat"),a.used=this.safeString(r,"fFreeze"),i[e]=a}else{const e=this.safeCurrencyCode(this.safeString(r,"key"));a.total=this.safeString(r,"amount"),a.free=this.safeString(r,"canTransferOut"),a.used=this.safeString(r,"freeze"),i[e]=a}}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const[t,i]=this.handleMarketTypeAndParams("fetchBalance",void 0,e),[s,r]=this.handleMarginModeAndParams("fetchBalance",i),a="swap"===t,n="cross"===s?"spotV1PrivateGetGetCrossAssets":"spotV1PrivateGetGetLeverAssetsInfo";let o=this.getSupportedMapping(t,{spot:"spotV1PrivateGetGetAccountInfo",swap:"contractV2PrivateGetFundBalance",margin:n});"isolated"===s?o="spotV1PrivateGetGetLeverAssetsInfo":"cross"===s&&(o="spotV1PrivateGetGetCrossAssets");const h={};a&&(h.futuresAccountType=1);const d=await this[o](this.extend(h,r));return a?this.parseSwapBalance(d):void 0!==s?this.parseMarginBalance(d,s):this.parseBalance(d)}parseDepositAddress(e,t){let i,s=this.safeString2(e,"key","address");const r=this.safeString(e,"memo");if(void 0!==r)i=r;else if(s.indexOf("_")>=0){const e=s.split("_");s=e[0],i=e[1]}this.checkAddress(s);const a=this.safeString(e,"blockChain");return{currency:this.safeCurrencyCode(a,t),address:s,tag:i,network:void 0,info:e}}async fetchDepositAddresses(e,t={}){await this.loadMarkets();const i=await this.spotV1PrivateGetGetPayinAddress(t),s=this.safeValue(i,"message",{}),r=this.safeValue(s,"datas",[]);return this.parseDepositAddresses(r,e)}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},r=await this.spotV1PrivateGetGetUserAddress(this.extend(s,t)),a=this.safeValue(r,"message",{}),n=this.safeValue(a,"datas",{});return this.parseDepositAddress(n,i)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={};r[s.swap?"symbol":"market"]=s.id;const a=this.getSupportedMapping(s.type,{spot:"spotV1PublicGetDepth",swap:"contractV1PublicGetDepth"});void 0!==t&&(r.size=t);const n=await this[a](this.extend(r,i));let o,h;return"swap"===s.type?(o=this.safeValue(n,"data"),h=this.safeInteger(o,"time")):(o=n,h=this.safeTimestamp(n,"timestamp")),this.parseOrderBook(o,e,h)}async fetchTickers(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.spotV1PublicGetAllTicker(t),s={},r={},a=this.ids;for(let e=0;e<a.length;e++){const t=a[e];r[t.replace("_","")]=t}const n=Object.keys(i);for(let e=0;e<n.length;e++){const t=this.safeValue(r,n[e]),a=this.safeMarket(t,void 0,"_");if(void 0!==a){const t=a.symbol,r=this.safeValue(i,n[e]);void 0!==r&&(s[t]=this.parseTicker(r,a))}}return this.filterByArray(s,"symbol",e)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={};s[i.swap?"symbol":"market"]=i.id;const r=this.getSupportedMapping(i.type,{spot:"spotV1PublicGetTicker",swap:"contractV1PublicGetTicker"}),a=await this[r](this.extend(s,t));let n;if("swap"===i.type){n={};const e=this.safeValue(a,"data"),t=this.safeValue(e,i.id,[]);for(let e=0;e<t.length;e++)n.open=this.safeValue(t,0),n.high=this.safeValue(t,1),n.low=this.safeValue(t,2),n.last=this.safeValue(t,3),n.vol=this.safeValue(t,4),n.riseRate=this.safeValue(t,5)}else n=this.safeValue(a,"ticker",{}),n.date=this.safeValue(a,"date");return this.parseTicker(n,i)}parseTicker(e,t){const i=this.safeInteger(e,"date",this.milliseconds()),s=this.safeString(e,"last");return this.safeTicker({symbol:this.safeSymbol(void 0,t),timestamp:i,datetime:this.iso8601(i),high:this.safeString(e,"high"),low:this.safeString(e,"low"),bid:this.safeString(e,"buy"),bidVolume:void 0,ask:this.safeString(e,"sell"),askVolume:void 0,vwap:void 0,open:this.safeString(e,"open"),close:s,last:s,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:this.safeString(e,"vol"),quoteVolume:void 0,info:e},t)}parseOHLCV(e,t){if(t.swap){return e.length>5?[this.safeTimestamp(e,5),this.safeNumber(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4)]:[this.safeTimestamp(e,4),this.safeNumber(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),void 0]}return[this.safeInteger(e,0),this.safeNumber(e,1),this.safeNumber(e,2),this.safeNumber(e,3),this.safeNumber(e,4),this.safeNumber(e,5)]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n=a.swap,o=a.spot,h=this.safeValue(this.options,"timeframes",{}),d=this.safeValue(h,a.type,{}),l=this.safeString(d,t);if(void 0===l)throw new c(this.id+" fetchOHLCV() does not support "+t+" timeframe for "+a.type+" markets");void 0===s&&(s=1e3);const u={size:s};u[n?"symbol":"market"]=a.id;u[n?"period":"type"]=l;const f=this.safeString(r,"price");r=this.omit(r,"price");let p=this.getSupportedMapping(a.type,{spot:"spotV1PublicGetKline",swap:"contractV1PublicGetKline"});n?"mark"===f?p="contractV1PublicGetMarkKline":"index"===f&&(p="contractV1PublicGetIndexKline"):o&&void 0!==i&&(u.since=i);const m=await this[p](this.extend(u,r)),g=this.safeValue(m,"data",[]);return this.parseOHLCVs(g,a,t,i,s)}parseTrade(e,t){const i=t.swap?"side":"trade_type";let s,r=this.safeString(e,i);const a=this.safeValue(e,"maker");let n;void 0!==a&&(s=a?"maker":"taker"),t.spot?r="bid"===r?"buy":"sell":"3"===r?r="sell":"4"===r||"1"===r?r="buy":"2"===r&&(r="sell"),n=t.swap?this.safeInteger(e,"createTime"):this.safeTimestamp(e,"date");const o=this.safeString(e,"price"),h=this.safeString(e,"amount");let d;const c=this.safeString(e,"feeAmount");if(void 0!==c){const t=this.safeString(e,"feeCurrency");d={cost:c,currency:this.safeCurrencyCode(t)}}return t=this.safeMarket(void 0,t),this.safeTrade({info:e,id:this.safeString(e,"tid"),timestamp:n,datetime:this.iso8601(n),symbol:t.symbol,type:void 0,side:r,order:this.safeString(e,"orderId"),takerOrMaker:s,price:o,amount:h,cost:void 0,fee:d},t)}async fetchTrades(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchTrades() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a=r.swap,n={};void 0!==i&&(n.pageSize=i),void 0!==t&&(n.startTime=t);n[a?"symbol":"market"]=r.id,a&&void 0===s.pageNum&&(n.pageNum=1);const h=this.getSupportedMapping(r.type,{spot:"spotV1PublicGetTrades",swap:"contractV2PrivateGetTradeTradeHistory"});let d=await this[h](this.extend(n,s));if(a){const e=this.safeValue(d,"data");d=this.safeValue(e,"list")}return this.parseTrades(d,r,t,i)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const o=this.market(e),[h,d]=this.handleMarginModeAndParams("createOrder",a),c=o.swap,l=o.spot,u=this.safeString(a,"timeInForce");let f=this.safeValue(a,"reduceOnly");const p=this.safeValue2(a,"triggerPrice","stopPrice"),g=this.safeValue(a,"stopLossPrice"),y=this.safeValue(a,"takeProfitPrice"),b=void 0!==g,v=void 0!==y,w=void 0!==p;if(this.sum(b,v,w))throw new n(this.id+" createOrder() stopLossPrice and takeProfitPrice cannot both be defined");const S=b||v||w;if(S&&l)throw new n(this.id+" createOrder() it is not possible to make a stop order on spot markets");if("market"===t)throw new m(this.id+" createOrder() on "+o.type+" markets does not allow market orders");let k=this.getSupportedMapping(o.type,{spot:"spotV1PrivateGetOrder",margin:"spotV1PrivateGetOrder",swap:"contractV2PrivatePostTradeOrder"});const T={amount:this.amountToPrecision(e,s)};if(l){const s=1===this.safeInteger(a,"orderType",t),n=this.isPostOnly(!1,s,a);T.tradeType="buy"===i?1:0,T.currency=o.id,n?T.orderType=1:"IOC"===u&&(T.orderType=2),void 0!==r&&(T.price=this.priceToPrecision(e,r)),void 0!==h&&("isolated"===h?T.acctType=1:"cross"===h&&(T.acctType=2))}else if(c){const s=4===this.safeInteger(a,"action",t),n=this.isPostOnly(!1,s,a);(b||v)&&(f=!0),T.side=f?0:"buy"===i?5:6,S?(k="contractV2PrivatePostTradeOrderAlgo",b?(T.orderType=2,T.bizType=2,T.triggerPrice=this.priceToPrecision(e,g)):v?(T.orderType=2,T.bizType=1,T.triggerPrice=this.priceToPrecision(e,y)):w&&(T.orderType=1,T.triggerPrice=this.priceToPrecision(e,p)),T.algoPrice=this.priceToPrecision(e,r),T.pricetype=2):T.action="IOC"===u?3:n?4:"FOK"===u?5:"limit"===t?1:t,void 0!==r&&(T.price=this.priceToPrecision(e,r)),T.symbol=o.id;const h=this.safeString(a,"clientOrderId");void 0!==h&&(T.clientOrderId=h);const d=this.safeValue(a,"extend",void 0);void 0!==d&&(T.extend=d)}a=this.omit(d,["takeProfitPrice","stopLossPrice","stopPrice","reduceOnly","orderType","triggerPrice","priceType","clientOrderId","extend"]);const _=await this[k](this.extend(T,a));let O=_;return c&&!S&&(O=this.safeValue(_,"data")),this.parseOrder(O,o)}async cancelOrder(e,t,i={}){if(void 0===t)throw new o(this.id+" cancelOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t),r=s.swap,a={};a[r?"symbol":"currency"]=this.marketId(t);a[r?"orderId":"id"]=e.toString();const n=this.getSupportedMapping(s.type,{spot:"spotV1PrivateGetCancelOrder",swap:"contractV2PrivatePostTradeCancelOrder"}),h=await this[n](this.extend(a,i));return this.parseOrder(h,s)}async cancelAllOrders(e,t={}){if(void 0===e)throw new o(this.id+" cancelAllOrders() requires a symbol argument");await this.loadMarkets();const i=this.market(e),s=this.safeValue(t,"stop");if(i.spot)throw new c(this.id+" cancelAllOrders() is not supported on "+i.type+" markets");const r={symbol:i.id};let a="contractV2PrivatePostTradeCancelAllOrders";s&&(a="contractV2PrivatePostTradeCancelAlgos");const n=this.omit(t,"stop");return await this[a](this.extend(r,n))}async fetchOrder(e,t,i={}){if(void 0===t)throw new o(this.id+" fetchOrder() requires a symbol argument");await this.loadMarkets();const s=this.market(t);if(void 0!==this.safeInteger(i,"orderType"))throw new n(this.id+" fetchOrder() it is not possible to fetch a single conditional order, use fetchOrders() instead");const r=s.swap,a={};a[r?"symbol":"currency"]=this.marketId(t);a[r?"orderId":"id"]=e.toString();const h=this.getSupportedMapping(s.type,{spot:"spotV1PrivateGetGetOrder",swap:"contractV2PrivateGetTradeGetOrder"}),d=await this[h](this.extend(a,i));let c=d;return r&&(c=this.safeValue(d,"data")),this.parseOrder(c,s)}async fetchOrders(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a=this.safeInteger(s,"orderType"),n=r.swap,h={pageSize:i};h[r.swap?"symbol":"currency"]=r.id;h[r.swap?"pageNum":"pageIndex"]=1,n&&(h.startTime=t);let d=this.getSupportedMapping(r.type,{spot:"spotV1PrivateGetGetOrdersIgnoreTradeType",swap:"contractV2PrivateGetTradeGetAllOrders"});"tradeType"in s&&(d="spotV1PrivateGetGetOrdersNew"),void 0!==a&&(d="contractV2PrivateGetTradeGetOrderAlgos");const c=await this[d](this.extend(h,s));let l=c;if(n){const e=this.safeValue(c,"data",{});l=this.safeValue(e,"list",[])}return this.parseOrders(l,r,t,i)}async fetchCanceledOrders(e,t,i=10,s={}){if(void 0===e)throw new o(this.id+" fetchCanceledOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a=this.safeValue(s,"reduceOnly"),n=this.safeValue(s,"stop"),h={pageSize:i};h[r.spot?"currency":"symbol"]=r.id;h[r.spot?"pageIndex":"pageNum"]=1;let d,c="spotV1PrivateGetGetOrdersIgnoreTradeType";if(n){c="contractV2PrivateGetTradeGetOrderAlgos";const e=this.safeInteger(s,"orderType");if(void 0===e)throw new o(this.id+" fetchCanceledOrders() requires an orderType parameter for stop orders");const t=this.safeValue(s,"side"),i=this.safeInteger(s,"bizType");"sell"===t&&a?h.side=3:"buy"===t&&a?h.side=4:"buy"===t?h.side=1:"sell"===t?h.side=2:5===t?h.side=5:6===t?h.side=6:0===t&&(h.side=0),1===e?h.orderType=1:(2===e||i)&&(h.orderType=2,h.bizType=i),h.status=2}"tradeType"in s&&(c="spotV1PrivateGetGetOrdersNew");try{d=await this[c](this.extend(h,s))}catch(e){if(e instanceof l)return[];throw e}const u=this.omit(s,["reduceOnly","stop","side","orderType","bizType"]);if(d=await this[c](this.extend(h,u)),n){const e=this.safeValue(d,"data",{});d=this.safeValue(e,"list",[])}const f=[];if("spot"===r.type){for(let e=0;e<d.length;e++){const t=d[e];"1"===this.safeString(t,"status")&&f.push(t)}d=f}return this.parseOrders(d,r,t,i)}async fetchClosedOrders(e,t,i=10,s={}){if(void 0===e)throw new o(this.id+" fetchClosedOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a=r.swap,h=this.safeInteger(s,"orderType"),d={pageSize:i};d[r.spot?"currency":"symbol"]=r.id;d[r.spot?"pageIndex":"pageNum"]=1,a&&void 0!==t&&(d.startTime=t);const c=this.getSupportedMapping(r.type,{spot:"spotV1PrivateGetGetFinishedAndPartialOrders",swap:"contractV2PrivateGetTradeGetOrderAlgos"});if(a&&void 0===h)throw new n(this.id+" fetchClosedOrders() can not fetch swap orders, use fetchOrders instead");a&&(d.status=5);const l=await this[c](this.extend(d,s));let u=l;if(a){const e=this.safeValue(l,"data",{});u=this.safeValue(e,"list",[])}return this.parseOrders(u,r,t,i)}async fetchOpenOrders(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchOpenOrders() requires a symbol argument");await this.loadMarkets();const r=this.market(e),a=this.safeInteger(s,"orderType"),n=r.swap,h={};void 0!==i&&(h.pageSize=i);h[r.swap?"symbol":"currency"]=r.id;h[r.swap?"pageNum":"pageIndex"]=1,n&&void 0!==t&&(h.startTime=t);let d=this.getSupportedMapping(r.type,{spot:"spotV1PrivateGetGetUnfinishedOrdersIgnoreTradeType",swap:"contractV2PrivateGetTradeGetUndoneOrders"});void 0!==a&&(d="contractV2PrivateGetTradeGetOrderAlgos",h.status=1),"tradeType"in s&&(d="spotV1PrivateGetGetOrdersNew");const c=await this[d](this.extend(h,s));let l=c;if(n){const e=this.safeValue(c,"data",{});l=this.safeValue(e,"list",[])}return this.parseOrders(l,r,t,i)}parseOrder(e,t){let i=t.swap?this.safeString2(e,"orderId","data"):this.safeString(e,"id");void 0===i&&(i=this.safeValue(e,"id"));let s=this.safeInteger2(e,"type","side");void 0===s?s=void 0:t.spot?s=1===s?"buy":"sell":t.swap&&(0===s?s=void 0:1===s||4===s||5===s?s="buy":2!==s&&3!==s&&6!==s||(s="sell"));let r=this.safeInteger(e,"trade_date");void 0===r&&(r=this.safeInteger(e,"createTime"));const a=this.safeString(e,"currency");t=this.safeMarket(a,t,"_");const n=this.safeString2(e,"price","algoPrice"),o=t.swap?this.safeString(e,"tradeAmount"):this.safeString(e,"trade_amount");let h=this.safeString(e,"total_amount");void 0===h&&(h=this.safeString(e,"amount"));const d=this.safeString(e,"trade_money"),c=this.parseOrderStatus(this.safeString(e,"status"),t),l=this.safeString(e,"timeInForce"),u="PO"===l,f=this.safeNumber(e,"fees");let p;if(void 0!==f){let i;i=!0===this.safeValue(e,"useZbFee")?"ZB":"sell"===s?t.quote:t.base,p={cost:f,currency:i}}return this.safeOrder({info:e,id:i,clientOrderId:this.safeString(e,"userId"),timestamp:r,datetime:this.iso8601(r),lastTradeTimestamp:void 0,symbol:t.symbol,type:"limit",timeInForce:l,postOnly:u,side:s,price:n,stopPrice:this.safeNumber(e,"triggerPrice"),triggerPrice:this.safeNumber(e,"triggerPrice"),average:this.safeString(e,"avgPrice"),cost:d,amount:h,filled:o,remaining:void 0,status:c,fee:p,trades:void 0},t)}parseOrderStatus(e,t){let i={};return i="spot"===t.type?{0:"open",1:"canceled",2:"closed",3:"open"}:{1:"open",2:"canceled",3:"open",4:"rejected",5:"closed"},this.safeString(i,e,e)}parseTransactionStatus(e){return this.safeString({0:"pending",1:"failed",2:"ok",3:"canceled",5:"ok"},e,e)}parseTransaction(e,t){const i=this.safeString(e,"id"),s=this.safeString(e,"hash"),r=this.safeNumber(e,"amount");let a=this.parse8601(this.safeString(e,"submit_time"));a=this.safeInteger(e,"submitTime",a);let n,o=this.safeString2(e,"toAddress","address");if(void 0!==o){const e=o.split("_");o=this.safeString(e,0),n=this.safeString(e,1)}const h=this.safeInteger(e,"confirmTimes"),d=this.safeInteger(e,"manageTime");let c;const l=this.safeString(e,"currency"),u=this.safeCurrencyCode(l,t);void 0!==o&&(c=void 0===h?"withdrawal":"deposit");const f=this.parseTransactionStatus(this.safeString(e,"status"));let p;const m=this.safeNumber(e,"fees");return void 0!==m&&(p={cost:m,currency:u}),{info:e,id:i,txid:s,timestamp:a,datetime:this.iso8601(a),network:void 0,addressFrom:void 0,address:o,addressTo:o,tagFrom:void 0,tag:n,tagTo:n,type:c,amount:r,currency:u,status:f,updated:d,fee:p}}async setLeverage(e,t,i={}){if(await this.loadMarkets(),void 0===t)throw new o(this.id+" setLeverage() requires a symbol argument");if(e<1||e>125)throw new r(this.id+" setLeverage() leverage should be between 1 and 125");const s=this.market(t);let n;if(!s.swap)throw new a(this.id+" setLeverage() supports swap contracts only");n=1;const h={symbol:s.id,leverage:e,futuresAccountType:n};return await this.contractV2PrivatePostSettingSetLeverage(this.extend(h,i))}async fetchFundingRateHistory(e,t,i,s={}){await this.loadMarkets();const r={};if(void 0!==e){const t=this.market(e);e=t.symbol,r.symbol=t.id}void 0!==t&&(r.startTime=t);const a=this.safeInteger2(s,"until","till");s=this.omit(s,["endTime","till","until"]),void 0!==a&&(r.endTime=a),void 0!==i&&(r.limit=i);const n=await this.contractV2PublicGetFundingRate(this.extend(r,s)),o=this.safeValue(n,"data",[]),h=[];for(let e=0;e<o.length;e++){const t=o[e],i=this.safeString(t,"symbol"),s=this.safeSymbol(i),r=this.safeInteger(t,"fundingTime");h.push({info:t,symbol:s,fundingRate:this.safeNumber(t,"fundingRate"),timestamp:r,datetime:this.iso8601(r)})}const d=this.sortBy(h,"timestamp");return this.filterBySymbolSinceLimit(d,e,t,i)}async fetchFundingRate(e,t={}){await this.loadMarkets();const i=this.market(e);if(!i.swap)throw new a(this.id+" fetchFundingRate() does not supports contracts only");const s={symbol:i.id},r=await this.contractV1PublicGetFundingRate(this.extend(s,t)),n=this.safeValue(r,"data");return this.parseFundingRate(n,i)}parseFundingRate(e,t){const i=this.safeString(e,"symbol"),s=this.safeSymbol(i,t),r=this.safeNumber2(e,"fundingRate","lastFundingRate"),a=this.parse8601(this.safeString(e,"nextCalculateTime")),n=this.safeInteger(e,"nextFundingTime");return{info:e,symbol:s,markPrice:this.safeString(e,"markPrice"),indexPrice:this.safeString(e,"indexPrice"),interestRate:void 0,estimatedSettlePrice:void 0,timestamp:void 0,datetime:void 0,fundingRate:r,fundingTimestamp:n,fundingDatetime:this.iso8601(n),nextFundingRate:void 0,nextFundingTimestamp:a,nextFundingDatetime:this.iso8601(a),previousFundingRate:void 0,previousFundingTimestamp:void 0,previousFundingDatetime:void 0}}async fetchFundingRates(e,t={}){await this.loadMarkets(),e=this.marketSymbols(e);const i=await this.contractV2PublicGetPremiumIndex(t),s=this.safeValue(i,"data",[]),r=this.parseFundingRates(s);return this.filterByArray(r,"symbol",e)}async withdraw(e,t,i,s,r={}){[s,r]=this.handleWithdrawTagAndParams(s,r);const a=this.safeString(r,"safePwd",this.password);if(void 0===a)throw new o(this.id+" withdraw() requires exchange.password or a safePwd parameter");const n=this.safeNumber(r,"fees");if(void 0===n)throw new o(this.id+" withdraw() requires a fees parameter");this.checkAddress(i),await this.loadMarkets();const h=this.currency(e);void 0!==s&&(i+="_"+s);const d={amount:this.currencyToPrecision(e,t),currency:h.id,fees:this.currencyToPrecision(e,n),method:"withdraw",receiveAddr:i,safePwd:a},c=await this.spotV1PrivateGetWithdraw(this.extend(d,r)),l=this.parseTransaction(c,h);return this.extend(l,{type:"withdrawal",address:i,addressTo:i,amount:t})}async fetchWithdrawals(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==i&&(r.pageSize=i);const n=await this.spotV1PrivateGetGetWithdrawRecord(this.extend(r,s)),o=this.safeValue(n,"message",{}),h=this.safeValue(o,"datas",{}),d=this.safeValue(h,"list",[]);return this.parseTransactions(d,a,t,i)}async fetchDeposits(e,t,i,s={}){await this.loadMarkets();const r={};let a;void 0!==e&&(a=this.currency(e),r.currency=a.id),void 0!==i&&(r.pageSize=i);const n=await this.spotV1PrivateGetGetChargeRecord(this.extend(r,s)),o=this.safeValue(n,"message",{}),h=this.safeValue(o,"datas",{}),d=this.safeValue(h,"list",[]);return this.parseTransactions(d,a,t,i)}async fetchPosition(e,t={}){let i;await this.loadMarkets(),void 0!==e&&(i=this.market(e));const s=await this.contractV2PrivateGetPositionsGetPositions(this.extend({futuresAccountType:1},t)),r=this.safeValue(s,"data",[]),a=this.safeValue(r,0);return this.parsePosition(a,i)}async fetchPositions(e,t={}){await this.loadMarkets();const i=await this.contractV2PrivateGetPositionsGetPositions(this.extend({futuresAccountType:1},t)),s=this.safeValue(i,"data",[]);return this.parsePositions(s,e)}parsePosition(e,t){const i=this.safeString(e,"marketName"),s=(t=this.safeMarket(i,t)).symbol,r=this.safeString(e,"amount"),a=this.safeNumber(e,"avgPrice"),n=this.safeString(e,"margin"),o="1"===this.safeString(e,"side")?"long":"short",h="1"===this.safeString(e,"marginMode")?"isolated":"cross",d=this.safeString(e,"leverage"),c=this.safeNumber(e,"liquidatePrice"),l=this.safeNumber(e,"unrealizedPnl"),u=this.safeNumber(e,"maintainMargin"),f=this.safeNumber(e,"marginRate"),p=this.safeNumber(e,"nominalValue"),m=O.stringMul(this.safeString(e,"returnRate"),"100"),g=this.safeNumber(e,"createTime");return{info:e,id:void 0,symbol:s,contracts:this.parseNumber(r),contractSize:void 0,entryPrice:a,collateral:void 0,side:o,unrealizedProfit:l,leverage:this.parseNumber(d),percentage:m,marginMode:h,notional:p,markPrice:void 0,liquidationPrice:c,initialMargin:this.parseNumber(n),initialMarginPercentage:void 0,maintenanceMargin:u,maintenanceMarginPercentage:void 0,marginRatio:f,timestamp:g,datetime:this.iso8601(g)}}parseLedgerEntryType(e){return this.safeString({1:"realized pnl",2:"commission",3:"funding fee subtract",4:"funding fee addition",5:"insurance clear",6:"transfer in",7:"transfer out",8:"margin addition",9:"margin subtraction",10:"commission addition",11:"bill type freeze",12:"bill type unfreeze",13:"system take over margin",14:"transfer",15:"realized pnl collection",16:"funding fee collection",17:"recommender return commission",18:"by level subtract positions",19:"system add",20:"system subtract",23:"trading competition take over fund",24:"trading contest tickets",25:"return of trading contest tickets",26:"experience expired recall",50:"test register gift",51:"register gift",52:"deposit gift",53:"trading volume gift",54:"awards gift",55:"trading volume gift",56:"awards gift expire",201:"open positions",202:"close positions",203:"take over positions",204:"trading competition take over positions",205:"one way open long",206:"one way open short",207:"one way close long",208:"one way close short",301:"coupon deduction service charge",302:"experience deduction",303:"experience expired"},e,e)}parseLedgerEntry(e,t){const i=this.safeInteger(e,"createTime");let s;let r;s=1===this.safeNumber(e,"isIn")?"increase":"reduce";const a=this.safeNumber(e,"fee");return void 0!==a&&(r={cost:a,currency:this.safeCurrencyCode(this.safeString(e,"unit"))}),{id:this.safeString(e,"id"),info:e,timestamp:i,datetime:this.iso8601(i),direction:s,account:this.safeString(e,"userId"),referenceId:void 0,referenceAccount:void 0,type:this.parseLedgerEntryType(this.safeInteger(e,"type")),currency:this.safeCurrencyCode(this.safeString(e,"unit")),amount:this.safeNumber(e,"changeAmount"),before:this.safeNumber(e,"beforeAmount"),after:this.safeNumber(e,"available"),status:void 0,fee:r}}async fetchLedger(e,t,i,s={}){if(void 0===e)throw new o(this.id+" fetchLedger() requires a code argument");await this.loadMarkets();const r=this.currency(e),a={futuresAccountType:1};void 0!==e&&(a.currencyName=r.id),void 0!==t&&(a.startTime=t),void 0!==i&&(a.pageSize=i);const n=await this.contractV2PrivateGetFundGetBill(this.extend(a,s)),h=this.safeValue(n,"data",{}),d=this.safeValue(h,"list",[]);return this.parseLedger(d,r,t,i)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const[a,n]=this.handleMarketTypeAndParams("transfer",void 0,r),[h,d]=this.handleMarginModeAndParams("transfer",n),c=this.currency(e),l="swap"===a,u=this.currencyToPrecision(e,t),f={amount:u};let p,m;if(l)p="contractV2PrivatePostFundTransferFund",m="spot"===i||"future"===s?1:0,f.currencyName=c.id,f.clientId=this.safeString(r,"clientId"),f.side=m;else{if("isolated"===h||"isolated"===s||"isolated"===i){p="spot"===i||"isolated"===s?"spotV1PrivateGetTransferInLever":"spotV1PrivateGetTransferOutLever";const e=this.safeString2(r,"marketName","symbol");if(void 0===e)throw new o(this.id+" transfer() requires a symbol argument for isolated margin");const t=this.market(e);f.marketName=this.safeSymbol(t.id,t,"_")}else"cross"!==h&&"cross"!==s&&"cross"!==i||(p="spot"===i||"cross"===s?"spotV1PrivateGetTransferInCross":"spotV1PrivateGetTransferOutCross");f.coin=c.id}const g=await this[p](this.extend(f,d));return this.extend(this.parseTransfer(g,c),{amount:this.parseNumber(u),fromAccount:i,toAccount:s})}parseTransfer(e,t){const i=this.milliseconds();return{id:this.safeString(e,"data"),timestamp:i,datetime:this.iso8601(i),currency:this.safeCurrencyCode(void 0,"currency"),amount:void 0,fromAccount:void 0,toAccount:void 0,status:void 0}}async modifyMarginHelper(e,t,i,s={}){if(void 0===s.positionsId)throw new o(this.id+" modifyMarginHelper() requires a positionsId argument in the params");await this.loadMarkets();const r=this.market(e);t=this.amountToPrecision(e,t);const a={positionsId:this.safeString(s,"positionsId"),amount:t,type:i,futuresAccountType:1},n=await this.contractV2PrivatePostPositionsUpdateMargin(this.extend(a,s));return this.extend(this.parseMarginModification(n,r),{amount:this.parseNumber(t)})}parseMarginModification(e,t){const i=this.safeValue(e,"data",{}),s=1===this.safeInteger(i,"side")?"add":"reduce",r=1===this.safeInteger(i,"status")?"ok":"failed";return{info:e,type:s,amount:void 0,code:t.quote,symbol:t.symbol,status:r}}async addMargin(e,t,i={}){if(void 0===i.positionsId)throw new o(this.id+" addMargin() requires a positionsId argument in the params");return await this.modifyMarginHelper(e,t,1,i)}async reduceMargin(e,t,i={}){if(void 0===i.positionsId)throw new o(this.id+" reduceMargin() requires a positionsId argument in the params");return await this.modifyMarginHelper(e,t,0,i)}async fetchBorrowRate(e,t={}){await this.loadMarkets();const i={coin:this.currency(e).id},s=await this.spotV1PrivateGetGetLoans(this.extend(i,t)),r=this.milliseconds(),a=this.safeValue(s,"result",[]),n=this.safeValue(a,0,{});return{currency:this.safeCurrencyCode(this.safeString(n,"coinName")),rate:this.safeNumber(n,"interestRateOfDay"),period:this.safeNumber(n,"repaymentDay"),timestamp:r,datetime:this.iso8601(r),info:n}}async fetchBorrowRates(e={}){if(void 0===e.coin)throw new o(this.id+" fetchBorrowRates() requires a coin argument in the params");await this.loadMarkets();const t={coin:this.currency(this.safeString(e,"coin")).id},i=await this.spotV1PrivateGetGetLoans(this.extend(t,e)),s=this.milliseconds(),r=this.safeValue(i,"result",[]),a=[];for(let e=0;e<r.length;e++){const t=r[e];a.push({currency:this.safeCurrencyCode(this.safeString(t,"coinName")),rate:this.safeNumber(t,"interestRateOfDay"),period:this.safeNumber(t,"repaymentDay"),timestamp:s,datetime:this.iso8601(s),info:t})}return a}async setPositionMode(e,t,i={}){if(await this.loadMarkets(),void 0===t)throw new o(this.id+" setPositionMode() requires a symbol argument");const s=this.market(t);let r;if(!s.swap)throw new a(this.id+" setPositionMode() supports swap contracts only");r=1;const n={marketId:s.id,positionMode:e?2:1,futuresAccountType:r};return await this.contractV2PrivatePostSettingSetPositionsMode(this.extend(n,i))}async borrowMargin(e,t,i,s={}){let r,a;await this.loadMarkets(),void 0!==i&&(r=this.market(i),i=r.symbol),[a,s]=this.handleMarginModeAndParams("borrowMargin",s),void 0===a&&(a=void 0!==i?"isolated":"cross");const n=this.safeString(s,"safePwd",this.password),h=this.currency(e),d={coin:h.id,amount:this.currencyToPrecision(e,t),safePwd:n};let c;if("isolated"===a){if(void 0===i)throw new o(this.id+" borrowMargin() requires a symbol argument for isolated margin");const e=this.market(i);d.marketName=this.safeSymbol(e.id,e,"_"),c="spotV1PrivateGetBorrow"}else"cross"===a&&(c="spotV1PrivateGetDoCrossLoan");const l=await this[c](this.extend(d,s)),u=this.parseMarginLoan(l,h);return this.extend(u,{amount:t,symbol:i})}parseMarginLoan(e,t){return{id:void 0,currency:this.safeCurrencyCode(void 0,t),amount:void 0,symbol:void 0,timestamp:void 0,datetime:void 0,info:e}}nonce(){return this.milliseconds()}sign(e,t="public",i="GET",s={},r,a){const[n,o,h]=t;let d=this.implodeHostname(this.urls.api[n][o][h]);if("public"===h)"getFeeInfo"===e?d=this.implodeHostname(this.urls.api[n][o].private)+"/"+e:d+="/"+o+"/"+e,Object.keys(s).length&&(d+="?"+this.urlencode(s));else if("contract"===n){const t=this.milliseconds(),n=this.iso8601(t);let h=n+i+"/Server/api/"+o+"/"+e;if(s=this.keysort(s),r={"ZB-APIKEY":this.apiKey,"ZB-TIMESTAMP":n},d+="/"+o+"/"+e,"POST"===i)r["Content-Type"]="application/json",a=this.json(s),h+=this.urlencode(s);else if(Object.keys(s).length){const e=this.urlencode(s);d+="?"+e,h+=e}const c=this.hash(this.encode(this.secret),"sha1"),l=this.hmac(this.encode(h),this.encode(c),"sha256","base64");r["ZB-SIGN"]=l}else{let t=this.keysort(this.extend({method:e,accesskey:this.apiKey},s));const i=this.nonce();t=this.keysort(t);const r=this.rawencode(t),a=this.hash(this.encode(this.secret),"sha1");d+="/"+e+"?"+r+"&"+("sign="+this.hmac(this.encode(r),this.encode(a),"md5")+"&reqTime="+i.toString())}return{url:d,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,o,h,d){if(void 0!==o&&"{"===a[0]){const e=this.id+" "+a;if(this.throwBroadlyMatchedException(this.exceptions.broad,a,e),"code"in o){const t=this.safeString(o,"code");if(this.throwExactlyMatchedException(this.exceptions.exact,t,e),"1000"!==t&&"10000"!==t)throw new n(e)}const t=this.safeValue(o,"result");if(void 0!==t&&!t){throw"服务端忙碌"===this.safeString(o,"message")?new u(e):new n(e)}}}}},79264:function(e,t,i){"use strict";const s=i(48819),{InvalidNonce:r,InsufficientFunds:a,AuthenticationError:n,InvalidOrder:o,ExchangeError:h,OrderNotFound:d,AccountSuspended:c,BadSymbol:l,OrderImmediatelyFillable:u,RateLimitExceeded:f,OnMaintenance:p,PermissionDenied:m}=i(73449),{TICK_SIZE:g}=i(62115),y=i(6832);e.exports=class extends s{describe(){return this.deepExtend(super.describe(),{id:"zonda",name:"Zonda",countries:["EE"],rateLimit:1e3,has:{CORS:!0,spot:!0,margin:!1,swap:!1,future:!1,option:!1,addMargin:!1,cancelAllOrders:!1,cancelOrder:!0,cancelOrders:!1,createDepositAddress:!1,createOrder:!0,createReduceOnlyOrder:!1,fetchBalance:!0,fetchBorrowRate:!1,fetchBorrowRateHistories:!1,fetchBorrowRateHistory:!1,fetchBorrowRates:!1,fetchBorrowRatesPerSymbol:!1,fetchDeposit:!1,fetchDepositAddress:!0,fetchDepositAddresses:!0,fetchDeposits:void 0,fetchFundingHistory:!1,fetchFundingRate:!1,fetchFundingRateHistory:!1,fetchFundingRates:!1,fetchIndexOHLCV:!1,fetchLedger:!0,fetchLeverage:!1,fetchLeverageTiers:!1,fetchMarginMode:!1,fetchMarkets:!0,fetchMarkOHLCV:!1,fetchMyTrades:!0,fetchOHLCV:!0,fetchOpenInterestHistory:!1,fetchOpenOrder:!1,fetchOpenOrders:!0,fetchOrderBook:!0,fetchOrderBooks:!1,fetchPosition:!1,fetchPositionMode:!1,fetchPositions:!1,fetchPositionsRisk:!1,fetchPremiumIndexOHLCV:!1,fetchTicker:!0,fetchTickers:!0,fetchTime:!1,fetchTrades:!0,fetchTradingFee:!1,fetchTradingFees:!1,fetchTransactionFee:!1,fetchTransactionFees:!1,fetchTransactions:void 0,fetchTransfer:!1,fetchWithdrawal:!1,fetchWithdrawals:void 0,reduceMargin:!1,setLeverage:!1,setMargin:!1,setMarginMode:!1,setPositionMode:!1,transfer:!0,withdraw:!0},timeframes:{"1m":"60","3m":"180","5m":"300","15m":"900","30m":"1800","1h":"3600","2h":"7200","4h":"14400","6h":"21600","12h":"43200","1d":"86400","3d":"259200","1w":"604800"},hostname:"zonda.exchange",urls:{referral:"https://auth.zondaglobal.com/ref/jHlbB4mIkdS1",logo:"https://user-images.githubusercontent.com/1294454/159202310-a0e38007-5e7c-4ba9-a32f-c8263a0291fe.jpg",www:"https://zondaglobal.com",api:{public:"https://{hostname}/API/Public",private:"https://{hostname}/API/Trading/tradingApi.php",v1_01Public:"https://api.{hostname}/rest",v1_01Private:"https://api.{hostname}/rest"},doc:["https://docs.zonda.exchange/","https://github.com/BitBayNet/API"],support:"https://zondaglobal.com/en/helpdesk/zonda-exchange",fees:"https://zondaglobal.com/legal/zonda-exchange/fees"},api:{public:{get:["{id}/all","{id}/market","{id}/orderbook","{id}/ticker","{id}/trades"]},private:{post:["info","trade","cancel","orderbook","orders","transfer","withdraw","history","transactions"]},v1_01Public:{get:["trading/ticker","trading/ticker/{symbol}","trading/stats","trading/stats/{symbol}","trading/orderbook/{symbol}","trading/transactions/{symbol}","trading/candle/history/{symbol}/{resolution}"]},v1_01Private:{get:["api_payments/deposits/crypto/addresses","payments/withdrawal/{detailId}","payments/deposit/{detailId}","trading/offer","trading/stop/offer","trading/config/{symbol}","trading/history/transactions","balances/BITBAY/history","balances/BITBAY/balance","fiat_cantor/rate/{baseId}/{quoteId}","fiat_cantor/history"],post:["trading/offer/{symbol}","trading/stop/offer/{symbol}","trading/config/{symbol}","balances/BITBAY/balance","balances/BITBAY/balance/transfer/{source}/{destination}","fiat_cantor/exchange"],delete:["trading/offer/{symbol}/{id}/{side}/{price}","trading/stop/offer/{symbol}/{id}/{side}/{price}"],put:["balances/BITBAY/balance/{id}"]}},fees:{trading:{maker:this.parseNumber("0.0"),taker:this.parseNumber("0.001"),percentage:!0,tierBased:!1},fiat:{maker:this.parseNumber("0.0030"),taker:this.parseNumber("0.0043"),percentage:!0,tierBased:!0,tiers:{taker:[[this.parseNumber("0.0043"),this.parseNumber("0")],[this.parseNumber("0.0042"),this.parseNumber("1250")],[this.parseNumber("0.0041"),this.parseNumber("3750")],[this.parseNumber("0.0040"),this.parseNumber("7500")],[this.parseNumber("0.0039"),this.parseNumber("10000")],[this.parseNumber("0.0038"),this.parseNumber("15000")],[this.parseNumber("0.0037"),this.parseNumber("20000")],[this.parseNumber("0.0036"),this.parseNumber("25000")],[this.parseNumber("0.0035"),this.parseNumber("37500")],[this.parseNumber("0.0034"),this.parseNumber("50000")],[this.parseNumber("0.0033"),this.parseNumber("75000")],[this.parseNumber("0.0032"),this.parseNumber("100000")],[this.parseNumber("0.0031"),this.parseNumber("150000")],[this.parseNumber("0.0030"),this.parseNumber("200000")],[this.parseNumber("0.0029"),this.parseNumber("250000")],[this.parseNumber("0.0028"),this.parseNumber("375000")],[this.parseNumber("0.0027"),this.parseNumber("500000")],[this.parseNumber("0.0026"),this.parseNumber("625000")],[this.parseNumber("0.0025"),this.parseNumber("875000")]],maker:[[this.parseNumber("0.0030"),this.parseNumber("0")],[this.parseNumber("0.0029"),this.parseNumber("1250")],[this.parseNumber("0.0028"),this.parseNumber("3750")],[this.parseNumber("0.0028"),this.parseNumber("7500")],[this.parseNumber("0.0027"),this.parseNumber("10000")],[this.parseNumber("0.0026"),this.parseNumber("15000")],[this.parseNumber("0.0025"),this.parseNumber("20000")],[this.parseNumber("0.0025"),this.parseNumber("25000")],[this.parseNumber("0.0024"),this.parseNumber("37500")],[this.parseNumber("0.0023"),this.parseNumber("50000")],[this.parseNumber("0.0023"),this.parseNumber("75000")],[this.parseNumber("0.0022"),this.parseNumber("100000")],[this.parseNumber("0.0021"),this.parseNumber("150000")],[this.parseNumber("0.0021"),this.parseNumber("200000")],[this.parseNumber("0.0020"),this.parseNumber("250000")],[this.parseNumber("0.0019"),this.parseNumber("375000")],[this.parseNumber("0.0018"),this.parseNumber("500000")],[this.parseNumber("0.0018"),this.parseNumber("625000")],[this.parseNumber("0.0017"),this.parseNumber("875000")]]}},funding:{withdraw:{}}},options:{fiatCurrencies:["EUR","USD","GBP","PLN"],transfer:{fillResponseFromRequest:!0}},precisionMode:g,exceptions:{400:h,401:o,402:o,403:o,404:o,405:o,406:a,408:o,501:n,502:n,503:r,504:h,505:n,506:c,509:h,510:l,FUNDS_NOT_SUFFICIENT:a,OFFER_FUNDS_NOT_EXCEEDING_MINIMUMS:o,OFFER_NOT_FOUND:d,OFFER_WOULD_HAVE_BEEN_PARTIALLY_FILLED:u,ACTION_LIMIT_EXCEEDED:f,UNDER_MAINTENANCE:p,REQUEST_TIMESTAMP_TOO_OLD:r,PERMISSIONS_NOT_SUFFICIENT:m,INVALID_STOP_RATE:o},commonCurrencies:{GGC:"Global Game Coin"}})}async fetchMarkets(e={}){const t=await this.v1_01PublicGetTradingTicker(e),i=this.safeValue(this.options,"fiatCurrencies",[]),s=[],r=this.safeValue(t,"items",{}),a=Object.keys(r);for(let e=0;e<a.length;e++){const t=a[e],n=r[t],o=this.safeValue(n,"market",{}),h=this.safeValue(o,"first",{}),d=this.safeValue(o,"second",{}),c=this.safeString(h,"currency"),l=this.safeString(d,"currency"),u=this.safeCurrencyCode(c),f=this.safeCurrencyCode(l);let p=this.safeValue(this.fees,"trading",{});(this.inArray(u,i)||this.inArray(f,i))&&(p=this.safeValue(this.fees,"fiat",{})),s.push({id:t,symbol:u+"/"+f,base:u,quote:f,settle:void 0,baseId:c,quoteId:l,settleId:void 0,type:"spot",spot:!0,margin:!1,swap:!1,future:!1,option:!1,active:void 0,contract:!1,linear:void 0,inverse:void 0,taker:this.safeNumber(p,"taker"),maker:this.safeNumber(p,"maker"),contractSize:void 0,expiry:void 0,expiryDatetime:void 0,optionType:void 0,strike:void 0,precision:{amount:this.parseNumber(this.parsePrecision(this.safeString(h,"scale"))),price:this.parseNumber(this.parsePrecision(this.safeString(d,"scale")))},limits:{leverage:{min:void 0,max:void 0},amount:{min:this.safeNumber(h,"minOffer"),max:void 0},price:{min:void 0,max:void 0},cost:{min:this.safeNumber(d,"minOffer"),max:void 0}},info:n})}return s}async fetchOpenOrders(e,t,i,s={}){await this.loadMarkets();const r=await this.v1_01PrivateGetTradingOffer(this.extend({},s)),a=this.safeValue(r,"items",[]);return this.parseOrders(a,void 0,t,i,{status:"open"})}parseOrder(e,t){const i=this.safeString(e,"market"),s=this.safeSymbol(i,t,"-"),r=this.safeInteger(e,"time"),a=this.safeString(e,"startAmount"),n=this.safeString(e,"currentAmount"),o=this.safeValue(e,"postOnly");return this.safeOrder({id:this.safeString(e,"id"),clientOrderId:void 0,info:e,timestamp:r,datetime:this.iso8601(r),lastTradeTimestamp:void 0,status:void 0,symbol:s,type:this.safeString(e,"mode"),timeInForce:void 0,postOnly:o,side:this.safeStringLower(e,"offerType"),price:this.safeString(e,"rate"),stopPrice:void 0,triggerPrice:void 0,amount:a,cost:void 0,filled:void 0,remaining:n,average:void 0,fee:void 0,trades:void 0},t)}async fetchMyTrades(e,t,i,s={}){await this.loadMarkets();const r={};if(e){const t=[this.marketId(e)];e=this.symbol(e),r.markets=t}const a={query:this.json(this.extend(r,s))},n=await this.v1_01PrivateGetTradingHistoryTransactions(a),o=this.safeValue(n,"items"),h=this.parseTrades(o,void 0,t,i);return void 0===e?h:this.filterBySymbol(h,e)}parseBalance(e){const t=this.safeValue(e,"balances");if(void 0===t)throw new h(this.id+" empty balance response "+this.json(e));const i={info:e};for(let e=0;e<t.length;e++){const s=t[e],r=this.safeString(s,"currency"),a=this.safeCurrencyCode(r),n=this.account();n.used=this.safeString(s,"lockedFunds"),n.free=this.safeString(s,"availableFunds"),i[a]=n}return this.safeBalance(i)}async fetchBalance(e={}){await this.loadMarkets();const t=await this.v1_01PrivateGetBalancesBITBAYBalance(e);return this.parseBalance(t)}async fetchOrderBook(e,t,i={}){await this.loadMarkets();const s=this.market(e),r={symbol:s.id},a=await this.v1_01PublicGetTradingOrderbookSymbol(this.extend(r,i)),n=this.safeValue(a,"buy",[]),o=this.safeValue(a,"sell",[]),h=this.safeInteger(a,"timestamp");return{symbol:s.symbol,bids:this.parseBidsAsks(n,"ra","ca"),asks:this.parseBidsAsks(o,"ra","ca"),timestamp:h,datetime:this.iso8601(h),nonce:this.safeInteger(a,"seqNo")}}parseTicker(e,t){const i=this.safeString(e,"r24h"),s=this.safeString(e,"h"),r=this.safeString(e,"l"),a=this.safeString(e,"v"),n=this.safeString(e,"m"),o=(t=this.safeMarket(n,t,"-")).symbol;return this.safeTicker({symbol:o,timestamp:void 0,datetime:void 0,high:s,low:r,bid:void 0,bidVolume:void 0,ask:void 0,askVolume:void 0,vwap:void 0,open:i,close:void 0,last:void 0,previousClose:void 0,change:void 0,percentage:void 0,average:void 0,baseVolume:a,quoteVolume:void 0,info:e},t)}async fetchTicker(e,t={}){await this.loadMarkets();const i=this.market(e),s={symbol:i.id},r=await this.v1_01PublicGetTradingStatsSymbol(this.extend(s,t)),a=this.safeValue(r,"stats");return this.parseTicker(a,i)}async fetchTickers(e,t={}){await this.loadMarkets();const i=await this.v1_01PublicGetTradingStats(t),s=this.safeValue(i,"items");return this.parseTickers(s,e)}async fetchLedger(e,t,i,s={}){const r=[];if(void 0!==e){const t=this.currency(e);r.push(t.id)}let a={balanceCurrencies:r};void 0!==t&&(a.fromTime=t),void 0!==i&&(a.limit=i),a=this.extend(a,s);const n=(await this.v1_01PrivateGetBalancesBITBAYHistory({query:this.json(a)})).items;return this.parseLedger(n,void 0,t,i)}parseLedgerEntry(e,t){const i=this.safeInteger(e,"time"),s=this.safeValue(e,"balance",{}),r=this.safeString(s,"currency"),a=this.safeValue(e,"change",{});let n=this.safeString(a,"total"),o="in";y.stringLt(n,"0")&&(o="out",n=y.stringNeg(n));const h=this.safeValue(e,"fundsBefore",{}),d=this.safeValue(e,"fundsAfter",{});return{info:e,id:this.safeString(e,"historyId"),direction:o,account:void 0,referenceId:this.safeString(e,"detailId"),referenceAccount:void 0,type:this.parseLedgerEntryType(this.safeString(e,"type")),currency:this.safeCurrencyCode(r),amount:this.parseNumber(n),before:this.safeNumber(h,"total"),after:this.safeNumber(d,"total"),status:"ok",timestamp:i,datetime:this.iso8601(i),fee:void 0}}parseLedgerEntryType(e){return this.safeString({ADD_FUNDS:"transaction",BITCOIN_GOLD_FORK:"transaction",CREATE_BALANCE:"transaction",FUNDS_MIGRATION:"transaction",WITHDRAWAL_LOCK_FUNDS:"transaction",WITHDRAWAL_SUBTRACT_FUNDS:"transaction",WITHDRAWAL_UNLOCK_FUNDS:"transaction",TRANSACTION_COMMISSION_OUTCOME:"fee",TRANSACTION_COMMISSION_RETURN:"fee",TRANSACTION_OFFER_ABORTED_RETURN:"trade",TRANSACTION_OFFER_COMPLETED_RETURN:"trade",TRANSACTION_POST_INCOME:"trade",TRANSACTION_POST_OUTCOME:"trade",TRANSACTION_PRE_LOCKING:"trade"},e,e)}parseOHLCV(e,t){const i=this.safeValue(e,1,{});return[this.safeInteger(e,0),this.safeNumber(i,"o"),this.safeNumber(i,"h"),this.safeNumber(i,"l"),this.safeNumber(i,"c"),this.safeNumber(i,"v")]}async fetchOHLCV(e,t="1m",i,s,r={}){await this.loadMarkets();const a=this.market(e),n={symbol:a.baseId+"-"+a.quoteId,resolution:this.safeString(this.timeframes,t,t)};void 0===s&&(s=100);const o=s*this.parseTimeframe(t)*1e3;void 0===i?(n.to=this.milliseconds(),n.from=n.to-o):(n.from=parseInt(i),n.to=this.sum(n.from,o));const h=await this.v1_01PublicGetTradingCandleHistorySymbolResolution(this.extend(n,r)),d=this.safeValue(h,"items",[]);return this.parseOHLCVs(d,a,t,i,s)}parseTrade(e,t){const i=this.safeInteger2(e,"time","t"),s=this.safeStringLower2(e,"userAction","ty"),r=this.safeValue(e,"wasTaker");let a;void 0!==r&&(a=r?"taker":"maker");const n=this.safeString2(e,"rate","r"),o=this.safeString2(e,"amount","a"),h=this.safeString(e,"commissionValue"),d=this.safeString(e,"market"),c=(t=this.safeMarket(d,t,"-")).symbol;let l;if(void 0!==h){l={currency:"buy"===s?t.base:t.quote,cost:h}}const u=this.safeString(e,"offerId");let f;return void 0!==u&&(f=u?"limit":"market"),this.safeTrade({id:this.safeString(e,"id"),order:u,timestamp:i,datetime:this.iso8601(i),symbol:c,type:f,side:s,price:n,amount:o,cost:void 0,takerOrMaker:a,fee:l,info:e},t)}async fetchTrades(e,t,i,s={}){await this.loadMarkets();const r=this.market(e),a={symbol:r.baseId+"-"+r.quoteId};void 0!==t&&(a.fromTime=t-1),void 0!==i&&(a.limit=i);const n=await this.v1_01PublicGetTradingTransactionsSymbol(this.extend(a,s)),o=this.safeValue(n,"items");return this.parseTrades(o,r,t,i)}async createOrder(e,t,i,s,r,a={}){await this.loadMarkets();const n=this.market(e),o=n.baseId+"-"+n.quoteId;s=parseFloat(this.amountToPrecision(e,s));const d={symbol:o,offerType:i.toUpperCase(),amount:s},c=this.safeValue2(a,"stopPrice","stopLossPrice"),l=void 0!==c,u="limit"===t,f="market"===t,p="stop-limit"===t||u&&l,m="stop-market"===t||f&&l,g=p||m,y=g?"v1_01PrivatePostTradingStopOfferSymbol":"v1_01PrivatePostTradingOfferSymbol";if(u||p)d.rate=this.priceToPrecision(e,r),d.mode=p?"stop-limit":"limit";else{if(!f&&!m)throw new h(this.id+" createOrder() invalid type");d.mode=m?"stop-market":"market"}if(g){if(!l)throw new h(this.id+" createOrder() zonda requires `triggerPrice` or `stopPrice` parameter for stop-limit or stop-market orders");d.stopRate=this.priceToPrecision(e,c)}a=this.omit(a,["stopPrice","stopLossPrice"]);const b=await this[y](this.extend(d,a)),v=this.safeString2(b,"offerId","stopOfferId"),w=this.safeValue(b,"completed",!1)?"closed":"open",S=this.safeValue(b,"transactions");return this.safeOrder({id:v,info:b,timestamp:void 0,datetime:void 0,lastTradeTimestamp:void 0,status:w,symbol:e,type:t,side:i,price:r,amount:s,cost:void 0,filled:void 0,remaining:void 0,average:void 0,fee:void 0,trades:S,clientOrderId:void 0})}async cancelOrder(e,t,i={}){const s=this.safeString(i,"side");if(void 0===s)throw new h(this.id+' cancelOrder() requires a `side` parameter ("buy" or "sell")');const r=this.safeValue(i,"price");if(void 0===r)throw new h(this.id+" cancelOrder() requires a `price` parameter (float or string)");await this.loadMarkets();const a=this.market(t),n={symbol:a.baseId+"-"+a.quoteId,id:e,side:s,price:r};return await this.v1_01PrivateDeleteTradingOfferSymbolIdSidePrice(this.extend(n,i))}isFiat(e){return this.safeValue({USD:!0,EUR:!0,PLN:!0},e,!1)}parseDepositAddress(e,t){const i=this.safeString(e,"currency"),s=this.safeString(e,"address");return this.checkAddress(s),{currency:this.safeCurrencyCode(i,t),address:s,tag:this.safeString(e,"tag"),network:void 0,info:e}}async fetchDepositAddress(e,t={}){await this.loadMarkets();const i=this.currency(e),s={currency:i.id},r=await this.v1_01PrivateGetApiPaymentsDepositsCryptoAddresses(this.extend(s,t)),a=this.safeValue(r,"data"),n=this.safeValue(a,0);return this.parseDepositAddress(n,i)}async fetchDepositAddresses(e,t={}){await this.loadMarkets();const i=await this.v1_01PrivateGetApiPaymentsDepositsCryptoAddresses(t),s=this.safeValue(i,"data");return this.parseDepositAddresses(s,e)}async transfer(e,t,i,s,r={}){await this.loadMarkets();const a=this.currency(e),n={source:i,destination:s,currency:e,funds:this.currencyToPrecision(e,t)},o=await this.v1_01PrivatePostBalancesBITBAYBalanceTransferSourceDestination(this.extend(n,r)),h=this.parseTransfer(o,a),d=this.safeValue(this.options,"transfer",{});return this.safeValue(d,"fillResponseFromRequest",!0)&&(h.amount=t),h}parseTransfer(e,t){const i=this.safeString(e,"status"),s=this.safeValue(e,"from",{}),r=this.safeString(s,"id"),a=this.safeValue(e,"to",{}),n=this.safeString(a,"id"),o=this.safeString(s,"currency");return{info:e,id:void 0,timestamp:void 0,datetime:void 0,currency:this.safeCurrencyCode(o,t),amount:void 0,fromAccount:r,toAccount:n,status:this.parseTransferStatus(i)}}parseTransferStatus(e){return this.safeString({Ok:"ok",Fail:"failed"},e,e)}async withdraw(e,t,i,s,r={}){let a;[s,r]=this.handleWithdrawTagAndParams(s,r),this.checkAddress(i),await this.loadMarkets();const n=this.currency(e),o={currency:n.id,quantity:t};this.isFiat(e)?a="privatePostWithdraw":(a="privatePostTransfer",void 0!==s&&(i+="?dt="+s.toString()),o.address=i);const h=await this[a](this.extend(o,r)),d=this.safeValue(h,"data");return this.parseTransaction(d,n)}parseTransaction(e,t){return t=this.safeCurrency(void 0,t),{id:this.safeString(e,"id"),txid:void 0,timestamp:void 0,datetime:void 0,network:void 0,addressFrom:void 0,address:void 0,addressTo:void 0,amount:void 0,type:void 0,currency:t.code,status:void 0,updated:void 0,tagFrom:void 0,tag:void 0,tagTo:void 0,comment:void 0,fee:void 0,info:e}}sign(e,t="public",i="GET",s={},r,a){let n=this.implodeHostname(this.urls.api[t]);if("public"===t){const t=this.omit(s,this.extractParams(e));n+="/"+this.implodeParams(e,s)+".json",Object.keys(t).length&&(n+="?"+this.urlencode(t))}else if("v1_01Public"===t){const t=this.omit(s,this.extractParams(e));n+="/"+this.implodeParams(e,s),Object.keys(t).length&&(n+="?"+this.urlencode(t))}else if("v1_01Private"===t){this.checkRequiredCredentials();const t=this.omit(s,this.extractParams(e));n+="/"+this.implodeParams(e,s);const o=this.milliseconds().toString();let h;"POST"!==i?(Object.keys(t).length&&(n+="?"+this.urlencode(t)),h=this.apiKey+o):void 0===a&&(a=this.json(t),h=this.apiKey+o+a),r={"Request-Timestamp":o,"Operation-Id":this.uuid(),"API-Key":this.apiKey,"API-Hash":this.hmac(this.encode(h),this.encode(this.secret),"sha512"),"Content-Type":"application/json"}}else this.checkRequiredCredentials(),a=this.urlencode(this.extend({method:e,moment:this.nonce()},s)),r={"Content-Type":"application/x-www-form-urlencoded","API-Key":this.apiKey,"API-Hash":this.hmac(this.encode(a),this.encode(this.secret),"sha512")};return{url:n,method:i,body:a,headers:r}}handleErrors(e,t,i,s,r,a,n,o,d){if(void 0!==n){if("code"in n){const e=this.safeString(n,"code"),t=this.id+" "+a;throw this.throwExactlyMatchedException(this.exceptions,e,t),new h(t)}if("status"in n){if("Fail"===this.safeString(n,"status")){const e=this.safeValue(n,"errors"),t=this.id+" "+a;for(let i=0;i<e.length;i++){const s=e[i];this.throwExactlyMatchedException(this.exceptions,s,t)}throw new h(t)}}}}}},69988:function(e,t,i){"use strict";const s=i(88982);s.createWebSocketStream=i(70732),s.Server=i(56469),s.Receiver=i(5921),s.Sender=i(9745),s.WebSocket=s,s.WebSocketServer=s.Server,e.exports=s},907:function(e,t,i){"use strict";var s=i(48764).Buffer;const{EMPTY_BUFFER:r}=i(50889),a=s[Symbol.species];function n(e,t,i,s,r){for(let a=0;a<r;a++)i[s+a]=e[a]^t[3&a]}function o(e,t){for(let i=0;i<e.length;i++)e[i]^=t[3&i]}if(e.exports={concat:function(e,t){if(0===e.length)return r;if(1===e.length)return e[0];const i=s.allocUnsafe(t);let n=0;for(let t=0;t<e.length;t++){const s=e[t];i.set(s,n),n+=s.length}return n<t?new a(i.buffer,i.byteOffset,n):i},mask:n,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(t){if(e.readOnly=!0,s.isBuffer(t))return t;let i;return t instanceof ArrayBuffer?i=new a(t):ArrayBuffer.isView(t)?i=new a(t.buffer,t.byteOffset,t.byteLength):(i=s.from(t),e.readOnly=!1),i},unmask:o},!{NODE_ENV:"production",PUBLIC_PATH:"./"}.WS_NO_BUFFER_UTIL)try{const t=i(Object(function(){var e=new Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e}()));e.exports.mask=function(e,i,s,r,a){a<48?n(e,i,s,r,a):t.mask(e,i,s,r,a)},e.exports.unmask=function(e,i){e.length<32?o(e,i):t.unmask(e,i)}}catch(e){}},50889:function(e,t,i){"use strict";var s=i(48764).Buffer;e.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:s.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},40464:function(e,t,i){"use strict";const{kForOnEventAttribute:s,kListener:r}=i(50889),a=Symbol("kCode"),n=Symbol("kData"),o=Symbol("kError"),h=Symbol("kMessage"),d=Symbol("kReason"),c=Symbol("kTarget"),l=Symbol("kType"),u=Symbol("kWasClean");class f{constructor(e){this[c]=null,this[l]=e}get target(){return this[c]}get type(){return this[l]}}Object.defineProperty(f.prototype,"target",{enumerable:!0}),Object.defineProperty(f.prototype,"type",{enumerable:!0});class p extends f{constructor(e,t={}){super(e),this[a]=void 0===t.code?0:t.code,this[d]=void 0===t.reason?"":t.reason,this[u]=void 0!==t.wasClean&&t.wasClean}get code(){return this[a]}get reason(){return this[d]}get wasClean(){return this[u]}}Object.defineProperty(p.prototype,"code",{enumerable:!0}),Object.defineProperty(p.prototype,"reason",{enumerable:!0}),Object.defineProperty(p.prototype,"wasClean",{enumerable:!0});class m extends f{constructor(e,t={}){super(e),this[o]=void 0===t.error?null:t.error,this[h]=void 0===t.message?"":t.message}get error(){return this[o]}get message(){return this[h]}}Object.defineProperty(m.prototype,"error",{enumerable:!0}),Object.defineProperty(m.prototype,"message",{enumerable:!0});class g extends f{constructor(e,t={}){super(e),this[n]=void 0===t.data?null:t.data}get data(){return this[n]}}Object.defineProperty(g.prototype,"data",{enumerable:!0});const y={addEventListener(e,t,i={}){for(const a of this.listeners(e))if(!i[s]&&a[r]===t&&!a[s])return;let a;if("message"===e)a=function(e,i){const s=new g("message",{data:i?e:e.toString()});s[c]=this,b(t,this,s)};else if("close"===e)a=function(e,i){const s=new p("close",{code:e,reason:i.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});s[c]=this,b(t,this,s)};else if("error"===e)a=function(e){const i=new m("error",{error:e,message:e.message});i[c]=this,b(t,this,i)};else{if("open"!==e)return;a=function(){const e=new f("open");e[c]=this,b(t,this,e)}}a[s]=!!i[s],a[r]=t,i.once?this.once(e,a):this.on(e,a)},removeEventListener(e,t){for(const i of this.listeners(e))if(i[r]===t&&!i[s]){this.removeListener(e,i);break}}};function b(e,t,i){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,i):e.call(t,i)}e.exports={CloseEvent:p,ErrorEvent:m,Event:f,EventTarget:y,MessageEvent:g}},55148:function(e,t,i){"use strict";const{tokenChars:s}=i(60408);function r(e,t,i){void 0===e[t]?e[t]=[i]:e[t].push(i)}e.exports={format:function(e){return Object.keys(e).map((t=>{let i=e[t];return Array.isArray(i)||(i=[i]),i.map((e=>[t].concat(Object.keys(e).map((t=>{let i=e[t];return Array.isArray(i)||(i=[i]),i.map((e=>!0===e?t:`${t}=${e}`)).join("; ")}))).join("; "))).join(", ")})).join(", ")},parse:function(e){const t=Object.create(null);let i,a,n=Object.create(null),o=!1,h=!1,d=!1,c=-1,l=-1,u=-1,f=0;for(;f<e.length;f++)if(l=e.charCodeAt(f),void 0===i)if(-1===u&&1===s[l])-1===c&&(c=f);else if(0===f||32!==l&&9!==l){if(59!==l&&44!==l)throw new SyntaxError(`Unexpected character at index ${f}`);{if(-1===c)throw new SyntaxError(`Unexpected character at index ${f}`);-1===u&&(u=f);const s=e.slice(c,u);44===l?(r(t,s,n),n=Object.create(null)):i=s,c=u=-1}}else-1===u&&-1!==c&&(u=f);else if(void 0===a)if(-1===u&&1===s[l])-1===c&&(c=f);else if(32===l||9===l)-1===u&&-1!==c&&(u=f);else if(59===l||44===l){if(-1===c)throw new SyntaxError(`Unexpected character at index ${f}`);-1===u&&(u=f),r(n,e.slice(c,u),!0),44===l&&(r(t,i,n),n=Object.create(null),i=void 0),c=u=-1}else{if(61!==l||-1===c||-1!==u)throw new SyntaxError(`Unexpected character at index ${f}`);a=e.slice(c,f),c=u=-1}else if(h){if(1!==s[l])throw new SyntaxError(`Unexpected character at index ${f}`);-1===c?c=f:o||(o=!0),h=!1}else if(d)if(1===s[l])-1===c&&(c=f);else if(34===l&&-1!==c)d=!1,u=f;else{if(92!==l)throw new SyntaxError(`Unexpected character at index ${f}`);h=!0}else if(34===l&&61===e.charCodeAt(f-1))d=!0;else if(-1===u&&1===s[l])-1===c&&(c=f);else if(-1===c||32!==l&&9!==l){if(59!==l&&44!==l)throw new SyntaxError(`Unexpected character at index ${f}`);{if(-1===c)throw new SyntaxError(`Unexpected character at index ${f}`);-1===u&&(u=f);let s=e.slice(c,u);o&&(s=s.replace(/\\/g,""),o=!1),r(n,a,s),44===l&&(r(t,i,n),n=Object.create(null),i=void 0),a=void 0,c=u=-1}}else-1===u&&(u=f);if(-1===c||d||32===l||9===l)throw new SyntaxError("Unexpected end of input");-1===u&&(u=f);const p=e.slice(c,u);return void 0===i?r(t,p,n):(void 0===a?r(n,p,!0):r(n,a,o?p.replace(/\\/g,""):p),r(t,i,n)),t}}},59392:function(e){"use strict";const t=Symbol("kDone"),i=Symbol("kRun");e.exports=class{constructor(e){this[t]=()=>{this.pending--,this[i]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[i]()}[i](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[t])}}}},3764:function(e,t,i){"use strict";var s=i(48764).Buffer;const r=i(42635),a=i(907),n=i(59392),{kStatusCode:o}=i(50889),h=s[Symbol.species],d=s.from([0,0,255,255]),c=Symbol("permessage-deflate"),l=Symbol("total-length"),u=Symbol("callback"),f=Symbol("buffers"),p=Symbol("error");let m;function g(e){this[f].push(e),this[l]+=e.length}function y(e){this[l]+=e.length,this[c]._maxPayload<1||this[l]<=this[c]._maxPayload?this[f].push(e):(this[p]=new RangeError("Max payload size exceeded"),this[p].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[p][o]=1009,this.removeListener("data",y),this.reset())}function b(e){this[c]._inflate=null,e[o]=1007,this[u](e)}e.exports=class{constructor(e,t,i){if(this._maxPayload=0|i,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!m){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;m=new n(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[u];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,i=e.find((e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits)));if(!i)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(i.server_no_context_takeover=!0),t.clientNoContextTakeover&&(i.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(i.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?i.client_max_window_bits=t.clientMaxWindowBits:!0!==i.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete i.client_max_window_bits,i}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach((e=>{Object.keys(e).forEach((t=>{let i=e[t];if(i.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(i=i[0],"client_max_window_bits"===t){if(!0!==i){const e=+i;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${i}`);i=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${i}`)}else if("server_max_window_bits"===t){const e=+i;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${i}`);i=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==i)throw new TypeError(`Invalid value for parameter "${t}": ${i}`)}e[t]=i}))})),e}decompress(e,t,i){m.add((s=>{this._decompress(e,t,((e,t)=>{s(),i(e,t)}))}))}compress(e,t,i){m.add((s=>{this._compress(e,t,((e,t)=>{s(),i(e,t)}))}))}_decompress(e,t,i){const s=this._isServer?"client":"server";if(!this._inflate){const e=`${s}_max_window_bits`,t="number"!=typeof this.params[e]?r.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=r.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[c]=this,this._inflate[l]=0,this._inflate[f]=[],this._inflate.on("error",b),this._inflate.on("data",y)}this._inflate[u]=i,this._inflate.write(e),t&&this._inflate.write(d),this._inflate.flush((()=>{const e=this._inflate[p];if(e)return this._inflate.close(),this._inflate=null,void i(e);const r=a.concat(this._inflate[f],this._inflate[l]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[l]=0,this._inflate[f]=[],t&&this.params[`${s}_no_context_takeover`]&&this._inflate.reset()),i(null,r)}))}_compress(e,t,i){const s=this._isServer?"server":"client";if(!this._deflate){const e=`${s}_max_window_bits`,t="number"!=typeof this.params[e]?r.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=r.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[l]=0,this._deflate[f]=[],this._deflate.on("data",g)}this._deflate[u]=i,this._deflate.write(e),this._deflate.flush(r.Z_SYNC_FLUSH,(()=>{if(!this._deflate)return;let e=a.concat(this._deflate[f],this._deflate[l]);t&&(e=new h(e.buffer,e.byteOffset,e.length-4)),this._deflate[u]=null,this._deflate[l]=0,this._deflate[f]=[],t&&this.params[`${s}_no_context_takeover`]&&this._deflate.reset(),i(null,e)}))}}},5921:function(e,t,i){"use strict";var s=i(48764).Buffer;const{Writable:r}=i(42830),a=i(3764),{BINARY_TYPES:n,EMPTY_BUFFER:o,kStatusCode:h,kWebSocket:d}=i(50889),{concat:c,toArrayBuffer:l,unmask:u}=i(907),{isValidStatusCode:f,isValidUTF8:p}=i(60408),m=s[Symbol.species];function g(e,t,i,s,r){const a=new e(i?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(a,g),a.code=r,a[h]=s,a}e.exports=class extends r{constructor(e={}){super(),this._binaryType=e.binaryType||n[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[d]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=0,this._loop=!1}_write(e,t,i){if(8===this._opcode&&0==this._state)return i();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(i)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=new m(t.buffer,t.byteOffset+e,t.length-e),new m(t.buffer,t.byteOffset,e)}const t=s.allocUnsafe(e);do{const i=this._buffers[0],s=t.length-e;e>=i.length?t.set(this._buffers.shift(),s):(t.set(new Uint8Array(i.buffer,i.byteOffset,e),s),this._buffers[0]=new m(i.buffer,i.byteOffset+e,i.length-e)),e-=i.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do{switch(this._state){case 0:t=this.getInfo();break;case 1:t=this.getPayloadLength16();break;case 2:t=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:t=this.getData(e);break;default:return void(this._loop=!1)}}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2)return void(this._loop=!1);const e=this.consume(2);if(0!=(48&e[0]))return this._loop=!1,g(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");const t=64==(64&e[0]);if(t&&!this._extensions[a.extensionName])return this._loop=!1,g(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=128==(128&e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,g(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,g(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,g(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=t}else{if(!(this._opcode>7&&this._opcode<11))return this._loop=!1,g(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin)return this._loop=!1,g(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(t)return this._loop=!1,g(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return this._loop=!1,g(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&e[1]),this._isServer){if(!this._masked)return this._loop=!1,g(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,g(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(126===this._payloadLength)this._state=1;else{if(127!==this._payloadLength)return this.haveLength();this._state=2}}getPayloadLength16(){if(!(this._bufferedBytes<2))return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(this._bufferedBytes<8)return void(this._loop=!1);const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,g(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,g(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=o;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&0!=(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])&&u(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=5,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}decompress(e,t){this._extensions[a.extensionName].decompress(e,this._fin,((e,i)=>{if(e)return t(e);if(i.length){if(this._messageLength+=i.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(g(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(i)}const s=this.dataMessage();if(s)return t(s);this.startLoop(t)}))}dataMessage(){if(this._fin){const e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let i;i="nodebuffer"===this._binaryType?c(t,e):"arraybuffer"===this._binaryType?l(c(t,e)):t,this.emit("message",i,!0)}else{const i=c(t,e);if(!this._skipUTF8Validation&&!p(i))return this._loop=!1,g(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",i,!1)}}this._state=0}controlMessage(e){if(8===this._opcode)if(this._loop=!1,0===e.length)this.emit("conclude",1005,o),this.end();else{const t=e.readUInt16BE(0);if(!f(t))return g(RangeError,`invalid status code ${t}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");const i=new m(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!p(i))return g(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",t,i),this.end()}else 9===this._opcode?this.emit("ping",e):this.emit("pong",e);this._state=0}}},9745:function(e,t,i){"use strict";var s=i(48764).Buffer;i(87387),i(82860);const{randomFillSync:r}=i(55835),a=i(3764),{EMPTY_BUFFER:n}=i(50889),{isValidStatusCode:o}=i(60408),{mask:h,toBuffer:d}=i(907),c=Symbol("kByteLength"),l=s.alloc(4);class u{constructor(e,t,i){this._extensions=t||{},i&&(this._generateMask=i,this._maskBuffer=s.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let i,a,n=!1,o=2,d=!1;t.mask&&(i=t.maskBuffer||l,t.generateMask?t.generateMask(i):r(i,0,4),d=0==(i[0]|i[1]|i[2]|i[3]),o=6),"string"==typeof e?a=t.mask&&!d||void 0===t[c]?(e=s.from(e)).length:t[c]:(a=e.length,n=t.mask&&t.readOnly&&!d);let u=a;a>=65536?(o+=8,u=127):a>125&&(o+=2,u=126);const f=s.allocUnsafe(n?a+o:o);return f[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(f[0]|=64),f[1]=u,126===u?f.writeUInt16BE(a,2):127===u&&(f[2]=f[3]=0,f.writeUIntBE(a,4,6)),t.mask?(f[1]|=128,f[o-4]=i[0],f[o-3]=i[1],f[o-2]=i[2],f[o-1]=i[3],d?[f,e]:n?(h(e,i,f,o,a),[f]):(h(e,i,e,0,a),[f,e])):[f,e]}close(e,t,i,r){let a;if(void 0===e)a=n;else{if("number"!=typeof e||!o(e))throw new TypeError("First argument must be a valid error code number");if(void 0!==t&&t.length){const i=s.byteLength(t);if(i>123)throw new RangeError("The message must not be greater than 123 bytes");a=s.allocUnsafe(2+i),a.writeUInt16BE(e,0),"string"==typeof t?a.write(t,2):a.set(t,2)}else a=s.allocUnsafe(2),a.writeUInt16BE(e,0)}const h={[c]:a.length,fin:!0,generateMask:this._generateMask,mask:i,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};this._deflating?this.enqueue([this.dispatch,a,!1,h,r]):this.sendFrame(u.frame(a,h),r)}ping(e,t,i){let r,a;if("string"==typeof e?(r=s.byteLength(e),a=!1):(r=(e=d(e)).length,a=d.readOnly),r>125)throw new RangeError("The data size must not be greater than 125 bytes");const n={[c]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:a,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,n,i]):this.sendFrame(u.frame(e,n),i)}pong(e,t,i){let r,a;if("string"==typeof e?(r=s.byteLength(e),a=!1):(r=(e=d(e)).length,a=d.readOnly),r>125)throw new RangeError("The data size must not be greater than 125 bytes");const n={[c]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:a,rsv1:!1};this._deflating?this.enqueue([this.dispatch,e,!1,n,i]):this.sendFrame(u.frame(e,n),i)}send(e,t,i){const r=this._extensions[a.extensionName];let n,o,h=t.binary?2:1,l=t.compress;if("string"==typeof e?(n=s.byteLength(e),o=!1):(n=(e=d(e)).length,o=d.readOnly),this._firstFragment?(this._firstFragment=!1,l&&r&&r.params[r._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(l=n>=r._threshold),this._compress=l):(l=!1,h=0),t.fin&&(this._firstFragment=!0),r){const s={[c]:n,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:h,readOnly:o,rsv1:l};this._deflating?this.enqueue([this.dispatch,e,this._compress,s,i]):this.dispatch(e,this._compress,s,i)}else this.sendFrame(u.frame(e,{[c]:n,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:h,readOnly:o,rsv1:!1}),i)}dispatch(e,t,i,s){if(!t)return void this.sendFrame(u.frame(e,i),s);const r=this._extensions[a.extensionName];this._bufferedBytes+=i[c],this._deflating=!0,r.compress(e,i.fin,((e,t)=>{if(this._socket.destroyed){const e=new Error("The socket was closed while data was being compressed");"function"==typeof s&&s(e);for(let t=0;t<this._queue.length;t++){const i=this._queue[t],s=i[i.length-1];"function"==typeof s&&s(e)}}else this._bufferedBytes-=i[c],this._deflating=!1,i.readOnly=!1,this.sendFrame(u.frame(t,i),s),this.dequeue()}))}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][c],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][c],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}e.exports=u},70732:function(e,t,i){"use strict";var s=i(34155);const{Duplex:r}=i(42830);function a(e){e.emit("close")}function n(){!this.destroyed&&this._writableState.finished&&this.destroy()}function o(e){this.removeListener("error",o),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let i=!0;const h=new r({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",(function(t,i){const s=!i&&h._readableState.objectMode?t.toString():t;h.push(s)||e.pause()})),e.once("error",(function(e){h.destroyed||(i=!1,h.destroy(e))})),e.once("close",(function(){h.destroyed||h.push(null)})),h._destroy=function(t,r){if(e.readyState===e.CLOSED)return r(t),void s.nextTick(a,h);let n=!1;e.once("error",(function(e){n=!0,r(e)})),e.once("close",(function(){n||r(t),s.nextTick(a,h)})),i&&e.terminate()},h._final=function(t){e.readyState!==e.CONNECTING?null!==e._socket&&(e._socket._writableState.finished?(t(),h._readableState.endEmitted&&h.destroy()):(e._socket.once("finish",(function(){t()})),e.close())):e.once("open",(function(){h._final(t)}))},h._read=function(){e.isPaused&&e.resume()},h._write=function(t,i,s){e.readyState!==e.CONNECTING?e.send(t,s):e.once("open",(function(){h._write(t,i,s)}))},h.on("end",n),h.on("error",o),h}},88565:function(e,t,i){"use strict";const{tokenChars:s}=i(60408);e.exports={parse:function(e){const t=new Set;let i=-1,r=-1,a=0;for(;a<e.length;a++){const n=e.charCodeAt(a);if(-1===r&&1===s[n])-1===i&&(i=a);else if(0===a||32!==n&&9!==n){if(44!==n)throw new SyntaxError(`Unexpected character at index ${a}`);{if(-1===i)throw new SyntaxError(`Unexpected character at index ${a}`);-1===r&&(r=a);const s=e.slice(i,r);if(t.has(s))throw new SyntaxError(`The "${s}" subprotocol is duplicated`);t.add(s),i=r=-1}}else-1===r&&-1!==i&&(r=a)}if(-1===i||-1!==r)throw new SyntaxError("Unexpected end of input");const n=e.slice(i,a);if(t.has(n))throw new SyntaxError(`The "${n}" subprotocol is duplicated`);return t.add(n),t}}},60408:function(e,t,i){"use strict";const{isUtf8:s}=i(48764);function r(e){const t=e.length;let i=0;for(;i<t;)if(0==(128&e[i]))i++;else if(192==(224&e[i])){if(i+1===t||128!=(192&e[i+1])||192==(254&e[i]))return!1;i+=2}else if(224==(240&e[i])){if(i+2>=t||128!=(192&e[i+1])||128!=(192&e[i+2])||224===e[i]&&128==(224&e[i+1])||237===e[i]&&160==(224&e[i+1]))return!1;i+=3}else{if(240!=(248&e[i]))return!1;if(i+3>=t||128!=(192&e[i+1])||128!=(192&e[i+2])||128!=(192&e[i+3])||240===e[i]&&128==(240&e[i+1])||244===e[i]&&e[i+1]>143||e[i]>244)return!1;i+=4}return!0}if(e.exports={isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:r,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},s)e.exports.isValidUTF8=function(e){return e.length<24?r(e):s(e)};else if(!{NODE_ENV:"production",PUBLIC_PATH:"./"}.WS_NO_UTF_8_VALIDATE)try{const t=i(Object(function(){var e=new Error("Cannot find module 'utf-8-validate'");throw e.code="MODULE_NOT_FOUND",e}()));e.exports.isValidUTF8=function(e){return e.length<32?r(e):t(e)}}catch(e){}},56469:function(e,t,i){"use strict";var s=i(34155),r=i(48764).Buffer;const a=i(17187),n=i(55216),{createHash:o}=(i(382),i(87387),i(82860),i(55835)),h=i(55148),d=i(3764),c=i(88565),l=i(88982),{GUID:u,kWebSocket:f}=i(50889),p=/^[+/0-9A-Za-z]{22}==$/;function m(e){e._state=2,e.emit("close")}function g(){this.destroy()}function y(e,t,i,s){i=i||n.STATUS_CODES[t],s={Connection:"close","Content-Type":"text/html","Content-Length":r.byteLength(i),...s},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${n.STATUS_CODES[t]}\r\n`+Object.keys(s).map((e=>`${e}: ${s[e]}`)).join("\r\n")+"\r\n\r\n"+i)}function b(e,t,i,s,r){if(e.listenerCount("wsClientError")){const s=new Error(r);Error.captureStackTrace(s,b),e.emit("wsClientError",s,i,t)}else y(i,s,r)}e.exports=class extends a{constructor(e,t){if(super(),null==(e={maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:l,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=n.createServer(((e,t)=>{const i=n.STATUS_CODES[426];t.writeHead(426,{"Content-Length":i.length,"Content-Type":"text/plain"}),t.end(i)})),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(const i of Object.keys(t))e.on(i,t[i]);return function(){for(const i of Object.keys(t))e.removeListener(i,t[i])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,i,s)=>{this.handleUpgrade(t,i,s,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state)return e&&this.once("close",(()=>{e(new Error("The server is not running"))})),void s.nextTick(m,this);if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:s.nextTick(m,this);else{const e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close((()=>{m(this)}))}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,i,s){t.on("error",g);const r=e.headers["sec-websocket-key"],a=+e.headers["sec-websocket-version"];if("GET"!==e.method){return void b(this,e,t,405,"Invalid HTTP method")}if("websocket"!==e.headers.upgrade.toLowerCase()){return void b(this,e,t,400,"Invalid Upgrade header")}if(!r||!p.test(r)){return void b(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header")}if(8!==a&&13!==a){return void b(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header")}if(!this.shouldHandle(e))return void y(t,400);const n=e.headers["sec-websocket-protocol"];let o=new Set;if(void 0!==n)try{o=c.parse(n)}catch(i){return void b(this,e,t,400,"Invalid Sec-WebSocket-Protocol header")}const l=e.headers["sec-websocket-extensions"],u={};if(this.options.perMessageDeflate&&void 0!==l){const i=new d(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const e=h.parse(l);e[d.extensionName]&&(i.accept(e[d.extensionName]),u[d.extensionName]=i)}catch(i){return void b(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header")}}if(this.options.verifyClient){const n={origin:e.headers[""+(8===a?"sec-websocket-origin":"origin")],secure:!(!e.socket.authorized&&!e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(n,((a,n,h,d)=>{if(!a)return y(t,n||401,h,d);this.completeUpgrade(u,r,o,e,t,i,s)}));if(!this.options.verifyClient(n))return y(t,401)}this.completeUpgrade(u,r,o,e,t,i,s)}completeUpgrade(e,t,i,r,a,n,c){if(!a.readable||!a.writable)return a.destroy();if(a[f])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return y(a,503);const l=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${o("sha1").update(t+u).digest("base64")}`],p=new this.options.WebSocket(null);if(i.size){const e=this.options.handleProtocols?this.options.handleProtocols(i,r):i.values().next().value;e&&(l.push(`Sec-WebSocket-Protocol: ${e}`),p._protocol=e)}if(e[d.extensionName]){const t=e[d.extensionName].params,i=h.format({[d.extensionName]:[t]});l.push(`Sec-WebSocket-Extensions: ${i}`),p._extensions=e}this.emit("headers",l,r),a.write(l.concat("\r\n").join("\r\n")),a.removeListener("error",g),p.setSocket(a,n,{maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(p),p.on("close",(()=>{this.clients.delete(p),this._shouldEmitClose&&!this.clients.size&&s.nextTick(m,this)}))),c(p,r)}}},88982:function(e,t,i){"use strict";var s=i(48764).Buffer,r=i(34155);const a=i(17187),n=i(382),o=i(55216),h=i(87387),d=i(82860),{randomBytes:c,createHash:l}=i(55835),{Readable:u}=i(42830),{URL:f}=i(8575),p=i(3764),m=i(5921),g=i(9745),{BINARY_TYPES:y,EMPTY_BUFFER:b,GUID:v,kForOnEventAttribute:w,kListener:S,kStatusCode:k,kWebSocket:T,NOOP:_}=i(50889),{EventTarget:{addEventListener:O,removeEventListener:M}}=i(40464),{format:I,parse:x}=i(55148),{toBuffer:C}=i(907),P=Symbol("kAborted"),A=[8,13],N=["CONNECTING","OPEN","CLOSING","CLOSED"],B=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class E extends a{constructor(e,t,i){super(),this._binaryType=y[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=b,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=E.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(i=t,t=[]):t=[t]),V(this,e,t,i)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){y.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,i){const s=new m({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:i.maxPayload,skipUTF8Validation:i.skipUTF8Validation});this._sender=new g(e,this._extensions,i.generateMask),this._receiver=s,this._socket=e,s[T]=this,e[T]=this,s.on("conclude",G),s.on("drain",H),s.on("error",U),s.on("message",W),s.on("ping",z),s.on("pong",K),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Z),e.on("data",Y),e.on("end",Q),e.on("error",J),this._readyState=E.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=E.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[p.extensionName]&&this._extensions[p.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=E.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==E.CLOSED)if(this.readyState!==E.CONNECTING)this.readyState!==E.CLOSING?(this._readyState=E.CLOSING,this._sender.close(e,t,!this._isServer,(e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())})),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();else{const e="WebSocket was closed before the connection was established";F(this,this._req,e)}}pause(){this.readyState!==E.CONNECTING&&this.readyState!==E.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,i){if(this.readyState===E.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(i=e,e=t=void 0):"function"==typeof t&&(i=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===E.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||b,t,i)):q(this,e,i)}pong(e,t,i){if(this.readyState===E.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(i=e,e=t=void 0):"function"==typeof t&&(i=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===E.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||b,t,i)):q(this,e,i)}resume(){this.readyState!==E.CONNECTING&&this.readyState!==E.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,i){if(this.readyState===E.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(i=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==E.OPEN)return void q(this,e,i);const s={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[p.extensionName]||(s.compress=!1),this._sender.send(e||b,s,i)}terminate(){if(this.readyState!==E.CLOSED)if(this.readyState!==E.CONNECTING)this._socket&&(this._readyState=E.CLOSING,this._socket.destroy());else{const e="WebSocket was closed before the connection was established";F(this,this._req,e)}}}function V(e,t,i,r){const a={protocolVersion:A[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...r,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(!A.includes(a.protocolVersion))throw new RangeError(`Unsupported protocol version: ${a.protocolVersion} (supported versions: ${A.join(", ")})`);let h;if(t instanceof f)h=t,e._url=t.href;else{try{h=new f(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}e._url=t}const d="wss:"===h.protocol,u="ws+unix:"===h.protocol;let m;if("ws:"===h.protocol||d||u?u&&!h.pathname?m="The URL's pathname is empty":h.hash&&(m="The URL contains a fragment identifier"):m='The URL\'s protocol must be one of "ws:", "wss:", or "ws+unix:"',m){const t=new SyntaxError(m);if(0===e._redirects)throw t;return void L(e,t)}const g=d?443:80,y=c(16).toString("base64"),b=d?n.request:o.request,w=new Set;let S,k;if(a.createConnection=d?D:R,a.defaultPort=a.defaultPort||g,a.port=h.port||g,a.host=h.hostname.startsWith("[")?h.hostname.slice(1,-1):h.hostname,a.headers={...a.headers,"Sec-WebSocket-Version":a.protocolVersion,"Sec-WebSocket-Key":y,Connection:"Upgrade",Upgrade:"websocket"},a.path=h.pathname+h.search,a.timeout=a.handshakeTimeout,a.perMessageDeflate&&(S=new p(!0!==a.perMessageDeflate?a.perMessageDeflate:{},!1,a.maxPayload),a.headers["Sec-WebSocket-Extensions"]=I({[p.extensionName]:S.offer()})),i.length){for(const e of i){if("string"!=typeof e||!B.test(e)||w.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");w.add(e)}a.headers["Sec-WebSocket-Protocol"]=i.join(",")}if(a.origin&&(a.protocolVersion<13?a.headers["Sec-WebSocket-Origin"]=a.origin:a.headers.Origin=a.origin),(h.username||h.password)&&(a.auth=`${h.username}:${h.password}`),u){const e=a.path.split(":");a.socketPath=e[0],a.path=e[1]}if(a.followRedirects){if(0===e._redirects){e._originalIpc=u,e._originalSecure=d,e._originalHostOrSocketPath=u?a.socketPath:h.host;const t=r&&r.headers;if(r={...r,headers:{}},t)for(const[e,i]of Object.entries(t))r.headers[e.toLowerCase()]=i}else if(0===e.listenerCount("redirect")){const t=u?!!e._originalIpc&&a.socketPath===e._originalHostOrSocketPath:!e._originalIpc&&h.host===e._originalHostOrSocketPath;(!t||e._originalSecure&&!d)&&(delete a.headers.authorization,delete a.headers.cookie,t||delete a.headers.host,a.auth=void 0)}a.auth&&!r.headers.authorization&&(r.headers.authorization="Basic "+s.from(a.auth).toString("base64")),k=e._req=b(a),e._redirects&&e.emit("redirect",e.url,k)}else k=e._req=b(a);a.timeout&&k.on("timeout",(()=>{F(e,k,"Opening handshake has timed out")})),k.on("error",(t=>{null===k||k[P]||(k=e._req=null,L(e,t))})),k.on("response",(s=>{const n=s.headers.location,o=s.statusCode;if(n&&a.followRedirects&&o>=300&&o<400){if(++e._redirects>a.maxRedirects)return void F(e,k,"Maximum redirects exceeded");let s;k.abort();try{s=new f(n,t)}catch(t){const i=new SyntaxError(`Invalid URL: ${n}`);return void L(e,i)}V(e,s,i,r)}else e.emit("unexpected-response",k,s)||F(e,k,`Unexpected server response: ${s.statusCode}`)})),k.on("upgrade",((t,i,s)=>{if(e.emit("upgrade",t),e.readyState!==E.CONNECTING)return;if(k=e._req=null,"websocket"!==t.headers.upgrade.toLowerCase())return void F(e,i,"Invalid Upgrade header");const r=l("sha1").update(y+v).digest("base64");if(t.headers["sec-websocket-accept"]!==r)return void F(e,i,"Invalid Sec-WebSocket-Accept header");const n=t.headers["sec-websocket-protocol"];let o;if(void 0!==n?w.size?w.has(n)||(o="Server sent an invalid subprotocol"):o="Server sent a subprotocol but none was requested":w.size&&(o="Server sent no subprotocol"),o)return void F(e,i,o);n&&(e._protocol=n);const h=t.headers["sec-websocket-extensions"];if(void 0!==h){if(!S){return void F(e,i,"Server sent a Sec-WebSocket-Extensions header but no extension was requested")}let t;try{t=x(h)}catch(t){return void F(e,i,"Invalid Sec-WebSocket-Extensions header")}const s=Object.keys(t);if(1!==s.length||s[0]!==p.extensionName){return void F(e,i,"Server indicated an extension that was not requested")}try{S.accept(t[p.extensionName])}catch(t){return void F(e,i,"Invalid Sec-WebSocket-Extensions header")}e._extensions[p.extensionName]=S}e.setSocket(i,s,{generateMask:a.generateMask,maxPayload:a.maxPayload,skipUTF8Validation:a.skipUTF8Validation})})),k.end()}function L(e,t){e._readyState=E.CLOSING,e.emit("error",t),e.emitClose()}function R(e){return e.path=e.socketPath,h.connect(e)}function D(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=h.isIP(e.host)?"":e.host),d.connect(e)}function F(e,t,i){e._readyState=E.CLOSING;const s=new Error(i);Error.captureStackTrace(s,F),t.setHeader?(t[P]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),r.nextTick(L,e,s)):(t.destroy(s),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function q(e,t,i){if(t){const i=C(t).length;e._socket?e._sender._bufferedBytes+=i:e._bufferedAmount+=i}if(i){const t=new Error(`WebSocket is not open: readyState ${e.readyState} (${N[e.readyState]})`);r.nextTick(i,t)}}function G(e,t){const i=this[T];i._closeFrameReceived=!0,i._closeMessage=t,i._closeCode=e,void 0!==i._socket[T]&&(i._socket.removeListener("data",Y),r.nextTick(X,i._socket),1005===e?i.close():i.close(e,t))}function H(){const e=this[T];e.isPaused||e._socket.resume()}function U(e){const t=this[T];void 0!==t._socket[T]&&(t._socket.removeListener("data",Y),r.nextTick(X,t._socket),t.close(e[k])),t.emit("error",e)}function j(){this[T].emitClose()}function W(e,t){this[T].emit("message",e,t)}function z(e){const t=this[T];t.pong(e,!t._isServer,_),t.emit("ping",e)}function K(e){this[T].emit("pong",e)}function X(e){e.resume()}function Z(){const e=this[T];let t;this.removeListener("close",Z),this.removeListener("data",Y),this.removeListener("end",Q),e._readyState=E.CLOSING,this._readableState.endEmitted||e._closeFrameReceived||e._receiver._writableState.errorEmitted||null===(t=e._socket.read())||e._receiver.write(t),e._receiver.end(),this[T]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",j),e._receiver.on("finish",j))}function Y(e){this[T]._receiver.write(e)||this.pause()}function Q(){const e=this[T];e._readyState=E.CLOSING,e._receiver.end(),this.end()}function J(){const e=this[T];this.removeListener("error",J),this.on("error",_),e&&(e._readyState=E.CLOSING,this.destroy())}Object.defineProperty(E,"CONNECTING",{enumerable:!0,value:N.indexOf("CONNECTING")}),Object.defineProperty(E.prototype,"CONNECTING",{enumerable:!0,value:N.indexOf("CONNECTING")}),Object.defineProperty(E,"OPEN",{enumerable:!0,value:N.indexOf("OPEN")}),Object.defineProperty(E.prototype,"OPEN",{enumerable:!0,value:N.indexOf("OPEN")}),Object.defineProperty(E,"CLOSING",{enumerable:!0,value:N.indexOf("CLOSING")}),Object.defineProperty(E.prototype,"CLOSING",{enumerable:!0,value:N.indexOf("CLOSING")}),Object.defineProperty(E,"CLOSED",{enumerable:!0,value:N.indexOf("CLOSED")}),Object.defineProperty(E.prototype,"CLOSED",{enumerable:!0,value:N.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((e=>{Object.defineProperty(E.prototype,e,{enumerable:!0})})),["open","error","close","message"].forEach((e=>{Object.defineProperty(E.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[w])return t[S];return null},set(t){for(const t of this.listeners(e))if(t[w]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[w]:!0})}})})),E.prototype.addEventListener=O,E.prototype.removeEventListener=M,e.exports=E},71027:function(e,t,i){var s=i(89509).Buffer,r=i(42830).Transform,a=i(32553).s;function n(e){r.call(this),this.hashMode="string"==typeof e,this.hashMode?this[e]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}i(35717)(n,r),n.prototype.update=function(e,t,i){"string"==typeof e&&(e=s.from(e,t));var r=this._update(e);return this.hashMode?this:(i&&(r=this._toString(r,i)),r)},n.prototype.setAutoPadding=function(){},n.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},n.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},n.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},n.prototype._transform=function(e,t,i){var s;try{this.hashMode?this._update(e):this.push(this._update(e))}catch(e){s=e}finally{i(s)}},n.prototype._flush=function(e){var t;try{this.push(this.__final())}catch(e){t=e}e(t)},n.prototype._finalOrDigest=function(e){var t=this.__final()||s.alloc(0);return e&&(t=this._toString(t,e,!0)),t},n.prototype._toString=function(e,t,i){if(this._decoder||(this._decoder=new a(t),this._encoding=t),this._encoding!==t)throw new Error("can't switch encodings");var s=this._decoder.write(e);return i&&(s+=this._decoder.end()),s},e.exports=n},16497:function(e,t,i){function s(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===s(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===s(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===s(e)},t.isError=function(e){return"[object Error]"===s(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=i(48764).Buffer.isBuffer},76393:function(e,t,i){var s=i(48764).Buffer,r=i(86266),a=i(16426);e.exports=function(e){return new o(e)};var n={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};function o(e){this.curveType=n[e],this.curveType||(this.curveType={name:e}),this.curve=new r.ec(this.curveType.name),this.keys=void 0}function h(e,t,i){Array.isArray(e)||(e=e.toArray());var r=new s(e);if(i&&r.length<i){var a=new s(i-r.length);a.fill(0),r=s.concat([a,r])}return t?r.toString(t):r}n.p224=n.secp224r1,n.p256=n.secp256r1=n.prime256v1,n.p192=n.secp192r1=n.prime192v1,n.p384=n.secp384r1,n.p521=n.secp521r1,o.prototype.generateKeys=function(e,t){return this.keys=this.curve.genKeyPair(),this.getPublicKey(e,t)},o.prototype.computeSecret=function(e,t,i){return t=t||"utf8",s.isBuffer(e)||(e=new s(e,t)),h(this.curve.keyFromPublic(e).getPublic().mul(this.keys.getPrivate()).getX(),i,this.curveType.byteLength)},o.prototype.getPublicKey=function(e,t){var i=this.keys.getPublic("compressed"===t,!0);return"hybrid"===t&&(i[i.length-1]%2?i[0]=7:i[0]=6),h(i,e)},o.prototype.getPrivateKey=function(e){return h(this.keys.getPrivate(),e)},o.prototype.setPublicKey=function(e,t){return t=t||"utf8",s.isBuffer(e)||(e=new s(e,t)),this.keys._importPublic(e),this},o.prototype.setPrivateKey=function(e,t){t=t||"utf8",s.isBuffer(e)||(e=new s(e,t));var i=new a(e);return i=i.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(i),this}},16426:function(e,t,i){!function(e,t){"use strict";function s(e,t){if(!e)throw new Error(t||"Assertion failed")}function r(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function a(e,t,i){if(a.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(i=t,t=10),this._init(e||0,t||10,i||"be"))}var n;"object"==typeof e?e.exports=a:t.BN=a,a.BN=a,a.wordSize=26;try{n="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i(8623).Buffer}catch(e){}function o(e,t){var i=e.charCodeAt(t);return i>=65&&i<=70?i-55:i>=97&&i<=102?i-87:i-48&15}function h(e,t,i){var s=o(e,i);return i-1>=t&&(s|=o(e,i-1)<<4),s}function d(e,t,i,s){for(var r=0,a=Math.min(e.length,i),n=t;n<a;n++){var o=e.charCodeAt(n)-48;r*=s,r+=o>=49?o-49+10:o>=17?o-17+10:o}return r}a.isBN=function(e){return e instanceof a||null!==e&&"object"==typeof e&&e.constructor.wordSize===a.wordSize&&Array.isArray(e.words)},a.max=function(e,t){return e.cmp(t)>0?e:t},a.min=function(e,t){return e.cmp(t)<0?e:t},a.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),s(t===(0|t)&&t>=2&&t<=36);var r=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(r++,this.negative=1),r<e.length&&(16===t?this._parseHex(e,r,i):(this._parseBase(e,t,r),"le"===i&&this._initArray(this.toArray(),t,i)))},a.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(s(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},a.prototype._initArray=function(e,t,i){if(s("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var a,n,o=0;if("be"===i)for(r=e.length-1,a=0;r>=0;r-=3)n=e[r]|e[r-1]<<8|e[r-2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);else if("le"===i)for(r=0,a=0;r<e.length;r+=3)n=e[r]|e[r+1]<<8|e[r+2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);return this.strip()},a.prototype._parseHex=function(e,t,i){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var r,a=0,n=0;if("be"===i)for(s=e.length-1;s>=t;s-=2)r=h(e,t,s)<<a,this.words[n]|=67108863&r,a>=18?(a-=18,n+=1,this.words[n]|=r>>>26):a+=8;else for(s=(e.length-t)%2==0?t+1:t;s<e.length;s+=2)r=h(e,t,s)<<a,this.words[n]|=67108863&r,a>=18?(a-=18,n+=1,this.words[n]|=r>>>26):a+=8;this.strip()},a.prototype._parseBase=function(e,t,i){this.words=[0],this.length=1;for(var s=0,r=1;r<=67108863;r*=t)s++;s--,r=r/t|0;for(var a=e.length-i,n=a%s,o=Math.min(a,a-n)+i,h=0,c=i;c<o;c+=s)h=d(e,c,c+s,t),this.imuln(r),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==n){var l=1;for(h=d(e,c,e.length,t),c=0;c<n;c++)l*=t;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},a.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},a.prototype.clone=function(){var e=new a(null);return this.copy(e),e},a.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},a.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},a.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},a.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],u=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,i){i.negative=t.negative^e.negative;var s=e.length+t.length|0;i.length=s,s=s-1|0;var r=0|e.words[0],a=0|t.words[0],n=r*a,o=67108863&n,h=n/67108864|0;i.words[0]=o;for(var d=1;d<s;d++){for(var c=h>>>26,l=67108863&h,u=Math.min(d,t.length-1),f=Math.max(0,d-e.length+1);f<=u;f++){var p=d-f|0;c+=(n=(r=0|e.words[p])*(a=0|t.words[f])+l)/67108864|0,l=67108863&n}i.words[d]=0|l,h=0|c}return 0!==h?i.words[d]=0|h:i.length--,i.strip()}a.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var r=0,a=0,n=0;n<this.length;n++){var o=this.words[n],h=(16777215&(o<<r|a)).toString(16);i=0!==(a=o>>>24-r&16777215)||n!==this.length-1?c[6-h.length]+h+i:h+i,(r+=2)>=26&&(r-=26,n--)}for(0!==a&&(i=a.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var d=l[e],f=u[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:c[d-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}s(!1,"Base should be between 2 and 36")},a.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&s(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},a.prototype.toJSON=function(){return this.toString(16)},a.prototype.toBuffer=function(e,t){return s(void 0!==n),this.toArrayLike(n,e,t)},a.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},a.prototype.toArrayLike=function(e,t,i){var r=this.byteLength(),a=i||Math.max(1,r);s(r<=a,"byte array longer than desired length"),s(a>0,"Requested array length <= 0"),this.strip();var n,o,h="le"===t,d=new e(a),c=this.clone();if(h){for(o=0;!c.isZero();o++)n=c.andln(255),c.iushrn(8),d[o]=n;for(;o<a;o++)d[o]=0}else{for(o=0;o<a-r;o++)d[o]=0;for(o=0;!c.isZero();o++)n=c.andln(255),c.iushrn(8),d[a-o-1]=n}return d},Math.clz32?a.prototype._countBits=function(e){return 32-Math.clz32(e)}:a.prototype._countBits=function(e){var t=e,i=0;return t>=4096&&(i+=13,t>>>=13),t>=64&&(i+=7,t>>>=7),t>=8&&(i+=4,t>>>=4),t>=2&&(i+=2,t>>>=2),i+t},a.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,i=0;return 0==(8191&t)&&(i+=13,t>>>=13),0==(127&t)&&(i+=7,t>>>=7),0==(15&t)&&(i+=4,t>>>=4),0==(3&t)&&(i+=2,t>>>=2),0==(1&t)&&i++,i},a.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},a.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var i=this._zeroBits(this.words[t]);if(e+=i,26!==i)break}return e},a.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},a.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},a.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},a.prototype.isNeg=function(){return 0!==this.negative},a.prototype.neg=function(){return this.clone().ineg()},a.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},a.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},a.prototype.ior=function(e){return s(0==(this.negative|e.negative)),this.iuor(e)},a.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},a.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},a.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var i=0;i<t.length;i++)this.words[i]=this.words[i]&e.words[i];return this.length=t.length,this.strip()},a.prototype.iand=function(e){return s(0==(this.negative|e.negative)),this.iuand(e)},a.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},a.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},a.prototype.iuxor=function(e){var t,i;this.length>e.length?(t=this,i=e):(t=e,i=this);for(var s=0;s<i.length;s++)this.words[s]=t.words[s]^i.words[s];if(this!==t)for(;s<t.length;s++)this.words[s]=t.words[s];return this.length=t.length,this.strip()},a.prototype.ixor=function(e){return s(0==(this.negative|e.negative)),this.iuxor(e)},a.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},a.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},a.prototype.inotn=function(e){s("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var r=0;r<t;r++)this.words[r]=67108863&~this.words[r];return i>0&&(this.words[r]=~this.words[r]&67108863>>26-i),this.strip()},a.prototype.notn=function(e){return this.clone().inotn(e)},a.prototype.setn=function(e,t){s("number"==typeof e&&e>=0);var i=e/26|0,r=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<r:this.words[i]&~(1<<r),this.strip()},a.prototype.iadd=function(e){var t,i,s;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(i=this,s=e):(i=e,s=this);for(var r=0,a=0;a<s.length;a++)t=(0|i.words[a])+(0|s.words[a])+r,this.words[a]=67108863&t,r=t>>>26;for(;0!==r&&a<i.length;a++)t=(0|i.words[a])+r,this.words[a]=67108863&t,r=t>>>26;if(this.length=i.length,0!==r)this.words[this.length]=r,this.length++;else if(i!==this)for(;a<i.length;a++)this.words[a]=i.words[a];return this},a.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},a.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var i,s,r=this.cmp(e);if(0===r)return this.negative=0,this.length=1,this.words[0]=0,this;r>0?(i=this,s=e):(i=e,s=this);for(var a=0,n=0;n<s.length;n++)a=(t=(0|i.words[n])-(0|s.words[n])+a)>>26,this.words[n]=67108863&t;for(;0!==a&&n<i.length;n++)a=(t=(0|i.words[n])+a)>>26,this.words[n]=67108863&t;if(0===a&&n<i.length&&i!==this)for(;n<i.length;n++)this.words[n]=i.words[n];return this.length=Math.max(this.length,n),i!==this&&(this.negative=1),this.strip()},a.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,i){var s,r,a,n=e.words,o=t.words,h=i.words,d=0,c=0|n[0],l=8191&c,u=c>>>13,f=0|n[1],p=8191&f,m=f>>>13,g=0|n[2],y=8191&g,b=g>>>13,v=0|n[3],w=8191&v,S=v>>>13,k=0|n[4],T=8191&k,_=k>>>13,O=0|n[5],M=8191&O,I=O>>>13,x=0|n[6],C=8191&x,P=x>>>13,A=0|n[7],N=8191&A,B=A>>>13,E=0|n[8],V=8191&E,L=E>>>13,R=0|n[9],D=8191&R,F=R>>>13,q=0|o[0],G=8191&q,H=q>>>13,U=0|o[1],j=8191&U,W=U>>>13,z=0|o[2],K=8191&z,X=z>>>13,Z=0|o[3],Y=8191&Z,Q=Z>>>13,J=0|o[4],$=8191&J,ee=J>>>13,te=0|o[5],ie=8191&te,se=te>>>13,re=0|o[6],ae=8191&re,ne=re>>>13,oe=0|o[7],he=8191&oe,de=oe>>>13,ce=0|o[8],le=8191&ce,ue=ce>>>13,fe=0|o[9],pe=8191&fe,me=fe>>>13;i.negative=e.negative^t.negative,i.length=19;var ge=(d+(s=Math.imul(l,G))|0)+((8191&(r=(r=Math.imul(l,H))+Math.imul(u,G)|0))<<13)|0;d=((a=Math.imul(u,H))+(r>>>13)|0)+(ge>>>26)|0,ge&=67108863,s=Math.imul(p,G),r=(r=Math.imul(p,H))+Math.imul(m,G)|0,a=Math.imul(m,H);var ye=(d+(s=s+Math.imul(l,j)|0)|0)+((8191&(r=(r=r+Math.imul(l,W)|0)+Math.imul(u,j)|0))<<13)|0;d=((a=a+Math.imul(u,W)|0)+(r>>>13)|0)+(ye>>>26)|0,ye&=67108863,s=Math.imul(y,G),r=(r=Math.imul(y,H))+Math.imul(b,G)|0,a=Math.imul(b,H),s=s+Math.imul(p,j)|0,r=(r=r+Math.imul(p,W)|0)+Math.imul(m,j)|0,a=a+Math.imul(m,W)|0;var be=(d+(s=s+Math.imul(l,K)|0)|0)+((8191&(r=(r=r+Math.imul(l,X)|0)+Math.imul(u,K)|0))<<13)|0;d=((a=a+Math.imul(u,X)|0)+(r>>>13)|0)+(be>>>26)|0,be&=67108863,s=Math.imul(w,G),r=(r=Math.imul(w,H))+Math.imul(S,G)|0,a=Math.imul(S,H),s=s+Math.imul(y,j)|0,r=(r=r+Math.imul(y,W)|0)+Math.imul(b,j)|0,a=a+Math.imul(b,W)|0,s=s+Math.imul(p,K)|0,r=(r=r+Math.imul(p,X)|0)+Math.imul(m,K)|0,a=a+Math.imul(m,X)|0;var ve=(d+(s=s+Math.imul(l,Y)|0)|0)+((8191&(r=(r=r+Math.imul(l,Q)|0)+Math.imul(u,Y)|0))<<13)|0;d=((a=a+Math.imul(u,Q)|0)+(r>>>13)|0)+(ve>>>26)|0,ve&=67108863,s=Math.imul(T,G),r=(r=Math.imul(T,H))+Math.imul(_,G)|0,a=Math.imul(_,H),s=s+Math.imul(w,j)|0,r=(r=r+Math.imul(w,W)|0)+Math.imul(S,j)|0,a=a+Math.imul(S,W)|0,s=s+Math.imul(y,K)|0,r=(r=r+Math.imul(y,X)|0)+Math.imul(b,K)|0,a=a+Math.imul(b,X)|0,s=s+Math.imul(p,Y)|0,r=(r=r+Math.imul(p,Q)|0)+Math.imul(m,Y)|0,a=a+Math.imul(m,Q)|0;var we=(d+(s=s+Math.imul(l,$)|0)|0)+((8191&(r=(r=r+Math.imul(l,ee)|0)+Math.imul(u,$)|0))<<13)|0;d=((a=a+Math.imul(u,ee)|0)+(r>>>13)|0)+(we>>>26)|0,we&=67108863,s=Math.imul(M,G),r=(r=Math.imul(M,H))+Math.imul(I,G)|0,a=Math.imul(I,H),s=s+Math.imul(T,j)|0,r=(r=r+Math.imul(T,W)|0)+Math.imul(_,j)|0,a=a+Math.imul(_,W)|0,s=s+Math.imul(w,K)|0,r=(r=r+Math.imul(w,X)|0)+Math.imul(S,K)|0,a=a+Math.imul(S,X)|0,s=s+Math.imul(y,Y)|0,r=(r=r+Math.imul(y,Q)|0)+Math.imul(b,Y)|0,a=a+Math.imul(b,Q)|0,s=s+Math.imul(p,$)|0,r=(r=r+Math.imul(p,ee)|0)+Math.imul(m,$)|0,a=a+Math.imul(m,ee)|0;var Se=(d+(s=s+Math.imul(l,ie)|0)|0)+((8191&(r=(r=r+Math.imul(l,se)|0)+Math.imul(u,ie)|0))<<13)|0;d=((a=a+Math.imul(u,se)|0)+(r>>>13)|0)+(Se>>>26)|0,Se&=67108863,s=Math.imul(C,G),r=(r=Math.imul(C,H))+Math.imul(P,G)|0,a=Math.imul(P,H),s=s+Math.imul(M,j)|0,r=(r=r+Math.imul(M,W)|0)+Math.imul(I,j)|0,a=a+Math.imul(I,W)|0,s=s+Math.imul(T,K)|0,r=(r=r+Math.imul(T,X)|0)+Math.imul(_,K)|0,a=a+Math.imul(_,X)|0,s=s+Math.imul(w,Y)|0,r=(r=r+Math.imul(w,Q)|0)+Math.imul(S,Y)|0,a=a+Math.imul(S,Q)|0,s=s+Math.imul(y,$)|0,r=(r=r+Math.imul(y,ee)|0)+Math.imul(b,$)|0,a=a+Math.imul(b,ee)|0,s=s+Math.imul(p,ie)|0,r=(r=r+Math.imul(p,se)|0)+Math.imul(m,ie)|0,a=a+Math.imul(m,se)|0;var ke=(d+(s=s+Math.imul(l,ae)|0)|0)+((8191&(r=(r=r+Math.imul(l,ne)|0)+Math.imul(u,ae)|0))<<13)|0;d=((a=a+Math.imul(u,ne)|0)+(r>>>13)|0)+(ke>>>26)|0,ke&=67108863,s=Math.imul(N,G),r=(r=Math.imul(N,H))+Math.imul(B,G)|0,a=Math.imul(B,H),s=s+Math.imul(C,j)|0,r=(r=r+Math.imul(C,W)|0)+Math.imul(P,j)|0,a=a+Math.imul(P,W)|0,s=s+Math.imul(M,K)|0,r=(r=r+Math.imul(M,X)|0)+Math.imul(I,K)|0,a=a+Math.imul(I,X)|0,s=s+Math.imul(T,Y)|0,r=(r=r+Math.imul(T,Q)|0)+Math.imul(_,Y)|0,a=a+Math.imul(_,Q)|0,s=s+Math.imul(w,$)|0,r=(r=r+Math.imul(w,ee)|0)+Math.imul(S,$)|0,a=a+Math.imul(S,ee)|0,s=s+Math.imul(y,ie)|0,r=(r=r+Math.imul(y,se)|0)+Math.imul(b,ie)|0,a=a+Math.imul(b,se)|0,s=s+Math.imul(p,ae)|0,r=(r=r+Math.imul(p,ne)|0)+Math.imul(m,ae)|0,a=a+Math.imul(m,ne)|0;var Te=(d+(s=s+Math.imul(l,he)|0)|0)+((8191&(r=(r=r+Math.imul(l,de)|0)+Math.imul(u,he)|0))<<13)|0;d=((a=a+Math.imul(u,de)|0)+(r>>>13)|0)+(Te>>>26)|0,Te&=67108863,s=Math.imul(V,G),r=(r=Math.imul(V,H))+Math.imul(L,G)|0,a=Math.imul(L,H),s=s+Math.imul(N,j)|0,r=(r=r+Math.imul(N,W)|0)+Math.imul(B,j)|0,a=a+Math.imul(B,W)|0,s=s+Math.imul(C,K)|0,r=(r=r+Math.imul(C,X)|0)+Math.imul(P,K)|0,a=a+Math.imul(P,X)|0,s=s+Math.imul(M,Y)|0,r=(r=r+Math.imul(M,Q)|0)+Math.imul(I,Y)|0,a=a+Math.imul(I,Q)|0,s=s+Math.imul(T,$)|0,r=(r=r+Math.imul(T,ee)|0)+Math.imul(_,$)|0,a=a+Math.imul(_,ee)|0,s=s+Math.imul(w,ie)|0,r=(r=r+Math.imul(w,se)|0)+Math.imul(S,ie)|0,a=a+Math.imul(S,se)|0,s=s+Math.imul(y,ae)|0,r=(r=r+Math.imul(y,ne)|0)+Math.imul(b,ae)|0,a=a+Math.imul(b,ne)|0,s=s+Math.imul(p,he)|0,r=(r=r+Math.imul(p,de)|0)+Math.imul(m,he)|0,a=a+Math.imul(m,de)|0;var _e=(d+(s=s+Math.imul(l,le)|0)|0)+((8191&(r=(r=r+Math.imul(l,ue)|0)+Math.imul(u,le)|0))<<13)|0;d=((a=a+Math.imul(u,ue)|0)+(r>>>13)|0)+(_e>>>26)|0,_e&=67108863,s=Math.imul(D,G),r=(r=Math.imul(D,H))+Math.imul(F,G)|0,a=Math.imul(F,H),s=s+Math.imul(V,j)|0,r=(r=r+Math.imul(V,W)|0)+Math.imul(L,j)|0,a=a+Math.imul(L,W)|0,s=s+Math.imul(N,K)|0,r=(r=r+Math.imul(N,X)|0)+Math.imul(B,K)|0,a=a+Math.imul(B,X)|0,s=s+Math.imul(C,Y)|0,r=(r=r+Math.imul(C,Q)|0)+Math.imul(P,Y)|0,a=a+Math.imul(P,Q)|0,s=s+Math.imul(M,$)|0,r=(r=r+Math.imul(M,ee)|0)+Math.imul(I,$)|0,a=a+Math.imul(I,ee)|0,s=s+Math.imul(T,ie)|0,r=(r=r+Math.imul(T,se)|0)+Math.imul(_,ie)|0,a=a+Math.imul(_,se)|0,s=s+Math.imul(w,ae)|0,r=(r=r+Math.imul(w,ne)|0)+Math.imul(S,ae)|0,a=a+Math.imul(S,ne)|0,s=s+Math.imul(y,he)|0,r=(r=r+Math.imul(y,de)|0)+Math.imul(b,he)|0,a=a+Math.imul(b,de)|0,s=s+Math.imul(p,le)|0,r=(r=r+Math.imul(p,ue)|0)+Math.imul(m,le)|0,a=a+Math.imul(m,ue)|0;var Oe=(d+(s=s+Math.imul(l,pe)|0)|0)+((8191&(r=(r=r+Math.imul(l,me)|0)+Math.imul(u,pe)|0))<<13)|0;d=((a=a+Math.imul(u,me)|0)+(r>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,s=Math.imul(D,j),r=(r=Math.imul(D,W))+Math.imul(F,j)|0,a=Math.imul(F,W),s=s+Math.imul(V,K)|0,r=(r=r+Math.imul(V,X)|0)+Math.imul(L,K)|0,a=a+Math.imul(L,X)|0,s=s+Math.imul(N,Y)|0,r=(r=r+Math.imul(N,Q)|0)+Math.imul(B,Y)|0,a=a+Math.imul(B,Q)|0,s=s+Math.imul(C,$)|0,r=(r=r+Math.imul(C,ee)|0)+Math.imul(P,$)|0,a=a+Math.imul(P,ee)|0,s=s+Math.imul(M,ie)|0,r=(r=r+Math.imul(M,se)|0)+Math.imul(I,ie)|0,a=a+Math.imul(I,se)|0,s=s+Math.imul(T,ae)|0,r=(r=r+Math.imul(T,ne)|0)+Math.imul(_,ae)|0,a=a+Math.imul(_,ne)|0,s=s+Math.imul(w,he)|0,r=(r=r+Math.imul(w,de)|0)+Math.imul(S,he)|0,a=a+Math.imul(S,de)|0,s=s+Math.imul(y,le)|0,r=(r=r+Math.imul(y,ue)|0)+Math.imul(b,le)|0,a=a+Math.imul(b,ue)|0;var Me=(d+(s=s+Math.imul(p,pe)|0)|0)+((8191&(r=(r=r+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;d=((a=a+Math.imul(m,me)|0)+(r>>>13)|0)+(Me>>>26)|0,Me&=67108863,s=Math.imul(D,K),r=(r=Math.imul(D,X))+Math.imul(F,K)|0,a=Math.imul(F,X),s=s+Math.imul(V,Y)|0,r=(r=r+Math.imul(V,Q)|0)+Math.imul(L,Y)|0,a=a+Math.imul(L,Q)|0,s=s+Math.imul(N,$)|0,r=(r=r+Math.imul(N,ee)|0)+Math.imul(B,$)|0,a=a+Math.imul(B,ee)|0,s=s+Math.imul(C,ie)|0,r=(r=r+Math.imul(C,se)|0)+Math.imul(P,ie)|0,a=a+Math.imul(P,se)|0,s=s+Math.imul(M,ae)|0,r=(r=r+Math.imul(M,ne)|0)+Math.imul(I,ae)|0,a=a+Math.imul(I,ne)|0,s=s+Math.imul(T,he)|0,r=(r=r+Math.imul(T,de)|0)+Math.imul(_,he)|0,a=a+Math.imul(_,de)|0,s=s+Math.imul(w,le)|0,r=(r=r+Math.imul(w,ue)|0)+Math.imul(S,le)|0,a=a+Math.imul(S,ue)|0;var Ie=(d+(s=s+Math.imul(y,pe)|0)|0)+((8191&(r=(r=r+Math.imul(y,me)|0)+Math.imul(b,pe)|0))<<13)|0;d=((a=a+Math.imul(b,me)|0)+(r>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,s=Math.imul(D,Y),r=(r=Math.imul(D,Q))+Math.imul(F,Y)|0,a=Math.imul(F,Q),s=s+Math.imul(V,$)|0,r=(r=r+Math.imul(V,ee)|0)+Math.imul(L,$)|0,a=a+Math.imul(L,ee)|0,s=s+Math.imul(N,ie)|0,r=(r=r+Math.imul(N,se)|0)+Math.imul(B,ie)|0,a=a+Math.imul(B,se)|0,s=s+Math.imul(C,ae)|0,r=(r=r+Math.imul(C,ne)|0)+Math.imul(P,ae)|0,a=a+Math.imul(P,ne)|0,s=s+Math.imul(M,he)|0,r=(r=r+Math.imul(M,de)|0)+Math.imul(I,he)|0,a=a+Math.imul(I,de)|0,s=s+Math.imul(T,le)|0,r=(r=r+Math.imul(T,ue)|0)+Math.imul(_,le)|0,a=a+Math.imul(_,ue)|0;var xe=(d+(s=s+Math.imul(w,pe)|0)|0)+((8191&(r=(r=r+Math.imul(w,me)|0)+Math.imul(S,pe)|0))<<13)|0;d=((a=a+Math.imul(S,me)|0)+(r>>>13)|0)+(xe>>>26)|0,xe&=67108863,s=Math.imul(D,$),r=(r=Math.imul(D,ee))+Math.imul(F,$)|0,a=Math.imul(F,ee),s=s+Math.imul(V,ie)|0,r=(r=r+Math.imul(V,se)|0)+Math.imul(L,ie)|0,a=a+Math.imul(L,se)|0,s=s+Math.imul(N,ae)|0,r=(r=r+Math.imul(N,ne)|0)+Math.imul(B,ae)|0,a=a+Math.imul(B,ne)|0,s=s+Math.imul(C,he)|0,r=(r=r+Math.imul(C,de)|0)+Math.imul(P,he)|0,a=a+Math.imul(P,de)|0,s=s+Math.imul(M,le)|0,r=(r=r+Math.imul(M,ue)|0)+Math.imul(I,le)|0,a=a+Math.imul(I,ue)|0;var Ce=(d+(s=s+Math.imul(T,pe)|0)|0)+((8191&(r=(r=r+Math.imul(T,me)|0)+Math.imul(_,pe)|0))<<13)|0;d=((a=a+Math.imul(_,me)|0)+(r>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,s=Math.imul(D,ie),r=(r=Math.imul(D,se))+Math.imul(F,ie)|0,a=Math.imul(F,se),s=s+Math.imul(V,ae)|0,r=(r=r+Math.imul(V,ne)|0)+Math.imul(L,ae)|0,a=a+Math.imul(L,ne)|0,s=s+Math.imul(N,he)|0,r=(r=r+Math.imul(N,de)|0)+Math.imul(B,he)|0,a=a+Math.imul(B,de)|0,s=s+Math.imul(C,le)|0,r=(r=r+Math.imul(C,ue)|0)+Math.imul(P,le)|0,a=a+Math.imul(P,ue)|0;var Pe=(d+(s=s+Math.imul(M,pe)|0)|0)+((8191&(r=(r=r+Math.imul(M,me)|0)+Math.imul(I,pe)|0))<<13)|0;d=((a=a+Math.imul(I,me)|0)+(r>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,s=Math.imul(D,ae),r=(r=Math.imul(D,ne))+Math.imul(F,ae)|0,a=Math.imul(F,ne),s=s+Math.imul(V,he)|0,r=(r=r+Math.imul(V,de)|0)+Math.imul(L,he)|0,a=a+Math.imul(L,de)|0,s=s+Math.imul(N,le)|0,r=(r=r+Math.imul(N,ue)|0)+Math.imul(B,le)|0,a=a+Math.imul(B,ue)|0;var Ae=(d+(s=s+Math.imul(C,pe)|0)|0)+((8191&(r=(r=r+Math.imul(C,me)|0)+Math.imul(P,pe)|0))<<13)|0;d=((a=a+Math.imul(P,me)|0)+(r>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,s=Math.imul(D,he),r=(r=Math.imul(D,de))+Math.imul(F,he)|0,a=Math.imul(F,de),s=s+Math.imul(V,le)|0,r=(r=r+Math.imul(V,ue)|0)+Math.imul(L,le)|0,a=a+Math.imul(L,ue)|0;var Ne=(d+(s=s+Math.imul(N,pe)|0)|0)+((8191&(r=(r=r+Math.imul(N,me)|0)+Math.imul(B,pe)|0))<<13)|0;d=((a=a+Math.imul(B,me)|0)+(r>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,s=Math.imul(D,le),r=(r=Math.imul(D,ue))+Math.imul(F,le)|0,a=Math.imul(F,ue);var Be=(d+(s=s+Math.imul(V,pe)|0)|0)+((8191&(r=(r=r+Math.imul(V,me)|0)+Math.imul(L,pe)|0))<<13)|0;d=((a=a+Math.imul(L,me)|0)+(r>>>13)|0)+(Be>>>26)|0,Be&=67108863;var Ee=(d+(s=Math.imul(D,pe))|0)+((8191&(r=(r=Math.imul(D,me))+Math.imul(F,pe)|0))<<13)|0;return d=((a=Math.imul(F,me))+(r>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,h[0]=ge,h[1]=ye,h[2]=be,h[3]=ve,h[4]=we,h[5]=Se,h[6]=ke,h[7]=Te,h[8]=_e,h[9]=Oe,h[10]=Me,h[11]=Ie,h[12]=xe,h[13]=Ce,h[14]=Pe,h[15]=Ae,h[16]=Ne,h[17]=Be,h[18]=Ee,0!==d&&(h[19]=d,i.length++),i};function m(e,t,i){return(new g).mulp(e,t,i)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=f),a.prototype.mulTo=function(e,t){var i,s=this.length+e.length;return i=10===this.length&&10===e.length?p(this,e,t):s<63?f(this,e,t):s<1024?function(e,t,i){i.negative=t.negative^e.negative,i.length=e.length+t.length;for(var s=0,r=0,a=0;a<i.length-1;a++){var n=r;r=0;for(var o=67108863&s,h=Math.min(a,t.length-1),d=Math.max(0,a-e.length+1);d<=h;d++){var c=a-d,l=(0|e.words[c])*(0|t.words[d]),u=67108863&l;o=67108863&(u=u+o|0),r+=(n=(n=n+(l/67108864|0)|0)+(u>>>26)|0)>>>26,n&=67108863}i.words[a]=o,s=n,n=r}return 0!==s?i.words[a]=s:i.length--,i.strip()}(this,e,t):m(this,e,t),i},g.prototype.makeRBT=function(e){for(var t=new Array(e),i=a.prototype._countBits(e)-1,s=0;s<e;s++)t[s]=this.revBin(s,i,e);return t},g.prototype.revBin=function(e,t,i){if(0===e||e===i-1)return e;for(var s=0,r=0;r<t;r++)s|=(1&e)<<t-r-1,e>>=1;return s},g.prototype.permute=function(e,t,i,s,r,a){for(var n=0;n<a;n++)s[n]=t[e[n]],r[n]=i[e[n]]},g.prototype.transform=function(e,t,i,s,r,a){this.permute(a,e,t,i,s,r);for(var n=1;n<r;n<<=1)for(var o=n<<1,h=Math.cos(2*Math.PI/o),d=Math.sin(2*Math.PI/o),c=0;c<r;c+=o)for(var l=h,u=d,f=0;f<n;f++){var p=i[c+f],m=s[c+f],g=i[c+f+n],y=s[c+f+n],b=l*g-u*y;y=l*y+u*g,g=b,i[c+f]=p+g,s[c+f]=m+y,i[c+f+n]=p-g,s[c+f+n]=m-y,f!==o&&(b=h*l-d*u,u=h*u+d*l,l=b)}},g.prototype.guessLen13b=function(e,t){var i=1|Math.max(t,e),s=1&i,r=0;for(i=i/2|0;i;i>>>=1)r++;return 1<<r+1+s},g.prototype.conjugate=function(e,t,i){if(!(i<=1))for(var s=0;s<i/2;s++){var r=e[s];e[s]=e[i-s-1],e[i-s-1]=r,r=t[s],t[s]=-t[i-s-1],t[i-s-1]=-r}},g.prototype.normalize13b=function(e,t){for(var i=0,s=0;s<t/2;s++){var r=8192*Math.round(e[2*s+1]/t)+Math.round(e[2*s]/t)+i;e[s]=67108863&r,i=r<67108864?0:r/67108864|0}return e},g.prototype.convert13b=function(e,t,i,r){for(var a=0,n=0;n<t;n++)a+=0|e[n],i[2*n]=8191&a,a>>>=13,i[2*n+1]=8191&a,a>>>=13;for(n=2*t;n<r;++n)i[n]=0;s(0===a),s(0==(-8192&a))},g.prototype.stub=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=0;return t},g.prototype.mulp=function(e,t,i){var s=2*this.guessLen13b(e.length,t.length),r=this.makeRBT(s),a=this.stub(s),n=new Array(s),o=new Array(s),h=new Array(s),d=new Array(s),c=new Array(s),l=new Array(s),u=i.words;u.length=s,this.convert13b(e.words,e.length,n,s),this.convert13b(t.words,t.length,d,s),this.transform(n,a,o,h,s,r),this.transform(d,a,c,l,s,r);for(var f=0;f<s;f++){var p=o[f]*c[f]-h[f]*l[f];h[f]=o[f]*l[f]+h[f]*c[f],o[f]=p}return this.conjugate(o,h,s),this.transform(o,h,u,a,s,r),this.conjugate(u,a,s),this.normalize13b(u,s),i.negative=e.negative^t.negative,i.length=e.length+t.length,i.strip()},a.prototype.mul=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},a.prototype.mulf=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),m(this,e,t)},a.prototype.imul=function(e){return this.clone().mulTo(e,this)},a.prototype.imuln=function(e){s("number"==typeof e),s(e<67108864);for(var t=0,i=0;i<this.length;i++){var r=(0|this.words[i])*e,a=(67108863&r)+(67108863&t);t>>=26,t+=r/67108864|0,t+=a>>>26,this.words[i]=67108863&a}return 0!==t&&(this.words[i]=t,this.length++),this},a.prototype.muln=function(e){return this.clone().imuln(e)},a.prototype.sqr=function(){return this.mul(this)},a.prototype.isqr=function(){return this.imul(this.clone())},a.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),i=0;i<t.length;i++){var s=i/26|0,r=i%26;t[i]=(e.words[s]&1<<r)>>>r}return t}(e);if(0===t.length)return new a(1);for(var i=this,s=0;s<t.length&&0===t[s];s++,i=i.sqr());if(++s<t.length)for(var r=i.sqr();s<t.length;s++,r=r.sqr())0!==t[s]&&(i=i.mul(r));return i},a.prototype.iushln=function(e){s("number"==typeof e&&e>=0);var t,i=e%26,r=(e-i)/26,a=67108863>>>26-i<<26-i;if(0!==i){var n=0;for(t=0;t<this.length;t++){var o=this.words[t]&a,h=(0|this.words[t])-o<<i;this.words[t]=h|n,n=o>>>26-i}n&&(this.words[t]=n,this.length++)}if(0!==r){for(t=this.length-1;t>=0;t--)this.words[t+r]=this.words[t];for(t=0;t<r;t++)this.words[t]=0;this.length+=r}return this.strip()},a.prototype.ishln=function(e){return s(0===this.negative),this.iushln(e)},a.prototype.iushrn=function(e,t,i){var r;s("number"==typeof e&&e>=0),r=t?(t-t%26)/26:0;var a=e%26,n=Math.min((e-a)/26,this.length),o=67108863^67108863>>>a<<a,h=i;if(r-=n,r=Math.max(0,r),h){for(var d=0;d<n;d++)h.words[d]=this.words[d];h.length=n}if(0===n);else if(this.length>n)for(this.length-=n,d=0;d<this.length;d++)this.words[d]=this.words[d+n];else this.words[0]=0,this.length=1;var c=0;for(d=this.length-1;d>=0&&(0!==c||d>=r);d--){var l=0|this.words[d];this.words[d]=c<<26-a|l>>>a,c=l&o}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},a.prototype.ishrn=function(e,t,i){return s(0===this.negative),this.iushrn(e,t,i)},a.prototype.shln=function(e){return this.clone().ishln(e)},a.prototype.ushln=function(e){return this.clone().iushln(e)},a.prototype.shrn=function(e){return this.clone().ishrn(e)},a.prototype.ushrn=function(e){return this.clone().iushrn(e)},a.prototype.testn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,r=1<<t;return!(this.length<=i)&&!!(this.words[i]&r)},a.prototype.imaskn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(s(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var r=67108863^67108863>>>t<<t;this.words[this.length-1]&=r}return this.strip()},a.prototype.maskn=function(e){return this.clone().imaskn(e)},a.prototype.iaddn=function(e){return s("number"==typeof e),s(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},a.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},a.prototype.isubn=function(e){if(s("number"==typeof e),s(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},a.prototype.addn=function(e){return this.clone().iaddn(e)},a.prototype.subn=function(e){return this.clone().isubn(e)},a.prototype.iabs=function(){return this.negative=0,this},a.prototype.abs=function(){return this.clone().iabs()},a.prototype._ishlnsubmul=function(e,t,i){var r,a,n=e.length+i;this._expand(n);var o=0;for(r=0;r<e.length;r++){a=(0|this.words[r+i])+o;var h=(0|e.words[r])*t;o=((a-=67108863&h)>>26)-(h/67108864|0),this.words[r+i]=67108863&a}for(;r<this.length-i;r++)o=(a=(0|this.words[r+i])+o)>>26,this.words[r+i]=67108863&a;if(0===o)return this.strip();for(s(-1===o),o=0,r=0;r<this.length;r++)o=(a=-(0|this.words[r])+o)>>26,this.words[r]=67108863&a;return this.negative=1,this.strip()},a.prototype._wordDiv=function(e,t){var i=(this.length,e.length),s=this.clone(),r=e,n=0|r.words[r.length-1];0!==(i=26-this._countBits(n))&&(r=r.ushln(i),s.iushln(i),n=0|r.words[r.length-1]);var o,h=s.length-r.length;if("mod"!==t){(o=new a(null)).length=h+1,o.words=new Array(o.length);for(var d=0;d<o.length;d++)o.words[d]=0}var c=s.clone()._ishlnsubmul(r,1,h);0===c.negative&&(s=c,o&&(o.words[h]=1));for(var l=h-1;l>=0;l--){var u=67108864*(0|s.words[r.length+l])+(0|s.words[r.length+l-1]);for(u=Math.min(u/n|0,67108863),s._ishlnsubmul(r,u,l);0!==s.negative;)u--,s.negative=0,s._ishlnsubmul(r,1,l),s.isZero()||(s.negative^=1);o&&(o.words[l]=u)}return o&&o.strip(),s.strip(),"div"!==t&&0!==i&&s.iushrn(i),{div:o||null,mod:s}},a.prototype.divmod=function(e,t,i){return s(!e.isZero()),this.isZero()?{div:new a(0),mod:new a(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(r=o.div.neg()),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.iadd(e)),{div:r,mod:n}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(r=o.div.neg()),{div:r,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.isub(e)),{div:o.div,mod:n}):e.length>this.length||this.cmp(e)<0?{div:new a(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new a(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new a(this.modn(e.words[0]))}:this._wordDiv(e,t);var r,n,o},a.prototype.div=function(e){return this.divmod(e,"div",!1).div},a.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},a.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},a.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var i=0!==t.div.negative?t.mod.isub(e):t.mod,s=e.ushrn(1),r=e.andln(1),a=i.cmp(s);return a<0||1===r&&0===a?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},a.prototype.modn=function(e){s(e<=67108863);for(var t=(1<<26)%e,i=0,r=this.length-1;r>=0;r--)i=(t*i+(0|this.words[r]))%e;return i},a.prototype.idivn=function(e){s(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var r=(0|this.words[i])+67108864*t;this.words[i]=r/e|0,t=r%e}return this.strip()},a.prototype.divn=function(e){return this.clone().idivn(e)},a.prototype.egcd=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r=new a(1),n=new a(0),o=new a(0),h=new a(1),d=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++d;for(var c=i.clone(),l=t.clone();!t.isZero();){for(var u=0,f=1;0==(t.words[0]&f)&&u<26;++u,f<<=1);if(u>0)for(t.iushrn(u);u-- >0;)(r.isOdd()||n.isOdd())&&(r.iadd(c),n.isub(l)),r.iushrn(1),n.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(o.isOdd()||h.isOdd())&&(o.iadd(c),h.isub(l)),o.iushrn(1),h.iushrn(1);t.cmp(i)>=0?(t.isub(i),r.isub(o),n.isub(h)):(i.isub(t),o.isub(r),h.isub(n))}return{a:o,b:h,gcd:i.iushln(d)}},a.prototype._invmp=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r,n=new a(1),o=new a(0),h=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var d=0,c=1;0==(t.words[0]&c)&&d<26;++d,c<<=1);if(d>0)for(t.iushrn(d);d-- >0;)n.isOdd()&&n.iadd(h),n.iushrn(1);for(var l=0,u=1;0==(i.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(i.iushrn(l);l-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(o)):(i.isub(t),o.isub(n))}return(r=0===t.cmpn(1)?n:o).cmpn(0)<0&&r.iadd(e),r},a.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),i=e.clone();t.negative=0,i.negative=0;for(var s=0;t.isEven()&&i.isEven();s++)t.iushrn(1),i.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;i.isEven();)i.iushrn(1);var r=t.cmp(i);if(r<0){var a=t;t=i,i=a}else if(0===r||0===i.cmpn(1))break;t.isub(i)}return i.iushln(s)},a.prototype.invm=function(e){return this.egcd(e).a.umod(e)},a.prototype.isEven=function(){return 0==(1&this.words[0])},a.prototype.isOdd=function(){return 1==(1&this.words[0])},a.prototype.andln=function(e){return this.words[0]&e},a.prototype.bincn=function(e){s("number"==typeof e);var t=e%26,i=(e-t)/26,r=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=r,this;for(var a=r,n=i;0!==a&&n<this.length;n++){var o=0|this.words[n];a=(o+=a)>>>26,o&=67108863,this.words[n]=o}return 0!==a&&(this.words[n]=a,this.length++),this},a.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},a.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)t=1;else{i&&(e=-e),s(e<=67108863,"Number is too big");var r=0|this.words[0];t=r===e?0:r<e?-1:1}return 0!==this.negative?0|-t:t},a.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},a.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,i=this.length-1;i>=0;i--){var s=0|this.words[i],r=0|e.words[i];if(s!==r){s<r?t=-1:s>r&&(t=1);break}}return t},a.prototype.gtn=function(e){return 1===this.cmpn(e)},a.prototype.gt=function(e){return 1===this.cmp(e)},a.prototype.gten=function(e){return this.cmpn(e)>=0},a.prototype.gte=function(e){return this.cmp(e)>=0},a.prototype.ltn=function(e){return-1===this.cmpn(e)},a.prototype.lt=function(e){return-1===this.cmp(e)},a.prototype.lten=function(e){return this.cmpn(e)<=0},a.prototype.lte=function(e){return this.cmp(e)<=0},a.prototype.eqn=function(e){return 0===this.cmpn(e)},a.prototype.eq=function(e){return 0===this.cmp(e)},a.red=function(e){return new T(e)},a.prototype.toRed=function(e){return s(!this.red,"Already a number in reduction context"),s(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},a.prototype.fromRed=function(){return s(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},a.prototype._forceRed=function(e){return this.red=e,this},a.prototype.forceRed=function(e){return s(!this.red,"Already a number in reduction context"),this._forceRed(e)},a.prototype.redAdd=function(e){return s(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},a.prototype.redIAdd=function(e){return s(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},a.prototype.redSub=function(e){return s(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},a.prototype.redISub=function(e){return s(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},a.prototype.redShl=function(e){return s(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},a.prototype.redMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},a.prototype.redIMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},a.prototype.redSqr=function(){return s(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},a.prototype.redISqr=function(){return s(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},a.prototype.redSqrt=function(){return s(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},a.prototype.redInvm=function(){return s(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},a.prototype.redNeg=function(){return s(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},a.prototype.redPow=function(e){return s(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var y={k256:null,p224:null,p192:null,p25519:null};function b(e,t){this.name=e,this.p=new a(t,16),this.n=this.p.bitLength(),this.k=new a(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){b.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){b.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function S(){b.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function k(){b.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function T(e){if("string"==typeof e){var t=a._prime(e);this.m=t.p,this.prime=t}else s(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function _(e){T.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new a(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}b.prototype._tmp=function(){var e=new a(null);return e.words=new Array(Math.ceil(this.n/13)),e},b.prototype.ireduce=function(e){var t,i=e;do{this.split(i,this.tmp),t=(i=(i=this.imulK(i)).iadd(this.tmp)).bitLength()}while(t>this.n);var s=t<this.n?-1:i.ucmp(this.p);return 0===s?(i.words[0]=0,i.length=1):s>0?i.isub(this.p):void 0!==i.strip?i.strip():i._strip(),i},b.prototype.split=function(e,t){e.iushrn(this.n,0,t)},b.prototype.imulK=function(e){return e.imul(this.k)},r(v,b),v.prototype.split=function(e,t){for(var i=4194303,s=Math.min(e.length,9),r=0;r<s;r++)t.words[r]=e.words[r];if(t.length=s,e.length<=9)return e.words[0]=0,void(e.length=1);var a=e.words[9];for(t.words[t.length++]=a&i,r=10;r<e.length;r++){var n=0|e.words[r];e.words[r-10]=(n&i)<<4|a>>>22,a=n}a>>>=22,e.words[r-10]=a,0===a&&e.length>10?e.length-=10:e.length-=9},v.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,i=0;i<e.length;i++){var s=0|e.words[i];t+=977*s,e.words[i]=67108863&t,t=64*s+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},r(w,b),r(S,b),r(k,b),k.prototype.imulK=function(e){for(var t=0,i=0;i<e.length;i++){var s=19*(0|e.words[i])+t,r=67108863&s;s>>>=26,e.words[i]=r,t=s}return 0!==t&&(e.words[e.length++]=t),e},a._prime=function(e){if(y[e])return y[e];var t;if("k256"===e)t=new v;else if("p224"===e)t=new w;else if("p192"===e)t=new S;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new k}return y[e]=t,t},T.prototype._verify1=function(e){s(0===e.negative,"red works only with positives"),s(e.red,"red works only with red numbers")},T.prototype._verify2=function(e,t){s(0==(e.negative|t.negative),"red works only with positives"),s(e.red&&e.red===t.red,"red works only with red numbers")},T.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},T.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},T.prototype.add=function(e,t){this._verify2(e,t);var i=e.add(t);return i.cmp(this.m)>=0&&i.isub(this.m),i._forceRed(this)},T.prototype.iadd=function(e,t){this._verify2(e,t);var i=e.iadd(t);return i.cmp(this.m)>=0&&i.isub(this.m),i},T.prototype.sub=function(e,t){this._verify2(e,t);var i=e.sub(t);return i.cmpn(0)<0&&i.iadd(this.m),i._forceRed(this)},T.prototype.isub=function(e,t){this._verify2(e,t);var i=e.isub(t);return i.cmpn(0)<0&&i.iadd(this.m),i},T.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},T.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},T.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},T.prototype.isqr=function(e){return this.imul(e,e.clone())},T.prototype.sqr=function(e){return this.mul(e,e)},T.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(s(t%2==1),3===t){var i=this.m.add(new a(1)).iushrn(2);return this.pow(e,i)}for(var r=this.m.subn(1),n=0;!r.isZero()&&0===r.andln(1);)n++,r.iushrn(1);s(!r.isZero());var o=new a(1).toRed(this),h=o.redNeg(),d=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new a(2*c*c).toRed(this);0!==this.pow(c,d).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,r),u=this.pow(e,r.addn(1).iushrn(1)),f=this.pow(e,r),p=n;0!==f.cmp(o);){for(var m=f,g=0;0!==m.cmp(o);g++)m=m.redSqr();s(g<p);var y=this.pow(l,new a(1).iushln(p-g-1));u=u.redMul(y),l=y.redSqr(),f=f.redMul(l),p=g}return u},T.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},T.prototype.pow=function(e,t){if(t.isZero())return new a(1).toRed(this);if(0===t.cmpn(1))return e.clone();var i=new Array(16);i[0]=new a(1).toRed(this),i[1]=e;for(var s=2;s<i.length;s++)i[s]=this.mul(i[s-1],e);var r=i[0],n=0,o=0,h=t.bitLength()%26;for(0===h&&(h=26),s=t.length-1;s>=0;s--){for(var d=t.words[s],c=h-1;c>=0;c--){var l=d>>c&1;r!==i[0]&&(r=this.sqr(r)),0!==l||0!==n?(n<<=1,n|=l,(4===++o||0===s&&0===c)&&(r=this.mul(r,i[n]),o=0,n=0)):o=0}h=26}return r},T.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},T.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},a.mont=function(e){return new _(e)},r(_,T),_.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},_.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},_.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var i=e.imul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),a=r;return r.cmp(this.m)>=0?a=r.isub(this.m):r.cmpn(0)<0&&(a=r.iadd(this.m)),a._forceRed(this)},_.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new a(0)._forceRed(this);var i=e.mul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),n=r;return r.cmp(this.m)>=0?n=r.isub(this.m):r.cmpn(0)<0&&(n=r.iadd(this.m)),n._forceRed(this)},_.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=i.nmd(e),this)},23482:function(e,t,i){"use strict";var s=i(35717),r=i(62318),a=i(79785),n=i(89072),o=i(71027);function h(e){o.call(this,"digest"),this._hash=e}s(h,o),h.prototype._update=function(e){this._hash.update(e)},h.prototype._final=function(){return this._hash.digest()},e.exports=function(e){return"md5"===(e=e.toLowerCase())?new r:"rmd160"===e||"ripemd160"===e?new a:new h(n(e))}},78028:function(e,t,i){var s=i(62318);e.exports=function(e){return(new s).update(e).digest()}},58355:function(e,t,i){"use strict";var s=i(35717),r=i(51031),a=i(71027),n=i(89509).Buffer,o=i(78028),h=i(79785),d=i(89072),c=n.alloc(128);function l(e,t){a.call(this,"digest"),"string"==typeof t&&(t=n.from(t));var i="sha512"===e||"sha384"===e?128:64;(this._alg=e,this._key=t,t.length>i)?t=("rmd160"===e?new h:d(e)).update(t).digest():t.length<i&&(t=n.concat([t,c],i));for(var s=this._ipad=n.allocUnsafe(i),r=this._opad=n.allocUnsafe(i),o=0;o<i;o++)s[o]=54^t[o],r[o]=92^t[o];this._hash="rmd160"===e?new h:d(e),this._hash.update(s)}s(l,a),l.prototype._update=function(e){this._hash.update(e)},l.prototype._final=function(){var e=this._hash.digest();return("rmd160"===this._alg?new h:d(this._alg)).update(this._opad).update(e).digest()},e.exports=function(e,t){return"rmd160"===(e=e.toLowerCase())||"ripemd160"===e?new l("rmd160",t):"md5"===e?new r(o,t):new l(e,t)}},51031:function(e,t,i){"use strict";var s=i(35717),r=i(89509).Buffer,a=i(71027),n=r.alloc(128),o=64;function h(e,t){a.call(this,"digest"),"string"==typeof t&&(t=r.from(t)),this._alg=e,this._key=t,t.length>o?t=e(t):t.length<o&&(t=r.concat([t,n],o));for(var i=this._ipad=r.allocUnsafe(o),s=this._opad=r.allocUnsafe(o),h=0;h<o;h++)i[h]=54^t[h],s[h]=92^t[h];this._hash=[i]}s(h,a),h.prototype._update=function(e){this._hash.push(e)},h.prototype._final=function(){var e=this._alg(r.concat(this._hash));return this._alg(r.concat([this._opad,e]))},e.exports=h},55835:function(e,t,i){"use strict";t.randomBytes=t.rng=t.pseudoRandomBytes=t.prng=i(61798),t.createHash=t.Hash=i(23482),t.createHmac=t.Hmac=i(58355);var s=i(56042),r=Object.keys(s),a=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(r);t.getHashes=function(){return a};var n=i(25632);t.pbkdf2=n.pbkdf2,t.pbkdf2Sync=n.pbkdf2Sync;var o=i(53614);t.Cipher=o.Cipher,t.createCipher=o.createCipher,t.Cipheriv=o.Cipheriv,t.createCipheriv=o.createCipheriv,t.Decipher=o.Decipher,t.createDecipher=o.createDecipher,t.Decipheriv=o.Decipheriv,t.createDecipheriv=o.createDecipheriv,t.getCiphers=o.getCiphers,t.listCiphers=o.listCiphers;var h=i(62607);t.DiffieHellmanGroup=h.DiffieHellmanGroup,t.createDiffieHellmanGroup=h.createDiffieHellmanGroup,t.getDiffieHellman=h.getDiffieHellman,t.createDiffieHellman=h.createDiffieHellman,t.DiffieHellman=h.DiffieHellman;var d=i(64743);t.createSign=d.createSign,t.Sign=d.Sign,t.createVerify=d.createVerify,t.Verify=d.Verify,t.createECDH=i(76393);var c=i(7900);t.publicEncrypt=c.publicEncrypt,t.privateEncrypt=c.privateEncrypt,t.publicDecrypt=c.publicDecrypt,t.privateDecrypt=c.privateDecrypt;var l=i(77963);t.randomFill=l.randomFill,t.randomFillSync=l.randomFillSync,t.createCredentials=function(){throw new Error(["sorry, createCredentials is not implemented yet","we accept pull requests","https://github.com/crypto-browserify/crypto-browserify"].join("\n"))},t.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6}},15251:function(e,t,i){"use strict";t.utils=i(11278),t.Cipher=i(55756),t.DES=i(70778),t.CBC=i(39051),t.EDE=i(50651)},39051:function(e,t,i){"use strict";var s=i(79746),r=i(35717),a={};function n(e){s.equal(e.length,8,"Invalid IV length"),this.iv=new Array(8);for(var t=0;t<this.iv.length;t++)this.iv[t]=e[t]}t.instantiate=function(e){function t(t){e.call(this,t),this._cbcInit()}r(t,e);for(var i=Object.keys(a),s=0;s<i.length;s++){var n=i[s];t.prototype[n]=a[n]}return t.create=function(e){return new t(e)},t},a._cbcInit=function(){var e=new n(this.options.iv);this._cbcState=e},a._update=function(e,t,i,s){var r=this._cbcState,a=this.constructor.super_.prototype,n=r.iv;if("encrypt"===this.type){for(var o=0;o<this.blockSize;o++)n[o]^=e[t+o];a._update.call(this,n,0,i,s);for(o=0;o<this.blockSize;o++)n[o]=i[s+o]}else{a._update.call(this,e,t,i,s);for(o=0;o<this.blockSize;o++)i[s+o]^=n[o];for(o=0;o<this.blockSize;o++)n[o]=e[t+o]}}},55756:function(e,t,i){"use strict";var s=i(79746);function r(e){this.options=e,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0}e.exports=r,r.prototype._init=function(){},r.prototype.update=function(e){return 0===e.length?[]:"decrypt"===this.type?this._updateDecrypt(e):this._updateEncrypt(e)},r.prototype._buffer=function(e,t){for(var i=Math.min(this.buffer.length-this.bufferOff,e.length-t),s=0;s<i;s++)this.buffer[this.bufferOff+s]=e[t+s];return this.bufferOff+=i,i},r.prototype._flushBuffer=function(e,t){return this._update(this.buffer,0,e,t),this.bufferOff=0,this.blockSize},r.prototype._updateEncrypt=function(e){var t=0,i=0,s=(this.bufferOff+e.length)/this.blockSize|0,r=new Array(s*this.blockSize);0!==this.bufferOff&&(t+=this._buffer(e,t),this.bufferOff===this.buffer.length&&(i+=this._flushBuffer(r,i)));for(var a=e.length-(e.length-t)%this.blockSize;t<a;t+=this.blockSize)this._update(e,t,r,i),i+=this.blockSize;for(;t<e.length;t++,this.bufferOff++)this.buffer[this.bufferOff]=e[t];return r},r.prototype._updateDecrypt=function(e){for(var t=0,i=0,s=Math.ceil((this.bufferOff+e.length)/this.blockSize)-1,r=new Array(s*this.blockSize);s>0;s--)t+=this._buffer(e,t),i+=this._flushBuffer(r,i);return t+=this._buffer(e,t),r},r.prototype.final=function(e){var t,i;return e&&(t=this.update(e)),i="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),t?t.concat(i):i},r.prototype._pad=function(e,t){if(0===t)return!1;for(;t<e.length;)e[t++]=0;return!0},r.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var e=new Array(this.blockSize);return this._update(this.buffer,0,e,0),e},r.prototype._unpad=function(e){return e},r.prototype._finalDecrypt=function(){s.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var e=new Array(this.blockSize);return this._flushBuffer(e,0),this._unpad(e)}},70778:function(e,t,i){"use strict";var s=i(79746),r=i(35717),a=i(11278),n=i(55756);function o(){this.tmp=new Array(2),this.keys=null}function h(e){n.call(this,e);var t=new o;this._desState=t,this.deriveKeys(t,e.key)}r(h,n),e.exports=h,h.create=function(e){return new h(e)};var d=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];h.prototype.deriveKeys=function(e,t){e.keys=new Array(32),s.equal(t.length,this.blockSize,"Invalid key length");var i=a.readUInt32BE(t,0),r=a.readUInt32BE(t,4);a.pc1(i,r,e.tmp,0),i=e.tmp[0],r=e.tmp[1];for(var n=0;n<e.keys.length;n+=2){var o=d[n>>>1];i=a.r28shl(i,o),r=a.r28shl(r,o),a.pc2(i,r,e.keys,n)}},h.prototype._update=function(e,t,i,s){var r=this._desState,n=a.readUInt32BE(e,t),o=a.readUInt32BE(e,t+4);a.ip(n,o,r.tmp,0),n=r.tmp[0],o=r.tmp[1],"encrypt"===this.type?this._encrypt(r,n,o,r.tmp,0):this._decrypt(r,n,o,r.tmp,0),n=r.tmp[0],o=r.tmp[1],a.writeUInt32BE(i,n,s),a.writeUInt32BE(i,o,s+4)},h.prototype._pad=function(e,t){for(var i=e.length-t,s=t;s<e.length;s++)e[s]=i;return!0},h.prototype._unpad=function(e){for(var t=e[e.length-1],i=e.length-t;i<e.length;i++)s.equal(e[i],t);return e.slice(0,e.length-t)},h.prototype._encrypt=function(e,t,i,s,r){for(var n=t,o=i,h=0;h<e.keys.length;h+=2){var d=e.keys[h],c=e.keys[h+1];a.expand(o,e.tmp,0),d^=e.tmp[0],c^=e.tmp[1];var l=a.substitute(d,c),u=o;o=(n^a.permute(l))>>>0,n=u}a.rip(o,n,s,r)},h.prototype._decrypt=function(e,t,i,s,r){for(var n=i,o=t,h=e.keys.length-2;h>=0;h-=2){var d=e.keys[h],c=e.keys[h+1];a.expand(n,e.tmp,0),d^=e.tmp[0],c^=e.tmp[1];var l=a.substitute(d,c),u=n;n=(o^a.permute(l))>>>0,o=u}a.rip(n,o,s,r)}},50651:function(e,t,i){"use strict";var s=i(79746),r=i(35717),a=i(55756),n=i(70778);function o(e,t){s.equal(t.length,24,"Invalid key length");var i=t.slice(0,8),r=t.slice(8,16),a=t.slice(16,24);this.ciphers="encrypt"===e?[n.create({type:"encrypt",key:i}),n.create({type:"decrypt",key:r}),n.create({type:"encrypt",key:a})]:[n.create({type:"decrypt",key:a}),n.create({type:"encrypt",key:r}),n.create({type:"decrypt",key:i})]}function h(e){a.call(this,e);var t=new o(this.type,this.options.key);this._edeState=t}r(h,a),e.exports=h,h.create=function(e){return new h(e)},h.prototype._update=function(e,t,i,s){var r=this._edeState;r.ciphers[0]._update(e,t,i,s),r.ciphers[1]._update(i,s,i,s),r.ciphers[2]._update(i,s,i,s)},h.prototype._pad=n.prototype._pad,h.prototype._unpad=n.prototype._unpad},11278:function(e,t){"use strict";t.readUInt32BE=function(e,t){return(e[0+t]<<24|e[1+t]<<16|e[2+t]<<8|e[3+t])>>>0},t.writeUInt32BE=function(e,t,i){e[0+i]=t>>>24,e[1+i]=t>>>16&255,e[2+i]=t>>>8&255,e[3+i]=255&t},t.ip=function(e,t,i,s){for(var r=0,a=0,n=6;n>=0;n-=2){for(var o=0;o<=24;o+=8)r<<=1,r|=t>>>o+n&1;for(o=0;o<=24;o+=8)r<<=1,r|=e>>>o+n&1}for(n=6;n>=0;n-=2){for(o=1;o<=25;o+=8)a<<=1,a|=t>>>o+n&1;for(o=1;o<=25;o+=8)a<<=1,a|=e>>>o+n&1}i[s+0]=r>>>0,i[s+1]=a>>>0},t.rip=function(e,t,i,s){for(var r=0,a=0,n=0;n<4;n++)for(var o=24;o>=0;o-=8)r<<=1,r|=t>>>o+n&1,r<<=1,r|=e>>>o+n&1;for(n=4;n<8;n++)for(o=24;o>=0;o-=8)a<<=1,a|=t>>>o+n&1,a<<=1,a|=e>>>o+n&1;i[s+0]=r>>>0,i[s+1]=a>>>0},t.pc1=function(e,t,i,s){for(var r=0,a=0,n=7;n>=5;n--){for(var o=0;o<=24;o+=8)r<<=1,r|=t>>o+n&1;for(o=0;o<=24;o+=8)r<<=1,r|=e>>o+n&1}for(o=0;o<=24;o+=8)r<<=1,r|=t>>o+n&1;for(n=1;n<=3;n++){for(o=0;o<=24;o+=8)a<<=1,a|=t>>o+n&1;for(o=0;o<=24;o+=8)a<<=1,a|=e>>o+n&1}for(o=0;o<=24;o+=8)a<<=1,a|=e>>o+n&1;i[s+0]=r>>>0,i[s+1]=a>>>0},t.r28shl=function(e,t){return e<<t&268435455|e>>>28-t};var i=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];t.pc2=function(e,t,s,r){for(var a=0,n=0,o=i.length>>>1,h=0;h<o;h++)a<<=1,a|=e>>>i[h]&1;for(h=o;h<i.length;h++)n<<=1,n|=t>>>i[h]&1;s[r+0]=a>>>0,s[r+1]=n>>>0},t.expand=function(e,t,i){var s=0,r=0;s=(1&e)<<5|e>>>27;for(var a=23;a>=15;a-=4)s<<=6,s|=e>>>a&63;for(a=11;a>=3;a-=4)r|=e>>>a&63,r<<=6;r|=(31&e)<<1|e>>>31,t[i+0]=s>>>0,t[i+1]=r>>>0};var s=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];t.substitute=function(e,t){for(var i=0,r=0;r<4;r++){i<<=4,i|=s[64*r+(e>>>18-6*r&63)]}for(r=0;r<4;r++){i<<=4,i|=s[256+64*r+(t>>>18-6*r&63)]}return i>>>0};var r=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];t.permute=function(e){for(var t=0,i=0;i<r.length;i++)t<<=1,t|=e>>>r[i]&1;return t>>>0},t.padSplit=function(e,t,i){for(var s=e.toString(2);s.length<t;)s="0"+s;for(var r=[],a=0;a<t;a+=i)r.push(s.slice(a,a+i));return r.join(" ")}},62607:function(e,t,i){var s=i(48764).Buffer,r=i(43590),a=i(29799),n=i(57426);var o={binary:!0,hex:!0,base64:!0};t.DiffieHellmanGroup=t.createDiffieHellmanGroup=t.getDiffieHellman=function(e){var t=new s(a[e].prime,"hex"),i=new s(a[e].gen,"hex");return new n(t,i)},t.createDiffieHellman=t.DiffieHellman=function e(t,i,a,h){return s.isBuffer(i)||void 0===o[i]?e(t,"binary",i,a):(i=i||"binary",h=h||"binary",a=a||new s([2]),s.isBuffer(a)||(a=new s(a,h)),"number"==typeof t?new n(r(t,a),a,!0):(s.isBuffer(t)||(t=new s(t,i)),new n(t,a,!0)))}},57426:function(e,t,i){var s=i(48764).Buffer,r=i(83620),a=new(i(63047)),n=new r(24),o=new r(11),h=new r(10),d=new r(3),c=new r(7),l=i(43590),u=i(61798);function f(e,t){return t=t||"utf8",s.isBuffer(e)||(e=new s(e,t)),this._pub=new r(e),this}function p(e,t){return t=t||"utf8",s.isBuffer(e)||(e=new s(e,t)),this._priv=new r(e),this}e.exports=g;var m={};function g(e,t,i){this.setGenerator(t),this.__prime=new r(e),this._prime=r.mont(this.__prime),this._primeLen=e.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,i?(this.setPublicKey=f,this.setPrivateKey=p):this._primeCode=8}function y(e,t){var i=new s(e.toArray());return t?i.toString(t):i}Object.defineProperty(g.prototype,"verifyError",{enumerable:!0,get:function(){return"number"!=typeof this._primeCode&&(this._primeCode=function(e,t){var i=t.toString("hex"),s=[i,e.toString(16)].join("_");if(s in m)return m[s];var r,u=0;if(e.isEven()||!l.simpleSieve||!l.fermatTest(e)||!a.test(e))return u+=1,u+="02"===i||"05"===i?8:4,m[s]=u,u;switch(a.test(e.shrn(1))||(u+=2),i){case"02":e.mod(n).cmp(o)&&(u+=8);break;case"05":(r=e.mod(h)).cmp(d)&&r.cmp(c)&&(u+=8);break;default:u+=4}return m[s]=u,u}(this.__prime,this.__gen)),this._primeCode}}),g.prototype.generateKeys=function(){return this._priv||(this._priv=new r(u(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},g.prototype.computeSecret=function(e){var t=(e=(e=new r(e)).toRed(this._prime)).redPow(this._priv).fromRed(),i=new s(t.toArray()),a=this.getPrime();if(i.length<a.length){var n=new s(a.length-i.length);n.fill(0),i=s.concat([n,i])}return i},g.prototype.getPublicKey=function(e){return y(this._pub,e)},g.prototype.getPrivateKey=function(e){return y(this._priv,e)},g.prototype.getPrime=function(e){return y(this.__prime,e)},g.prototype.getGenerator=function(e){return y(this._gen,e)},g.prototype.setGenerator=function(e,t){return t=t||"utf8",s.isBuffer(e)||(e=new s(e,t)),this.__gen=e,this._gen=new r(e),this}},43590:function(e,t,i){var s=i(61798);e.exports=b,b.simpleSieve=g,b.fermatTest=y;var r=i(83620),a=new r(24),n=new(i(63047)),o=new r(1),h=new r(2),d=new r(5),c=(new r(16),new r(8),new r(10)),l=new r(3),u=(new r(7),new r(11)),f=new r(4),p=(new r(12),null);function m(){if(null!==p)return p;var e=[];e[0]=2;for(var t=1,i=3;i<1048576;i+=2){for(var s=Math.ceil(Math.sqrt(i)),r=0;r<t&&e[r]<=s&&i%e[r]!=0;r++);t!==r&&e[r]<=s||(e[t++]=i)}return p=e,e}function g(e){for(var t=m(),i=0;i<t.length;i++)if(0===e.modn(t[i]))return 0===e.cmpn(t[i]);return!0}function y(e){var t=r.mont(e);return 0===h.toRed(t).redPow(e.subn(1)).fromRed().cmpn(1)}function b(e,t){if(e<16)return new r(2===t||5===t?[140,123]:[140,39]);var i,p;for(t=new r(t);;){for(i=new r(s(Math.ceil(e/8)));i.bitLength()>e;)i.ishrn(1);if(i.isEven()&&i.iadd(o),i.testn(1)||i.iadd(h),t.cmp(h)){if(!t.cmp(d))for(;i.mod(c).cmp(l);)i.iadd(f)}else for(;i.mod(a).cmp(u);)i.iadd(f);if(g(p=i.shrn(1))&&g(i)&&y(p)&&y(i)&&n.test(p)&&n.test(i))return i}}},83620:function(e,t,i){!function(e,t){"use strict";function s(e,t){if(!e)throw new Error(t||"Assertion failed")}function r(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function a(e,t,i){if(a.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(i=t,t=10),this._init(e||0,t||10,i||"be"))}var n;"object"==typeof e?e.exports=a:t.BN=a,a.BN=a,a.wordSize=26;try{n="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i(7748).Buffer}catch(e){}function o(e,t){var i=e.charCodeAt(t);return i>=65&&i<=70?i-55:i>=97&&i<=102?i-87:i-48&15}function h(e,t,i){var s=o(e,i);return i-1>=t&&(s|=o(e,i-1)<<4),s}function d(e,t,i,s){for(var r=0,a=Math.min(e.length,i),n=t;n<a;n++){var o=e.charCodeAt(n)-48;r*=s,r+=o>=49?o-49+10:o>=17?o-17+10:o}return r}a.isBN=function(e){return e instanceof a||null!==e&&"object"==typeof e&&e.constructor.wordSize===a.wordSize&&Array.isArray(e.words)},a.max=function(e,t){return e.cmp(t)>0?e:t},a.min=function(e,t){return e.cmp(t)<0?e:t},a.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),s(t===(0|t)&&t>=2&&t<=36);var r=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(r++,this.negative=1),r<e.length&&(16===t?this._parseHex(e,r,i):(this._parseBase(e,t,r),"le"===i&&this._initArray(this.toArray(),t,i)))},a.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(s(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},a.prototype._initArray=function(e,t,i){if(s("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var a,n,o=0;if("be"===i)for(r=e.length-1,a=0;r>=0;r-=3)n=e[r]|e[r-1]<<8|e[r-2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);else if("le"===i)for(r=0,a=0;r<e.length;r+=3)n=e[r]|e[r+1]<<8|e[r+2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);return this.strip()},a.prototype._parseHex=function(e,t,i){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var r,a=0,n=0;if("be"===i)for(s=e.length-1;s>=t;s-=2)r=h(e,t,s)<<a,this.words[n]|=67108863&r,a>=18?(a-=18,n+=1,this.words[n]|=r>>>26):a+=8;else for(s=(e.length-t)%2==0?t+1:t;s<e.length;s+=2)r=h(e,t,s)<<a,this.words[n]|=67108863&r,a>=18?(a-=18,n+=1,this.words[n]|=r>>>26):a+=8;this.strip()},a.prototype._parseBase=function(e,t,i){this.words=[0],this.length=1;for(var s=0,r=1;r<=67108863;r*=t)s++;s--,r=r/t|0;for(var a=e.length-i,n=a%s,o=Math.min(a,a-n)+i,h=0,c=i;c<o;c+=s)h=d(e,c,c+s,t),this.imuln(r),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==n){var l=1;for(h=d(e,c,e.length,t),c=0;c<n;c++)l*=t;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},a.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},a.prototype.clone=function(){var e=new a(null);return this.copy(e),e},a.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},a.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},a.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},a.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],u=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,i){i.negative=t.negative^e.negative;var s=e.length+t.length|0;i.length=s,s=s-1|0;var r=0|e.words[0],a=0|t.words[0],n=r*a,o=67108863&n,h=n/67108864|0;i.words[0]=o;for(var d=1;d<s;d++){for(var c=h>>>26,l=67108863&h,u=Math.min(d,t.length-1),f=Math.max(0,d-e.length+1);f<=u;f++){var p=d-f|0;c+=(n=(r=0|e.words[p])*(a=0|t.words[f])+l)/67108864|0,l=67108863&n}i.words[d]=0|l,h=0|c}return 0!==h?i.words[d]=0|h:i.length--,i.strip()}a.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var r=0,a=0,n=0;n<this.length;n++){var o=this.words[n],h=(16777215&(o<<r|a)).toString(16);i=0!==(a=o>>>24-r&16777215)||n!==this.length-1?c[6-h.length]+h+i:h+i,(r+=2)>=26&&(r-=26,n--)}for(0!==a&&(i=a.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var d=l[e],f=u[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:c[d-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}s(!1,"Base should be between 2 and 36")},a.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&s(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},a.prototype.toJSON=function(){return this.toString(16)},a.prototype.toBuffer=function(e,t){return s(void 0!==n),this.toArrayLike(n,e,t)},a.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},a.prototype.toArrayLike=function(e,t,i){var r=this.byteLength(),a=i||Math.max(1,r);s(r<=a,"byte array longer than desired length"),s(a>0,"Requested array length <= 0"),this.strip();var n,o,h="le"===t,d=new e(a),c=this.clone();if(h){for(o=0;!c.isZero();o++)n=c.andln(255),c.iushrn(8),d[o]=n;for(;o<a;o++)d[o]=0}else{for(o=0;o<a-r;o++)d[o]=0;for(o=0;!c.isZero();o++)n=c.andln(255),c.iushrn(8),d[a-o-1]=n}return d},Math.clz32?a.prototype._countBits=function(e){return 32-Math.clz32(e)}:a.prototype._countBits=function(e){var t=e,i=0;return t>=4096&&(i+=13,t>>>=13),t>=64&&(i+=7,t>>>=7),t>=8&&(i+=4,t>>>=4),t>=2&&(i+=2,t>>>=2),i+t},a.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,i=0;return 0==(8191&t)&&(i+=13,t>>>=13),0==(127&t)&&(i+=7,t>>>=7),0==(15&t)&&(i+=4,t>>>=4),0==(3&t)&&(i+=2,t>>>=2),0==(1&t)&&i++,i},a.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},a.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var i=this._zeroBits(this.words[t]);if(e+=i,26!==i)break}return e},a.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},a.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},a.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},a.prototype.isNeg=function(){return 0!==this.negative},a.prototype.neg=function(){return this.clone().ineg()},a.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},a.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},a.prototype.ior=function(e){return s(0==(this.negative|e.negative)),this.iuor(e)},a.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},a.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},a.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var i=0;i<t.length;i++)this.words[i]=this.words[i]&e.words[i];return this.length=t.length,this.strip()},a.prototype.iand=function(e){return s(0==(this.negative|e.negative)),this.iuand(e)},a.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},a.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},a.prototype.iuxor=function(e){var t,i;this.length>e.length?(t=this,i=e):(t=e,i=this);for(var s=0;s<i.length;s++)this.words[s]=t.words[s]^i.words[s];if(this!==t)for(;s<t.length;s++)this.words[s]=t.words[s];return this.length=t.length,this.strip()},a.prototype.ixor=function(e){return s(0==(this.negative|e.negative)),this.iuxor(e)},a.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},a.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},a.prototype.inotn=function(e){s("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var r=0;r<t;r++)this.words[r]=67108863&~this.words[r];return i>0&&(this.words[r]=~this.words[r]&67108863>>26-i),this.strip()},a.prototype.notn=function(e){return this.clone().inotn(e)},a.prototype.setn=function(e,t){s("number"==typeof e&&e>=0);var i=e/26|0,r=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<r:this.words[i]&~(1<<r),this.strip()},a.prototype.iadd=function(e){var t,i,s;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(i=this,s=e):(i=e,s=this);for(var r=0,a=0;a<s.length;a++)t=(0|i.words[a])+(0|s.words[a])+r,this.words[a]=67108863&t,r=t>>>26;for(;0!==r&&a<i.length;a++)t=(0|i.words[a])+r,this.words[a]=67108863&t,r=t>>>26;if(this.length=i.length,0!==r)this.words[this.length]=r,this.length++;else if(i!==this)for(;a<i.length;a++)this.words[a]=i.words[a];return this},a.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},a.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var i,s,r=this.cmp(e);if(0===r)return this.negative=0,this.length=1,this.words[0]=0,this;r>0?(i=this,s=e):(i=e,s=this);for(var a=0,n=0;n<s.length;n++)a=(t=(0|i.words[n])-(0|s.words[n])+a)>>26,this.words[n]=67108863&t;for(;0!==a&&n<i.length;n++)a=(t=(0|i.words[n])+a)>>26,this.words[n]=67108863&t;if(0===a&&n<i.length&&i!==this)for(;n<i.length;n++)this.words[n]=i.words[n];return this.length=Math.max(this.length,n),i!==this&&(this.negative=1),this.strip()},a.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,i){var s,r,a,n=e.words,o=t.words,h=i.words,d=0,c=0|n[0],l=8191&c,u=c>>>13,f=0|n[1],p=8191&f,m=f>>>13,g=0|n[2],y=8191&g,b=g>>>13,v=0|n[3],w=8191&v,S=v>>>13,k=0|n[4],T=8191&k,_=k>>>13,O=0|n[5],M=8191&O,I=O>>>13,x=0|n[6],C=8191&x,P=x>>>13,A=0|n[7],N=8191&A,B=A>>>13,E=0|n[8],V=8191&E,L=E>>>13,R=0|n[9],D=8191&R,F=R>>>13,q=0|o[0],G=8191&q,H=q>>>13,U=0|o[1],j=8191&U,W=U>>>13,z=0|o[2],K=8191&z,X=z>>>13,Z=0|o[3],Y=8191&Z,Q=Z>>>13,J=0|o[4],$=8191&J,ee=J>>>13,te=0|o[5],ie=8191&te,se=te>>>13,re=0|o[6],ae=8191&re,ne=re>>>13,oe=0|o[7],he=8191&oe,de=oe>>>13,ce=0|o[8],le=8191&ce,ue=ce>>>13,fe=0|o[9],pe=8191&fe,me=fe>>>13;i.negative=e.negative^t.negative,i.length=19;var ge=(d+(s=Math.imul(l,G))|0)+((8191&(r=(r=Math.imul(l,H))+Math.imul(u,G)|0))<<13)|0;d=((a=Math.imul(u,H))+(r>>>13)|0)+(ge>>>26)|0,ge&=67108863,s=Math.imul(p,G),r=(r=Math.imul(p,H))+Math.imul(m,G)|0,a=Math.imul(m,H);var ye=(d+(s=s+Math.imul(l,j)|0)|0)+((8191&(r=(r=r+Math.imul(l,W)|0)+Math.imul(u,j)|0))<<13)|0;d=((a=a+Math.imul(u,W)|0)+(r>>>13)|0)+(ye>>>26)|0,ye&=67108863,s=Math.imul(y,G),r=(r=Math.imul(y,H))+Math.imul(b,G)|0,a=Math.imul(b,H),s=s+Math.imul(p,j)|0,r=(r=r+Math.imul(p,W)|0)+Math.imul(m,j)|0,a=a+Math.imul(m,W)|0;var be=(d+(s=s+Math.imul(l,K)|0)|0)+((8191&(r=(r=r+Math.imul(l,X)|0)+Math.imul(u,K)|0))<<13)|0;d=((a=a+Math.imul(u,X)|0)+(r>>>13)|0)+(be>>>26)|0,be&=67108863,s=Math.imul(w,G),r=(r=Math.imul(w,H))+Math.imul(S,G)|0,a=Math.imul(S,H),s=s+Math.imul(y,j)|0,r=(r=r+Math.imul(y,W)|0)+Math.imul(b,j)|0,a=a+Math.imul(b,W)|0,s=s+Math.imul(p,K)|0,r=(r=r+Math.imul(p,X)|0)+Math.imul(m,K)|0,a=a+Math.imul(m,X)|0;var ve=(d+(s=s+Math.imul(l,Y)|0)|0)+((8191&(r=(r=r+Math.imul(l,Q)|0)+Math.imul(u,Y)|0))<<13)|0;d=((a=a+Math.imul(u,Q)|0)+(r>>>13)|0)+(ve>>>26)|0,ve&=67108863,s=Math.imul(T,G),r=(r=Math.imul(T,H))+Math.imul(_,G)|0,a=Math.imul(_,H),s=s+Math.imul(w,j)|0,r=(r=r+Math.imul(w,W)|0)+Math.imul(S,j)|0,a=a+Math.imul(S,W)|0,s=s+Math.imul(y,K)|0,r=(r=r+Math.imul(y,X)|0)+Math.imul(b,K)|0,a=a+Math.imul(b,X)|0,s=s+Math.imul(p,Y)|0,r=(r=r+Math.imul(p,Q)|0)+Math.imul(m,Y)|0,a=a+Math.imul(m,Q)|0;var we=(d+(s=s+Math.imul(l,$)|0)|0)+((8191&(r=(r=r+Math.imul(l,ee)|0)+Math.imul(u,$)|0))<<13)|0;d=((a=a+Math.imul(u,ee)|0)+(r>>>13)|0)+(we>>>26)|0,we&=67108863,s=Math.imul(M,G),r=(r=Math.imul(M,H))+Math.imul(I,G)|0,a=Math.imul(I,H),s=s+Math.imul(T,j)|0,r=(r=r+Math.imul(T,W)|0)+Math.imul(_,j)|0,a=a+Math.imul(_,W)|0,s=s+Math.imul(w,K)|0,r=(r=r+Math.imul(w,X)|0)+Math.imul(S,K)|0,a=a+Math.imul(S,X)|0,s=s+Math.imul(y,Y)|0,r=(r=r+Math.imul(y,Q)|0)+Math.imul(b,Y)|0,a=a+Math.imul(b,Q)|0,s=s+Math.imul(p,$)|0,r=(r=r+Math.imul(p,ee)|0)+Math.imul(m,$)|0,a=a+Math.imul(m,ee)|0;var Se=(d+(s=s+Math.imul(l,ie)|0)|0)+((8191&(r=(r=r+Math.imul(l,se)|0)+Math.imul(u,ie)|0))<<13)|0;d=((a=a+Math.imul(u,se)|0)+(r>>>13)|0)+(Se>>>26)|0,Se&=67108863,s=Math.imul(C,G),r=(r=Math.imul(C,H))+Math.imul(P,G)|0,a=Math.imul(P,H),s=s+Math.imul(M,j)|0,r=(r=r+Math.imul(M,W)|0)+Math.imul(I,j)|0,a=a+Math.imul(I,W)|0,s=s+Math.imul(T,K)|0,r=(r=r+Math.imul(T,X)|0)+Math.imul(_,K)|0,a=a+Math.imul(_,X)|0,s=s+Math.imul(w,Y)|0,r=(r=r+Math.imul(w,Q)|0)+Math.imul(S,Y)|0,a=a+Math.imul(S,Q)|0,s=s+Math.imul(y,$)|0,r=(r=r+Math.imul(y,ee)|0)+Math.imul(b,$)|0,a=a+Math.imul(b,ee)|0,s=s+Math.imul(p,ie)|0,r=(r=r+Math.imul(p,se)|0)+Math.imul(m,ie)|0,a=a+Math.imul(m,se)|0;var ke=(d+(s=s+Math.imul(l,ae)|0)|0)+((8191&(r=(r=r+Math.imul(l,ne)|0)+Math.imul(u,ae)|0))<<13)|0;d=((a=a+Math.imul(u,ne)|0)+(r>>>13)|0)+(ke>>>26)|0,ke&=67108863,s=Math.imul(N,G),r=(r=Math.imul(N,H))+Math.imul(B,G)|0,a=Math.imul(B,H),s=s+Math.imul(C,j)|0,r=(r=r+Math.imul(C,W)|0)+Math.imul(P,j)|0,a=a+Math.imul(P,W)|0,s=s+Math.imul(M,K)|0,r=(r=r+Math.imul(M,X)|0)+Math.imul(I,K)|0,a=a+Math.imul(I,X)|0,s=s+Math.imul(T,Y)|0,r=(r=r+Math.imul(T,Q)|0)+Math.imul(_,Y)|0,a=a+Math.imul(_,Q)|0,s=s+Math.imul(w,$)|0,r=(r=r+Math.imul(w,ee)|0)+Math.imul(S,$)|0,a=a+Math.imul(S,ee)|0,s=s+Math.imul(y,ie)|0,r=(r=r+Math.imul(y,se)|0)+Math.imul(b,ie)|0,a=a+Math.imul(b,se)|0,s=s+Math.imul(p,ae)|0,r=(r=r+Math.imul(p,ne)|0)+Math.imul(m,ae)|0,a=a+Math.imul(m,ne)|0;var Te=(d+(s=s+Math.imul(l,he)|0)|0)+((8191&(r=(r=r+Math.imul(l,de)|0)+Math.imul(u,he)|0))<<13)|0;d=((a=a+Math.imul(u,de)|0)+(r>>>13)|0)+(Te>>>26)|0,Te&=67108863,s=Math.imul(V,G),r=(r=Math.imul(V,H))+Math.imul(L,G)|0,a=Math.imul(L,H),s=s+Math.imul(N,j)|0,r=(r=r+Math.imul(N,W)|0)+Math.imul(B,j)|0,a=a+Math.imul(B,W)|0,s=s+Math.imul(C,K)|0,r=(r=r+Math.imul(C,X)|0)+Math.imul(P,K)|0,a=a+Math.imul(P,X)|0,s=s+Math.imul(M,Y)|0,r=(r=r+Math.imul(M,Q)|0)+Math.imul(I,Y)|0,a=a+Math.imul(I,Q)|0,s=s+Math.imul(T,$)|0,r=(r=r+Math.imul(T,ee)|0)+Math.imul(_,$)|0,a=a+Math.imul(_,ee)|0,s=s+Math.imul(w,ie)|0,r=(r=r+Math.imul(w,se)|0)+Math.imul(S,ie)|0,a=a+Math.imul(S,se)|0,s=s+Math.imul(y,ae)|0,r=(r=r+Math.imul(y,ne)|0)+Math.imul(b,ae)|0,a=a+Math.imul(b,ne)|0,s=s+Math.imul(p,he)|0,r=(r=r+Math.imul(p,de)|0)+Math.imul(m,he)|0,a=a+Math.imul(m,de)|0;var _e=(d+(s=s+Math.imul(l,le)|0)|0)+((8191&(r=(r=r+Math.imul(l,ue)|0)+Math.imul(u,le)|0))<<13)|0;d=((a=a+Math.imul(u,ue)|0)+(r>>>13)|0)+(_e>>>26)|0,_e&=67108863,s=Math.imul(D,G),r=(r=Math.imul(D,H))+Math.imul(F,G)|0,a=Math.imul(F,H),s=s+Math.imul(V,j)|0,r=(r=r+Math.imul(V,W)|0)+Math.imul(L,j)|0,a=a+Math.imul(L,W)|0,s=s+Math.imul(N,K)|0,r=(r=r+Math.imul(N,X)|0)+Math.imul(B,K)|0,a=a+Math.imul(B,X)|0,s=s+Math.imul(C,Y)|0,r=(r=r+Math.imul(C,Q)|0)+Math.imul(P,Y)|0,a=a+Math.imul(P,Q)|0,s=s+Math.imul(M,$)|0,r=(r=r+Math.imul(M,ee)|0)+Math.imul(I,$)|0,a=a+Math.imul(I,ee)|0,s=s+Math.imul(T,ie)|0,r=(r=r+Math.imul(T,se)|0)+Math.imul(_,ie)|0,a=a+Math.imul(_,se)|0,s=s+Math.imul(w,ae)|0,r=(r=r+Math.imul(w,ne)|0)+Math.imul(S,ae)|0,a=a+Math.imul(S,ne)|0,s=s+Math.imul(y,he)|0,r=(r=r+Math.imul(y,de)|0)+Math.imul(b,he)|0,a=a+Math.imul(b,de)|0,s=s+Math.imul(p,le)|0,r=(r=r+Math.imul(p,ue)|0)+Math.imul(m,le)|0,a=a+Math.imul(m,ue)|0;var Oe=(d+(s=s+Math.imul(l,pe)|0)|0)+((8191&(r=(r=r+Math.imul(l,me)|0)+Math.imul(u,pe)|0))<<13)|0;d=((a=a+Math.imul(u,me)|0)+(r>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,s=Math.imul(D,j),r=(r=Math.imul(D,W))+Math.imul(F,j)|0,a=Math.imul(F,W),s=s+Math.imul(V,K)|0,r=(r=r+Math.imul(V,X)|0)+Math.imul(L,K)|0,a=a+Math.imul(L,X)|0,s=s+Math.imul(N,Y)|0,r=(r=r+Math.imul(N,Q)|0)+Math.imul(B,Y)|0,a=a+Math.imul(B,Q)|0,s=s+Math.imul(C,$)|0,r=(r=r+Math.imul(C,ee)|0)+Math.imul(P,$)|0,a=a+Math.imul(P,ee)|0,s=s+Math.imul(M,ie)|0,r=(r=r+Math.imul(M,se)|0)+Math.imul(I,ie)|0,a=a+Math.imul(I,se)|0,s=s+Math.imul(T,ae)|0,r=(r=r+Math.imul(T,ne)|0)+Math.imul(_,ae)|0,a=a+Math.imul(_,ne)|0,s=s+Math.imul(w,he)|0,r=(r=r+Math.imul(w,de)|0)+Math.imul(S,he)|0,a=a+Math.imul(S,de)|0,s=s+Math.imul(y,le)|0,r=(r=r+Math.imul(y,ue)|0)+Math.imul(b,le)|0,a=a+Math.imul(b,ue)|0;var Me=(d+(s=s+Math.imul(p,pe)|0)|0)+((8191&(r=(r=r+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;d=((a=a+Math.imul(m,me)|0)+(r>>>13)|0)+(Me>>>26)|0,Me&=67108863,s=Math.imul(D,K),r=(r=Math.imul(D,X))+Math.imul(F,K)|0,a=Math.imul(F,X),s=s+Math.imul(V,Y)|0,r=(r=r+Math.imul(V,Q)|0)+Math.imul(L,Y)|0,a=a+Math.imul(L,Q)|0,s=s+Math.imul(N,$)|0,r=(r=r+Math.imul(N,ee)|0)+Math.imul(B,$)|0,a=a+Math.imul(B,ee)|0,s=s+Math.imul(C,ie)|0,r=(r=r+Math.imul(C,se)|0)+Math.imul(P,ie)|0,a=a+Math.imul(P,se)|0,s=s+Math.imul(M,ae)|0,r=(r=r+Math.imul(M,ne)|0)+Math.imul(I,ae)|0,a=a+Math.imul(I,ne)|0,s=s+Math.imul(T,he)|0,r=(r=r+Math.imul(T,de)|0)+Math.imul(_,he)|0,a=a+Math.imul(_,de)|0,s=s+Math.imul(w,le)|0,r=(r=r+Math.imul(w,ue)|0)+Math.imul(S,le)|0,a=a+Math.imul(S,ue)|0;var Ie=(d+(s=s+Math.imul(y,pe)|0)|0)+((8191&(r=(r=r+Math.imul(y,me)|0)+Math.imul(b,pe)|0))<<13)|0;d=((a=a+Math.imul(b,me)|0)+(r>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,s=Math.imul(D,Y),r=(r=Math.imul(D,Q))+Math.imul(F,Y)|0,a=Math.imul(F,Q),s=s+Math.imul(V,$)|0,r=(r=r+Math.imul(V,ee)|0)+Math.imul(L,$)|0,a=a+Math.imul(L,ee)|0,s=s+Math.imul(N,ie)|0,r=(r=r+Math.imul(N,se)|0)+Math.imul(B,ie)|0,a=a+Math.imul(B,se)|0,s=s+Math.imul(C,ae)|0,r=(r=r+Math.imul(C,ne)|0)+Math.imul(P,ae)|0,a=a+Math.imul(P,ne)|0,s=s+Math.imul(M,he)|0,r=(r=r+Math.imul(M,de)|0)+Math.imul(I,he)|0,a=a+Math.imul(I,de)|0,s=s+Math.imul(T,le)|0,r=(r=r+Math.imul(T,ue)|0)+Math.imul(_,le)|0,a=a+Math.imul(_,ue)|0;var xe=(d+(s=s+Math.imul(w,pe)|0)|0)+((8191&(r=(r=r+Math.imul(w,me)|0)+Math.imul(S,pe)|0))<<13)|0;d=((a=a+Math.imul(S,me)|0)+(r>>>13)|0)+(xe>>>26)|0,xe&=67108863,s=Math.imul(D,$),r=(r=Math.imul(D,ee))+Math.imul(F,$)|0,a=Math.imul(F,ee),s=s+Math.imul(V,ie)|0,r=(r=r+Math.imul(V,se)|0)+Math.imul(L,ie)|0,a=a+Math.imul(L,se)|0,s=s+Math.imul(N,ae)|0,r=(r=r+Math.imul(N,ne)|0)+Math.imul(B,ae)|0,a=a+Math.imul(B,ne)|0,s=s+Math.imul(C,he)|0,r=(r=r+Math.imul(C,de)|0)+Math.imul(P,he)|0,a=a+Math.imul(P,de)|0,s=s+Math.imul(M,le)|0,r=(r=r+Math.imul(M,ue)|0)+Math.imul(I,le)|0,a=a+Math.imul(I,ue)|0;var Ce=(d+(s=s+Math.imul(T,pe)|0)|0)+((8191&(r=(r=r+Math.imul(T,me)|0)+Math.imul(_,pe)|0))<<13)|0;d=((a=a+Math.imul(_,me)|0)+(r>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,s=Math.imul(D,ie),r=(r=Math.imul(D,se))+Math.imul(F,ie)|0,a=Math.imul(F,se),s=s+Math.imul(V,ae)|0,r=(r=r+Math.imul(V,ne)|0)+Math.imul(L,ae)|0,a=a+Math.imul(L,ne)|0,s=s+Math.imul(N,he)|0,r=(r=r+Math.imul(N,de)|0)+Math.imul(B,he)|0,a=a+Math.imul(B,de)|0,s=s+Math.imul(C,le)|0,r=(r=r+Math.imul(C,ue)|0)+Math.imul(P,le)|0,a=a+Math.imul(P,ue)|0;var Pe=(d+(s=s+Math.imul(M,pe)|0)|0)+((8191&(r=(r=r+Math.imul(M,me)|0)+Math.imul(I,pe)|0))<<13)|0;d=((a=a+Math.imul(I,me)|0)+(r>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,s=Math.imul(D,ae),r=(r=Math.imul(D,ne))+Math.imul(F,ae)|0,a=Math.imul(F,ne),s=s+Math.imul(V,he)|0,r=(r=r+Math.imul(V,de)|0)+Math.imul(L,he)|0,a=a+Math.imul(L,de)|0,s=s+Math.imul(N,le)|0,r=(r=r+Math.imul(N,ue)|0)+Math.imul(B,le)|0,a=a+Math.imul(B,ue)|0;var Ae=(d+(s=s+Math.imul(C,pe)|0)|0)+((8191&(r=(r=r+Math.imul(C,me)|0)+Math.imul(P,pe)|0))<<13)|0;d=((a=a+Math.imul(P,me)|0)+(r>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,s=Math.imul(D,he),r=(r=Math.imul(D,de))+Math.imul(F,he)|0,a=Math.imul(F,de),s=s+Math.imul(V,le)|0,r=(r=r+Math.imul(V,ue)|0)+Math.imul(L,le)|0,a=a+Math.imul(L,ue)|0;var Ne=(d+(s=s+Math.imul(N,pe)|0)|0)+((8191&(r=(r=r+Math.imul(N,me)|0)+Math.imul(B,pe)|0))<<13)|0;d=((a=a+Math.imul(B,me)|0)+(r>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,s=Math.imul(D,le),r=(r=Math.imul(D,ue))+Math.imul(F,le)|0,a=Math.imul(F,ue);var Be=(d+(s=s+Math.imul(V,pe)|0)|0)+((8191&(r=(r=r+Math.imul(V,me)|0)+Math.imul(L,pe)|0))<<13)|0;d=((a=a+Math.imul(L,me)|0)+(r>>>13)|0)+(Be>>>26)|0,Be&=67108863;var Ee=(d+(s=Math.imul(D,pe))|0)+((8191&(r=(r=Math.imul(D,me))+Math.imul(F,pe)|0))<<13)|0;return d=((a=Math.imul(F,me))+(r>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,h[0]=ge,h[1]=ye,h[2]=be,h[3]=ve,h[4]=we,h[5]=Se,h[6]=ke,h[7]=Te,h[8]=_e,h[9]=Oe,h[10]=Me,h[11]=Ie,h[12]=xe,h[13]=Ce,h[14]=Pe,h[15]=Ae,h[16]=Ne,h[17]=Be,h[18]=Ee,0!==d&&(h[19]=d,i.length++),i};function m(e,t,i){return(new g).mulp(e,t,i)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=f),a.prototype.mulTo=function(e,t){var i,s=this.length+e.length;return i=10===this.length&&10===e.length?p(this,e,t):s<63?f(this,e,t):s<1024?function(e,t,i){i.negative=t.negative^e.negative,i.length=e.length+t.length;for(var s=0,r=0,a=0;a<i.length-1;a++){var n=r;r=0;for(var o=67108863&s,h=Math.min(a,t.length-1),d=Math.max(0,a-e.length+1);d<=h;d++){var c=a-d,l=(0|e.words[c])*(0|t.words[d]),u=67108863&l;o=67108863&(u=u+o|0),r+=(n=(n=n+(l/67108864|0)|0)+(u>>>26)|0)>>>26,n&=67108863}i.words[a]=o,s=n,n=r}return 0!==s?i.words[a]=s:i.length--,i.strip()}(this,e,t):m(this,e,t),i},g.prototype.makeRBT=function(e){for(var t=new Array(e),i=a.prototype._countBits(e)-1,s=0;s<e;s++)t[s]=this.revBin(s,i,e);return t},g.prototype.revBin=function(e,t,i){if(0===e||e===i-1)return e;for(var s=0,r=0;r<t;r++)s|=(1&e)<<t-r-1,e>>=1;return s},g.prototype.permute=function(e,t,i,s,r,a){for(var n=0;n<a;n++)s[n]=t[e[n]],r[n]=i[e[n]]},g.prototype.transform=function(e,t,i,s,r,a){this.permute(a,e,t,i,s,r);for(var n=1;n<r;n<<=1)for(var o=n<<1,h=Math.cos(2*Math.PI/o),d=Math.sin(2*Math.PI/o),c=0;c<r;c+=o)for(var l=h,u=d,f=0;f<n;f++){var p=i[c+f],m=s[c+f],g=i[c+f+n],y=s[c+f+n],b=l*g-u*y;y=l*y+u*g,g=b,i[c+f]=p+g,s[c+f]=m+y,i[c+f+n]=p-g,s[c+f+n]=m-y,f!==o&&(b=h*l-d*u,u=h*u+d*l,l=b)}},g.prototype.guessLen13b=function(e,t){var i=1|Math.max(t,e),s=1&i,r=0;for(i=i/2|0;i;i>>>=1)r++;return 1<<r+1+s},g.prototype.conjugate=function(e,t,i){if(!(i<=1))for(var s=0;s<i/2;s++){var r=e[s];e[s]=e[i-s-1],e[i-s-1]=r,r=t[s],t[s]=-t[i-s-1],t[i-s-1]=-r}},g.prototype.normalize13b=function(e,t){for(var i=0,s=0;s<t/2;s++){var r=8192*Math.round(e[2*s+1]/t)+Math.round(e[2*s]/t)+i;e[s]=67108863&r,i=r<67108864?0:r/67108864|0}return e},g.prototype.convert13b=function(e,t,i,r){for(var a=0,n=0;n<t;n++)a+=0|e[n],i[2*n]=8191&a,a>>>=13,i[2*n+1]=8191&a,a>>>=13;for(n=2*t;n<r;++n)i[n]=0;s(0===a),s(0==(-8192&a))},g.prototype.stub=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=0;return t},g.prototype.mulp=function(e,t,i){var s=2*this.guessLen13b(e.length,t.length),r=this.makeRBT(s),a=this.stub(s),n=new Array(s),o=new Array(s),h=new Array(s),d=new Array(s),c=new Array(s),l=new Array(s),u=i.words;u.length=s,this.convert13b(e.words,e.length,n,s),this.convert13b(t.words,t.length,d,s),this.transform(n,a,o,h,s,r),this.transform(d,a,c,l,s,r);for(var f=0;f<s;f++){var p=o[f]*c[f]-h[f]*l[f];h[f]=o[f]*l[f]+h[f]*c[f],o[f]=p}return this.conjugate(o,h,s),this.transform(o,h,u,a,s,r),this.conjugate(u,a,s),this.normalize13b(u,s),i.negative=e.negative^t.negative,i.length=e.length+t.length,i.strip()},a.prototype.mul=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},a.prototype.mulf=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),m(this,e,t)},a.prototype.imul=function(e){return this.clone().mulTo(e,this)},a.prototype.imuln=function(e){s("number"==typeof e),s(e<67108864);for(var t=0,i=0;i<this.length;i++){var r=(0|this.words[i])*e,a=(67108863&r)+(67108863&t);t>>=26,t+=r/67108864|0,t+=a>>>26,this.words[i]=67108863&a}return 0!==t&&(this.words[i]=t,this.length++),this},a.prototype.muln=function(e){return this.clone().imuln(e)},a.prototype.sqr=function(){return this.mul(this)},a.prototype.isqr=function(){return this.imul(this.clone())},a.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),i=0;i<t.length;i++){var s=i/26|0,r=i%26;t[i]=(e.words[s]&1<<r)>>>r}return t}(e);if(0===t.length)return new a(1);for(var i=this,s=0;s<t.length&&0===t[s];s++,i=i.sqr());if(++s<t.length)for(var r=i.sqr();s<t.length;s++,r=r.sqr())0!==t[s]&&(i=i.mul(r));return i},a.prototype.iushln=function(e){s("number"==typeof e&&e>=0);var t,i=e%26,r=(e-i)/26,a=67108863>>>26-i<<26-i;if(0!==i){var n=0;for(t=0;t<this.length;t++){var o=this.words[t]&a,h=(0|this.words[t])-o<<i;this.words[t]=h|n,n=o>>>26-i}n&&(this.words[t]=n,this.length++)}if(0!==r){for(t=this.length-1;t>=0;t--)this.words[t+r]=this.words[t];for(t=0;t<r;t++)this.words[t]=0;this.length+=r}return this.strip()},a.prototype.ishln=function(e){return s(0===this.negative),this.iushln(e)},a.prototype.iushrn=function(e,t,i){var r;s("number"==typeof e&&e>=0),r=t?(t-t%26)/26:0;var a=e%26,n=Math.min((e-a)/26,this.length),o=67108863^67108863>>>a<<a,h=i;if(r-=n,r=Math.max(0,r),h){for(var d=0;d<n;d++)h.words[d]=this.words[d];h.length=n}if(0===n);else if(this.length>n)for(this.length-=n,d=0;d<this.length;d++)this.words[d]=this.words[d+n];else this.words[0]=0,this.length=1;var c=0;for(d=this.length-1;d>=0&&(0!==c||d>=r);d--){var l=0|this.words[d];this.words[d]=c<<26-a|l>>>a,c=l&o}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},a.prototype.ishrn=function(e,t,i){return s(0===this.negative),this.iushrn(e,t,i)},a.prototype.shln=function(e){return this.clone().ishln(e)},a.prototype.ushln=function(e){return this.clone().iushln(e)},a.prototype.shrn=function(e){return this.clone().ishrn(e)},a.prototype.ushrn=function(e){return this.clone().iushrn(e)},a.prototype.testn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,r=1<<t;return!(this.length<=i)&&!!(this.words[i]&r)},a.prototype.imaskn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(s(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var r=67108863^67108863>>>t<<t;this.words[this.length-1]&=r}return this.strip()},a.prototype.maskn=function(e){return this.clone().imaskn(e)},a.prototype.iaddn=function(e){return s("number"==typeof e),s(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},a.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},a.prototype.isubn=function(e){if(s("number"==typeof e),s(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},a.prototype.addn=function(e){return this.clone().iaddn(e)},a.prototype.subn=function(e){return this.clone().isubn(e)},a.prototype.iabs=function(){return this.negative=0,this},a.prototype.abs=function(){return this.clone().iabs()},a.prototype._ishlnsubmul=function(e,t,i){var r,a,n=e.length+i;this._expand(n);var o=0;for(r=0;r<e.length;r++){a=(0|this.words[r+i])+o;var h=(0|e.words[r])*t;o=((a-=67108863&h)>>26)-(h/67108864|0),this.words[r+i]=67108863&a}for(;r<this.length-i;r++)o=(a=(0|this.words[r+i])+o)>>26,this.words[r+i]=67108863&a;if(0===o)return this.strip();for(s(-1===o),o=0,r=0;r<this.length;r++)o=(a=-(0|this.words[r])+o)>>26,this.words[r]=67108863&a;return this.negative=1,this.strip()},a.prototype._wordDiv=function(e,t){var i=(this.length,e.length),s=this.clone(),r=e,n=0|r.words[r.length-1];0!==(i=26-this._countBits(n))&&(r=r.ushln(i),s.iushln(i),n=0|r.words[r.length-1]);var o,h=s.length-r.length;if("mod"!==t){(o=new a(null)).length=h+1,o.words=new Array(o.length);for(var d=0;d<o.length;d++)o.words[d]=0}var c=s.clone()._ishlnsubmul(r,1,h);0===c.negative&&(s=c,o&&(o.words[h]=1));for(var l=h-1;l>=0;l--){var u=67108864*(0|s.words[r.length+l])+(0|s.words[r.length+l-1]);for(u=Math.min(u/n|0,67108863),s._ishlnsubmul(r,u,l);0!==s.negative;)u--,s.negative=0,s._ishlnsubmul(r,1,l),s.isZero()||(s.negative^=1);o&&(o.words[l]=u)}return o&&o.strip(),s.strip(),"div"!==t&&0!==i&&s.iushrn(i),{div:o||null,mod:s}},a.prototype.divmod=function(e,t,i){return s(!e.isZero()),this.isZero()?{div:new a(0),mod:new a(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(r=o.div.neg()),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.iadd(e)),{div:r,mod:n}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(r=o.div.neg()),{div:r,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.isub(e)),{div:o.div,mod:n}):e.length>this.length||this.cmp(e)<0?{div:new a(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new a(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new a(this.modn(e.words[0]))}:this._wordDiv(e,t);var r,n,o},a.prototype.div=function(e){return this.divmod(e,"div",!1).div},a.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},a.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},a.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var i=0!==t.div.negative?t.mod.isub(e):t.mod,s=e.ushrn(1),r=e.andln(1),a=i.cmp(s);return a<0||1===r&&0===a?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},a.prototype.modn=function(e){s(e<=67108863);for(var t=(1<<26)%e,i=0,r=this.length-1;r>=0;r--)i=(t*i+(0|this.words[r]))%e;return i},a.prototype.idivn=function(e){s(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var r=(0|this.words[i])+67108864*t;this.words[i]=r/e|0,t=r%e}return this.strip()},a.prototype.divn=function(e){return this.clone().idivn(e)},a.prototype.egcd=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r=new a(1),n=new a(0),o=new a(0),h=new a(1),d=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++d;for(var c=i.clone(),l=t.clone();!t.isZero();){for(var u=0,f=1;0==(t.words[0]&f)&&u<26;++u,f<<=1);if(u>0)for(t.iushrn(u);u-- >0;)(r.isOdd()||n.isOdd())&&(r.iadd(c),n.isub(l)),r.iushrn(1),n.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(o.isOdd()||h.isOdd())&&(o.iadd(c),h.isub(l)),o.iushrn(1),h.iushrn(1);t.cmp(i)>=0?(t.isub(i),r.isub(o),n.isub(h)):(i.isub(t),o.isub(r),h.isub(n))}return{a:o,b:h,gcd:i.iushln(d)}},a.prototype._invmp=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r,n=new a(1),o=new a(0),h=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var d=0,c=1;0==(t.words[0]&c)&&d<26;++d,c<<=1);if(d>0)for(t.iushrn(d);d-- >0;)n.isOdd()&&n.iadd(h),n.iushrn(1);for(var l=0,u=1;0==(i.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(i.iushrn(l);l-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(o)):(i.isub(t),o.isub(n))}return(r=0===t.cmpn(1)?n:o).cmpn(0)<0&&r.iadd(e),r},a.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),i=e.clone();t.negative=0,i.negative=0;for(var s=0;t.isEven()&&i.isEven();s++)t.iushrn(1),i.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;i.isEven();)i.iushrn(1);var r=t.cmp(i);if(r<0){var a=t;t=i,i=a}else if(0===r||0===i.cmpn(1))break;t.isub(i)}return i.iushln(s)},a.prototype.invm=function(e){return this.egcd(e).a.umod(e)},a.prototype.isEven=function(){return 0==(1&this.words[0])},a.prototype.isOdd=function(){return 1==(1&this.words[0])},a.prototype.andln=function(e){return this.words[0]&e},a.prototype.bincn=function(e){s("number"==typeof e);var t=e%26,i=(e-t)/26,r=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=r,this;for(var a=r,n=i;0!==a&&n<this.length;n++){var o=0|this.words[n];a=(o+=a)>>>26,o&=67108863,this.words[n]=o}return 0!==a&&(this.words[n]=a,this.length++),this},a.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},a.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)t=1;else{i&&(e=-e),s(e<=67108863,"Number is too big");var r=0|this.words[0];t=r===e?0:r<e?-1:1}return 0!==this.negative?0|-t:t},a.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},a.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,i=this.length-1;i>=0;i--){var s=0|this.words[i],r=0|e.words[i];if(s!==r){s<r?t=-1:s>r&&(t=1);break}}return t},a.prototype.gtn=function(e){return 1===this.cmpn(e)},a.prototype.gt=function(e){return 1===this.cmp(e)},a.prototype.gten=function(e){return this.cmpn(e)>=0},a.prototype.gte=function(e){return this.cmp(e)>=0},a.prototype.ltn=function(e){return-1===this.cmpn(e)},a.prototype.lt=function(e){return-1===this.cmp(e)},a.prototype.lten=function(e){return this.cmpn(e)<=0},a.prototype.lte=function(e){return this.cmp(e)<=0},a.prototype.eqn=function(e){return 0===this.cmpn(e)},a.prototype.eq=function(e){return 0===this.cmp(e)},a.red=function(e){return new T(e)},a.prototype.toRed=function(e){return s(!this.red,"Already a number in reduction context"),s(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},a.prototype.fromRed=function(){return s(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},a.prototype._forceRed=function(e){return this.red=e,this},a.prototype.forceRed=function(e){return s(!this.red,"Already a number in reduction context"),this._forceRed(e)},a.prototype.redAdd=function(e){return s(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},a.prototype.redIAdd=function(e){return s(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},a.prototype.redSub=function(e){return s(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},a.prototype.redISub=function(e){return s(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},a.prototype.redShl=function(e){return s(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},a.prototype.redMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},a.prototype.redIMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},a.prototype.redSqr=function(){return s(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},a.prototype.redISqr=function(){return s(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},a.prototype.redSqrt=function(){return s(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},a.prototype.redInvm=function(){return s(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},a.prototype.redNeg=function(){return s(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},a.prototype.redPow=function(e){return s(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var y={k256:null,p224:null,p192:null,p25519:null};function b(e,t){this.name=e,this.p=new a(t,16),this.n=this.p.bitLength(),this.k=new a(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){b.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){b.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function S(){b.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function k(){b.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function T(e){if("string"==typeof e){var t=a._prime(e);this.m=t.p,this.prime=t}else s(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function _(e){T.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new a(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}b.prototype._tmp=function(){var e=new a(null);return e.words=new Array(Math.ceil(this.n/13)),e},b.prototype.ireduce=function(e){var t,i=e;do{this.split(i,this.tmp),t=(i=(i=this.imulK(i)).iadd(this.tmp)).bitLength()}while(t>this.n);var s=t<this.n?-1:i.ucmp(this.p);return 0===s?(i.words[0]=0,i.length=1):s>0?i.isub(this.p):void 0!==i.strip?i.strip():i._strip(),i},b.prototype.split=function(e,t){e.iushrn(this.n,0,t)},b.prototype.imulK=function(e){return e.imul(this.k)},r(v,b),v.prototype.split=function(e,t){for(var i=4194303,s=Math.min(e.length,9),r=0;r<s;r++)t.words[r]=e.words[r];if(t.length=s,e.length<=9)return e.words[0]=0,void(e.length=1);var a=e.words[9];for(t.words[t.length++]=a&i,r=10;r<e.length;r++){var n=0|e.words[r];e.words[r-10]=(n&i)<<4|a>>>22,a=n}a>>>=22,e.words[r-10]=a,0===a&&e.length>10?e.length-=10:e.length-=9},v.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,i=0;i<e.length;i++){var s=0|e.words[i];t+=977*s,e.words[i]=67108863&t,t=64*s+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},r(w,b),r(S,b),r(k,b),k.prototype.imulK=function(e){for(var t=0,i=0;i<e.length;i++){var s=19*(0|e.words[i])+t,r=67108863&s;s>>>=26,e.words[i]=r,t=s}return 0!==t&&(e.words[e.length++]=t),e},a._prime=function(e){if(y[e])return y[e];var t;if("k256"===e)t=new v;else if("p224"===e)t=new w;else if("p192"===e)t=new S;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new k}return y[e]=t,t},T.prototype._verify1=function(e){s(0===e.negative,"red works only with positives"),s(e.red,"red works only with red numbers")},T.prototype._verify2=function(e,t){s(0==(e.negative|t.negative),"red works only with positives"),s(e.red&&e.red===t.red,"red works only with red numbers")},T.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},T.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},T.prototype.add=function(e,t){this._verify2(e,t);var i=e.add(t);return i.cmp(this.m)>=0&&i.isub(this.m),i._forceRed(this)},T.prototype.iadd=function(e,t){this._verify2(e,t);var i=e.iadd(t);return i.cmp(this.m)>=0&&i.isub(this.m),i},T.prototype.sub=function(e,t){this._verify2(e,t);var i=e.sub(t);return i.cmpn(0)<0&&i.iadd(this.m),i._forceRed(this)},T.prototype.isub=function(e,t){this._verify2(e,t);var i=e.isub(t);return i.cmpn(0)<0&&i.iadd(this.m),i},T.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},T.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},T.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},T.prototype.isqr=function(e){return this.imul(e,e.clone())},T.prototype.sqr=function(e){return this.mul(e,e)},T.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(s(t%2==1),3===t){var i=this.m.add(new a(1)).iushrn(2);return this.pow(e,i)}for(var r=this.m.subn(1),n=0;!r.isZero()&&0===r.andln(1);)n++,r.iushrn(1);s(!r.isZero());var o=new a(1).toRed(this),h=o.redNeg(),d=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new a(2*c*c).toRed(this);0!==this.pow(c,d).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,r),u=this.pow(e,r.addn(1).iushrn(1)),f=this.pow(e,r),p=n;0!==f.cmp(o);){for(var m=f,g=0;0!==m.cmp(o);g++)m=m.redSqr();s(g<p);var y=this.pow(l,new a(1).iushln(p-g-1));u=u.redMul(y),l=y.redSqr(),f=f.redMul(l),p=g}return u},T.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},T.prototype.pow=function(e,t){if(t.isZero())return new a(1).toRed(this);if(0===t.cmpn(1))return e.clone();var i=new Array(16);i[0]=new a(1).toRed(this),i[1]=e;for(var s=2;s<i.length;s++)i[s]=this.mul(i[s-1],e);var r=i[0],n=0,o=0,h=t.bitLength()%26;for(0===h&&(h=26),s=t.length-1;s>=0;s--){for(var d=t.words[s],c=h-1;c>=0;c--){var l=d>>c&1;r!==i[0]&&(r=this.sqr(r)),0!==l||0!==n?(n<<=1,n|=l,(4===++o||0===s&&0===c)&&(r=this.mul(r,i[n]),o=0,n=0)):o=0}h=26}return r},T.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},T.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},a.mont=function(e){return new _(e)},r(_,T),_.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},_.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},_.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var i=e.imul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),a=r;return r.cmp(this.m)>=0?a=r.isub(this.m):r.cmpn(0)<0&&(a=r.iadd(this.m)),a._forceRed(this)},_.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new a(0)._forceRed(this);var i=e.mul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),n=r;return r.cmp(this.m)>=0?n=r.isub(this.m):r.cmpn(0)<0&&(n=r.iadd(this.m)),n._forceRed(this)},_.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=i.nmd(e),this)},86266:function(e,t,i){"use strict";var s=t;s.version=i(18597).i8,s.utils=i(80953),s.rand=i(29931),s.curve=i(88254),s.curves=i(45427),s.ec=i(57954),s.eddsa=i(65980)},4918:function(e,t,i){"use strict";var s=i(73785),r=i(80953),a=r.getNAF,n=r.getJSF,o=r.assert;function h(e,t){this.type=e,this.p=new s(t.p,16),this.red=t.prime?s.red(t.prime):s.mont(this.p),this.zero=new s(0).toRed(this.red),this.one=new s(1).toRed(this.red),this.two=new s(2).toRed(this.red),this.n=t.n&&new s(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4),this._bitLength=this.n?this.n.bitLength():0;var i=this.n&&this.p.div(this.n);!i||i.cmpn(100)>0?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function d(e,t){this.curve=e,this.type=t,this.precomputed=null}e.exports=h,h.prototype.point=function(){throw new Error("Not implemented")},h.prototype.validate=function(){throw new Error("Not implemented")},h.prototype._fixedNafMul=function(e,t){o(e.precomputed);var i=e._getDoubles(),s=a(t,1,this._bitLength),r=(1<<i.step+1)-(i.step%2==0?2:1);r/=3;var n,h,d=[];for(n=0;n<s.length;n+=i.step){h=0;for(var c=n+i.step-1;c>=n;c--)h=(h<<1)+s[c];d.push(h)}for(var l=this.jpoint(null,null,null),u=this.jpoint(null,null,null),f=r;f>0;f--){for(n=0;n<d.length;n++)(h=d[n])===f?u=u.mixedAdd(i.points[n]):h===-f&&(u=u.mixedAdd(i.points[n].neg()));l=l.add(u)}return l.toP()},h.prototype._wnafMul=function(e,t){var i=4,s=e._getNAFPoints(i);i=s.wnd;for(var r=s.points,n=a(t,i,this._bitLength),h=this.jpoint(null,null,null),d=n.length-1;d>=0;d--){for(var c=0;d>=0&&0===n[d];d--)c++;if(d>=0&&c++,h=h.dblp(c),d<0)break;var l=n[d];o(0!==l),h="affine"===e.type?l>0?h.mixedAdd(r[l-1>>1]):h.mixedAdd(r[-l-1>>1].neg()):l>0?h.add(r[l-1>>1]):h.add(r[-l-1>>1].neg())}return"affine"===e.type?h.toP():h},h.prototype._wnafMulAdd=function(e,t,i,s,r){var o,h,d,c=this._wnafT1,l=this._wnafT2,u=this._wnafT3,f=0;for(o=0;o<s;o++){var p=(d=t[o])._getNAFPoints(e);c[o]=p.wnd,l[o]=p.points}for(o=s-1;o>=1;o-=2){var m=o-1,g=o;if(1===c[m]&&1===c[g]){var y=[t[m],null,null,t[g]];0===t[m].y.cmp(t[g].y)?(y[1]=t[m].add(t[g]),y[2]=t[m].toJ().mixedAdd(t[g].neg())):0===t[m].y.cmp(t[g].y.redNeg())?(y[1]=t[m].toJ().mixedAdd(t[g]),y[2]=t[m].add(t[g].neg())):(y[1]=t[m].toJ().mixedAdd(t[g]),y[2]=t[m].toJ().mixedAdd(t[g].neg()));var b=[-3,-1,-5,-7,0,7,5,1,3],v=n(i[m],i[g]);for(f=Math.max(v[0].length,f),u[m]=new Array(f),u[g]=new Array(f),h=0;h<f;h++){var w=0|v[0][h],S=0|v[1][h];u[m][h]=b[3*(w+1)+(S+1)],u[g][h]=0,l[m]=y}}else u[m]=a(i[m],c[m],this._bitLength),u[g]=a(i[g],c[g],this._bitLength),f=Math.max(u[m].length,f),f=Math.max(u[g].length,f)}var k=this.jpoint(null,null,null),T=this._wnafT4;for(o=f;o>=0;o--){for(var _=0;o>=0;){var O=!0;for(h=0;h<s;h++)T[h]=0|u[h][o],0!==T[h]&&(O=!1);if(!O)break;_++,o--}if(o>=0&&_++,k=k.dblp(_),o<0)break;for(h=0;h<s;h++){var M=T[h];0!==M&&(M>0?d=l[h][M-1>>1]:M<0&&(d=l[h][-M-1>>1].neg()),k="affine"===d.type?k.mixedAdd(d):k.add(d))}}for(o=0;o<s;o++)l[o]=null;return r?k:k.toP()},h.BasePoint=d,d.prototype.eq=function(){throw new Error("Not implemented")},d.prototype.validate=function(){return this.curve.validate(this)},h.prototype.decodePoint=function(e,t){e=r.toArray(e,t);var i=this.p.byteLength();if((4===e[0]||6===e[0]||7===e[0])&&e.length-1==2*i)return 6===e[0]?o(e[e.length-1]%2==0):7===e[0]&&o(e[e.length-1]%2==1),this.point(e.slice(1,1+i),e.slice(1+i,1+2*i));if((2===e[0]||3===e[0])&&e.length-1===i)return this.pointFromX(e.slice(1,1+i),3===e[0]);throw new Error("Unknown point format")},d.prototype.encodeCompressed=function(e){return this.encode(e,!0)},d.prototype._encode=function(e){var t=this.curve.p.byteLength(),i=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(i):[4].concat(i,this.getY().toArray("be",t))},d.prototype.encode=function(e,t){return r.encode(this._encode(t),e)},d.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},d.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return!!t&&t.points.length>=Math.ceil((e.bitLength()+1)/t.step)},d.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var i=[this],s=this,r=0;r<t;r+=e){for(var a=0;a<e;a++)s=s.dbl();i.push(s)}return{step:e,points:i}},d.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],i=(1<<e)-1,s=1===i?null:this.dbl(),r=1;r<i;r++)t[r]=t[r-1].add(s);return{wnd:e,points:t}},d.prototype._getBeta=function(){return null},d.prototype.dblp=function(e){for(var t=this,i=0;i<e;i++)t=t.dbl();return t}},31138:function(e,t,i){"use strict";var s=i(80953),r=i(73785),a=i(35717),n=i(4918),o=s.assert;function h(e){this.twisted=1!=(0|e.a),this.mOneA=this.twisted&&-1==(0|e.a),this.extended=this.mOneA,n.call(this,"edwards",e),this.a=new r(e.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new r(e.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new r(e.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),o(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|e.c)}function d(e,t,i,s,a){n.BasePoint.call(this,e,"projective"),null===t&&null===i&&null===s?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new r(t,16),this.y=new r(i,16),this.z=s?new r(s,16):this.curve.one,this.t=a&&new r(a,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}a(h,n),e.exports=h,h.prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)},h.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)},h.prototype.jpoint=function(e,t,i,s){return this.point(e,t,i,s)},h.prototype.pointFromX=function(e,t){(e=new r(e,16)).red||(e=e.toRed(this.red));var i=e.redSqr(),s=this.c2.redSub(this.a.redMul(i)),a=this.one.redSub(this.c2.redMul(this.d).redMul(i)),n=s.redMul(a.redInvm()),o=n.redSqrt();if(0!==o.redSqr().redSub(n).cmp(this.zero))throw new Error("invalid point");var h=o.fromRed().isOdd();return(t&&!h||!t&&h)&&(o=o.redNeg()),this.point(e,o)},h.prototype.pointFromY=function(e,t){(e=new r(e,16)).red||(e=e.toRed(this.red));var i=e.redSqr(),s=i.redSub(this.c2),a=i.redMul(this.d).redMul(this.c2).redSub(this.a),n=s.redMul(a.redInvm());if(0===n.cmp(this.zero)){if(t)throw new Error("invalid point");return this.point(this.zero,e)}var o=n.redSqrt();if(0!==o.redSqr().redSub(n).cmp(this.zero))throw new Error("invalid point");return o.fromRed().isOdd()!==t&&(o=o.redNeg()),this.point(o,e)},h.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var t=e.x.redSqr(),i=e.y.redSqr(),s=t.redMul(this.a).redAdd(i),r=this.c2.redMul(this.one.redAdd(this.d.redMul(t).redMul(i)));return 0===s.cmp(r)},a(d,n.BasePoint),h.prototype.pointFromJSON=function(e){return d.fromJSON(this,e)},h.prototype.point=function(e,t,i,s){return new d(this,e,t,i,s)},d.fromJSON=function(e,t){return new d(e,t[0],t[1],t[2])},d.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},d.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&(0===this.y.cmp(this.z)||this.zOne&&0===this.y.cmp(this.curve.c))},d.prototype._extDbl=function(){var e=this.x.redSqr(),t=this.y.redSqr(),i=this.z.redSqr();i=i.redIAdd(i);var s=this.curve._mulA(e),r=this.x.redAdd(this.y).redSqr().redISub(e).redISub(t),a=s.redAdd(t),n=a.redSub(i),o=s.redSub(t),h=r.redMul(n),d=a.redMul(o),c=r.redMul(o),l=n.redMul(a);return this.curve.point(h,d,l,c)},d.prototype._projDbl=function(){var e,t,i,s,r,a,n=this.x.redAdd(this.y).redSqr(),o=this.x.redSqr(),h=this.y.redSqr();if(this.curve.twisted){var d=(s=this.curve._mulA(o)).redAdd(h);this.zOne?(e=n.redSub(o).redSub(h).redMul(d.redSub(this.curve.two)),t=d.redMul(s.redSub(h)),i=d.redSqr().redSub(d).redSub(d)):(r=this.z.redSqr(),a=d.redSub(r).redISub(r),e=n.redSub(o).redISub(h).redMul(a),t=d.redMul(s.redSub(h)),i=d.redMul(a))}else s=o.redAdd(h),r=this.curve._mulC(this.z).redSqr(),a=s.redSub(r).redSub(r),e=this.curve._mulC(n.redISub(s)).redMul(a),t=this.curve._mulC(s).redMul(o.redISub(h)),i=s.redMul(a);return this.curve.point(e,t,i)},d.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},d.prototype._extAdd=function(e){var t=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),i=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),s=this.t.redMul(this.curve.dd).redMul(e.t),r=this.z.redMul(e.z.redAdd(e.z)),a=i.redSub(t),n=r.redSub(s),o=r.redAdd(s),h=i.redAdd(t),d=a.redMul(n),c=o.redMul(h),l=a.redMul(h),u=n.redMul(o);return this.curve.point(d,c,u,l)},d.prototype._projAdd=function(e){var t,i,s=this.z.redMul(e.z),r=s.redSqr(),a=this.x.redMul(e.x),n=this.y.redMul(e.y),o=this.curve.d.redMul(a).redMul(n),h=r.redSub(o),d=r.redAdd(o),c=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(a).redISub(n),l=s.redMul(h).redMul(c);return this.curve.twisted?(t=s.redMul(d).redMul(n.redSub(this.curve._mulA(a))),i=h.redMul(d)):(t=s.redMul(d).redMul(n.redSub(a)),i=this.curve._mulC(h).redMul(d)),this.curve.point(l,t,i)},d.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)},d.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)},d.prototype.mulAdd=function(e,t,i){return this.curve._wnafMulAdd(1,[this,t],[e,i],2,!1)},d.prototype.jmulAdd=function(e,t,i){return this.curve._wnafMulAdd(1,[this,t],[e,i],2,!0)},d.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this},d.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},d.prototype.getX=function(){return this.normalize(),this.x.fromRed()},d.prototype.getY=function(){return this.normalize(),this.y.fromRed()},d.prototype.eq=function(e){return this===e||0===this.getX().cmp(e.getX())&&0===this.getY().cmp(e.getY())},d.prototype.eqXToP=function(e){var t=e.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(t))return!0;for(var i=e.clone(),s=this.curve.redN.redMul(this.z);;){if(i.iadd(this.curve.n),i.cmp(this.curve.p)>=0)return!1;if(t.redIAdd(s),0===this.x.cmp(t))return!0}},d.prototype.toP=d.prototype.normalize,d.prototype.mixedAdd=d.prototype.add},88254:function(e,t,i){"use strict";var s=t;s.base=i(4918),s.short=i(6673),s.mont=i(22881),s.edwards=i(31138)},22881:function(e,t,i){"use strict";var s=i(73785),r=i(35717),a=i(4918),n=i(80953);function o(e){a.call(this,"mont",e),this.a=new s(e.a,16).toRed(this.red),this.b=new s(e.b,16).toRed(this.red),this.i4=new s(4).toRed(this.red).redInvm(),this.two=new s(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function h(e,t,i){a.BasePoint.call(this,e,"projective"),null===t&&null===i?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new s(t,16),this.z=new s(i,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}r(o,a),e.exports=o,o.prototype.validate=function(e){var t=e.normalize().x,i=t.redSqr(),s=i.redMul(t).redAdd(i.redMul(this.a)).redAdd(t);return 0===s.redSqrt().redSqr().cmp(s)},r(h,a.BasePoint),o.prototype.decodePoint=function(e,t){return this.point(n.toArray(e,t),1)},o.prototype.point=function(e,t){return new h(this,e,t)},o.prototype.pointFromJSON=function(e){return h.fromJSON(this,e)},h.prototype.precompute=function(){},h.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},h.fromJSON=function(e,t){return new h(e,t[0],t[1]||e.one)},h.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},h.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},h.prototype.dbl=function(){var e=this.x.redAdd(this.z).redSqr(),t=this.x.redSub(this.z).redSqr(),i=e.redSub(t),s=e.redMul(t),r=i.redMul(t.redAdd(this.curve.a24.redMul(i)));return this.curve.point(s,r)},h.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},h.prototype.diffAdd=function(e,t){var i=this.x.redAdd(this.z),s=this.x.redSub(this.z),r=e.x.redAdd(e.z),a=e.x.redSub(e.z).redMul(i),n=r.redMul(s),o=t.z.redMul(a.redAdd(n).redSqr()),h=t.x.redMul(a.redISub(n).redSqr());return this.curve.point(o,h)},h.prototype.mul=function(e){for(var t=e.clone(),i=this,s=this.curve.point(null,null),r=[];0!==t.cmpn(0);t.iushrn(1))r.push(t.andln(1));for(var a=r.length-1;a>=0;a--)0===r[a]?(i=i.diffAdd(s,this),s=s.dbl()):(s=i.diffAdd(s,this),i=i.dbl());return s},h.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},h.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},h.prototype.eq=function(e){return 0===this.getX().cmp(e.getX())},h.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},h.prototype.getX=function(){return this.normalize(),this.x.fromRed()}},6673:function(e,t,i){"use strict";var s=i(80953),r=i(73785),a=i(35717),n=i(4918),o=s.assert;function h(e){n.call(this,"short",e),this.a=new r(e.a,16).toRed(this.red),this.b=new r(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}function d(e,t,i,s){n.BasePoint.call(this,e,"affine"),null===t&&null===i?(this.x=null,this.y=null,this.inf=!0):(this.x=new r(t,16),this.y=new r(i,16),s&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.inf=!1)}function c(e,t,i,s){n.BasePoint.call(this,e,"jacobian"),null===t&&null===i&&null===s?(this.x=this.curve.one,this.y=this.curve.one,this.z=new r(0)):(this.x=new r(t,16),this.y=new r(i,16),this.z=new r(s,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}a(h,n),e.exports=h,h.prototype._getEndomorphism=function(e){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var t,i;if(e.beta)t=new r(e.beta,16).toRed(this.red);else{var s=this._getEndoRoots(this.p);t=(t=s[0].cmp(s[1])<0?s[0]:s[1]).toRed(this.red)}if(e.lambda)i=new r(e.lambda,16);else{var a=this._getEndoRoots(this.n);0===this.g.mul(a[0]).x.cmp(this.g.x.redMul(t))?i=a[0]:(i=a[1],o(0===this.g.mul(i).x.cmp(this.g.x.redMul(t))))}return{beta:t,lambda:i,basis:e.basis?e.basis.map((function(e){return{a:new r(e.a,16),b:new r(e.b,16)}})):this._getEndoBasis(i)}}},h.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:r.mont(e),i=new r(2).toRed(t).redInvm(),s=i.redNeg(),a=new r(3).toRed(t).redNeg().redSqrt().redMul(i);return[s.redAdd(a).fromRed(),s.redSub(a).fromRed()]},h.prototype._getEndoBasis=function(e){for(var t,i,s,a,n,o,h,d,c,l=this.n.ushrn(Math.floor(this.n.bitLength()/2)),u=e,f=this.n.clone(),p=new r(1),m=new r(0),g=new r(0),y=new r(1),b=0;0!==u.cmpn(0);){var v=f.div(u);d=f.sub(v.mul(u)),c=g.sub(v.mul(p));var w=y.sub(v.mul(m));if(!s&&d.cmp(l)<0)t=h.neg(),i=p,s=d.neg(),a=c;else if(s&&2==++b)break;h=d,f=u,u=d,g=p,p=c,y=m,m=w}n=d.neg(),o=c;var S=s.sqr().add(a.sqr());return n.sqr().add(o.sqr()).cmp(S)>=0&&(n=t,o=i),s.negative&&(s=s.neg(),a=a.neg()),n.negative&&(n=n.neg(),o=o.neg()),[{a:s,b:a},{a:n,b:o}]},h.prototype._endoSplit=function(e){var t=this.endo.basis,i=t[0],s=t[1],r=s.b.mul(e).divRound(this.n),a=i.b.neg().mul(e).divRound(this.n),n=r.mul(i.a),o=a.mul(s.a),h=r.mul(i.b),d=a.mul(s.b);return{k1:e.sub(n).sub(o),k2:h.add(d).neg()}},h.prototype.pointFromX=function(e,t){(e=new r(e,16)).red||(e=e.toRed(this.red));var i=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),s=i.redSqrt();if(0!==s.redSqr().redSub(i).cmp(this.zero))throw new Error("invalid point");var a=s.fromRed().isOdd();return(t&&!a||!t&&a)&&(s=s.redNeg()),this.point(e,s)},h.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,i=e.y,s=this.a.redMul(t),r=t.redSqr().redMul(t).redIAdd(s).redIAdd(this.b);return 0===i.redSqr().redISub(r).cmpn(0)},h.prototype._endoWnafMulAdd=function(e,t,i){for(var s=this._endoWnafT1,r=this._endoWnafT2,a=0;a<e.length;a++){var n=this._endoSplit(t[a]),o=e[a],h=o._getBeta();n.k1.negative&&(n.k1.ineg(),o=o.neg(!0)),n.k2.negative&&(n.k2.ineg(),h=h.neg(!0)),s[2*a]=o,s[2*a+1]=h,r[2*a]=n.k1,r[2*a+1]=n.k2}for(var d=this._wnafMulAdd(1,s,r,2*a,i),c=0;c<2*a;c++)s[c]=null,r[c]=null;return d},a(d,n.BasePoint),h.prototype.point=function(e,t,i){return new d(this,e,t,i)},h.prototype.pointFromJSON=function(e,t){return d.fromJSON(this,e,t)},d.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var i=this.curve,s=function(e){return i.point(e.x.redMul(i.endo.beta),e.y)};e.beta=t,t.precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(s)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(s)}}}return t}},d.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},d.fromJSON=function(e,t,i){"string"==typeof t&&(t=JSON.parse(t));var s=e.point(t[0],t[1],i);if(!t[2])return s;function r(t){return e.point(t[0],t[1],i)}var a=t[2];return s.precomputed={beta:null,doubles:a.doubles&&{step:a.doubles.step,points:[s].concat(a.doubles.points.map(r))},naf:a.naf&&{wnd:a.naf.wnd,points:[s].concat(a.naf.points.map(r))}},s},d.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},d.prototype.isInfinity=function(){return this.inf},d.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(0===this.x.cmp(e.x))return this.curve.point(null,null);var t=this.y.redSub(e.y);0!==t.cmpn(0)&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var i=t.redSqr().redISub(this.x).redISub(e.x),s=t.redMul(this.x.redSub(i)).redISub(this.y);return this.curve.point(i,s)},d.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(0===e.cmpn(0))return this.curve.point(null,null);var t=this.curve.a,i=this.x.redSqr(),s=e.redInvm(),r=i.redAdd(i).redIAdd(i).redIAdd(t).redMul(s),a=r.redSqr().redISub(this.x.redAdd(this.x)),n=r.redMul(this.x.redSub(a)).redISub(this.y);return this.curve.point(a,n)},d.prototype.getX=function(){return this.x.fromRed()},d.prototype.getY=function(){return this.y.fromRed()},d.prototype.mul=function(e){return e=new r(e,16),this.isInfinity()?this:this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},d.prototype.mulAdd=function(e,t,i){var s=[this,t],r=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(s,r):this.curve._wnafMulAdd(1,s,r,2)},d.prototype.jmulAdd=function(e,t,i){var s=[this,t],r=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(s,r,!0):this.curve._wnafMulAdd(1,s,r,2,!0)},d.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||0===this.x.cmp(e.x)&&0===this.y.cmp(e.y))},d.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var i=this.precomputed,s=function(e){return e.neg()};t.precomputed={naf:i.naf&&{wnd:i.naf.wnd,points:i.naf.points.map(s)},doubles:i.doubles&&{step:i.doubles.step,points:i.doubles.points.map(s)}}}return t},d.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},a(c,n.BasePoint),h.prototype.jpoint=function(e,t,i){return new c(this,e,t,i)},c.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),i=this.x.redMul(t),s=this.y.redMul(t).redMul(e);return this.curve.point(i,s)},c.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},c.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),i=this.z.redSqr(),s=this.x.redMul(t),r=e.x.redMul(i),a=this.y.redMul(t.redMul(e.z)),n=e.y.redMul(i.redMul(this.z)),o=s.redSub(r),h=a.redSub(n);if(0===o.cmpn(0))return 0!==h.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var d=o.redSqr(),c=d.redMul(o),l=s.redMul(d),u=h.redSqr().redIAdd(c).redISub(l).redISub(l),f=h.redMul(l.redISub(u)).redISub(a.redMul(c)),p=this.z.redMul(e.z).redMul(o);return this.curve.jpoint(u,f,p)},c.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),i=this.x,s=e.x.redMul(t),r=this.y,a=e.y.redMul(t).redMul(this.z),n=i.redSub(s),o=r.redSub(a);if(0===n.cmpn(0))return 0!==o.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var h=n.redSqr(),d=h.redMul(n),c=i.redMul(h),l=o.redSqr().redIAdd(d).redISub(c).redISub(c),u=o.redMul(c.redISub(l)).redISub(r.redMul(d)),f=this.z.redMul(n);return this.curve.jpoint(l,u,f)},c.prototype.dblp=function(e){if(0===e)return this;if(this.isInfinity())return this;if(!e)return this.dbl();var t;if(this.curve.zeroA||this.curve.threeA){var i=this;for(t=0;t<e;t++)i=i.dbl();return i}var s=this.curve.a,r=this.curve.tinv,a=this.x,n=this.y,o=this.z,h=o.redSqr().redSqr(),d=n.redAdd(n);for(t=0;t<e;t++){var c=a.redSqr(),l=d.redSqr(),u=l.redSqr(),f=c.redAdd(c).redIAdd(c).redIAdd(s.redMul(h)),p=a.redMul(l),m=f.redSqr().redISub(p.redAdd(p)),g=p.redISub(m),y=f.redMul(g);y=y.redIAdd(y).redISub(u);var b=d.redMul(o);t+1<e&&(h=h.redMul(u)),a=m,o=b,d=y}return this.curve.jpoint(a,d.redMul(r),o)},c.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},c.prototype._zeroDbl=function(){var e,t,i;if(this.zOne){var s=this.x.redSqr(),r=this.y.redSqr(),a=r.redSqr(),n=this.x.redAdd(r).redSqr().redISub(s).redISub(a);n=n.redIAdd(n);var o=s.redAdd(s).redIAdd(s),h=o.redSqr().redISub(n).redISub(n),d=a.redIAdd(a);d=(d=d.redIAdd(d)).redIAdd(d),e=h,t=o.redMul(n.redISub(h)).redISub(d),i=this.y.redAdd(this.y)}else{var c=this.x.redSqr(),l=this.y.redSqr(),u=l.redSqr(),f=this.x.redAdd(l).redSqr().redISub(c).redISub(u);f=f.redIAdd(f);var p=c.redAdd(c).redIAdd(c),m=p.redSqr(),g=u.redIAdd(u);g=(g=g.redIAdd(g)).redIAdd(g),e=m.redISub(f).redISub(f),t=p.redMul(f.redISub(e)).redISub(g),i=(i=this.y.redMul(this.z)).redIAdd(i)}return this.curve.jpoint(e,t,i)},c.prototype._threeDbl=function(){var e,t,i;if(this.zOne){var s=this.x.redSqr(),r=this.y.redSqr(),a=r.redSqr(),n=this.x.redAdd(r).redSqr().redISub(s).redISub(a);n=n.redIAdd(n);var o=s.redAdd(s).redIAdd(s).redIAdd(this.curve.a),h=o.redSqr().redISub(n).redISub(n);e=h;var d=a.redIAdd(a);d=(d=d.redIAdd(d)).redIAdd(d),t=o.redMul(n.redISub(h)).redISub(d),i=this.y.redAdd(this.y)}else{var c=this.z.redSqr(),l=this.y.redSqr(),u=this.x.redMul(l),f=this.x.redSub(c).redMul(this.x.redAdd(c));f=f.redAdd(f).redIAdd(f);var p=u.redIAdd(u),m=(p=p.redIAdd(p)).redAdd(p);e=f.redSqr().redISub(m),i=this.y.redAdd(this.z).redSqr().redISub(l).redISub(c);var g=l.redSqr();g=(g=(g=g.redIAdd(g)).redIAdd(g)).redIAdd(g),t=f.redMul(p.redISub(e)).redISub(g)}return this.curve.jpoint(e,t,i)},c.prototype._dbl=function(){var e=this.curve.a,t=this.x,i=this.y,s=this.z,r=s.redSqr().redSqr(),a=t.redSqr(),n=i.redSqr(),o=a.redAdd(a).redIAdd(a).redIAdd(e.redMul(r)),h=t.redAdd(t),d=(h=h.redIAdd(h)).redMul(n),c=o.redSqr().redISub(d.redAdd(d)),l=d.redISub(c),u=n.redSqr();u=(u=(u=u.redIAdd(u)).redIAdd(u)).redIAdd(u);var f=o.redMul(l).redISub(u),p=i.redAdd(i).redMul(s);return this.curve.jpoint(c,f,p)},c.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),i=this.z.redSqr(),s=t.redSqr(),r=e.redAdd(e).redIAdd(e),a=r.redSqr(),n=this.x.redAdd(t).redSqr().redISub(e).redISub(s),o=(n=(n=(n=n.redIAdd(n)).redAdd(n).redIAdd(n)).redISub(a)).redSqr(),h=s.redIAdd(s);h=(h=(h=h.redIAdd(h)).redIAdd(h)).redIAdd(h);var d=r.redIAdd(n).redSqr().redISub(a).redISub(o).redISub(h),c=t.redMul(d);c=(c=c.redIAdd(c)).redIAdd(c);var l=this.x.redMul(o).redISub(c);l=(l=l.redIAdd(l)).redIAdd(l);var u=this.y.redMul(d.redMul(h.redISub(d)).redISub(n.redMul(o)));u=(u=(u=u.redIAdd(u)).redIAdd(u)).redIAdd(u);var f=this.z.redAdd(n).redSqr().redISub(i).redISub(o);return this.curve.jpoint(l,u,f)},c.prototype.mul=function(e,t){return e=new r(e,t),this.curve._wnafMul(this,e)},c.prototype.eq=function(e){if("affine"===e.type)return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),i=e.z.redSqr();if(0!==this.x.redMul(i).redISub(e.x.redMul(t)).cmpn(0))return!1;var s=t.redMul(this.z),r=i.redMul(e.z);return 0===this.y.redMul(r).redISub(e.y.redMul(s)).cmpn(0)},c.prototype.eqXToP=function(e){var t=this.z.redSqr(),i=e.toRed(this.curve.red).redMul(t);if(0===this.x.cmp(i))return!0;for(var s=e.clone(),r=this.curve.redN.redMul(t);;){if(s.iadd(this.curve.n),s.cmp(this.curve.p)>=0)return!1;if(i.redIAdd(r),0===this.x.cmp(i))return!0}},c.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},c.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}},45427:function(e,t,i){"use strict";var s,r=t,a=i(33715),n=i(88254),o=i(80953).assert;function h(e){"short"===e.type?this.curve=new n.short(e):"edwards"===e.type?this.curve=new n.edwards(e):this.curve=new n.mont(e),this.g=this.curve.g,this.n=this.curve.n,this.hash=e.hash,o(this.g.validate(),"Invalid curve"),o(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function d(e,t){Object.defineProperty(r,e,{configurable:!0,enumerable:!0,get:function(){var i=new h(t);return Object.defineProperty(r,e,{configurable:!0,enumerable:!0,value:i}),i}})}r.PresetCurve=h,d("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:a.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),d("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:a.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),d("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:a.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),d("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:a.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),d("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:a.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),d("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:a.sha256,gRed:!1,g:["9"]}),d("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:a.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{s=i(91037)}catch(e){s=void 0}d("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:a.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",s]})},57954:function(e,t,i){"use strict";var s=i(73785),r=i(2156),a=i(80953),n=i(45427),o=i(29931),h=a.assert,d=i(31251),c=i(90611);function l(e){if(!(this instanceof l))return new l(e);"string"==typeof e&&(h(Object.prototype.hasOwnProperty.call(n,e),"Unknown curve "+e),e=n[e]),e instanceof n.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}e.exports=l,l.prototype.keyPair=function(e){return new d(this,e)},l.prototype.keyFromPrivate=function(e,t){return d.fromPrivate(this,e,t)},l.prototype.keyFromPublic=function(e,t){return d.fromPublic(this,e,t)},l.prototype.genKeyPair=function(e){e||(e={});for(var t=new r({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||o(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),i=this.n.byteLength(),a=this.n.sub(new s(2));;){var n=new s(t.generate(i));if(!(n.cmp(a)>0))return n.iaddn(1),this.keyFromPrivate(n)}},l.prototype._truncateToN=function(e,t){var i=8*e.byteLength()-this.n.bitLength();return i>0&&(e=e.ushrn(i)),!t&&e.cmp(this.n)>=0?e.sub(this.n):e},l.prototype.sign=function(e,t,i,a){"object"==typeof i&&(a=i,i=null),a||(a={}),t=this.keyFromPrivate(t,i),e=this._truncateToN(new s(e,16));for(var n=this.n.byteLength(),o=t.getPrivate().toArray("be",n),h=e.toArray("be",n),d=new r({hash:this.hash,entropy:o,nonce:h,pers:a.pers,persEnc:a.persEnc||"utf8"}),l=this.n.sub(new s(1)),u=0;;u++){var f=a.k?a.k(u):new s(d.generate(this.n.byteLength()));if(!((f=this._truncateToN(f,!0)).cmpn(1)<=0||f.cmp(l)>=0)){var p=this.g.mul(f);if(!p.isInfinity()){var m=p.getX(),g=m.umod(this.n);if(0!==g.cmpn(0)){var y=f.invm(this.n).mul(g.mul(t.getPrivate()).iadd(e));if(0!==(y=y.umod(this.n)).cmpn(0)){var b=(p.getY().isOdd()?1:0)|(0!==m.cmp(g)?2:0);return a.canonical&&y.cmp(this.nh)>0&&(y=this.n.sub(y),b^=1),new c({r:g,s:y,recoveryParam:b})}}}}}},l.prototype.verify=function(e,t,i,r){e=this._truncateToN(new s(e,16)),i=this.keyFromPublic(i,r);var a=(t=new c(t,"hex")).r,n=t.s;if(a.cmpn(1)<0||a.cmp(this.n)>=0)return!1;if(n.cmpn(1)<0||n.cmp(this.n)>=0)return!1;var o,h=n.invm(this.n),d=h.mul(e).umod(this.n),l=h.mul(a).umod(this.n);return this.curve._maxwellTrick?!(o=this.g.jmulAdd(d,i.getPublic(),l)).isInfinity()&&o.eqXToP(a):!(o=this.g.mulAdd(d,i.getPublic(),l)).isInfinity()&&0===o.getX().umod(this.n).cmp(a)},l.prototype.recoverPubKey=function(e,t,i,r){h((3&i)===i,"The recovery param is more than two bits"),t=new c(t,r);var a=this.n,n=new s(e),o=t.r,d=t.s,l=1&i,u=i>>1;if(o.cmp(this.curve.p.umod(this.curve.n))>=0&&u)throw new Error("Unable to find sencond key candinate");o=u?this.curve.pointFromX(o.add(this.curve.n),l):this.curve.pointFromX(o,l);var f=t.r.invm(a),p=a.sub(n).mul(f).umod(a),m=d.mul(f).umod(a);return this.g.mulAdd(p,o,m)},l.prototype.getKeyRecoveryParam=function(e,t,i,s){if(null!==(t=new c(t,s)).recoveryParam)return t.recoveryParam;for(var r=0;r<4;r++){var a;try{a=this.recoverPubKey(e,t,r)}catch(e){continue}if(a.eq(i))return r}throw new Error("Unable to find valid recovery factor")}},31251:function(e,t,i){"use strict";var s=i(73785),r=i(80953).assert;function a(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}e.exports=a,a.fromPublic=function(e,t,i){return t instanceof a?t:new a(e,{pub:t,pubEnc:i})},a.fromPrivate=function(e,t,i){return t instanceof a?t:new a(e,{priv:t,privEnc:i})},a.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},a.prototype.getPublic=function(e,t){return"string"==typeof e&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t?this.pub.encode(t,e):this.pub},a.prototype.getPrivate=function(e){return"hex"===e?this.priv.toString(16,2):this.priv},a.prototype._importPrivate=function(e,t){this.priv=new s(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)},a.prototype._importPublic=function(e,t){if(e.x||e.y)return"mont"===this.ec.curve.type?r(e.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||r(e.x&&e.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(e.x,e.y));this.pub=this.ec.curve.decodePoint(e,t)},a.prototype.derive=function(e){return e.validate()||r(e.validate(),"public point not validated"),e.mul(this.priv).getX()},a.prototype.sign=function(e,t,i){return this.ec.sign(e,this,t,i)},a.prototype.verify=function(e,t){return this.ec.verify(e,t,this)},a.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},90611:function(e,t,i){"use strict";var s=i(73785),r=i(80953),a=r.assert;function n(e,t){if(e instanceof n)return e;this._importDER(e,t)||(a(e.r&&e.s,"Signature without r or s"),this.r=new s(e.r,16),this.s=new s(e.s,16),void 0===e.recoveryParam?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}function o(){this.place=0}function h(e,t){var i=e[t.place++];if(!(128&i))return i;var s=15&i;if(0===s||s>4)return!1;for(var r=0,a=0,n=t.place;a<s;a++,n++)r<<=8,r|=e[n],r>>>=0;return!(r<=127)&&(t.place=n,r)}function d(e){for(var t=0,i=e.length-1;!e[t]&&!(128&e[t+1])&&t<i;)t++;return 0===t?e:e.slice(t)}function c(e,t){if(t<128)e.push(t);else{var i=1+(Math.log(t)/Math.LN2>>>3);for(e.push(128|i);--i;)e.push(t>>>(i<<3)&255);e.push(t)}}e.exports=n,n.prototype._importDER=function(e,t){e=r.toArray(e,t);var i=new o;if(48!==e[i.place++])return!1;var a=h(e,i);if(!1===a)return!1;if(a+i.place!==e.length)return!1;if(2!==e[i.place++])return!1;var n=h(e,i);if(!1===n)return!1;var d=e.slice(i.place,n+i.place);if(i.place+=n,2!==e[i.place++])return!1;var c=h(e,i);if(!1===c)return!1;if(e.length!==c+i.place)return!1;var l=e.slice(i.place,c+i.place);if(0===d[0]){if(!(128&d[1]))return!1;d=d.slice(1)}if(0===l[0]){if(!(128&l[1]))return!1;l=l.slice(1)}return this.r=new s(d),this.s=new s(l),this.recoveryParam=null,!0},n.prototype.toDER=function(e){var t=this.r.toArray(),i=this.s.toArray();for(128&t[0]&&(t=[0].concat(t)),128&i[0]&&(i=[0].concat(i)),t=d(t),i=d(i);!(i[0]||128&i[1]);)i=i.slice(1);var s=[2];c(s,t.length),(s=s.concat(t)).push(2),c(s,i.length);var a=s.concat(i),n=[48];return c(n,a.length),n=n.concat(a),r.encode(n,e)}},65980:function(e,t,i){"use strict";var s=i(33715),r=i(45427),a=i(80953),n=a.assert,o=a.parseBytes,h=i(79087),d=i(23622);function c(e){if(n("ed25519"===e,"only tested with ed25519 so far"),!(this instanceof c))return new c(e);e=r[e].curve,this.curve=e,this.g=e.g,this.g.precompute(e.n.bitLength()+1),this.pointClass=e.point().constructor,this.encodingLength=Math.ceil(e.n.bitLength()/8),this.hash=s.sha512}e.exports=c,c.prototype.sign=function(e,t){e=o(e);var i=this.keyFromSecret(t),s=this.hashInt(i.messagePrefix(),e),r=this.g.mul(s),a=this.encodePoint(r),n=this.hashInt(a,i.pubBytes(),e).mul(i.priv()),h=s.add(n).umod(this.curve.n);return this.makeSignature({R:r,S:h,Rencoded:a})},c.prototype.verify=function(e,t,i){e=o(e),t=this.makeSignature(t);var s=this.keyFromPublic(i),r=this.hashInt(t.Rencoded(),s.pubBytes(),e),a=this.g.mul(t.S());return t.R().add(s.pub().mul(r)).eq(a)},c.prototype.hashInt=function(){for(var e=this.hash(),t=0;t<arguments.length;t++)e.update(arguments[t]);return a.intFromLE(e.digest()).umod(this.curve.n)},c.prototype.keyFromPublic=function(e){return h.fromPublic(this,e)},c.prototype.keyFromSecret=function(e){return h.fromSecret(this,e)},c.prototype.makeSignature=function(e){return e instanceof d?e:new d(this,e)},c.prototype.encodePoint=function(e){var t=e.getY().toArray("le",this.encodingLength);return t[this.encodingLength-1]|=e.getX().isOdd()?128:0,t},c.prototype.decodePoint=function(e){var t=(e=a.parseBytes(e)).length-1,i=e.slice(0,t).concat(-129&e[t]),s=0!=(128&e[t]),r=a.intFromLE(i);return this.curve.pointFromY(r,s)},c.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)},c.prototype.decodeInt=function(e){return a.intFromLE(e)},c.prototype.isPoint=function(e){return e instanceof this.pointClass}},79087:function(e,t,i){"use strict";var s=i(80953),r=s.assert,a=s.parseBytes,n=s.cachedProperty;function o(e,t){this.eddsa=e,this._secret=a(t.secret),e.isPoint(t.pub)?this._pub=t.pub:this._pubBytes=a(t.pub)}o.fromPublic=function(e,t){return t instanceof o?t:new o(e,{pub:t})},o.fromSecret=function(e,t){return t instanceof o?t:new o(e,{secret:t})},o.prototype.secret=function(){return this._secret},n(o,"pubBytes",(function(){return this.eddsa.encodePoint(this.pub())})),n(o,"pub",(function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())})),n(o,"privBytes",(function(){var e=this.eddsa,t=this.hash(),i=e.encodingLength-1,s=t.slice(0,e.encodingLength);return s[0]&=248,s[i]&=127,s[i]|=64,s})),n(o,"priv",(function(){return this.eddsa.decodeInt(this.privBytes())})),n(o,"hash",(function(){return this.eddsa.hash().update(this.secret()).digest()})),n(o,"messagePrefix",(function(){return this.hash().slice(this.eddsa.encodingLength)})),o.prototype.sign=function(e){return r(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)},o.prototype.verify=function(e,t){return this.eddsa.verify(e,t,this)},o.prototype.getSecret=function(e){return r(this._secret,"KeyPair is public only"),s.encode(this.secret(),e)},o.prototype.getPublic=function(e){return s.encode(this.pubBytes(),e)},e.exports=o},23622:function(e,t,i){"use strict";var s=i(73785),r=i(80953),a=r.assert,n=r.cachedProperty,o=r.parseBytes;function h(e,t){this.eddsa=e,"object"!=typeof t&&(t=o(t)),Array.isArray(t)&&(t={R:t.slice(0,e.encodingLength),S:t.slice(e.encodingLength)}),a(t.R&&t.S,"Signature without R or S"),e.isPoint(t.R)&&(this._R=t.R),t.S instanceof s&&(this._S=t.S),this._Rencoded=Array.isArray(t.R)?t.R:t.Rencoded,this._Sencoded=Array.isArray(t.S)?t.S:t.Sencoded}n(h,"S",(function(){return this.eddsa.decodeInt(this.Sencoded())})),n(h,"R",(function(){return this.eddsa.decodePoint(this.Rencoded())})),n(h,"Rencoded",(function(){return this.eddsa.encodePoint(this.R())})),n(h,"Sencoded",(function(){return this.eddsa.encodeInt(this.S())})),h.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},h.prototype.toHex=function(){return r.encode(this.toBytes(),"hex").toUpperCase()},e.exports=h},91037:function(e){e.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}},80953:function(e,t,i){"use strict";var s=t,r=i(73785),a=i(79746),n=i(34504);s.assert=a,s.toArray=n.toArray,s.zero2=n.zero2,s.toHex=n.toHex,s.encode=n.encode,s.getNAF=function(e,t,i){var s=new Array(Math.max(e.bitLength(),i)+1);s.fill(0);for(var r=1<<t+1,a=e.clone(),n=0;n<s.length;n++){var o,h=a.andln(r-1);a.isOdd()?(o=h>(r>>1)-1?(r>>1)-h:h,a.isubn(o)):o=0,s[n]=o,a.iushrn(1)}return s},s.getJSF=function(e,t){var i=[[],[]];e=e.clone(),t=t.clone();for(var s,r=0,a=0;e.cmpn(-r)>0||t.cmpn(-a)>0;){var n,o,h=e.andln(3)+r&3,d=t.andln(3)+a&3;3===h&&(h=-1),3===d&&(d=-1),n=0==(1&h)?0:3!==(s=e.andln(7)+r&7)&&5!==s||2!==d?h:-h,i[0].push(n),o=0==(1&d)?0:3!==(s=t.andln(7)+a&7)&&5!==s||2!==h?d:-d,i[1].push(o),2*r===n+1&&(r=1-r),2*a===o+1&&(a=1-a),e.iushrn(1),t.iushrn(1)}return i},s.cachedProperty=function(e,t,i){var s="_"+t;e.prototype[t]=function(){return void 0!==this[s]?this[s]:this[s]=i.call(this)}},s.parseBytes=function(e){return"string"==typeof e?s.toArray(e,"hex"):e},s.intFromLE=function(e){return new r(e,"hex","le")}},73785:function(e,t,i){!function(e,t){"use strict";function s(e,t){if(!e)throw new Error(t||"Assertion failed")}function r(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function a(e,t,i){if(a.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(i=t,t=10),this._init(e||0,t||10,i||"be"))}var n;"object"==typeof e?e.exports=a:t.BN=a,a.BN=a,a.wordSize=26;try{n="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i(85568).Buffer}catch(e){}function o(e,t){var i=e.charCodeAt(t);return i>=65&&i<=70?i-55:i>=97&&i<=102?i-87:i-48&15}function h(e,t,i){var s=o(e,i);return i-1>=t&&(s|=o(e,i-1)<<4),s}function d(e,t,i,s){for(var r=0,a=Math.min(e.length,i),n=t;n<a;n++){var o=e.charCodeAt(n)-48;r*=s,r+=o>=49?o-49+10:o>=17?o-17+10:o}return r}a.isBN=function(e){return e instanceof a||null!==e&&"object"==typeof e&&e.constructor.wordSize===a.wordSize&&Array.isArray(e.words)},a.max=function(e,t){return e.cmp(t)>0?e:t},a.min=function(e,t){return e.cmp(t)<0?e:t},a.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),s(t===(0|t)&&t>=2&&t<=36);var r=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(r++,this.negative=1),r<e.length&&(16===t?this._parseHex(e,r,i):(this._parseBase(e,t,r),"le"===i&&this._initArray(this.toArray(),t,i)))},a.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(s(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},a.prototype._initArray=function(e,t,i){if(s("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var a,n,o=0;if("be"===i)for(r=e.length-1,a=0;r>=0;r-=3)n=e[r]|e[r-1]<<8|e[r-2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);else if("le"===i)for(r=0,a=0;r<e.length;r+=3)n=e[r]|e[r+1]<<8|e[r+2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);return this.strip()},a.prototype._parseHex=function(e,t,i){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var r,a=0,n=0;if("be"===i)for(s=e.length-1;s>=t;s-=2)r=h(e,t,s)<<a,this.words[n]|=67108863&r,a>=18?(a-=18,n+=1,this.words[n]|=r>>>26):a+=8;else for(s=(e.length-t)%2==0?t+1:t;s<e.length;s+=2)r=h(e,t,s)<<a,this.words[n]|=67108863&r,a>=18?(a-=18,n+=1,this.words[n]|=r>>>26):a+=8;this.strip()},a.prototype._parseBase=function(e,t,i){this.words=[0],this.length=1;for(var s=0,r=1;r<=67108863;r*=t)s++;s--,r=r/t|0;for(var a=e.length-i,n=a%s,o=Math.min(a,a-n)+i,h=0,c=i;c<o;c+=s)h=d(e,c,c+s,t),this.imuln(r),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==n){var l=1;for(h=d(e,c,e.length,t),c=0;c<n;c++)l*=t;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},a.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},a.prototype.clone=function(){var e=new a(null);return this.copy(e),e},a.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},a.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},a.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},a.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],u=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,i){i.negative=t.negative^e.negative;var s=e.length+t.length|0;i.length=s,s=s-1|0;var r=0|e.words[0],a=0|t.words[0],n=r*a,o=67108863&n,h=n/67108864|0;i.words[0]=o;for(var d=1;d<s;d++){for(var c=h>>>26,l=67108863&h,u=Math.min(d,t.length-1),f=Math.max(0,d-e.length+1);f<=u;f++){var p=d-f|0;c+=(n=(r=0|e.words[p])*(a=0|t.words[f])+l)/67108864|0,l=67108863&n}i.words[d]=0|l,h=0|c}return 0!==h?i.words[d]=0|h:i.length--,i.strip()}a.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var r=0,a=0,n=0;n<this.length;n++){var o=this.words[n],h=(16777215&(o<<r|a)).toString(16);i=0!==(a=o>>>24-r&16777215)||n!==this.length-1?c[6-h.length]+h+i:h+i,(r+=2)>=26&&(r-=26,n--)}for(0!==a&&(i=a.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var d=l[e],f=u[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:c[d-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}s(!1,"Base should be between 2 and 36")},a.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&s(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},a.prototype.toJSON=function(){return this.toString(16)},a.prototype.toBuffer=function(e,t){return s(void 0!==n),this.toArrayLike(n,e,t)},a.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},a.prototype.toArrayLike=function(e,t,i){var r=this.byteLength(),a=i||Math.max(1,r);s(r<=a,"byte array longer than desired length"),s(a>0,"Requested array length <= 0"),this.strip();var n,o,h="le"===t,d=new e(a),c=this.clone();if(h){for(o=0;!c.isZero();o++)n=c.andln(255),c.iushrn(8),d[o]=n;for(;o<a;o++)d[o]=0}else{for(o=0;o<a-r;o++)d[o]=0;for(o=0;!c.isZero();o++)n=c.andln(255),c.iushrn(8),d[a-o-1]=n}return d},Math.clz32?a.prototype._countBits=function(e){return 32-Math.clz32(e)}:a.prototype._countBits=function(e){var t=e,i=0;return t>=4096&&(i+=13,t>>>=13),t>=64&&(i+=7,t>>>=7),t>=8&&(i+=4,t>>>=4),t>=2&&(i+=2,t>>>=2),i+t},a.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,i=0;return 0==(8191&t)&&(i+=13,t>>>=13),0==(127&t)&&(i+=7,t>>>=7),0==(15&t)&&(i+=4,t>>>=4),0==(3&t)&&(i+=2,t>>>=2),0==(1&t)&&i++,i},a.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},a.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var i=this._zeroBits(this.words[t]);if(e+=i,26!==i)break}return e},a.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},a.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},a.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},a.prototype.isNeg=function(){return 0!==this.negative},a.prototype.neg=function(){return this.clone().ineg()},a.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},a.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},a.prototype.ior=function(e){return s(0==(this.negative|e.negative)),this.iuor(e)},a.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},a.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},a.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var i=0;i<t.length;i++)this.words[i]=this.words[i]&e.words[i];return this.length=t.length,this.strip()},a.prototype.iand=function(e){return s(0==(this.negative|e.negative)),this.iuand(e)},a.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},a.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},a.prototype.iuxor=function(e){var t,i;this.length>e.length?(t=this,i=e):(t=e,i=this);for(var s=0;s<i.length;s++)this.words[s]=t.words[s]^i.words[s];if(this!==t)for(;s<t.length;s++)this.words[s]=t.words[s];return this.length=t.length,this.strip()},a.prototype.ixor=function(e){return s(0==(this.negative|e.negative)),this.iuxor(e)},a.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},a.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},a.prototype.inotn=function(e){s("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var r=0;r<t;r++)this.words[r]=67108863&~this.words[r];return i>0&&(this.words[r]=~this.words[r]&67108863>>26-i),this.strip()},a.prototype.notn=function(e){return this.clone().inotn(e)},a.prototype.setn=function(e,t){s("number"==typeof e&&e>=0);var i=e/26|0,r=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<r:this.words[i]&~(1<<r),this.strip()},a.prototype.iadd=function(e){var t,i,s;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(i=this,s=e):(i=e,s=this);for(var r=0,a=0;a<s.length;a++)t=(0|i.words[a])+(0|s.words[a])+r,this.words[a]=67108863&t,r=t>>>26;for(;0!==r&&a<i.length;a++)t=(0|i.words[a])+r,this.words[a]=67108863&t,r=t>>>26;if(this.length=i.length,0!==r)this.words[this.length]=r,this.length++;else if(i!==this)for(;a<i.length;a++)this.words[a]=i.words[a];return this},a.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},a.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var i,s,r=this.cmp(e);if(0===r)return this.negative=0,this.length=1,this.words[0]=0,this;r>0?(i=this,s=e):(i=e,s=this);for(var a=0,n=0;n<s.length;n++)a=(t=(0|i.words[n])-(0|s.words[n])+a)>>26,this.words[n]=67108863&t;for(;0!==a&&n<i.length;n++)a=(t=(0|i.words[n])+a)>>26,this.words[n]=67108863&t;if(0===a&&n<i.length&&i!==this)for(;n<i.length;n++)this.words[n]=i.words[n];return this.length=Math.max(this.length,n),i!==this&&(this.negative=1),this.strip()},a.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,i){var s,r,a,n=e.words,o=t.words,h=i.words,d=0,c=0|n[0],l=8191&c,u=c>>>13,f=0|n[1],p=8191&f,m=f>>>13,g=0|n[2],y=8191&g,b=g>>>13,v=0|n[3],w=8191&v,S=v>>>13,k=0|n[4],T=8191&k,_=k>>>13,O=0|n[5],M=8191&O,I=O>>>13,x=0|n[6],C=8191&x,P=x>>>13,A=0|n[7],N=8191&A,B=A>>>13,E=0|n[8],V=8191&E,L=E>>>13,R=0|n[9],D=8191&R,F=R>>>13,q=0|o[0],G=8191&q,H=q>>>13,U=0|o[1],j=8191&U,W=U>>>13,z=0|o[2],K=8191&z,X=z>>>13,Z=0|o[3],Y=8191&Z,Q=Z>>>13,J=0|o[4],$=8191&J,ee=J>>>13,te=0|o[5],ie=8191&te,se=te>>>13,re=0|o[6],ae=8191&re,ne=re>>>13,oe=0|o[7],he=8191&oe,de=oe>>>13,ce=0|o[8],le=8191&ce,ue=ce>>>13,fe=0|o[9],pe=8191&fe,me=fe>>>13;i.negative=e.negative^t.negative,i.length=19;var ge=(d+(s=Math.imul(l,G))|0)+((8191&(r=(r=Math.imul(l,H))+Math.imul(u,G)|0))<<13)|0;d=((a=Math.imul(u,H))+(r>>>13)|0)+(ge>>>26)|0,ge&=67108863,s=Math.imul(p,G),r=(r=Math.imul(p,H))+Math.imul(m,G)|0,a=Math.imul(m,H);var ye=(d+(s=s+Math.imul(l,j)|0)|0)+((8191&(r=(r=r+Math.imul(l,W)|0)+Math.imul(u,j)|0))<<13)|0;d=((a=a+Math.imul(u,W)|0)+(r>>>13)|0)+(ye>>>26)|0,ye&=67108863,s=Math.imul(y,G),r=(r=Math.imul(y,H))+Math.imul(b,G)|0,a=Math.imul(b,H),s=s+Math.imul(p,j)|0,r=(r=r+Math.imul(p,W)|0)+Math.imul(m,j)|0,a=a+Math.imul(m,W)|0;var be=(d+(s=s+Math.imul(l,K)|0)|0)+((8191&(r=(r=r+Math.imul(l,X)|0)+Math.imul(u,K)|0))<<13)|0;d=((a=a+Math.imul(u,X)|0)+(r>>>13)|0)+(be>>>26)|0,be&=67108863,s=Math.imul(w,G),r=(r=Math.imul(w,H))+Math.imul(S,G)|0,a=Math.imul(S,H),s=s+Math.imul(y,j)|0,r=(r=r+Math.imul(y,W)|0)+Math.imul(b,j)|0,a=a+Math.imul(b,W)|0,s=s+Math.imul(p,K)|0,r=(r=r+Math.imul(p,X)|0)+Math.imul(m,K)|0,a=a+Math.imul(m,X)|0;var ve=(d+(s=s+Math.imul(l,Y)|0)|0)+((8191&(r=(r=r+Math.imul(l,Q)|0)+Math.imul(u,Y)|0))<<13)|0;d=((a=a+Math.imul(u,Q)|0)+(r>>>13)|0)+(ve>>>26)|0,ve&=67108863,s=Math.imul(T,G),r=(r=Math.imul(T,H))+Math.imul(_,G)|0,a=Math.imul(_,H),s=s+Math.imul(w,j)|0,r=(r=r+Math.imul(w,W)|0)+Math.imul(S,j)|0,a=a+Math.imul(S,W)|0,s=s+Math.imul(y,K)|0,r=(r=r+Math.imul(y,X)|0)+Math.imul(b,K)|0,a=a+Math.imul(b,X)|0,s=s+Math.imul(p,Y)|0,r=(r=r+Math.imul(p,Q)|0)+Math.imul(m,Y)|0,a=a+Math.imul(m,Q)|0;var we=(d+(s=s+Math.imul(l,$)|0)|0)+((8191&(r=(r=r+Math.imul(l,ee)|0)+Math.imul(u,$)|0))<<13)|0;d=((a=a+Math.imul(u,ee)|0)+(r>>>13)|0)+(we>>>26)|0,we&=67108863,s=Math.imul(M,G),r=(r=Math.imul(M,H))+Math.imul(I,G)|0,a=Math.imul(I,H),s=s+Math.imul(T,j)|0,r=(r=r+Math.imul(T,W)|0)+Math.imul(_,j)|0,a=a+Math.imul(_,W)|0,s=s+Math.imul(w,K)|0,r=(r=r+Math.imul(w,X)|0)+Math.imul(S,K)|0,a=a+Math.imul(S,X)|0,s=s+Math.imul(y,Y)|0,r=(r=r+Math.imul(y,Q)|0)+Math.imul(b,Y)|0,a=a+Math.imul(b,Q)|0,s=s+Math.imul(p,$)|0,r=(r=r+Math.imul(p,ee)|0)+Math.imul(m,$)|0,a=a+Math.imul(m,ee)|0;var Se=(d+(s=s+Math.imul(l,ie)|0)|0)+((8191&(r=(r=r+Math.imul(l,se)|0)+Math.imul(u,ie)|0))<<13)|0;d=((a=a+Math.imul(u,se)|0)+(r>>>13)|0)+(Se>>>26)|0,Se&=67108863,s=Math.imul(C,G),r=(r=Math.imul(C,H))+Math.imul(P,G)|0,a=Math.imul(P,H),s=s+Math.imul(M,j)|0,r=(r=r+Math.imul(M,W)|0)+Math.imul(I,j)|0,a=a+Math.imul(I,W)|0,s=s+Math.imul(T,K)|0,r=(r=r+Math.imul(T,X)|0)+Math.imul(_,K)|0,a=a+Math.imul(_,X)|0,s=s+Math.imul(w,Y)|0,r=(r=r+Math.imul(w,Q)|0)+Math.imul(S,Y)|0,a=a+Math.imul(S,Q)|0,s=s+Math.imul(y,$)|0,r=(r=r+Math.imul(y,ee)|0)+Math.imul(b,$)|0,a=a+Math.imul(b,ee)|0,s=s+Math.imul(p,ie)|0,r=(r=r+Math.imul(p,se)|0)+Math.imul(m,ie)|0,a=a+Math.imul(m,se)|0;var ke=(d+(s=s+Math.imul(l,ae)|0)|0)+((8191&(r=(r=r+Math.imul(l,ne)|0)+Math.imul(u,ae)|0))<<13)|0;d=((a=a+Math.imul(u,ne)|0)+(r>>>13)|0)+(ke>>>26)|0,ke&=67108863,s=Math.imul(N,G),r=(r=Math.imul(N,H))+Math.imul(B,G)|0,a=Math.imul(B,H),s=s+Math.imul(C,j)|0,r=(r=r+Math.imul(C,W)|0)+Math.imul(P,j)|0,a=a+Math.imul(P,W)|0,s=s+Math.imul(M,K)|0,r=(r=r+Math.imul(M,X)|0)+Math.imul(I,K)|0,a=a+Math.imul(I,X)|0,s=s+Math.imul(T,Y)|0,r=(r=r+Math.imul(T,Q)|0)+Math.imul(_,Y)|0,a=a+Math.imul(_,Q)|0,s=s+Math.imul(w,$)|0,r=(r=r+Math.imul(w,ee)|0)+Math.imul(S,$)|0,a=a+Math.imul(S,ee)|0,s=s+Math.imul(y,ie)|0,r=(r=r+Math.imul(y,se)|0)+Math.imul(b,ie)|0,a=a+Math.imul(b,se)|0,s=s+Math.imul(p,ae)|0,r=(r=r+Math.imul(p,ne)|0)+Math.imul(m,ae)|0,a=a+Math.imul(m,ne)|0;var Te=(d+(s=s+Math.imul(l,he)|0)|0)+((8191&(r=(r=r+Math.imul(l,de)|0)+Math.imul(u,he)|0))<<13)|0;d=((a=a+Math.imul(u,de)|0)+(r>>>13)|0)+(Te>>>26)|0,Te&=67108863,s=Math.imul(V,G),r=(r=Math.imul(V,H))+Math.imul(L,G)|0,a=Math.imul(L,H),s=s+Math.imul(N,j)|0,r=(r=r+Math.imul(N,W)|0)+Math.imul(B,j)|0,a=a+Math.imul(B,W)|0,s=s+Math.imul(C,K)|0,r=(r=r+Math.imul(C,X)|0)+Math.imul(P,K)|0,a=a+Math.imul(P,X)|0,s=s+Math.imul(M,Y)|0,r=(r=r+Math.imul(M,Q)|0)+Math.imul(I,Y)|0,a=a+Math.imul(I,Q)|0,s=s+Math.imul(T,$)|0,r=(r=r+Math.imul(T,ee)|0)+Math.imul(_,$)|0,a=a+Math.imul(_,ee)|0,s=s+Math.imul(w,ie)|0,r=(r=r+Math.imul(w,se)|0)+Math.imul(S,ie)|0,a=a+Math.imul(S,se)|0,s=s+Math.imul(y,ae)|0,r=(r=r+Math.imul(y,ne)|0)+Math.imul(b,ae)|0,a=a+Math.imul(b,ne)|0,s=s+Math.imul(p,he)|0,r=(r=r+Math.imul(p,de)|0)+Math.imul(m,he)|0,a=a+Math.imul(m,de)|0;var _e=(d+(s=s+Math.imul(l,le)|0)|0)+((8191&(r=(r=r+Math.imul(l,ue)|0)+Math.imul(u,le)|0))<<13)|0;d=((a=a+Math.imul(u,ue)|0)+(r>>>13)|0)+(_e>>>26)|0,_e&=67108863,s=Math.imul(D,G),r=(r=Math.imul(D,H))+Math.imul(F,G)|0,a=Math.imul(F,H),s=s+Math.imul(V,j)|0,r=(r=r+Math.imul(V,W)|0)+Math.imul(L,j)|0,a=a+Math.imul(L,W)|0,s=s+Math.imul(N,K)|0,r=(r=r+Math.imul(N,X)|0)+Math.imul(B,K)|0,a=a+Math.imul(B,X)|0,s=s+Math.imul(C,Y)|0,r=(r=r+Math.imul(C,Q)|0)+Math.imul(P,Y)|0,a=a+Math.imul(P,Q)|0,s=s+Math.imul(M,$)|0,r=(r=r+Math.imul(M,ee)|0)+Math.imul(I,$)|0,a=a+Math.imul(I,ee)|0,s=s+Math.imul(T,ie)|0,r=(r=r+Math.imul(T,se)|0)+Math.imul(_,ie)|0,a=a+Math.imul(_,se)|0,s=s+Math.imul(w,ae)|0,r=(r=r+Math.imul(w,ne)|0)+Math.imul(S,ae)|0,a=a+Math.imul(S,ne)|0,s=s+Math.imul(y,he)|0,r=(r=r+Math.imul(y,de)|0)+Math.imul(b,he)|0,a=a+Math.imul(b,de)|0,s=s+Math.imul(p,le)|0,r=(r=r+Math.imul(p,ue)|0)+Math.imul(m,le)|0,a=a+Math.imul(m,ue)|0;var Oe=(d+(s=s+Math.imul(l,pe)|0)|0)+((8191&(r=(r=r+Math.imul(l,me)|0)+Math.imul(u,pe)|0))<<13)|0;d=((a=a+Math.imul(u,me)|0)+(r>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,s=Math.imul(D,j),r=(r=Math.imul(D,W))+Math.imul(F,j)|0,a=Math.imul(F,W),s=s+Math.imul(V,K)|0,r=(r=r+Math.imul(V,X)|0)+Math.imul(L,K)|0,a=a+Math.imul(L,X)|0,s=s+Math.imul(N,Y)|0,r=(r=r+Math.imul(N,Q)|0)+Math.imul(B,Y)|0,a=a+Math.imul(B,Q)|0,s=s+Math.imul(C,$)|0,r=(r=r+Math.imul(C,ee)|0)+Math.imul(P,$)|0,a=a+Math.imul(P,ee)|0,s=s+Math.imul(M,ie)|0,r=(r=r+Math.imul(M,se)|0)+Math.imul(I,ie)|0,a=a+Math.imul(I,se)|0,s=s+Math.imul(T,ae)|0,r=(r=r+Math.imul(T,ne)|0)+Math.imul(_,ae)|0,a=a+Math.imul(_,ne)|0,s=s+Math.imul(w,he)|0,r=(r=r+Math.imul(w,de)|0)+Math.imul(S,he)|0,a=a+Math.imul(S,de)|0,s=s+Math.imul(y,le)|0,r=(r=r+Math.imul(y,ue)|0)+Math.imul(b,le)|0,a=a+Math.imul(b,ue)|0;var Me=(d+(s=s+Math.imul(p,pe)|0)|0)+((8191&(r=(r=r+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;d=((a=a+Math.imul(m,me)|0)+(r>>>13)|0)+(Me>>>26)|0,Me&=67108863,s=Math.imul(D,K),r=(r=Math.imul(D,X))+Math.imul(F,K)|0,a=Math.imul(F,X),s=s+Math.imul(V,Y)|0,r=(r=r+Math.imul(V,Q)|0)+Math.imul(L,Y)|0,a=a+Math.imul(L,Q)|0,s=s+Math.imul(N,$)|0,r=(r=r+Math.imul(N,ee)|0)+Math.imul(B,$)|0,a=a+Math.imul(B,ee)|0,s=s+Math.imul(C,ie)|0,r=(r=r+Math.imul(C,se)|0)+Math.imul(P,ie)|0,a=a+Math.imul(P,se)|0,s=s+Math.imul(M,ae)|0,r=(r=r+Math.imul(M,ne)|0)+Math.imul(I,ae)|0,a=a+Math.imul(I,ne)|0,s=s+Math.imul(T,he)|0,r=(r=r+Math.imul(T,de)|0)+Math.imul(_,he)|0,a=a+Math.imul(_,de)|0,s=s+Math.imul(w,le)|0,r=(r=r+Math.imul(w,ue)|0)+Math.imul(S,le)|0,a=a+Math.imul(S,ue)|0;var Ie=(d+(s=s+Math.imul(y,pe)|0)|0)+((8191&(r=(r=r+Math.imul(y,me)|0)+Math.imul(b,pe)|0))<<13)|0;d=((a=a+Math.imul(b,me)|0)+(r>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,s=Math.imul(D,Y),r=(r=Math.imul(D,Q))+Math.imul(F,Y)|0,a=Math.imul(F,Q),s=s+Math.imul(V,$)|0,r=(r=r+Math.imul(V,ee)|0)+Math.imul(L,$)|0,a=a+Math.imul(L,ee)|0,s=s+Math.imul(N,ie)|0,r=(r=r+Math.imul(N,se)|0)+Math.imul(B,ie)|0,a=a+Math.imul(B,se)|0,s=s+Math.imul(C,ae)|0,r=(r=r+Math.imul(C,ne)|0)+Math.imul(P,ae)|0,a=a+Math.imul(P,ne)|0,s=s+Math.imul(M,he)|0,r=(r=r+Math.imul(M,de)|0)+Math.imul(I,he)|0,a=a+Math.imul(I,de)|0,s=s+Math.imul(T,le)|0,r=(r=r+Math.imul(T,ue)|0)+Math.imul(_,le)|0,a=a+Math.imul(_,ue)|0;var xe=(d+(s=s+Math.imul(w,pe)|0)|0)+((8191&(r=(r=r+Math.imul(w,me)|0)+Math.imul(S,pe)|0))<<13)|0;d=((a=a+Math.imul(S,me)|0)+(r>>>13)|0)+(xe>>>26)|0,xe&=67108863,s=Math.imul(D,$),r=(r=Math.imul(D,ee))+Math.imul(F,$)|0,a=Math.imul(F,ee),s=s+Math.imul(V,ie)|0,r=(r=r+Math.imul(V,se)|0)+Math.imul(L,ie)|0,a=a+Math.imul(L,se)|0,s=s+Math.imul(N,ae)|0,r=(r=r+Math.imul(N,ne)|0)+Math.imul(B,ae)|0,a=a+Math.imul(B,ne)|0,s=s+Math.imul(C,he)|0,r=(r=r+Math.imul(C,de)|0)+Math.imul(P,he)|0,a=a+Math.imul(P,de)|0,s=s+Math.imul(M,le)|0,r=(r=r+Math.imul(M,ue)|0)+Math.imul(I,le)|0,a=a+Math.imul(I,ue)|0;var Ce=(d+(s=s+Math.imul(T,pe)|0)|0)+((8191&(r=(r=r+Math.imul(T,me)|0)+Math.imul(_,pe)|0))<<13)|0;d=((a=a+Math.imul(_,me)|0)+(r>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,s=Math.imul(D,ie),r=(r=Math.imul(D,se))+Math.imul(F,ie)|0,a=Math.imul(F,se),s=s+Math.imul(V,ae)|0,r=(r=r+Math.imul(V,ne)|0)+Math.imul(L,ae)|0,a=a+Math.imul(L,ne)|0,s=s+Math.imul(N,he)|0,r=(r=r+Math.imul(N,de)|0)+Math.imul(B,he)|0,a=a+Math.imul(B,de)|0,s=s+Math.imul(C,le)|0,r=(r=r+Math.imul(C,ue)|0)+Math.imul(P,le)|0,a=a+Math.imul(P,ue)|0;var Pe=(d+(s=s+Math.imul(M,pe)|0)|0)+((8191&(r=(r=r+Math.imul(M,me)|0)+Math.imul(I,pe)|0))<<13)|0;d=((a=a+Math.imul(I,me)|0)+(r>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,s=Math.imul(D,ae),r=(r=Math.imul(D,ne))+Math.imul(F,ae)|0,a=Math.imul(F,ne),s=s+Math.imul(V,he)|0,r=(r=r+Math.imul(V,de)|0)+Math.imul(L,he)|0,a=a+Math.imul(L,de)|0,s=s+Math.imul(N,le)|0,r=(r=r+Math.imul(N,ue)|0)+Math.imul(B,le)|0,a=a+Math.imul(B,ue)|0;var Ae=(d+(s=s+Math.imul(C,pe)|0)|0)+((8191&(r=(r=r+Math.imul(C,me)|0)+Math.imul(P,pe)|0))<<13)|0;d=((a=a+Math.imul(P,me)|0)+(r>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,s=Math.imul(D,he),r=(r=Math.imul(D,de))+Math.imul(F,he)|0,a=Math.imul(F,de),s=s+Math.imul(V,le)|0,r=(r=r+Math.imul(V,ue)|0)+Math.imul(L,le)|0,a=a+Math.imul(L,ue)|0;var Ne=(d+(s=s+Math.imul(N,pe)|0)|0)+((8191&(r=(r=r+Math.imul(N,me)|0)+Math.imul(B,pe)|0))<<13)|0;d=((a=a+Math.imul(B,me)|0)+(r>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,s=Math.imul(D,le),r=(r=Math.imul(D,ue))+Math.imul(F,le)|0,a=Math.imul(F,ue);var Be=(d+(s=s+Math.imul(V,pe)|0)|0)+((8191&(r=(r=r+Math.imul(V,me)|0)+Math.imul(L,pe)|0))<<13)|0;d=((a=a+Math.imul(L,me)|0)+(r>>>13)|0)+(Be>>>26)|0,Be&=67108863;var Ee=(d+(s=Math.imul(D,pe))|0)+((8191&(r=(r=Math.imul(D,me))+Math.imul(F,pe)|0))<<13)|0;return d=((a=Math.imul(F,me))+(r>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,h[0]=ge,h[1]=ye,h[2]=be,h[3]=ve,h[4]=we,h[5]=Se,h[6]=ke,h[7]=Te,h[8]=_e,h[9]=Oe,h[10]=Me,h[11]=Ie,h[12]=xe,h[13]=Ce,h[14]=Pe,h[15]=Ae,h[16]=Ne,h[17]=Be,h[18]=Ee,0!==d&&(h[19]=d,i.length++),i};function m(e,t,i){return(new g).mulp(e,t,i)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=f),a.prototype.mulTo=function(e,t){var i,s=this.length+e.length;return i=10===this.length&&10===e.length?p(this,e,t):s<63?f(this,e,t):s<1024?function(e,t,i){i.negative=t.negative^e.negative,i.length=e.length+t.length;for(var s=0,r=0,a=0;a<i.length-1;a++){var n=r;r=0;for(var o=67108863&s,h=Math.min(a,t.length-1),d=Math.max(0,a-e.length+1);d<=h;d++){var c=a-d,l=(0|e.words[c])*(0|t.words[d]),u=67108863&l;o=67108863&(u=u+o|0),r+=(n=(n=n+(l/67108864|0)|0)+(u>>>26)|0)>>>26,n&=67108863}i.words[a]=o,s=n,n=r}return 0!==s?i.words[a]=s:i.length--,i.strip()}(this,e,t):m(this,e,t),i},g.prototype.makeRBT=function(e){for(var t=new Array(e),i=a.prototype._countBits(e)-1,s=0;s<e;s++)t[s]=this.revBin(s,i,e);return t},g.prototype.revBin=function(e,t,i){if(0===e||e===i-1)return e;for(var s=0,r=0;r<t;r++)s|=(1&e)<<t-r-1,e>>=1;return s},g.prototype.permute=function(e,t,i,s,r,a){for(var n=0;n<a;n++)s[n]=t[e[n]],r[n]=i[e[n]]},g.prototype.transform=function(e,t,i,s,r,a){this.permute(a,e,t,i,s,r);for(var n=1;n<r;n<<=1)for(var o=n<<1,h=Math.cos(2*Math.PI/o),d=Math.sin(2*Math.PI/o),c=0;c<r;c+=o)for(var l=h,u=d,f=0;f<n;f++){var p=i[c+f],m=s[c+f],g=i[c+f+n],y=s[c+f+n],b=l*g-u*y;y=l*y+u*g,g=b,i[c+f]=p+g,s[c+f]=m+y,i[c+f+n]=p-g,s[c+f+n]=m-y,f!==o&&(b=h*l-d*u,u=h*u+d*l,l=b)}},g.prototype.guessLen13b=function(e,t){var i=1|Math.max(t,e),s=1&i,r=0;for(i=i/2|0;i;i>>>=1)r++;return 1<<r+1+s},g.prototype.conjugate=function(e,t,i){if(!(i<=1))for(var s=0;s<i/2;s++){var r=e[s];e[s]=e[i-s-1],e[i-s-1]=r,r=t[s],t[s]=-t[i-s-1],t[i-s-1]=-r}},g.prototype.normalize13b=function(e,t){for(var i=0,s=0;s<t/2;s++){var r=8192*Math.round(e[2*s+1]/t)+Math.round(e[2*s]/t)+i;e[s]=67108863&r,i=r<67108864?0:r/67108864|0}return e},g.prototype.convert13b=function(e,t,i,r){for(var a=0,n=0;n<t;n++)a+=0|e[n],i[2*n]=8191&a,a>>>=13,i[2*n+1]=8191&a,a>>>=13;for(n=2*t;n<r;++n)i[n]=0;s(0===a),s(0==(-8192&a))},g.prototype.stub=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=0;return t},g.prototype.mulp=function(e,t,i){var s=2*this.guessLen13b(e.length,t.length),r=this.makeRBT(s),a=this.stub(s),n=new Array(s),o=new Array(s),h=new Array(s),d=new Array(s),c=new Array(s),l=new Array(s),u=i.words;u.length=s,this.convert13b(e.words,e.length,n,s),this.convert13b(t.words,t.length,d,s),this.transform(n,a,o,h,s,r),this.transform(d,a,c,l,s,r);for(var f=0;f<s;f++){var p=o[f]*c[f]-h[f]*l[f];h[f]=o[f]*l[f]+h[f]*c[f],o[f]=p}return this.conjugate(o,h,s),this.transform(o,h,u,a,s,r),this.conjugate(u,a,s),this.normalize13b(u,s),i.negative=e.negative^t.negative,i.length=e.length+t.length,i.strip()},a.prototype.mul=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},a.prototype.mulf=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),m(this,e,t)},a.prototype.imul=function(e){return this.clone().mulTo(e,this)},a.prototype.imuln=function(e){s("number"==typeof e),s(e<67108864);for(var t=0,i=0;i<this.length;i++){var r=(0|this.words[i])*e,a=(67108863&r)+(67108863&t);t>>=26,t+=r/67108864|0,t+=a>>>26,this.words[i]=67108863&a}return 0!==t&&(this.words[i]=t,this.length++),this},a.prototype.muln=function(e){return this.clone().imuln(e)},a.prototype.sqr=function(){return this.mul(this)},a.prototype.isqr=function(){return this.imul(this.clone())},a.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),i=0;i<t.length;i++){var s=i/26|0,r=i%26;t[i]=(e.words[s]&1<<r)>>>r}return t}(e);if(0===t.length)return new a(1);for(var i=this,s=0;s<t.length&&0===t[s];s++,i=i.sqr());if(++s<t.length)for(var r=i.sqr();s<t.length;s++,r=r.sqr())0!==t[s]&&(i=i.mul(r));return i},a.prototype.iushln=function(e){s("number"==typeof e&&e>=0);var t,i=e%26,r=(e-i)/26,a=67108863>>>26-i<<26-i;if(0!==i){var n=0;for(t=0;t<this.length;t++){var o=this.words[t]&a,h=(0|this.words[t])-o<<i;this.words[t]=h|n,n=o>>>26-i}n&&(this.words[t]=n,this.length++)}if(0!==r){for(t=this.length-1;t>=0;t--)this.words[t+r]=this.words[t];for(t=0;t<r;t++)this.words[t]=0;this.length+=r}return this.strip()},a.prototype.ishln=function(e){return s(0===this.negative),this.iushln(e)},a.prototype.iushrn=function(e,t,i){var r;s("number"==typeof e&&e>=0),r=t?(t-t%26)/26:0;var a=e%26,n=Math.min((e-a)/26,this.length),o=67108863^67108863>>>a<<a,h=i;if(r-=n,r=Math.max(0,r),h){for(var d=0;d<n;d++)h.words[d]=this.words[d];h.length=n}if(0===n);else if(this.length>n)for(this.length-=n,d=0;d<this.length;d++)this.words[d]=this.words[d+n];else this.words[0]=0,this.length=1;var c=0;for(d=this.length-1;d>=0&&(0!==c||d>=r);d--){var l=0|this.words[d];this.words[d]=c<<26-a|l>>>a,c=l&o}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},a.prototype.ishrn=function(e,t,i){return s(0===this.negative),this.iushrn(e,t,i)},a.prototype.shln=function(e){return this.clone().ishln(e)},a.prototype.ushln=function(e){return this.clone().iushln(e)},a.prototype.shrn=function(e){return this.clone().ishrn(e)},a.prototype.ushrn=function(e){return this.clone().iushrn(e)},a.prototype.testn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,r=1<<t;return!(this.length<=i)&&!!(this.words[i]&r)},a.prototype.imaskn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(s(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var r=67108863^67108863>>>t<<t;this.words[this.length-1]&=r}return this.strip()},a.prototype.maskn=function(e){return this.clone().imaskn(e)},a.prototype.iaddn=function(e){return s("number"==typeof e),s(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},a.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},a.prototype.isubn=function(e){if(s("number"==typeof e),s(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},a.prototype.addn=function(e){return this.clone().iaddn(e)},a.prototype.subn=function(e){return this.clone().isubn(e)},a.prototype.iabs=function(){return this.negative=0,this},a.prototype.abs=function(){return this.clone().iabs()},a.prototype._ishlnsubmul=function(e,t,i){var r,a,n=e.length+i;this._expand(n);var o=0;for(r=0;r<e.length;r++){a=(0|this.words[r+i])+o;var h=(0|e.words[r])*t;o=((a-=67108863&h)>>26)-(h/67108864|0),this.words[r+i]=67108863&a}for(;r<this.length-i;r++)o=(a=(0|this.words[r+i])+o)>>26,this.words[r+i]=67108863&a;if(0===o)return this.strip();for(s(-1===o),o=0,r=0;r<this.length;r++)o=(a=-(0|this.words[r])+o)>>26,this.words[r]=67108863&a;return this.negative=1,this.strip()},a.prototype._wordDiv=function(e,t){var i=(this.length,e.length),s=this.clone(),r=e,n=0|r.words[r.length-1];0!==(i=26-this._countBits(n))&&(r=r.ushln(i),s.iushln(i),n=0|r.words[r.length-1]);var o,h=s.length-r.length;if("mod"!==t){(o=new a(null)).length=h+1,o.words=new Array(o.length);for(var d=0;d<o.length;d++)o.words[d]=0}var c=s.clone()._ishlnsubmul(r,1,h);0===c.negative&&(s=c,o&&(o.words[h]=1));for(var l=h-1;l>=0;l--){var u=67108864*(0|s.words[r.length+l])+(0|s.words[r.length+l-1]);for(u=Math.min(u/n|0,67108863),s._ishlnsubmul(r,u,l);0!==s.negative;)u--,s.negative=0,s._ishlnsubmul(r,1,l),s.isZero()||(s.negative^=1);o&&(o.words[l]=u)}return o&&o.strip(),s.strip(),"div"!==t&&0!==i&&s.iushrn(i),{div:o||null,mod:s}},a.prototype.divmod=function(e,t,i){return s(!e.isZero()),this.isZero()?{div:new a(0),mod:new a(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(r=o.div.neg()),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.iadd(e)),{div:r,mod:n}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(r=o.div.neg()),{div:r,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.isub(e)),{div:o.div,mod:n}):e.length>this.length||this.cmp(e)<0?{div:new a(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new a(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new a(this.modn(e.words[0]))}:this._wordDiv(e,t);var r,n,o},a.prototype.div=function(e){return this.divmod(e,"div",!1).div},a.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},a.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},a.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var i=0!==t.div.negative?t.mod.isub(e):t.mod,s=e.ushrn(1),r=e.andln(1),a=i.cmp(s);return a<0||1===r&&0===a?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},a.prototype.modn=function(e){s(e<=67108863);for(var t=(1<<26)%e,i=0,r=this.length-1;r>=0;r--)i=(t*i+(0|this.words[r]))%e;return i},a.prototype.idivn=function(e){s(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var r=(0|this.words[i])+67108864*t;this.words[i]=r/e|0,t=r%e}return this.strip()},a.prototype.divn=function(e){return this.clone().idivn(e)},a.prototype.egcd=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r=new a(1),n=new a(0),o=new a(0),h=new a(1),d=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++d;for(var c=i.clone(),l=t.clone();!t.isZero();){for(var u=0,f=1;0==(t.words[0]&f)&&u<26;++u,f<<=1);if(u>0)for(t.iushrn(u);u-- >0;)(r.isOdd()||n.isOdd())&&(r.iadd(c),n.isub(l)),r.iushrn(1),n.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(o.isOdd()||h.isOdd())&&(o.iadd(c),h.isub(l)),o.iushrn(1),h.iushrn(1);t.cmp(i)>=0?(t.isub(i),r.isub(o),n.isub(h)):(i.isub(t),o.isub(r),h.isub(n))}return{a:o,b:h,gcd:i.iushln(d)}},a.prototype._invmp=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r,n=new a(1),o=new a(0),h=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var d=0,c=1;0==(t.words[0]&c)&&d<26;++d,c<<=1);if(d>0)for(t.iushrn(d);d-- >0;)n.isOdd()&&n.iadd(h),n.iushrn(1);for(var l=0,u=1;0==(i.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(i.iushrn(l);l-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(o)):(i.isub(t),o.isub(n))}return(r=0===t.cmpn(1)?n:o).cmpn(0)<0&&r.iadd(e),r},a.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),i=e.clone();t.negative=0,i.negative=0;for(var s=0;t.isEven()&&i.isEven();s++)t.iushrn(1),i.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;i.isEven();)i.iushrn(1);var r=t.cmp(i);if(r<0){var a=t;t=i,i=a}else if(0===r||0===i.cmpn(1))break;t.isub(i)}return i.iushln(s)},a.prototype.invm=function(e){return this.egcd(e).a.umod(e)},a.prototype.isEven=function(){return 0==(1&this.words[0])},a.prototype.isOdd=function(){return 1==(1&this.words[0])},a.prototype.andln=function(e){return this.words[0]&e},a.prototype.bincn=function(e){s("number"==typeof e);var t=e%26,i=(e-t)/26,r=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=r,this;for(var a=r,n=i;0!==a&&n<this.length;n++){var o=0|this.words[n];a=(o+=a)>>>26,o&=67108863,this.words[n]=o}return 0!==a&&(this.words[n]=a,this.length++),this},a.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},a.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)t=1;else{i&&(e=-e),s(e<=67108863,"Number is too big");var r=0|this.words[0];t=r===e?0:r<e?-1:1}return 0!==this.negative?0|-t:t},a.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},a.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,i=this.length-1;i>=0;i--){var s=0|this.words[i],r=0|e.words[i];if(s!==r){s<r?t=-1:s>r&&(t=1);break}}return t},a.prototype.gtn=function(e){return 1===this.cmpn(e)},a.prototype.gt=function(e){return 1===this.cmp(e)},a.prototype.gten=function(e){return this.cmpn(e)>=0},a.prototype.gte=function(e){return this.cmp(e)>=0},a.prototype.ltn=function(e){return-1===this.cmpn(e)},a.prototype.lt=function(e){return-1===this.cmp(e)},a.prototype.lten=function(e){return this.cmpn(e)<=0},a.prototype.lte=function(e){return this.cmp(e)<=0},a.prototype.eqn=function(e){return 0===this.cmpn(e)},a.prototype.eq=function(e){return 0===this.cmp(e)},a.red=function(e){return new T(e)},a.prototype.toRed=function(e){return s(!this.red,"Already a number in reduction context"),s(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},a.prototype.fromRed=function(){return s(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},a.prototype._forceRed=function(e){return this.red=e,this},a.prototype.forceRed=function(e){return s(!this.red,"Already a number in reduction context"),this._forceRed(e)},a.prototype.redAdd=function(e){return s(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},a.prototype.redIAdd=function(e){return s(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},a.prototype.redSub=function(e){return s(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},a.prototype.redISub=function(e){return s(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},a.prototype.redShl=function(e){return s(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},a.prototype.redMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},a.prototype.redIMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},a.prototype.redSqr=function(){return s(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},a.prototype.redISqr=function(){return s(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},a.prototype.redSqrt=function(){return s(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},a.prototype.redInvm=function(){return s(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},a.prototype.redNeg=function(){return s(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},a.prototype.redPow=function(e){return s(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var y={k256:null,p224:null,p192:null,p25519:null};function b(e,t){this.name=e,this.p=new a(t,16),this.n=this.p.bitLength(),this.k=new a(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){b.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){b.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function S(){b.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function k(){b.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function T(e){if("string"==typeof e){var t=a._prime(e);this.m=t.p,this.prime=t}else s(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function _(e){T.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new a(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}b.prototype._tmp=function(){var e=new a(null);return e.words=new Array(Math.ceil(this.n/13)),e},b.prototype.ireduce=function(e){var t,i=e;do{this.split(i,this.tmp),t=(i=(i=this.imulK(i)).iadd(this.tmp)).bitLength()}while(t>this.n);var s=t<this.n?-1:i.ucmp(this.p);return 0===s?(i.words[0]=0,i.length=1):s>0?i.isub(this.p):void 0!==i.strip?i.strip():i._strip(),i},b.prototype.split=function(e,t){e.iushrn(this.n,0,t)},b.prototype.imulK=function(e){return e.imul(this.k)},r(v,b),v.prototype.split=function(e,t){for(var i=4194303,s=Math.min(e.length,9),r=0;r<s;r++)t.words[r]=e.words[r];if(t.length=s,e.length<=9)return e.words[0]=0,void(e.length=1);var a=e.words[9];for(t.words[t.length++]=a&i,r=10;r<e.length;r++){var n=0|e.words[r];e.words[r-10]=(n&i)<<4|a>>>22,a=n}a>>>=22,e.words[r-10]=a,0===a&&e.length>10?e.length-=10:e.length-=9},v.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,i=0;i<e.length;i++){var s=0|e.words[i];t+=977*s,e.words[i]=67108863&t,t=64*s+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},r(w,b),r(S,b),r(k,b),k.prototype.imulK=function(e){for(var t=0,i=0;i<e.length;i++){var s=19*(0|e.words[i])+t,r=67108863&s;s>>>=26,e.words[i]=r,t=s}return 0!==t&&(e.words[e.length++]=t),e},a._prime=function(e){if(y[e])return y[e];var t;if("k256"===e)t=new v;else if("p224"===e)t=new w;else if("p192"===e)t=new S;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new k}return y[e]=t,t},T.prototype._verify1=function(e){s(0===e.negative,"red works only with positives"),s(e.red,"red works only with red numbers")},T.prototype._verify2=function(e,t){s(0==(e.negative|t.negative),"red works only with positives"),s(e.red&&e.red===t.red,"red works only with red numbers")},T.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},T.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},T.prototype.add=function(e,t){this._verify2(e,t);var i=e.add(t);return i.cmp(this.m)>=0&&i.isub(this.m),i._forceRed(this)},T.prototype.iadd=function(e,t){this._verify2(e,t);var i=e.iadd(t);return i.cmp(this.m)>=0&&i.isub(this.m),i},T.prototype.sub=function(e,t){this._verify2(e,t);var i=e.sub(t);return i.cmpn(0)<0&&i.iadd(this.m),i._forceRed(this)},T.prototype.isub=function(e,t){this._verify2(e,t);var i=e.isub(t);return i.cmpn(0)<0&&i.iadd(this.m),i},T.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},T.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},T.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},T.prototype.isqr=function(e){return this.imul(e,e.clone())},T.prototype.sqr=function(e){return this.mul(e,e)},T.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(s(t%2==1),3===t){var i=this.m.add(new a(1)).iushrn(2);return this.pow(e,i)}for(var r=this.m.subn(1),n=0;!r.isZero()&&0===r.andln(1);)n++,r.iushrn(1);s(!r.isZero());var o=new a(1).toRed(this),h=o.redNeg(),d=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new a(2*c*c).toRed(this);0!==this.pow(c,d).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,r),u=this.pow(e,r.addn(1).iushrn(1)),f=this.pow(e,r),p=n;0!==f.cmp(o);){for(var m=f,g=0;0!==m.cmp(o);g++)m=m.redSqr();s(g<p);var y=this.pow(l,new a(1).iushln(p-g-1));u=u.redMul(y),l=y.redSqr(),f=f.redMul(l),p=g}return u},T.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},T.prototype.pow=function(e,t){if(t.isZero())return new a(1).toRed(this);if(0===t.cmpn(1))return e.clone();var i=new Array(16);i[0]=new a(1).toRed(this),i[1]=e;for(var s=2;s<i.length;s++)i[s]=this.mul(i[s-1],e);var r=i[0],n=0,o=0,h=t.bitLength()%26;for(0===h&&(h=26),s=t.length-1;s>=0;s--){for(var d=t.words[s],c=h-1;c>=0;c--){var l=d>>c&1;r!==i[0]&&(r=this.sqr(r)),0!==l||0!==n?(n<<=1,n|=l,(4===++o||0===s&&0===c)&&(r=this.mul(r,i[n]),o=0,n=0)):o=0}h=26}return r},T.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},T.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},a.mont=function(e){return new _(e)},r(_,T),_.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},_.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},_.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var i=e.imul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),a=r;return r.cmp(this.m)>=0?a=r.isub(this.m):r.cmpn(0)<0&&(a=r.iadd(this.m)),a._forceRed(this)},_.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new a(0)._forceRed(this);var i=e.mul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),n=r;return r.cmp(this.m)>=0?n=r.isub(this.m):r.cmpn(0)<0&&(n=r.iadd(this.m)),n._forceRed(this)},_.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=i.nmd(e),this)},13048:function(e,t,i){var s=i(89509).Buffer,r=i(62318);e.exports=function(e,t,i,a){if(s.isBuffer(e)||(e=s.from(e,"binary")),t&&(s.isBuffer(t)||(t=s.from(t,"binary")),8!==t.length))throw new RangeError("salt should be Buffer with 8 byte length");for(var n=i/8,o=s.alloc(n),h=s.alloc(a||0),d=s.alloc(0);n>0||a>0;){var c=new r;c.update(d),c.update(e),t&&c.update(t),d=c.digest();var l=0;if(n>0){var u=o.length-n;l=Math.min(n,d.length),d.copy(o,u,0,l),n-=l}if(l<d.length&&a>0){var f=h.length-a,p=Math.min(a,d.length-l);d.copy(h,f,l,l+p),a-=p}}return d.fill(0),{key:o,iv:h}}},3349:function(e,t,i){"use strict";var s=i(89509).Buffer,r=i(70326).Transform;function a(e){r.call(this),this._block=s.allocUnsafe(e),this._blockSize=e,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}i(35717)(a,r),a.prototype._transform=function(e,t,i){var s=null;try{this.update(e,t)}catch(e){s=e}i(s)},a.prototype._flush=function(e){var t=null;try{this.push(this.digest())}catch(e){t=e}e(t)},a.prototype.update=function(e,t){if(function(e,t){if(!s.isBuffer(e)&&"string"!=typeof e)throw new TypeError(t+" must be a string or a buffer")}(e,"Data"),this._finalized)throw new Error("Digest already called");s.isBuffer(e)||(e=s.from(e,t));for(var i=this._block,r=0;this._blockOffset+e.length-r>=this._blockSize;){for(var a=this._blockOffset;a<this._blockSize;)i[a++]=e[r++];this._update(),this._blockOffset=0}for(;r<e.length;)i[this._blockOffset++]=e[r++];for(var n=0,o=8*e.length;o>0;++n)this._length[n]+=o,(o=this._length[n]/4294967296|0)>0&&(this._length[n]-=4294967296*o);return this},a.prototype._update=function(){throw new Error("_update is not implemented")},a.prototype.digest=function(e){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var t=this._digest();void 0!==e&&(t=t.toString(e)),this._block.fill(0),this._blockOffset=0;for(var i=0;i<4;++i)this._length[i]=0;return t},a.prototype._digest=function(){throw new Error("_digest is not implemented")},e.exports=a},9786:function(e){"use strict";var t={};function i(e,i,s){s||(s=Error);var r=function(e){var t,s;function r(t,s,r){return e.call(this,function(e,t,s){return"string"==typeof i?i:i(e,t,s)}(t,s,r))||this}return s=e,(t=r).prototype=Object.create(s.prototype),t.prototype.constructor=t,t.__proto__=s,r}(s);r.prototype.name=s.name,r.prototype.code=e,t[e]=r}function s(e,t){if(Array.isArray(e)){var i=e.length;return e=e.map((function(e){return String(e)})),i>2?"one of ".concat(t," ").concat(e.slice(0,i-1).join(", "),", or ")+e[i-1]:2===i?"one of ".concat(t," ").concat(e[0]," or ").concat(e[1]):"of ".concat(t," ").concat(e[0])}return"of ".concat(t," ").concat(String(e))}i("ERR_INVALID_OPT_VALUE",(function(e,t){return'The value "'+t+'" is invalid for option "'+e+'"'}),TypeError),i("ERR_INVALID_ARG_TYPE",(function(e,t,i){var r,a,n,o;if("string"==typeof t&&(a="not ",t.substr(!n||n<0?0:+n,a.length)===a)?(r="must not be",t=t.replace(/^not /,"")):r="must be",function(e,t,i){return(void 0===i||i>e.length)&&(i=e.length),e.substring(i-t.length,i)===t}(e," argument"))o="The ".concat(e," ").concat(r," ").concat(s(t,"type"));else{var h=function(e,t,i){return"number"!=typeof i&&(i=0),!(i+t.length>e.length)&&-1!==e.indexOf(t,i)}(e,".")?"property":"argument";o='The "'.concat(e,'" ').concat(h," ").concat(r," ").concat(s(t,"type"))}return o+=". Received type ".concat(typeof i)}),TypeError),i("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),i("ERR_METHOD_NOT_IMPLEMENTED",(function(e){return"The "+e+" method is not implemented"})),i("ERR_STREAM_PREMATURE_CLOSE","Premature close"),i("ERR_STREAM_DESTROYED",(function(e){return"Cannot call "+e+" after a stream was destroyed"})),i("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),i("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),i("ERR_STREAM_WRITE_AFTER_END","write after end"),i("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),i("ERR_UNKNOWN_ENCODING",(function(e){return"Unknown encoding: "+e}),TypeError),i("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),e.exports.q=t},62910:function(e,t,i){"use strict";var s=i(34155),r=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t};e.exports=c;var a=i(45789),n=i(70469);i(35717)(c,a);for(var o=r(n.prototype),h=0;h<o.length;h++){var d=o[h];c.prototype[d]||(c.prototype[d]=n.prototype[d])}function c(e){if(!(this instanceof c))return new c(e);a.call(this,e),n.call(this,e),this.allowHalfOpen=!0,e&&(!1===e.readable&&(this.readable=!1),!1===e.writable&&(this.writable=!1),!1===e.allowHalfOpen&&(this.allowHalfOpen=!1,this.once("end",l)))}function l(){this._writableState.ended||s.nextTick(u,this)}function u(e){e.end()}Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}})},58994:function(e,t,i){"use strict";e.exports=r;var s=i(70421);function r(e){if(!(this instanceof r))return new r(e);s.call(this,e)}i(35717)(r,s),r.prototype._transform=function(e,t,i){i(null,e)}},45789:function(e,t,i){"use strict";var s,r=i(34155);e.exports=O,O.ReadableState=_;i(17187).EventEmitter;var a=function(e,t){return e.listeners(t).length},n=i(50677),o=i(48764).Buffer,h=i.g.Uint8Array||function(){};var d,c=i(31616);d=c&&c.debuglog?c.debuglog("stream"):function(){};var l,u,f,p=i(98354),m=i(35072),g=i(31222).getHighWaterMark,y=i(9786).q,b=y.ERR_INVALID_ARG_TYPE,v=y.ERR_STREAM_PUSH_AFTER_EOF,w=y.ERR_METHOD_NOT_IMPLEMENTED,S=y.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;i(35717)(O,n);var k=m.errorOrDestroy,T=["error","close","destroy","pause","resume"];function _(e,t,r){s=s||i(62910),e=e||{},"boolean"!=typeof r&&(r=t instanceof s),this.objectMode=!!e.objectMode,r&&(this.objectMode=this.objectMode||!!e.readableObjectMode),this.highWaterMark=g(this,e,"readableHighWaterMark",r),this.buffer=new p,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(l||(l=i(32553).s),this.decoder=new l(e.encoding),this.encoding=e.encoding)}function O(e){if(s=s||i(62910),!(this instanceof O))return new O(e);var t=this instanceof s;this._readableState=new _(e,this,t),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),n.call(this)}function M(e,t,i,s,r){d("readableAddChunk",t);var a,n=e._readableState;if(null===t)n.reading=!1,function(e,t){if(d("onEofChunk"),t.ended)return;if(t.decoder){var i=t.decoder.end();i&&i.length&&(t.buffer.push(i),t.length+=t.objectMode?1:i.length)}t.ended=!0,t.sync?P(e):(t.needReadable=!1,t.emittedReadable||(t.emittedReadable=!0,A(e)))}(e,n);else if(r||(a=function(e,t){var i;s=t,o.isBuffer(s)||s instanceof h||"string"==typeof t||void 0===t||e.objectMode||(i=new b("chunk",["string","Buffer","Uint8Array"],t));var s;return i}(n,t)),a)k(e,a);else if(n.objectMode||t&&t.length>0)if("string"==typeof t||n.objectMode||Object.getPrototypeOf(t)===o.prototype||(t=function(e){return o.from(e)}(t)),s)n.endEmitted?k(e,new S):I(e,n,t,!0);else if(n.ended)k(e,new v);else{if(n.destroyed)return!1;n.reading=!1,n.decoder&&!i?(t=n.decoder.write(t),n.objectMode||0!==t.length?I(e,n,t,!1):N(e,n)):I(e,n,t,!1)}else s||(n.reading=!1,N(e,n));return!n.ended&&(n.length<n.highWaterMark||0===n.length)}function I(e,t,i,s){t.flowing&&0===t.length&&!t.sync?(t.awaitDrain=0,e.emit("data",i)):(t.length+=t.objectMode?1:i.length,s?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&P(e)),N(e,t)}Object.defineProperty(O.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),O.prototype.destroy=m.destroy,O.prototype._undestroy=m.undestroy,O.prototype._destroy=function(e,t){t(e)},O.prototype.push=function(e,t){var i,s=this._readableState;return s.objectMode?i=!0:"string"==typeof e&&((t=t||s.defaultEncoding)!==s.encoding&&(e=o.from(e,t),t=""),i=!0),M(this,e,t,!1,i)},O.prototype.unshift=function(e){return M(this,e,null,!0,!1)},O.prototype.isPaused=function(){return!1===this._readableState.flowing},O.prototype.setEncoding=function(e){l||(l=i(32553).s);var t=new l(e);this._readableState.decoder=t,this._readableState.encoding=this._readableState.decoder.encoding;for(var s=this._readableState.buffer.head,r="";null!==s;)r+=t.write(s.data),s=s.next;return this._readableState.buffer.clear(),""!==r&&this._readableState.buffer.push(r),this._readableState.length=r.length,this};var x=1073741824;function C(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=x?e=x:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function P(e){var t=e._readableState;d("emitReadable",t.needReadable,t.emittedReadable),t.needReadable=!1,t.emittedReadable||(d("emitReadable",t.flowing),t.emittedReadable=!0,r.nextTick(A,e))}function A(e){var t=e._readableState;d("emitReadable_",t.destroyed,t.length,t.ended),t.destroyed||!t.length&&!t.ended||(e.emit("readable"),t.emittedReadable=!1),t.needReadable=!t.flowing&&!t.ended&&t.length<=t.highWaterMark,R(e)}function N(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(B,e,t))}function B(e,t){for(;!t.reading&&!t.ended&&(t.length<t.highWaterMark||t.flowing&&0===t.length);){var i=t.length;if(d("maybeReadMore read 0"),e.read(0),i===t.length)break}t.readingMore=!1}function E(e){var t=e._readableState;t.readableListening=e.listenerCount("readable")>0,t.resumeScheduled&&!t.paused?t.flowing=!0:e.listenerCount("data")>0&&e.resume()}function V(e){d("readable nexttick read 0"),e.read(0)}function L(e,t){d("resume",t.reading),t.reading||e.read(0),t.resumeScheduled=!1,e.emit("resume"),R(e),t.flowing&&!t.reading&&e.read(0)}function R(e){var t=e._readableState;for(d("flow",t.flowing);t.flowing&&null!==e.read(););}function D(e,t){return 0===t.length?null:(t.objectMode?i=t.buffer.shift():!e||e>=t.length?(i=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.first():t.buffer.concat(t.length),t.buffer.clear()):i=t.buffer.consume(e,t.decoder),i);var i}function F(e){var t=e._readableState;d("endReadable",t.endEmitted),t.endEmitted||(t.ended=!0,r.nextTick(q,t,e))}function q(e,t){if(d("endReadableNT",e.endEmitted,e.length),!e.endEmitted&&0===e.length&&(e.endEmitted=!0,t.readable=!1,t.emit("end"),e.autoDestroy)){var i=t._writableState;(!i||i.autoDestroy&&i.finished)&&t.destroy()}}function G(e,t){for(var i=0,s=e.length;i<s;i++)if(e[i]===t)return i;return-1}O.prototype.read=function(e){d("read",e),e=parseInt(e,10);var t=this._readableState,i=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&((0!==t.highWaterMark?t.length>=t.highWaterMark:t.length>0)||t.ended))return d("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?F(this):P(this),null;if(0===(e=C(e,t))&&t.ended)return 0===t.length&&F(this),null;var s,r=t.needReadable;return d("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&d("length less than watermark",r=!0),t.ended||t.reading?d("reading or ended",r=!1):r&&(d("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=C(i,t))),null===(s=e>0?D(e,t):null)?(t.needReadable=t.length<=t.highWaterMark,e=0):(t.length-=e,t.awaitDrain=0),0===t.length&&(t.ended||(t.needReadable=!0),i!==e&&t.ended&&F(this)),null!==s&&this.emit("data",s),s},O.prototype._read=function(e){k(this,new w("_read()"))},O.prototype.pipe=function(e,t){var i=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1,d("pipe count=%d opts=%j",s.pipesCount,t);var n=(!t||!1!==t.end)&&e!==r.stdout&&e!==r.stderr?h:g;function o(t,r){d("onunpipe"),t===i&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,d("cleanup"),e.removeListener("close",p),e.removeListener("finish",m),e.removeListener("drain",c),e.removeListener("error",f),e.removeListener("unpipe",o),i.removeListener("end",h),i.removeListener("end",g),i.removeListener("data",u),l=!0,!s.awaitDrain||e._writableState&&!e._writableState.needDrain||c())}function h(){d("onend"),e.end()}s.endEmitted?r.nextTick(n):i.once("end",n),e.on("unpipe",o);var c=function(e){return function(){var t=e._readableState;d("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&a(e,"data")&&(t.flowing=!0,R(e))}}(i);e.on("drain",c);var l=!1;function u(t){d("ondata");var r=e.write(t);d("dest.write",r),!1===r&&((1===s.pipesCount&&s.pipes===e||s.pipesCount>1&&-1!==G(s.pipes,e))&&!l&&(d("false write response, pause",s.awaitDrain),s.awaitDrain++),i.pause())}function f(t){d("onerror",t),g(),e.removeListener("error",f),0===a(e,"error")&&k(e,t)}function p(){e.removeListener("finish",m),g()}function m(){d("onfinish"),e.removeListener("close",p),g()}function g(){d("unpipe"),i.unpipe(e)}return i.on("data",u),function(e,t,i){if("function"==typeof e.prependListener)return e.prependListener(t,i);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(i):e._events[t]=[i,e._events[t]]:e.on(t,i)}(e,"error",f),e.once("close",p),e.once("finish",m),e.emit("pipe",i),s.flowing||(d("pipe resume"),i.resume()),e},O.prototype.unpipe=function(e){var t=this._readableState,i={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,i)),this;if(!e){var s=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<r;a++)s[a].emit("unpipe",this,{hasUnpiped:!1});return this}var n=G(t.pipes,e);return-1===n||(t.pipes.splice(n,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,i)),this},O.prototype.on=function(e,t){var i=n.prototype.on.call(this,e,t),s=this._readableState;return"data"===e?(s.readableListening=this.listenerCount("readable")>0,!1!==s.flowing&&this.resume()):"readable"===e&&(s.endEmitted||s.readableListening||(s.readableListening=s.needReadable=!0,s.flowing=!1,s.emittedReadable=!1,d("on readable",s.length,s.reading),s.length?P(this):s.reading||r.nextTick(V,this))),i},O.prototype.addListener=O.prototype.on,O.prototype.removeListener=function(e,t){var i=n.prototype.removeListener.call(this,e,t);return"readable"===e&&r.nextTick(E,this),i},O.prototype.removeAllListeners=function(e){var t=n.prototype.removeAllListeners.apply(this,arguments);return"readable"!==e&&void 0!==e||r.nextTick(E,this),t},O.prototype.resume=function(){var e=this._readableState;return e.flowing||(d("resume"),e.flowing=!e.readableListening,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(L,e,t))}(this,e)),e.paused=!1,this},O.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},O.prototype.wrap=function(e){var t=this,i=this._readableState,s=!1;for(var r in e.on("end",(function(){if(d("wrapped end"),i.decoder&&!i.ended){var e=i.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(r){(d("wrapped data"),i.decoder&&(r=i.decoder.write(r)),i.objectMode&&null==r)||(i.objectMode||r&&r.length)&&(t.push(r)||(s=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var a=0;a<T.length;a++)e.on(T[a],this.emit.bind(this,T[a]));return this._read=function(t){d("wrapped _read",t),s&&(s=!1,e.resume())},this},"function"==typeof Symbol&&(O.prototype[Symbol.asyncIterator]=function(){return void 0===u&&(u=i(30527)),u(this)}),Object.defineProperty(O.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(O.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(O.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(e){this._readableState&&(this._readableState.flowing=e)}}),O._fromList=D,Object.defineProperty(O.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),"function"==typeof Symbol&&(O.from=function(e,t){return void 0===f&&(f=i(5327)),f(O,e,t)})},70421:function(e,t,i){"use strict";e.exports=c;var s=i(9786).q,r=s.ERR_METHOD_NOT_IMPLEMENTED,a=s.ERR_MULTIPLE_CALLBACK,n=s.ERR_TRANSFORM_ALREADY_TRANSFORMING,o=s.ERR_TRANSFORM_WITH_LENGTH_0,h=i(62910);function d(e,t){var i=this._transformState;i.transforming=!1;var s=i.writecb;if(null===s)return this.emit("error",new a);i.writechunk=null,i.writecb=null,null!=t&&this.push(t),s(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function c(e){if(!(this instanceof c))return new c(e);h.call(this,e),this._transformState={afterTransform:d.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",l)}function l(){var e=this;"function"!=typeof this._flush||this._readableState.destroyed?u(this,null,null):this._flush((function(t,i){u(e,t,i)}))}function u(e,t,i){if(t)return e.emit("error",t);if(null!=i&&e.push(i),e._writableState.length)throw new o;if(e._transformState.transforming)throw new n;return e.push(null)}i(35717)(c,h),c.prototype.push=function(e,t){return this._transformState.needTransform=!1,h.prototype.push.call(this,e,t)},c.prototype._transform=function(e,t,i){i(new r("_transform()"))},c.prototype._write=function(e,t,i){var s=this._transformState;if(s.writecb=i,s.writechunk=e,s.writeencoding=t,!s.transforming){var r=this._readableState;(s.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},c.prototype._read=function(e){var t=this._transformState;null===t.writechunk||t.transforming?t.needTransform=!0:(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform))},c.prototype._destroy=function(e,t){h.prototype._destroy.call(this,e,(function(e){t(e)}))}},70469:function(e,t,i){"use strict";var s,r=i(34155);function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,i){var s=e.entry;e.entry=null;for(;s;){var r=s.callback;t.pendingcb--,r(i),s=s.next}t.corkedRequestsFree.next=e}(t,e)}}e.exports=O,O.WritableState=_;var n={deprecate:i(94927)},o=i(50677),h=i(48764).Buffer,d=i.g.Uint8Array||function(){};var c,l=i(35072),u=i(31222).getHighWaterMark,f=i(9786).q,p=f.ERR_INVALID_ARG_TYPE,m=f.ERR_METHOD_NOT_IMPLEMENTED,g=f.ERR_MULTIPLE_CALLBACK,y=f.ERR_STREAM_CANNOT_PIPE,b=f.ERR_STREAM_DESTROYED,v=f.ERR_STREAM_NULL_VALUES,w=f.ERR_STREAM_WRITE_AFTER_END,S=f.ERR_UNKNOWN_ENCODING,k=l.errorOrDestroy;function T(){}function _(e,t,n){s=s||i(62910),e=e||{},"boolean"!=typeof n&&(n=t instanceof s),this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode),this.highWaterMark=u(this,e,"writableHighWaterMark",n),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var o=!1===e.decodeStrings;this.decodeStrings=!o,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var i=e._writableState,s=i.sync,a=i.writecb;if("function"!=typeof a)throw new g;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(i),t)!function(e,t,i,s,a){--t.pendingcb,i?(r.nextTick(a,s),r.nextTick(A,e,t),e._writableState.errorEmitted=!0,k(e,s)):(a(s),e._writableState.errorEmitted=!0,k(e,s),A(e,t))}(e,i,s,t,a);else{var n=C(i)||e.destroyed;n||i.corked||i.bufferProcessing||!i.bufferedRequest||x(e,i),s?r.nextTick(I,e,i,n,a):I(e,i,n,a)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==e.emitClose,this.autoDestroy=!!e.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function O(e){var t=this instanceof(s=s||i(62910));if(!t&&!c.call(O,this))return new O(e);this._writableState=new _(e,this,t),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),o.call(this)}function M(e,t,i,s,r,a,n){t.writelen=s,t.writecb=n,t.writing=!0,t.sync=!0,t.destroyed?t.onwrite(new b("write")):i?e._writev(r,t.onwrite):e._write(r,a,t.onwrite),t.sync=!1}function I(e,t,i,s){i||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,s(),A(e,t)}function x(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){var s=t.bufferedRequestCount,r=new Array(s),n=t.corkedRequestsFree;n.entry=i;for(var o=0,h=!0;i;)r[o]=i,i.isBuf||(h=!1),i=i.next,o+=1;r.allBuffers=h,M(e,t,!0,t.length,r,"",n.finish),t.pendingcb++,t.lastBufferedRequest=null,n.next?(t.corkedRequestsFree=n.next,n.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;i;){var d=i.chunk,c=i.encoding,l=i.callback;if(M(e,t,!1,t.objectMode?1:d.length,d,c,l),i=i.next,t.bufferedRequestCount--,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequest=i,t.bufferProcessing=!1}function C(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function P(e,t){e._final((function(i){t.pendingcb--,i&&k(e,i),t.prefinished=!0,e.emit("prefinish"),A(e,t)}))}function A(e,t){var i=C(t);if(i&&(function(e,t){t.prefinished||t.finalCalled||("function"!=typeof e._final||t.destroyed?(t.prefinished=!0,e.emit("prefinish")):(t.pendingcb++,t.finalCalled=!0,r.nextTick(P,e,t)))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"),t.autoDestroy))){var s=e._readableState;(!s||s.autoDestroy&&s.endEmitted)&&e.destroy()}return i}i(35717)(O,o),_.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(_.prototype,"buffer",{get:n.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(c=Function.prototype[Symbol.hasInstance],Object.defineProperty(O,Symbol.hasInstance,{value:function(e){return!!c.call(this,e)||this===O&&(e&&e._writableState instanceof _)}})):c=function(e){return e instanceof this},O.prototype.pipe=function(){k(this,new y)},O.prototype.write=function(e,t,i){var s,a=this._writableState,n=!1,o=!a.objectMode&&(s=e,h.isBuffer(s)||s instanceof d);return o&&!h.isBuffer(e)&&(e=function(e){return h.from(e)}(e)),"function"==typeof t&&(i=t,t=null),o?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof i&&(i=T),a.ending?function(e,t){var i=new w;k(e,i),r.nextTick(t,i)}(this,i):(o||function(e,t,i,s){var a;return null===i?a=new v:"string"==typeof i||t.objectMode||(a=new p("chunk",["string","Buffer"],i)),!a||(k(e,a),r.nextTick(s,a),!1)}(this,a,e,i))&&(a.pendingcb++,n=function(e,t,i,s,r,a){if(!i){var n=function(e,t,i){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=h.from(t,i));return t}(t,s,r);s!==n&&(i=!0,r="buffer",s=n)}var o=t.objectMode?1:s.length;t.length+=o;var d=t.length<t.highWaterMark;d||(t.needDrain=!0);if(t.writing||t.corked){var c=t.lastBufferedRequest;t.lastBufferedRequest={chunk:s,encoding:r,isBuf:i,callback:a,next:null},c?c.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else M(e,t,!1,o,s,r,a);return d}(this,a,o,e,t,i)),n},O.prototype.cork=function(){this._writableState.corked++},O.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.bufferProcessing||!e.bufferedRequest||x(this,e))},O.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new S(e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(O.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(O.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),O.prototype._write=function(e,t,i){i(new m("_write()"))},O.prototype._writev=null,O.prototype.end=function(e,t,i){var s=this._writableState;return"function"==typeof e?(i=e,e=null,t=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),s.corked&&(s.corked=1,this.uncork()),s.ending||function(e,t,i){t.ending=!0,A(e,t),i&&(t.finished?r.nextTick(i):e.once("finish",i));t.ended=!0,e.writable=!1}(this,s,i),this},Object.defineProperty(O.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(O.prototype,"destroyed",{enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),O.prototype.destroy=l.destroy,O.prototype._undestroy=l.undestroy,O.prototype._destroy=function(e,t){t(e)}},30527:function(e,t,i){"use strict";var s,r=i(34155);function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var n=i(28640),o=Symbol("lastResolve"),h=Symbol("lastReject"),d=Symbol("error"),c=Symbol("ended"),l=Symbol("lastPromise"),u=Symbol("handlePromise"),f=Symbol("stream");function p(e,t){return{value:e,done:t}}function m(e){var t=e[o];if(null!==t){var i=e[f].read();null!==i&&(e[l]=null,e[o]=null,e[h]=null,t(p(i,!1)))}}function g(e){r.nextTick(m,e)}var y=Object.getPrototypeOf((function(){})),b=Object.setPrototypeOf((a(s={get stream(){return this[f]},next:function(){var e=this,t=this[d];if(null!==t)return Promise.reject(t);if(this[c])return Promise.resolve(p(void 0,!0));if(this[f].destroyed)return new Promise((function(t,i){r.nextTick((function(){e[d]?i(e[d]):t(p(void 0,!0))}))}));var i,s=this[l];if(s)i=new Promise(function(e,t){return function(i,s){e.then((function(){t[c]?i(p(void 0,!0)):t[u](i,s)}),s)}}(s,this));else{var a=this[f].read();if(null!==a)return Promise.resolve(p(a,!1));i=new Promise(this[u])}return this[l]=i,i}},Symbol.asyncIterator,(function(){return this})),a(s,"return",(function(){var e=this;return new Promise((function(t,i){e[f].destroy(null,(function(e){e?i(e):t(p(void 0,!0))}))}))})),s),y);e.exports=function(e){var t,i=Object.create(b,(a(t={},f,{value:e,writable:!0}),a(t,o,{value:null,writable:!0}),a(t,h,{value:null,writable:!0}),a(t,d,{value:null,writable:!0}),a(t,c,{value:e._readableState.endEmitted,writable:!0}),a(t,u,{value:function(e,t){var s=i[f].read();s?(i[l]=null,i[o]=null,i[h]=null,e(p(s,!1))):(i[o]=e,i[h]=t)},writable:!0}),t));return i[l]=null,n(e,(function(e){if(e&&"ERR_STREAM_PREMATURE_CLOSE"!==e.code){var t=i[h];return null!==t&&(i[l]=null,i[o]=null,i[h]=null,t(e)),void(i[d]=e)}var s=i[o];null!==s&&(i[l]=null,i[o]=null,i[h]=null,s(p(void 0,!0))),i[c]=!0})),e.on("readable",g.bind(null,i)),i}},98354:function(e,t,i){"use strict";function s(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,s)}return i}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}var n=i(48764).Buffer,o=i(69386).inspect,h=o&&o.custom||"inspect";e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}var t,i,d;return t=e,i=[{key:"push",value:function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length}},{key:"unshift",value:function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length}},{key:"shift",value:function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i}},{key:"concat",value:function(e){if(0===this.length)return n.alloc(0);for(var t,i,s,r=n.allocUnsafe(e>>>0),a=this.head,o=0;a;)t=a.data,i=r,s=o,n.prototype.copy.call(t,i,s),o+=a.data.length,a=a.next;return r}},{key:"consume",value:function(e,t){var i;return e<this.head.data.length?(i=this.head.data.slice(0,e),this.head.data=this.head.data.slice(e)):i=e===this.head.data.length?this.shift():t?this._getString(e):this._getBuffer(e),i}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(e){var t=this.head,i=1,s=t.data;for(e-=s.length;t=t.next;){var r=t.data,a=e>r.length?r.length:e;if(a===r.length?s+=r:s+=r.slice(0,e),0==(e-=a)){a===r.length?(++i,t.next?this.head=t.next:this.head=this.tail=null):(this.head=t,t.data=r.slice(a));break}++i}return this.length-=i,s}},{key:"_getBuffer",value:function(e){var t=n.allocUnsafe(e),i=this.head,s=1;for(i.data.copy(t),e-=i.data.length;i=i.next;){var r=i.data,a=e>r.length?r.length:e;if(r.copy(t,t.length-e,0,a),0==(e-=a)){a===r.length?(++s,i.next?this.head=i.next:this.head=this.tail=null):(this.head=i,i.data=r.slice(a));break}++s}return this.length-=s,t}},{key:h,value:function(e,t){return o(this,function(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?s(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}({},t,{depth:0,customInspect:!1}))}}],i&&a(t.prototype,i),d&&a(t,d),e}()},35072:function(e,t,i){"use strict";var s=i(34155);function r(e,t){n(e,t),a(e)}function a(e){e._writableState&&!e._writableState.emitClose||e._readableState&&!e._readableState.emitClose||e.emit("close")}function n(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var i=this,o=this._readableState&&this._readableState.destroyed,h=this._writableState&&this._writableState.destroyed;return o||h?(t?t(e):e&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,s.nextTick(n,this,e)):s.nextTick(n,this,e)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?i._writableState?i._writableState.errorEmitted?s.nextTick(a,i):(i._writableState.errorEmitted=!0,s.nextTick(r,i,e)):s.nextTick(r,i,e):t?(s.nextTick(a,i),t(e)):s.nextTick(a,i)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(e,t){var i=e._readableState,s=e._writableState;i&&i.autoDestroy||s&&s.autoDestroy?e.destroy(t):e.emit("error",t)}}},28640:function(e,t,i){"use strict";var s=i(9786).q.ERR_STREAM_PREMATURE_CLOSE;function r(){}e.exports=function e(t,i,a){if("function"==typeof i)return e(t,null,i);i||(i={}),a=function(e){var t=!1;return function(){if(!t){t=!0;for(var i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];e.apply(this,s)}}}(a||r);var n=i.readable||!1!==i.readable&&t.readable,o=i.writable||!1!==i.writable&&t.writable,h=function(){t.writable||c()},d=t._writableState&&t._writableState.finished,c=function(){o=!1,d=!0,n||a.call(t)},l=t._readableState&&t._readableState.endEmitted,u=function(){n=!1,l=!0,o||a.call(t)},f=function(e){a.call(t,e)},p=function(){var e;return n&&!l?(t._readableState&&t._readableState.ended||(e=new s),a.call(t,e)):o&&!d?(t._writableState&&t._writableState.ended||(e=new s),a.call(t,e)):void 0},m=function(){t.req.on("finish",c)};return!function(e){return e.setHeader&&"function"==typeof e.abort}(t)?o&&!t._writableState&&(t.on("end",h),t.on("close",h)):(t.on("complete",c),t.on("abort",p),t.req?m():t.on("request",m)),t.on("end",u),t.on("finish",c),!1!==i.error&&t.on("error",f),t.on("close",p),function(){t.removeListener("complete",c),t.removeListener("abort",p),t.removeListener("request",m),t.req&&t.req.removeListener("finish",c),t.removeListener("end",h),t.removeListener("close",h),t.removeListener("finish",c),t.removeListener("end",u),t.removeListener("error",f),t.removeListener("close",p)}}},5327:function(e){e.exports=function(){throw new Error("Readable.from is not available in the browser")}},64218:function(e,t,i){"use strict";var s;var r=i(9786).q,a=r.ERR_MISSING_ARGS,n=r.ERR_STREAM_DESTROYED;function o(e){if(e)throw e}function h(e,t,r,a){a=function(e){var t=!1;return function(){t||(t=!0,e.apply(void 0,arguments))}}(a);var o=!1;e.on("close",(function(){o=!0})),void 0===s&&(s=i(28640)),s(e,{readable:t,writable:r},(function(e){if(e)return a(e);o=!0,a()}));var h=!1;return function(t){if(!o&&!h)return h=!0,function(e){return e.setHeader&&"function"==typeof e.abort}(e)?e.abort():"function"==typeof e.destroy?e.destroy():void a(t||new n("pipe"))}}function d(e){e()}function c(e,t){return e.pipe(t)}function l(e){return e.length?"function"!=typeof e[e.length-1]?o:e.pop():o}e.exports=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];var s,r=l(t);if(Array.isArray(t[0])&&(t=t[0]),t.length<2)throw new a("streams");var n=t.map((function(e,i){var a=i<t.length-1;return h(e,a,i>0,(function(e){s||(s=e),e&&n.forEach(d),a||(n.forEach(d),r(s))}))}));return t.reduce(c)}},31222:function(e,t,i){"use strict";var s=i(9786).q.ERR_INVALID_OPT_VALUE;e.exports={getHighWaterMark:function(e,t,i,r){var a=function(e,t,i){return null!=e.highWaterMark?e.highWaterMark:t?e[i]:null}(t,r,i);if(null!=a){if(!isFinite(a)||Math.floor(a)!==a||a<0)throw new s(r?i:"highWaterMark",a);return Math.floor(a)}return e.objectMode?16:16384}}},50677:function(e,t,i){e.exports=i(17187).EventEmitter},70326:function(e,t,i){(t=e.exports=i(45789)).Stream=t,t.Readable=t,t.Writable=i(70469),t.Duplex=i(62910),t.Transform=i(70421),t.PassThrough=i(58994),t.finished=i(28640),t.pipeline=i(64218)},2156:function(e,t,i){"use strict";var s=i(33715),r=i(34504),a=i(79746);function n(e){if(!(this instanceof n))return new n(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=r.toArray(e.entropy,e.entropyEnc||"hex"),i=r.toArray(e.nonce,e.nonceEnc||"hex"),s=r.toArray(e.pers,e.persEnc||"hex");a(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,i,s)}e.exports=n,n.prototype._init=function(e,t,i){var s=e.concat(t).concat(i);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var r=0;r<this.V.length;r++)this.K[r]=0,this.V[r]=1;this._update(s),this._reseed=1,this.reseedInterval=281474976710656},n.prototype._hmac=function(){return new s.hmac(this.hash,this.K)},n.prototype._update=function(e){var t=this._hmac().update(this.V).update([0]);e&&(t=t.update(e)),this.K=t.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())},n.prototype.reseed=function(e,t,i,s){"string"!=typeof t&&(s=i,i=t,t=null),e=r.toArray(e,t),i=r.toArray(i,s),a(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(i||[])),this._reseed=1},n.prototype.generate=function(e,t,i,s){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof t&&(s=i,i=t,t=null),i&&(i=r.toArray(i,s||"hex"),this._update(i));for(var a=[];a.length<e;)this.V=this._hmac().update(this.V).digest(),a=a.concat(this.V);var n=a.slice(0,e);return this._update(i),this._reseed++,r.encode(n,t)}},62318:function(e,t,i){"use strict";var s=i(35717),r=i(3349),a=i(89509).Buffer,n=new Array(16);function o(){r.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}function h(e,t){return e<<t|e>>>32-t}function d(e,t,i,s,r,a,n){return h(e+(t&i|~t&s)+r+a|0,n)+t|0}function c(e,t,i,s,r,a,n){return h(e+(t&s|i&~s)+r+a|0,n)+t|0}function l(e,t,i,s,r,a,n){return h(e+(t^i^s)+r+a|0,n)+t|0}function u(e,t,i,s,r,a,n){return h(e+(i^(t|~s))+r+a|0,n)+t|0}s(o,r),o.prototype._update=function(){for(var e=n,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);var i=this._a,s=this._b,r=this._c,a=this._d;i=d(i,s,r,a,e[0],3614090360,7),a=d(a,i,s,r,e[1],3905402710,12),r=d(r,a,i,s,e[2],606105819,17),s=d(s,r,a,i,e[3],3250441966,22),i=d(i,s,r,a,e[4],4118548399,7),a=d(a,i,s,r,e[5],1200080426,12),r=d(r,a,i,s,e[6],2821735955,17),s=d(s,r,a,i,e[7],4249261313,22),i=d(i,s,r,a,e[8],1770035416,7),a=d(a,i,s,r,e[9],2336552879,12),r=d(r,a,i,s,e[10],4294925233,17),s=d(s,r,a,i,e[11],2304563134,22),i=d(i,s,r,a,e[12],1804603682,7),a=d(a,i,s,r,e[13],4254626195,12),r=d(r,a,i,s,e[14],2792965006,17),i=c(i,s=d(s,r,a,i,e[15],1236535329,22),r,a,e[1],4129170786,5),a=c(a,i,s,r,e[6],3225465664,9),r=c(r,a,i,s,e[11],643717713,14),s=c(s,r,a,i,e[0],3921069994,20),i=c(i,s,r,a,e[5],3593408605,5),a=c(a,i,s,r,e[10],38016083,9),r=c(r,a,i,s,e[15],3634488961,14),s=c(s,r,a,i,e[4],3889429448,20),i=c(i,s,r,a,e[9],568446438,5),a=c(a,i,s,r,e[14],3275163606,9),r=c(r,a,i,s,e[3],4107603335,14),s=c(s,r,a,i,e[8],1163531501,20),i=c(i,s,r,a,e[13],2850285829,5),a=c(a,i,s,r,e[2],4243563512,9),r=c(r,a,i,s,e[7],1735328473,14),i=l(i,s=c(s,r,a,i,e[12],2368359562,20),r,a,e[5],4294588738,4),a=l(a,i,s,r,e[8],2272392833,11),r=l(r,a,i,s,e[11],1839030562,16),s=l(s,r,a,i,e[14],4259657740,23),i=l(i,s,r,a,e[1],2763975236,4),a=l(a,i,s,r,e[4],1272893353,11),r=l(r,a,i,s,e[7],4139469664,16),s=l(s,r,a,i,e[10],3200236656,23),i=l(i,s,r,a,e[13],681279174,4),a=l(a,i,s,r,e[0],3936430074,11),r=l(r,a,i,s,e[3],3572445317,16),s=l(s,r,a,i,e[6],76029189,23),i=l(i,s,r,a,e[9],3654602809,4),a=l(a,i,s,r,e[12],3873151461,11),r=l(r,a,i,s,e[15],530742520,16),i=u(i,s=l(s,r,a,i,e[2],3299628645,23),r,a,e[0],4096336452,6),a=u(a,i,s,r,e[7],1126891415,10),r=u(r,a,i,s,e[14],2878612391,15),s=u(s,r,a,i,e[5],4237533241,21),i=u(i,s,r,a,e[12],1700485571,6),a=u(a,i,s,r,e[3],2399980690,10),r=u(r,a,i,s,e[10],4293915773,15),s=u(s,r,a,i,e[1],2240044497,21),i=u(i,s,r,a,e[8],1873313359,6),a=u(a,i,s,r,e[15],4264355552,10),r=u(r,a,i,s,e[6],2734768916,15),s=u(s,r,a,i,e[13],1309151649,21),i=u(i,s,r,a,e[4],4149444226,6),a=u(a,i,s,r,e[11],3174756917,10),r=u(r,a,i,s,e[2],718787259,15),s=u(s,r,a,i,e[9],3951481745,21),this._a=this._a+i|0,this._b=this._b+s|0,this._c=this._c+r|0,this._d=this._d+a|0},o.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=a.allocUnsafe(16);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e},e.exports=o},63047:function(e,t,i){var s=i(96240),r=i(29931);function a(e){this.rand=e||new r.Rand}e.exports=a,a.create=function(e){return new a(e)},a.prototype._randbelow=function(e){var t=e.bitLength(),i=Math.ceil(t/8);do{var r=new s(this.rand.generate(i))}while(r.cmp(e)>=0);return r},a.prototype._randrange=function(e,t){var i=t.sub(e);return e.add(this._randbelow(i))},a.prototype.test=function(e,t,i){var r=e.bitLength(),a=s.mont(e),n=new s(1).toRed(a);t||(t=Math.max(1,r/48|0));for(var o=e.subn(1),h=0;!o.testn(h);h++);for(var d=e.shrn(h),c=o.toRed(a);t>0;t--){var l=this._randrange(new s(2),o);i&&i(l);var u=l.toRed(a).redPow(d);if(0!==u.cmp(n)&&0!==u.cmp(c)){for(var f=1;f<h;f++){if(0===(u=u.redSqr()).cmp(n))return!1;if(0===u.cmp(c))break}if(f===h)return!1}}return!0},a.prototype.getDivisor=function(e,t){var i=e.bitLength(),r=s.mont(e),a=new s(1).toRed(r);t||(t=Math.max(1,i/48|0));for(var n=e.subn(1),o=0;!n.testn(o);o++);for(var h=e.shrn(o),d=n.toRed(r);t>0;t--){var c=this._randrange(new s(2),n),l=e.gcd(c);if(0!==l.cmpn(1))return l;var u=c.toRed(r).redPow(h);if(0!==u.cmp(a)&&0!==u.cmp(d)){for(var f=1;f<o;f++){if(0===(u=u.redSqr()).cmp(a))return u.fromRed().subn(1).gcd(e);if(0===u.cmp(d))break}if(f===o)return(u=u.redSqr()).fromRed().subn(1).gcd(e)}}return!1}},96240:function(e,t,i){!function(e,t){"use strict";function s(e,t){if(!e)throw new Error(t||"Assertion failed")}function r(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function a(e,t,i){if(a.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(i=t,t=10),this._init(e||0,t||10,i||"be"))}var n;"object"==typeof e?e.exports=a:t.BN=a,a.BN=a,a.wordSize=26;try{n="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i(56619).Buffer}catch(e){}function o(e,t){var i=e.charCodeAt(t);return i>=65&&i<=70?i-55:i>=97&&i<=102?i-87:i-48&15}function h(e,t,i){var s=o(e,i);return i-1>=t&&(s|=o(e,i-1)<<4),s}function d(e,t,i,s){for(var r=0,a=Math.min(e.length,i),n=t;n<a;n++){var o=e.charCodeAt(n)-48;r*=s,r+=o>=49?o-49+10:o>=17?o-17+10:o}return r}a.isBN=function(e){return e instanceof a||null!==e&&"object"==typeof e&&e.constructor.wordSize===a.wordSize&&Array.isArray(e.words)},a.max=function(e,t){return e.cmp(t)>0?e:t},a.min=function(e,t){return e.cmp(t)<0?e:t},a.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),s(t===(0|t)&&t>=2&&t<=36);var r=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(r++,this.negative=1),r<e.length&&(16===t?this._parseHex(e,r,i):(this._parseBase(e,t,r),"le"===i&&this._initArray(this.toArray(),t,i)))},a.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(s(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},a.prototype._initArray=function(e,t,i){if(s("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var a,n,o=0;if("be"===i)for(r=e.length-1,a=0;r>=0;r-=3)n=e[r]|e[r-1]<<8|e[r-2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);else if("le"===i)for(r=0,a=0;r<e.length;r+=3)n=e[r]|e[r+1]<<8|e[r+2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);return this.strip()},a.prototype._parseHex=function(e,t,i){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var r,a=0,n=0;if("be"===i)for(s=e.length-1;s>=t;s-=2)r=h(e,t,s)<<a,this.words[n]|=67108863&r,a>=18?(a-=18,n+=1,this.words[n]|=r>>>26):a+=8;else for(s=(e.length-t)%2==0?t+1:t;s<e.length;s+=2)r=h(e,t,s)<<a,this.words[n]|=67108863&r,a>=18?(a-=18,n+=1,this.words[n]|=r>>>26):a+=8;this.strip()},a.prototype._parseBase=function(e,t,i){this.words=[0],this.length=1;for(var s=0,r=1;r<=67108863;r*=t)s++;s--,r=r/t|0;for(var a=e.length-i,n=a%s,o=Math.min(a,a-n)+i,h=0,c=i;c<o;c+=s)h=d(e,c,c+s,t),this.imuln(r),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==n){var l=1;for(h=d(e,c,e.length,t),c=0;c<n;c++)l*=t;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},a.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},a.prototype.clone=function(){var e=new a(null);return this.copy(e),e},a.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},a.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},a.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},a.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],u=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,i){i.negative=t.negative^e.negative;var s=e.length+t.length|0;i.length=s,s=s-1|0;var r=0|e.words[0],a=0|t.words[0],n=r*a,o=67108863&n,h=n/67108864|0;i.words[0]=o;for(var d=1;d<s;d++){for(var c=h>>>26,l=67108863&h,u=Math.min(d,t.length-1),f=Math.max(0,d-e.length+1);f<=u;f++){var p=d-f|0;c+=(n=(r=0|e.words[p])*(a=0|t.words[f])+l)/67108864|0,l=67108863&n}i.words[d]=0|l,h=0|c}return 0!==h?i.words[d]=0|h:i.length--,i.strip()}a.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var r=0,a=0,n=0;n<this.length;n++){var o=this.words[n],h=(16777215&(o<<r|a)).toString(16);i=0!==(a=o>>>24-r&16777215)||n!==this.length-1?c[6-h.length]+h+i:h+i,(r+=2)>=26&&(r-=26,n--)}for(0!==a&&(i=a.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var d=l[e],f=u[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:c[d-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}s(!1,"Base should be between 2 and 36")},a.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&s(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},a.prototype.toJSON=function(){return this.toString(16)},a.prototype.toBuffer=function(e,t){return s(void 0!==n),this.toArrayLike(n,e,t)},a.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},a.prototype.toArrayLike=function(e,t,i){var r=this.byteLength(),a=i||Math.max(1,r);s(r<=a,"byte array longer than desired length"),s(a>0,"Requested array length <= 0"),this.strip();var n,o,h="le"===t,d=new e(a),c=this.clone();if(h){for(o=0;!c.isZero();o++)n=c.andln(255),c.iushrn(8),d[o]=n;for(;o<a;o++)d[o]=0}else{for(o=0;o<a-r;o++)d[o]=0;for(o=0;!c.isZero();o++)n=c.andln(255),c.iushrn(8),d[a-o-1]=n}return d},Math.clz32?a.prototype._countBits=function(e){return 32-Math.clz32(e)}:a.prototype._countBits=function(e){var t=e,i=0;return t>=4096&&(i+=13,t>>>=13),t>=64&&(i+=7,t>>>=7),t>=8&&(i+=4,t>>>=4),t>=2&&(i+=2,t>>>=2),i+t},a.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,i=0;return 0==(8191&t)&&(i+=13,t>>>=13),0==(127&t)&&(i+=7,t>>>=7),0==(15&t)&&(i+=4,t>>>=4),0==(3&t)&&(i+=2,t>>>=2),0==(1&t)&&i++,i},a.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},a.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var i=this._zeroBits(this.words[t]);if(e+=i,26!==i)break}return e},a.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},a.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},a.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},a.prototype.isNeg=function(){return 0!==this.negative},a.prototype.neg=function(){return this.clone().ineg()},a.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},a.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},a.prototype.ior=function(e){return s(0==(this.negative|e.negative)),this.iuor(e)},a.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},a.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},a.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var i=0;i<t.length;i++)this.words[i]=this.words[i]&e.words[i];return this.length=t.length,this.strip()},a.prototype.iand=function(e){return s(0==(this.negative|e.negative)),this.iuand(e)},a.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},a.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},a.prototype.iuxor=function(e){var t,i;this.length>e.length?(t=this,i=e):(t=e,i=this);for(var s=0;s<i.length;s++)this.words[s]=t.words[s]^i.words[s];if(this!==t)for(;s<t.length;s++)this.words[s]=t.words[s];return this.length=t.length,this.strip()},a.prototype.ixor=function(e){return s(0==(this.negative|e.negative)),this.iuxor(e)},a.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},a.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},a.prototype.inotn=function(e){s("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var r=0;r<t;r++)this.words[r]=67108863&~this.words[r];return i>0&&(this.words[r]=~this.words[r]&67108863>>26-i),this.strip()},a.prototype.notn=function(e){return this.clone().inotn(e)},a.prototype.setn=function(e,t){s("number"==typeof e&&e>=0);var i=e/26|0,r=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<r:this.words[i]&~(1<<r),this.strip()},a.prototype.iadd=function(e){var t,i,s;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(i=this,s=e):(i=e,s=this);for(var r=0,a=0;a<s.length;a++)t=(0|i.words[a])+(0|s.words[a])+r,this.words[a]=67108863&t,r=t>>>26;for(;0!==r&&a<i.length;a++)t=(0|i.words[a])+r,this.words[a]=67108863&t,r=t>>>26;if(this.length=i.length,0!==r)this.words[this.length]=r,this.length++;else if(i!==this)for(;a<i.length;a++)this.words[a]=i.words[a];return this},a.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},a.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var i,s,r=this.cmp(e);if(0===r)return this.negative=0,this.length=1,this.words[0]=0,this;r>0?(i=this,s=e):(i=e,s=this);for(var a=0,n=0;n<s.length;n++)a=(t=(0|i.words[n])-(0|s.words[n])+a)>>26,this.words[n]=67108863&t;for(;0!==a&&n<i.length;n++)a=(t=(0|i.words[n])+a)>>26,this.words[n]=67108863&t;if(0===a&&n<i.length&&i!==this)for(;n<i.length;n++)this.words[n]=i.words[n];return this.length=Math.max(this.length,n),i!==this&&(this.negative=1),this.strip()},a.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,i){var s,r,a,n=e.words,o=t.words,h=i.words,d=0,c=0|n[0],l=8191&c,u=c>>>13,f=0|n[1],p=8191&f,m=f>>>13,g=0|n[2],y=8191&g,b=g>>>13,v=0|n[3],w=8191&v,S=v>>>13,k=0|n[4],T=8191&k,_=k>>>13,O=0|n[5],M=8191&O,I=O>>>13,x=0|n[6],C=8191&x,P=x>>>13,A=0|n[7],N=8191&A,B=A>>>13,E=0|n[8],V=8191&E,L=E>>>13,R=0|n[9],D=8191&R,F=R>>>13,q=0|o[0],G=8191&q,H=q>>>13,U=0|o[1],j=8191&U,W=U>>>13,z=0|o[2],K=8191&z,X=z>>>13,Z=0|o[3],Y=8191&Z,Q=Z>>>13,J=0|o[4],$=8191&J,ee=J>>>13,te=0|o[5],ie=8191&te,se=te>>>13,re=0|o[6],ae=8191&re,ne=re>>>13,oe=0|o[7],he=8191&oe,de=oe>>>13,ce=0|o[8],le=8191&ce,ue=ce>>>13,fe=0|o[9],pe=8191&fe,me=fe>>>13;i.negative=e.negative^t.negative,i.length=19;var ge=(d+(s=Math.imul(l,G))|0)+((8191&(r=(r=Math.imul(l,H))+Math.imul(u,G)|0))<<13)|0;d=((a=Math.imul(u,H))+(r>>>13)|0)+(ge>>>26)|0,ge&=67108863,s=Math.imul(p,G),r=(r=Math.imul(p,H))+Math.imul(m,G)|0,a=Math.imul(m,H);var ye=(d+(s=s+Math.imul(l,j)|0)|0)+((8191&(r=(r=r+Math.imul(l,W)|0)+Math.imul(u,j)|0))<<13)|0;d=((a=a+Math.imul(u,W)|0)+(r>>>13)|0)+(ye>>>26)|0,ye&=67108863,s=Math.imul(y,G),r=(r=Math.imul(y,H))+Math.imul(b,G)|0,a=Math.imul(b,H),s=s+Math.imul(p,j)|0,r=(r=r+Math.imul(p,W)|0)+Math.imul(m,j)|0,a=a+Math.imul(m,W)|0;var be=(d+(s=s+Math.imul(l,K)|0)|0)+((8191&(r=(r=r+Math.imul(l,X)|0)+Math.imul(u,K)|0))<<13)|0;d=((a=a+Math.imul(u,X)|0)+(r>>>13)|0)+(be>>>26)|0,be&=67108863,s=Math.imul(w,G),r=(r=Math.imul(w,H))+Math.imul(S,G)|0,a=Math.imul(S,H),s=s+Math.imul(y,j)|0,r=(r=r+Math.imul(y,W)|0)+Math.imul(b,j)|0,a=a+Math.imul(b,W)|0,s=s+Math.imul(p,K)|0,r=(r=r+Math.imul(p,X)|0)+Math.imul(m,K)|0,a=a+Math.imul(m,X)|0;var ve=(d+(s=s+Math.imul(l,Y)|0)|0)+((8191&(r=(r=r+Math.imul(l,Q)|0)+Math.imul(u,Y)|0))<<13)|0;d=((a=a+Math.imul(u,Q)|0)+(r>>>13)|0)+(ve>>>26)|0,ve&=67108863,s=Math.imul(T,G),r=(r=Math.imul(T,H))+Math.imul(_,G)|0,a=Math.imul(_,H),s=s+Math.imul(w,j)|0,r=(r=r+Math.imul(w,W)|0)+Math.imul(S,j)|0,a=a+Math.imul(S,W)|0,s=s+Math.imul(y,K)|0,r=(r=r+Math.imul(y,X)|0)+Math.imul(b,K)|0,a=a+Math.imul(b,X)|0,s=s+Math.imul(p,Y)|0,r=(r=r+Math.imul(p,Q)|0)+Math.imul(m,Y)|0,a=a+Math.imul(m,Q)|0;var we=(d+(s=s+Math.imul(l,$)|0)|0)+((8191&(r=(r=r+Math.imul(l,ee)|0)+Math.imul(u,$)|0))<<13)|0;d=((a=a+Math.imul(u,ee)|0)+(r>>>13)|0)+(we>>>26)|0,we&=67108863,s=Math.imul(M,G),r=(r=Math.imul(M,H))+Math.imul(I,G)|0,a=Math.imul(I,H),s=s+Math.imul(T,j)|0,r=(r=r+Math.imul(T,W)|0)+Math.imul(_,j)|0,a=a+Math.imul(_,W)|0,s=s+Math.imul(w,K)|0,r=(r=r+Math.imul(w,X)|0)+Math.imul(S,K)|0,a=a+Math.imul(S,X)|0,s=s+Math.imul(y,Y)|0,r=(r=r+Math.imul(y,Q)|0)+Math.imul(b,Y)|0,a=a+Math.imul(b,Q)|0,s=s+Math.imul(p,$)|0,r=(r=r+Math.imul(p,ee)|0)+Math.imul(m,$)|0,a=a+Math.imul(m,ee)|0;var Se=(d+(s=s+Math.imul(l,ie)|0)|0)+((8191&(r=(r=r+Math.imul(l,se)|0)+Math.imul(u,ie)|0))<<13)|0;d=((a=a+Math.imul(u,se)|0)+(r>>>13)|0)+(Se>>>26)|0,Se&=67108863,s=Math.imul(C,G),r=(r=Math.imul(C,H))+Math.imul(P,G)|0,a=Math.imul(P,H),s=s+Math.imul(M,j)|0,r=(r=r+Math.imul(M,W)|0)+Math.imul(I,j)|0,a=a+Math.imul(I,W)|0,s=s+Math.imul(T,K)|0,r=(r=r+Math.imul(T,X)|0)+Math.imul(_,K)|0,a=a+Math.imul(_,X)|0,s=s+Math.imul(w,Y)|0,r=(r=r+Math.imul(w,Q)|0)+Math.imul(S,Y)|0,a=a+Math.imul(S,Q)|0,s=s+Math.imul(y,$)|0,r=(r=r+Math.imul(y,ee)|0)+Math.imul(b,$)|0,a=a+Math.imul(b,ee)|0,s=s+Math.imul(p,ie)|0,r=(r=r+Math.imul(p,se)|0)+Math.imul(m,ie)|0,a=a+Math.imul(m,se)|0;var ke=(d+(s=s+Math.imul(l,ae)|0)|0)+((8191&(r=(r=r+Math.imul(l,ne)|0)+Math.imul(u,ae)|0))<<13)|0;d=((a=a+Math.imul(u,ne)|0)+(r>>>13)|0)+(ke>>>26)|0,ke&=67108863,s=Math.imul(N,G),r=(r=Math.imul(N,H))+Math.imul(B,G)|0,a=Math.imul(B,H),s=s+Math.imul(C,j)|0,r=(r=r+Math.imul(C,W)|0)+Math.imul(P,j)|0,a=a+Math.imul(P,W)|0,s=s+Math.imul(M,K)|0,r=(r=r+Math.imul(M,X)|0)+Math.imul(I,K)|0,a=a+Math.imul(I,X)|0,s=s+Math.imul(T,Y)|0,r=(r=r+Math.imul(T,Q)|0)+Math.imul(_,Y)|0,a=a+Math.imul(_,Q)|0,s=s+Math.imul(w,$)|0,r=(r=r+Math.imul(w,ee)|0)+Math.imul(S,$)|0,a=a+Math.imul(S,ee)|0,s=s+Math.imul(y,ie)|0,r=(r=r+Math.imul(y,se)|0)+Math.imul(b,ie)|0,a=a+Math.imul(b,se)|0,s=s+Math.imul(p,ae)|0,r=(r=r+Math.imul(p,ne)|0)+Math.imul(m,ae)|0,a=a+Math.imul(m,ne)|0;var Te=(d+(s=s+Math.imul(l,he)|0)|0)+((8191&(r=(r=r+Math.imul(l,de)|0)+Math.imul(u,he)|0))<<13)|0;d=((a=a+Math.imul(u,de)|0)+(r>>>13)|0)+(Te>>>26)|0,Te&=67108863,s=Math.imul(V,G),r=(r=Math.imul(V,H))+Math.imul(L,G)|0,a=Math.imul(L,H),s=s+Math.imul(N,j)|0,r=(r=r+Math.imul(N,W)|0)+Math.imul(B,j)|0,a=a+Math.imul(B,W)|0,s=s+Math.imul(C,K)|0,r=(r=r+Math.imul(C,X)|0)+Math.imul(P,K)|0,a=a+Math.imul(P,X)|0,s=s+Math.imul(M,Y)|0,r=(r=r+Math.imul(M,Q)|0)+Math.imul(I,Y)|0,a=a+Math.imul(I,Q)|0,s=s+Math.imul(T,$)|0,r=(r=r+Math.imul(T,ee)|0)+Math.imul(_,$)|0,a=a+Math.imul(_,ee)|0,s=s+Math.imul(w,ie)|0,r=(r=r+Math.imul(w,se)|0)+Math.imul(S,ie)|0,a=a+Math.imul(S,se)|0,s=s+Math.imul(y,ae)|0,r=(r=r+Math.imul(y,ne)|0)+Math.imul(b,ae)|0,a=a+Math.imul(b,ne)|0,s=s+Math.imul(p,he)|0,r=(r=r+Math.imul(p,de)|0)+Math.imul(m,he)|0,a=a+Math.imul(m,de)|0;var _e=(d+(s=s+Math.imul(l,le)|0)|0)+((8191&(r=(r=r+Math.imul(l,ue)|0)+Math.imul(u,le)|0))<<13)|0;d=((a=a+Math.imul(u,ue)|0)+(r>>>13)|0)+(_e>>>26)|0,_e&=67108863,s=Math.imul(D,G),r=(r=Math.imul(D,H))+Math.imul(F,G)|0,a=Math.imul(F,H),s=s+Math.imul(V,j)|0,r=(r=r+Math.imul(V,W)|0)+Math.imul(L,j)|0,a=a+Math.imul(L,W)|0,s=s+Math.imul(N,K)|0,r=(r=r+Math.imul(N,X)|0)+Math.imul(B,K)|0,a=a+Math.imul(B,X)|0,s=s+Math.imul(C,Y)|0,r=(r=r+Math.imul(C,Q)|0)+Math.imul(P,Y)|0,a=a+Math.imul(P,Q)|0,s=s+Math.imul(M,$)|0,r=(r=r+Math.imul(M,ee)|0)+Math.imul(I,$)|0,a=a+Math.imul(I,ee)|0,s=s+Math.imul(T,ie)|0,r=(r=r+Math.imul(T,se)|0)+Math.imul(_,ie)|0,a=a+Math.imul(_,se)|0,s=s+Math.imul(w,ae)|0,r=(r=r+Math.imul(w,ne)|0)+Math.imul(S,ae)|0,a=a+Math.imul(S,ne)|0,s=s+Math.imul(y,he)|0,r=(r=r+Math.imul(y,de)|0)+Math.imul(b,he)|0,a=a+Math.imul(b,de)|0,s=s+Math.imul(p,le)|0,r=(r=r+Math.imul(p,ue)|0)+Math.imul(m,le)|0,a=a+Math.imul(m,ue)|0;var Oe=(d+(s=s+Math.imul(l,pe)|0)|0)+((8191&(r=(r=r+Math.imul(l,me)|0)+Math.imul(u,pe)|0))<<13)|0;d=((a=a+Math.imul(u,me)|0)+(r>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,s=Math.imul(D,j),r=(r=Math.imul(D,W))+Math.imul(F,j)|0,a=Math.imul(F,W),s=s+Math.imul(V,K)|0,r=(r=r+Math.imul(V,X)|0)+Math.imul(L,K)|0,a=a+Math.imul(L,X)|0,s=s+Math.imul(N,Y)|0,r=(r=r+Math.imul(N,Q)|0)+Math.imul(B,Y)|0,a=a+Math.imul(B,Q)|0,s=s+Math.imul(C,$)|0,r=(r=r+Math.imul(C,ee)|0)+Math.imul(P,$)|0,a=a+Math.imul(P,ee)|0,s=s+Math.imul(M,ie)|0,r=(r=r+Math.imul(M,se)|0)+Math.imul(I,ie)|0,a=a+Math.imul(I,se)|0,s=s+Math.imul(T,ae)|0,r=(r=r+Math.imul(T,ne)|0)+Math.imul(_,ae)|0,a=a+Math.imul(_,ne)|0,s=s+Math.imul(w,he)|0,r=(r=r+Math.imul(w,de)|0)+Math.imul(S,he)|0,a=a+Math.imul(S,de)|0,s=s+Math.imul(y,le)|0,r=(r=r+Math.imul(y,ue)|0)+Math.imul(b,le)|0,a=a+Math.imul(b,ue)|0;var Me=(d+(s=s+Math.imul(p,pe)|0)|0)+((8191&(r=(r=r+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;d=((a=a+Math.imul(m,me)|0)+(r>>>13)|0)+(Me>>>26)|0,Me&=67108863,s=Math.imul(D,K),r=(r=Math.imul(D,X))+Math.imul(F,K)|0,a=Math.imul(F,X),s=s+Math.imul(V,Y)|0,r=(r=r+Math.imul(V,Q)|0)+Math.imul(L,Y)|0,a=a+Math.imul(L,Q)|0,s=s+Math.imul(N,$)|0,r=(r=r+Math.imul(N,ee)|0)+Math.imul(B,$)|0,a=a+Math.imul(B,ee)|0,s=s+Math.imul(C,ie)|0,r=(r=r+Math.imul(C,se)|0)+Math.imul(P,ie)|0,a=a+Math.imul(P,se)|0,s=s+Math.imul(M,ae)|0,r=(r=r+Math.imul(M,ne)|0)+Math.imul(I,ae)|0,a=a+Math.imul(I,ne)|0,s=s+Math.imul(T,he)|0,r=(r=r+Math.imul(T,de)|0)+Math.imul(_,he)|0,a=a+Math.imul(_,de)|0,s=s+Math.imul(w,le)|0,r=(r=r+Math.imul(w,ue)|0)+Math.imul(S,le)|0,a=a+Math.imul(S,ue)|0;var Ie=(d+(s=s+Math.imul(y,pe)|0)|0)+((8191&(r=(r=r+Math.imul(y,me)|0)+Math.imul(b,pe)|0))<<13)|0;d=((a=a+Math.imul(b,me)|0)+(r>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,s=Math.imul(D,Y),r=(r=Math.imul(D,Q))+Math.imul(F,Y)|0,a=Math.imul(F,Q),s=s+Math.imul(V,$)|0,r=(r=r+Math.imul(V,ee)|0)+Math.imul(L,$)|0,a=a+Math.imul(L,ee)|0,s=s+Math.imul(N,ie)|0,r=(r=r+Math.imul(N,se)|0)+Math.imul(B,ie)|0,a=a+Math.imul(B,se)|0,s=s+Math.imul(C,ae)|0,r=(r=r+Math.imul(C,ne)|0)+Math.imul(P,ae)|0,a=a+Math.imul(P,ne)|0,s=s+Math.imul(M,he)|0,r=(r=r+Math.imul(M,de)|0)+Math.imul(I,he)|0,a=a+Math.imul(I,de)|0,s=s+Math.imul(T,le)|0,r=(r=r+Math.imul(T,ue)|0)+Math.imul(_,le)|0,a=a+Math.imul(_,ue)|0;var xe=(d+(s=s+Math.imul(w,pe)|0)|0)+((8191&(r=(r=r+Math.imul(w,me)|0)+Math.imul(S,pe)|0))<<13)|0;d=((a=a+Math.imul(S,me)|0)+(r>>>13)|0)+(xe>>>26)|0,xe&=67108863,s=Math.imul(D,$),r=(r=Math.imul(D,ee))+Math.imul(F,$)|0,a=Math.imul(F,ee),s=s+Math.imul(V,ie)|0,r=(r=r+Math.imul(V,se)|0)+Math.imul(L,ie)|0,a=a+Math.imul(L,se)|0,s=s+Math.imul(N,ae)|0,r=(r=r+Math.imul(N,ne)|0)+Math.imul(B,ae)|0,a=a+Math.imul(B,ne)|0,s=s+Math.imul(C,he)|0,r=(r=r+Math.imul(C,de)|0)+Math.imul(P,he)|0,a=a+Math.imul(P,de)|0,s=s+Math.imul(M,le)|0,r=(r=r+Math.imul(M,ue)|0)+Math.imul(I,le)|0,a=a+Math.imul(I,ue)|0;var Ce=(d+(s=s+Math.imul(T,pe)|0)|0)+((8191&(r=(r=r+Math.imul(T,me)|0)+Math.imul(_,pe)|0))<<13)|0;d=((a=a+Math.imul(_,me)|0)+(r>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,s=Math.imul(D,ie),r=(r=Math.imul(D,se))+Math.imul(F,ie)|0,a=Math.imul(F,se),s=s+Math.imul(V,ae)|0,r=(r=r+Math.imul(V,ne)|0)+Math.imul(L,ae)|0,a=a+Math.imul(L,ne)|0,s=s+Math.imul(N,he)|0,r=(r=r+Math.imul(N,de)|0)+Math.imul(B,he)|0,a=a+Math.imul(B,de)|0,s=s+Math.imul(C,le)|0,r=(r=r+Math.imul(C,ue)|0)+Math.imul(P,le)|0,a=a+Math.imul(P,ue)|0;var Pe=(d+(s=s+Math.imul(M,pe)|0)|0)+((8191&(r=(r=r+Math.imul(M,me)|0)+Math.imul(I,pe)|0))<<13)|0;d=((a=a+Math.imul(I,me)|0)+(r>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,s=Math.imul(D,ae),r=(r=Math.imul(D,ne))+Math.imul(F,ae)|0,a=Math.imul(F,ne),s=s+Math.imul(V,he)|0,r=(r=r+Math.imul(V,de)|0)+Math.imul(L,he)|0,a=a+Math.imul(L,de)|0,s=s+Math.imul(N,le)|0,r=(r=r+Math.imul(N,ue)|0)+Math.imul(B,le)|0,a=a+Math.imul(B,ue)|0;var Ae=(d+(s=s+Math.imul(C,pe)|0)|0)+((8191&(r=(r=r+Math.imul(C,me)|0)+Math.imul(P,pe)|0))<<13)|0;d=((a=a+Math.imul(P,me)|0)+(r>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,s=Math.imul(D,he),r=(r=Math.imul(D,de))+Math.imul(F,he)|0,a=Math.imul(F,de),s=s+Math.imul(V,le)|0,r=(r=r+Math.imul(V,ue)|0)+Math.imul(L,le)|0,a=a+Math.imul(L,ue)|0;var Ne=(d+(s=s+Math.imul(N,pe)|0)|0)+((8191&(r=(r=r+Math.imul(N,me)|0)+Math.imul(B,pe)|0))<<13)|0;d=((a=a+Math.imul(B,me)|0)+(r>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,s=Math.imul(D,le),r=(r=Math.imul(D,ue))+Math.imul(F,le)|0,a=Math.imul(F,ue);var Be=(d+(s=s+Math.imul(V,pe)|0)|0)+((8191&(r=(r=r+Math.imul(V,me)|0)+Math.imul(L,pe)|0))<<13)|0;d=((a=a+Math.imul(L,me)|0)+(r>>>13)|0)+(Be>>>26)|0,Be&=67108863;var Ee=(d+(s=Math.imul(D,pe))|0)+((8191&(r=(r=Math.imul(D,me))+Math.imul(F,pe)|0))<<13)|0;return d=((a=Math.imul(F,me))+(r>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,h[0]=ge,h[1]=ye,h[2]=be,h[3]=ve,h[4]=we,h[5]=Se,h[6]=ke,h[7]=Te,h[8]=_e,h[9]=Oe,h[10]=Me,h[11]=Ie,h[12]=xe,h[13]=Ce,h[14]=Pe,h[15]=Ae,h[16]=Ne,h[17]=Be,h[18]=Ee,0!==d&&(h[19]=d,i.length++),i};function m(e,t,i){return(new g).mulp(e,t,i)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=f),a.prototype.mulTo=function(e,t){var i,s=this.length+e.length;return i=10===this.length&&10===e.length?p(this,e,t):s<63?f(this,e,t):s<1024?function(e,t,i){i.negative=t.negative^e.negative,i.length=e.length+t.length;for(var s=0,r=0,a=0;a<i.length-1;a++){var n=r;r=0;for(var o=67108863&s,h=Math.min(a,t.length-1),d=Math.max(0,a-e.length+1);d<=h;d++){var c=a-d,l=(0|e.words[c])*(0|t.words[d]),u=67108863&l;o=67108863&(u=u+o|0),r+=(n=(n=n+(l/67108864|0)|0)+(u>>>26)|0)>>>26,n&=67108863}i.words[a]=o,s=n,n=r}return 0!==s?i.words[a]=s:i.length--,i.strip()}(this,e,t):m(this,e,t),i},g.prototype.makeRBT=function(e){for(var t=new Array(e),i=a.prototype._countBits(e)-1,s=0;s<e;s++)t[s]=this.revBin(s,i,e);return t},g.prototype.revBin=function(e,t,i){if(0===e||e===i-1)return e;for(var s=0,r=0;r<t;r++)s|=(1&e)<<t-r-1,e>>=1;return s},g.prototype.permute=function(e,t,i,s,r,a){for(var n=0;n<a;n++)s[n]=t[e[n]],r[n]=i[e[n]]},g.prototype.transform=function(e,t,i,s,r,a){this.permute(a,e,t,i,s,r);for(var n=1;n<r;n<<=1)for(var o=n<<1,h=Math.cos(2*Math.PI/o),d=Math.sin(2*Math.PI/o),c=0;c<r;c+=o)for(var l=h,u=d,f=0;f<n;f++){var p=i[c+f],m=s[c+f],g=i[c+f+n],y=s[c+f+n],b=l*g-u*y;y=l*y+u*g,g=b,i[c+f]=p+g,s[c+f]=m+y,i[c+f+n]=p-g,s[c+f+n]=m-y,f!==o&&(b=h*l-d*u,u=h*u+d*l,l=b)}},g.prototype.guessLen13b=function(e,t){var i=1|Math.max(t,e),s=1&i,r=0;for(i=i/2|0;i;i>>>=1)r++;return 1<<r+1+s},g.prototype.conjugate=function(e,t,i){if(!(i<=1))for(var s=0;s<i/2;s++){var r=e[s];e[s]=e[i-s-1],e[i-s-1]=r,r=t[s],t[s]=-t[i-s-1],t[i-s-1]=-r}},g.prototype.normalize13b=function(e,t){for(var i=0,s=0;s<t/2;s++){var r=8192*Math.round(e[2*s+1]/t)+Math.round(e[2*s]/t)+i;e[s]=67108863&r,i=r<67108864?0:r/67108864|0}return e},g.prototype.convert13b=function(e,t,i,r){for(var a=0,n=0;n<t;n++)a+=0|e[n],i[2*n]=8191&a,a>>>=13,i[2*n+1]=8191&a,a>>>=13;for(n=2*t;n<r;++n)i[n]=0;s(0===a),s(0==(-8192&a))},g.prototype.stub=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=0;return t},g.prototype.mulp=function(e,t,i){var s=2*this.guessLen13b(e.length,t.length),r=this.makeRBT(s),a=this.stub(s),n=new Array(s),o=new Array(s),h=new Array(s),d=new Array(s),c=new Array(s),l=new Array(s),u=i.words;u.length=s,this.convert13b(e.words,e.length,n,s),this.convert13b(t.words,t.length,d,s),this.transform(n,a,o,h,s,r),this.transform(d,a,c,l,s,r);for(var f=0;f<s;f++){var p=o[f]*c[f]-h[f]*l[f];h[f]=o[f]*l[f]+h[f]*c[f],o[f]=p}return this.conjugate(o,h,s),this.transform(o,h,u,a,s,r),this.conjugate(u,a,s),this.normalize13b(u,s),i.negative=e.negative^t.negative,i.length=e.length+t.length,i.strip()},a.prototype.mul=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},a.prototype.mulf=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),m(this,e,t)},a.prototype.imul=function(e){return this.clone().mulTo(e,this)},a.prototype.imuln=function(e){s("number"==typeof e),s(e<67108864);for(var t=0,i=0;i<this.length;i++){var r=(0|this.words[i])*e,a=(67108863&r)+(67108863&t);t>>=26,t+=r/67108864|0,t+=a>>>26,this.words[i]=67108863&a}return 0!==t&&(this.words[i]=t,this.length++),this},a.prototype.muln=function(e){return this.clone().imuln(e)},a.prototype.sqr=function(){return this.mul(this)},a.prototype.isqr=function(){return this.imul(this.clone())},a.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),i=0;i<t.length;i++){var s=i/26|0,r=i%26;t[i]=(e.words[s]&1<<r)>>>r}return t}(e);if(0===t.length)return new a(1);for(var i=this,s=0;s<t.length&&0===t[s];s++,i=i.sqr());if(++s<t.length)for(var r=i.sqr();s<t.length;s++,r=r.sqr())0!==t[s]&&(i=i.mul(r));return i},a.prototype.iushln=function(e){s("number"==typeof e&&e>=0);var t,i=e%26,r=(e-i)/26,a=67108863>>>26-i<<26-i;if(0!==i){var n=0;for(t=0;t<this.length;t++){var o=this.words[t]&a,h=(0|this.words[t])-o<<i;this.words[t]=h|n,n=o>>>26-i}n&&(this.words[t]=n,this.length++)}if(0!==r){for(t=this.length-1;t>=0;t--)this.words[t+r]=this.words[t];for(t=0;t<r;t++)this.words[t]=0;this.length+=r}return this.strip()},a.prototype.ishln=function(e){return s(0===this.negative),this.iushln(e)},a.prototype.iushrn=function(e,t,i){var r;s("number"==typeof e&&e>=0),r=t?(t-t%26)/26:0;var a=e%26,n=Math.min((e-a)/26,this.length),o=67108863^67108863>>>a<<a,h=i;if(r-=n,r=Math.max(0,r),h){for(var d=0;d<n;d++)h.words[d]=this.words[d];h.length=n}if(0===n);else if(this.length>n)for(this.length-=n,d=0;d<this.length;d++)this.words[d]=this.words[d+n];else this.words[0]=0,this.length=1;var c=0;for(d=this.length-1;d>=0&&(0!==c||d>=r);d--){var l=0|this.words[d];this.words[d]=c<<26-a|l>>>a,c=l&o}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},a.prototype.ishrn=function(e,t,i){return s(0===this.negative),this.iushrn(e,t,i)},a.prototype.shln=function(e){return this.clone().ishln(e)},a.prototype.ushln=function(e){return this.clone().iushln(e)},a.prototype.shrn=function(e){return this.clone().ishrn(e)},a.prototype.ushrn=function(e){return this.clone().iushrn(e)},a.prototype.testn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,r=1<<t;return!(this.length<=i)&&!!(this.words[i]&r)},a.prototype.imaskn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(s(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var r=67108863^67108863>>>t<<t;this.words[this.length-1]&=r}return this.strip()},a.prototype.maskn=function(e){return this.clone().imaskn(e)},a.prototype.iaddn=function(e){return s("number"==typeof e),s(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},a.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},a.prototype.isubn=function(e){if(s("number"==typeof e),s(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},a.prototype.addn=function(e){return this.clone().iaddn(e)},a.prototype.subn=function(e){return this.clone().isubn(e)},a.prototype.iabs=function(){return this.negative=0,this},a.prototype.abs=function(){return this.clone().iabs()},a.prototype._ishlnsubmul=function(e,t,i){var r,a,n=e.length+i;this._expand(n);var o=0;for(r=0;r<e.length;r++){a=(0|this.words[r+i])+o;var h=(0|e.words[r])*t;o=((a-=67108863&h)>>26)-(h/67108864|0),this.words[r+i]=67108863&a}for(;r<this.length-i;r++)o=(a=(0|this.words[r+i])+o)>>26,this.words[r+i]=67108863&a;if(0===o)return this.strip();for(s(-1===o),o=0,r=0;r<this.length;r++)o=(a=-(0|this.words[r])+o)>>26,this.words[r]=67108863&a;return this.negative=1,this.strip()},a.prototype._wordDiv=function(e,t){var i=(this.length,e.length),s=this.clone(),r=e,n=0|r.words[r.length-1];0!==(i=26-this._countBits(n))&&(r=r.ushln(i),s.iushln(i),n=0|r.words[r.length-1]);var o,h=s.length-r.length;if("mod"!==t){(o=new a(null)).length=h+1,o.words=new Array(o.length);for(var d=0;d<o.length;d++)o.words[d]=0}var c=s.clone()._ishlnsubmul(r,1,h);0===c.negative&&(s=c,o&&(o.words[h]=1));for(var l=h-1;l>=0;l--){var u=67108864*(0|s.words[r.length+l])+(0|s.words[r.length+l-1]);for(u=Math.min(u/n|0,67108863),s._ishlnsubmul(r,u,l);0!==s.negative;)u--,s.negative=0,s._ishlnsubmul(r,1,l),s.isZero()||(s.negative^=1);o&&(o.words[l]=u)}return o&&o.strip(),s.strip(),"div"!==t&&0!==i&&s.iushrn(i),{div:o||null,mod:s}},a.prototype.divmod=function(e,t,i){return s(!e.isZero()),this.isZero()?{div:new a(0),mod:new a(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(r=o.div.neg()),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.iadd(e)),{div:r,mod:n}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(r=o.div.neg()),{div:r,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.isub(e)),{div:o.div,mod:n}):e.length>this.length||this.cmp(e)<0?{div:new a(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new a(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new a(this.modn(e.words[0]))}:this._wordDiv(e,t);var r,n,o},a.prototype.div=function(e){return this.divmod(e,"div",!1).div},a.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},a.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},a.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var i=0!==t.div.negative?t.mod.isub(e):t.mod,s=e.ushrn(1),r=e.andln(1),a=i.cmp(s);return a<0||1===r&&0===a?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},a.prototype.modn=function(e){s(e<=67108863);for(var t=(1<<26)%e,i=0,r=this.length-1;r>=0;r--)i=(t*i+(0|this.words[r]))%e;return i},a.prototype.idivn=function(e){s(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var r=(0|this.words[i])+67108864*t;this.words[i]=r/e|0,t=r%e}return this.strip()},a.prototype.divn=function(e){return this.clone().idivn(e)},a.prototype.egcd=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r=new a(1),n=new a(0),o=new a(0),h=new a(1),d=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++d;for(var c=i.clone(),l=t.clone();!t.isZero();){for(var u=0,f=1;0==(t.words[0]&f)&&u<26;++u,f<<=1);if(u>0)for(t.iushrn(u);u-- >0;)(r.isOdd()||n.isOdd())&&(r.iadd(c),n.isub(l)),r.iushrn(1),n.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(o.isOdd()||h.isOdd())&&(o.iadd(c),h.isub(l)),o.iushrn(1),h.iushrn(1);t.cmp(i)>=0?(t.isub(i),r.isub(o),n.isub(h)):(i.isub(t),o.isub(r),h.isub(n))}return{a:o,b:h,gcd:i.iushln(d)}},a.prototype._invmp=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r,n=new a(1),o=new a(0),h=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var d=0,c=1;0==(t.words[0]&c)&&d<26;++d,c<<=1);if(d>0)for(t.iushrn(d);d-- >0;)n.isOdd()&&n.iadd(h),n.iushrn(1);for(var l=0,u=1;0==(i.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(i.iushrn(l);l-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(o)):(i.isub(t),o.isub(n))}return(r=0===t.cmpn(1)?n:o).cmpn(0)<0&&r.iadd(e),r},a.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),i=e.clone();t.negative=0,i.negative=0;for(var s=0;t.isEven()&&i.isEven();s++)t.iushrn(1),i.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;i.isEven();)i.iushrn(1);var r=t.cmp(i);if(r<0){var a=t;t=i,i=a}else if(0===r||0===i.cmpn(1))break;t.isub(i)}return i.iushln(s)},a.prototype.invm=function(e){return this.egcd(e).a.umod(e)},a.prototype.isEven=function(){return 0==(1&this.words[0])},a.prototype.isOdd=function(){return 1==(1&this.words[0])},a.prototype.andln=function(e){return this.words[0]&e},a.prototype.bincn=function(e){s("number"==typeof e);var t=e%26,i=(e-t)/26,r=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=r,this;for(var a=r,n=i;0!==a&&n<this.length;n++){var o=0|this.words[n];a=(o+=a)>>>26,o&=67108863,this.words[n]=o}return 0!==a&&(this.words[n]=a,this.length++),this},a.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},a.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)t=1;else{i&&(e=-e),s(e<=67108863,"Number is too big");var r=0|this.words[0];t=r===e?0:r<e?-1:1}return 0!==this.negative?0|-t:t},a.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},a.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,i=this.length-1;i>=0;i--){var s=0|this.words[i],r=0|e.words[i];if(s!==r){s<r?t=-1:s>r&&(t=1);break}}return t},a.prototype.gtn=function(e){return 1===this.cmpn(e)},a.prototype.gt=function(e){return 1===this.cmp(e)},a.prototype.gten=function(e){return this.cmpn(e)>=0},a.prototype.gte=function(e){return this.cmp(e)>=0},a.prototype.ltn=function(e){return-1===this.cmpn(e)},a.prototype.lt=function(e){return-1===this.cmp(e)},a.prototype.lten=function(e){return this.cmpn(e)<=0},a.prototype.lte=function(e){return this.cmp(e)<=0},a.prototype.eqn=function(e){return 0===this.cmpn(e)},a.prototype.eq=function(e){return 0===this.cmp(e)},a.red=function(e){return new T(e)},a.prototype.toRed=function(e){return s(!this.red,"Already a number in reduction context"),s(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},a.prototype.fromRed=function(){return s(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},a.prototype._forceRed=function(e){return this.red=e,this},a.prototype.forceRed=function(e){return s(!this.red,"Already a number in reduction context"),this._forceRed(e)},a.prototype.redAdd=function(e){return s(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},a.prototype.redIAdd=function(e){return s(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},a.prototype.redSub=function(e){return s(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},a.prototype.redISub=function(e){return s(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},a.prototype.redShl=function(e){return s(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},a.prototype.redMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},a.prototype.redIMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},a.prototype.redSqr=function(){return s(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},a.prototype.redISqr=function(){return s(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},a.prototype.redSqrt=function(){return s(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},a.prototype.redInvm=function(){return s(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},a.prototype.redNeg=function(){return s(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},a.prototype.redPow=function(e){return s(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var y={k256:null,p224:null,p192:null,p25519:null};function b(e,t){this.name=e,this.p=new a(t,16),this.n=this.p.bitLength(),this.k=new a(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){b.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){b.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function S(){b.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function k(){b.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function T(e){if("string"==typeof e){var t=a._prime(e);this.m=t.p,this.prime=t}else s(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function _(e){T.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new a(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}b.prototype._tmp=function(){var e=new a(null);return e.words=new Array(Math.ceil(this.n/13)),e},b.prototype.ireduce=function(e){var t,i=e;do{this.split(i,this.tmp),t=(i=(i=this.imulK(i)).iadd(this.tmp)).bitLength()}while(t>this.n);var s=t<this.n?-1:i.ucmp(this.p);return 0===s?(i.words[0]=0,i.length=1):s>0?i.isub(this.p):void 0!==i.strip?i.strip():i._strip(),i},b.prototype.split=function(e,t){e.iushrn(this.n,0,t)},b.prototype.imulK=function(e){return e.imul(this.k)},r(v,b),v.prototype.split=function(e,t){for(var i=4194303,s=Math.min(e.length,9),r=0;r<s;r++)t.words[r]=e.words[r];if(t.length=s,e.length<=9)return e.words[0]=0,void(e.length=1);var a=e.words[9];for(t.words[t.length++]=a&i,r=10;r<e.length;r++){var n=0|e.words[r];e.words[r-10]=(n&i)<<4|a>>>22,a=n}a>>>=22,e.words[r-10]=a,0===a&&e.length>10?e.length-=10:e.length-=9},v.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,i=0;i<e.length;i++){var s=0|e.words[i];t+=977*s,e.words[i]=67108863&t,t=64*s+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},r(w,b),r(S,b),r(k,b),k.prototype.imulK=function(e){for(var t=0,i=0;i<e.length;i++){var s=19*(0|e.words[i])+t,r=67108863&s;s>>>=26,e.words[i]=r,t=s}return 0!==t&&(e.words[e.length++]=t),e},a._prime=function(e){if(y[e])return y[e];var t;if("k256"===e)t=new v;else if("p224"===e)t=new w;else if("p192"===e)t=new S;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new k}return y[e]=t,t},T.prototype._verify1=function(e){s(0===e.negative,"red works only with positives"),s(e.red,"red works only with red numbers")},T.prototype._verify2=function(e,t){s(0==(e.negative|t.negative),"red works only with positives"),s(e.red&&e.red===t.red,"red works only with red numbers")},T.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},T.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},T.prototype.add=function(e,t){this._verify2(e,t);var i=e.add(t);return i.cmp(this.m)>=0&&i.isub(this.m),i._forceRed(this)},T.prototype.iadd=function(e,t){this._verify2(e,t);var i=e.iadd(t);return i.cmp(this.m)>=0&&i.isub(this.m),i},T.prototype.sub=function(e,t){this._verify2(e,t);var i=e.sub(t);return i.cmpn(0)<0&&i.iadd(this.m),i._forceRed(this)},T.prototype.isub=function(e,t){this._verify2(e,t);var i=e.isub(t);return i.cmpn(0)<0&&i.iadd(this.m),i},T.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},T.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},T.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},T.prototype.isqr=function(e){return this.imul(e,e.clone())},T.prototype.sqr=function(e){return this.mul(e,e)},T.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(s(t%2==1),3===t){var i=this.m.add(new a(1)).iushrn(2);return this.pow(e,i)}for(var r=this.m.subn(1),n=0;!r.isZero()&&0===r.andln(1);)n++,r.iushrn(1);s(!r.isZero());var o=new a(1).toRed(this),h=o.redNeg(),d=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new a(2*c*c).toRed(this);0!==this.pow(c,d).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,r),u=this.pow(e,r.addn(1).iushrn(1)),f=this.pow(e,r),p=n;0!==f.cmp(o);){for(var m=f,g=0;0!==m.cmp(o);g++)m=m.redSqr();s(g<p);var y=this.pow(l,new a(1).iushln(p-g-1));u=u.redMul(y),l=y.redSqr(),f=f.redMul(l),p=g}return u},T.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},T.prototype.pow=function(e,t){if(t.isZero())return new a(1).toRed(this);if(0===t.cmpn(1))return e.clone();var i=new Array(16);i[0]=new a(1).toRed(this),i[1]=e;for(var s=2;s<i.length;s++)i[s]=this.mul(i[s-1],e);var r=i[0],n=0,o=0,h=t.bitLength()%26;for(0===h&&(h=26),s=t.length-1;s>=0;s--){for(var d=t.words[s],c=h-1;c>=0;c--){var l=d>>c&1;r!==i[0]&&(r=this.sqr(r)),0!==l||0!==n?(n<<=1,n|=l,(4===++o||0===s&&0===c)&&(r=this.mul(r,i[n]),o=0,n=0)):o=0}h=26}return r},T.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},T.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},a.mont=function(e){return new _(e)},r(_,T),_.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},_.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},_.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var i=e.imul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),a=r;return r.cmp(this.m)>=0?a=r.isub(this.m):r.cmpn(0)<0&&(a=r.iadd(this.m)),a._forceRed(this)},_.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new a(0)._forceRed(this);var i=e.mul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),n=r;return r.cmp(this.m)>=0?n=r.isub(this.m):r.cmpn(0)<0&&(n=r.iadd(this.m)),n._forceRed(this)},_.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=i.nmd(e),this)},34504:function(e,t){"use strict";var i=t;function s(e){return 1===e.length?"0"+e:e}function r(e){for(var t="",i=0;i<e.length;i++)t+=s(e[i].toString(16));return t}i.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var i=[];if("string"!=typeof e){for(var s=0;s<e.length;s++)i[s]=0|e[s];return i}if("hex"===t){(e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e);for(s=0;s<e.length;s+=2)i.push(parseInt(e[s]+e[s+1],16))}else for(s=0;s<e.length;s++){var r=e.charCodeAt(s),a=r>>8,n=255&r;a?i.push(a,n):i.push(n)}return i},i.zero2=s,i.toHex=r,i.encode=function(e,t){return"hex"===t?r(e):e}},27418:function(e){"use strict";var t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable;function r(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},i=0;i<10;i++)t["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach((function(e){s[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},s)).join("")}catch(e){return!1}}()?Object.assign:function(e,a){for(var n,o,h=r(e),d=1;d<arguments.length;d++){for(var c in n=Object(arguments[d]))i.call(n,c)&&(h[c]=n[c]);if(t){o=t(n);for(var l=0;l<o.length;l++)s.call(n,o[l])&&(h[o[l]]=n[o[l]])}}return h}},52818:function(e,t,i){"use strict";var s=i(58235);t.certificate=i(41934);var r=s.define("RSAPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())}));t.RSAPrivateKey=r;var a=s.define("RSAPublicKey",(function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())}));t.RSAPublicKey=a;var n=s.define("SubjectPublicKeyInfo",(function(){this.seq().obj(this.key("algorithm").use(o),this.key("subjectPublicKey").bitstr())}));t.PublicKey=n;var o=s.define("AlgorithmIdentifier",(function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())})),h=s.define("PrivateKeyInfo",(function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(o),this.key("subjectPrivateKey").octstr())}));t.PrivateKey=h;var d=s.define("EncryptedPrivateKeyInfo",(function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())}));t.EncryptedPrivateKey=d;var c=s.define("DSAPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())}));t.DSAPrivateKey=c,t.DSAparam=s.define("DSAparam",(function(){this.int()}));var l=s.define("ECPrivateKey",(function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(u),this.key("publicKey").optional().explicit(1).bitstr())}));t.ECPrivateKey=l;var u=s.define("ECParameters",(function(){this.choice({namedCurve:this.objid()})}));t.signature=s.define("signature",(function(){this.seq().obj(this.key("r").int(),this.key("s").int())}))},41934:function(e,t,i){"use strict";var s=i(58235),r=s.define("Time",(function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})})),a=s.define("AttributeTypeValue",(function(){this.seq().obj(this.key("type").objid(),this.key("value").any())})),n=s.define("AlgorithmIdentifier",(function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional(),this.key("curve").objid().optional())})),o=s.define("SubjectPublicKeyInfo",(function(){this.seq().obj(this.key("algorithm").use(n),this.key("subjectPublicKey").bitstr())})),h=s.define("RelativeDistinguishedName",(function(){this.setof(a)})),d=s.define("RDNSequence",(function(){this.seqof(h)})),c=s.define("Name",(function(){this.choice({rdnSequence:this.use(d)})})),l=s.define("Validity",(function(){this.seq().obj(this.key("notBefore").use(r),this.key("notAfter").use(r))})),u=s.define("Extension",(function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())})),f=s.define("TBSCertificate",(function(){this.seq().obj(this.key("version").explicit(0).int().optional(),this.key("serialNumber").int(),this.key("signature").use(n),this.key("issuer").use(c),this.key("validity").use(l),this.key("subject").use(c),this.key("subjectPublicKeyInfo").use(o),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(u).optional())})),p=s.define("X509Certificate",(function(){this.seq().obj(this.key("tbsCertificate").use(f),this.key("signatureAlgorithm").use(n),this.key("signatureValue").bitstr())}));e.exports=p},77631:function(e,t,i){var s=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r+/=]+)[\n\r]+/m,r=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----/m,a=/^-----BEGIN ((?:.*? KEY)|CERTIFICATE)-----([0-9A-z\n\r+/=]+)-----END \1-----$/m,n=i(13048),o=i(44696),h=i(89509).Buffer;e.exports=function(e,t){var i,d=e.toString(),c=d.match(s);if(c){var l="aes"+c[1],u=h.from(c[2],"hex"),f=h.from(c[3].replace(/[\r\n]/g,""),"base64"),p=n(t,u.slice(0,8),parseInt(c[1],10)).key,m=[],g=o.createDecipheriv(l,p,u);m.push(g.update(f)),m.push(g.final()),i=h.concat(m)}else{var y=d.match(a);i=h.from(y[2].replace(/[\r\n]/g,""),"base64")}return{tag:d.match(r)[1],data:i}}},70980:function(e,t,i){var s=i(52818),r=i(22562),a=i(77631),n=i(44696),o=i(25632),h=i(89509).Buffer;function d(e){var t;"object"!=typeof e||h.isBuffer(e)||(t=e.passphrase,e=e.key),"string"==typeof e&&(e=h.from(e));var i,d,c=a(e,t),l=c.tag,u=c.data;switch(l){case"CERTIFICATE":d=s.certificate.decode(u,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(d||(d=s.PublicKey.decode(u,"der")),i=d.algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return s.RSAPublicKey.decode(d.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return d.subjectPrivateKey=d.subjectPublicKey,{type:"ec",data:d};case"1.2.840.10040.4.1":return d.algorithm.params.pub_key=s.DSAparam.decode(d.subjectPublicKey.data,"der"),{type:"dsa",data:d.algorithm.params};default:throw new Error("unknown key id "+i)}case"ENCRYPTED PRIVATE KEY":u=function(e,t){var i=e.algorithm.decrypt.kde.kdeparams.salt,s=parseInt(e.algorithm.decrypt.kde.kdeparams.iters.toString(),10),a=r[e.algorithm.decrypt.cipher.algo.join(".")],d=e.algorithm.decrypt.cipher.iv,c=e.subjectPrivateKey,l=parseInt(a.split("-")[1],10)/8,u=o.pbkdf2Sync(t,i,s,l,"sha1"),f=n.createDecipheriv(a,u,d),p=[];return p.push(f.update(c)),p.push(f.final()),h.concat(p)}(u=s.EncryptedPrivateKey.decode(u,"der"),t);case"PRIVATE KEY":switch(i=(d=s.PrivateKey.decode(u,"der")).algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return s.RSAPrivateKey.decode(d.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:d.algorithm.curve,privateKey:s.ECPrivateKey.decode(d.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return d.algorithm.params.priv_key=s.DSAparam.decode(d.subjectPrivateKey,"der"),{type:"dsa",params:d.algorithm.params};default:throw new Error("unknown key id "+i)}case"RSA PUBLIC KEY":return s.RSAPublicKey.decode(u,"der");case"RSA PRIVATE KEY":return s.RSAPrivateKey.decode(u,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:s.DSAPrivateKey.decode(u,"der")};case"EC PRIVATE KEY":return{curve:(u=s.ECPrivateKey.decode(u,"der")).parameters.value,privateKey:u.privateKey};default:throw new Error("unknown key type "+l)}}e.exports=d,d.signature=s.signature},25632:function(e,t,i){t.pbkdf2=i(88638),t.pbkdf2Sync=i(91257)},88638:function(e,t,i){var s,r,a=i(89509).Buffer,n=i(77357),o=i(12368),h=i(91257),d=i(57777),c=i.g.crypto&&i.g.crypto.subtle,l={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},u=[];function f(){return r||(r=i.g.process&&i.g.process.nextTick?i.g.process.nextTick:i.g.queueMicrotask?i.g.queueMicrotask:i.g.setImmediate?i.g.setImmediate:i.g.setTimeout)}function p(e,t,i,s,r){return c.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]).then((function(e){return c.deriveBits({name:"PBKDF2",salt:t,iterations:i,hash:{name:r}},e,s<<3)})).then((function(e){return a.from(e)}))}e.exports=function(e,t,r,m,g,y){"function"==typeof g&&(y=g,g=void 0);var b=l[(g=g||"sha1").toLowerCase()];if(b&&"function"==typeof i.g.Promise){if(n(r,m),e=d(e,o,"Password"),t=d(t,o,"Salt"),"function"!=typeof y)throw new Error("No callback provided to pbkdf2");!function(e,t){e.then((function(e){f()((function(){t(null,e)}))}),(function(e){f()((function(){t(e)}))}))}(function(e){if(i.g.process&&!i.g.process.browser)return Promise.resolve(!1);if(!c||!c.importKey||!c.deriveBits)return Promise.resolve(!1);if(void 0!==u[e])return u[e];var t=p(s=s||a.alloc(8),s,10,128,e).then((function(){return!0})).catch((function(){return!1}));return u[e]=t,t}(b).then((function(i){return i?p(e,t,r,m,b):h(e,t,r,m,g)})),y)}else f()((function(){var i;try{i=h(e,t,r,m,g)}catch(e){return y(e)}y(null,i)}))}},12368:function(e,t,i){var s,r=i(34155);if(i.g.process&&i.g.process.browser)s="utf-8";else if(i.g.process&&i.g.process.version){s=parseInt(r.version.split(".")[0].slice(1),10)>=6?"utf-8":"binary"}else s="utf-8";e.exports=s},77357:function(e){var t=Math.pow(2,30)-1;e.exports=function(e,i){if("number"!=typeof e)throw new TypeError("Iterations not a number");if(e<0)throw new TypeError("Bad iterations");if("number"!=typeof i)throw new TypeError("Key length not a number");if(i<0||i>t||i!=i)throw new TypeError("Bad key length")}},91257:function(e,t,i){var s=i(78028),r=i(79785),a=i(89072),n=i(89509).Buffer,o=i(77357),h=i(12368),d=i(57777),c=n.alloc(128),l={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function u(e,t,i){var o=function(e){function t(t){return a(e).update(t).digest()}function i(e){return(new r).update(e).digest()}return"rmd160"===e||"ripemd160"===e?i:"md5"===e?s:t}(e),h="sha512"===e||"sha384"===e?128:64;t.length>h?t=o(t):t.length<h&&(t=n.concat([t,c],h));for(var d=n.allocUnsafe(h+l[e]),u=n.allocUnsafe(h+l[e]),f=0;f<h;f++)d[f]=54^t[f],u[f]=92^t[f];var p=n.allocUnsafe(h+i+4);d.copy(p,0,0,h),this.ipad1=p,this.ipad2=d,this.opad=u,this.alg=e,this.blocksize=h,this.hash=o,this.size=l[e]}u.prototype.run=function(e,t){return e.copy(t,this.blocksize),this.hash(t).copy(this.opad,this.blocksize),this.hash(this.opad)},e.exports=function(e,t,i,s,r){o(i,s);var a=new u(r=r||"sha1",e=d(e,h,"Password"),(t=d(t,h,"Salt")).length),c=n.allocUnsafe(s),f=n.allocUnsafe(t.length+4);t.copy(f,0,0,t.length);for(var p=0,m=l[r],g=Math.ceil(s/m),y=1;y<=g;y++){f.writeUInt32BE(y,t.length);for(var b=a.run(f,a.ipad1),v=b,w=1;w<i;w++){v=a.run(v,a.ipad2);for(var S=0;S<m;S++)b[S]^=v[S]}b.copy(c,p),p+=m}return c}},57777:function(e,t,i){var s=i(89509).Buffer;e.exports=function(e,t,i){if(s.isBuffer(e))return e;if("string"==typeof e)return s.from(e,t);if(ArrayBuffer.isView(e))return s.from(e.buffer);throw new TypeError(i+" must be a string, a Buffer, a typed array or a DataView")}},88212:function(e,t,i){"use strict";var s=i(34155);void 0===s||!s.version||0===s.version.indexOf("v0.")||0===s.version.indexOf("v1.")&&0!==s.version.indexOf("v1.8.")?e.exports={nextTick:function(e,t,i,r){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var a,n,o=arguments.length;switch(o){case 0:case 1:return s.nextTick(e);case 2:return s.nextTick((function(){e.call(null,t)}));case 3:return s.nextTick((function(){e.call(null,t,i)}));case 4:return s.nextTick((function(){e.call(null,t,i,r)}));default:for(a=new Array(o-1),n=0;n<a.length;)a[n++]=arguments[n];return s.nextTick((function(){e.apply(null,a)}))}}}:e.exports=s},7900:function(e,t,i){t.publicEncrypt=i(16559),t.privateDecrypt=i(26138),t.privateEncrypt=function(e,i){return t.publicEncrypt(e,i,!0)},t.publicDecrypt=function(e,i){return t.privateDecrypt(e,i,!0)}},99199:function(e,t,i){var s=i(23482),r=i(89509).Buffer;function a(e){var t=r.allocUnsafe(4);return t.writeUInt32BE(e,0),t}e.exports=function(e,t){for(var i,n=r.alloc(0),o=0;n.length<t;)i=a(o++),n=r.concat([n,s("sha1").update(e).update(i).digest()]);return n.slice(0,t)}},92144:function(e,t,i){!function(e,t){"use strict";function s(e,t){if(!e)throw new Error(t||"Assertion failed")}function r(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function a(e,t,i){if(a.isBN(e))return e;this.negative=0,this.words=null,this.length=0,this.red=null,null!==e&&("le"!==t&&"be"!==t||(i=t,t=10),this._init(e||0,t||10,i||"be"))}var n;"object"==typeof e?e.exports=a:t.BN=a,a.BN=a,a.wordSize=26;try{n="undefined"!=typeof window&&void 0!==window.Buffer?window.Buffer:i(77108).Buffer}catch(e){}function o(e,t){var i=e.charCodeAt(t);return i>=65&&i<=70?i-55:i>=97&&i<=102?i-87:i-48&15}function h(e,t,i){var s=o(e,i);return i-1>=t&&(s|=o(e,i-1)<<4),s}function d(e,t,i,s){for(var r=0,a=Math.min(e.length,i),n=t;n<a;n++){var o=e.charCodeAt(n)-48;r*=s,r+=o>=49?o-49+10:o>=17?o-17+10:o}return r}a.isBN=function(e){return e instanceof a||null!==e&&"object"==typeof e&&e.constructor.wordSize===a.wordSize&&Array.isArray(e.words)},a.max=function(e,t){return e.cmp(t)>0?e:t},a.min=function(e,t){return e.cmp(t)<0?e:t},a.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),s(t===(0|t)&&t>=2&&t<=36);var r=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&(r++,this.negative=1),r<e.length&&(16===t?this._parseHex(e,r,i):(this._parseBase(e,t,r),"le"===i&&this._initArray(this.toArray(),t,i)))},a.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),e<67108864?(this.words=[67108863&e],this.length=1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],this.length=2):(s(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],this.length=3),"le"===i&&this._initArray(this.toArray(),t,i)},a.prototype._initArray=function(e,t,i){if(s("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var r=0;r<this.length;r++)this.words[r]=0;var a,n,o=0;if("be"===i)for(r=e.length-1,a=0;r>=0;r-=3)n=e[r]|e[r-1]<<8|e[r-2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);else if("le"===i)for(r=0,a=0;r<e.length;r+=3)n=e[r]|e[r+1]<<8|e[r+2]<<16,this.words[a]|=n<<o&67108863,this.words[a+1]=n>>>26-o&67108863,(o+=24)>=26&&(o-=26,a++);return this.strip()},a.prototype._parseHex=function(e,t,i){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var s=0;s<this.length;s++)this.words[s]=0;var r,a=0,n=0;if("be"===i)for(s=e.length-1;s>=t;s-=2)r=h(e,t,s)<<a,this.words[n]|=67108863&r,a>=18?(a-=18,n+=1,this.words[n]|=r>>>26):a+=8;else for(s=(e.length-t)%2==0?t+1:t;s<e.length;s+=2)r=h(e,t,s)<<a,this.words[n]|=67108863&r,a>=18?(a-=18,n+=1,this.words[n]|=r>>>26):a+=8;this.strip()},a.prototype._parseBase=function(e,t,i){this.words=[0],this.length=1;for(var s=0,r=1;r<=67108863;r*=t)s++;s--,r=r/t|0;for(var a=e.length-i,n=a%s,o=Math.min(a,a-n)+i,h=0,c=i;c<o;c+=s)h=d(e,c,c+s,t),this.imuln(r),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h);if(0!==n){var l=1;for(h=d(e,c,e.length,t),c=0;c<n;c++)l*=t;this.imuln(l),this.words[0]+h<67108864?this.words[0]+=h:this._iaddn(h)}this.strip()},a.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},a.prototype.clone=function(){var e=new a(null);return this.copy(e),e},a.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},a.prototype.strip=function(){for(;this.length>1&&0===this.words[this.length-1];)this.length--;return this._normSign()},a.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},a.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var c=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],u=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function f(e,t,i){i.negative=t.negative^e.negative;var s=e.length+t.length|0;i.length=s,s=s-1|0;var r=0|e.words[0],a=0|t.words[0],n=r*a,o=67108863&n,h=n/67108864|0;i.words[0]=o;for(var d=1;d<s;d++){for(var c=h>>>26,l=67108863&h,u=Math.min(d,t.length-1),f=Math.max(0,d-e.length+1);f<=u;f++){var p=d-f|0;c+=(n=(r=0|e.words[p])*(a=0|t.words[f])+l)/67108864|0,l=67108863&n}i.words[d]=0|l,h=0|c}return 0!==h?i.words[d]=0|h:i.length--,i.strip()}a.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var r=0,a=0,n=0;n<this.length;n++){var o=this.words[n],h=(16777215&(o<<r|a)).toString(16);i=0!==(a=o>>>24-r&16777215)||n!==this.length-1?c[6-h.length]+h+i:h+i,(r+=2)>=26&&(r-=26,n--)}for(0!==a&&(i=a.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&e>=2&&e<=36){var d=l[e],f=u[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var m=p.modn(f).toString(e);i=(p=p.idivn(f)).isZero()?m+i:c[d-m.length]+m+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}s(!1,"Base should be between 2 and 36")},a.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:this.length>2&&s(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},a.prototype.toJSON=function(){return this.toString(16)},a.prototype.toBuffer=function(e,t){return s(void 0!==n),this.toArrayLike(n,e,t)},a.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},a.prototype.toArrayLike=function(e,t,i){var r=this.byteLength(),a=i||Math.max(1,r);s(r<=a,"byte array longer than desired length"),s(a>0,"Requested array length <= 0"),this.strip();var n,o,h="le"===t,d=new e(a),c=this.clone();if(h){for(o=0;!c.isZero();o++)n=c.andln(255),c.iushrn(8),d[o]=n;for(;o<a;o++)d[o]=0}else{for(o=0;o<a-r;o++)d[o]=0;for(o=0;!c.isZero();o++)n=c.andln(255),c.iushrn(8),d[a-o-1]=n}return d},Math.clz32?a.prototype._countBits=function(e){return 32-Math.clz32(e)}:a.prototype._countBits=function(e){var t=e,i=0;return t>=4096&&(i+=13,t>>>=13),t>=64&&(i+=7,t>>>=7),t>=8&&(i+=4,t>>>=4),t>=2&&(i+=2,t>>>=2),i+t},a.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,i=0;return 0==(8191&t)&&(i+=13,t>>>=13),0==(127&t)&&(i+=7,t>>>=7),0==(15&t)&&(i+=4,t>>>=4),0==(3&t)&&(i+=2,t>>>=2),0==(1&t)&&i++,i},a.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},a.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var i=this._zeroBits(this.words[t]);if(e+=i,26!==i)break}return e},a.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},a.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},a.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},a.prototype.isNeg=function(){return 0!==this.negative},a.prototype.neg=function(){return this.clone().ineg()},a.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},a.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},a.prototype.ior=function(e){return s(0==(this.negative|e.negative)),this.iuor(e)},a.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},a.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},a.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var i=0;i<t.length;i++)this.words[i]=this.words[i]&e.words[i];return this.length=t.length,this.strip()},a.prototype.iand=function(e){return s(0==(this.negative|e.negative)),this.iuand(e)},a.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},a.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},a.prototype.iuxor=function(e){var t,i;this.length>e.length?(t=this,i=e):(t=e,i=this);for(var s=0;s<i.length;s++)this.words[s]=t.words[s]^i.words[s];if(this!==t)for(;s<t.length;s++)this.words[s]=t.words[s];return this.length=t.length,this.strip()},a.prototype.ixor=function(e){return s(0==(this.negative|e.negative)),this.iuxor(e)},a.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},a.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},a.prototype.inotn=function(e){s("number"==typeof e&&e>=0);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),i>0&&t--;for(var r=0;r<t;r++)this.words[r]=67108863&~this.words[r];return i>0&&(this.words[r]=~this.words[r]&67108863>>26-i),this.strip()},a.prototype.notn=function(e){return this.clone().inotn(e)},a.prototype.setn=function(e,t){s("number"==typeof e&&e>=0);var i=e/26|0,r=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<r:this.words[i]&~(1<<r),this.strip()},a.prototype.iadd=function(e){var t,i,s;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();this.length>e.length?(i=this,s=e):(i=e,s=this);for(var r=0,a=0;a<s.length;a++)t=(0|i.words[a])+(0|s.words[a])+r,this.words[a]=67108863&t,r=t>>>26;for(;0!==r&&a<i.length;a++)t=(0|i.words[a])+r,this.words[a]=67108863&t,r=t>>>26;if(this.length=i.length,0!==r)this.words[this.length]=r,this.length++;else if(i!==this)for(;a<i.length;a++)this.words[a]=i.words[a];return this},a.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},a.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var i,s,r=this.cmp(e);if(0===r)return this.negative=0,this.length=1,this.words[0]=0,this;r>0?(i=this,s=e):(i=e,s=this);for(var a=0,n=0;n<s.length;n++)a=(t=(0|i.words[n])-(0|s.words[n])+a)>>26,this.words[n]=67108863&t;for(;0!==a&&n<i.length;n++)a=(t=(0|i.words[n])+a)>>26,this.words[n]=67108863&t;if(0===a&&n<i.length&&i!==this)for(;n<i.length;n++)this.words[n]=i.words[n];return this.length=Math.max(this.length,n),i!==this&&(this.negative=1),this.strip()},a.prototype.sub=function(e){return this.clone().isub(e)};var p=function(e,t,i){var s,r,a,n=e.words,o=t.words,h=i.words,d=0,c=0|n[0],l=8191&c,u=c>>>13,f=0|n[1],p=8191&f,m=f>>>13,g=0|n[2],y=8191&g,b=g>>>13,v=0|n[3],w=8191&v,S=v>>>13,k=0|n[4],T=8191&k,_=k>>>13,O=0|n[5],M=8191&O,I=O>>>13,x=0|n[6],C=8191&x,P=x>>>13,A=0|n[7],N=8191&A,B=A>>>13,E=0|n[8],V=8191&E,L=E>>>13,R=0|n[9],D=8191&R,F=R>>>13,q=0|o[0],G=8191&q,H=q>>>13,U=0|o[1],j=8191&U,W=U>>>13,z=0|o[2],K=8191&z,X=z>>>13,Z=0|o[3],Y=8191&Z,Q=Z>>>13,J=0|o[4],$=8191&J,ee=J>>>13,te=0|o[5],ie=8191&te,se=te>>>13,re=0|o[6],ae=8191&re,ne=re>>>13,oe=0|o[7],he=8191&oe,de=oe>>>13,ce=0|o[8],le=8191&ce,ue=ce>>>13,fe=0|o[9],pe=8191&fe,me=fe>>>13;i.negative=e.negative^t.negative,i.length=19;var ge=(d+(s=Math.imul(l,G))|0)+((8191&(r=(r=Math.imul(l,H))+Math.imul(u,G)|0))<<13)|0;d=((a=Math.imul(u,H))+(r>>>13)|0)+(ge>>>26)|0,ge&=67108863,s=Math.imul(p,G),r=(r=Math.imul(p,H))+Math.imul(m,G)|0,a=Math.imul(m,H);var ye=(d+(s=s+Math.imul(l,j)|0)|0)+((8191&(r=(r=r+Math.imul(l,W)|0)+Math.imul(u,j)|0))<<13)|0;d=((a=a+Math.imul(u,W)|0)+(r>>>13)|0)+(ye>>>26)|0,ye&=67108863,s=Math.imul(y,G),r=(r=Math.imul(y,H))+Math.imul(b,G)|0,a=Math.imul(b,H),s=s+Math.imul(p,j)|0,r=(r=r+Math.imul(p,W)|0)+Math.imul(m,j)|0,a=a+Math.imul(m,W)|0;var be=(d+(s=s+Math.imul(l,K)|0)|0)+((8191&(r=(r=r+Math.imul(l,X)|0)+Math.imul(u,K)|0))<<13)|0;d=((a=a+Math.imul(u,X)|0)+(r>>>13)|0)+(be>>>26)|0,be&=67108863,s=Math.imul(w,G),r=(r=Math.imul(w,H))+Math.imul(S,G)|0,a=Math.imul(S,H),s=s+Math.imul(y,j)|0,r=(r=r+Math.imul(y,W)|0)+Math.imul(b,j)|0,a=a+Math.imul(b,W)|0,s=s+Math.imul(p,K)|0,r=(r=r+Math.imul(p,X)|0)+Math.imul(m,K)|0,a=a+Math.imul(m,X)|0;var ve=(d+(s=s+Math.imul(l,Y)|0)|0)+((8191&(r=(r=r+Math.imul(l,Q)|0)+Math.imul(u,Y)|0))<<13)|0;d=((a=a+Math.imul(u,Q)|0)+(r>>>13)|0)+(ve>>>26)|0,ve&=67108863,s=Math.imul(T,G),r=(r=Math.imul(T,H))+Math.imul(_,G)|0,a=Math.imul(_,H),s=s+Math.imul(w,j)|0,r=(r=r+Math.imul(w,W)|0)+Math.imul(S,j)|0,a=a+Math.imul(S,W)|0,s=s+Math.imul(y,K)|0,r=(r=r+Math.imul(y,X)|0)+Math.imul(b,K)|0,a=a+Math.imul(b,X)|0,s=s+Math.imul(p,Y)|0,r=(r=r+Math.imul(p,Q)|0)+Math.imul(m,Y)|0,a=a+Math.imul(m,Q)|0;var we=(d+(s=s+Math.imul(l,$)|0)|0)+((8191&(r=(r=r+Math.imul(l,ee)|0)+Math.imul(u,$)|0))<<13)|0;d=((a=a+Math.imul(u,ee)|0)+(r>>>13)|0)+(we>>>26)|0,we&=67108863,s=Math.imul(M,G),r=(r=Math.imul(M,H))+Math.imul(I,G)|0,a=Math.imul(I,H),s=s+Math.imul(T,j)|0,r=(r=r+Math.imul(T,W)|0)+Math.imul(_,j)|0,a=a+Math.imul(_,W)|0,s=s+Math.imul(w,K)|0,r=(r=r+Math.imul(w,X)|0)+Math.imul(S,K)|0,a=a+Math.imul(S,X)|0,s=s+Math.imul(y,Y)|0,r=(r=r+Math.imul(y,Q)|0)+Math.imul(b,Y)|0,a=a+Math.imul(b,Q)|0,s=s+Math.imul(p,$)|0,r=(r=r+Math.imul(p,ee)|0)+Math.imul(m,$)|0,a=a+Math.imul(m,ee)|0;var Se=(d+(s=s+Math.imul(l,ie)|0)|0)+((8191&(r=(r=r+Math.imul(l,se)|0)+Math.imul(u,ie)|0))<<13)|0;d=((a=a+Math.imul(u,se)|0)+(r>>>13)|0)+(Se>>>26)|0,Se&=67108863,s=Math.imul(C,G),r=(r=Math.imul(C,H))+Math.imul(P,G)|0,a=Math.imul(P,H),s=s+Math.imul(M,j)|0,r=(r=r+Math.imul(M,W)|0)+Math.imul(I,j)|0,a=a+Math.imul(I,W)|0,s=s+Math.imul(T,K)|0,r=(r=r+Math.imul(T,X)|0)+Math.imul(_,K)|0,a=a+Math.imul(_,X)|0,s=s+Math.imul(w,Y)|0,r=(r=r+Math.imul(w,Q)|0)+Math.imul(S,Y)|0,a=a+Math.imul(S,Q)|0,s=s+Math.imul(y,$)|0,r=(r=r+Math.imul(y,ee)|0)+Math.imul(b,$)|0,a=a+Math.imul(b,ee)|0,s=s+Math.imul(p,ie)|0,r=(r=r+Math.imul(p,se)|0)+Math.imul(m,ie)|0,a=a+Math.imul(m,se)|0;var ke=(d+(s=s+Math.imul(l,ae)|0)|0)+((8191&(r=(r=r+Math.imul(l,ne)|0)+Math.imul(u,ae)|0))<<13)|0;d=((a=a+Math.imul(u,ne)|0)+(r>>>13)|0)+(ke>>>26)|0,ke&=67108863,s=Math.imul(N,G),r=(r=Math.imul(N,H))+Math.imul(B,G)|0,a=Math.imul(B,H),s=s+Math.imul(C,j)|0,r=(r=r+Math.imul(C,W)|0)+Math.imul(P,j)|0,a=a+Math.imul(P,W)|0,s=s+Math.imul(M,K)|0,r=(r=r+Math.imul(M,X)|0)+Math.imul(I,K)|0,a=a+Math.imul(I,X)|0,s=s+Math.imul(T,Y)|0,r=(r=r+Math.imul(T,Q)|0)+Math.imul(_,Y)|0,a=a+Math.imul(_,Q)|0,s=s+Math.imul(w,$)|0,r=(r=r+Math.imul(w,ee)|0)+Math.imul(S,$)|0,a=a+Math.imul(S,ee)|0,s=s+Math.imul(y,ie)|0,r=(r=r+Math.imul(y,se)|0)+Math.imul(b,ie)|0,a=a+Math.imul(b,se)|0,s=s+Math.imul(p,ae)|0,r=(r=r+Math.imul(p,ne)|0)+Math.imul(m,ae)|0,a=a+Math.imul(m,ne)|0;var Te=(d+(s=s+Math.imul(l,he)|0)|0)+((8191&(r=(r=r+Math.imul(l,de)|0)+Math.imul(u,he)|0))<<13)|0;d=((a=a+Math.imul(u,de)|0)+(r>>>13)|0)+(Te>>>26)|0,Te&=67108863,s=Math.imul(V,G),r=(r=Math.imul(V,H))+Math.imul(L,G)|0,a=Math.imul(L,H),s=s+Math.imul(N,j)|0,r=(r=r+Math.imul(N,W)|0)+Math.imul(B,j)|0,a=a+Math.imul(B,W)|0,s=s+Math.imul(C,K)|0,r=(r=r+Math.imul(C,X)|0)+Math.imul(P,K)|0,a=a+Math.imul(P,X)|0,s=s+Math.imul(M,Y)|0,r=(r=r+Math.imul(M,Q)|0)+Math.imul(I,Y)|0,a=a+Math.imul(I,Q)|0,s=s+Math.imul(T,$)|0,r=(r=r+Math.imul(T,ee)|0)+Math.imul(_,$)|0,a=a+Math.imul(_,ee)|0,s=s+Math.imul(w,ie)|0,r=(r=r+Math.imul(w,se)|0)+Math.imul(S,ie)|0,a=a+Math.imul(S,se)|0,s=s+Math.imul(y,ae)|0,r=(r=r+Math.imul(y,ne)|0)+Math.imul(b,ae)|0,a=a+Math.imul(b,ne)|0,s=s+Math.imul(p,he)|0,r=(r=r+Math.imul(p,de)|0)+Math.imul(m,he)|0,a=a+Math.imul(m,de)|0;var _e=(d+(s=s+Math.imul(l,le)|0)|0)+((8191&(r=(r=r+Math.imul(l,ue)|0)+Math.imul(u,le)|0))<<13)|0;d=((a=a+Math.imul(u,ue)|0)+(r>>>13)|0)+(_e>>>26)|0,_e&=67108863,s=Math.imul(D,G),r=(r=Math.imul(D,H))+Math.imul(F,G)|0,a=Math.imul(F,H),s=s+Math.imul(V,j)|0,r=(r=r+Math.imul(V,W)|0)+Math.imul(L,j)|0,a=a+Math.imul(L,W)|0,s=s+Math.imul(N,K)|0,r=(r=r+Math.imul(N,X)|0)+Math.imul(B,K)|0,a=a+Math.imul(B,X)|0,s=s+Math.imul(C,Y)|0,r=(r=r+Math.imul(C,Q)|0)+Math.imul(P,Y)|0,a=a+Math.imul(P,Q)|0,s=s+Math.imul(M,$)|0,r=(r=r+Math.imul(M,ee)|0)+Math.imul(I,$)|0,a=a+Math.imul(I,ee)|0,s=s+Math.imul(T,ie)|0,r=(r=r+Math.imul(T,se)|0)+Math.imul(_,ie)|0,a=a+Math.imul(_,se)|0,s=s+Math.imul(w,ae)|0,r=(r=r+Math.imul(w,ne)|0)+Math.imul(S,ae)|0,a=a+Math.imul(S,ne)|0,s=s+Math.imul(y,he)|0,r=(r=r+Math.imul(y,de)|0)+Math.imul(b,he)|0,a=a+Math.imul(b,de)|0,s=s+Math.imul(p,le)|0,r=(r=r+Math.imul(p,ue)|0)+Math.imul(m,le)|0,a=a+Math.imul(m,ue)|0;var Oe=(d+(s=s+Math.imul(l,pe)|0)|0)+((8191&(r=(r=r+Math.imul(l,me)|0)+Math.imul(u,pe)|0))<<13)|0;d=((a=a+Math.imul(u,me)|0)+(r>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,s=Math.imul(D,j),r=(r=Math.imul(D,W))+Math.imul(F,j)|0,a=Math.imul(F,W),s=s+Math.imul(V,K)|0,r=(r=r+Math.imul(V,X)|0)+Math.imul(L,K)|0,a=a+Math.imul(L,X)|0,s=s+Math.imul(N,Y)|0,r=(r=r+Math.imul(N,Q)|0)+Math.imul(B,Y)|0,a=a+Math.imul(B,Q)|0,s=s+Math.imul(C,$)|0,r=(r=r+Math.imul(C,ee)|0)+Math.imul(P,$)|0,a=a+Math.imul(P,ee)|0,s=s+Math.imul(M,ie)|0,r=(r=r+Math.imul(M,se)|0)+Math.imul(I,ie)|0,a=a+Math.imul(I,se)|0,s=s+Math.imul(T,ae)|0,r=(r=r+Math.imul(T,ne)|0)+Math.imul(_,ae)|0,a=a+Math.imul(_,ne)|0,s=s+Math.imul(w,he)|0,r=(r=r+Math.imul(w,de)|0)+Math.imul(S,he)|0,a=a+Math.imul(S,de)|0,s=s+Math.imul(y,le)|0,r=(r=r+Math.imul(y,ue)|0)+Math.imul(b,le)|0,a=a+Math.imul(b,ue)|0;var Me=(d+(s=s+Math.imul(p,pe)|0)|0)+((8191&(r=(r=r+Math.imul(p,me)|0)+Math.imul(m,pe)|0))<<13)|0;d=((a=a+Math.imul(m,me)|0)+(r>>>13)|0)+(Me>>>26)|0,Me&=67108863,s=Math.imul(D,K),r=(r=Math.imul(D,X))+Math.imul(F,K)|0,a=Math.imul(F,X),s=s+Math.imul(V,Y)|0,r=(r=r+Math.imul(V,Q)|0)+Math.imul(L,Y)|0,a=a+Math.imul(L,Q)|0,s=s+Math.imul(N,$)|0,r=(r=r+Math.imul(N,ee)|0)+Math.imul(B,$)|0,a=a+Math.imul(B,ee)|0,s=s+Math.imul(C,ie)|0,r=(r=r+Math.imul(C,se)|0)+Math.imul(P,ie)|0,a=a+Math.imul(P,se)|0,s=s+Math.imul(M,ae)|0,r=(r=r+Math.imul(M,ne)|0)+Math.imul(I,ae)|0,a=a+Math.imul(I,ne)|0,s=s+Math.imul(T,he)|0,r=(r=r+Math.imul(T,de)|0)+Math.imul(_,he)|0,a=a+Math.imul(_,de)|0,s=s+Math.imul(w,le)|0,r=(r=r+Math.imul(w,ue)|0)+Math.imul(S,le)|0,a=a+Math.imul(S,ue)|0;var Ie=(d+(s=s+Math.imul(y,pe)|0)|0)+((8191&(r=(r=r+Math.imul(y,me)|0)+Math.imul(b,pe)|0))<<13)|0;d=((a=a+Math.imul(b,me)|0)+(r>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,s=Math.imul(D,Y),r=(r=Math.imul(D,Q))+Math.imul(F,Y)|0,a=Math.imul(F,Q),s=s+Math.imul(V,$)|0,r=(r=r+Math.imul(V,ee)|0)+Math.imul(L,$)|0,a=a+Math.imul(L,ee)|0,s=s+Math.imul(N,ie)|0,r=(r=r+Math.imul(N,se)|0)+Math.imul(B,ie)|0,a=a+Math.imul(B,se)|0,s=s+Math.imul(C,ae)|0,r=(r=r+Math.imul(C,ne)|0)+Math.imul(P,ae)|0,a=a+Math.imul(P,ne)|0,s=s+Math.imul(M,he)|0,r=(r=r+Math.imul(M,de)|0)+Math.imul(I,he)|0,a=a+Math.imul(I,de)|0,s=s+Math.imul(T,le)|0,r=(r=r+Math.imul(T,ue)|0)+Math.imul(_,le)|0,a=a+Math.imul(_,ue)|0;var xe=(d+(s=s+Math.imul(w,pe)|0)|0)+((8191&(r=(r=r+Math.imul(w,me)|0)+Math.imul(S,pe)|0))<<13)|0;d=((a=a+Math.imul(S,me)|0)+(r>>>13)|0)+(xe>>>26)|0,xe&=67108863,s=Math.imul(D,$),r=(r=Math.imul(D,ee))+Math.imul(F,$)|0,a=Math.imul(F,ee),s=s+Math.imul(V,ie)|0,r=(r=r+Math.imul(V,se)|0)+Math.imul(L,ie)|0,a=a+Math.imul(L,se)|0,s=s+Math.imul(N,ae)|0,r=(r=r+Math.imul(N,ne)|0)+Math.imul(B,ae)|0,a=a+Math.imul(B,ne)|0,s=s+Math.imul(C,he)|0,r=(r=r+Math.imul(C,de)|0)+Math.imul(P,he)|0,a=a+Math.imul(P,de)|0,s=s+Math.imul(M,le)|0,r=(r=r+Math.imul(M,ue)|0)+Math.imul(I,le)|0,a=a+Math.imul(I,ue)|0;var Ce=(d+(s=s+Math.imul(T,pe)|0)|0)+((8191&(r=(r=r+Math.imul(T,me)|0)+Math.imul(_,pe)|0))<<13)|0;d=((a=a+Math.imul(_,me)|0)+(r>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,s=Math.imul(D,ie),r=(r=Math.imul(D,se))+Math.imul(F,ie)|0,a=Math.imul(F,se),s=s+Math.imul(V,ae)|0,r=(r=r+Math.imul(V,ne)|0)+Math.imul(L,ae)|0,a=a+Math.imul(L,ne)|0,s=s+Math.imul(N,he)|0,r=(r=r+Math.imul(N,de)|0)+Math.imul(B,he)|0,a=a+Math.imul(B,de)|0,s=s+Math.imul(C,le)|0,r=(r=r+Math.imul(C,ue)|0)+Math.imul(P,le)|0,a=a+Math.imul(P,ue)|0;var Pe=(d+(s=s+Math.imul(M,pe)|0)|0)+((8191&(r=(r=r+Math.imul(M,me)|0)+Math.imul(I,pe)|0))<<13)|0;d=((a=a+Math.imul(I,me)|0)+(r>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,s=Math.imul(D,ae),r=(r=Math.imul(D,ne))+Math.imul(F,ae)|0,a=Math.imul(F,ne),s=s+Math.imul(V,he)|0,r=(r=r+Math.imul(V,de)|0)+Math.imul(L,he)|0,a=a+Math.imul(L,de)|0,s=s+Math.imul(N,le)|0,r=(r=r+Math.imul(N,ue)|0)+Math.imul(B,le)|0,a=a+Math.imul(B,ue)|0;var Ae=(d+(s=s+Math.imul(C,pe)|0)|0)+((8191&(r=(r=r+Math.imul(C,me)|0)+Math.imul(P,pe)|0))<<13)|0;d=((a=a+Math.imul(P,me)|0)+(r>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,s=Math.imul(D,he),r=(r=Math.imul(D,de))+Math.imul(F,he)|0,a=Math.imul(F,de),s=s+Math.imul(V,le)|0,r=(r=r+Math.imul(V,ue)|0)+Math.imul(L,le)|0,a=a+Math.imul(L,ue)|0;var Ne=(d+(s=s+Math.imul(N,pe)|0)|0)+((8191&(r=(r=r+Math.imul(N,me)|0)+Math.imul(B,pe)|0))<<13)|0;d=((a=a+Math.imul(B,me)|0)+(r>>>13)|0)+(Ne>>>26)|0,Ne&=67108863,s=Math.imul(D,le),r=(r=Math.imul(D,ue))+Math.imul(F,le)|0,a=Math.imul(F,ue);var Be=(d+(s=s+Math.imul(V,pe)|0)|0)+((8191&(r=(r=r+Math.imul(V,me)|0)+Math.imul(L,pe)|0))<<13)|0;d=((a=a+Math.imul(L,me)|0)+(r>>>13)|0)+(Be>>>26)|0,Be&=67108863;var Ee=(d+(s=Math.imul(D,pe))|0)+((8191&(r=(r=Math.imul(D,me))+Math.imul(F,pe)|0))<<13)|0;return d=((a=Math.imul(F,me))+(r>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,h[0]=ge,h[1]=ye,h[2]=be,h[3]=ve,h[4]=we,h[5]=Se,h[6]=ke,h[7]=Te,h[8]=_e,h[9]=Oe,h[10]=Me,h[11]=Ie,h[12]=xe,h[13]=Ce,h[14]=Pe,h[15]=Ae,h[16]=Ne,h[17]=Be,h[18]=Ee,0!==d&&(h[19]=d,i.length++),i};function m(e,t,i){return(new g).mulp(e,t,i)}function g(e,t){this.x=e,this.y=t}Math.imul||(p=f),a.prototype.mulTo=function(e,t){var i,s=this.length+e.length;return i=10===this.length&&10===e.length?p(this,e,t):s<63?f(this,e,t):s<1024?function(e,t,i){i.negative=t.negative^e.negative,i.length=e.length+t.length;for(var s=0,r=0,a=0;a<i.length-1;a++){var n=r;r=0;for(var o=67108863&s,h=Math.min(a,t.length-1),d=Math.max(0,a-e.length+1);d<=h;d++){var c=a-d,l=(0|e.words[c])*(0|t.words[d]),u=67108863&l;o=67108863&(u=u+o|0),r+=(n=(n=n+(l/67108864|0)|0)+(u>>>26)|0)>>>26,n&=67108863}i.words[a]=o,s=n,n=r}return 0!==s?i.words[a]=s:i.length--,i.strip()}(this,e,t):m(this,e,t),i},g.prototype.makeRBT=function(e){for(var t=new Array(e),i=a.prototype._countBits(e)-1,s=0;s<e;s++)t[s]=this.revBin(s,i,e);return t},g.prototype.revBin=function(e,t,i){if(0===e||e===i-1)return e;for(var s=0,r=0;r<t;r++)s|=(1&e)<<t-r-1,e>>=1;return s},g.prototype.permute=function(e,t,i,s,r,a){for(var n=0;n<a;n++)s[n]=t[e[n]],r[n]=i[e[n]]},g.prototype.transform=function(e,t,i,s,r,a){this.permute(a,e,t,i,s,r);for(var n=1;n<r;n<<=1)for(var o=n<<1,h=Math.cos(2*Math.PI/o),d=Math.sin(2*Math.PI/o),c=0;c<r;c+=o)for(var l=h,u=d,f=0;f<n;f++){var p=i[c+f],m=s[c+f],g=i[c+f+n],y=s[c+f+n],b=l*g-u*y;y=l*y+u*g,g=b,i[c+f]=p+g,s[c+f]=m+y,i[c+f+n]=p-g,s[c+f+n]=m-y,f!==o&&(b=h*l-d*u,u=h*u+d*l,l=b)}},g.prototype.guessLen13b=function(e,t){var i=1|Math.max(t,e),s=1&i,r=0;for(i=i/2|0;i;i>>>=1)r++;return 1<<r+1+s},g.prototype.conjugate=function(e,t,i){if(!(i<=1))for(var s=0;s<i/2;s++){var r=e[s];e[s]=e[i-s-1],e[i-s-1]=r,r=t[s],t[s]=-t[i-s-1],t[i-s-1]=-r}},g.prototype.normalize13b=function(e,t){for(var i=0,s=0;s<t/2;s++){var r=8192*Math.round(e[2*s+1]/t)+Math.round(e[2*s]/t)+i;e[s]=67108863&r,i=r<67108864?0:r/67108864|0}return e},g.prototype.convert13b=function(e,t,i,r){for(var a=0,n=0;n<t;n++)a+=0|e[n],i[2*n]=8191&a,a>>>=13,i[2*n+1]=8191&a,a>>>=13;for(n=2*t;n<r;++n)i[n]=0;s(0===a),s(0==(-8192&a))},g.prototype.stub=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=0;return t},g.prototype.mulp=function(e,t,i){var s=2*this.guessLen13b(e.length,t.length),r=this.makeRBT(s),a=this.stub(s),n=new Array(s),o=new Array(s),h=new Array(s),d=new Array(s),c=new Array(s),l=new Array(s),u=i.words;u.length=s,this.convert13b(e.words,e.length,n,s),this.convert13b(t.words,t.length,d,s),this.transform(n,a,o,h,s,r),this.transform(d,a,c,l,s,r);for(var f=0;f<s;f++){var p=o[f]*c[f]-h[f]*l[f];h[f]=o[f]*l[f]+h[f]*c[f],o[f]=p}return this.conjugate(o,h,s),this.transform(o,h,u,a,s,r),this.conjugate(u,a,s),this.normalize13b(u,s),i.negative=e.negative^t.negative,i.length=e.length+t.length,i.strip()},a.prototype.mul=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},a.prototype.mulf=function(e){var t=new a(null);return t.words=new Array(this.length+e.length),m(this,e,t)},a.prototype.imul=function(e){return this.clone().mulTo(e,this)},a.prototype.imuln=function(e){s("number"==typeof e),s(e<67108864);for(var t=0,i=0;i<this.length;i++){var r=(0|this.words[i])*e,a=(67108863&r)+(67108863&t);t>>=26,t+=r/67108864|0,t+=a>>>26,this.words[i]=67108863&a}return 0!==t&&(this.words[i]=t,this.length++),this},a.prototype.muln=function(e){return this.clone().imuln(e)},a.prototype.sqr=function(){return this.mul(this)},a.prototype.isqr=function(){return this.imul(this.clone())},a.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),i=0;i<t.length;i++){var s=i/26|0,r=i%26;t[i]=(e.words[s]&1<<r)>>>r}return t}(e);if(0===t.length)return new a(1);for(var i=this,s=0;s<t.length&&0===t[s];s++,i=i.sqr());if(++s<t.length)for(var r=i.sqr();s<t.length;s++,r=r.sqr())0!==t[s]&&(i=i.mul(r));return i},a.prototype.iushln=function(e){s("number"==typeof e&&e>=0);var t,i=e%26,r=(e-i)/26,a=67108863>>>26-i<<26-i;if(0!==i){var n=0;for(t=0;t<this.length;t++){var o=this.words[t]&a,h=(0|this.words[t])-o<<i;this.words[t]=h|n,n=o>>>26-i}n&&(this.words[t]=n,this.length++)}if(0!==r){for(t=this.length-1;t>=0;t--)this.words[t+r]=this.words[t];for(t=0;t<r;t++)this.words[t]=0;this.length+=r}return this.strip()},a.prototype.ishln=function(e){return s(0===this.negative),this.iushln(e)},a.prototype.iushrn=function(e,t,i){var r;s("number"==typeof e&&e>=0),r=t?(t-t%26)/26:0;var a=e%26,n=Math.min((e-a)/26,this.length),o=67108863^67108863>>>a<<a,h=i;if(r-=n,r=Math.max(0,r),h){for(var d=0;d<n;d++)h.words[d]=this.words[d];h.length=n}if(0===n);else if(this.length>n)for(this.length-=n,d=0;d<this.length;d++)this.words[d]=this.words[d+n];else this.words[0]=0,this.length=1;var c=0;for(d=this.length-1;d>=0&&(0!==c||d>=r);d--){var l=0|this.words[d];this.words[d]=c<<26-a|l>>>a,c=l&o}return h&&0!==c&&(h.words[h.length++]=c),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},a.prototype.ishrn=function(e,t,i){return s(0===this.negative),this.iushrn(e,t,i)},a.prototype.shln=function(e){return this.clone().ishln(e)},a.prototype.ushln=function(e){return this.clone().iushln(e)},a.prototype.shrn=function(e){return this.clone().ishrn(e)},a.prototype.ushrn=function(e){return this.clone().iushrn(e)},a.prototype.testn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26,r=1<<t;return!(this.length<=i)&&!!(this.words[i]&r)},a.prototype.imaskn=function(e){s("number"==typeof e&&e>=0);var t=e%26,i=(e-t)/26;if(s(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var r=67108863^67108863>>>t<<t;this.words[this.length-1]&=r}return this.strip()},a.prototype.maskn=function(e){return this.clone().imaskn(e)},a.prototype.iaddn=function(e){return s("number"==typeof e),s(e<67108864),e<0?this.isubn(-e):0!==this.negative?1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0,this):(this.negative=0,this.isubn(e),this.negative=1,this):this._iaddn(e)},a.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&this.words[t]>=67108864;t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},a.prototype.isubn=function(e){if(s("number"==typeof e),s(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},a.prototype.addn=function(e){return this.clone().iaddn(e)},a.prototype.subn=function(e){return this.clone().isubn(e)},a.prototype.iabs=function(){return this.negative=0,this},a.prototype.abs=function(){return this.clone().iabs()},a.prototype._ishlnsubmul=function(e,t,i){var r,a,n=e.length+i;this._expand(n);var o=0;for(r=0;r<e.length;r++){a=(0|this.words[r+i])+o;var h=(0|e.words[r])*t;o=((a-=67108863&h)>>26)-(h/67108864|0),this.words[r+i]=67108863&a}for(;r<this.length-i;r++)o=(a=(0|this.words[r+i])+o)>>26,this.words[r+i]=67108863&a;if(0===o)return this.strip();for(s(-1===o),o=0,r=0;r<this.length;r++)o=(a=-(0|this.words[r])+o)>>26,this.words[r]=67108863&a;return this.negative=1,this.strip()},a.prototype._wordDiv=function(e,t){var i=(this.length,e.length),s=this.clone(),r=e,n=0|r.words[r.length-1];0!==(i=26-this._countBits(n))&&(r=r.ushln(i),s.iushln(i),n=0|r.words[r.length-1]);var o,h=s.length-r.length;if("mod"!==t){(o=new a(null)).length=h+1,o.words=new Array(o.length);for(var d=0;d<o.length;d++)o.words[d]=0}var c=s.clone()._ishlnsubmul(r,1,h);0===c.negative&&(s=c,o&&(o.words[h]=1));for(var l=h-1;l>=0;l--){var u=67108864*(0|s.words[r.length+l])+(0|s.words[r.length+l-1]);for(u=Math.min(u/n|0,67108863),s._ishlnsubmul(r,u,l);0!==s.negative;)u--,s.negative=0,s._ishlnsubmul(r,1,l),s.isZero()||(s.negative^=1);o&&(o.words[l]=u)}return o&&o.strip(),s.strip(),"div"!==t&&0!==i&&s.iushrn(i),{div:o||null,mod:s}},a.prototype.divmod=function(e,t,i){return s(!e.isZero()),this.isZero()?{div:new a(0),mod:new a(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(r=o.div.neg()),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.iadd(e)),{div:r,mod:n}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(r=o.div.neg()),{div:r,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(n=o.mod.neg(),i&&0!==n.negative&&n.isub(e)),{div:o.div,mod:n}):e.length>this.length||this.cmp(e)<0?{div:new a(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new a(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new a(this.modn(e.words[0]))}:this._wordDiv(e,t);var r,n,o},a.prototype.div=function(e){return this.divmod(e,"div",!1).div},a.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},a.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},a.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var i=0!==t.div.negative?t.mod.isub(e):t.mod,s=e.ushrn(1),r=e.andln(1),a=i.cmp(s);return a<0||1===r&&0===a?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},a.prototype.modn=function(e){s(e<=67108863);for(var t=(1<<26)%e,i=0,r=this.length-1;r>=0;r--)i=(t*i+(0|this.words[r]))%e;return i},a.prototype.idivn=function(e){s(e<=67108863);for(var t=0,i=this.length-1;i>=0;i--){var r=(0|this.words[i])+67108864*t;this.words[i]=r/e|0,t=r%e}return this.strip()},a.prototype.divn=function(e){return this.clone().idivn(e)},a.prototype.egcd=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r=new a(1),n=new a(0),o=new a(0),h=new a(1),d=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++d;for(var c=i.clone(),l=t.clone();!t.isZero();){for(var u=0,f=1;0==(t.words[0]&f)&&u<26;++u,f<<=1);if(u>0)for(t.iushrn(u);u-- >0;)(r.isOdd()||n.isOdd())&&(r.iadd(c),n.isub(l)),r.iushrn(1),n.iushrn(1);for(var p=0,m=1;0==(i.words[0]&m)&&p<26;++p,m<<=1);if(p>0)for(i.iushrn(p);p-- >0;)(o.isOdd()||h.isOdd())&&(o.iadd(c),h.isub(l)),o.iushrn(1),h.iushrn(1);t.cmp(i)>=0?(t.isub(i),r.isub(o),n.isub(h)):(i.isub(t),o.isub(r),h.isub(n))}return{a:o,b:h,gcd:i.iushln(d)}},a.prototype._invmp=function(e){s(0===e.negative),s(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var r,n=new a(1),o=new a(0),h=i.clone();t.cmpn(1)>0&&i.cmpn(1)>0;){for(var d=0,c=1;0==(t.words[0]&c)&&d<26;++d,c<<=1);if(d>0)for(t.iushrn(d);d-- >0;)n.isOdd()&&n.iadd(h),n.iushrn(1);for(var l=0,u=1;0==(i.words[0]&u)&&l<26;++l,u<<=1);if(l>0)for(i.iushrn(l);l-- >0;)o.isOdd()&&o.iadd(h),o.iushrn(1);t.cmp(i)>=0?(t.isub(i),n.isub(o)):(i.isub(t),o.isub(n))}return(r=0===t.cmpn(1)?n:o).cmpn(0)<0&&r.iadd(e),r},a.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),i=e.clone();t.negative=0,i.negative=0;for(var s=0;t.isEven()&&i.isEven();s++)t.iushrn(1),i.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;i.isEven();)i.iushrn(1);var r=t.cmp(i);if(r<0){var a=t;t=i,i=a}else if(0===r||0===i.cmpn(1))break;t.isub(i)}return i.iushln(s)},a.prototype.invm=function(e){return this.egcd(e).a.umod(e)},a.prototype.isEven=function(){return 0==(1&this.words[0])},a.prototype.isOdd=function(){return 1==(1&this.words[0])},a.prototype.andln=function(e){return this.words[0]&e},a.prototype.bincn=function(e){s("number"==typeof e);var t=e%26,i=(e-t)/26,r=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=r,this;for(var a=r,n=i;0!==a&&n<this.length;n++){var o=0|this.words[n];a=(o+=a)>>>26,o&=67108863,this.words[n]=o}return 0!==a&&(this.words[n]=a,this.length++),this},a.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},a.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),this.length>1)t=1;else{i&&(e=-e),s(e<=67108863,"Number is too big");var r=0|this.words[0];t=r===e?0:r<e?-1:1}return 0!==this.negative?0|-t:t},a.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},a.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,i=this.length-1;i>=0;i--){var s=0|this.words[i],r=0|e.words[i];if(s!==r){s<r?t=-1:s>r&&(t=1);break}}return t},a.prototype.gtn=function(e){return 1===this.cmpn(e)},a.prototype.gt=function(e){return 1===this.cmp(e)},a.prototype.gten=function(e){return this.cmpn(e)>=0},a.prototype.gte=function(e){return this.cmp(e)>=0},a.prototype.ltn=function(e){return-1===this.cmpn(e)},a.prototype.lt=function(e){return-1===this.cmp(e)},a.prototype.lten=function(e){return this.cmpn(e)<=0},a.prototype.lte=function(e){return this.cmp(e)<=0},a.prototype.eqn=function(e){return 0===this.cmpn(e)},a.prototype.eq=function(e){return 0===this.cmp(e)},a.red=function(e){return new T(e)},a.prototype.toRed=function(e){return s(!this.red,"Already a number in reduction context"),s(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},a.prototype.fromRed=function(){return s(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},a.prototype._forceRed=function(e){return this.red=e,this},a.prototype.forceRed=function(e){return s(!this.red,"Already a number in reduction context"),this._forceRed(e)},a.prototype.redAdd=function(e){return s(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},a.prototype.redIAdd=function(e){return s(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},a.prototype.redSub=function(e){return s(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},a.prototype.redISub=function(e){return s(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},a.prototype.redShl=function(e){return s(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},a.prototype.redMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},a.prototype.redIMul=function(e){return s(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},a.prototype.redSqr=function(){return s(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},a.prototype.redISqr=function(){return s(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},a.prototype.redSqrt=function(){return s(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},a.prototype.redInvm=function(){return s(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},a.prototype.redNeg=function(){return s(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},a.prototype.redPow=function(e){return s(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var y={k256:null,p224:null,p192:null,p25519:null};function b(e,t){this.name=e,this.p=new a(t,16),this.n=this.p.bitLength(),this.k=new a(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function v(){b.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function w(){b.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function S(){b.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function k(){b.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function T(e){if("string"==typeof e){var t=a._prime(e);this.m=t.p,this.prime=t}else s(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function _(e){T.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new a(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}b.prototype._tmp=function(){var e=new a(null);return e.words=new Array(Math.ceil(this.n/13)),e},b.prototype.ireduce=function(e){var t,i=e;do{this.split(i,this.tmp),t=(i=(i=this.imulK(i)).iadd(this.tmp)).bitLength()}while(t>this.n);var s=t<this.n?-1:i.ucmp(this.p);return 0===s?(i.words[0]=0,i.length=1):s>0?i.isub(this.p):void 0!==i.strip?i.strip():i._strip(),i},b.prototype.split=function(e,t){e.iushrn(this.n,0,t)},b.prototype.imulK=function(e){return e.imul(this.k)},r(v,b),v.prototype.split=function(e,t){for(var i=4194303,s=Math.min(e.length,9),r=0;r<s;r++)t.words[r]=e.words[r];if(t.length=s,e.length<=9)return e.words[0]=0,void(e.length=1);var a=e.words[9];for(t.words[t.length++]=a&i,r=10;r<e.length;r++){var n=0|e.words[r];e.words[r-10]=(n&i)<<4|a>>>22,a=n}a>>>=22,e.words[r-10]=a,0===a&&e.length>10?e.length-=10:e.length-=9},v.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,i=0;i<e.length;i++){var s=0|e.words[i];t+=977*s,e.words[i]=67108863&t,t=64*s+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},r(w,b),r(S,b),r(k,b),k.prototype.imulK=function(e){for(var t=0,i=0;i<e.length;i++){var s=19*(0|e.words[i])+t,r=67108863&s;s>>>=26,e.words[i]=r,t=s}return 0!==t&&(e.words[e.length++]=t),e},a._prime=function(e){if(y[e])return y[e];var t;if("k256"===e)t=new v;else if("p224"===e)t=new w;else if("p192"===e)t=new S;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new k}return y[e]=t,t},T.prototype._verify1=function(e){s(0===e.negative,"red works only with positives"),s(e.red,"red works only with red numbers")},T.prototype._verify2=function(e,t){s(0==(e.negative|t.negative),"red works only with positives"),s(e.red&&e.red===t.red,"red works only with red numbers")},T.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},T.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},T.prototype.add=function(e,t){this._verify2(e,t);var i=e.add(t);return i.cmp(this.m)>=0&&i.isub(this.m),i._forceRed(this)},T.prototype.iadd=function(e,t){this._verify2(e,t);var i=e.iadd(t);return i.cmp(this.m)>=0&&i.isub(this.m),i},T.prototype.sub=function(e,t){this._verify2(e,t);var i=e.sub(t);return i.cmpn(0)<0&&i.iadd(this.m),i._forceRed(this)},T.prototype.isub=function(e,t){this._verify2(e,t);var i=e.isub(t);return i.cmpn(0)<0&&i.iadd(this.m),i},T.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},T.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},T.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},T.prototype.isqr=function(e){return this.imul(e,e.clone())},T.prototype.sqr=function(e){return this.mul(e,e)},T.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(s(t%2==1),3===t){var i=this.m.add(new a(1)).iushrn(2);return this.pow(e,i)}for(var r=this.m.subn(1),n=0;!r.isZero()&&0===r.andln(1);)n++,r.iushrn(1);s(!r.isZero());var o=new a(1).toRed(this),h=o.redNeg(),d=this.m.subn(1).iushrn(1),c=this.m.bitLength();for(c=new a(2*c*c).toRed(this);0!==this.pow(c,d).cmp(h);)c.redIAdd(h);for(var l=this.pow(c,r),u=this.pow(e,r.addn(1).iushrn(1)),f=this.pow(e,r),p=n;0!==f.cmp(o);){for(var m=f,g=0;0!==m.cmp(o);g++)m=m.redSqr();s(g<p);var y=this.pow(l,new a(1).iushln(p-g-1));u=u.redMul(y),l=y.redSqr(),f=f.redMul(l),p=g}return u},T.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},T.prototype.pow=function(e,t){if(t.isZero())return new a(1).toRed(this);if(0===t.cmpn(1))return e.clone();var i=new Array(16);i[0]=new a(1).toRed(this),i[1]=e;for(var s=2;s<i.length;s++)i[s]=this.mul(i[s-1],e);var r=i[0],n=0,o=0,h=t.bitLength()%26;for(0===h&&(h=26),s=t.length-1;s>=0;s--){for(var d=t.words[s],c=h-1;c>=0;c--){var l=d>>c&1;r!==i[0]&&(r=this.sqr(r)),0!==l||0!==n?(n<<=1,n|=l,(4===++o||0===s&&0===c)&&(r=this.mul(r,i[n]),o=0,n=0)):o=0}h=26}return r},T.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},T.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},a.mont=function(e){return new _(e)},r(_,T),_.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},_.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},_.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var i=e.imul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),a=r;return r.cmp(this.m)>=0?a=r.isub(this.m):r.cmpn(0)<0&&(a=r.iadd(this.m)),a._forceRed(this)},_.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new a(0)._forceRed(this);var i=e.mul(t),s=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),r=i.isub(s).iushrn(this.shift),n=r;return r.cmp(this.m)>=0?n=r.isub(this.m):r.cmpn(0)<0&&(n=r.iadd(this.m)),n._forceRed(this)},_.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e=i.nmd(e),this)},26138:function(e,t,i){var s=i(70980),r=i(99199),a=i(57859),n=i(92144),o=i(23663),h=i(23482),d=i(84818),c=i(89509).Buffer;e.exports=function(e,t,i){var l;l=e.padding?e.padding:i?1:4;var u,f=s(e),p=f.modulus.byteLength();if(t.length>p||new n(t).cmp(f.modulus)>=0)throw new Error("decryption error");u=i?d(new n(t),f):o(t,f);var m=c.alloc(p-u.length);if(u=c.concat([m,u],p),4===l)return function(e,t){var i=e.modulus.byteLength(),s=h("sha1").update(c.alloc(0)).digest(),n=s.length;if(0!==t[0])throw new Error("decryption error");var o=t.slice(1,n+1),d=t.slice(n+1),l=a(o,r(d,n)),u=a(d,r(l,i-n-1));if(function(e,t){e=c.from(e),t=c.from(t);var i=0,s=e.length;e.length!==t.length&&(i++,s=Math.min(e.length,t.length));var r=-1;for(;++r<s;)i+=e[r]^t[r];return i}(s,u.slice(0,n)))throw new Error("decryption error");var f=n;for(;0===u[f];)f++;if(1!==u[f++])throw new Error("decryption error");return u.slice(f)}(f,u);if(1===l)return function(e,t,i){var s=t.slice(0,2),r=2,a=0;for(;0!==t[r++];)if(r>=t.length){a++;break}var n=t.slice(2,r-1);("0002"!==s.toString("hex")&&!i||"0001"!==s.toString("hex")&&i)&&a++;n.length<8&&a++;if(a)throw new Error("decryption error");return t.slice(r)}(0,u,i);if(3===l)return u;throw new Error("unknown padding")}},16559:function(e,t,i){var s=i(70980),r=i(61798),a=i(23482),n=i(99199),o=i(57859),h=i(92144),d=i(84818),c=i(23663),l=i(89509).Buffer;e.exports=function(e,t,i){var u;u=e.padding?e.padding:i?1:4;var f,p=s(e);if(4===u)f=function(e,t){var i=e.modulus.byteLength(),s=t.length,d=a("sha1").update(l.alloc(0)).digest(),c=d.length,u=2*c;if(s>i-u-2)throw new Error("message too long");var f=l.alloc(i-s-u-2),p=i-c-1,m=r(c),g=o(l.concat([d,f,l.alloc(1,1),t],p),n(m,p)),y=o(m,n(g,c));return new h(l.concat([l.alloc(1),y,g],i))}(p,t);else if(1===u)f=function(e,t,i){var s,a=t.length,n=e.modulus.byteLength();if(a>n-11)throw new Error("message too long");s=i?l.alloc(n-a-3,255):function(e){var t,i=l.allocUnsafe(e),s=0,a=r(2*e),n=0;for(;s<e;)n===a.length&&(a=r(2*e),n=0),(t=a[n++])&&(i[s++]=t);return i}(n-a-3);return new h(l.concat([l.from([0,i?1:2]),s,l.alloc(1),t],n))}(p,t,i);else{if(3!==u)throw new Error("unknown padding");if((f=new h(t)).cmp(p.modulus)>=0)throw new Error("data too long for modulus")}return i?c(f,p):d(f,p)}},84818:function(e,t,i){var s=i(92144),r=i(89509).Buffer;e.exports=function(e,t){return r.from(e.toRed(s.mont(t.modulus)).redPow(new s(t.publicExponent)).fromRed().toArray())}},57859:function(e){e.exports=function(e,t){for(var i=e.length,s=-1;++s<i;)e[s]^=t[s];return e}},62587:function(e){"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,i,s,r){i=i||"&",s=s||"=";var a={};if("string"!=typeof e||0===e.length)return a;var n=/\+/g;e=e.split(i);var o=1e3;r&&"number"==typeof r.maxKeys&&(o=r.maxKeys);var h=e.length;o>0&&h>o&&(h=o);for(var d=0;d<h;++d){var c,l,u,f,p=e[d].replace(n,"%20"),m=p.indexOf(s);m>=0?(c=p.substr(0,m),l=p.substr(m+1)):(c=p,l=""),u=decodeURIComponent(c),f=decodeURIComponent(l),t(a,u)?Array.isArray(a[u])?a[u].push(f):a[u]=[a[u],f]:a[u]=f}return a}},12361:function(e){"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,i,s,r){return i=i||"&",s=s||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(r){var a=encodeURIComponent(t(r))+s;return Array.isArray(e[r])?e[r].map((function(e){return a+encodeURIComponent(t(e))})).join(i):a+encodeURIComponent(t(e[r]))})).join(i):r?encodeURIComponent(t(r))+s+encodeURIComponent(t(e)):""}},17673:function(e,t,i){"use strict";t.decode=t.parse=i(62587),t.encode=t.stringify=i(12361)},61798:function(e,t,i){"use strict";var s=i(34155),r=65536,a=4294967295;var n=i(89509).Buffer,o=i.g.crypto||i.g.msCrypto;o&&o.getRandomValues?e.exports=function(e,t){if(e>a)throw new RangeError("requested too many random bytes");var i=n.allocUnsafe(e);if(e>0)if(e>r)for(var h=0;h<e;h+=r)o.getRandomValues(i.slice(h,h+r));else o.getRandomValues(i);if("function"==typeof t)return s.nextTick((function(){t(null,i)}));return i}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}},77963:function(e,t,i){"use strict";var s=i(34155);function r(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}var a=i(89509),n=i(61798),o=a.Buffer,h=a.kMaxLength,d=i.g.crypto||i.g.msCrypto,c=Math.pow(2,32)-1;function l(e,t){if("number"!=typeof e||e!=e)throw new TypeError("offset must be a number");if(e>c||e<0)throw new TypeError("offset must be a uint32");if(e>h||e>t)throw new RangeError("offset out of range")}function u(e,t,i){if("number"!=typeof e||e!=e)throw new TypeError("size must be a number");if(e>c||e<0)throw new TypeError("size must be a uint32");if(e+t>i||e>h)throw new RangeError("buffer too small")}function f(e,t,i,r){if(s.browser){var a=e.buffer,o=new Uint8Array(a,t,i);return d.getRandomValues(o),r?void s.nextTick((function(){r(null,e)})):e}if(!r)return n(i).copy(e,t),e;n(i,(function(i,s){if(i)return r(i);s.copy(e,t),r(null,e)}))}d&&d.getRandomValues||!s.browser?(t.randomFill=function(e,t,s,r){if(!(o.isBuffer(e)||e instanceof i.g.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if("function"==typeof t)r=t,t=0,s=e.length;else if("function"==typeof s)r=s,s=e.length-t;else if("function"!=typeof r)throw new TypeError('"cb" argument must be a function');return l(t,e.length),u(s,t,e.length),f(e,t,s,r)},t.randomFillSync=function(e,t,s){void 0===t&&(t=0);if(!(o.isBuffer(e)||e instanceof i.g.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');l(t,e.length),void 0===s&&(s=e.length-t);return u(s,t,e.length),f(e,t,s)}):(t.randomFill=r,t.randomFillSync=r)},6983:function(e,t){"use strict";t.J=void 0;t.J=(e={})=>{if("undefined"==typeof window)return{persistAtom:()=>{}};const{key:t="recoil-persist",storage:i=localStorage}=e,s=(e,t,i,s)=>{s?delete t[i]:t[i]=e,n(t)},r=()=>{const e=i.getItem(t);return null==e?{}:"string"==typeof e?a(e):"function"==typeof e.then?e.then(a):{}},a=e=>{if(void 0===e)return{};try{return JSON.parse(e)}catch(e){return console.error(e),{}}},n=e=>{try{"function"==typeof i.mergeItem?i.mergeItem(t,JSON.stringify(e)):i.setItem(t,JSON.stringify(e))}catch(e){console.error(e)}};return{persistAtom:({onSet:e,node:t,trigger:i,setSelf:a})=>{if("get"===i){const e=r();"function"==typeof e.then&&e.then((e=>{e.hasOwnProperty(t.key)&&a(e[t.key])})),e.hasOwnProperty(t.key)&&a(e[t.key])}e((async(e,i,a)=>{const n=r();"function"==typeof n.then?n.then((i=>s(e,i,t.key,a))):s(e,n,t.key,a)}))}}}},79785:function(e,t,i){"use strict";var s=i(48764).Buffer,r=i(35717),a=i(3349),n=new Array(16),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],h=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],d=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],c=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],l=[0,1518500249,1859775393,2400959708,2840853838],u=[1352829926,1548603684,1836072691,2053994217,0];function f(){a.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}function p(e,t){return e<<t|e>>>32-t}function m(e,t,i,s,r,a,n,o){return p(e+(t^i^s)+a+n|0,o)+r|0}function g(e,t,i,s,r,a,n,o){return p(e+(t&i|~t&s)+a+n|0,o)+r|0}function y(e,t,i,s,r,a,n,o){return p(e+((t|~i)^s)+a+n|0,o)+r|0}function b(e,t,i,s,r,a,n,o){return p(e+(t&s|i&~s)+a+n|0,o)+r|0}function v(e,t,i,s,r,a,n,o){return p(e+(t^(i|~s))+a+n|0,o)+r|0}r(f,a),f.prototype._update=function(){for(var e=n,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);for(var i=0|this._a,s=0|this._b,r=0|this._c,a=0|this._d,f=0|this._e,w=0|this._a,S=0|this._b,k=0|this._c,T=0|this._d,_=0|this._e,O=0;O<80;O+=1){var M,I;O<16?(M=m(i,s,r,a,f,e[o[O]],l[0],d[O]),I=v(w,S,k,T,_,e[h[O]],u[0],c[O])):O<32?(M=g(i,s,r,a,f,e[o[O]],l[1],d[O]),I=b(w,S,k,T,_,e[h[O]],u[1],c[O])):O<48?(M=y(i,s,r,a,f,e[o[O]],l[2],d[O]),I=y(w,S,k,T,_,e[h[O]],u[2],c[O])):O<64?(M=b(i,s,r,a,f,e[o[O]],l[3],d[O]),I=g(w,S,k,T,_,e[h[O]],u[3],c[O])):(M=v(i,s,r,a,f,e[o[O]],l[4],d[O]),I=m(w,S,k,T,_,e[h[O]],u[4],c[O])),i=f,f=a,a=p(r,10),r=s,s=M,w=_,_=T,T=p(k,10),k=S,S=I}var x=this._b+r+T|0;this._b=this._c+a+_|0,this._c=this._d+f+w|0,this._d=this._e+i+S|0,this._e=this._a+s+k|0,this._a=x},f.prototype._digest=function(){this._block[this._blockOffset++]=128,this._blockOffset>56&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=s.alloc?s.alloc(20):new s(20);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e.writeInt32LE(this._e,16),e},e.exports=f},89509:function(e,t,i){var s=i(48764),r=s.Buffer;function a(e,t){for(var i in e)t[i]=e[i]}function n(e,t,i){return r(e,t,i)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=s:(a(s,t),t.Buffer=n),n.prototype=Object.create(r.prototype),a(r,n),n.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,i)},n.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");var s=r(e);return void 0!==t?"string"==typeof i?s.fill(t,i):s.fill(t):s.fill(0),s},n.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},n.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return s.SlowBuffer(e)}},2399:function(e,t,i){"use strict";var s,r=i(34155),a=i(48764),n=a.Buffer,o={};for(s in a)a.hasOwnProperty(s)&&"SlowBuffer"!==s&&"Buffer"!==s&&(o[s]=a[s]);var h=o.Buffer={};for(s in n)n.hasOwnProperty(s)&&"allocUnsafe"!==s&&"allocUnsafeSlow"!==s&&(h[s]=n[s]);if(o.Buffer.prototype=n.prototype,h.from&&h.from!==Uint8Array.from||(h.from=function(e,t,i){if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type '+typeof e);if(e&&void 0===e.length)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);return n(e,t,i)}),h.alloc||(h.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError('The "size" argument must be of type number. Received type '+typeof e);if(e<0||e>=2*(1<<30))throw new RangeError('The value "'+e+'" is invalid for option "size"');var s=n(e);return t&&0!==t.length?"string"==typeof i?s.fill(t,i):s.fill(t):s.fill(0),s}),!o.kStringMaxLength)try{o.kStringMaxLength=r.binding("buffer").kStringMaxLength}catch(e){}o.constants||(o.constants={MAX_LENGTH:o.kMaxLength},o.kStringMaxLength&&(o.constants.MAX_STRING_LENGTH=o.kStringMaxLength)),e.exports=o},24189:function(e,t,i){var s=i(89509).Buffer;function r(e,t){this._block=s.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}r.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=s.from(e,t));for(var i=this._block,r=this._blockSize,a=e.length,n=this._len,o=0;o<a;){for(var h=n%r,d=Math.min(a-o,r-h),c=0;c<d;c++)i[h+c]=e[o+c];o+=d,(n+=d)%r==0&&this._update(i)}return this._len+=a,this},r.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var i=8*this._len;if(i<=4294967295)this._block.writeUInt32BE(i,this._blockSize-4);else{var s=(4294967295&i)>>>0,r=(i-s)/4294967296;this._block.writeUInt32BE(r,this._blockSize-8),this._block.writeUInt32BE(s,this._blockSize-4)}this._update(this._block);var a=this._hash();return e?a.toString(e):a},r.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=r},89072:function(e,t,i){var s=e.exports=function(e){e=e.toLowerCase();var t=s[e];if(!t)throw new Error(e+" is not supported (we accept pull requests)");return new t};s.sha=i(74448),s.sha1=i(18336),s.sha224=i(48432),s.sha256=i(67499),s.sha384=i(51686),s.sha512=i(87816)},74448:function(e,t,i){var s=i(35717),r=i(24189),a=i(89509).Buffer,n=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function h(){this.init(),this._w=o,r.call(this,64,56)}function d(e){return e<<30|e>>>2}function c(e,t,i,s){return 0===e?t&i|~t&s:2===e?t&i|t&s|i&s:t^i^s}s(h,r),h.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},h.prototype._update=function(e){for(var t,i=this._w,s=0|this._a,r=0|this._b,a=0|this._c,o=0|this._d,h=0|this._e,l=0;l<16;++l)i[l]=e.readInt32BE(4*l);for(;l<80;++l)i[l]=i[l-3]^i[l-8]^i[l-14]^i[l-16];for(var u=0;u<80;++u){var f=~~(u/20),p=0|((t=s)<<5|t>>>27)+c(f,r,a,o)+h+i[u]+n[f];h=o,o=a,a=d(r),r=s,s=p}this._a=s+this._a|0,this._b=r+this._b|0,this._c=a+this._c|0,this._d=o+this._d|0,this._e=h+this._e|0},h.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=h},18336:function(e,t,i){var s=i(35717),r=i(24189),a=i(89509).Buffer,n=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function h(){this.init(),this._w=o,r.call(this,64,56)}function d(e){return e<<5|e>>>27}function c(e){return e<<30|e>>>2}function l(e,t,i,s){return 0===e?t&i|~t&s:2===e?t&i|t&s|i&s:t^i^s}s(h,r),h.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},h.prototype._update=function(e){for(var t,i=this._w,s=0|this._a,r=0|this._b,a=0|this._c,o=0|this._d,h=0|this._e,u=0;u<16;++u)i[u]=e.readInt32BE(4*u);for(;u<80;++u)i[u]=(t=i[u-3]^i[u-8]^i[u-14]^i[u-16])<<1|t>>>31;for(var f=0;f<80;++f){var p=~~(f/20),m=d(s)+l(p,r,a,o)+h+i[f]+n[p]|0;h=o,o=a,a=c(r),r=s,s=m}this._a=s+this._a|0,this._b=r+this._b|0,this._c=a+this._c|0,this._d=o+this._d|0,this._e=h+this._e|0},h.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=h},48432:function(e,t,i){var s=i(35717),r=i(67499),a=i(24189),n=i(89509).Buffer,o=new Array(64);function h(){this.init(),this._w=o,a.call(this,64,56)}s(h,r),h.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},h.prototype._hash=function(){var e=n.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=h},67499:function(e,t,i){var s=i(35717),r=i(24189),a=i(89509).Buffer,n=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=new Array(64);function h(){this.init(),this._w=o,r.call(this,64,56)}function d(e,t,i){return i^e&(t^i)}function c(e,t,i){return e&t|i&(e|t)}function l(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function u(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function f(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}s(h,r),h.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},h.prototype._update=function(e){for(var t,i=this._w,s=0|this._a,r=0|this._b,a=0|this._c,o=0|this._d,h=0|this._e,p=0|this._f,m=0|this._g,g=0|this._h,y=0;y<16;++y)i[y]=e.readInt32BE(4*y);for(;y<64;++y)i[y]=0|(((t=i[y-2])>>>17|t<<15)^(t>>>19|t<<13)^t>>>10)+i[y-7]+f(i[y-15])+i[y-16];for(var b=0;b<64;++b){var v=g+u(h)+d(h,p,m)+n[b]+i[b]|0,w=l(s)+c(s,r,a)|0;g=m,m=p,p=h,h=o+v|0,o=a,a=r,r=s,s=v+w|0}this._a=s+this._a|0,this._b=r+this._b|0,this._c=a+this._c|0,this._d=o+this._d|0,this._e=h+this._e|0,this._f=p+this._f|0,this._g=m+this._g|0,this._h=g+this._h|0},h.prototype._hash=function(){var e=a.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=h},51686:function(e,t,i){var s=i(35717),r=i(87816),a=i(24189),n=i(89509).Buffer,o=new Array(160);function h(){this.init(),this._w=o,a.call(this,128,112)}s(h,r),h.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},h.prototype._hash=function(){var e=n.allocUnsafe(48);function t(t,i,s){e.writeInt32BE(t,s),e.writeInt32BE(i,s+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=h},87816:function(e,t,i){var s=i(35717),r=i(24189),a=i(89509).Buffer,n=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],o=new Array(160);function h(){this.init(),this._w=o,r.call(this,128,112)}function d(e,t,i){return i^e&(t^i)}function c(e,t,i){return e&t|i&(e|t)}function l(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function u(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function f(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function p(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function m(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function g(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function y(e,t){return e>>>0<t>>>0?1:0}s(h,r),h.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},h.prototype._update=function(e){for(var t=this._w,i=0|this._ah,s=0|this._bh,r=0|this._ch,a=0|this._dh,o=0|this._eh,h=0|this._fh,b=0|this._gh,v=0|this._hh,w=0|this._al,S=0|this._bl,k=0|this._cl,T=0|this._dl,_=0|this._el,O=0|this._fl,M=0|this._gl,I=0|this._hl,x=0;x<32;x+=2)t[x]=e.readInt32BE(4*x),t[x+1]=e.readInt32BE(4*x+4);for(;x<160;x+=2){var C=t[x-30],P=t[x-30+1],A=f(C,P),N=p(P,C),B=m(C=t[x-4],P=t[x-4+1]),E=g(P,C),V=t[x-14],L=t[x-14+1],R=t[x-32],D=t[x-32+1],F=N+L|0,q=A+V+y(F,N)|0;q=(q=q+B+y(F=F+E|0,E)|0)+R+y(F=F+D|0,D)|0,t[x]=q,t[x+1]=F}for(var G=0;G<160;G+=2){q=t[G],F=t[G+1];var H=c(i,s,r),U=c(w,S,k),j=l(i,w),W=l(w,i),z=u(o,_),K=u(_,o),X=n[G],Z=n[G+1],Y=d(o,h,b),Q=d(_,O,M),J=I+K|0,$=v+z+y(J,I)|0;$=($=($=$+Y+y(J=J+Q|0,Q)|0)+X+y(J=J+Z|0,Z)|0)+q+y(J=J+F|0,F)|0;var ee=W+U|0,te=j+H+y(ee,W)|0;v=b,I=M,b=h,M=O,h=o,O=_,o=a+$+y(_=T+J|0,T)|0,a=r,T=k,r=s,k=S,s=i,S=w,i=$+te+y(w=J+ee|0,J)|0}this._al=this._al+w|0,this._bl=this._bl+S|0,this._cl=this._cl+k|0,this._dl=this._dl+T|0,this._el=this._el+_|0,this._fl=this._fl+O|0,this._gl=this._gl+M|0,this._hl=this._hl+I|0,this._ah=this._ah+i+y(this._al,w)|0,this._bh=this._bh+s+y(this._bl,S)|0,this._ch=this._ch+r+y(this._cl,k)|0,this._dh=this._dh+a+y(this._dl,T)|0,this._eh=this._eh+o+y(this._el,_)|0,this._fh=this._fh+h+y(this._fl,O)|0,this._gh=this._gh+b+y(this._gl,M)|0,this._hh=this._hh+v+y(this._hl,I)|0},h.prototype._hash=function(){var e=a.allocUnsafe(64);function t(t,i,s){e.writeInt32BE(t,s),e.writeInt32BE(i,s+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=h},42830:function(e,t,i){e.exports=r;var s=i(17187).EventEmitter;function r(){s.call(this)}i(35717)(r,s),r.Readable=i(42874),r.Writable=i(73098),r.Duplex=i(86649),r.Transform=i(95202),r.PassThrough=i(5990),r.Stream=r,r.prototype.pipe=function(e,t){var i=this;function r(t){e.writable&&!1===e.write(t)&&i.pause&&i.pause()}function a(){i.readable&&i.resume&&i.resume()}i.on("data",r),e.on("drain",a),e._isStdio||t&&!1===t.end||(i.on("end",o),i.on("close",h));var n=!1;function o(){n||(n=!0,e.end())}function h(){n||(n=!0,"function"==typeof e.destroy&&e.destroy())}function d(e){if(c(),0===s.listenerCount(this,"error"))throw e}function c(){i.removeListener("data",r),e.removeListener("drain",a),i.removeListener("end",o),i.removeListener("close",h),i.removeListener("error",d),e.removeListener("error",d),i.removeListener("end",c),i.removeListener("close",c),e.removeListener("close",c)}return i.on("error",d),e.on("error",d),i.on("end",c),i.on("close",c),e.on("close",c),e.emit("pipe",i),e}},74068:function(e){var t={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==t.call(e)}},86649:function(e,t,i){e.exports=i(68656)},68656:function(e,t,i){"use strict";var s=i(88212),r=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t};e.exports=l;var a=Object.create(i(16497));a.inherits=i(35717);var n=i(56577),o=i(20323);a.inherits(l,n);for(var h=r(o.prototype),d=0;d<h.length;d++){var c=h[d];l.prototype[c]||(l.prototype[c]=o.prototype[c])}function l(e){if(!(this instanceof l))return new l(e);n.call(this,e),o.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",u)}function u(){this.allowHalfOpen||this._writableState.ended||s.nextTick(f,this)}function f(e){e.end()}Object.defineProperty(l.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(l.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),l.prototype._destroy=function(e,t){this.push(null),this.end(),s.nextTick(t,e)}},2366:function(e,t,i){"use strict";e.exports=a;var s=i(94473),r=Object.create(i(16497));function a(e){if(!(this instanceof a))return new a(e);s.call(this,e)}r.inherits=i(35717),r.inherits(a,s),a.prototype._transform=function(e,t,i){i(null,e)}},56577:function(e,t,i){"use strict";var s=i(34155),r=i(88212);e.exports=v;var a,n=i(74068);v.ReadableState=b;i(17187).EventEmitter;var o=function(e,t){return e.listeners(t).length},h=i(83194),d=i(56422).Buffer,c=i.g.Uint8Array||function(){};var l=Object.create(i(16497));l.inherits=i(35717);var u=i(40964),f=void 0;f=u&&u.debuglog?u.debuglog("stream"):function(){};var p,m=i(71143),g=i(71029);l.inherits(v,h);var y=["error","close","destroy","pause","resume"];function b(e,t){e=e||{};var s=t instanceof(a=a||i(68656));this.objectMode=!!e.objectMode,s&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var r=e.highWaterMark,n=e.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=r||0===r?r:s&&(n||0===n)?n:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=i(54729).s),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function v(e){if(a=a||i(68656),!(this instanceof v))return new v(e);this._readableState=new b(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),h.call(this)}function w(e,t,i,s,r){var a,n=e._readableState;null===t?(n.reading=!1,function(e,t){if(t.ended)return;if(t.decoder){var i=t.decoder.end();i&&i.length&&(t.buffer.push(i),t.length+=t.objectMode?1:i.length)}t.ended=!0,_(e)}(e,n)):(r||(a=function(e,t){var i;s=t,d.isBuffer(s)||s instanceof c||"string"==typeof t||void 0===t||e.objectMode||(i=new TypeError("Invalid non-string/buffer chunk"));var s;return i}(n,t)),a?e.emit("error",a):n.objectMode||t&&t.length>0?("string"==typeof t||n.objectMode||Object.getPrototypeOf(t)===d.prototype||(t=function(e){return d.from(e)}(t)),s?n.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):S(e,n,t,!0):n.ended?e.emit("error",new Error("stream.push() after EOF")):(n.reading=!1,n.decoder&&!i?(t=n.decoder.write(t),n.objectMode||0!==t.length?S(e,n,t,!1):M(e,n)):S(e,n,t,!1))):s||(n.reading=!1));return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(n)}function S(e,t,i,s){t.flowing&&0===t.length&&!t.sync?(e.emit("data",i),e.read(0)):(t.length+=t.objectMode?1:i.length,s?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&_(e)),M(e,t)}Object.defineProperty(v.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),v.prototype.destroy=g.destroy,v.prototype._undestroy=g.undestroy,v.prototype._destroy=function(e,t){this.push(null),t(e)},v.prototype.push=function(e,t){var i,s=this._readableState;return s.objectMode?i=!0:"string"==typeof e&&((t=t||s.defaultEncoding)!==s.encoding&&(e=d.from(e,t),t=""),i=!0),w(this,e,t,!1,i)},v.prototype.unshift=function(e){return w(this,e,null,!0,!1)},v.prototype.isPaused=function(){return!1===this._readableState.flowing},v.prototype.setEncoding=function(e){return p||(p=i(54729).s),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var k=8388608;function T(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=function(e){return e>=k?e=k:(e--,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,e|=e>>>16,e++),e}(e)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0))}function _(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(f("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?r.nextTick(O,e):O(e))}function O(e){f("emit readable"),e.emit("readable"),P(e)}function M(e,t){t.readingMore||(t.readingMore=!0,r.nextTick(I,e,t))}function I(e,t){for(var i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(f("maybeReadMore read 0"),e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}function x(e){f("readable nexttick read 0"),e.read(0)}function C(e,t){t.reading||(f("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),P(e),t.flowing&&!t.reading&&e.read(0)}function P(e){var t=e._readableState;for(f("flow",t.flowing);t.flowing&&null!==e.read(););}function A(e,t){return 0===t.length?null:(t.objectMode?i=t.buffer.shift():!e||e>=t.length?(i=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):i=function(e,t,i){var s;e<t.head.data.length?(s=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):s=e===t.head.data.length?t.shift():i?function(e,t){var i=t.head,s=1,r=i.data;e-=r.length;for(;i=i.next;){var a=i.data,n=e>a.length?a.length:e;if(n===a.length?r+=a:r+=a.slice(0,e),0===(e-=n)){n===a.length?(++s,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i,i.data=a.slice(n));break}++s}return t.length-=s,r}(e,t):function(e,t){var i=d.allocUnsafe(e),s=t.head,r=1;s.data.copy(i),e-=s.data.length;for(;s=s.next;){var a=s.data,n=e>a.length?a.length:e;if(a.copy(i,i.length-e,0,n),0===(e-=n)){n===a.length?(++r,s.next?t.head=s.next:t.head=t.tail=null):(t.head=s,s.data=a.slice(n));break}++r}return t.length-=r,i}(e,t);return s}(e,t.buffer,t.decoder),i);var i}function N(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,r.nextTick(B,t,e))}function B(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function E(e,t){for(var i=0,s=e.length;i<s;i++)if(e[i]===t)return i;return-1}v.prototype.read=function(e){f("read",e),e=parseInt(e,10);var t=this._readableState,i=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return f("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?N(this):_(this),null;if(0===(e=T(e,t))&&t.ended)return 0===t.length&&N(this),null;var s,r=t.needReadable;return f("need readable",r),(0===t.length||t.length-e<t.highWaterMark)&&f("length less than watermark",r=!0),t.ended||t.reading?f("reading or ended",r=!1):r&&(f("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=T(i,t))),null===(s=e>0?A(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),i!==e&&t.ended&&N(this)),null!==s&&this.emit("data",s),s},v.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},v.prototype.pipe=function(e,t){var i=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=e;break;case 1:a.pipes=[a.pipes,e];break;default:a.pipes.push(e)}a.pipesCount+=1,f("pipe count=%d opts=%j",a.pipesCount,t);var h=(!t||!1!==t.end)&&e!==s.stdout&&e!==s.stderr?c:v;function d(t,s){f("onunpipe"),t===i&&s&&!1===s.hasUnpiped&&(s.hasUnpiped=!0,f("cleanup"),e.removeListener("close",y),e.removeListener("finish",b),e.removeListener("drain",l),e.removeListener("error",g),e.removeListener("unpipe",d),i.removeListener("end",c),i.removeListener("end",v),i.removeListener("data",m),u=!0,!a.awaitDrain||e._writableState&&!e._writableState.needDrain||l())}function c(){f("onend"),e.end()}a.endEmitted?r.nextTick(h):i.once("end",h),e.on("unpipe",d);var l=function(e){return function(){var t=e._readableState;f("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&o(e,"data")&&(t.flowing=!0,P(e))}}(i);e.on("drain",l);var u=!1;var p=!1;function m(t){f("ondata"),p=!1,!1!==e.write(t)||p||((1===a.pipesCount&&a.pipes===e||a.pipesCount>1&&-1!==E(a.pipes,e))&&!u&&(f("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,p=!0),i.pause())}function g(t){f("onerror",t),v(),e.removeListener("error",g),0===o(e,"error")&&e.emit("error",t)}function y(){e.removeListener("finish",b),v()}function b(){f("onfinish"),e.removeListener("close",y),v()}function v(){f("unpipe"),i.unpipe(e)}return i.on("data",m),function(e,t,i){if("function"==typeof e.prependListener)return e.prependListener(t,i);e._events&&e._events[t]?n(e._events[t])?e._events[t].unshift(i):e._events[t]=[i,e._events[t]]:e.on(t,i)}(e,"error",g),e.once("close",y),e.once("finish",b),e.emit("pipe",i),a.flowing||(f("pipe resume"),i.resume()),e},v.prototype.unpipe=function(e){var t=this._readableState,i={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,i)),this;if(!e){var s=t.pipes,r=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var a=0;a<r;a++)s[a].emit("unpipe",this,i);return this}var n=E(t.pipes,e);return-1===n||(t.pipes.splice(n,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,i)),this},v.prototype.on=function(e,t){var i=h.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var s=this._readableState;s.endEmitted||s.readableListening||(s.readableListening=s.needReadable=!0,s.emittedReadable=!1,s.reading?s.length&&_(this):r.nextTick(x,this))}return i},v.prototype.addListener=v.prototype.on,v.prototype.resume=function(){var e=this._readableState;return e.flowing||(f("resume"),e.flowing=!0,function(e,t){t.resumeScheduled||(t.resumeScheduled=!0,r.nextTick(C,e,t))}(this,e)),this},v.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},v.prototype.wrap=function(e){var t=this,i=this._readableState,s=!1;for(var r in e.on("end",(function(){if(f("wrapped end"),i.decoder&&!i.ended){var e=i.decoder.end();e&&e.length&&t.push(e)}t.push(null)})),e.on("data",(function(r){(f("wrapped data"),i.decoder&&(r=i.decoder.write(r)),i.objectMode&&null==r)||(i.objectMode||r&&r.length)&&(t.push(r)||(s=!0,e.pause()))})),e)void 0===this[r]&&"function"==typeof e[r]&&(this[r]=function(t){return function(){return e[t].apply(e,arguments)}}(r));for(var a=0;a<y.length;a++)e.on(y[a],this.emit.bind(this,y[a]));return this._read=function(t){f("wrapped _read",t),s&&(s=!1,e.resume())},this},Object.defineProperty(v.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),v._fromList=A},94473:function(e,t,i){"use strict";e.exports=n;var s=i(68656),r=Object.create(i(16497));function a(e,t){var i=this._transformState;i.transforming=!1;var s=i.writecb;if(!s)return this.emit("error",new Error("write callback called multiple times"));i.writechunk=null,i.writecb=null,null!=t&&this.push(t),s(e);var r=this._readableState;r.reading=!1,(r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}function n(e){if(!(this instanceof n))return new n(e);s.call(this,e),this._transformState={afterTransform:a.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",o)}function o(){var e=this;"function"==typeof this._flush?this._flush((function(t,i){h(e,t,i)})):h(this,null,null)}function h(e,t,i){if(t)return e.emit("error",t);if(null!=i&&e.push(i),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}r.inherits=i(35717),r.inherits(n,s),n.prototype.push=function(e,t){return this._transformState.needTransform=!1,s.prototype.push.call(this,e,t)},n.prototype._transform=function(e,t,i){throw new Error("_transform() is not implemented")},n.prototype._write=function(e,t,i){var s=this._transformState;if(s.writecb=i,s.writechunk=e,s.writeencoding=t,!s.transforming){var r=this._readableState;(s.needTransform||r.needReadable||r.length<r.highWaterMark)&&this._read(r.highWaterMark)}},n.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},n.prototype._destroy=function(e,t){var i=this;s.prototype._destroy.call(this,e,(function(e){t(e),i.emit("close")}))}},20323:function(e,t,i){"use strict";var s=i(34155),r=i(88212);function a(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,i){var s=e.entry;e.entry=null;for(;s;){var r=s.callback;t.pendingcb--,r(i),s=s.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=y;var n,o=!s.browser&&["v0.10","v0.9."].indexOf(s.version.slice(0,5))>-1?setImmediate:r.nextTick;y.WritableState=g;var h=Object.create(i(16497));h.inherits=i(35717);var d={deprecate:i(94927)},c=i(83194),l=i(56422).Buffer,u=i.g.Uint8Array||function(){};var f,p=i(71029);function m(){}function g(e,t){n=n||i(68656),e=e||{};var s=t instanceof n;this.objectMode=!!e.objectMode,s&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var h=e.highWaterMark,d=e.writableHighWaterMark,c=this.objectMode?16:16384;this.highWaterMark=h||0===h?h:s&&(d||0===d)?d:c,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===e.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var i=e._writableState,s=i.sync,a=i.writecb;if(function(e){e.writing=!1,e.writecb=null,e.length-=e.writelen,e.writelen=0}(i),t)!function(e,t,i,s,a){--t.pendingcb,i?(r.nextTick(a,s),r.nextTick(T,e,t),e._writableState.errorEmitted=!0,e.emit("error",s)):(a(s),e._writableState.errorEmitted=!0,e.emit("error",s),T(e,t))}(e,i,s,t,a);else{var n=S(i);n||i.corked||i.bufferProcessing||!i.bufferedRequest||w(e,i),s?o(v,e,i,n,a):v(e,i,n,a)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new a(this)}function y(e){if(n=n||i(68656),!(f.call(y,this)||this instanceof n))return new y(e);this._writableState=new g(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),c.call(this)}function b(e,t,i,s,r,a,n){t.writelen=s,t.writecb=n,t.writing=!0,t.sync=!0,i?e._writev(r,t.onwrite):e._write(r,a,t.onwrite),t.sync=!1}function v(e,t,i,s){i||function(e,t){0===t.length&&t.needDrain&&(t.needDrain=!1,e.emit("drain"))}(e,t),t.pendingcb--,s(),T(e,t)}function w(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){var s=t.bufferedRequestCount,r=new Array(s),n=t.corkedRequestsFree;n.entry=i;for(var o=0,h=!0;i;)r[o]=i,i.isBuf||(h=!1),i=i.next,o+=1;r.allBuffers=h,b(e,t,!0,t.length,r,"",n.finish),t.pendingcb++,t.lastBufferedRequest=null,n.next?(t.corkedRequestsFree=n.next,n.next=null):t.corkedRequestsFree=new a(t),t.bufferedRequestCount=0}else{for(;i;){var d=i.chunk,c=i.encoding,l=i.callback;if(b(e,t,!1,t.objectMode?1:d.length,d,c,l),i=i.next,t.bufferedRequestCount--,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequest=i,t.bufferProcessing=!1}function S(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function k(e,t){e._final((function(i){t.pendingcb--,i&&e.emit("error",i),t.prefinished=!0,e.emit("prefinish"),T(e,t)}))}function T(e,t){var i=S(t);return i&&(!function(e,t){t.prefinished||t.finalCalled||("function"==typeof e._final?(t.pendingcb++,t.finalCalled=!0,r.nextTick(k,e,t)):(t.prefinished=!0,e.emit("prefinish")))}(e,t),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),i}h.inherits(y,c),g.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(g.prototype,"buffer",{get:d.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(y,Symbol.hasInstance,{value:function(e){return!!f.call(this,e)||this===y&&(e&&e._writableState instanceof g)}})):f=function(e){return e instanceof this},y.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},y.prototype.write=function(e,t,i){var s,a=this._writableState,n=!1,o=!a.objectMode&&(s=e,l.isBuffer(s)||s instanceof u);return o&&!l.isBuffer(e)&&(e=function(e){return l.from(e)}(e)),"function"==typeof t&&(i=t,t=null),o?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof i&&(i=m),a.ended?function(e,t){var i=new Error("write after end");e.emit("error",i),r.nextTick(t,i)}(this,i):(o||function(e,t,i,s){var a=!0,n=!1;return null===i?n=new TypeError("May not write null values to stream"):"string"==typeof i||void 0===i||t.objectMode||(n=new TypeError("Invalid non-string/buffer chunk")),n&&(e.emit("error",n),r.nextTick(s,n),a=!1),a}(this,a,e,i))&&(a.pendingcb++,n=function(e,t,i,s,r,a){if(!i){var n=function(e,t,i){e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=l.from(t,i));return t}(t,s,r);s!==n&&(i=!0,r="buffer",s=n)}var o=t.objectMode?1:s.length;t.length+=o;var h=t.length<t.highWaterMark;h||(t.needDrain=!0);if(t.writing||t.corked){var d=t.lastBufferedRequest;t.lastBufferedRequest={chunk:s,encoding:r,isBuf:i,callback:a,next:null},d?d.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else b(e,t,!1,o,s,r,a);return h}(this,a,o,e,t,i)),n},y.prototype.cork=function(){this._writableState.corked++},y.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||w(this,e))},y.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(y.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),y.prototype._write=function(e,t,i){i(new Error("_write() is not implemented"))},y.prototype._writev=null,y.prototype.end=function(e,t,i){var s=this._writableState;"function"==typeof e?(i=e,e=null,t=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),s.corked&&(s.corked=1,this.uncork()),s.ending||s.finished||function(e,t,i){t.ending=!0,T(e,t),i&&(t.finished?r.nextTick(i):e.once("finish",i));t.ended=!0,e.writable=!1}(this,s,i)},Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),y.prototype.destroy=p.destroy,y.prototype._undestroy=p.undestroy,y.prototype._destroy=function(e,t){this.end(),t(e)}},71143:function(e,t,i){"use strict";var s=i(56422).Buffer,r=i(69862);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i},e.prototype.concat=function(e){if(0===this.length)return s.alloc(0);if(1===this.length)return this.head.data;for(var t,i,r,a=s.allocUnsafe(e>>>0),n=this.head,o=0;n;)t=n.data,i=a,r=o,t.copy(i,r),o+=n.data.length,n=n.next;return a},e}(),r&&r.inspect&&r.inspect.custom&&(e.exports.prototype[r.inspect.custom]=function(){var e=r.inspect({length:this.length});return this.constructor.name+" "+e})},71029:function(e,t,i){"use strict";var s=i(88212);function r(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var i=this,a=this._readableState&&this._readableState.destroyed,n=this._writableState&&this._writableState.destroyed;return a||n?(t?t(e):!e||this._writableState&&this._writableState.errorEmitted||s.nextTick(r,this,e),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,(function(e){!t&&e?(s.nextTick(r,i,e),i._writableState&&(i._writableState.errorEmitted=!0)):t&&t(e)})),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},83194:function(e,t,i){e.exports=i(17187).EventEmitter},5990:function(e,t,i){e.exports=i(42874).PassThrough},42874:function(e,t,i){(t=e.exports=i(56577)).Stream=t,t.Readable=t,t.Writable=i(20323),t.Duplex=i(68656),t.Transform=i(94473),t.PassThrough=i(2366)},95202:function(e,t,i){e.exports=i(42874).Transform},73098:function(e,t,i){e.exports=i(20323)},56422:function(e,t,i){var s=i(48764),r=s.Buffer;function a(e,t){for(var i in e)t[i]=e[i]}function n(e,t,i){return r(e,t,i)}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?e.exports=s:(a(s,t),t.Buffer=n),a(r,n),n.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return r(e,t,i)},n.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");var s=r(e);return void 0!==t?"string"==typeof i?s.fill(t,i):s.fill(t):s.fill(0),s},n.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return r(e)},n.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return s.SlowBuffer(e)}},54729:function(e,t,i){"use strict";var s=i(56422).Buffer,r=s.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(s.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=h,this.end=d,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=c,this.end=l,t=3;break;default:return this.write=u,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=s.allocUnsafe(t)}function n(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function o(e){var t=this.lastTotal-this.lastNeed,i=function(e,t,i){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==i?i:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function h(e,t){if((e.length-t)%2==0){var i=e.toString("utf16le",t);if(i){var s=i.charCodeAt(i.length-1);if(s>=55296&&s<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function d(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,i)}return t}function c(e,t){var i=(e.length-t)%3;return 0===i?e.toString("base64",t):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-i))}function l(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function u(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.s=a,a.prototype.write=function(e){if(0===e.length)return"";var t,i;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<e.length?t?t+this.text(e,i):this.text(e,i):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},a.prototype.text=function(e,t){var i=function(e,t,i){var s=t.length-1;if(s<i)return 0;var r=n(t[s]);if(r>=0)return r>0&&(e.lastNeed=r-1),r;if(--s<i||-2===r)return 0;if(r=n(t[s]),r>=0)return r>0&&(e.lastNeed=r-2),r;if(--s<i||-2===r)return 0;if(r=n(t[s]),r>=0)return r>0&&(2===r?r=0:e.lastNeed=r-3),r;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=i;var s=e.length-(i-this.lastNeed);return e.copy(this.lastChar,0,s),e.toString("utf8",t,s)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},32553:function(e,t,i){"use strict";var s=i(89509).Buffer,r=s.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(s.isEncoding===r||!r(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=h,this.end=d,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=c,this.end=l,t=3;break;default:return this.write=u,void(this.end=f)}this.lastNeed=0,this.lastTotal=0,this.lastChar=s.allocUnsafe(t)}function n(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:e>>6==2?-1:-2}function o(e){var t=this.lastTotal-this.lastNeed,i=function(e,t,i){if(128!=(192&t[0]))return e.lastNeed=0,"�";if(e.lastNeed>1&&t.length>1){if(128!=(192&t[1]))return e.lastNeed=1,"�";if(e.lastNeed>2&&t.length>2&&128!=(192&t[2]))return e.lastNeed=2,"�"}}(this,e);return void 0!==i?i:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function h(e,t){if((e.length-t)%2==0){var i=e.toString("utf16le",t);if(i){var s=i.charCodeAt(i.length-1);if(s>=55296&&s<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],i.slice(0,-1)}return i}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1)}function d(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,i)}return t}function c(e,t){var i=(e.length-t)%3;return 0===i?e.toString("base64",t):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-i))}function l(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function u(e){return e.toString(this.encoding)}function f(e){return e&&e.length?this.write(e):""}t.s=a,a.prototype.write=function(e){if(0===e.length)return"";var t,i;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<e.length?t?t+this.text(e,i):this.text(e,i):t||""},a.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�":t},a.prototype.text=function(e,t){var i=function(e,t,i){var s=t.length-1;if(s<i)return 0;var r=n(t[s]);if(r>=0)return r>0&&(e.lastNeed=r-1),r;if(--s<i||-2===r)return 0;if(r=n(t[s]),r>=0)return r>0&&(e.lastNeed=r-2),r;if(--s<i||-2===r)return 0;if(r=n(t[s]),r>=0)return r>0&&(2===r?r=0:e.lastNeed=r-3),r;return 0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=i;var s=e.length-(i-this.lastNeed);return e.copy(this.lastChar,0,s),e.toString("utf8",t,s)},a.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},52511:function(e,t,i){var s;e=i.nmd(e),function(r){t&&t.nodeType,e&&e.nodeType;var a="object"==typeof i.g&&i.g;a.global!==a&&a.window!==a&&a.self;var n,o=2147483647,h=36,d=/^xn--/,c=/[^\x20-\x7E]/,l=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,p=String.fromCharCode;function m(e){throw RangeError(u[e])}function g(e,t){for(var i=e.length,s=[];i--;)s[i]=t(e[i]);return s}function y(e,t){var i=e.split("@"),s="";return i.length>1&&(s=i[0]+"@",e=i[1]),s+g((e=e.replace(l,".")).split("."),t).join(".")}function b(e){for(var t,i,s=[],r=0,a=e.length;r<a;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<a?56320==(64512&(i=e.charCodeAt(r++)))?s.push(((1023&t)<<10)+(1023&i)+65536):(s.push(t),r--):s.push(t);return s}function v(e){return g(e,(function(e){var t="";return e>65535&&(t+=p((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=p(e)})).join("")}function w(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function S(e,t,i){var s=0;for(e=i?f(e/700):e>>1,e+=f(e/t);e>455;s+=h)e=f(e/35);return f(s+36*e/(e+38))}function k(e){var t,i,s,r,a,n,d,c,l,u,p,g=[],y=e.length,b=0,w=128,k=72;for((i=e.lastIndexOf("-"))<0&&(i=0),s=0;s<i;++s)e.charCodeAt(s)>=128&&m("not-basic"),g.push(e.charCodeAt(s));for(r=i>0?i+1:0;r<y;){for(a=b,n=1,d=h;r>=y&&m("invalid-input"),((c=(p=e.charCodeAt(r++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:h)>=h||c>f((o-b)/n))&&m("overflow"),b+=c*n,!(c<(l=d<=k?1:d>=k+26?26:d-k));d+=h)n>f(o/(u=h-l))&&m("overflow"),n*=u;k=S(b-a,t=g.length+1,0==a),f(b/t)>o-w&&m("overflow"),w+=f(b/t),b%=t,g.splice(b++,0,w)}return v(g)}function T(e){var t,i,s,r,a,n,d,c,l,u,g,y,v,k,T,_=[];for(y=(e=b(e)).length,t=128,i=0,a=72,n=0;n<y;++n)(g=e[n])<128&&_.push(p(g));for(s=r=_.length,r&&_.push("-");s<y;){for(d=o,n=0;n<y;++n)(g=e[n])>=t&&g<d&&(d=g);for(d-t>f((o-i)/(v=s+1))&&m("overflow"),i+=(d-t)*v,t=d,n=0;n<y;++n)if((g=e[n])<t&&++i>o&&m("overflow"),g==t){for(c=i,l=h;!(c<(u=l<=a?1:l>=a+26?26:l-a));l+=h)T=c-u,k=h-u,_.push(p(w(u+T%k,0))),c=f(T/k);_.push(p(w(c,0))),a=S(i,v,s==r),i=0,++s}++i,++t}return _.join("")}n={version:"1.3.2",ucs2:{decode:b,encode:v},decode:k,encode:T,toASCII:function(e){return y(e,(function(e){return c.test(e)?"xn--"+T(e):e}))},toUnicode:function(e){return y(e,(function(e){return d.test(e)?k(e.slice(4).toLowerCase()):e}))}},void 0===(s=function(){return n}.call(t,i,t,e))||(e.exports=s)}()},8575:function(e,t,i){"use strict";var s=i(52511),r=i(62502);function a(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=v,t.resolve=function(e,t){return v(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?v(e,!1,!0).resolveObject(t):t},t.format=function(e){r.isString(e)&&(e=v(e));return e instanceof a?e.format():a.prototype.format.call(e)},t.Url=a;var n=/^([a-z0-9.+-]+:)/i,o=/:[0-9]*$/,h=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,d=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),c=["'"].concat(d),l=["%","/","?",";","#"].concat(c),u=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,p=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},y={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},b=i(17673);function v(e,t,i){if(e&&r.isObject(e)&&e instanceof a)return e;var s=new a;return s.parse(e,t,i),s}a.prototype.parse=function(e,t,i){if(!r.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var a=e.indexOf("?"),o=-1!==a&&a<e.indexOf("#")?"?":"#",d=e.split(o);d[0]=d[0].replace(/\\/g,"/");var v=e=d.join(o);if(v=v.trim(),!i&&1===e.split("#").length){var w=h.exec(v);if(w)return this.path=v,this.href=v,this.pathname=w[1],w[2]?(this.search=w[2],this.query=t?b.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var S=n.exec(v);if(S){var k=(S=S[0]).toLowerCase();this.protocol=k,v=v.substr(S.length)}if(i||S||v.match(/^\/\/[^@\/]+@[^@\/]+/)){var T="//"===v.substr(0,2);!T||S&&g[S]||(v=v.substr(2),this.slashes=!0)}if(!g[S]&&(T||S&&!y[S])){for(var _,O,M=-1,I=0;I<u.length;I++){-1!==(x=v.indexOf(u[I]))&&(-1===M||x<M)&&(M=x)}-1!==(O=-1===M?v.lastIndexOf("@"):v.lastIndexOf("@",M))&&(_=v.slice(0,O),v=v.slice(O+1),this.auth=decodeURIComponent(_)),M=-1;for(I=0;I<l.length;I++){var x;-1!==(x=v.indexOf(l[I]))&&(-1===M||x<M)&&(M=x)}-1===M&&(M=v.length),this.host=v.slice(0,M),v=v.slice(M),this.parseHost(),this.hostname=this.hostname||"";var C="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!C)for(var P=this.hostname.split(/\./),A=(I=0,P.length);I<A;I++){var N=P[I];if(N&&!N.match(f)){for(var B="",E=0,V=N.length;E<V;E++)N.charCodeAt(E)>127?B+="x":B+=N[E];if(!B.match(f)){var L=P.slice(0,I),R=P.slice(I+1),D=N.match(p);D&&(L.push(D[1]),R.unshift(D[2])),R.length&&(v="/"+R.join(".")+v),this.hostname=L.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),C||(this.hostname=s.toASCII(this.hostname));var F=this.port?":"+this.port:"",q=this.hostname||"";this.host=q+F,this.href+=this.host,C&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==v[0]&&(v="/"+v))}if(!m[k])for(I=0,A=c.length;I<A;I++){var G=c[I];if(-1!==v.indexOf(G)){var H=encodeURIComponent(G);H===G&&(H=escape(G)),v=v.split(G).join(H)}}var U=v.indexOf("#");-1!==U&&(this.hash=v.substr(U),v=v.slice(0,U));var j=v.indexOf("?");if(-1!==j?(this.search=v.substr(j),this.query=v.substr(j+1),t&&(this.query=b.parse(this.query)),v=v.slice(0,j)):t&&(this.search="",this.query={}),v&&(this.pathname=v),y[k]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){F=this.pathname||"";var W=this.search||"";this.path=F+W}return this.href=this.format(),this},a.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",s=this.hash||"",a=!1,n="";this.host?a=e+this.host:this.hostname&&(a=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(a+=":"+this.port)),this.query&&r.isObject(this.query)&&Object.keys(this.query).length&&(n=b.stringify(this.query));var o=this.search||n&&"?"+n||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||y[t])&&!1!==a?(a="//"+(a||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):a||(a=""),s&&"#"!==s.charAt(0)&&(s="#"+s),o&&"?"!==o.charAt(0)&&(o="?"+o),t+a+(i=i.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(o=o.replace("#","%23"))+s},a.prototype.resolve=function(e){return this.resolveObject(v(e,!1,!0)).format()},a.prototype.resolveObject=function(e){if(r.isString(e)){var t=new a;t.parse(e,!1,!0),e=t}for(var i=new a,s=Object.keys(this),n=0;n<s.length;n++){var o=s[n];i[o]=this[o]}if(i.hash=e.hash,""===e.href)return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var h=Object.keys(e),d=0;d<h.length;d++){var c=h[d];"protocol"!==c&&(i[c]=e[c])}return y[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(e.protocol&&e.protocol!==i.protocol){if(!y[e.protocol]){for(var l=Object.keys(e),u=0;u<l.length;u++){var f=l[u];i[f]=e[f]}return i.href=i.format(),i}if(i.protocol=e.protocol,e.host||g[e.protocol])i.pathname=e.pathname;else{for(var p=(e.pathname||"").split("/");p.length&&!(e.host=p.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==p[0]&&p.unshift(""),p.length<2&&p.unshift(""),i.pathname=p.join("/")}if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var m=i.pathname||"",b=i.search||"";i.path=m+b}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var v=i.pathname&&"/"===i.pathname.charAt(0),w=e.host||e.pathname&&"/"===e.pathname.charAt(0),S=w||v||i.host&&e.pathname,k=S,T=i.pathname&&i.pathname.split("/")||[],_=(p=e.pathname&&e.pathname.split("/")||[],i.protocol&&!y[i.protocol]);if(_&&(i.hostname="",i.port=null,i.host&&(""===T[0]?T[0]=i.host:T.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===p[0]?p[0]=e.host:p.unshift(e.host)),e.host=null),S=S&&(""===p[0]||""===T[0])),w)i.host=e.host||""===e.host?e.host:i.host,i.hostname=e.hostname||""===e.hostname?e.hostname:i.hostname,i.search=e.search,i.query=e.query,T=p;else if(p.length)T||(T=[]),T.pop(),T=T.concat(p),i.search=e.search,i.query=e.query;else if(!r.isNullOrUndefined(e.search)){if(_)i.hostname=i.host=T.shift(),(C=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=C.shift(),i.host=i.hostname=C.shift());return i.search=e.search,i.query=e.query,r.isNull(i.pathname)&&r.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!T.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var O=T.slice(-1)[0],M=(i.host||e.host||T.length>1)&&("."===O||".."===O)||""===O,I=0,x=T.length;x>=0;x--)"."===(O=T[x])?T.splice(x,1):".."===O?(T.splice(x,1),I++):I&&(T.splice(x,1),I--);if(!S&&!k)for(;I--;I)T.unshift("..");!S||""===T[0]||T[0]&&"/"===T[0].charAt(0)||T.unshift(""),M&&"/"!==T.join("/").substr(-1)&&T.push("");var C,P=""===T[0]||T[0]&&"/"===T[0].charAt(0);_&&(i.hostname=i.host=P?"":T.length?T.shift():"",(C=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=C.shift(),i.host=i.hostname=C.shift()));return(S=S||i.host&&T.length)&&!P&&T.unshift(""),T.length?i.pathname=T.join("/"):(i.pathname=null,i.path=null),r.isNull(i.pathname)&&r.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},a.prototype.parseHost=function(){var e=this.host,t=o.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},62502:function(e){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},94927:function(e,t,i){function s(e){try{if(!i.g.localStorage)return!1}catch(e){return!1}var t=i.g.localStorage[e];return null!=t&&"true"===String(t).toLowerCase()}e.exports=function(e,t){if(s("noDeprecation"))return e;var i=!1;return function(){if(!i){if(s("throwDeprecation"))throw new Error(t);s("traceDeprecation")?console.trace(t):console.warn(t),i=!0}return e.apply(this,arguments)}}},91496:function(e){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},20384:function(e){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},89539:function(e,t,i){var s=i(34155),r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),i={},s=0;s<t.length;s++)i[t[s]]=Object.getOwnPropertyDescriptor(e,t[s]);return i},a=/%[sdj%]/g;t.format=function(e){if(!b(e)){for(var t=[],i=0;i<arguments.length;i++)t.push(h(arguments[i]));return t.join(" ")}i=1;for(var s=arguments,r=s.length,n=String(e).replace(a,(function(e){if("%%"===e)return"%";if(i>=r)return e;switch(e){case"%s":return String(s[i++]);case"%d":return Number(s[i++]);case"%j":try{return JSON.stringify(s[i++])}catch(e){return"[Circular]"}default:return e}})),o=s[i];i<r;o=s[++i])g(o)||!S(o)?n+=" "+o:n+=" "+h(o);return n},t.deprecate=function(e,i){if(void 0!==s&&!0===s.noDeprecation)return e;if(void 0===s)return function(){return t.deprecate(e,i).apply(this,arguments)};var r=!1;return function(){if(!r){if(s.throwDeprecation)throw new Error(i);s.traceDeprecation?console.trace(i):console.error(i),r=!0}return e.apply(this,arguments)}};var n,o={};function h(e,i){var s={seen:[],stylize:c};return arguments.length>=3&&(s.depth=arguments[2]),arguments.length>=4&&(s.colors=arguments[3]),m(i)?s.showHidden=i:i&&t._extend(s,i),v(s.showHidden)&&(s.showHidden=!1),v(s.depth)&&(s.depth=2),v(s.colors)&&(s.colors=!1),v(s.customInspect)&&(s.customInspect=!0),s.colors&&(s.stylize=d),l(s,e,s.depth)}function d(e,t){var i=h.styles[t];return i?"["+h.colors[i][0]+"m"+e+"["+h.colors[i][1]+"m":e}function c(e,t){return e}function l(e,i,s){if(e.customInspect&&i&&_(i.inspect)&&i.inspect!==t.inspect&&(!i.constructor||i.constructor.prototype!==i)){var r=i.inspect(s,e);return b(r)||(r=l(e,r,s)),r}var a=function(e,t){if(v(t))return e.stylize("undefined","undefined");if(b(t)){var i="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(i,"string")}if(y(t))return e.stylize(""+t,"number");if(m(t))return e.stylize(""+t,"boolean");if(g(t))return e.stylize("null","null")}(e,i);if(a)return a;var n=Object.keys(i),o=function(e){var t={};return e.forEach((function(e,i){t[e]=!0})),t}(n);if(e.showHidden&&(n=Object.getOwnPropertyNames(i)),T(i)&&(n.indexOf("message")>=0||n.indexOf("description")>=0))return u(i);if(0===n.length){if(_(i)){var h=i.name?": "+i.name:"";return e.stylize("[Function"+h+"]","special")}if(w(i))return e.stylize(RegExp.prototype.toString.call(i),"regexp");if(k(i))return e.stylize(Date.prototype.toString.call(i),"date");if(T(i))return u(i)}var d,c="",S=!1,O=["{","}"];(p(i)&&(S=!0,O=["[","]"]),_(i))&&(c=" [Function"+(i.name?": "+i.name:"")+"]");return w(i)&&(c=" "+RegExp.prototype.toString.call(i)),k(i)&&(c=" "+Date.prototype.toUTCString.call(i)),T(i)&&(c=" "+u(i)),0!==n.length||S&&0!=i.length?s<0?w(i)?e.stylize(RegExp.prototype.toString.call(i),"regexp"):e.stylize("[Object]","special"):(e.seen.push(i),d=S?function(e,t,i,s,r){for(var a=[],n=0,o=t.length;n<o;++n)C(t,String(n))?a.push(f(e,t,i,s,String(n),!0)):a.push("");return r.forEach((function(r){r.match(/^\d+$/)||a.push(f(e,t,i,s,r,!0))})),a}(e,i,s,o,n):n.map((function(t){return f(e,i,s,o,t,S)})),e.seen.pop(),function(e,t,i){var s=e.reduce((function(e,t){return t.indexOf("\n")>=0&&0,e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0);if(s>60)return i[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+i[1];return i[0]+t+" "+e.join(", ")+" "+i[1]}(d,c,O)):O[0]+c+O[1]}function u(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,i,s,r,a){var n,o,h;if((h=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]}).get?o=h.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):h.set&&(o=e.stylize("[Setter]","special")),C(s,r)||(n="["+r+"]"),o||(e.seen.indexOf(h.value)<0?(o=g(i)?l(e,h.value,null):l(e,h.value,i-1)).indexOf("\n")>-1&&(o=a?o.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+o.split("\n").map((function(e){return"   "+e})).join("\n")):o=e.stylize("[Circular]","special")),v(n)){if(a&&r.match(/^\d+$/))return o;(n=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(n=n.substr(1,n.length-2),n=e.stylize(n,"name")):(n=n.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),n=e.stylize(n,"string"))}return n+": "+o}function p(e){return Array.isArray(e)}function m(e){return"boolean"==typeof e}function g(e){return null===e}function y(e){return"number"==typeof e}function b(e){return"string"==typeof e}function v(e){return void 0===e}function w(e){return S(e)&&"[object RegExp]"===O(e)}function S(e){return"object"==typeof e&&null!==e}function k(e){return S(e)&&"[object Date]"===O(e)}function T(e){return S(e)&&("[object Error]"===O(e)||e instanceof Error)}function _(e){return"function"==typeof e}function O(e){return Object.prototype.toString.call(e)}function M(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(e){if(v(n)&&(n={NODE_ENV:"production",PUBLIC_PATH:"./"}.NODE_DEBUG||""),e=e.toUpperCase(),!o[e])if(new RegExp("\\b"+e+"\\b","i").test(n)){var i=s.pid;o[e]=function(){var s=t.format.apply(t,arguments);console.error("%s %d: %s",e,i,s)}}else o[e]=function(){};return o[e]},t.inspect=h,h.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},h.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=p,t.isBoolean=m,t.isNull=g,t.isNullOrUndefined=function(e){return null==e},t.isNumber=y,t.isString=b,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=v,t.isRegExp=w,t.isObject=S,t.isDate=k,t.isError=T,t.isFunction=_,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=i(20384);var I=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function x(){var e=new Date,t=[M(e.getHours()),M(e.getMinutes()),M(e.getSeconds())].join(":");return[e.getDate(),I[e.getMonth()],t].join(" ")}function C(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",x(),t.format.apply(t,arguments))},t.inherits=i(91496),t._extend=function(e,t){if(!t||!S(t))return e;for(var i=Object.keys(t),s=i.length;s--;)e[i[s]]=t[i[s]];return e};var P="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function A(e,t){if(!e){var i=new Error("Promise was rejected with a falsy value");i.reason=e,e=i}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(P&&e[P]){var t;if("function"!=typeof(t=e[P]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,P,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,i,s=new Promise((function(e,s){t=e,i=s})),r=[],a=0;a<arguments.length;a++)r.push(arguments[a]);r.push((function(e,s){e?i(e):t(s)}));try{e.apply(this,r)}catch(e){i(e)}return s}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),P&&Object.defineProperty(t,P,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=P,t.callbackify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');function t(){for(var t=[],i=0;i<arguments.length;i++)t.push(arguments[i]);var r=t.pop();if("function"!=typeof r)throw new TypeError("The last argument must be of type Function");var a=this,n=function(){return r.apply(a,arguments)};e.apply(this,t).then((function(e){s.nextTick(n,null,e)}),(function(e){s.nextTick(A,e,n)}))}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),Object.defineProperties(t,r(e)),t}},31667:function(e,t,i){"use strict";i.d(t,{Z:function(){return u}});var s=i(67308);var r=function(){this.__data__=new s.Z,this.size=0};var a=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i};var n=function(e){return this.__data__.get(e)};var o=function(e){return this.__data__.has(e)},h=i(86183),d=i(37834);var c=function(e,t){var i=this.__data__;if(i instanceof s.Z){var r=i.__data__;if(!h.Z||r.length<199)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new d.Z(r)}return i.set(e,t),this.size=i.size,this};function l(e){var t=this.__data__=new s.Z(e);this.size=t.size}l.prototype.clear=r,l.prototype.delete=a,l.prototype.get=n,l.prototype.has=o,l.prototype.set=c;var u=l},84073:function(e,t,i){"use strict";var s=i(66092).Z.Uint8Array;t.Z=s},74752:function(e,t,i){"use strict";var s=i(77904);t.Z=function(e,t,i){"__proto__"==t&&s.Z?(0,s.Z)(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}},61395:function(e,t,i){"use strict";i.d(t,{Z:function(){return s}});var s=function(e){return function(t,i,s){for(var r=-1,a=Object(t),n=s(t),o=n.length;o--;){var h=n[e?o:++r];if(!1===i(a[h],h,a))break}return t}}()},77904:function(e,t,i){"use strict";var s=i(62508),r=function(){try{var e=(0,s.Z)(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();t.Z=r},23353:function(e,t,i){"use strict";i.d(t,{Z:function(){return T}});var s=i(62508),r=i(66092),a=(0,s.Z)(r.Z,"DataView"),n=i(86183),o=(0,s.Z)(r.Z,"Promise"),h=(0,s.Z)(r.Z,"Set"),d=(0,s.Z)(r.Z,"WeakMap"),c=i(93589),l=i(90019),u="[object Map]",f="[object Promise]",p="[object Set]",m="[object WeakMap]",g="[object DataView]",y=(0,l.Z)(a),b=(0,l.Z)(n.Z),v=(0,l.Z)(o),w=(0,l.Z)(h),S=(0,l.Z)(d),k=c.Z;(a&&k(new a(new ArrayBuffer(1)))!=g||n.Z&&k(new n.Z)!=u||o&&k(o.resolve())!=f||h&&k(new h)!=p||d&&k(new d)!=m)&&(k=function(e){var t=(0,c.Z)(e),i="[object Object]"==t?e.constructor:void 0,s=i?(0,l.Z)(i):"";if(s)switch(s){case y:return g;case b:return u;case v:return f;case w:return p;case S:return m}return t});var T=k},69203:function(e,t){"use strict";t.Z=function(e){return e}},60088:function(e,t,i){"use strict";i.d(t,{Z:function(){return n}});var s=i(95591),r=i(11753);const a=new WeakMap,n=(0,r.xD)(s.ZP,(e=>(t,i,s)=>{const[n]=(0,r.qC)(t),o=t,h=n?"$sub$"+n:void 0,d=e(h,null,s),{cache:c}=s;a.has(c)||a.set(c,[new Map,new Map]);const[l,u]=a.get(c);return(0,r.LI)((()=>{if(!h)return;const[,e]=(0,r.JN)(c,h),t=l.get(h)||0,s=(t,i)=>{null!=t?e({error:t}):(e({error:void 0}),d.mutate(i,!1))};if(l.set(h,t+1),!t){const e=i(o,{next:s});if("function"!=typeof e)throw new Error("The `subscribe` function must return a function to unsubscribe.");u.set(h,e)}return()=>{setTimeout((()=>{const e=l.get(h)-1;if(l.set(h,e),!e){const e=u.get(h);null==e||e()}}))}}),[h]),{get data(){return d.data},get error(){return d.error}}}))},44946:function(e){"use strict";e.exports=JSON.parse('{"aes-128-ecb":{"cipher":"AES","key":128,"iv":0,"mode":"ECB","type":"block"},"aes-192-ecb":{"cipher":"AES","key":192,"iv":0,"mode":"ECB","type":"block"},"aes-256-ecb":{"cipher":"AES","key":256,"iv":0,"mode":"ECB","type":"block"},"aes-128-cbc":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes-192-cbc":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes-256-cbc":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes128":{"cipher":"AES","key":128,"iv":16,"mode":"CBC","type":"block"},"aes192":{"cipher":"AES","key":192,"iv":16,"mode":"CBC","type":"block"},"aes256":{"cipher":"AES","key":256,"iv":16,"mode":"CBC","type":"block"},"aes-128-cfb":{"cipher":"AES","key":128,"iv":16,"mode":"CFB","type":"stream"},"aes-192-cfb":{"cipher":"AES","key":192,"iv":16,"mode":"CFB","type":"stream"},"aes-256-cfb":{"cipher":"AES","key":256,"iv":16,"mode":"CFB","type":"stream"},"aes-128-cfb8":{"cipher":"AES","key":128,"iv":16,"mode":"CFB8","type":"stream"},"aes-192-cfb8":{"cipher":"AES","key":192,"iv":16,"mode":"CFB8","type":"stream"},"aes-256-cfb8":{"cipher":"AES","key":256,"iv":16,"mode":"CFB8","type":"stream"},"aes-128-cfb1":{"cipher":"AES","key":128,"iv":16,"mode":"CFB1","type":"stream"},"aes-192-cfb1":{"cipher":"AES","key":192,"iv":16,"mode":"CFB1","type":"stream"},"aes-256-cfb1":{"cipher":"AES","key":256,"iv":16,"mode":"CFB1","type":"stream"},"aes-128-ofb":{"cipher":"AES","key":128,"iv":16,"mode":"OFB","type":"stream"},"aes-192-ofb":{"cipher":"AES","key":192,"iv":16,"mode":"OFB","type":"stream"},"aes-256-ofb":{"cipher":"AES","key":256,"iv":16,"mode":"OFB","type":"stream"},"aes-128-ctr":{"cipher":"AES","key":128,"iv":16,"mode":"CTR","type":"stream"},"aes-192-ctr":{"cipher":"AES","key":192,"iv":16,"mode":"CTR","type":"stream"},"aes-256-ctr":{"cipher":"AES","key":256,"iv":16,"mode":"CTR","type":"stream"},"aes-128-gcm":{"cipher":"AES","key":128,"iv":12,"mode":"GCM","type":"auth"},"aes-192-gcm":{"cipher":"AES","key":192,"iv":12,"mode":"GCM","type":"auth"},"aes-256-gcm":{"cipher":"AES","key":256,"iv":12,"mode":"GCM","type":"auth"}}')},75207:function(e){"use strict";e.exports=JSON.parse('{"sha224WithRSAEncryption":{"sign":"rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"RSA-SHA224":{"sign":"ecdsa/rsa","hash":"sha224","id":"302d300d06096086480165030402040500041c"},"sha256WithRSAEncryption":{"sign":"rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"RSA-SHA256":{"sign":"ecdsa/rsa","hash":"sha256","id":"3031300d060960864801650304020105000420"},"sha384WithRSAEncryption":{"sign":"rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"RSA-SHA384":{"sign":"ecdsa/rsa","hash":"sha384","id":"3041300d060960864801650304020205000430"},"sha512WithRSAEncryption":{"sign":"rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA512":{"sign":"ecdsa/rsa","hash":"sha512","id":"3051300d060960864801650304020305000440"},"RSA-SHA1":{"sign":"rsa","hash":"sha1","id":"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{"sign":"ecdsa","hash":"sha1","id":""},"sha256":{"sign":"ecdsa","hash":"sha256","id":""},"sha224":{"sign":"ecdsa","hash":"sha224","id":""},"sha384":{"sign":"ecdsa","hash":"sha384","id":""},"sha512":{"sign":"ecdsa","hash":"sha512","id":""},"DSA-SHA":{"sign":"dsa","hash":"sha1","id":""},"DSA-SHA1":{"sign":"dsa","hash":"sha1","id":""},"DSA":{"sign":"dsa","hash":"sha1","id":""},"DSA-WITH-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-SHA224":{"sign":"dsa","hash":"sha224","id":""},"DSA-WITH-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-SHA256":{"sign":"dsa","hash":"sha256","id":""},"DSA-WITH-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-SHA384":{"sign":"dsa","hash":"sha384","id":""},"DSA-WITH-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-SHA512":{"sign":"dsa","hash":"sha512","id":""},"DSA-RIPEMD160":{"sign":"dsa","hash":"rmd160","id":""},"ripemd160WithRSA":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"RSA-RIPEMD160":{"sign":"rsa","hash":"rmd160","id":"3021300906052b2403020105000414"},"md5WithRSAEncryption":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"},"RSA-MD5":{"sign":"rsa","hash":"md5","id":"3020300c06082a864886f70d020505000410"}}')},1308:function(e){"use strict";e.exports=JSON.parse('{"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}')},83208:function(e){"use strict";e.exports=JSON.parse('{"O_RDONLY":0,"O_WRONLY":1,"O_RDWR":2,"S_IFMT":61440,"S_IFREG":32768,"S_IFDIR":16384,"S_IFCHR":8192,"S_IFBLK":24576,"S_IFIFO":4096,"S_IFLNK":40960,"S_IFSOCK":49152,"O_CREAT":512,"O_EXCL":2048,"O_NOCTTY":131072,"O_TRUNC":1024,"O_APPEND":8,"O_DIRECTORY":1048576,"O_NOFOLLOW":256,"O_SYNC":128,"O_SYMLINK":2097152,"O_NONBLOCK":4,"S_IRWXU":448,"S_IRUSR":256,"S_IWUSR":128,"S_IXUSR":64,"S_IRWXG":56,"S_IRGRP":32,"S_IWGRP":16,"S_IXGRP":8,"S_IRWXO":7,"S_IROTH":4,"S_IWOTH":2,"S_IXOTH":1,"E2BIG":7,"EACCES":13,"EADDRINUSE":48,"EADDRNOTAVAIL":49,"EAFNOSUPPORT":47,"EAGAIN":35,"EALREADY":37,"EBADF":9,"EBADMSG":94,"EBUSY":16,"ECANCELED":89,"ECHILD":10,"ECONNABORTED":53,"ECONNREFUSED":61,"ECONNRESET":54,"EDEADLK":11,"EDESTADDRREQ":39,"EDOM":33,"EDQUOT":69,"EEXIST":17,"EFAULT":14,"EFBIG":27,"EHOSTUNREACH":65,"EIDRM":90,"EILSEQ":92,"EINPROGRESS":36,"EINTR":4,"EINVAL":22,"EIO":5,"EISCONN":56,"EISDIR":21,"ELOOP":62,"EMFILE":24,"EMLINK":31,"EMSGSIZE":40,"EMULTIHOP":95,"ENAMETOOLONG":63,"ENETDOWN":50,"ENETRESET":52,"ENETUNREACH":51,"ENFILE":23,"ENOBUFS":55,"ENODATA":96,"ENODEV":19,"ENOENT":2,"ENOEXEC":8,"ENOLCK":77,"ENOLINK":97,"ENOMEM":12,"ENOMSG":91,"ENOPROTOOPT":42,"ENOSPC":28,"ENOSR":98,"ENOSTR":99,"ENOSYS":78,"ENOTCONN":57,"ENOTDIR":20,"ENOTEMPTY":66,"ENOTSOCK":38,"ENOTSUP":45,"ENOTTY":25,"ENXIO":6,"EOPNOTSUPP":102,"EOVERFLOW":84,"EPERM":1,"EPIPE":32,"EPROTO":100,"EPROTONOSUPPORT":43,"EPROTOTYPE":41,"ERANGE":34,"EROFS":30,"ESPIPE":29,"ESRCH":3,"ESTALE":70,"ETIME":101,"ETIMEDOUT":60,"ETXTBSY":26,"EWOULDBLOCK":35,"EXDEV":18,"SIGHUP":1,"SIGINT":2,"SIGQUIT":3,"SIGILL":4,"SIGTRAP":5,"SIGABRT":6,"SIGIOT":6,"SIGBUS":10,"SIGFPE":8,"SIGKILL":9,"SIGUSR1":30,"SIGSEGV":11,"SIGUSR2":31,"SIGPIPE":13,"SIGALRM":14,"SIGTERM":15,"SIGCHLD":20,"SIGCONT":19,"SIGSTOP":17,"SIGTSTP":18,"SIGTTIN":21,"SIGTTOU":22,"SIGURG":16,"SIGXCPU":24,"SIGXFSZ":25,"SIGVTALRM":26,"SIGPROF":27,"SIGWINCH":28,"SIGIO":23,"SIGSYS":12,"SSL_OP_ALL":2147486719,"SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION":262144,"SSL_OP_CIPHER_SERVER_PREFERENCE":4194304,"SSL_OP_CISCO_ANYCONNECT":32768,"SSL_OP_COOKIE_EXCHANGE":8192,"SSL_OP_CRYPTOPRO_TLSEXT_BUG":2147483648,"SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS":2048,"SSL_OP_EPHEMERAL_RSA":0,"SSL_OP_LEGACY_SERVER_CONNECT":4,"SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER":32,"SSL_OP_MICROSOFT_SESS_ID_BUG":1,"SSL_OP_MSIE_SSLV2_RSA_PADDING":0,"SSL_OP_NETSCAPE_CA_DN_BUG":536870912,"SSL_OP_NETSCAPE_CHALLENGE_BUG":2,"SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG":1073741824,"SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG":8,"SSL_OP_NO_COMPRESSION":131072,"SSL_OP_NO_QUERY_MTU":4096,"SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION":65536,"SSL_OP_NO_SSLv2":16777216,"SSL_OP_NO_SSLv3":33554432,"SSL_OP_NO_TICKET":16384,"SSL_OP_NO_TLSv1":67108864,"SSL_OP_NO_TLSv1_1":268435456,"SSL_OP_NO_TLSv1_2":134217728,"SSL_OP_PKCS1_CHECK_1":0,"SSL_OP_PKCS1_CHECK_2":0,"SSL_OP_SINGLE_DH_USE":1048576,"SSL_OP_SINGLE_ECDH_USE":524288,"SSL_OP_SSLEAY_080_CLIENT_DH_BUG":128,"SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG":0,"SSL_OP_TLS_BLOCK_PADDING_BUG":512,"SSL_OP_TLS_D5_BUG":256,"SSL_OP_TLS_ROLLBACK_BUG":8388608,"ENGINE_METHOD_DSA":2,"ENGINE_METHOD_DH":4,"ENGINE_METHOD_RAND":8,"ENGINE_METHOD_ECDH":16,"ENGINE_METHOD_ECDSA":32,"ENGINE_METHOD_CIPHERS":64,"ENGINE_METHOD_DIGESTS":128,"ENGINE_METHOD_STORE":256,"ENGINE_METHOD_PKEY_METHS":512,"ENGINE_METHOD_PKEY_ASN1_METHS":1024,"ENGINE_METHOD_ALL":65535,"ENGINE_METHOD_NONE":0,"DH_CHECK_P_NOT_SAFE_PRIME":2,"DH_CHECK_P_NOT_PRIME":1,"DH_UNABLE_TO_CHECK_GENERATOR":4,"DH_NOT_SUITABLE_GENERATOR":8,"NPN_ENABLED":1,"RSA_PKCS1_PADDING":1,"RSA_SSLV23_PADDING":2,"RSA_NO_PADDING":3,"RSA_PKCS1_OAEP_PADDING":4,"RSA_X931_PADDING":5,"RSA_PKCS1_PSS_PADDING":6,"POINT_CONVERSION_COMPRESSED":2,"POINT_CONVERSION_UNCOMPRESSED":4,"POINT_CONVERSION_HYBRID":6,"F_OK":0,"R_OK":4,"W_OK":2,"X_OK":1,"UV_UDP_REUSEADDR":4}')},29799:function(e){"use strict";e.exports=JSON.parse('{"modp1":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},"modp2":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},"modp5":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},"modp14":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},"modp15":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},"modp16":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},"modp17":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},"modp18":{"gen":"02","prime":"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}')},18597:function(e){"use strict";e.exports={i8:"6.5.4"}},22562:function(e){"use strict";e.exports=JSON.parse('{"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}')}}]);